--
-- Create Schema Script
--   Database Version            : 12.1.0.2.0
--   Database Compatible Level   : 12.1.0.2.0
--   Script Compatible Level     : 12.1.0.2.0
--   Toad Version                : 12.11.0.95
--   DB Connect String           : SBS1.INT
--   Schema                      : SBS1_ADMIN
--   Script Created by           : SBS1_ADMIN
--   Script Created at           : 11/02/2019 11:29:25
--   Notes                       : 
--

-- Object Counts: 
--   Roles: 3           System Privileges: 7    Roles: 2            Grants: 1 
--   Users: 1           System Privileges: 1    Roles: 3                Grants: 112         Tablespace Quotas: 46 
--   Tablespaces: 18    Datafiles: 17       Tempfiles: 1 
-- 
--   Database Links: 1 
--   Directories: 13 
--   Functions: 113     Lines of Code: 3812 
--   Indexes: 448       Columns: 538        Partitions: 492     
--   Materialized View Logs: 20 
--   Object Privileges: 998 
--   Packages: 30       Lines of Code: 3704 
--   Package Bodies: 29 Lines of Code: 4412062 
--   Procedures: 37     Lines of Code: 2364 
--   Sequences: 25 
--   Synonym: 132 
--   Tables: 281        Columns: 4087       Partitions: 107     Constraints: 1188   
--   Triggers: 2 
--   Views: 508         Columns: 6035       


-- "Set define off" turns off substitution variables.
Set define off; 

--
-- DATA_PUMP_DIR  (Directory) 
--
CREATE OR REPLACE DIRECTORY 
DATA_PUMP_DIR AS 
'/u01/app/oracle/product/12.1.0.2/dbhome_1/rdbms/log/';


--
-- DIR_DBA  (Directory) 
--
CREATE OR REPLACE DIRECTORY 
DIR_DBA AS 
'/u01/app/oracle/admin/ECACP/utl';


--
-- DP_PROD  (Directory) 
--
CREATE OR REPLACE DIRECTORY 
DP_PROD AS 
'/dbautil1/DB/ECACP';


--
-- EXATEST  (Directory) 
--
CREATE OR REPLACE DIRECTORY 
EXATEST AS 
'/dbautil1/DB/ECACT';


--
-- OPATCH_INST_DIR  (Directory) 
--
CREATE OR REPLACE DIRECTORY 
OPATCH_INST_DIR AS 
'/u01/app/oracle/product/12.1.0.2/dbhome_1/OPatch';


--
-- OPATCH_LOG_DIR  (Directory) 
--
CREATE OR REPLACE DIRECTORY 
OPATCH_LOG_DIR AS 
'/u01/app/oracle/product/12.1.0.2/dbhome_1/QOpatch';


--
-- OPATCH_SCRIPT_DIR  (Directory) 
--
CREATE OR REPLACE DIRECTORY 
OPATCH_SCRIPT_DIR AS 
'/u01/app/oracle/product/12.1.0.2/dbhome_1/QOpatch';


--
-- ORACLE_BASE  (Directory) 
--
CREATE OR REPLACE DIRECTORY 
ORACLE_BASE AS 
'/';


--
-- ORACLE_HOME  (Directory) 
--
CREATE OR REPLACE DIRECTORY 
ORACLE_HOME AS 
'/';


--
-- ORACLE_OCM_CONFIG_DIR  (Directory) 
--
CREATE OR REPLACE DIRECTORY 
ORACLE_OCM_CONFIG_DIR AS 
'/u01/app/oracle/product/11.2.0.4/dbhome_1/ccr/hosts/bdm2db01.it.bwns.ch/state';


--
-- ORACLE_OCM_CONFIG_DIR2  (Directory) 
--
CREATE OR REPLACE DIRECTORY 
ORACLE_OCM_CONFIG_DIR2 AS 
'/u01/app/oracle/product/11.2.0.4/dbhome_1/ccr/state';


--
-- PREUPGRADE_DIR  (Directory) 
--
CREATE OR REPLACE DIRECTORY 
PREUPGRADE_DIR AS 
'/u01/app/oracle/cfgtoollogs/INSBS_011/preupgrade/';


--
-- XSDDIR  (Directory) 
--
CREATE OR REPLACE DIRECTORY 
XSDDIR AS 
'/u01/app/oracle/product/12.1.0.2/dbhome_1/rdbms/xml/schema';


--
-- SBS1_APPLICATION_DATA  (Tablespace) 
--
CREATE BIGFILE TABLESPACE SBS1_APPLICATION_DATA DATAFILE 
  '+DATA' SIZE 20G AUTOEXTEND ON NEXT 1G MAXSIZE 30G
LOGGING
DEFAULT 
  NO INMEMORY
ONLINE
EXTENT MANAGEMENT LOCAL AUTOALLOCATE
BLOCKSIZE 8K
SEGMENT SPACE MANAGEMENT AUTO
FLASHBACK ON;


--
-- SBS1_APPLICATION_INDEX  (Tablespace) 
--
CREATE BIGFILE TABLESPACE SBS1_APPLICATION_INDEX DATAFILE 
  '+DATA' SIZE 12G AUTOEXTEND ON NEXT 1G MAXSIZE 15G
LOGGING
DEFAULT 
  NO INMEMORY
ONLINE
EXTENT MANAGEMENT LOCAL AUTOALLOCATE
BLOCKSIZE 8K
SEGMENT SPACE MANAGEMENT AUTO
FLASHBACK ON;


--
-- SBS1_ARCHIV_DATA_NC  (Tablespace) 
--
CREATE BIGFILE TABLESPACE SBS1_ARCHIV_DATA_NC DATAFILE 
  '+DATA' SIZE 50G AUTOEXTEND ON NEXT 5G MAXSIZE 100G
LOGGING
DEFAULT 
  NO INMEMORY
ONLINE
EXTENT MANAGEMENT LOCAL AUTOALLOCATE
BLOCKSIZE 8K
SEGMENT SPACE MANAGEMENT AUTO
FLASHBACK ON;


--
-- SBS1_BASE_DATA  (Tablespace) 
--
CREATE BIGFILE TABLESPACE SBS1_BASE_DATA DATAFILE 
  '+DATA' SIZE 1G AUTOEXTEND ON NEXT 1G MAXSIZE 10G
LOGGING
DEFAULT 
  NO INMEMORY
ONLINE
EXTENT MANAGEMENT LOCAL AUTOALLOCATE
BLOCKSIZE 8K
SEGMENT SPACE MANAGEMENT AUTO
FLASHBACK ON;


--
-- SBS1_BASE_INDEX  (Tablespace) 
--
CREATE BIGFILE TABLESPACE SBS1_BASE_INDEX DATAFILE 
  '+DATA' SIZE 1G AUTOEXTEND ON NEXT 1G MAXSIZE 10G
LOGGING
DEFAULT 
  NO INMEMORY
ONLINE
EXTENT MANAGEMENT LOCAL AUTOALLOCATE
BLOCKSIZE 8K
SEGMENT SPACE MANAGEMENT AUTO
FLASHBACK ON;


--
-- SBS1_INFO_DATA_UC  (Tablespace) 
--
CREATE BIGFILE TABLESPACE SBS1_INFO_DATA_UC DATAFILE 
  '+DATA' SIZE 9G AUTOEXTEND ON NEXT 1G MAXSIZE 128G
LOGGING
DEFAULT 
  NO INMEMORY
ONLINE
EXTENT MANAGEMENT LOCAL AUTOALLOCATE
BLOCKSIZE 8K
SEGMENT SPACE MANAGEMENT AUTO
FLASHBACK ON;


--
-- SBS1_INFO_INDEX_UC  (Tablespace) 
--
CREATE BIGFILE TABLESPACE SBS1_INFO_INDEX_UC DATAFILE 
  '+DATA' SIZE 5G AUTOEXTEND ON NEXT 1G MAXSIZE 128G
LOGGING
DEFAULT 
  NO INMEMORY
ONLINE
EXTENT MANAGEMENT LOCAL AUTOALLOCATE
BLOCKSIZE 8K
SEGMENT SPACE MANAGEMENT AUTO
FLASHBACK ON;


--
-- SBS1_MMSC_DATA_NC  (Tablespace) 
--
CREATE BIGFILE TABLESPACE SBS1_MMSC_DATA_NC DATAFILE 
  '+DATA' SIZE 69G AUTOEXTEND ON NEXT 1G MAXSIZE 100G
LOGGING
DEFAULT 
  NO INMEMORY
ONLINE
EXTENT MANAGEMENT LOCAL AUTOALLOCATE
BLOCKSIZE 8K
SEGMENT SPACE MANAGEMENT AUTO
FLASHBACK ON;


--
-- SBS1_MMSC_INDEX_NC  (Tablespace) 
--
CREATE BIGFILE TABLESPACE SBS1_MMSC_INDEX_NC DATAFILE 
  '+DATA' SIZE 19424M AUTOEXTEND ON NEXT 100M MAXSIZE 30G
LOGGING
DEFAULT 
  NO INMEMORY
ONLINE
EXTENT MANAGEMENT LOCAL AUTOALLOCATE
BLOCKSIZE 8K
SEGMENT SPACE MANAGEMENT AUTO
FLASHBACK ON;


--
-- SBS1_MSCA_DATA_NC  (Tablespace) 
--
CREATE BIGFILE TABLESPACE SBS1_MSCA_DATA_NC DATAFILE 
  '+DATA' SIZE 16G AUTOEXTEND ON NEXT 1G MAXSIZE 450G
LOGGING
DEFAULT 
  NO INMEMORY
ONLINE
EXTENT MANAGEMENT LOCAL AUTOALLOCATE
BLOCKSIZE 8K
SEGMENT SPACE MANAGEMENT AUTO
FLASHBACK ON;


--
-- SBS1_MSCA_INDEX_NC  (Tablespace) 
--
CREATE BIGFILE TABLESPACE SBS1_MSCA_INDEX_NC DATAFILE 
  '+DATA' SIZE 35G AUTOEXTEND ON NEXT 1G MAXSIZE 100G
LOGGING
DEFAULT 
  NO INMEMORY
ONLINE
EXTENT MANAGEMENT LOCAL AUTOALLOCATE
BLOCKSIZE 8K
SEGMENT SPACE MANAGEMENT AUTO
FLASHBACK ON;


--
-- SBS1_SMSC_DATA_UC  (Tablespace) 
--
CREATE BIGFILE TABLESPACE SBS1_SMSC_DATA_UC DATAFILE 
  '+DATA' SIZE 70G AUTOEXTEND ON NEXT 1G MAXSIZE 200G
LOGGING
DEFAULT 
  NO INMEMORY
ONLINE
EXTENT MANAGEMENT LOCAL AUTOALLOCATE
BLOCKSIZE 8K
SEGMENT SPACE MANAGEMENT AUTO
FLASHBACK ON;


--
-- SBS1_SMSC_INDEX_UC  (Tablespace) 
--
CREATE BIGFILE TABLESPACE SBS1_SMSC_INDEX_UC DATAFILE 
  '+DATA' SIZE 43G AUTOEXTEND ON NEXT 1G MAXSIZE 128G
LOGGING
DEFAULT 
  NO INMEMORY
ONLINE
EXTENT MANAGEMENT LOCAL AUTOALLOCATE
BLOCKSIZE 8K
SEGMENT SPACE MANAGEMENT AUTO
FLASHBACK ON;


--
-- SBS1_SMSD_DATA_UC  (Tablespace) 
--
CREATE BIGFILE TABLESPACE SBS1_SMSD_DATA_UC DATAFILE 
  '+DATA' SIZE 100G AUTOEXTEND ON NEXT 1G MAXSIZE 200G
LOGGING
DEFAULT 
  NO INMEMORY
ONLINE
EXTENT MANAGEMENT LOCAL AUTOALLOCATE
BLOCKSIZE 8K
SEGMENT SPACE MANAGEMENT AUTO
FLASHBACK ON;


--
-- SBS1_SMSD_INDEX_UC  (Tablespace) 
--
CREATE BIGFILE TABLESPACE SBS1_SMSD_INDEX_UC DATAFILE 
  '+DATA' SIZE 33G AUTOEXTEND ON NEXT 1G MAXSIZE 128G
LOGGING
DEFAULT 
  NO INMEMORY
ONLINE
EXTENT MANAGEMENT LOCAL AUTOALLOCATE
BLOCKSIZE 8K
SEGMENT SPACE MANAGEMENT AUTO
FLASHBACK ON;


--
-- SBS1_USERS  (Tablespace) 
--
CREATE BIGFILE TABLESPACE SBS1_USERS DATAFILE 
  '+DATA' SIZE 16M AUTOEXTEND ON NEXT 16M MAXSIZE 150G
LOGGING
DEFAULT 
  NO INMEMORY
ONLINE
EXTENT MANAGEMENT LOCAL AUTOALLOCATE
BLOCKSIZE 8K
SEGMENT SPACE MANAGEMENT AUTO
FLASHBACK ON;


--
-- SBS1_USER_DATA  (Tablespace) 
--
CREATE BIGFILE TABLESPACE SBS1_USER_DATA DATAFILE 
  '+DATA' SIZE 16M AUTOEXTEND ON NEXT 16M MAXSIZE 10G
LOGGING
DEFAULT 
  NO INMEMORY
ONLINE
EXTENT MANAGEMENT LOCAL AUTOALLOCATE
BLOCKSIZE 8K
SEGMENT SPACE MANAGEMENT AUTO
FLASHBACK ON;


--
-- TEMP  (Tablespace) 
--
CREATE TEMPORARY TABLESPACE TEMP TEMPFILE 
  '+DATA' SIZE 32767M AUTOEXTEND OFF
TABLESPACE GROUP ''
EXTENT MANAGEMENT LOCAL UNIFORM SIZE 1M;


--
-- SBS1_ADMIN_P  (Profile) 
--
CREATE PROFILE SBS1_ADMIN_P LIMIT
  SESSIONS_PER_USER 10
  CPU_PER_SESSION DEFAULT
  CPU_PER_CALL DEFAULT
  CONNECT_TIME DEFAULT
  IDLE_TIME DEFAULT
  LOGICAL_READS_PER_SESSION DEFAULT
  LOGICAL_READS_PER_CALL DEFAULT
  COMPOSITE_LIMIT DEFAULT
  PRIVATE_SGA DEFAULT
  FAILED_LOGIN_ATTEMPTS DEFAULT
  PASSWORD_LIFE_TIME DEFAULT
  PASSWORD_REUSE_TIME DEFAULT
  PASSWORD_REUSE_MAX DEFAULT
  PASSWORD_LOCK_TIME DEFAULT
  PASSWORD_GRACE_TIME DEFAULT
  PASSWORD_VERIFY_FUNCTION DEFAULT;


--
-- APP_ADMIN_R  (Role) 
--
CREATE ROLE APP_ADMIN_R NOT IDENTIFIED;

-- System privileges granted to APP_ADMIN_R
GRANT CREATE PROCEDURE TO APP_ADMIN_R;
GRANT CREATE SEQUENCE TO APP_ADMIN_R;
GRANT CREATE SYNONYM TO APP_ADMIN_R;
GRANT CREATE TABLE TO APP_ADMIN_R;
GRANT CREATE TRIGGER TO APP_ADMIN_R;
GRANT CREATE TYPE TO APP_ADMIN_R;
GRANT CREATE VIEW TO APP_ADMIN_R;

-- Roles granted to APP_ADMIN_R
--
-- CONNECT  (Role) 
--
GRANT CONNECT TO APP_ADMIN_R;


--
-- DBM_ADMIN_CLIENT_R  (Role) 
--
CREATE ROLE DBM_ADMIN_CLIENT_R NOT IDENTIFIED;

-- Object privileges granted to DBM_ADMIN_CLIENT_R
GRANT SELECT ON DBM_ADMIN.DBM_CAUGHT_ERRORS TO DBM_ADMIN_CLIENT_R;


--
-- SBS_NAVIGATOR_R  (Role) 
--
CREATE ROLE SBS_NAVIGATOR_R NOT IDENTIFIED;

-- Roles granted to SBS_NAVIGATOR_R
--
-- SELECT_CATALOG_ROLE  (Role) 
--
GRANT SELECT_CATALOG_ROLE TO SBS_NAVIGATOR_R;


--
-- SBS1_ADMIN  (User) 
--
CREATE USER SBS1_ADMIN
  IDENTIFIED BY <password>
  DEFAULT TABLESPACE SBS1_APPLICATION_DATA
  TEMPORARY TABLESPACE TEMP
  PROFILE SBS1_ADMIN_P
  ACCOUNT UNLOCK;

-- 3 Roles for SBS1_ADMIN 
--
-- APP_ADMIN_R  (Role) 
--
GRANT APP_ADMIN_R TO SBS1_ADMIN;
--
-- DBM_ADMIN_CLIENT_R  (Role) 
--
GRANT DBM_ADMIN_CLIENT_R TO SBS1_ADMIN;
--
-- SBS_NAVIGATOR_R  (Role) 
--
GRANT SBS_NAVIGATOR_R TO SBS1_ADMIN;
ALTER USER SBS1_ADMIN DEFAULT ROLE ALL;

-- 1 System Privilege for SBS1_ADMIN 
GRANT CREATE TABLE TO SBS1_ADMIN;

-- 46 Tablespace Quotas for SBS1_ADMIN 
ALTER USER SBS1_ADMIN QUOTA UNLIMITED ON SBS1_INFO_INDEX_UC;
ALTER USER SBS1_ADMIN QUOTA UNLIMITED ON SBS1_BASE_DATA;
ALTER USER SBS1_ADMIN QUOTA UNLIMITED ON SBS1_SMSC_DATA_UC;
ALTER USER SBS1_ADMIN QUOTA UNLIMITED ON SBS1_APPLICATION_INDEX;
ALTER USER SBS1_ADMIN QUOTA UNLIMITED ON SBS1_SMSD_DATA_NC;
ALTER USER SBS1_ADMIN QUOTA UNLIMITED ON SBS1_MMSC_INDEX_HC;
ALTER USER SBS1_ADMIN QUOTA UNLIMITED ON SBS1_INFO_INDEX_NC;
ALTER USER SBS1_ADMIN QUOTA UNLIMITED ON SBS1_SMSC_INDEX_HC;
ALTER USER SBS1_ADMIN QUOTA UNLIMITED ON SBS1_MSCA_DATA_UC;
ALTER USER SBS1_ADMIN QUOTA UNLIMITED ON SBS1_SMSC_DATA_HC;
ALTER USER SBS1_ADMIN QUOTA UNLIMITED ON SBS1_ARCHIV_DATA_UC;
ALTER USER SBS1_ADMIN QUOTA UNLIMITED ON SBS1_INFO_DATA_QC;
ALTER USER SBS1_ADMIN QUOTA UNLIMITED ON SBS1_INFO_DATA_NC;
ALTER USER SBS1_ADMIN QUOTA UNLIMITED ON SBS1_APPLICATION_DATA;
ALTER USER SBS1_ADMIN QUOTA UNLIMITED ON SBS1_SMSC_INDEX_QC;
ALTER USER SBS1_ADMIN QUOTA UNLIMITED ON SBS1_INFO_DATA_HC;
ALTER USER SBS1_ADMIN QUOTA UNLIMITED ON SBS1_SMSD_INDEX_HC;
ALTER USER SBS1_ADMIN QUOTA UNLIMITED ON SBS1_SMSC_INDEX_NC;
ALTER USER SBS1_ADMIN QUOTA UNLIMITED ON SBS1_MSCA_INDEX_UC;
ALTER USER SBS1_ADMIN QUOTA UNLIMITED ON SBS1_INFO_DATA_UC;
ALTER USER SBS1_ADMIN QUOTA UNLIMITED ON SBS1_MMSC_DATA_NC;
ALTER USER SBS1_ADMIN QUOTA UNLIMITED ON SBS1_MSCA_DATA_NC;
ALTER USER SBS1_ADMIN QUOTA UNLIMITED ON SBS1_AUDIT_D;
ALTER USER SBS1_ADMIN QUOTA UNLIMITED ON SBS1_SMSC_DATA_NC;
ALTER USER SBS1_ADMIN QUOTA UNLIMITED ON SBS1_SMSD_DATA_HC;
ALTER USER SBS1_ADMIN QUOTA UNLIMITED ON SBS1_MSCA_INDEX_HC;
ALTER USER SBS1_ADMIN QUOTA UNLIMITED ON SBS1_MMSC_DATA_HC;
ALTER USER SBS1_ADMIN QUOTA UNLIMITED ON SBS1_SMSD_INDEX_QC;
ALTER USER SBS1_ADMIN QUOTA UNLIMITED ON SBS1_MMSC_INDEX_NC;
ALTER USER SBS1_ADMIN QUOTA UNLIMITED ON SBS1_SMSD_DATA_UC;
ALTER USER SBS1_ADMIN QUOTA UNLIMITED ON SBS1_SMSD_DATA_QC;
ALTER USER SBS1_ADMIN QUOTA UNLIMITED ON SBS1_MSCA_DATA_HC;
ALTER USER SBS1_ADMIN QUOTA UNLIMITED ON SBS1_ARCHIV_DATA_NC;
ALTER USER SBS1_ADMIN QUOTA UNLIMITED ON SBS1_USERS;
ALTER USER SBS1_ADMIN QUOTA UNLIMITED ON SBS1_MMSC_DATA_UC;
ALTER USER SBS1_ADMIN QUOTA UNLIMITED ON SBS1_ARCHIV_DATA;
ALTER USER SBS1_ADMIN QUOTA UNLIMITED ON SBS1_SMSC_INDEX_UC;
ALTER USER SBS1_ADMIN QUOTA UNLIMITED ON SBS1_BASE_INDEX;
ALTER USER SBS1_ADMIN QUOTA UNLIMITED ON SBS1_SMSD_INDEX_UC;
ALTER USER SBS1_ADMIN QUOTA UNLIMITED ON SBS1_USER_DATA;
ALTER USER SBS1_ADMIN QUOTA UNLIMITED ON SBS1_INFO_INDEX_HC;
ALTER USER SBS1_ADMIN QUOTA UNLIMITED ON SBS1_SMSD_INDEX_NC;
ALTER USER SBS1_ADMIN QUOTA UNLIMITED ON SBS1_MMSC_INDEX_UC;
ALTER USER SBS1_ADMIN QUOTA UNLIMITED ON SBS1_SMSC_DATA_QC;
ALTER USER SBS1_ADMIN QUOTA UNLIMITED ON SBS1_MSCA_INDEX_NC;
ALTER USER SBS1_ADMIN QUOTA UNLIMITED ON SBS1_INFO_INDEX_QC;

-- 112 Object Privileges for SBS1_ADMIN 
GRANT EXECUTE ON ADMIN.APP_CREATE_SYNONYM TO SBS1_ADMIN;
GRANT EXECUTE ON ADMIN.APP_ENFORCE_OBJECT_GRANTS TO SBS1_ADMIN;
GRANT SELECT ON ADMIN.APP_PERMISSION TO SBS1_ADMIN;
GRANT EXECUTE ON ADMIN.KILL_SESSION TO SBS1_ADMIN;
GRANT SELECT ON DBM_ADMIN.DBM_CAUGHT_ERRORS TO SBS1_ADMIN;
GRANT SELECT ON DBM_ADMIN.DBM_SERVICE_V$SESSION TO SBS1_ADMIN;
GRANT SELECT ON DBM_ADMIN.DBM_SQL_COMMANDS TO SBS1_ADMIN;
GRANT EXECUTE ON DBM_ADMIN.DYNSQL TO SBS1_ADMIN;
GRANT SELECT ON DBM_ADMIN.SQL_COMMANDS TO SBS1_ADMIN;
GRANT EXECUTE ON SBS0_ADMIN.AAA_AGE_PROFILE TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS0_ADMIN.AAABLEVEL TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS0_ADMIN.AAABP TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS0_ADMIN.AAABPSTATE TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS0_ADMIN.AAABPTYPE TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS0_ADMIN.AAACACHE TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS0_ADMIN.AAACBSS TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS0_ADMIN.AAACUSTBAR TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS0_ADMIN.AAAIMPORT TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS0_ADMIN.AAAISTATE TO SBS1_ADMIN WITH GRANT OPTION;
GRANT EXECUTE ON SBS0_ADMIN.AAA_LAST_BULK_BIHID TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS0_ADMIN.AAALOG TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS0_ADMIN.AAAMESSAGETYPE TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS0_ADMIN.AAAREQTYPE TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS0_ADMIN.AAASCAP TO SBS1_ADMIN WITH GRANT OPTION;
GRANT EXECUTE ON SBS0_ADMIN.AAASC_EVAL TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS0_ADMIN.AAASCI TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS0_ADMIN.AAASCL TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS0_ADMIN.AAASCM TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS0_ADMIN.AAASCMS TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS0_ADMIN.AAASCO TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS0_ADMIN.AAASCP TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS0_ADMIN.AAASCPAGEBASE TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS0_ADMIN.AAASCPAGEFORM TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS0_ADMIN.AAASCPSIIDS TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS0_ADMIN.AAASCPU TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS0_ADMIN.AAASCS TO SBS1_ADMIN WITH GRANT OPTION;
GRANT EXECUTE ON SBS0_ADMIN.AAASCSDEFAULT TO SBS1_ADMIN WITH GRANT OPTION;
GRANT EXECUTE ON SBS0_ADMIN.AAASC_SIIDS TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS0_ADMIN.AAASCSTYPE TO SBS1_ADMIN WITH GRANT OPTION;
GRANT EXECUTE ON SBS0_ADMIN.AAASC_TICKLER TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS0_ADMIN.AAASELECTION TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS0_ADMIN.AAASELECTION_RESULT TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS0_ADMIN.AAASELECTION_STATS TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS0_ADMIN.AAASYNCLOG TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS0_ADMIN.AAASYNCPRIO TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS0_ADMIN.AAASYNCTEXT TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS0_ADMIN.AAATEXTTYPE TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS0_ADMIN.AAATINLOG TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS0_ADMIN.AAATOPSTOP_EXTRAP TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS0_ADMIN.AAATOPSTOP_LAST TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS0_ADMIN.AAATOPSTOP_OVER TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS0_ADMIN.AAATRACKING TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS0_ADMIN.AAATSTATE TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS0_ADMIN.AAAULEVEL TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS0_ADMIN.HBHEADER TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS0_ADMIN.HIHEADER TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS0_ADMIN.HIMISSING TO SBS1_ADMIN WITH GRANT OPTION;
GRANT EXECUTE ON SBS0_ADMIN.PKG_AAA_HB TO SBS1_ADMIN WITH GRANT OPTION;
GRANT EXECUTE ON SBS0_ADMIN.PKG_AAA_PROV_WEB TO SBS1_ADMIN WITH GRANT OPTION;
GRANT EXECUTE ON SBS0_ADMIN.PKG_AAA_PROV_WS TO SBS1_ADMIN WITH GRANT OPTION;
GRANT EXECUTE ON SBS0_ADMIN.PKG_AAA_SIS TO SBS1_ADMIN WITH GRANT OPTION;
GRANT EXECUTE ON SBS0_ADMIN.PKG_AAA_TICKLER TO SBS1_ADMIN WITH GRANT OPTION;
GRANT EXECUTE ON SBS0_ADMIN.PKG_CONSOL_SOX TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS0_ADMIN.SICACHE TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS0_ADMIN.SICPM TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS0_ADMIN.SISNOTLOG TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS0_ADMIN.SR033A_DETAILS TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS0_ADMIN.SR033A_DETAILS_WINGO TO SBS1_ADMIN;
GRANT SELECT ON SBS0_ADMIN.SR062A_ALL TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS0_ADMIN.SR062A_BASE TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS0_ADMIN.SR062A_DETAILS TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS0_ADMIN.SR062A_MISSING TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS0_ADMIN.WARNING TO SBS1_ADMIN WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE ON SBS2_ADMIN.BDCSTATUS TO SBS1_ADMIN;
GRANT SELECT ON SBS2_ADMIN.BDETAIL_TRLOG TO SBS1_ADMIN;
GRANT SELECT ON SBS2_ADMIN.BD6CUCIDXB TO SBS1_ADMIN;
GRANT SELECT ON SBS2_ADMIN.BD6CUCIDXBE TO SBS1_ADMIN;
GRANT SELECT ON SBS2_ADMIN.BIHEADER TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS2_ADMIN.DATA_PARTITIONS_CUC TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS2_ADMIN.ILPLOG TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS2_ADMIN.MAY_USE_DAY_PARTITIONS TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS2_ADMIN.MMCA_OBJECTS TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS2_ADMIN.MMCA_TRAUD TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS2_ADMIN.MMCA_TRCMN TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS2_ADMIN.MMCA_TRIMG TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS2_ADMIN.MMCA_TRLOG TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS2_ADMIN.MMCA_TRVID TO SBS1_ADMIN WITH GRANT OPTION;
GRANT EXECUTE ON SBS2_ADMIN.PKG_BDETAIL_CUCM TO SBS1_ADMIN WITH GRANT OPTION;
GRANT EXECUTE ON SBS2_ADMIN.PKG_BDETAIL_MMCA TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS2_ADMIN.SR063A_DETAILS_1 TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS2_ADMIN.SR063A_DETAILS_2 TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS2_ADMIN.SR063A_DETAILS_3 TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS2_ADMIN.SR063A_DETAILS_4 TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS2_ADMIN.SR070A_DETAILS_1 TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS2_ADMIN.SR070A_DETAILS_2 TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS2_ADMIN.SR070A_DETAILS_3 TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS2_ADMIN.SR070A_DETAILS_4 TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS2_ADMIN.SR072A_DETAILS TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS2_ADMIN.SR086A_BASE_1 TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS2_ADMIN.SR086A_BASE_3 TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS2_ADMIN.SR086A_BASE_3_A TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS2_ADMIN.SR086A_BASE_3_B TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS2_ADMIN.SR086A_CTRL_2 TO SBS1_ADMIN WITH GRANT OPTION;
GRANT SELECT ON SBS2_ADMIN.SR086A_CTRL_3 TO SBS1_ADMIN WITH GRANT OPTION;
GRANT EXECUTE ON SYS.BATCH_GROUP TO SBS1_ADMIN;
GRANT EXECUTE ON SYS.DBMS_CRYPTO TO SBS1_ADMIN;
GRANT EXECUTE ON SYS.DBMS_LOCK TO SBS1_ADMIN;
GRANT EXECUTE ON SYS.DSS_CRITICAL_GROUP TO SBS1_ADMIN;
GRANT EXECUTE ON SYS.INTERACTIVE_GROUP TO SBS1_ADMIN;
GRANT EXECUTE ON SYS.MAINTENANCE_GROUP TO SBS1_ADMIN;
GRANT EXECUTE ON SYS.SBS_CREATE_SYNONYM TO SBS1_ADMIN;
GRANT EXECUTE ON SYS.SBS1_JOB_CLASS TO SBS1_ADMIN;

-- 4 Resoure Group Privileges for SBS1_ADMIN 
BEGIN
  SYS.DBMS_RESOURCE_MANAGER.clear_pending_area();
  SYS.DBMS_RESOURCE_MANAGER.create_pending_area();
  SYS.DBMS_RESOURCE_MANAGER_PRIVS.GRANT_SWITCH_CONSUMER_GROUP
    ('SBS1_ADMIN','BATCH_GROUP',FALSE);
  SYS.DBMS_RESOURCE_MANAGER.submit_pending_area();
END;
/
BEGIN
  SYS.DBMS_RESOURCE_MANAGER.clear_pending_area();
  SYS.DBMS_RESOURCE_MANAGER.create_pending_area();
  SYS.DBMS_RESOURCE_MANAGER_PRIVS.GRANT_SWITCH_CONSUMER_GROUP
    ('SBS1_ADMIN','DSS_CRITICAL_GROUP',FALSE);
  SYS.DBMS_RESOURCE_MANAGER.submit_pending_area();
END;
/
BEGIN
  SYS.DBMS_RESOURCE_MANAGER.clear_pending_area();
  SYS.DBMS_RESOURCE_MANAGER.create_pending_area();
  SYS.DBMS_RESOURCE_MANAGER_PRIVS.GRANT_SWITCH_CONSUMER_GROUP
    ('SBS1_ADMIN','INTERACTIVE_GROUP',FALSE);
  SYS.DBMS_RESOURCE_MANAGER.submit_pending_area();
END;
/
BEGIN
  SYS.DBMS_RESOURCE_MANAGER.clear_pending_area();
  SYS.DBMS_RESOURCE_MANAGER.create_pending_area();
  SYS.DBMS_RESOURCE_MANAGER_PRIVS.GRANT_SWITCH_CONSUMER_GROUP
    ('SBS1_ADMIN','MAINTENANCE_GROUP',FALSE);
  SYS.DBMS_RESOURCE_MANAGER.submit_pending_area();
END;
/
BEGIN
  SYS.DBMS_RESOURCE_MANAGER.SET_INITIAL_CONSUMER_GROUP
    ('SBS1_ADMIN','MAINTENANCE_GROUP');
END;
/


--
-- T_TEXT_ROW  (Type) 
--
CREATE OR REPLACE TYPE SBS1_ADMIN.T_TEXT_ROW AS OBJECT (text_line  VARCHAR2(4000));
/


--
-- T_TEXT_TAB  (Type) 
--
CREATE OR REPLACE TYPE SBS1_ADMIN.T_TEXT_TAB IS TABLE OF T_TEXT_ROW;
/


--
-- BDETAIL_SEQ  (Sequence) 
--
CREATE SEQUENCE SBS1_ADMIN.BDETAIL_SEQ
  START WITH 600304405
  MAXVALUE 999999999999999999999999999
  MINVALUE 1
  NOCYCLE
  CACHE 20
  NOORDER
  NOKEEP
  GLOBAL;


--
-- BDKPI_SEQ  (Sequence) 
--
CREATE SEQUENCE SBS1_ADMIN.BDKPI_SEQ
  START WITH 1500401
  MAXVALUE 999999999999999999999999999
  MINVALUE 1
  NOCYCLE
  CACHE 100
  NOORDER
  NOKEEP
  GLOBAL;


--
-- BD6CUC_TEMP_SEQ  (Sequence) 
--
CREATE SEQUENCE SBS1_ADMIN.BD6CUC_TEMP_SEQ
  START WITH 224001
  MAXVALUE 999999999999999999999999999
  MINVALUE 1
  NOCYCLE
  CACHE 200
  NOORDER
  NOKEEP
  GLOBAL;


--
-- DBSS_LOG_SEQ  (Sequence) 
--
CREATE SEQUENCE SBS1_ADMIN.DBSS_LOG_SEQ
  START WITH 1
  MAXVALUE 999999999999999999999999999
  MINVALUE 1
  NOCYCLE
  CACHE 20
  NOORDER
  NOKEEP
  GLOBAL;


--
-- GENERAL_SEQ  (Sequence) 
--
CREATE SEQUENCE SBS1_ADMIN.GENERAL_SEQ
  START WITH 1051805580
  MAXVALUE 999999999999999999999999999
  MINVALUE 1
  NOCYCLE
  CACHE 20
  NOORDER
  NOKEEP
  GLOBAL;


--
-- LONGIDHIST_SEQ  (Sequence) 
--
CREATE SEQUENCE SBS1_ADMIN.LONGIDHIST_SEQ
  START WITH 583990
  MAXVALUE 999999999999999999999999999
  MINVALUE 1
  NOCYCLE
  CACHE 20
  NOORDER
  NOKEEP
  GLOBAL;


--
-- SMP_VDD_OP_SEQ  (Sequence) 
--
CREATE SEQUENCE SBS1_ADMIN.SMP_VDD_OP_SEQ
  START WITH 2
  MAXVALUE 9999999999999999999999999999
  MINVALUE 1
  CYCLE
  NOCACHE
  NOORDER
  NOKEEP
  GLOBAL;


--
-- SMP_VDE_EVENT_ARCHIVE_SEQ  (Sequence) 
--
CREATE SEQUENCE SBS1_ADMIN.SMP_VDE_EVENT_ARCHIVE_SEQ
  START WITH 1
  MAXVALUE 2147483647
  MINVALUE 1
  CYCLE
  CACHE 50
  ORDER
  NOKEEP
  GLOBAL;


--
-- SMP_VDE_EVENT_OCCURRENCE_SEQ  (Sequence) 
--
CREATE SEQUENCE SBS1_ADMIN.SMP_VDE_EVENT_OCCURRENCE_SEQ
  START WITH 1
  MAXVALUE 2147483647
  MINVALUE 1
  NOCYCLE
  CACHE 5
  NOORDER
  NOKEEP
  GLOBAL;


--
-- SMP_VDE_EVENT_SEQ  (Sequence) 
--
CREATE SEQUENCE SBS1_ADMIN.SMP_VDE_EVENT_SEQ
  START WITH 1
  MAXVALUE 2147483647
  MINVALUE 1
  NOCYCLE
  CACHE 5
  NOORDER
  NOKEEP
  GLOBAL;


--
-- SMP_VDE_METRIC_THRESHOLDS_SEQ  (Sequence) 
--
CREATE SEQUENCE SBS1_ADMIN.SMP_VDE_METRIC_THRESHOLDS_SEQ
  START WITH 1000
  MAXVALUE 999999999999999999999999999
  MINVALUE 1
  NOCYCLE
  CACHE 20
  NOORDER
  NOKEEP
  GLOBAL;


--
-- SMP_VDE_NODE_UPDOWN_SEQ  (Sequence) 
--
CREATE SEQUENCE SBS1_ADMIN.SMP_VDE_NODE_UPDOWN_SEQ
  START WITH 1
  MAXVALUE 2147483647
  MINVALUE 1
  CYCLE
  CACHE 5
  NOORDER
  NOKEEP
  GLOBAL;


--
-- SMP_VDE_TRY_REMOVE_EVENT_SEQ  (Sequence) 
--
CREATE SEQUENCE SBS1_ADMIN.SMP_VDE_TRY_REMOVE_EVENT_SEQ
  START WITH 1
  MAXVALUE 2147483647
  MINVALUE 1
  CYCLE
  CACHE 5
  NOORDER
  NOKEEP
  GLOBAL;


--
-- SMP_VDJ_JOB_ID_SEQ  (Sequence) 
--
CREATE SEQUENCE SBS1_ADMIN.SMP_VDJ_JOB_ID_SEQ
  START WITH 100
  MAXVALUE 999999999999999999999999999
  MINVALUE 1
  NOCYCLE
  NOCACHE
  NOORDER
  NOKEEP
  GLOBAL;


--
-- SMP_VDJ_JOB_OUTPUT_SEQ  (Sequence) 
--
CREATE SEQUENCE SBS1_ADMIN.SMP_VDJ_JOB_OUTPUT_SEQ
  START WITH 2200
  MAXVALUE 999999999999999999999999999
  MINVALUE 1
  NOCYCLE
  NOCACHE
  NOORDER
  NOKEEP
  GLOBAL;


--
-- SMP_VDM_PAGING_CRR_ID_SEQ  (Sequence) 
--
CREATE SEQUENCE SBS1_ADMIN.SMP_VDM_PAGING_CRR_ID_SEQ
  START WITH 1
  MAXVALUE 999999999999999999999999999
  MINVALUE 1
  NOCYCLE
  CACHE 20
  NOORDER
  NOKEEP
  GLOBAL;


--
-- SMP_VDM_SEQUENCE_NUM  (Sequence) 
--
CREATE SEQUENCE SBS1_ADMIN.SMP_VDM_SEQUENCE_NUM
  START WITH 1
  MAXVALUE 9999999999999999999999999999
  MINVALUE 1
  CYCLE
  CACHE 10
  NOORDER
  NOKEEP
  GLOBAL;


--
-- SMP_VDN_GROUP_LIST_SEQ  (Sequence) 
--
CREATE SEQUENCE SBS1_ADMIN.SMP_VDN_GROUP_LIST_SEQ
  START WITH 1
  MAXVALUE 999999999999999999999999999
  MINVALUE 1
  NOCYCLE
  CACHE 20
  NOORDER
  NOKEEP
  GLOBAL;


--
-- SMP_VDN_TARGET_LIST_SEQ  (Sequence) 
--
CREATE SEQUENCE SBS1_ADMIN.SMP_VDN_TARGET_LIST_SEQ
  START WITH 1
  MAXVALUE 999999999999999999999999999
  MINVALUE 1
  NOCYCLE
  CACHE 20
  NOORDER
  NOKEEP
  GLOBAL;


--
-- SMP_VDN_TARGET_TYPE_DEFN_SEQ  (Sequence) 
--
CREATE SEQUENCE SBS1_ADMIN.SMP_VDN_TARGET_TYPE_DEFN_SEQ
  START WITH 21
  MAXVALUE 999999999999999999999999999
  MINVALUE 1
  NOCYCLE
  CACHE 20
  NOORDER
  NOKEEP
  GLOBAL;


--
-- SMP_VDP_REGION_ID_SEQ  (Sequence) 
--
CREATE SEQUENCE SBS1_ADMIN.SMP_VDP_REGION_ID_SEQ
  START WITH 21
  MAXVALUE 9999999999999999999999999999
  MINVALUE 1
  NOCYCLE
  CACHE 20
  NOORDER
  NOKEEP
  GLOBAL;


--
-- SMP_VDS_SESSIONS_SEQUENCE  (Sequence) 
--
CREATE SEQUENCE SBS1_ADMIN.SMP_VDS_SESSIONS_SEQUENCE
  START WITH 1
  MAXVALUE 999999999999999999999999999
  MINVALUE 1
  NOCYCLE
  CACHE 20
  NOORDER
  NOKEEP
  GLOBAL;


--
-- SMP_VDU_OBJECTS_SEQUENCE  (Sequence) 
--
CREATE SEQUENCE SBS1_ADMIN.SMP_VDU_OBJECTS_SEQUENCE
  START WITH 21
  MAXVALUE 999999999999999999999999999
  MINVALUE 1
  NOCYCLE
  CACHE 20
  NOORDER
  NOKEEP
  GLOBAL;


--
-- SMP_VDU_PRINCIPALS_SEQUENCE  (Sequence) 
--
CREATE SEQUENCE SBS1_ADMIN.SMP_VDU_PRINCIPALS_SEQUENCE
  START WITH 21
  MAXVALUE 999999999999999999999999999
  MINVALUE 1
  NOCYCLE
  CACHE 20
  NOORDER
  NOKEEP
  GLOBAL;


--
-- TEST_SEQ  (Sequence) 
--
CREATE SEQUENCE SBS1_ADMIN.TEST_SEQ
  START WITH 60702311
  MAXVALUE 999999999999999999999999999
  MINVALUE 1
  NOCYCLE
  CACHE 20
  NOORDER
  NOKEEP
  GLOBAL;


--
-- ACSTATE  (Table) 
--
CREATE TABLE SBS1_ADMIN.ACSTATE
(
  ACS_ID      VARCHAR2(10 BYTE)                 NOT NULL,
  ACS_CODE    VARCHAR2(10 BYTE)                 NOT NULL,
  ACS_LANG01  VARCHAR2(100 BYTE),
  ACS_LANG02  VARCHAR2(100 BYTE),
  ACS_LANG03  VARCHAR2(100 BYTE),
  ACS_LANG04  VARCHAR2(100 BYTE),
  ACS_VALUE1  VARCHAR2(100 BYTE),
  ACS_VALUE2  VARCHAR2(100 BYTE),
  ACS_VALUE3  VARCHAR2(100 BYTE),
  ACS_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.ACSTATE IS 'Account state';


--
-- ACTYPE  (Table) 
--
CREATE TABLE SBS1_ADMIN.ACTYPE
(
  ACT_ID           VARCHAR2(10 BYTE)            NOT NULL,
  ACT_CODE         VARCHAR2(10 BYTE)            NOT NULL,
  ACT_LANG01       VARCHAR2(100 BYTE),
  ACT_LANG02       VARCHAR2(100 BYTE),
  ACT_LANG03       VARCHAR2(100 BYTE),
  ACT_LANG04       VARCHAR2(100 BYTE),
  ACT_VALUE1       VARCHAR2(100 BYTE),
  ACT_VALUE2       VARCHAR2(100 BYTE),
  ACT_VALUE3       VARCHAR2(100 BYTE),
  ACT_VALUE4       VARCHAR2(100 BYTE),
  ACT_SHOWCENTRUM  NUMBER(1)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.ACTYPE IS 'Account type';


--
-- ADRSTATE  (Table) 
--
CREATE TABLE SBS1_ADMIN.ADRSTATE
(
  ADRS_ID      VARCHAR2(10 BYTE)                NOT NULL,
  ADRS_CODE    VARCHAR2(10 BYTE)                NOT NULL,
  ADRS_LANG01  VARCHAR2(100 BYTE),
  ADRS_LANG02  VARCHAR2(100 BYTE),
  ADRS_LANG03  VARCHAR2(100 BYTE),
  ADRS_LANG04  VARCHAR2(100 BYTE),
  ADRS_VALUE1  VARCHAR2(100 BYTE),
  ADRS_VALUE2  VARCHAR2(100 BYTE),
  ADRS_VALUE3  VARCHAR2(100 BYTE),
  ADRS_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.ADRSTATE IS 'Address state';


--
-- ADRTYPE  (Table) 
--
CREATE TABLE SBS1_ADMIN.ADRTYPE
(
  ADRT_ID      VARCHAR2(10 BYTE)                NOT NULL,
  ADRT_CODE    VARCHAR2(10 BYTE)                NOT NULL,
  ADRT_LANG01  VARCHAR2(100 BYTE),
  ADRT_LANG02  VARCHAR2(100 BYTE),
  ADRT_LANG03  VARCHAR2(100 BYTE),
  ADRT_LANG04  VARCHAR2(100 BYTE),
  ADRT_VALUE1  VARCHAR2(100 BYTE),
  ADRT_VALUE2  VARCHAR2(100 BYTE),
  ADRT_VALUE3  VARCHAR2(100 BYTE),
  ADRT_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.ADRTYPE IS 'Adress type';


--
-- ALL_CC_NDC  (Table) 
--
CREATE TABLE SBS1_ADMIN.ALL_CC_NDC
(
  ACNDC_NBR      VARCHAR2(20 BYTE)              NOT NULL,
  ACNDC_COUNTRY  VARCHAR2(100 BYTE)             NOT NULL,
  ACNDC_OPNAME   VARCHAR2(100 BYTE)             NOT NULL,
  ACNDC_OPKEY    VARCHAR2(20 BYTE)              NOT NULL
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    30
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          104K
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.ALL_CC_NDC IS 'ALL_CC_NDC';


--
-- ALL_MCC_MNC  (Table) 
--
CREATE TABLE SBS1_ADMIN.ALL_MCC_MNC
(
  AMCMNC_MCC        VARCHAR2(10 BYTE)           NOT NULL,
  AMCMNC_MNC        VARCHAR2(10 BYTE)           NOT NULL,
  AMCMNC_COUNTRY    VARCHAR2(100 BYTE)          NOT NULL,
  AMCMNC_OPNAME     VARCHAR2(100 BYTE)          NOT NULL,
  AMCMNC_OPKEY      VARCHAR2(10 BYTE)           NOT NULL,
  AMCMNC_STARTDATE  VARCHAR2(20 BYTE),
  AMCMNC_CEASEDATE  VARCHAR2(20 BYTE)
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    30
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          104K
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.ALL_MCC_MNC IS 'ALL_MCC_MNC';

COMMENT ON COLUMN SBS1_ADMIN.ALL_MCC_MNC.AMCMNC_MCC IS 'all mcc';

COMMENT ON COLUMN SBS1_ADMIN.ALL_MCC_MNC.AMCMNC_MNC IS 'all mnc';

COMMENT ON COLUMN SBS1_ADMIN.ALL_MCC_MNC.AMCMNC_COUNTRY IS 'all country name';

COMMENT ON COLUMN SBS1_ADMIN.ALL_MCC_MNC.AMCMNC_OPNAME IS 'all operator name';

COMMENT ON COLUMN SBS1_ADMIN.ALL_MCC_MNC.AMCMNC_OPKEY IS 'all operator key';

COMMENT ON COLUMN SBS1_ADMIN.ALL_MCC_MNC.AMCMNC_STARTDATE IS 'all start date';

COMMENT ON COLUMN SBS1_ADMIN.ALL_MCC_MNC.AMCMNC_CEASEDATE IS 'all cease date';


--
-- APP_PERMISSION  (Table) 
--
CREATE TABLE SBS1_ADMIN.APP_PERMISSION
(
  APP_PERM_ID    VARCHAR2(40 BYTE)              NOT NULL,
  APP_PERM_NAME  VARCHAR2(40 BYTE)              NOT NULL
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.APP_PERMISSION IS 'Table used to maintain Application Permissions.

';


--
-- APP_TOKEN  (Table) 
--
CREATE TABLE SBS1_ADMIN.APP_TOKEN
(
  TOKEN        VARCHAR2(40 BYTE),
  TOKEN_COUNT  NUMBER(10)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.APP_TOKEN IS 'Table used to temporarily store word count analysis results on source code.

Used in procedure APP_MERGE_GRANTS
';


--
-- BDBSTATE  (Table) 
--
CREATE TABLE SBS1_ADMIN.BDBSTATE
(
  BDBS_ID      VARCHAR2(1 BYTE)                 NOT NULL,
  BDBS_CODE    VARCHAR2(10 BYTE)                NOT NULL,
  BDBS_LANG01  VARCHAR2(100 BYTE),
  BDBS_LANG02  VARCHAR2(100 BYTE),
  BDBS_LANG03  VARCHAR2(100 BYTE),
  BDBS_LANG04  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.BDBSTATE IS 'SBS billing state';


--
-- BDCSTATE  (Table) 
--
CREATE TABLE SBS1_ADMIN.BDCSTATE
(
  BDCS_ID      VARCHAR2(10 BYTE)                NOT NULL,
  BDCS_CODE    VARCHAR2(10 BYTE)                NOT NULL,
  BDCS_LANG01  VARCHAR2(100 BYTE),
  BDCS_LANG02  VARCHAR2(100 BYTE),
  BDCS_LANG03  VARCHAR2(100 BYTE),
  BDCS_LANG04  VARCHAR2(100 BYTE),
  BDCS_VALUE1  VARCHAR2(100 BYTE),
  BDCS_VALUE2  VARCHAR2(100 BYTE),
  BDCS_VALUE3  VARCHAR2(100 BYTE),
  BDCS_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.BDCSTATE IS 'Bd consolidation state';


--
-- BDCTYPE  (Table) 
--
CREATE TABLE SBS1_ADMIN.BDCTYPE
(
  BDCT_ID      VARCHAR2(10 BYTE)                NOT NULL,
  BDCT_CODE    VARCHAR2(10 BYTE)                NOT NULL,
  BDCT_LANG01  VARCHAR2(100 BYTE),
  BDCT_LANG02  VARCHAR2(100 BYTE),
  BDCT_LANG03  VARCHAR2(100 BYTE),
  BDCT_LANG04  VARCHAR2(100 BYTE),
  BDCT_VALUE1  VARCHAR2(100 BYTE),
  BDCT_VALUE2  VARCHAR2(100 BYTE),
  BDCT_VALUE3  VARCHAR2(100 BYTE),
  BDCT_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.BDCTYPE IS 'Bd consolidation type';


--
-- BDETAIL_MONITOR  (Table) 
--
CREATE TABLE SBS1_ADMIN.BDETAIL_MONITOR
(
  PARTNAME   VARCHAR2(32 BYTE),
  FK_CREATE  VARCHAR2(1 BYTE)
)
TABLESPACE SBS1_USER_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;


--
-- BDETAIL1_20171026  (Table) 
--
CREATE TABLE SBS1_ADMIN.BDETAIL1_20171026
(
  BD_ID                VARCHAR2(10 BYTE),
  BD_SRCTYPE           VARCHAR2(10 BYTE)        NOT NULL,
  BD_DATETIME          DATE                     NOT NULL,
  BD_DEMO              NUMBER(1)                NOT NULL,
  BD_BIHID             VARCHAR2(10 BYTE)        NOT NULL,
  BD_MAPSID            VARCHAR2(1 BYTE)         NOT NULL,
  BD_BIRECNO           NUMBER(8)                NOT NULL,
  BD_BOHID1            VARCHAR2(10 BYTE),
  BD_PACSID1           VARCHAR2(1 BYTE),
  BD_BORECNO1          NUMBER(8),
  BD_BOHID2            VARCHAR2(10 BYTE),
  BD_PACSID2           VARCHAR2(1 BYTE),
  BD_BORECNO2          NUMBER(8),
  BD_BOHID3            VARCHAR2(10 BYTE),
  BD_PACSID3           VARCHAR2(1 BYTE),
  BD_BORECNO3          NUMBER(8),
  BD_CONID             VARCHAR2(10 BYTE),
  BD_PMVID             VARCHAR2(10 BYTE),
  BD_TARID             VARCHAR2(1 BYTE),
  BD_NPI_A             VARCHAR2(3 BYTE),
  BD_TON_A             VARCHAR2(3 BYTE),
  BD_PID_A             VARCHAR2(3 BYTE),
  BD_MSISDN_A          VARCHAR2(20 BYTE),
  BD_TON_B             VARCHAR2(3 BYTE),
  BD_NPI_B             VARCHAR2(3 BYTE),
  BD_PID_B             VARCHAR2(3 BYTE),
  BD_MSISDN_B          VARCHAR2(20 BYTE),
  BD_IMSI              VARCHAR2(20 BYTE),
  BD_LENGTH            NUMBER(4),
  BD_PREPAID           VARCHAR2(1 BYTE),
  BD_NETWORK           NUMBER(2),
  BD_NODENAME          VARCHAR2(20 BYTE),
  BD_SERVICE           VARCHAR2(10 BYTE),
  BD_SHORTID           VARCHAR2(6 BYTE),
  BD_ITEMNO            NUMBER(4),
  BD_KEYWORD           VARCHAR2(80 BYTE),
  BD_LANGID            VARCHAR2(2 BYTE),
  BD_REQTYPE           NUMBER(4),
  BD_BILLRATE          NUMBER(3),
  BD_AMOUNTCU          NUMBER(9,4),
  BD_RETSHAREPV        NUMBER(9,4),
  BD_RETSHAREMO        NUMBER(9,4),
  BD_VSMSCID           VARCHAR2(20 BYTE),
  BD_CONSOLIDATION     VARCHAR2(6 BYTE),
  BD_STATUS            NUMBER(2),
  BD_TERMDATE          DATE,
  BD_SETTLING          NUMBER(1),
  BD_SETID             VARCHAR2(10 BYTE),
  BD_STORAGE           NUMBER(1),
  BD_DBIDSTORE         VARCHAR2(2 BYTE),
  BD_DATESTORE         DATE,
  BD_ARCHIVE           NUMBER(1),
  BD_DBIDARCH          VARCHAR2(2 BYTE),
  BD_DATEARCH          DATE,
  BD_REQUESTID         NUMBER(10),
  BD_RECTYPE           NUMBER(2),
  BD_IDENTITY          VARCHAR2(10 BYTE),
  BD_REQSERV           VARCHAR2(3 BYTE),
  BD_SUBSERV           VARCHAR2(3 BYTE),
  BD_OPERATION         VARCHAR2(3 BYTE),
  BD_MULTSM            NUMBER(1),
  BD_SMSEQ             NUMBER(2),
  BD_ANSTYPE           NUMBER(2),
  BD_RETCODE           NUMBER(2),
  BD_RESPMEDIA         NUMBER(1),
  BD_SMSCRESP          NUMBER(1),
  BD_TMINODE           VARCHAR2(10 BYTE),
  BD_REQID             NUMBER(10),
  BD_SERVKEY           VARCHAR2(6 BYTE),
  BD_TOCID             VARCHAR2(10 BYTE),
  BD_IOT               NUMBER(9,4),
  BD_INT               VARCHAR2(1 BYTE),
  BD_OGTI              VARCHAR2(20 BYTE),
  BD_ZNID              VARCHAR2(10 BYTE),
  BD_CDRTID            VARCHAR2(10 BYTE),
  BD_IW                VARCHAR2(1 BYTE),
  BD_ERRID             VARCHAR2(10 BYTE),
  BD_BILLED            VARCHAR2(1 BYTE),
  BD_RATED             VARCHAR2(1 BYTE),
  BD_PACIDHB           VARCHAR2(10 BYTE),
  BD_OUTPUTHB          VARCHAR2(4000 BYTE),
  BD_AMOUNTTR          NUMBER(9,4),
  BD_ORIGSUBMIT        DATE,
  BD_BILLID            VARCHAR2(20 BYTE),
  BD_VSPRCID           VARCHAR2(10 BYTE),
  BD_ONLINECHARGE      NUMBER(9,4),
  BD_MESSAGEREFERENCE  VARCHAR2(40 BYTE),
  BD_DGTI              VARCHAR2(20 BYTE),
  BD_SMSCID            VARCHAR2(10 BYTE),
  BD_ORIGINATORIMSI    VARCHAR2(20 BYTE),
  BD_PPPSER            VARCHAR2(40 BYTE),
  BD_DSER              VARCHAR2(40 BYTE),
  BD_ORIGSCA           VARCHAR2(40 BYTE),
  BD_GENERATED         NUMBER(1),
  BD_SUBMIT_US         NUMBER(6),
  BD_SUBMIT_GT         VARCHAR2(20 BYTE),
  BD_SUBMIT_APP        VARCHAR2(20 BYTE),
  BD_ORIG_CHARSET      NUMBER(1),
  BD_ORIG_ESME_ID      VARCHAR2(6 BYTE),
  BD_ORIG_IP           VARCHAR2(50 BYTE),
  BD_DELIVER_ADR       VARCHAR2(20 BYTE),
  BD_DELIVER_TON       VARCHAR2(3 BYTE),
  BD_DELIVER_NPI       VARCHAR2(3 BYTE),
  BD_DELIVER_ESME_ID   VARCHAR2(6 BYTE),
  BD_DELIVER_IP        VARCHAR2(50 BYTE),
  BD_MSGREQTYPE        NUMBER(10),
  BD_MSGSCHEDULETIME   DATE,
  BD_MSGEXPIRYTIME     DATE,
  BD_SEG_ID            NUMBER(3),
  BD_SEG_COUNT         NUMBER(3),
  BD_ERR_TYPE          VARCHAR2(10 BYTE),
  BD_ERR_CODE          VARCHAR2(10 BYTE),
  BD_DIA_RESULT        VARCHAR2(10 BYTE),
  BD_RECIP_IMSI        VARCHAR2(20 BYTE),
  BD_RECIP_ADR         VARCHAR2(254 BYTE),
  BD_RECIP_TON         VARCHAR2(3 BYTE),
  BD_RECIP_NPI         VARCHAR2(3 BYTE),
  BD_OGTI_OPKEY        VARCHAR2(10 BYTE),
  BD_DELIVER_OPKEY     VARCHAR2(10 BYTE),
  BD_SCA_OPKEY         VARCHAR2(10 BYTE),
  BD_ORIG_DCS          NUMBER(3),
  BD_ORIG_MSG_ID       VARCHAR2(64 BYTE),
  BD_ORIG_IMEI         VARCHAR2(20 BYTE),
  BD_PANI_HEADER       VARCHAR2(200 BYTE)
)
TABLESPACE SBS1_SMSD_DATA_UC
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;


--
-- BDETAIL1_20180623_BCK  (Table) 
--
CREATE TABLE SBS1_ADMIN.BDETAIL1_20180623_BCK
(
  BD_ID                VARCHAR2(10 BYTE),
  BD_SRCTYPE           VARCHAR2(10 BYTE)        NOT NULL,
  BD_DATETIME          DATE                     NOT NULL,
  BD_DEMO              NUMBER(1)                NOT NULL,
  BD_BIHID             VARCHAR2(10 BYTE)        NOT NULL,
  BD_MAPSID            VARCHAR2(1 BYTE)         NOT NULL,
  BD_BIRECNO           NUMBER(8)                NOT NULL,
  BD_BOHID1            VARCHAR2(10 BYTE),
  BD_PACSID1           VARCHAR2(1 BYTE),
  BD_BORECNO1          NUMBER(8),
  BD_BOHID2            VARCHAR2(10 BYTE),
  BD_PACSID2           VARCHAR2(1 BYTE),
  BD_BORECNO2          NUMBER(8),
  BD_BOHID3            VARCHAR2(10 BYTE),
  BD_PACSID3           VARCHAR2(1 BYTE),
  BD_BORECNO3          NUMBER(8),
  BD_CONID             VARCHAR2(10 BYTE),
  BD_PMVID             VARCHAR2(10 BYTE),
  BD_TARID             VARCHAR2(1 BYTE),
  BD_NPI_A             VARCHAR2(3 BYTE),
  BD_TON_A             VARCHAR2(3 BYTE),
  BD_PID_A             VARCHAR2(3 BYTE),
  BD_MSISDN_A          VARCHAR2(20 BYTE),
  BD_TON_B             VARCHAR2(3 BYTE),
  BD_NPI_B             VARCHAR2(3 BYTE),
  BD_PID_B             VARCHAR2(3 BYTE),
  BD_MSISDN_B          VARCHAR2(20 BYTE),
  BD_IMSI              VARCHAR2(20 BYTE),
  BD_LENGTH            NUMBER(4),
  BD_PREPAID           VARCHAR2(1 BYTE),
  BD_NETWORK           NUMBER(2),
  BD_NODENAME          VARCHAR2(20 BYTE),
  BD_SERVICE           VARCHAR2(10 BYTE),
  BD_SHORTID           VARCHAR2(6 BYTE),
  BD_ITEMNO            NUMBER(4),
  BD_KEYWORD           VARCHAR2(80 BYTE),
  BD_LANGID            VARCHAR2(2 BYTE),
  BD_REQTYPE           NUMBER(4),
  BD_BILLRATE          NUMBER(3),
  BD_AMOUNTCU          NUMBER(9,4),
  BD_RETSHAREPV        NUMBER(9,4),
  BD_RETSHAREMO        NUMBER(9,4),
  BD_VSMSCID           VARCHAR2(20 BYTE),
  BD_CONSOLIDATION     VARCHAR2(6 BYTE),
  BD_STATUS            NUMBER(2),
  BD_TERMDATE          DATE,
  BD_SETTLING          NUMBER(1),
  BD_SETID             VARCHAR2(10 BYTE),
  BD_STORAGE           NUMBER(1),
  BD_DBIDSTORE         VARCHAR2(2 BYTE),
  BD_DATESTORE         DATE,
  BD_ARCHIVE           NUMBER(1),
  BD_DBIDARCH          VARCHAR2(2 BYTE),
  BD_DATEARCH          DATE,
  BD_REQUESTID         NUMBER(10),
  BD_RECTYPE           NUMBER(2),
  BD_IDENTITY          VARCHAR2(10 BYTE),
  BD_REQSERV           VARCHAR2(3 BYTE),
  BD_SUBSERV           VARCHAR2(3 BYTE),
  BD_OPERATION         VARCHAR2(3 BYTE),
  BD_MULTSM            NUMBER(1),
  BD_SMSEQ             NUMBER(2),
  BD_ANSTYPE           NUMBER(2),
  BD_RETCODE           NUMBER(2),
  BD_RESPMEDIA         NUMBER(1),
  BD_SMSCRESP          NUMBER(1),
  BD_TMINODE           VARCHAR2(10 BYTE),
  BD_REQID             NUMBER(10),
  BD_SERVKEY           VARCHAR2(6 BYTE),
  BD_TOCID             VARCHAR2(10 BYTE),
  BD_IOT               NUMBER(9,4),
  BD_INT               VARCHAR2(1 BYTE),
  BD_OGTI              VARCHAR2(20 BYTE),
  BD_ZNID              VARCHAR2(10 BYTE),
  BD_CDRTID            VARCHAR2(10 BYTE),
  BD_IW                VARCHAR2(1 BYTE),
  BD_ERRID             VARCHAR2(10 BYTE),
  BD_BILLED            VARCHAR2(1 BYTE),
  BD_RATED             VARCHAR2(1 BYTE),
  BD_PACIDHB           VARCHAR2(10 BYTE),
  BD_OUTPUTHB          VARCHAR2(4000 BYTE),
  BD_AMOUNTTR          NUMBER(9,4),
  BD_ORIGSUBMIT        DATE,
  BD_BILLID            VARCHAR2(20 BYTE),
  BD_VSPRCID           VARCHAR2(10 BYTE),
  BD_ONLINECHARGE      NUMBER(9,4),
  BD_MESSAGEREFERENCE  VARCHAR2(40 BYTE),
  BD_DGTI              VARCHAR2(20 BYTE),
  BD_SMSCID            VARCHAR2(10 BYTE),
  BD_ORIGINATORIMSI    VARCHAR2(20 BYTE),
  BD_PPPSER            VARCHAR2(40 BYTE),
  BD_DSER              VARCHAR2(40 BYTE),
  BD_ORIGSCA           VARCHAR2(40 BYTE),
  BD_GENERATED         NUMBER(1),
  BD_SUBMIT_US         NUMBER(6),
  BD_SUBMIT_GT         VARCHAR2(20 BYTE),
  BD_SUBMIT_APP        VARCHAR2(20 BYTE),
  BD_ORIG_CHARSET      NUMBER(1),
  BD_ORIG_ESME_ID      VARCHAR2(6 BYTE),
  BD_ORIG_IP           VARCHAR2(50 BYTE),
  BD_DELIVER_ADR       VARCHAR2(20 BYTE),
  BD_DELIVER_TON       VARCHAR2(3 BYTE),
  BD_DELIVER_NPI       VARCHAR2(3 BYTE),
  BD_DELIVER_ESME_ID   VARCHAR2(6 BYTE),
  BD_DELIVER_IP        VARCHAR2(50 BYTE),
  BD_MSGREQTYPE        NUMBER(10),
  BD_MSGSCHEDULETIME   DATE,
  BD_MSGEXPIRYTIME     DATE,
  BD_SEG_ID            NUMBER(3),
  BD_SEG_COUNT         NUMBER(3),
  BD_ERR_TYPE          VARCHAR2(10 BYTE),
  BD_ERR_CODE          VARCHAR2(10 BYTE),
  BD_DIA_RESULT        VARCHAR2(10 BYTE),
  BD_RECIP_IMSI        VARCHAR2(20 BYTE),
  BD_RECIP_ADR         VARCHAR2(254 BYTE),
  BD_RECIP_TON         VARCHAR2(3 BYTE),
  BD_RECIP_NPI         VARCHAR2(3 BYTE),
  BD_OGTI_OPKEY        VARCHAR2(10 BYTE),
  BD_DELIVER_OPKEY     VARCHAR2(10 BYTE),
  BD_SCA_OPKEY         VARCHAR2(10 BYTE),
  BD_ORIG_DCS          NUMBER(3),
  BD_ORIG_MSG_ID       VARCHAR2(64 BYTE),
  BD_ORIG_IMEI         VARCHAR2(20 BYTE),
  BD_PANI_HEADER       VARCHAR2(200 BYTE),
  BD_BIO_CLIENT_ID     VARCHAR2(40 BYTE),
  BD_BIO_ORIG_ESME_ID  VARCHAR2(6 BYTE),
  BD_BIO_MSG_REF       VARCHAR2(40 BYTE),
  BD_RECIP_ESME_ID     VARCHAR2(6 BYTE),
  BD_BIO_REQ_TYPE      NUMBER(3)
)
TABLESPACE SBS1_SMSD_DATA_UC
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;


--
-- BDETAIL2_HR_SEG  (Table) 
--
CREATE TABLE SBS1_ADMIN.BDETAIL2_HR_SEG
(
  BD_ID                VARCHAR2(10 BYTE),
  BD_DATETIME          DATE                     NOT NULL,
  BD_MSISDN_A          VARCHAR2(20 BYTE),
  BD_MSISDN_B          VARCHAR2(20 BYTE),
  BD_IMSI              VARCHAR2(20 BYTE),
  BD_LENGTH            NUMBER(4),
  BD_OGTI              VARCHAR2(20 BYTE),
  BD_DGTI              VARCHAR2(20 BYTE),
  BD_IW                VARCHAR2(1 BYTE),
  BD_MESSAGEREFERENCE  VARCHAR2(40 BYTE),
  BD_SMSCID            VARCHAR2(10 BYTE),
  BD_ORIGSCA           VARCHAR2(40 BYTE),
  BD_DELIVER_ESME_ID   VARCHAR2(6 BYTE),
  BD_SEG_ID            NUMBER(3),
  BD_SEG_COUNT         NUMBER(3),
  BD_OGTI_OPKEY        VARCHAR2(10 BYTE),
  BD_DELIVER_OPKEY     VARCHAR2(10 BYTE),
  BD_DGTI_OPKEY        VARCHAR2(10 BYTE),
  BD_SCA_OPKEY         VARCHAR2(10 BYTE),
  BD_IW_AMOUNT         NUMBER(10,4),
  BD_IW_APMN           VARCHAR2(10 BYTE),
  BD_IW_CURID          VARCHAR2(3 BYTE),
  BD_IW_DIR            VARCHAR2(1 BYTE),
  BD_IW_SCENARIO       VARCHAR2(1 BYTE),
  BD_IW_CONSTATE       VARCHAR2(1 BYTE),
  SHOULD_COUNT         NUMBER(3),
  IS_COUNT             NUMBER(8)
)
TABLESPACE SBS1_ARCHIV_DATA_NC
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;


--
-- BDETAIL2_HR_SEG_MASTER  (Table) 
--
CREATE TABLE SBS1_ADMIN.BDETAIL2_HR_SEG_MASTER
(
  BD_ID                VARCHAR2(10 BYTE),
  BD_DATETIME          DATE                     NOT NULL,
  BD_MSISDN_A          VARCHAR2(20 BYTE),
  BD_MSISDN_B          VARCHAR2(20 BYTE),
  BD_IMSI              VARCHAR2(20 BYTE),
  BD_LENGTH            NUMBER(4),
  BD_OGTI              VARCHAR2(20 BYTE),
  BD_DGTI              VARCHAR2(20 BYTE),
  BD_IW                VARCHAR2(1 BYTE),
  BD_MESSAGEREFERENCE  VARCHAR2(40 BYTE),
  BD_SMSCID            VARCHAR2(10 BYTE),
  BD_ORIGSCA           VARCHAR2(40 BYTE),
  BD_DELIVER_ESME_ID   VARCHAR2(6 BYTE),
  BD_SEG_ID            NUMBER(3),
  BD_SEG_COUNT         NUMBER(3),
  BD_OGTI_OPKEY        VARCHAR2(10 BYTE),
  BD_DELIVER_OPKEY     VARCHAR2(10 BYTE),
  BD_DGTI_OPKEY        VARCHAR2(10 BYTE),
  BD_SCA_OPKEY         VARCHAR2(10 BYTE),
  BD_IW_AMOUNT         NUMBER(10,4),
  BD_IW_APMN           VARCHAR2(10 BYTE),
  BD_IW_CURID          VARCHAR2(3 BYTE),
  BD_IW_DIR            VARCHAR2(1 BYTE),
  BD_IW_SCENARIO       VARCHAR2(1 BYTE),
  BD_IW_CONSTATE       VARCHAR2(1 BYTE),
  IS_COUNT             NUMBER
)
TABLESPACE SBS1_ARCHIV_DATA_NC
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;


--
-- BDETAIL2_HR_SEG_MASTER_05  (Table) 
--
CREATE TABLE SBS1_ADMIN.BDETAIL2_HR_SEG_MASTER_05
(
  BD_ID                VARCHAR2(10 BYTE),
  BD_DATETIME          DATE                     NOT NULL,
  BD_MSISDN_A          VARCHAR2(20 BYTE),
  BD_MSISDN_B          VARCHAR2(20 BYTE),
  BD_IMSI              VARCHAR2(20 BYTE),
  BD_LENGTH            NUMBER(4),
  BD_OGTI              VARCHAR2(20 BYTE),
  BD_DGTI              VARCHAR2(20 BYTE),
  BD_IW                VARCHAR2(1 BYTE),
  BD_MESSAGEREFERENCE  VARCHAR2(40 BYTE),
  BD_SMSCID            VARCHAR2(10 BYTE),
  BD_ORIGSCA           VARCHAR2(40 BYTE),
  BD_DELIVER_ESME_ID   VARCHAR2(6 BYTE),
  BD_SEG_ID            NUMBER(3),
  BD_SEG_COUNT         NUMBER(3),
  BD_OGTI_OPKEY        VARCHAR2(10 BYTE),
  BD_DELIVER_OPKEY     VARCHAR2(10 BYTE),
  BD_DGTI_OPKEY        VARCHAR2(10 BYTE),
  BD_SCA_OPKEY         VARCHAR2(10 BYTE),
  BD_IW_AMOUNT         NUMBER(10,4),
  BD_IW_APMN           VARCHAR2(10 BYTE),
  BD_IW_CURID          VARCHAR2(3 BYTE),
  BD_IW_DIR            VARCHAR2(1 BYTE),
  BD_IW_SCENARIO       VARCHAR2(1 BYTE),
  BD_IW_CONSTATE       VARCHAR2(1 BYTE),
  IS_COUNT             NUMBER,
  IS_COUNT2            NUMBER(8)
)
TABLESPACE SBS1_ARCHIV_DATA_NC
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;


--
-- BDETAIL_201901  (Table) 
--
CREATE TABLE SBS1_ADMIN.BDETAIL_201901
(
  BD_ID               VARCHAR2(10 BYTE),
  BD_SRCTYPE          VARCHAR2(10 BYTE)         NOT NULL,
  BD_DATETIME         DATE                      NOT NULL,
  BD_DEMO             NUMBER(1)                 NOT NULL,
  BD_BIHID            VARCHAR2(10 BYTE)         NOT NULL,
  BD_MAPSID           VARCHAR2(1 BYTE)          NOT NULL,
  BD_BIRECNO          NUMBER(8)                 NOT NULL,
  BD_BOHID1           VARCHAR2(10 BYTE),
  BD_PACSID1          VARCHAR2(1 BYTE),
  BD_BORECNO1         NUMBER(8),
  BD_BOHID2           VARCHAR2(10 BYTE),
  BD_PACSID2          VARCHAR2(1 BYTE),
  BD_BORECNO2         NUMBER(8),
  BD_BOHID3           VARCHAR2(10 BYTE),
  BD_PACSID3          VARCHAR2(1 BYTE),
  BD_BORECNO3         NUMBER(8),
  BD_CONID            VARCHAR2(10 BYTE),
  BD_PMVID            VARCHAR2(10 BYTE),
  BD_TARID            VARCHAR2(1 BYTE),
  BD_NPI_A            VARCHAR2(2 BYTE),
  BD_TON_A            VARCHAR2(2 BYTE),
  BD_PID_A            VARCHAR2(2 BYTE),
  BD_MSISDN_A         VARCHAR2(20 BYTE)         NOT NULL,
  BD_TON_B            VARCHAR2(2 BYTE),
  BD_NPI_B            VARCHAR2(2 BYTE),
  BD_PID_B            VARCHAR2(2 BYTE),
  BD_MSISDN_B         VARCHAR2(20 BYTE),
  BD_IMSI             VARCHAR2(20 BYTE),
  BD_LENGTH           NUMBER(10),
  BD_PREPAID          VARCHAR2(1 BYTE),
  BD_NODENAME         VARCHAR2(20 BYTE),
  BD_SERVICE          VARCHAR2(20 BYTE),
  BD_SHORTID          VARCHAR2(6 BYTE),
  BD_ITEMNO           NUMBER(4),
  BD_KEYWORD          VARCHAR2(80 BYTE),
  BD_LANGID           VARCHAR2(2 BYTE),
  BD_REQTYPE          NUMBER(4),
  BD_BILLRATE         NUMBER(3),
  BD_AMOUNTCU         NUMBER(9,4),
  BD_RETSHAREPV       NUMBER(9,4),
  BD_RETSHAREMO       NUMBER(9,4),
  BD_VSMSCID          VARCHAR2(20 BYTE),
  BD_CONSOLIDATION    VARCHAR2(6 BYTE),
  BD_STATUS           NUMBER(2),
  BD_TERMDATE         DATE,
  BD_SETTLING         NUMBER(1),
  BD_SETID            VARCHAR2(10 BYTE),
  BD_STORAGE          NUMBER(1),
  BD_DBIDSTORE        VARCHAR2(2 BYTE),
  BD_DATESTORE        DATE,
  BD_ARCHIVE          NUMBER(1),
  BD_DBIDARCH         VARCHAR2(2 BYTE),
  BD_DATEARCH         DATE,
  BD_RECTYPE          NUMBER(2),
  BD_IDENTITY         VARCHAR2(10 BYTE),
  BD_REQSERV          VARCHAR2(3 BYTE),
  BD_SUBSERV          VARCHAR2(3 BYTE),
  BD_OPERATION        VARCHAR2(3 BYTE),
  BD_MULTSM           NUMBER(1),
  BD_SMSEQ            NUMBER(2),
  BD_ANSTYPE          NUMBER(2),
  BD_RETCODE          NUMBER(2),
  BD_RESPMEDIA        NUMBER(1),
  BD_SMSCRESP         NUMBER(1),
  BD_TMINODE          VARCHAR2(10 BYTE),
  BD_REQID            NUMBER(10),
  BD_SERVKEY          VARCHAR2(6 BYTE),
  BD_BILLTEXT         VARCHAR2(80 BYTE),
  BD_LOCATION         VARCHAR2(80 BYTE),
  BD_INFO             VARCHAR2(80 BYTE),
  BD_ZNID             VARCHAR2(10 BYTE),
  BD_NETWORK          VARCHAR2(10 BYTE),
  BD_TPID             VARCHAR2(10 BYTE),
  BD_STYPE            VARCHAR2(10 BYTE),
  BD_BILLTIME         DATE,
  BD_MSGID            VARCHAR2(30 BYTE),
  BD_TRCLASS          NUMBER(10,3),
  BD_AMOUNTTR         NUMBER(9,4),
  BD_TOCID            VARCHAR2(10 BYTE),
  BD_CDRTID           VARCHAR2(10 BYTE),
  BD_INT              VARCHAR2(1 BYTE),
  BD_IW               VARCHAR2(1 BYTE),
  BD_AAATS            VARCHAR2(1 BYTE),
  BD_CONSTID          VARCHAR2(10 BYTE),
  BD_ERRID            VARCHAR2(10 BYTE),
  BD_BILLED           VARCHAR2(1 BYTE),
  BD_RATED            VARCHAR2(1 BYTE),
  BD_PACIDHB          VARCHAR2(10 BYTE),
  BD_OUTPUTHB         VARCHAR2(4000 BYTE),
  BD_BILLINGDOMAIN    VARCHAR2(10 BYTE),
  BD_TRANSPORTMEDIUM  VARCHAR2(10 BYTE),
  BD_CATEGORY         VARCHAR2(20 BYTE),
  BD_TAXRATE          VARCHAR2(10 BYTE),
  BD_TESTMODE         VARCHAR2(10 BYTE),
  BD_REQUESTID        VARCHAR2(20 BYTE),
  BD_COUNTTR          NUMBER(2),
  BD_VSPRCID          VARCHAR2(10 BYTE),
  BD_ORIGSUBMIT       DATE,
  BD_ONLINECHARGE     NUMBER(9,4),
  BD_LTTREQRECCOUNT   NUMBER(8),
  BD_LTTDNRECCOUNT    NUMBER(8),
  BD_LTTDNDATETIME    DATE,
  BD_GART             VARCHAR2(10 BYTE),
  BD_SHOW             VARCHAR2(32 BYTE),
  BD_CAMPAIGN         VARCHAR2(32 BYTE),
  BD_SIGNATURE        VARCHAR2(20 BYTE)
)
TABLESPACE SBS1_ARCHIV_DATA_NC
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;


--
-- BDETAIL2_20171026  (Table) 
--
CREATE TABLE SBS1_ADMIN.BDETAIL2_20171026
(
  BD_ID                VARCHAR2(10 BYTE),
  BD_SRCTYPE           VARCHAR2(10 BYTE)        NOT NULL,
  BD_DATETIME          DATE                     NOT NULL,
  BD_DATESUBMIT        DATE                     NOT NULL,
  BD_DEMO              NUMBER(1)                NOT NULL,
  BD_BIHID             VARCHAR2(10 BYTE)        NOT NULL,
  BD_MAPSID            VARCHAR2(1 BYTE)         NOT NULL,
  BD_BIRECNO           NUMBER(8)                NOT NULL,
  BD_BOHID1            VARCHAR2(10 BYTE),
  BD_PACSID1           VARCHAR2(1 BYTE),
  BD_BORECNO1          NUMBER(8),
  BD_BOHID2            VARCHAR2(10 BYTE),
  BD_PACSID2           VARCHAR2(1 BYTE),
  BD_BORECNO2          NUMBER(8),
  BD_BOHID3            VARCHAR2(10 BYTE),
  BD_PACSID3           VARCHAR2(1 BYTE),
  BD_BORECNO3          NUMBER(8),
  BD_CONID             VARCHAR2(10 BYTE),
  BD_PMVID             VARCHAR2(10 BYTE),
  BD_TARID             VARCHAR2(1 BYTE),
  BD_NPI_A             VARCHAR2(3 BYTE),
  BD_TON_A             VARCHAR2(3 BYTE),
  BD_PID_A             VARCHAR2(3 BYTE),
  BD_MSISDN_A          VARCHAR2(20 BYTE),
  BD_TON_B             VARCHAR2(3 BYTE),
  BD_NPI_B             VARCHAR2(3 BYTE),
  BD_PID_B             VARCHAR2(3 BYTE),
  BD_MSISDN_B          VARCHAR2(20 BYTE),
  BD_IMSI              VARCHAR2(20 BYTE),
  BD_LENGTH            NUMBER(4),
  BD_PREPAID           VARCHAR2(1 BYTE),
  BD_NETWORK           NUMBER(2),
  BD_NODENAME          VARCHAR2(20 BYTE),
  BD_SERVICE           VARCHAR2(10 BYTE),
  BD_SHORTID           VARCHAR2(6 BYTE),
  BD_ITEMNO            NUMBER(4),
  BD_KEYWORD           VARCHAR2(80 BYTE),
  BD_LANGID            VARCHAR2(2 BYTE),
  BD_REQTYPE           NUMBER(4),
  BD_BILLRATE          NUMBER(3),
  BD_AMOUNTCU          NUMBER(9,4),
  BD_RETSHAREPV        NUMBER(9,4),
  BD_RETSHAREMO        NUMBER(9,4),
  BD_VSMSCID           VARCHAR2(20 BYTE),
  BD_CONSOLIDATION     VARCHAR2(6 BYTE),
  BD_STATUS            NUMBER(2),
  BD_TERMDATE          DATE,
  BD_SETTLING          NUMBER(1),
  BD_SETID             VARCHAR2(10 BYTE),
  BD_STORAGE           NUMBER(1),
  BD_DBIDSTORE         VARCHAR2(2 BYTE),
  BD_DATESTORE         DATE,
  BD_ARCHIVE           NUMBER(1),
  BD_DBIDARCH          VARCHAR2(2 BYTE),
  BD_DATEARCH          DATE,
  BD_REQUESTID         NUMBER(10),
  BD_RECTYPE           NUMBER(2),
  BD_IDENTITY          VARCHAR2(10 BYTE),
  BD_REQSERV           VARCHAR2(3 BYTE),
  BD_SUBSERV           VARCHAR2(3 BYTE),
  BD_OPERATION         VARCHAR2(3 BYTE),
  BD_MULTSM            NUMBER(1),
  BD_SMSEQ             NUMBER(2),
  BD_ANSTYPE           NUMBER(2),
  BD_RETCODE           NUMBER(2),
  BD_RESPMEDIA         NUMBER(1),
  BD_SMSCRESP          NUMBER(1),
  BD_TMINODE           VARCHAR2(10 BYTE),
  BD_REQID             NUMBER(10),
  BD_SERVKEY           VARCHAR2(6 BYTE),
  BD_TOCID             VARCHAR2(10 BYTE),
  BD_IOT               NUMBER(9,4),
  BD_INT               VARCHAR2(1 BYTE),
  BD_OGTI              VARCHAR2(20 BYTE),
  BD_ZNID              VARCHAR2(10 BYTE),
  BD_DGTI              VARCHAR2(20 BYTE),
  BD_IW                VARCHAR2(1 BYTE),
  BD_CDRTID            VARCHAR2(10 BYTE),
  BD_ERRID             VARCHAR2(10 BYTE),
  BD_BILLED            VARCHAR2(1 BYTE),
  BD_RATED             VARCHAR2(1 BYTE),
  BD_PACIDHB           VARCHAR2(10 BYTE),
  BD_OUTPUTHB          VARCHAR2(4000 BYTE),
  BD_ORIGSUBMIT        DATE,
  BD_BILLID            VARCHAR2(20 BYTE),
  BD_VSPRCID           VARCHAR2(10 BYTE),
  BD_ONLINECHARGE      NUMBER(9,4),
  BD_MESSAGEREFERENCE  VARCHAR2(40 BYTE),
  BD_SMSCID            VARCHAR2(10 BYTE),
  BD_ORIGINATORIMSI    VARCHAR2(20 BYTE),
  BD_PPPSER            VARCHAR2(40 BYTE),
  BD_IOT_INTERNAL      NUMBER(9,4),
  BD_DSER              VARCHAR2(40 BYTE),
  BD_ORIGSCA           VARCHAR2(40 BYTE),
  BD_GENERATED         NUMBER(1),
  BD_SUBMIT_US         NUMBER(6),
  BD_SUBMIT_GT         VARCHAR2(20 BYTE),
  BD_SUBMIT_APP        VARCHAR2(20 BYTE),
  BD_ORIG_CHARSET      NUMBER(1),
  BD_ORIG_ESME_ID      VARCHAR2(6 BYTE),
  BD_ORIG_IP           VARCHAR2(50 BYTE),
  BD_DELIVER_ADR       VARCHAR2(20 BYTE),
  BD_DELIVER_TON       VARCHAR2(3 BYTE),
  BD_DELIVER_NPI       VARCHAR2(3 BYTE),
  BD_DELIVER_ESME_ID   VARCHAR2(6 BYTE),
  BD_DELIVER_IP        VARCHAR2(50 BYTE),
  BD_MSGREQTYPE        NUMBER(10),
  BD_MSGSCHEDULETIME   DATE,
  BD_MSGEXPIRYTIME     DATE,
  BD_SEG_ID            NUMBER(3),
  BD_SEG_COUNT         NUMBER(3),
  BD_ERR_TYPE          VARCHAR2(10 BYTE),
  BD_ERR_CODE          VARCHAR2(10 BYTE),
  BD_DIA_RESULT        VARCHAR2(10 BYTE),
  BD_DELIVER_US        NUMBER(6),
  BD_DELIVER_ATT       NUMBER(8),
  BD_RECIP_IMSI        VARCHAR2(20 BYTE),
  BD_RECIP_ADR         VARCHAR2(254 BYTE),
  BD_RECIP_TON         VARCHAR2(3 BYTE),
  BD_RECIP_NPI         VARCHAR2(3 BYTE),
  BD_OGTI_OPKEY        VARCHAR2(10 BYTE),
  BD_DELIVER_OPKEY     VARCHAR2(10 BYTE),
  BD_DGTI_OPKEY        VARCHAR2(10 BYTE),
  BD_SCA_OPKEY         VARCHAR2(10 BYTE),
  BD_IW_AMOUNT         NUMBER(10,4),
  BD_IW_APMN           VARCHAR2(10 BYTE),
  BD_IW_CURID          VARCHAR2(3 BYTE),
  BD_IW_DIR            VARCHAR2(1 BYTE),
  BD_IW_SCENARIO       VARCHAR2(1 BYTE),
  BD_IW_CONSTATE       VARCHAR2(1 BYTE),
  BD_AMOUNTTR          NUMBER(9,4),
  BD_ORIG_DCS          NUMBER(3),
  BD_ORIG_MSG_ID       VARCHAR2(64 BYTE),
  BD_ORIG_IMEI         VARCHAR2(20 BYTE),
  BD_PANI_HEADER       VARCHAR2(200 BYTE),
  BD_DELIVER_IMEI      VARCHAR2(20 BYTE)
)
TABLESPACE SBS1_SMSD_DATA_UC
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;


--
-- BDETAIL2_20180623_BCK  (Table) 
--
CREATE TABLE SBS1_ADMIN.BDETAIL2_20180623_BCK
(
  BD_ID                   VARCHAR2(10 BYTE),
  BD_SRCTYPE              VARCHAR2(10 BYTE)     NOT NULL,
  BD_DATETIME             DATE                  NOT NULL,
  BD_DATESUBMIT           DATE                  NOT NULL,
  BD_DEMO                 NUMBER(1)             NOT NULL,
  BD_BIHID                VARCHAR2(10 BYTE)     NOT NULL,
  BD_MAPSID               VARCHAR2(1 BYTE)      NOT NULL,
  BD_BIRECNO              NUMBER(8)             NOT NULL,
  BD_BOHID1               VARCHAR2(10 BYTE),
  BD_PACSID1              VARCHAR2(1 BYTE),
  BD_BORECNO1             NUMBER(8),
  BD_BOHID2               VARCHAR2(10 BYTE),
  BD_PACSID2              VARCHAR2(1 BYTE),
  BD_BORECNO2             NUMBER(8),
  BD_BOHID3               VARCHAR2(10 BYTE),
  BD_PACSID3              VARCHAR2(1 BYTE),
  BD_BORECNO3             NUMBER(8),
  BD_CONID                VARCHAR2(10 BYTE),
  BD_PMVID                VARCHAR2(10 BYTE),
  BD_TARID                VARCHAR2(1 BYTE),
  BD_NPI_A                VARCHAR2(3 BYTE),
  BD_TON_A                VARCHAR2(3 BYTE),
  BD_PID_A                VARCHAR2(3 BYTE),
  BD_MSISDN_A             VARCHAR2(20 BYTE),
  BD_TON_B                VARCHAR2(3 BYTE),
  BD_NPI_B                VARCHAR2(3 BYTE),
  BD_PID_B                VARCHAR2(3 BYTE),
  BD_MSISDN_B             VARCHAR2(20 BYTE),
  BD_IMSI                 VARCHAR2(20 BYTE),
  BD_LENGTH               NUMBER(4),
  BD_PREPAID              VARCHAR2(1 BYTE),
  BD_NETWORK              NUMBER(2),
  BD_NODENAME             VARCHAR2(20 BYTE),
  BD_SERVICE              VARCHAR2(10 BYTE),
  BD_SHORTID              VARCHAR2(6 BYTE),
  BD_ITEMNO               NUMBER(4),
  BD_KEYWORD              VARCHAR2(80 BYTE),
  BD_LANGID               VARCHAR2(2 BYTE),
  BD_REQTYPE              NUMBER(4),
  BD_BILLRATE             NUMBER(3),
  BD_AMOUNTCU             NUMBER(9,4),
  BD_RETSHAREPV           NUMBER(9,4),
  BD_RETSHAREMO           NUMBER(9,4),
  BD_VSMSCID              VARCHAR2(20 BYTE),
  BD_CONSOLIDATION        VARCHAR2(6 BYTE),
  BD_STATUS               NUMBER(2),
  BD_TERMDATE             DATE,
  BD_SETTLING             NUMBER(1),
  BD_SETID                VARCHAR2(10 BYTE),
  BD_STORAGE              NUMBER(1),
  BD_DBIDSTORE            VARCHAR2(2 BYTE),
  BD_DATESTORE            DATE,
  BD_ARCHIVE              NUMBER(1),
  BD_DBIDARCH             VARCHAR2(2 BYTE),
  BD_DATEARCH             DATE,
  BD_REQUESTID            NUMBER(10),
  BD_RECTYPE              NUMBER(2),
  BD_IDENTITY             VARCHAR2(10 BYTE),
  BD_REQSERV              VARCHAR2(3 BYTE),
  BD_SUBSERV              VARCHAR2(3 BYTE),
  BD_OPERATION            VARCHAR2(3 BYTE),
  BD_MULTSM               NUMBER(1),
  BD_SMSEQ                NUMBER(2),
  BD_ANSTYPE              NUMBER(2),
  BD_RETCODE              NUMBER(2),
  BD_RESPMEDIA            NUMBER(1),
  BD_SMSCRESP             NUMBER(1),
  BD_TMINODE              VARCHAR2(10 BYTE),
  BD_REQID                NUMBER(10),
  BD_SERVKEY              VARCHAR2(6 BYTE),
  BD_TOCID                VARCHAR2(10 BYTE),
  BD_IOT                  NUMBER(9,4),
  BD_INT                  VARCHAR2(1 BYTE),
  BD_OGTI                 VARCHAR2(20 BYTE),
  BD_ZNID                 VARCHAR2(10 BYTE),
  BD_DGTI                 VARCHAR2(20 BYTE),
  BD_IW                   VARCHAR2(1 BYTE),
  BD_CDRTID               VARCHAR2(10 BYTE),
  BD_ERRID                VARCHAR2(10 BYTE),
  BD_BILLED               VARCHAR2(1 BYTE),
  BD_RATED                VARCHAR2(1 BYTE),
  BD_PACIDHB              VARCHAR2(10 BYTE),
  BD_OUTPUTHB             VARCHAR2(4000 BYTE),
  BD_ORIGSUBMIT           DATE,
  BD_BILLID               VARCHAR2(20 BYTE),
  BD_VSPRCID              VARCHAR2(10 BYTE),
  BD_ONLINECHARGE         NUMBER(9,4),
  BD_MESSAGEREFERENCE     VARCHAR2(40 BYTE),
  BD_SMSCID               VARCHAR2(10 BYTE),
  BD_ORIGINATORIMSI       VARCHAR2(20 BYTE),
  BD_PPPSER               VARCHAR2(40 BYTE),
  BD_IOT_INTERNAL         NUMBER(9,4),
  BD_DSER                 VARCHAR2(40 BYTE),
  BD_ORIGSCA              VARCHAR2(40 BYTE),
  BD_GENERATED            NUMBER(1),
  BD_SUBMIT_US            NUMBER(6),
  BD_SUBMIT_GT            VARCHAR2(20 BYTE),
  BD_SUBMIT_APP           VARCHAR2(20 BYTE),
  BD_ORIG_CHARSET         NUMBER(1),
  BD_ORIG_ESME_ID         VARCHAR2(6 BYTE),
  BD_ORIG_IP              VARCHAR2(50 BYTE),
  BD_DELIVER_ADR          VARCHAR2(20 BYTE),
  BD_DELIVER_TON          VARCHAR2(3 BYTE),
  BD_DELIVER_NPI          VARCHAR2(3 BYTE),
  BD_DELIVER_ESME_ID      VARCHAR2(6 BYTE),
  BD_DELIVER_IP           VARCHAR2(50 BYTE),
  BD_MSGREQTYPE           NUMBER(10),
  BD_MSGSCHEDULETIME      DATE,
  BD_MSGEXPIRYTIME        DATE,
  BD_SEG_ID               NUMBER(3),
  BD_SEG_COUNT            NUMBER(3),
  BD_ERR_TYPE             VARCHAR2(10 BYTE),
  BD_ERR_CODE             VARCHAR2(10 BYTE),
  BD_DIA_RESULT           VARCHAR2(10 BYTE),
  BD_DELIVER_US           NUMBER(6),
  BD_DELIVER_ATT          NUMBER(8),
  BD_RECIP_IMSI           VARCHAR2(20 BYTE),
  BD_RECIP_ADR            VARCHAR2(254 BYTE),
  BD_RECIP_TON            VARCHAR2(3 BYTE),
  BD_RECIP_NPI            VARCHAR2(3 BYTE),
  BD_OGTI_OPKEY           VARCHAR2(10 BYTE),
  BD_DELIVER_OPKEY        VARCHAR2(10 BYTE),
  BD_DGTI_OPKEY           VARCHAR2(10 BYTE),
  BD_SCA_OPKEY            VARCHAR2(10 BYTE),
  BD_IW_AMOUNT            NUMBER(10,4),
  BD_IW_APMN              VARCHAR2(10 BYTE),
  BD_IW_CURID             VARCHAR2(3 BYTE),
  BD_IW_DIR               VARCHAR2(1 BYTE),
  BD_IW_SCENARIO          VARCHAR2(1 BYTE),
  BD_IW_CONSTATE          VARCHAR2(1 BYTE),
  BD_AMOUNTTR             NUMBER(9,4),
  BD_ORIG_DCS             NUMBER(3),
  BD_ORIG_MSG_ID          VARCHAR2(64 BYTE),
  BD_ORIG_IMEI            VARCHAR2(20 BYTE),
  BD_PANI_HEADER          VARCHAR2(200 BYTE),
  BD_DELIVER_IMEI         VARCHAR2(20 BYTE),
  BD_DELIVER_PANI_HEADER  VARCHAR2(200 BYTE),
  BD_DELIVER_MAP_GTI      VARCHAR2(20 BYTE),
  BD_BIO_CLIENT_ID        VARCHAR2(40 BYTE),
  BD_BIO_ORIG_ESME_ID     VARCHAR2(6 BYTE),
  BD_BIO_MSG_REF          VARCHAR2(40 BYTE),
  BD_RECIP_ESME_ID        VARCHAR2(6 BYTE),
  BD_BIO_REQ_TYPE         NUMBER(3)
)
TABLESPACE SBS1_SMSD_DATA_UC
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;


--
-- BDKPI  (Table) 
--
CREATE TABLE SBS1_ADMIN.BDKPI
(
  BDK_DATETIME  DATE                            NOT NULL,
  BDK_ID        VARCHAR2(10 BYTE)               NOT NULL,
  BDK_CVALUE    VARCHAR2(4000 BYTE),
  BDK_CODE      VARCHAR2(40 BYTE)               NOT NULL,
  BDK_VALUE     NUMBER(12,4),
  BDK_PACID     VARCHAR2(10 BYTE)               NOT NULL,
  BDK_SCHEMA    VARCHAR2(10 BYTE)               NOT NULL,
  BDK_TABLE     VARCHAR2(10 BYTE)               NOT NULL,
  BDK_BIHID     VARCHAR2(10 BYTE)               NOT NULL
)
NOCOMPRESS 
TABLESPACE SBS1_INFO_DATA_UC
PCTUSED    0
PCTFREE    30
INITRANS   1
MAXTRANS   255
STORAGE    (
            BUFFER_POOL      DEFAULT
           )
PARTITION BY RANGE (BDK_DATETIME)
(  
  PARTITION INFO201808 VALUES LESS THAN (TO_DATE(' 2018-09-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201809 VALUES LESS THAN (TO_DATE(' 2018-10-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201810 VALUES LESS THAN (TO_DATE(' 2018-11-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201811 VALUES LESS THAN (TO_DATE(' 2018-12-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201812 VALUES LESS THAN (TO_DATE(' 2019-01-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201901 VALUES LESS THAN (TO_DATE(' 2019-02-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201902 VALUES LESS THAN (TO_DATE(' 2019-03-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               )
);


--
-- BD1STATUS  (Table) 
--
CREATE TABLE SBS1_ADMIN.BD1STATUS
(
  BD1S_ID      NUMBER(2)                        NOT NULL,
  BD1S_CODE    VARCHAR2(10 BYTE)                NOT NULL,
  BD1S_LANG01  VARCHAR2(100 BYTE),
  BD1S_LANG02  VARCHAR2(100 BYTE),
  BD1S_LANG03  VARCHAR2(100 BYTE),
  BD1S_LANG04  VARCHAR2(100 BYTE),
  BD1S_VALUE1  VARCHAR2(100 BYTE),
  BD1S_VALUE2  VARCHAR2(100 BYTE),
  BD1S_VALUE3  VARCHAR2(100 BYTE),
  BD1S_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.BD1STATUS IS 'status codes for CDRs in BDETAIL1 (SMS Submit). Only status 4 (Submitted) is stored in this table for now.';


--
-- BD2STATUS  (Table) 
--
CREATE TABLE SBS1_ADMIN.BD2STATUS
(
  BD2S_ID      NUMBER(2)                        NOT NULL,
  BD2S_CODE    VARCHAR2(10 BYTE)                NOT NULL,
  BD2S_LANG01  VARCHAR2(100 BYTE),
  BD2S_LANG02  VARCHAR2(100 BYTE),
  BD2S_LANG03  VARCHAR2(100 BYTE),
  BD2S_LANG04  VARCHAR2(100 BYTE),
  BD2S_VALUE1  VARCHAR2(100 BYTE),
  BD2S_VALUE2  VARCHAR2(100 BYTE),
  BD2S_VALUE3  VARCHAR2(100 BYTE),
  BD2S_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.BD2STATUS IS 'status codes for CDRs in BDETAIL2 (all except SMS Submit).
Only status 4 (Submitted) is stored in BDETAIL1.';


--
-- BIHSTATE  (Table) 
--
CREATE TABLE SBS1_ADMIN.BIHSTATE
(
  BIHS_ID      VARCHAR2(3 BYTE)                 NOT NULL,
  BIHS_CODE    VARCHAR2(10 BYTE)                NOT NULL,
  BIHS_LANG01  VARCHAR2(100 BYTE),
  BIHS_LANG02  VARCHAR2(100 BYTE),
  BIHS_LANG03  VARCHAR2(100 BYTE),
  BIHS_LANG04  VARCHAR2(100 BYTE),
  BIHS_VALUE1  VARCHAR2(100 BYTE),
  BIHS_VALUE2  VARCHAR2(100 BYTE),
  BIHS_VALUE3  VARCHAR2(100 BYTE),
  BIHS_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.BIHSTATE IS 'Billing input header state';


--
-- BOHSTATE  (Table) 
--
CREATE TABLE SBS1_ADMIN.BOHSTATE
(
  BOHS_ID      VARCHAR2(3 BYTE)                 NOT NULL,
  BOHS_CODE    VARCHAR2(10 BYTE)                NOT NULL,
  BOHS_LANG01  VARCHAR2(100 BYTE),
  BOHS_LANG02  VARCHAR2(100 BYTE),
  BOHS_LANG03  VARCHAR2(100 BYTE),
  BOHS_LANG04  VARCHAR2(100 BYTE),
  BOHS_VALUE1  VARCHAR2(100 BYTE),
  BOHS_VALUE2  VARCHAR2(100 BYTE),
  BOHS_VALUE3  VARCHAR2(100 BYTE),
  BOHS_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.BOHSTATE IS 'Billing output header state';


--
-- BOSTATE  (Table) 
--
CREATE TABLE SBS1_ADMIN.BOSTATE
(
  BOS_ID      VARCHAR2(1 BYTE)                  NOT NULL,
  BOS_CODE    VARCHAR2(10 BYTE)                 NOT NULL,
  BOS_LANG01  VARCHAR2(100 BYTE),
  BOS_LANG02  VARCHAR2(100 BYTE),
  BOS_LANG03  VARCHAR2(100 BYTE),
  BOS_LANG04  VARCHAR2(100 BYTE),
  BOS_VALUE1  VARCHAR2(100 BYTE),
  BOS_VALUE2  VARCHAR2(100 BYTE),
  BOS_VALUE3  VARCHAR2(100 BYTE),
  BOS_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.BOSTATE IS 'Record State of billable CDRs. Used for File Output from SETDETAIL table ';


--
-- CARRIER  (Table) 
--
CREATE TABLE SBS1_ADMIN.CARRIER
(
  CAR_ID       VARCHAR2(10 BYTE)                NOT NULL,
  CAR_COUNTRY  VARCHAR2(100 BYTE)               NOT NULL,
  CAR_OPNAME   VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    30
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          104K
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.CARRIER IS 'carrier';


--
-- CDRTYPE  (Table) 
--
CREATE TABLE SBS1_ADMIN.CDRTYPE
(
  CDRT_ID      VARCHAR2(10 BYTE)                NOT NULL,
  CDRT_CODE    VARCHAR2(10 BYTE)                NOT NULL,
  CDRT_LANG01  VARCHAR2(100 BYTE),
  CDRT_LANG02  VARCHAR2(100 BYTE),
  CDRT_LANG03  VARCHAR2(100 BYTE),
  CDRT_LANG04  VARCHAR2(100 BYTE),
  CDRT_VALUE1  VARCHAR2(100 BYTE),
  CDRT_VALUE2  VARCHAR2(100 BYTE),
  CDRT_VALUE3  VARCHAR2(100 BYTE),
  CDRT_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.CDRTYPE IS 'CDR type';

COMMENT ON COLUMN SBS1_ADMIN.CDRTYPE.CDRT_ID IS 'type id';

COMMENT ON COLUMN SBS1_ADMIN.CDRTYPE.CDRT_CODE IS 'code';

COMMENT ON COLUMN SBS1_ADMIN.CDRTYPE.CDRT_LANG01 IS 'language 1';

COMMENT ON COLUMN SBS1_ADMIN.CDRTYPE.CDRT_LANG02 IS 'language 2';

COMMENT ON COLUMN SBS1_ADMIN.CDRTYPE.CDRT_LANG03 IS 'language 3';

COMMENT ON COLUMN SBS1_ADMIN.CDRTYPE.CDRT_LANG04 IS 'language 4';

COMMENT ON COLUMN SBS1_ADMIN.CDRTYPE.CDRT_VALUE1 IS 'value 1';

COMMENT ON COLUMN SBS1_ADMIN.CDRTYPE.CDRT_VALUE2 IS 'value 2';

COMMENT ON COLUMN SBS1_ADMIN.CDRTYPE.CDRT_VALUE3 IS 'value 3';

COMMENT ON COLUMN SBS1_ADMIN.CDRTYPE.CDRT_VALUE4 IS 'value 4';


--
-- CODE  (Table) 
--
CREATE TABLE SBS1_ADMIN.CODE
(
  CD_ID       VARCHAR2(10 BYTE)                 NOT NULL,
  CD_TOPIC    VARCHAR2(10 BYTE)                 NOT NULL,
  CD_CODE     VARCHAR2(10 BYTE)                 NOT NULL,
  CD_SUBCODE  VARCHAR2(10 BYTE),
  CD_LANG01   VARCHAR2(100 BYTE),
  CD_LANG02   VARCHAR2(100 BYTE),
  CD_LANG03   VARCHAR2(100 BYTE),
  CD_LANG04   VARCHAR2(100 BYTE),
  CD_VALUE1   VARCHAR2(100 BYTE),
  CD_VALUE2   VARCHAR2(100 BYTE),
  CD_VALUE3   VARCHAR2(100 BYTE),
  CD_VALUE4   VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.CODE IS 'Codes';


--
-- CONSTATE  (Table) 
--
CREATE TABLE SBS1_ADMIN.CONSTATE
(
  CONS_ID      VARCHAR2(10 BYTE)                NOT NULL,
  CONS_CODE    VARCHAR2(10 BYTE)                NOT NULL,
  CONS_LANG01  VARCHAR2(100 BYTE),
  CONS_LANG02  VARCHAR2(100 BYTE),
  CONS_LANG03  VARCHAR2(100 BYTE),
  CONS_LANG04  VARCHAR2(100 BYTE),
  CONS_VALUE1  VARCHAR2(100 BYTE),
  CONS_VALUE2  VARCHAR2(100 BYTE),
  CONS_VALUE3  VARCHAR2(100 BYTE),
  CONS_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.CONSTATE IS 'Contract state';


--
-- CONTYPE  (Table) 
--
CREATE TABLE SBS1_ADMIN.CONTYPE
(
  CONT_ID      VARCHAR2(10 BYTE)                NOT NULL,
  CONT_CODE    VARCHAR2(10 BYTE)                NOT NULL,
  CONT_LANG01  VARCHAR2(100 BYTE),
  CONT_LANG02  VARCHAR2(100 BYTE),
  CONT_LANG03  VARCHAR2(100 BYTE),
  CONT_LANG04  VARCHAR2(100 BYTE),
  CONT_VALUE1  VARCHAR2(100 BYTE),
  CONT_VALUE2  VARCHAR2(100 BYTE),
  CONT_VALUE3  VARCHAR2(100 BYTE),
  CONT_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.CONTYPE IS 'Contract type';


--
-- CSSTATE  (Table) 
--
CREATE TABLE SBS1_ADMIN.CSSTATE
(
  CSS_ID      VARCHAR2(10 BYTE)                 NOT NULL,
  CSS_CODE    VARCHAR2(10 BYTE)                 NOT NULL,
  CSS_LANG01  VARCHAR2(100 BYTE),
  CSS_LANG02  VARCHAR2(100 BYTE),
  CSS_LANG03  VARCHAR2(100 BYTE),
  CSS_LANG04  VARCHAR2(100 BYTE),
  CSS_VALUE1  VARCHAR2(100 BYTE),
  CSS_VALUE2  VARCHAR2(100 BYTE),
  CSS_VALUE3  VARCHAR2(100 BYTE),
  CSS_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.CSSTATE IS 'Content Service State';

COMMENT ON COLUMN SBS1_ADMIN.CSSTATE.CSS_ID IS 'state id';

COMMENT ON COLUMN SBS1_ADMIN.CSSTATE.CSS_CODE IS 'code';

COMMENT ON COLUMN SBS1_ADMIN.CSSTATE.CSS_LANG01 IS 'language 1';

COMMENT ON COLUMN SBS1_ADMIN.CSSTATE.CSS_LANG02 IS 'language 2';

COMMENT ON COLUMN SBS1_ADMIN.CSSTATE.CSS_LANG03 IS 'language 3';

COMMENT ON COLUMN SBS1_ADMIN.CSSTATE.CSS_LANG04 IS 'language 4';

COMMENT ON COLUMN SBS1_ADMIN.CSSTATE.CSS_VALUE1 IS 'value 1';

COMMENT ON COLUMN SBS1_ADMIN.CSSTATE.CSS_VALUE2 IS 'value 2';

COMMENT ON COLUMN SBS1_ADMIN.CSSTATE.CSS_VALUE3 IS 'value 3';

COMMENT ON COLUMN SBS1_ADMIN.CSSTATE.CSS_VALUE4 IS 'value 4';


--
-- CTRSTATE  (Table) 
--
CREATE TABLE SBS1_ADMIN.CTRSTATE
(
  CTRS_ID      VARCHAR2(10 BYTE)                NOT NULL,
  CTRS_CODE    VARCHAR2(10 BYTE)                NOT NULL,
  CTRS_LANG01  VARCHAR2(100 BYTE),
  CTRS_LANG02  VARCHAR2(100 BYTE),
  CTRS_LANG03  VARCHAR2(100 BYTE),
  CTRS_LANG04  VARCHAR2(100 BYTE),
  CTRS_VALUE1  VARCHAR2(100 BYTE),
  CTRS_VALUE2  VARCHAR2(100 BYTE),
  CTRS_VALUE3  VARCHAR2(100 BYTE),
  CTRS_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;


--
-- CTRTYPE  (Table) 
--
CREATE TABLE SBS1_ADMIN.CTRTYPE
(
  CTRT_ID      VARCHAR2(10 BYTE)                NOT NULL,
  CTRT_CODE    VARCHAR2(10 BYTE)                NOT NULL,
  CTRT_LANG01  VARCHAR2(100 BYTE),
  CTRT_LANG02  VARCHAR2(100 BYTE),
  CTRT_LANG03  VARCHAR2(100 BYTE),
  CTRT_LANG04  VARCHAR2(100 BYTE),
  CTRT_VALUE1  VARCHAR2(100 BYTE),
  CTRT_VALUE2  VARCHAR2(100 BYTE),
  CTRT_VALUE3  VARCHAR2(100 BYTE),
  CTRT_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;


--
-- CURRENCY  (Table) 
--
CREATE TABLE SBS1_ADMIN.CURRENCY
(
  CUR_ID        VARCHAR2(10 BYTE)               NOT NULL,
  CUR_NAME      VARCHAR2(30 BYTE),
  CUR_RATE      NUMBER(9,4),
  CUR_DATETIME  DATE,
  CUR_CHNGCNT   NUMBER(5),
  CUR_ACIDCRE   VARCHAR2(10 BYTE),
  CUR_DATECRE   DATE,
  CUR_ACIDMOD   VARCHAR2(10 BYTE),
  CUR_DATEMOD   DATE,
  CUR_COMMENT   VARCHAR2(1000 BYTE),
  CUR_HEADVAL   NUMBER(10,5)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.CURRENCY IS 'Currency';


--
-- DBASE  (Table) 
--
CREATE TABLE SBS1_ADMIN.DBASE
(
  DB_ID       VARCHAR2(2 BYTE)                  NOT NULL,
  DB_NAME     VARCHAR2(50 BYTE)                 NOT NULL,
  DB_SID      VARCHAR2(4 BYTE)                  NOT NULL,
  DB_IDENT    VARCHAR2(8 BYTE),
  DB_HOST     VARCHAR2(50 BYTE),
  DB_SERVICE  VARCHAR2(30 BYTE)                 NOT NULL,
  DB_ETID     VARCHAR2(10 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.DBASE IS 'Database names';


--
-- DBSS_LOG  (Table) 
--
CREATE TABLE SBS1_ADMIN.DBSS_LOG
(
  CKEY    NUMBER                                NOT NULL,
  CVALUE  CLOB                                  NOT NULL,
  CHASH   VARCHAR2(20 BYTE)
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;


--
-- DGTICSTATE  (Table) 
--
CREATE TABLE SBS1_ADMIN.DGTICSTATE
(
  DGTICS_ID      VARCHAR2(10 BYTE)              NOT NULL,
  DGTICS_CODE    VARCHAR2(10 BYTE)              NOT NULL,
  DGTICS_LANG01  VARCHAR2(100 BYTE),
  DGTICS_LANG02  VARCHAR2(100 BYTE),
  DGTICS_LANG03  VARCHAR2(100 BYTE),
  DGTICS_LANG04  VARCHAR2(100 BYTE),
  DGTICS_VALUE1  VARCHAR2(100 BYTE),
  DGTICS_VALUE2  VARCHAR2(100 BYTE),
  DGTICS_VALUE3  VARCHAR2(100 BYTE),
  DGTICS_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.DGTICSTATE IS 'dgti consolidation state';

COMMENT ON COLUMN SBS1_ADMIN.DGTICSTATE.DGTICS_ID IS 'state id';

COMMENT ON COLUMN SBS1_ADMIN.DGTICSTATE.DGTICS_CODE IS 'code';

COMMENT ON COLUMN SBS1_ADMIN.DGTICSTATE.DGTICS_LANG01 IS 'language 1';

COMMENT ON COLUMN SBS1_ADMIN.DGTICSTATE.DGTICS_LANG02 IS 'language 2';

COMMENT ON COLUMN SBS1_ADMIN.DGTICSTATE.DGTICS_LANG03 IS 'language 3';

COMMENT ON COLUMN SBS1_ADMIN.DGTICSTATE.DGTICS_LANG04 IS 'language 4';

COMMENT ON COLUMN SBS1_ADMIN.DGTICSTATE.DGTICS_VALUE1 IS 'value 1';

COMMENT ON COLUMN SBS1_ADMIN.DGTICSTATE.DGTICS_VALUE2 IS 'value 2';

COMMENT ON COLUMN SBS1_ADMIN.DGTICSTATE.DGTICS_VALUE3 IS 'value 3';

COMMENT ON COLUMN SBS1_ADMIN.DGTICSTATE.DGTICS_VALUE4 IS 'value 4';


--
-- DGTICTYPE  (Table) 
--
CREATE TABLE SBS1_ADMIN.DGTICTYPE
(
  DGTICT_ID      VARCHAR2(10 BYTE)              NOT NULL,
  DGTICT_CODE    VARCHAR2(10 BYTE)              NOT NULL,
  DGTICT_LANG01  VARCHAR2(100 BYTE),
  DGTICT_LANG02  VARCHAR2(100 BYTE),
  DGTICT_LANG03  VARCHAR2(100 BYTE),
  DGTICT_LANG04  VARCHAR2(100 BYTE),
  DGTICT_VALUE1  VARCHAR2(100 BYTE),
  DGTICT_VALUE2  VARCHAR2(100 BYTE),
  DGTICT_VALUE3  VARCHAR2(100 BYTE),
  DGTICT_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.DGTICTYPE IS 'dgti consolidation type';

COMMENT ON COLUMN SBS1_ADMIN.DGTICTYPE.DGTICT_ID IS 'type id';

COMMENT ON COLUMN SBS1_ADMIN.DGTICTYPE.DGTICT_CODE IS 'code';

COMMENT ON COLUMN SBS1_ADMIN.DGTICTYPE.DGTICT_LANG01 IS 'language 1';

COMMENT ON COLUMN SBS1_ADMIN.DGTICTYPE.DGTICT_LANG02 IS 'language 2';

COMMENT ON COLUMN SBS1_ADMIN.DGTICTYPE.DGTICT_LANG03 IS 'language 3';

COMMENT ON COLUMN SBS1_ADMIN.DGTICTYPE.DGTICT_LANG04 IS 'language 4';

COMMENT ON COLUMN SBS1_ADMIN.DGTICTYPE.DGTICT_VALUE1 IS 'value 1';

COMMENT ON COLUMN SBS1_ADMIN.DGTICTYPE.DGTICT_VALUE2 IS 'value 2';

COMMENT ON COLUMN SBS1_ADMIN.DGTICTYPE.DGTICT_VALUE3 IS 'value 3';

COMMENT ON COLUMN SBS1_ADMIN.DGTICTYPE.DGTICT_VALUE4 IS 'value 4';


--
-- ENPLAACTIONTYPE  (Table) 
--
CREATE TABLE SBS1_ADMIN.ENPLAACTIONTYPE
(
  ENPLARAT_ID      VARCHAR2(10 BYTE)            NOT NULL,
  ENPLARAT_CODE    VARCHAR2(10 BYTE)            NOT NULL,
  ENPLARAT_LANG01  VARCHAR2(100 BYTE),
  ENPLARAT_LANG02  VARCHAR2(100 BYTE),
  ENPLARAT_LANG03  VARCHAR2(100 BYTE),
  ENPLARAT_LANG04  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.ENPLAACTIONTYPE IS 'Enabler Platform Range Action Type';


--
-- ENPLAPARAMETER_OTHERS  (Table) 
--
CREATE TABLE SBS1_ADMIN.ENPLAPARAMETER_OTHERS
(
  ENPLAP_ID           VARCHAR2(10 BYTE)         NOT NULL,
  ENPLAP_ENPLATID     VARCHAR2(10 BYTE),
  ENPLAP_CODE         VARCHAR2(10 BYTE)         NOT NULL,
  ENPLAP_NAME         VARCHAR2(40 BYTE)         NOT NULL,
  ENPLAP_LANG01       VARCHAR2(100 BYTE),
  ENPLAP_LANG02       VARCHAR2(100 BYTE),
  ENPLAP_LANG03       VARCHAR2(100 BYTE),
  ENPLAP_LANG04       VARCHAR2(100 BYTE),
  ENPLAP_ENPLAPPID    VARCHAR2(10 BYTE),
  ENPLAP_ETID         VARCHAR2(10 BYTE),
  ENPLAP_EXAMPLE      VARCHAR2(1000 BYTE),
  ENPLAP_DESC1        VARCHAR2(1000 BYTE),
  ENPLAP_DESC2        VARCHAR2(1000 BYTE),
  ENPLAP_DESC3        VARCHAR2(1000 BYTE),
  ENPLAP_DESC4        VARCHAR2(1000 BYTE),
  ENPLAP_CHECKS       VARCHAR2(1000 BYTE),
  ENPLAP_ACTION       VARCHAR2(1000 BYTE),
  ENPLAP_MESSAGE      VARCHAR2(1000 BYTE),
  ENPLAP_SHOWGROUP    NUMBER(1),
  ENPLAP_SHOWSERVICE  NUMBER(1),
  ENPLAP_DEFAULT      VARCHAR2(1000 BYTE)       NOT NULL,
  ENPLAP_ENPLAPLID    VARCHAR2(10 BYTE)         NOT NULL,
  ENPLAP_VALIDATE     VARCHAR2(255 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;


--
-- ENPLARANGE  (Table) 
--
CREATE TABLE SBS1_ADMIN.ENPLARANGE
(
  ENPLAR_ID           VARCHAR2(10 BYTE)         NOT NULL,
  ENPLAR_CODE         VARCHAR2(10 BYTE)         NOT NULL,
  ENPLAR_ETID         VARCHAR2(10 BYTE),
  ENPLAR_NAME         VARCHAR2(40 BYTE),
  ENPLAR_ESID         VARCHAR2(10 BYTE),
  ENPLAR_EXPIRE_DATE  DATE,
  ENPLAR_COMMENT      VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.ENPLARANGE IS 'Enabler Platform Address Range';


--
-- ENPLARANGEENTRY  (Table) 
--
CREATE TABLE SBS1_ADMIN.ENPLARANGEENTRY
(
  ENPLARE_ENPLARID  VARCHAR2(10 BYTE)           NOT NULL,
  ENPLARE_PREFIX    VARCHAR2(40 BYTE)           NOT NULL,
  ENPLARE_START     NUMBER(20)                  NOT NULL,
  ENPLARE_END       NUMBER(20),
  ENPLARE_COMMENT   VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.ENPLARANGEENTRY IS 'Enabler Platform Address Range Entry';


--
-- ENPLARANGESTATE  (Table) 
--
CREATE TABLE SBS1_ADMIN.ENPLARANGESTATE
(
  ENPLARS_ID      VARCHAR2(1 BYTE)              NOT NULL,
  ENPLARS_CODE    VARCHAR2(10 BYTE)             NOT NULL,
  ENPLARS_LANG01  VARCHAR2(100 BYTE),
  ENPLARS_LANG02  VARCHAR2(100 BYTE),
  ENPLARS_LANG03  VARCHAR2(100 BYTE),
  ENPLARS_LANG04  VARCHAR2(100 BYTE),
  ENPLARS_VALUE1  VARCHAR2(100 BYTE),
  ENPLARS_VALUE2  VARCHAR2(100 BYTE),
  ENPLARS_VALUE3  VARCHAR2(100 BYTE),
  ENPLARS_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.ENPLARANGESTATE IS 'States for Enabler Platform Ranges';


--
-- ENUMERATOR  (Table) 
--
CREATE TABLE SBS1_ADMIN.ENUMERATOR
(
  ENUM_ID  NUMBER(2)                            NOT NULL
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.ENUMERATOR IS 'Enumerator';

COMMENT ON COLUMN SBS1_ADMIN.ENUMERATOR.ENUM_ID IS 'enumerator';


--
-- ENUM256  (Table) 
--
CREATE TABLE SBS1_ADMIN.ENUM256
(
  ENUM_ID  NUMBER(3)                            NOT NULL
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.ENUM256 IS 'Enumerator 1..256';


--
-- ERRDEF  (Table) 
--
CREATE TABLE SBS1_ADMIN.ERRDEF
(
  ERRD_ID           VARCHAR2(10 BYTE)           NOT NULL,
  ERRD_CODE         VARCHAR2(10 BYTE)           NOT NULL,
  ERRD_LANG01       VARCHAR2(4000 BYTE),
  ERRD_LANG02       VARCHAR2(100 BYTE),
  ERRD_LANG03       VARCHAR2(100 BYTE),
  ERRD_LANG04       VARCHAR2(100 BYTE),
  ERRD_VALUE1       VARCHAR2(100 BYTE),
  ERRD_VALUE2       VARCHAR2(100 BYTE),
  ERRD_VALUE3       VARCHAR2(100 BYTE),
  ERRD_VALUE4       VARCHAR2(100 BYTE),
  ERRD_EXCEPTION    VARCHAR2(100 BYTE),
  ERRD_APPLICATION  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          16K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.ERRDEF IS 'Error definition';


--
-- ERRORVIEW  (Table) 
--
CREATE TABLE SBS1_ADMIN.ERRORVIEW
(
  ERV_ID    VARCHAR2(10 BYTE)                   NOT NULL,
  ERV_NAME  VARCHAR2(100 BYTE)                  NOT NULL,
  ERV_INFO  VARCHAR2(1000 BYTE),
  ERV_SQL   VARCHAR2(4000 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.ERRORVIEW IS 'Views on recent platform errors';


--
-- ERRTYPE  (Table) 
--
CREATE TABLE SBS1_ADMIN.ERRTYPE
(
  ERRT_ID      VARCHAR2(10 BYTE)                NOT NULL,
  ERRT_CODE    VARCHAR2(10 BYTE)                NOT NULL,
  ERRT_LANG01  VARCHAR2(100 BYTE),
  ERRT_LANG02  VARCHAR2(100 BYTE),
  ERRT_LANG03  VARCHAR2(100 BYTE),
  ERRT_LANG04  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.ERRTYPE IS 'error type';

COMMENT ON COLUMN SBS1_ADMIN.ERRTYPE.ERRT_ID IS 'type id';

COMMENT ON COLUMN SBS1_ADMIN.ERRTYPE.ERRT_CODE IS 'code';

COMMENT ON COLUMN SBS1_ADMIN.ERRTYPE.ERRT_LANG01 IS 'language 1';

COMMENT ON COLUMN SBS1_ADMIN.ERRTYPE.ERRT_LANG02 IS 'language 2';

COMMENT ON COLUMN SBS1_ADMIN.ERRTYPE.ERRT_LANG03 IS 'language 3';

COMMENT ON COLUMN SBS1_ADMIN.ERRTYPE.ERRT_LANG04 IS 'language 4';


--
-- ERVPERMISSIONS  (Table) 
--
CREATE TABLE SBS1_ADMIN.ERVPERMISSIONS
(
  ERVP_ACTID  VARCHAR2(10 BYTE)                 NOT NULL,
  ERVP_ERVID  VARCHAR2(10 BYTE)                 NOT NULL
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.ERVPERMISSIONS IS 'Permission to access error views';


--
-- ERVTIMESPAN  (Table) 
--
CREATE TABLE SBS1_ADMIN.ERVTIMESPAN
(
  ERVTSP_ID     VARCHAR2(10 BYTE)               NOT NULL,
  ERVTSP_NAME   VARCHAR2(100 BYTE)              NOT NULL,
  ERVTSP_VALUE  NUMBER(12,6)                    NOT NULL
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.ERVTIMESPAN IS 'Allows selection of errorview timespans (in days)';


--
-- EXCHANGERATE  (Table) 
--
CREATE TABLE SBS1_ADMIN.EXCHANGERATE
(
  EXR_ID       VARCHAR2(10 BYTE)                NOT NULL,
  EXR_CURID    VARCHAR2(10 BYTE)                NOT NULL,
  EXR_VALUE    NUMBER(14,6)                     NOT NULL,
  EXR_START    DATE                             NOT NULL,
  EXR_END      DATE                             NOT NULL,
  EXR_CHNGCNT  NUMBER(5),
  EXR_ACIDCRE  VARCHAR2(10 BYTE),
  EXR_DATECRE  DATE,
  EXR_ACIDMOD  VARCHAR2(10 BYTE),
  EXR_DATEMOD  DATE,
  EXR_COMMENT  VARCHAR2(1000 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;


--
-- GART  (Table) 
--
CREATE TABLE SBS1_ADMIN.GART
(
  GRT_ID            NUMBER(3)                   NOT NULL,
  GRT_CODE          VARCHAR2(10 BYTE)           NOT NULL,
  GRT_LANG01        VARCHAR2(100 BYTE),
  GRT_LANG02        VARCHAR2(100 BYTE),
  GRT_LANG03        VARCHAR2(100 BYTE),
  GRT_LANG04        VARCHAR2(100 BYTE),
  GRT_VALUE1        VARCHAR2(100 BYTE),
  GRT_VALUE2        VARCHAR2(100 BYTE),
  GRT_VALUE3        VARCHAR2(100 BYTE),
  GRT_VALUE4        VARCHAR2(100 BYTE),
  GRT_CODEREF       VARCHAR2(10 BYTE),
  GRT_CGIPREFIX     VARCHAR2(20 BYTE),
  GRT_CGIPREFIXREF  VARCHAR2(20 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.GART IS 'gart';


--
-- IMSIRANGE  (Table) 
--
CREATE TABLE SBS1_ADMIN.IMSIRANGE
(
  IMR_ID        VARCHAR2(10 BYTE)               NOT NULL,
  IMR_CONOPKEY  VARCHAR2(10 BYTE)               NOT NULL,
  IMR_MCC       VARCHAR2(10 BYTE),
  IMR_MNC       VARCHAR2(10 BYTE),
  IMR_DETECTED  DATE,
  IMR_COUNTDET  NUMBER(8),
  IMR_DATECRE   DATE,
  IMR_ACIDCRE   VARCHAR2(10 BYTE),
  IMR_DATEMOD   DATE,
  IMR_ACIDMOD   VARCHAR2(10 BYTE),
  IMR_CHNGCNT   NUMBER(5)
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.IMSIRANGE IS 'Imsi Range';

COMMENT ON COLUMN SBS1_ADMIN.IMSIRANGE.IMR_ID IS 'id';

COMMENT ON COLUMN SBS1_ADMIN.IMSIRANGE.IMR_CONOPKEY IS 'operator key';

COMMENT ON COLUMN SBS1_ADMIN.IMSIRANGE.IMR_MCC IS 'mcc';

COMMENT ON COLUMN SBS1_ADMIN.IMSIRANGE.IMR_MNC IS 'mnc';

COMMENT ON COLUMN SBS1_ADMIN.IMSIRANGE.IMR_DETECTED IS 'last detected';

COMMENT ON COLUMN SBS1_ADMIN.IMSIRANGE.IMR_COUNTDET IS 'count detected';

COMMENT ON COLUMN SBS1_ADMIN.IMSIRANGE.IMR_DATECRE IS 'creation date';

COMMENT ON COLUMN SBS1_ADMIN.IMSIRANGE.IMR_ACIDCRE IS 'creation account id';

COMMENT ON COLUMN SBS1_ADMIN.IMSIRANGE.IMR_DATEMOD IS 'modification date';

COMMENT ON COLUMN SBS1_ADMIN.IMSIRANGE.IMR_ACIDMOD IS 'modification account id';

COMMENT ON COLUMN SBS1_ADMIN.IMSIRANGE.IMR_CHNGCNT IS 'change counter';


--
-- INDEXSTATE  (Table) 
--
CREATE TABLE SBS1_ADMIN.INDEXSTATE
(
  INDEXS_MAPID   VARCHAR2(10 BYTE)              NOT NULL,
  INDEXS_ID      VARCHAR2(1 BYTE)               NOT NULL,
  INDEXS_CODE    VARCHAR2(10 BYTE)              NOT NULL,
  INDEXS_LANG01  VARCHAR2(100 BYTE),
  INDEXS_LANG02  VARCHAR2(100 BYTE),
  INDEXS_LANG03  VARCHAR2(100 BYTE),
  INDEXS_LANG04  VARCHAR2(100 BYTE),
  INDEXS_VALUE1  VARCHAR2(100 BYTE),
  INDEXS_VALUE2  VARCHAR2(100 BYTE),
  INDEXS_VALUE3  VARCHAR2(100 BYTE),
  INDEXS_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.INDEXSTATE IS 'Soft indexing state';


--
-- IRANGE  (Table) 
--
CREATE TABLE SBS1_ADMIN.IRANGE
(
  IMR_MCC      VARCHAR2(10 BYTE)                NOT NULL,
  IMR_MNC      VARCHAR2(10 BYTE),
  IMR_COUNTRY  VARCHAR2(100 BYTE)               NOT NULL,
  IMR_OPNAME   VARCHAR2(100 BYTE)               NOT NULL,
  IMR_CARID    VARCHAR2(10 BYTE)                NOT NULL
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    30
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          104K
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.IRANGE IS 'imsi range import table';

COMMENT ON COLUMN SBS1_ADMIN.IRANGE.IMR_MCC IS 'mcc';

COMMENT ON COLUMN SBS1_ADMIN.IRANGE.IMR_MNC IS 'mnc';

COMMENT ON COLUMN SBS1_ADMIN.IRANGE.IMR_COUNTRY IS 'country';

COMMENT ON COLUMN SBS1_ADMIN.IRANGE.IMR_OPNAME IS 'operator name';

COMMENT ON COLUMN SBS1_ADMIN.IRANGE.IMR_CARID IS 'carrier id';


--
-- ISC_AGGREGATION  (Table) 
--
CREATE TABLE SBS1_ADMIN.ISC_AGGREGATION
(
  ISCA_ID       VARCHAR2(10 BYTE)               NOT NULL,
  ISCA_SEPID    VARCHAR2(10 BYTE),
  ISCA_CONID    VARCHAR2(10 BYTE),
  ISCA_SHORTID  VARCHAR2(10 BYTE),
  ISCA_SERVICE  VARCHAR2(20 BYTE)               NOT NULL,
  ISCA_COUNT    NUMBER(12)
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.ISC_AGGREGATION IS 'isc aggregation';

COMMENT ON COLUMN SBS1_ADMIN.ISC_AGGREGATION.ISCA_ID IS 'entity id';

COMMENT ON COLUMN SBS1_ADMIN.ISC_AGGREGATION.ISCA_SEPID IS 'settlement period id';

COMMENT ON COLUMN SBS1_ADMIN.ISC_AGGREGATION.ISCA_CONID IS 'contract';

COMMENT ON COLUMN SBS1_ADMIN.ISC_AGGREGATION.ISCA_SHORTID IS 'short id';

COMMENT ON COLUMN SBS1_ADMIN.ISC_AGGREGATION.ISCA_SERVICE IS 'service';

COMMENT ON COLUMN SBS1_ADMIN.ISC_AGGREGATION.ISCA_COUNT IS 'counter';


--
-- ISCCDRTYPE  (Table) 
--
CREATE TABLE SBS1_ADMIN.ISCCDRTYPE
(
  ISCCDRT_ID     VARCHAR2(10 BYTE)              NOT NULL,
  SCCDRT_CODE    VARCHAR2(10 BYTE)              NOT NULL,
  SCCDRT_LANG01  VARCHAR2(100 BYTE),
  SCCDRT_LANG02  VARCHAR2(100 BYTE),
  SCCDRT_LANG03  VARCHAR2(100 BYTE),
  SCCDRT_LANG04  VARCHAR2(100 BYTE),
  SCCDRT_VALUE1  VARCHAR2(100 BYTE),
  SCCDRT_VALUE2  VARCHAR2(100 BYTE),
  SCCDRT_VALUE3  VARCHAR2(100 BYTE),
  SCCDRT_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.ISCCDRTYPE IS 'is consolidation cdr type';

COMMENT ON COLUMN SBS1_ADMIN.ISCCDRTYPE.ISCCDRT_ID IS 'type id';

COMMENT ON COLUMN SBS1_ADMIN.ISCCDRTYPE.SCCDRT_CODE IS 'code';

COMMENT ON COLUMN SBS1_ADMIN.ISCCDRTYPE.SCCDRT_LANG01 IS 'language 1';

COMMENT ON COLUMN SBS1_ADMIN.ISCCDRTYPE.SCCDRT_LANG02 IS 'language 2';

COMMENT ON COLUMN SBS1_ADMIN.ISCCDRTYPE.SCCDRT_LANG03 IS 'language 3';

COMMENT ON COLUMN SBS1_ADMIN.ISCCDRTYPE.SCCDRT_LANG04 IS 'language 4';

COMMENT ON COLUMN SBS1_ADMIN.ISCCDRTYPE.SCCDRT_VALUE1 IS 'value 1';

COMMENT ON COLUMN SBS1_ADMIN.ISCCDRTYPE.SCCDRT_VALUE2 IS 'value 2';

COMMENT ON COLUMN SBS1_ADMIN.ISCCDRTYPE.SCCDRT_VALUE3 IS 'value 3';

COMMENT ON COLUMN SBS1_ADMIN.ISCCDRTYPE.SCCDRT_VALUE4 IS 'value 4';


--
-- ISCSTATE  (Table) 
--
CREATE TABLE SBS1_ADMIN.ISCSTATE
(
  ISCS_ID      VARCHAR2(10 BYTE)                NOT NULL,
  ISCS_CODE    VARCHAR2(10 BYTE)                NOT NULL,
  ISCS_LANG01  VARCHAR2(100 BYTE),
  ISCS_LANG02  VARCHAR2(100 BYTE),
  ISCS_LANG03  VARCHAR2(100 BYTE),
  ISCS_LANG04  VARCHAR2(100 BYTE),
  ISCS_VALUE1  VARCHAR2(100 BYTE),
  ISCS_VALUE2  VARCHAR2(100 BYTE),
  ISCS_VALUE3  VARCHAR2(100 BYTE),
  ISCS_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.ISCSTATE IS 'is consolidation table state';

COMMENT ON COLUMN SBS1_ADMIN.ISCSTATE.ISCS_ID IS 'state id';

COMMENT ON COLUMN SBS1_ADMIN.ISCSTATE.ISCS_CODE IS 'code';

COMMENT ON COLUMN SBS1_ADMIN.ISCSTATE.ISCS_LANG01 IS 'language 1';

COMMENT ON COLUMN SBS1_ADMIN.ISCSTATE.ISCS_LANG02 IS 'language 2';

COMMENT ON COLUMN SBS1_ADMIN.ISCSTATE.ISCS_LANG03 IS 'language 3';

COMMENT ON COLUMN SBS1_ADMIN.ISCSTATE.ISCS_LANG04 IS 'language 4';

COMMENT ON COLUMN SBS1_ADMIN.ISCSTATE.ISCS_VALUE1 IS 'value 1';

COMMENT ON COLUMN SBS1_ADMIN.ISCSTATE.ISCS_VALUE2 IS 'value 2';

COMMENT ON COLUMN SBS1_ADMIN.ISCSTATE.ISCS_VALUE3 IS 'value 3';

COMMENT ON COLUMN SBS1_ADMIN.ISCSTATE.ISCS_VALUE4 IS 'value 4';


--
-- ISMSTAT  (Table) 
--
CREATE TABLE SBS1_ADMIN.ISMSTAT
(
  ISM_MSISDN     NUMBER(16)                     NOT NULL,
  ISM_CONSUB     VARCHAR2(10 BYTE)              NOT NULL,
  ISM_SHORTID    NUMBER(5)                      NOT NULL,
  ISM_KEYWORD    VARCHAR2(30 BYTE)              NOT NULL,
  ISM_PUSHCOUNT  NUMBER(6),
  ISM_PULLCOUNT  NUMBER(6),
  ISM_AMOUNTCU   NUMBER(9,4), 
  CONSTRAINT PK_ISMSTAT
  PRIMARY KEY
  (ISM_MSISDN, ISM_CONSUB, ISM_SHORTID, ISM_KEYWORD)
  ENABLE VALIDATE
)
ORGANIZATION INDEX
PCTTHRESHOLD 50
TABLESPACE SBS1_APPLICATION_DATA
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

COMMENT ON TABLE SBS1_ADMIN.ISMSTAT IS 'infoservices';

COMMENT ON COLUMN SBS1_ADMIN.ISMSTAT.ISM_MSISDN IS 'msisdn of customer';

COMMENT ON COLUMN SBS1_ADMIN.ISMSTAT.ISM_CONSUB IS 'contract subtype';

COMMENT ON COLUMN SBS1_ADMIN.ISMSTAT.ISM_SHORTID IS 'short id';

COMMENT ON COLUMN SBS1_ADMIN.ISMSTAT.ISM_KEYWORD IS 'keyword';

COMMENT ON COLUMN SBS1_ADMIN.ISMSTAT.ISM_PUSHCOUNT IS 'push counters';

COMMENT ON COLUMN SBS1_ADMIN.ISMSTAT.ISM_PULLCOUNT IS 'pull counters';

COMMENT ON COLUMN SBS1_ADMIN.ISMSTAT.ISM_AMOUNTCU IS 'amount customer';


--
-- ISSTATE  (Table) 
--
CREATE TABLE SBS1_ADMIN.ISSTATE
(
  ISS_ID      VARCHAR2(10 BYTE)                 NOT NULL,
  ISS_CODE    VARCHAR2(10 BYTE)                 NOT NULL,
  ISS_LANG01  VARCHAR2(100 BYTE),
  ISS_LANG02  VARCHAR2(100 BYTE),
  ISS_LANG03  VARCHAR2(100 BYTE),
  ISS_LANG04  VARCHAR2(100 BYTE),
  ISS_VALUE1  VARCHAR2(100 BYTE),
  ISS_VALUE2  VARCHAR2(100 BYTE),
  ISS_VALUE3  VARCHAR2(100 BYTE),
  ISS_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.ISSTATE IS 'Issuestate';


--
-- ISTYPE  (Table) 
--
CREATE TABLE SBS1_ADMIN.ISTYPE
(
  IST_ID      VARCHAR2(10 BYTE)                 NOT NULL,
  IST_CODE    VARCHAR2(10 BYTE)                 NOT NULL,
  IST_LANG01  VARCHAR2(100 BYTE),
  IST_LANG02  VARCHAR2(100 BYTE),
  IST_LANG03  VARCHAR2(100 BYTE),
  IST_LANG04  VARCHAR2(100 BYTE),
  IST_VALUE1  VARCHAR2(100 BYTE),
  IST_VALUE2  VARCHAR2(100 BYTE),
  IST_VALUE3  VARCHAR2(100 BYTE),
  IST_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.ISTYPE IS 'Issue type';


--
-- IWDIRECTION  (Table) 
--
CREATE TABLE SBS1_ADMIN.IWDIRECTION
(
  IWD_ID      VARCHAR2(10 BYTE)                 NOT NULL,
  IWD_CODE    VARCHAR2(10 BYTE)                 NOT NULL,
  IWD_LANG01  VARCHAR2(100 BYTE),
  IWD_LANG02  VARCHAR2(100 BYTE),
  IWD_LANG03  VARCHAR2(100 BYTE),
  IWD_LANG04  VARCHAR2(100 BYTE),
  IWD_VALUE1  VARCHAR2(100 BYTE),
  IWD_VALUE2  VARCHAR2(100 BYTE),
  IWD_VALUE3  VARCHAR2(100 BYTE),
  IWD_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.IWDIRECTION IS 'Interworking direction';


--
-- IWTSSTATE  (Table) 
--
CREATE TABLE SBS1_ADMIN.IWTSSTATE
(
  IWTSS_ID      VARCHAR2(10 BYTE)               NOT NULL,
  IWTSS_CODE    VARCHAR2(10 BYTE)               NOT NULL,
  IWTSS_LANG01  VARCHAR2(100 BYTE),
  IWTSS_LANG02  VARCHAR2(100 BYTE),
  IWTSS_LANG03  VARCHAR2(100 BYTE),
  IWTS_LANG04   VARCHAR2(100 BYTE),
  IWTSS_VALUE1  VARCHAR2(100 BYTE),
  IWTSS_VALUE2  VARCHAR2(100 BYTE),
  IWTSS_VALUE3  VARCHAR2(100 BYTE),
  IWTSS_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;


--
-- KPI_HISTORY  (Table) 
--
CREATE TABLE SBS1_ADMIN.KPI_HISTORY
(
  KPIH_VIEW    VARCHAR2(20 BYTE)                NOT NULL,
  KPIH_PERIOD  VARCHAR2(20 BYTE)                NOT NULL,
  KPIH_C01     NUMBER,
  KPIH_C02     NUMBER,
  KPIH_C03     NUMBER,
  KPIH_C04     NUMBER,
  KPIH_C05     NUMBER,
  KPIH_C06     NUMBER,
  KPIH_C07     NUMBER,
  KPIH_C08     NUMBER,
  KPIH_C09     NUMBER,
  KPIH_C10     NUMBER,
  KPIH_C11     NUMBER,
  KPIH_C12     NUMBER,
  KPIH_C13     NUMBER,
  KPIH_C14     NUMBER,
  KPIH_C15     NUMBER,
  KPIH_C16     NUMBER,
  KPIH_C17     NUMBER,
  KPIH_C18     NUMBER,
  KPIH_C19     NUMBER,
  KPIH_C20     NUMBER
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.KPI_HISTORY IS 'History store for KPI data';


--
-- LANGUAGE  (Table) 
--
CREATE TABLE SBS1_ADMIN.LANGUAGE
(
  LANG_ID       VARCHAR2(2 BYTE)                NOT NULL,
  LANG_CODE     VARCHAR2(10 BYTE)               NOT NULL,
  LANG_SUBCODE  VARCHAR2(10 BYTE),
  LANG_LANG01   VARCHAR2(100 BYTE),
  LANG_LANG02   VARCHAR2(100 BYTE),
  LANG_LANG03   VARCHAR2(100 BYTE),
  LANG_LANG04   VARCHAR2(100 BYTE),
  LANG_VALUE1   VARCHAR2(100 BYTE),
  LANG_VALUE2   VARCHAR2(100 BYTE),
  LANG_VALUE3   VARCHAR2(100 BYTE),
  LANG_VALUE4   VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.LANGUAGE IS 'Language';


--
-- LOG_DEBUG  (Table) 
--
CREATE TABLE SBS1_ADMIN.LOG_DEBUG
(
  LDB_LINECNT   NUMBER,
  LDB_TIME      DATE,
  LDB_DEBUGSTR  VARCHAR2(2000 BYTE),
  LDB_HINT      VARCHAR2(2000 BYTE)
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.LOG_DEBUG IS 'Table for general debugging information
May be truncated anytime in productive operation
 ';

COMMENT ON COLUMN SBS1_ADMIN.LOG_DEBUG.LDB_LINECNT IS 'debug line count';

COMMENT ON COLUMN SBS1_ADMIN.LOG_DEBUG.LDB_TIME IS 'debug time';

COMMENT ON COLUMN SBS1_ADMIN.LOG_DEBUG.LDB_DEBUGSTR IS 'debug string';

COMMENT ON COLUMN SBS1_ADMIN.LOG_DEBUG.LDB_HINT IS 'debug hint';


--
-- LOGGER_LOGS  (Table) 
--
CREATE TABLE SBS1_ADMIN.LOGGER_LOGS
(
  ID                 NUMBER,
  LOGGER_LEVEL       NUMBER                     NOT NULL,
  TEXT               VARCHAR2(4000 BYTE),
  TIME_STAMP         TIMESTAMP(6)               NOT NULL,
  SCOPE              VARCHAR2(1000 BYTE),
  MODULE             VARCHAR2(100 BYTE),
  ACTION             VARCHAR2(100 BYTE),
  USER_NAME          VARCHAR2(255 BYTE),
  CLIENT_IDENTIFIER  VARCHAR2(255 BYTE),
  CALL_STACK         VARCHAR2(4000 BYTE),
  UNIT_NAME          VARCHAR2(255 BYTE),
  LINE_NO            VARCHAR2(100 BYTE),
  SCN                NUMBER,
  EXTRA              CLOB,
  SID                NUMBER,
  CLIENT_INFO        VARCHAR2(64 BYTE)
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;


--
-- LONGIDMSTATE  (Table) 
--
CREATE TABLE SBS1_ADMIN.LONGIDMSTATE
(
  LONGIDMS_ID      VARCHAR2(10 BYTE)            NOT NULL,
  LONGIDMS_CODE    VARCHAR2(10 BYTE)            NOT NULL,
  LONGIDMS_LANG01  VARCHAR2(100 BYTE),
  LONGIDMS_LANG02  VARCHAR2(100 BYTE),
  LONGIDMS_LANG03  VARCHAR2(100 BYTE),
  LONGIDMS_LANG04  VARCHAR2(100 BYTE),
  LONGIDMS_VALUE1  VARCHAR2(100 BYTE),
  LONGIDMS_VALUE2  VARCHAR2(100 BYTE),
  LONGIDMS_VALUE3  VARCHAR2(100 BYTE),
  LONGIDMS_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.LONGIDMSTATE IS 'LongID Mapping States:
M = mapped (pre-assigned or active) 
I = inactive mapping (quarantine)
F = fresh, free, available
R = recovered (after quarantine)';


--
-- LOOPTYPE  (Table) 
--
CREATE TABLE SBS1_ADMIN.LOOPTYPE
(
  LT_ID      VARCHAR2(10 BYTE)                  NOT NULL,
  LT_CODE    VARCHAR2(10 BYTE)                  NOT NULL,
  LT_LANG01  VARCHAR2(100 BYTE),
  LT_LANG02  VARCHAR2(100 BYTE),
  LT_LANG03  VARCHAR2(100 BYTE),
  LT_LANG04  VARCHAR2(100 BYTE),
  LT_VALUE1  VARCHAR2(100 BYTE),
  LT_VALUE2  VARCHAR2(100 BYTE),
  LT_VALUE3  VARCHAR2(100 BYTE),
  LT_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.LOOPTYPE IS 'Loop type';

COMMENT ON COLUMN SBS1_ADMIN.LOOPTYPE.LT_ID IS 'type id';

COMMENT ON COLUMN SBS1_ADMIN.LOOPTYPE.LT_CODE IS 'code';

COMMENT ON COLUMN SBS1_ADMIN.LOOPTYPE.LT_LANG01 IS 'language 1';

COMMENT ON COLUMN SBS1_ADMIN.LOOPTYPE.LT_LANG02 IS 'language 2';

COMMENT ON COLUMN SBS1_ADMIN.LOOPTYPE.LT_LANG03 IS 'language 3';

COMMENT ON COLUMN SBS1_ADMIN.LOOPTYPE.LT_LANG04 IS 'language 4';

COMMENT ON COLUMN SBS1_ADMIN.LOOPTYPE.LT_VALUE1 IS 'value 1';

COMMENT ON COLUMN SBS1_ADMIN.LOOPTYPE.LT_VALUE2 IS 'value 2';

COMMENT ON COLUMN SBS1_ADMIN.LOOPTYPE.LT_VALUE3 IS 'value 3';

COMMENT ON COLUMN SBS1_ADMIN.LOOPTYPE.LT_VALUE4 IS 'value 4';


--
-- MAPSTATE  (Table) 
--
CREATE TABLE SBS1_ADMIN.MAPSTATE
(
  MAPS_ID      VARCHAR2(1 BYTE)                 NOT NULL,
  MAPS_CODE    VARCHAR2(10 BYTE)                NOT NULL,
  MAPS_LANG01  VARCHAR2(100 BYTE),
  MAPS_LANG02  VARCHAR2(100 BYTE),
  MAPS_LANG03  VARCHAR2(100 BYTE),
  MAPS_LANG04  VARCHAR2(100 BYTE),
  MAPS_VALUE1  VARCHAR2(100 BYTE),
  MAPS_VALUE2  VARCHAR2(100 BYTE),
  MAPS_VALUE3  VARCHAR2(100 BYTE),
  MAPS_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.MAPSTATE IS 'Mapping state';


--
-- MAPTYPE  (Table) 
--
CREATE TABLE SBS1_ADMIN.MAPTYPE
(
  MAPT_ID      VARCHAR2(10 BYTE)                NOT NULL,
  MAPT_CODE    VARCHAR2(10 BYTE)                NOT NULL,
  MAPT_LANG01  VARCHAR2(100 BYTE),
  MAPT_LANG02  VARCHAR2(100 BYTE),
  MAPT_LANG03  VARCHAR2(100 BYTE),
  MAPT_LANG04  VARCHAR2(100 BYTE),
  MAPT_VALUE1  VARCHAR2(100 BYTE),
  MAPT_VALUE2  VARCHAR2(100 BYTE),
  MAPT_VALUE3  VARCHAR2(100 BYTE),
  MAPT_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.MAPTYPE IS 'Mapping type';


--
-- MBUNIT  (Table) 
--
CREATE TABLE SBS1_ADMIN.MBUNIT
(
  MBU_ID      VARCHAR2(10 BYTE)                 NOT NULL,
  MBU_CODE    VARCHAR2(10 BYTE)                 NOT NULL,
  MBU_LANG01  VARCHAR2(100 BYTE),
  MBU_LANG02  VARCHAR2(100 BYTE),
  MBU_LANG03  VARCHAR2(100 BYTE),
  MBU_LANG04  VARCHAR2(100 BYTE),
  MBU_VALUE1  VARCHAR2(100 BYTE),
  MBU_VALUE2  VARCHAR2(100 BYTE),
  MBU_VALUE3  VARCHAR2(100 BYTE),
  MBU_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.MBUNIT IS 'mobile business unit';


--
-- MMSATYPE  (Table) 
--
CREATE TABLE SBS1_ADMIN.MMSATYPE
(
  MMSAT_ID      VARCHAR2(10 BYTE)               NOT NULL,
  MMSAT_CODE    VARCHAR2(10 BYTE)               NOT NULL,
  MMSAT_LANG01  VARCHAR2(100 BYTE),
  MMSAT_LANG02  VARCHAR2(100 BYTE),
  MMSAT_LANG03  VARCHAR2(100 BYTE),
  MMSAT_LANG04  VARCHAR2(100 BYTE),
  MMSAT_VALUE1  VARCHAR2(100 BYTE),
  MMSAT_VALUE2  VARCHAR2(100 BYTE),
  MMSAT_VALUE3  VARCHAR2(100 BYTE),
  MMSAT_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.MMSATYPE IS 'Mmsc address type';

COMMENT ON COLUMN SBS1_ADMIN.MMSATYPE.MMSAT_ID IS 'type id';

COMMENT ON COLUMN SBS1_ADMIN.MMSATYPE.MMSAT_CODE IS 'code';

COMMENT ON COLUMN SBS1_ADMIN.MMSATYPE.MMSAT_LANG01 IS 'language 1';

COMMENT ON COLUMN SBS1_ADMIN.MMSATYPE.MMSAT_LANG02 IS 'language 2';

COMMENT ON COLUMN SBS1_ADMIN.MMSATYPE.MMSAT_LANG03 IS 'language 3';

COMMENT ON COLUMN SBS1_ADMIN.MMSATYPE.MMSAT_LANG04 IS 'language 4';

COMMENT ON COLUMN SBS1_ADMIN.MMSATYPE.MMSAT_VALUE1 IS 'value 1';

COMMENT ON COLUMN SBS1_ADMIN.MMSATYPE.MMSAT_VALUE2 IS 'value 2';

COMMENT ON COLUMN SBS1_ADMIN.MMSATYPE.MMSAT_VALUE3 IS 'value 3';

COMMENT ON COLUMN SBS1_ADMIN.MMSATYPE.MMSAT_VALUE4 IS 'value 4';


--
-- MMSCC  (Table) 
--
CREATE TABLE SBS1_ADMIN.MMSCC
(
  MMSCC_ID          VARCHAR2(10 BYTE)           NOT NULL,
  MMSCC_CODE        VARCHAR2(10 BYTE)           NOT NULL,
  MMSCC_LANG01      VARCHAR2(100 BYTE),
  MMSCC_LANG02      VARCHAR2(100 BYTE),
  MMSCC_LANG03      VARCHAR2(100 BYTE),
  MMSCC_LANG04      VARCHAR2(100 BYTE),
  MMSCC_SELECTABLE  NUMBER(1)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.MMSCC IS 'MMS COUNTRY CODE';


--
-- MMSC_CDRRECTYPE  (Table) 
--
CREATE TABLE SBS1_ADMIN.MMSC_CDRRECTYPE
(
  MMSCCRT_ID      VARCHAR2(10 BYTE)             NOT NULL,
  MMSCCRT_CODE    VARCHAR2(10 BYTE)             NOT NULL,
  MMSCCRT_LANG01  VARCHAR2(100 BYTE),
  MMSCCRT_LANG02  VARCHAR2(100 BYTE),
  MMSCCRT_LANG03  VARCHAR2(100 BYTE),
  MMSCCRT_LANG04  VARCHAR2(100 BYTE),
  MMSCCRT_VALUE1  VARCHAR2(100 BYTE),
  MMSCCRT_VALUE2  VARCHAR2(100 BYTE),
  MMSCCRT_VALUE3  VARCHAR2(100 BYTE),
  MMSCCRT_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.MMSC_CDRRECTYPE IS 'Mmsc Cdr Record Type';


--
-- MMSC_EVENTDISPTYPE  (Table) 
--
CREATE TABLE SBS1_ADMIN.MMSC_EVENTDISPTYPE
(
  MMSCET_ID      VARCHAR2(10 BYTE)              NOT NULL,
  MMSCET_CODE    VARCHAR2(10 BYTE)              NOT NULL,
  MMSCET_LANG01  VARCHAR2(100 BYTE),
  MMSCET_LANG02  VARCHAR2(100 BYTE),
  MMSCET_LANG03  VARCHAR2(100 BYTE),
  MMSCET_LANG04  VARCHAR2(100 BYTE),
  MMSCET_VALUE1  VARCHAR2(500 BYTE),
  MMSCET_VALUE2  VARCHAR2(500 BYTE),
  MMSCET_VALUE3  VARCHAR2(500 BYTE),
  MMSCET_VALUE4  VARCHAR2(500 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.MMSC_EVENTDISPTYPE IS 'mmsc event disposition type table';


--
-- MMSC_MSGCLASS  (Table) 
--
CREATE TABLE SBS1_ADMIN.MMSC_MSGCLASS
(
  MMSCMC_ID      VARCHAR2(10 BYTE)              NOT NULL,
  MMSCMC_CODE    VARCHAR2(10 BYTE)              NOT NULL,
  MMSCMC_LANG01  VARCHAR2(100 BYTE),
  MMSCMC_LANG02  VARCHAR2(100 BYTE),
  MMSCMC_LANG03  VARCHAR2(100 BYTE),
  MMSCMC_LANG04  VARCHAR2(100 BYTE),
  MMSCMC_VALUE1  VARCHAR2(100 BYTE),
  MMSCMC_VALUE2  VARCHAR2(100 BYTE),
  MMSCMC_VALUE3  VARCHAR2(100 BYTE),
  MMSCMC_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.MMSC_MSGCLASS IS 'mmsc msg class table';


--
-- MMSC_MSGTYPE  (Table) 
--
CREATE TABLE SBS1_ADMIN.MMSC_MSGTYPE
(
  MMSCMT_ID      VARCHAR2(10 BYTE)              NOT NULL,
  MMSCMT_CODE    VARCHAR2(10 BYTE)              NOT NULL,
  MMSCMT_LANG01  VARCHAR2(100 BYTE),
  MMSCMT_LANG02  VARCHAR2(100 BYTE),
  MMSCMT_LANG03  VARCHAR2(100 BYTE),
  MMSCMT_LANG04  VARCHAR2(100 BYTE),
  MMSCMT_VALUE1  VARCHAR2(100 BYTE),
  MMSCMT_VALUE2  VARCHAR2(100 BYTE),
  MMSCMT_VALUE3  VARCHAR2(100 BYTE),
  MMSCMT_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.MMSC_MSGTYPE IS 'mmsc msg type table';


--
-- MMSDZ  (Table) 
--
CREATE TABLE SBS1_ADMIN.MMSDZ
(
  MMSDZ_ID        VARCHAR2(10 BYTE)             NOT NULL,
  MMSDZ_CODE      VARCHAR2(10 BYTE)             NOT NULL,
  MMSDZ_LANG01    VARCHAR2(100 BYTE),
  MMSDZ_LANG02    VARCHAR2(100 BYTE),
  MMSDZ_LANG03    VARCHAR2(100 BYTE),
  MMSDZ_LANG04    VARCHAR2(100 BYTE),
  MMSDZ_BILLCODE  VARCHAR2(10 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.MMSDZ IS 'MMS Destination Zone';


--
-- MMSRZ  (Table) 
--
CREATE TABLE SBS1_ADMIN.MMSRZ
(
  MMSRZ_ID        VARCHAR2(10 BYTE)             NOT NULL,
  MMSRZ_CODE      VARCHAR2(10 BYTE)             NOT NULL,
  MMSRZ_LANG01    VARCHAR2(100 BYTE),
  MMSRZ_LANG02    VARCHAR2(100 BYTE),
  MMSRZ_LANG03    VARCHAR2(100 BYTE),
  MMSRZ_LANG04    VARCHAR2(100 BYTE),
  MMSRZ_BILLCODE  VARCHAR2(10 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.MMSRZ IS 'MMS Roaming Zone';


--
-- MMSSZ  (Table) 
--
CREATE TABLE SBS1_ADMIN.MMSSZ
(
  MMSSZ_ID       VARCHAR2(10 BYTE)              NOT NULL,
  MMSSZ_CODE     VARCHAR2(10 BYTE)              NOT NULL,
  MMSSZ_LANG01   VARCHAR2(100 BYTE),
  MMSSZ_LANG02   VARCHAR2(100 BYTE),
  MMSSZ_LANG03   VARCHAR2(100 BYTE),
  MMSSZ_LANG04   VARCHAR2(100 BYTE),
  MMSSZ_MAXSIZE  NUMBER(10,3)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.MMSSZ IS 'MMS Size  Zone';


--
-- MOTYPE  (Table) 
--
CREATE TABLE SBS1_ADMIN.MOTYPE
(
  MOT_ID      NUMBER(1)                         NOT NULL,
  MOT_CODE    VARCHAR2(10 BYTE),
  MOT_LANG01  VARCHAR2(100 BYTE),
  MOT_LANG02  VARCHAR2(100 BYTE),
  MOT_LANG03  VARCHAR2(100 BYTE),
  MOT_LANG04  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.MOTYPE IS 'Contract handygroup type';


--
-- NBRRANGE  (Table) 
--
CREATE TABLE SBS1_ADMIN.NBRRANGE
(
  NBR_CODE     VARCHAR2(20 BYTE)                NOT NULL,
  NBR_COUNTRY  VARCHAR2(100 BYTE)               NOT NULL,
  NBR_CARID    VARCHAR2(10 BYTE)                NOT NULL,
  NBR_OPNAME   VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    30
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          104K
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.NBRRANGE IS 'number range import table';


--
-- NOTIFICATIONSTATE  (Table) 
--
CREATE TABLE SBS1_ADMIN.NOTIFICATIONSTATE
(
  NOTS_ID      VARCHAR2(1 BYTE)                 NOT NULL,
  NOTS_CODE    VARCHAR2(10 BYTE)                NOT NULL,
  NOTS_LANG01  VARCHAR2(100 BYTE),
  NOTS_LANG02  VARCHAR2(100 BYTE),
  NOTS_LANG03  VARCHAR2(100 BYTE),
  NOTS_LANG04  VARCHAR2(100 BYTE),
  NOTS_VALUE1  VARCHAR2(100 BYTE),
  NOTS_VALUE2  VARCHAR2(100 BYTE),
  NOTS_VALUE3  VARCHAR2(100 BYTE),
  NOTS_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.NOTIFICATIONSTATE IS 'Notification entity state';

COMMENT ON COLUMN SBS1_ADMIN.NOTIFICATIONSTATE.NOTS_ID IS 'state id';

COMMENT ON COLUMN SBS1_ADMIN.NOTIFICATIONSTATE.NOTS_CODE IS 'code';

COMMENT ON COLUMN SBS1_ADMIN.NOTIFICATIONSTATE.NOTS_LANG01 IS 'language 1';

COMMENT ON COLUMN SBS1_ADMIN.NOTIFICATIONSTATE.NOTS_LANG02 IS 'language 2';

COMMENT ON COLUMN SBS1_ADMIN.NOTIFICATIONSTATE.NOTS_LANG03 IS 'language 3';

COMMENT ON COLUMN SBS1_ADMIN.NOTIFICATIONSTATE.NOTS_LANG04 IS 'language 4';

COMMENT ON COLUMN SBS1_ADMIN.NOTIFICATIONSTATE.NOTS_VALUE1 IS 'value 1';

COMMENT ON COLUMN SBS1_ADMIN.NOTIFICATIONSTATE.NOTS_VALUE2 IS 'value 2';

COMMENT ON COLUMN SBS1_ADMIN.NOTIFICATIONSTATE.NOTS_VALUE3 IS 'value 3';

COMMENT ON COLUMN SBS1_ADMIN.NOTIFICATIONSTATE.NOTS_VALUE4 IS 'value 4';


--
-- NOTIFICATIONTYPE  (Table) 
--
CREATE TABLE SBS1_ADMIN.NOTIFICATIONTYPE
(
  NOTT_ID      VARCHAR2(10 BYTE)                NOT NULL,
  NOTT_CODE    VARCHAR2(10 BYTE)                NOT NULL,
  NOTT_LANG01  VARCHAR2(100 BYTE),
  NOTT_LANG02  VARCHAR2(100 BYTE),
  NOTT_LANG03  VARCHAR2(100 BYTE),
  NOTT_LANG04  VARCHAR2(100 BYTE),
  NOTT_VALUE1  VARCHAR2(100 BYTE),
  NOTT_VALUE2  VARCHAR2(100 BYTE),
  NOTT_VALUE3  VARCHAR2(100 BYTE),
  NOTT_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.NOTIFICATIONTYPE IS 'Notification Type';

COMMENT ON COLUMN SBS1_ADMIN.NOTIFICATIONTYPE.NOTT_ID IS 'type id';

COMMENT ON COLUMN SBS1_ADMIN.NOTIFICATIONTYPE.NOTT_CODE IS 'code';

COMMENT ON COLUMN SBS1_ADMIN.NOTIFICATIONTYPE.NOTT_LANG01 IS 'language 1';

COMMENT ON COLUMN SBS1_ADMIN.NOTIFICATIONTYPE.NOTT_LANG02 IS 'language 2';

COMMENT ON COLUMN SBS1_ADMIN.NOTIFICATIONTYPE.NOTT_LANG03 IS 'language 3';

COMMENT ON COLUMN SBS1_ADMIN.NOTIFICATIONTYPE.NOTT_LANG04 IS 'language 4';

COMMENT ON COLUMN SBS1_ADMIN.NOTIFICATIONTYPE.NOTT_VALUE1 IS 'value 1';

COMMENT ON COLUMN SBS1_ADMIN.NOTIFICATIONTYPE.NOTT_VALUE2 IS 'value 2';

COMMENT ON COLUMN SBS1_ADMIN.NOTIFICATIONTYPE.NOTT_VALUE3 IS 'value 3';

COMMENT ON COLUMN SBS1_ADMIN.NOTIFICATIONTYPE.NOTT_VALUE4 IS 'value 4';


--
-- OGTICSTATE  (Table) 
--
CREATE TABLE SBS1_ADMIN.OGTICSTATE
(
  OGTICS_ID      VARCHAR2(10 BYTE)              NOT NULL,
  OGTICS_CODE    VARCHAR2(10 BYTE)              NOT NULL,
  OGTICS_LANG01  VARCHAR2(100 BYTE),
  OGTICS_LANG02  VARCHAR2(100 BYTE),
  OGTICS_LANG03  VARCHAR2(100 BYTE),
  OGTICS_LANG04  VARCHAR2(100 BYTE),
  OGTICS_VALUE1  VARCHAR2(100 BYTE),
  OGTICS_VALUE2  VARCHAR2(100 BYTE),
  OGTICS_VALUE3  VARCHAR2(100 BYTE),
  OGTICS_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.OGTICSTATE IS 'ogti consolidation state';

COMMENT ON COLUMN SBS1_ADMIN.OGTICSTATE.OGTICS_ID IS 'state id';

COMMENT ON COLUMN SBS1_ADMIN.OGTICSTATE.OGTICS_CODE IS 'code';

COMMENT ON COLUMN SBS1_ADMIN.OGTICSTATE.OGTICS_LANG01 IS 'language 1';

COMMENT ON COLUMN SBS1_ADMIN.OGTICSTATE.OGTICS_LANG02 IS 'language 2';

COMMENT ON COLUMN SBS1_ADMIN.OGTICSTATE.OGTICS_LANG03 IS 'language 3';

COMMENT ON COLUMN SBS1_ADMIN.OGTICSTATE.OGTICS_LANG04 IS 'language 4';

COMMENT ON COLUMN SBS1_ADMIN.OGTICSTATE.OGTICS_VALUE1 IS 'value 1';

COMMENT ON COLUMN SBS1_ADMIN.OGTICSTATE.OGTICS_VALUE2 IS 'value 2';

COMMENT ON COLUMN SBS1_ADMIN.OGTICSTATE.OGTICS_VALUE3 IS 'value 3';

COMMENT ON COLUMN SBS1_ADMIN.OGTICSTATE.OGTICS_VALUE4 IS 'value 4';


--
-- OGTICTYPE  (Table) 
--
CREATE TABLE SBS1_ADMIN.OGTICTYPE
(
  OGTICT_ID      VARCHAR2(10 BYTE)              NOT NULL,
  OGTICT_CODE    VARCHAR2(10 BYTE)              NOT NULL,
  OGTICT_LANG01  VARCHAR2(100 BYTE),
  OGTICT_LANG02  VARCHAR2(100 BYTE),
  OGTICT_LANG03  VARCHAR2(100 BYTE),
  OGTICT_LANG04  VARCHAR2(100 BYTE),
  OGTICT_VALUE1  VARCHAR2(100 BYTE),
  OGTICT_VALUE2  VARCHAR2(100 BYTE),
  OGTICT_VALUE3  VARCHAR2(100 BYTE),
  OGTICT_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.OGTICTYPE IS 'ogti consolidation type';

COMMENT ON COLUMN SBS1_ADMIN.OGTICTYPE.OGTICT_ID IS 'type id';

COMMENT ON COLUMN SBS1_ADMIN.OGTICTYPE.OGTICT_CODE IS 'code';

COMMENT ON COLUMN SBS1_ADMIN.OGTICTYPE.OGTICT_LANG01 IS 'language 1';

COMMENT ON COLUMN SBS1_ADMIN.OGTICTYPE.OGTICT_LANG02 IS 'language 2';

COMMENT ON COLUMN SBS1_ADMIN.OGTICTYPE.OGTICT_LANG03 IS 'language 3';

COMMENT ON COLUMN SBS1_ADMIN.OGTICTYPE.OGTICT_LANG04 IS 'language 4';

COMMENT ON COLUMN SBS1_ADMIN.OGTICTYPE.OGTICT_VALUE1 IS 'value 1';

COMMENT ON COLUMN SBS1_ADMIN.OGTICTYPE.OGTICT_VALUE2 IS 'value 2';

COMMENT ON COLUMN SBS1_ADMIN.OGTICTYPE.OGTICT_VALUE3 IS 'value 3';

COMMENT ON COLUMN SBS1_ADMIN.OGTICTYPE.OGTICT_VALUE4 IS 'value 4';


--
-- PACITERATOR  (Table) 
--
CREATE TABLE SBS1_ADMIN.PACITERATOR
(
  PACI_ID       VARCHAR2(10 BYTE)               NOT NULL,
  PACI_LTID     VARCHAR2(10 BYTE)               NOT NULL,
  PACI_SQL      VARCHAR2(2000 BYTE)             NOT NULL,
  PACI_VERSION  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.PACITERATOR IS 'Iterator';

COMMENT ON COLUMN SBS1_ADMIN.PACITERATOR.PACI_ID IS 'Unique ID';

COMMENT ON COLUMN SBS1_ADMIN.PACITERATOR.PACI_LTID IS 'loop type';

COMMENT ON COLUMN SBS1_ADMIN.PACITERATOR.PACI_SQL IS 'sql statement';

COMMENT ON COLUMN SBS1_ADMIN.PACITERATOR.PACI_VERSION IS 'Version';


--
-- PACKINGSTATE  (Table) 
--
CREATE TABLE SBS1_ADMIN.PACKINGSTATE
(
  PACKS_ID      VARCHAR2(1 BYTE)                NOT NULL,
  PACKS_CODE    VARCHAR2(10 BYTE)               NOT NULL,
  PACKS_LANG01  VARCHAR2(100 BYTE),
  PACKS_LANG02  VARCHAR2(100 BYTE),
  PACKS_LANG03  VARCHAR2(100 BYTE),
  PACKS_LANG04  VARCHAR2(100 BYTE),
  PACKS_VALUE1  VARCHAR2(100 BYTE),
  PACKS_VALUE2  VARCHAR2(100 BYTE),
  PACKS_VALUE3  VARCHAR2(100 BYTE),
  PACKS_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.PACKINGSTATE IS 'Packing entity state';

COMMENT ON COLUMN SBS1_ADMIN.PACKINGSTATE.PACKS_ID IS 'state id';

COMMENT ON COLUMN SBS1_ADMIN.PACKINGSTATE.PACKS_CODE IS 'code';

COMMENT ON COLUMN SBS1_ADMIN.PACKINGSTATE.PACKS_LANG01 IS 'language 1';

COMMENT ON COLUMN SBS1_ADMIN.PACKINGSTATE.PACKS_LANG02 IS 'language 2';

COMMENT ON COLUMN SBS1_ADMIN.PACKINGSTATE.PACKS_LANG03 IS 'language 3';

COMMENT ON COLUMN SBS1_ADMIN.PACKINGSTATE.PACKS_LANG04 IS 'language 4';

COMMENT ON COLUMN SBS1_ADMIN.PACKINGSTATE.PACKS_VALUE1 IS 'value 1';

COMMENT ON COLUMN SBS1_ADMIN.PACKINGSTATE.PACKS_VALUE2 IS 'value 2';

COMMENT ON COLUMN SBS1_ADMIN.PACKINGSTATE.PACKS_VALUE3 IS 'value 3';

COMMENT ON COLUMN SBS1_ADMIN.PACKINGSTATE.PACKS_VALUE4 IS 'value 4';


--
-- PACSTATE  (Table) 
--
CREATE TABLE SBS1_ADMIN.PACSTATE
(
  PACS_ID      VARCHAR2(1 BYTE)                 NOT NULL,
  PACS_CODE    VARCHAR2(10 BYTE)                NOT NULL,
  PACS_LANG01  VARCHAR2(100 BYTE),
  PACS_LANG02  VARCHAR2(100 BYTE),
  PACS_LANG03  VARCHAR2(100 BYTE),
  PACS_LANG04  VARCHAR2(100 BYTE),
  PACS_VALUE1  VARCHAR2(100 BYTE),
  PACS_VALUE2  VARCHAR2(100 BYTE),
  PACS_VALUE3  VARCHAR2(100 BYTE),
  PACS_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.PACSTATE IS 'Packing state';


--
-- PACTYPE  (Table) 
--
CREATE TABLE SBS1_ADMIN.PACTYPE
(
  PACT_ID      VARCHAR2(10 BYTE)                NOT NULL,
  PACT_CODE    VARCHAR2(10 BYTE)                NOT NULL,
  PACT_LANG01  VARCHAR2(100 BYTE),
  PACT_LANG02  VARCHAR2(100 BYTE),
  PACT_LANG03  VARCHAR2(100 BYTE),
  PACT_LANG04  VARCHAR2(100 BYTE),
  PACT_VALUE1  VARCHAR2(100 BYTE),
  PACT_VALUE2  VARCHAR2(100 BYTE),
  PACT_VALUE3  VARCHAR2(100 BYTE),
  PACT_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.PACTYPE IS 'Packing type';


--
-- PARTAG_CONFIG  (Table) 
--
CREATE TABLE SBS1_ADMIN.PARTAG_CONFIG
(
  PARTAGC_ID           VARCHAR2(10 BYTE)        NOT NULL,
  PARTAGC_NAME         VARCHAR2(30 BYTE)        NOT NULL,
  PARTAGC_ACIDCRE      VARCHAR2(10 BYTE),
  PARTAGC_DATECRE      DATE,
  PARTAGC_ACIDMOD      VARCHAR2(10 BYTE),
  PARTAGC_DATEMOD      DATE,
  PARTAGC_COMMENT      VARCHAR2(2000 BYTE),
  PARTAGC_CHNGCNT      NUMBER(5),
  PARTAGC_EXECUTE      NUMBER(1)                NOT NULL,
  PARTAGC_HISTORY      NUMBER(4),
  PARTAGC_ADVANCED     NUMBER(4),
  PARTAGC_DEBUGMODE    NUMBER(1),
  PARTAGC_TABLESPACES  NUMBER(1)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.PARTAG_CONFIG IS 'Configuration';


--
-- PERIODICITY  (Table) 
--
CREATE TABLE SBS1_ADMIN.PERIODICITY
(
  PERIOD_ID      VARCHAR2(10 BYTE)              NOT NULL,
  PERIOD_CODE    VARCHAR2(10 BYTE)              NOT NULL,
  PERIOD_DURSEQ  NUMBER(2),
  PERIOD_LANG01  VARCHAR2(100 BYTE),
  PERIOD_LANG02  VARCHAR2(100 BYTE),
  PERIOD_LANG03  VARCHAR2(100 BYTE),
  PERIOD_LANG04  VARCHAR2(100 BYTE),
  PERIOD_VALUE1  VARCHAR2(100 BYTE),
  PERIOD_VALUE2  VARCHAR2(100 BYTE),
  PERIOD_VALUE3  VARCHAR2(100 BYTE),
  PERIOD_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.PERIODICITY IS 'Periodicity';

COMMENT ON COLUMN SBS1_ADMIN.PERIODICITY.PERIOD_ID IS 'type id';

COMMENT ON COLUMN SBS1_ADMIN.PERIODICITY.PERIOD_CODE IS 'code';

COMMENT ON COLUMN SBS1_ADMIN.PERIODICITY.PERIOD_DURSEQ IS 'duration sequence';

COMMENT ON COLUMN SBS1_ADMIN.PERIODICITY.PERIOD_LANG01 IS 'language 1';

COMMENT ON COLUMN SBS1_ADMIN.PERIODICITY.PERIOD_LANG02 IS 'language 2';

COMMENT ON COLUMN SBS1_ADMIN.PERIODICITY.PERIOD_LANG03 IS 'language 3';

COMMENT ON COLUMN SBS1_ADMIN.PERIODICITY.PERIOD_LANG04 IS 'language 4';

COMMENT ON COLUMN SBS1_ADMIN.PERIODICITY.PERIOD_VALUE1 IS 'value 1';

COMMENT ON COLUMN SBS1_ADMIN.PERIODICITY.PERIOD_VALUE2 IS 'value 2';

COMMENT ON COLUMN SBS1_ADMIN.PERIODICITY.PERIOD_VALUE3 IS 'value 3';

COMMENT ON COLUMN SBS1_ADMIN.PERIODICITY.PERIOD_VALUE4 IS 'value 4';


--
-- PMSTATE  (Table) 
--
CREATE TABLE SBS1_ADMIN.PMSTATE
(
  PMS_ID      VARCHAR2(10 BYTE)                 NOT NULL,
  PMS_CODE    VARCHAR2(10 BYTE)                 NOT NULL,
  PMS_LANG01  VARCHAR2(100 BYTE),
  PMS_LANG02  VARCHAR2(100 BYTE),
  PMS_LANG03  VARCHAR2(100 BYTE),
  PMS_LANG04  VARCHAR2(100 BYTE),
  PMS_VALUE1  VARCHAR2(100 BYTE),
  PMS_VALUE2  VARCHAR2(100 BYTE),
  PMS_VALUE3  VARCHAR2(100 BYTE),
  PMS_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.PMSTATE IS 'price model state';


--
-- PMVSTATE  (Table) 
--
CREATE TABLE SBS1_ADMIN.PMVSTATE
(
  PMVS_ID      VARCHAR2(10 BYTE)                NOT NULL,
  PMVS_CODE    VARCHAR2(10 BYTE)                NOT NULL,
  PMVS_LANG01  VARCHAR2(100 BYTE),
  PMVS_LANG02  VARCHAR2(100 BYTE),
  PMVS_LANG03  VARCHAR2(100 BYTE),
  PMVS_LANG04  VARCHAR2(100 BYTE),
  PMVS_VALUE1  VARCHAR2(100 BYTE),
  PMVS_VALUE2  VARCHAR2(100 BYTE),
  PMVS_VALUE3  VARCHAR2(100 BYTE),
  PMVS_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.PMVSTATE IS 'price model version state';

COMMENT ON COLUMN SBS1_ADMIN.PMVSTATE.PMVS_ID IS 'state id';

COMMENT ON COLUMN SBS1_ADMIN.PMVSTATE.PMVS_CODE IS 'code';

COMMENT ON COLUMN SBS1_ADMIN.PMVSTATE.PMVS_LANG01 IS 'language 1';

COMMENT ON COLUMN SBS1_ADMIN.PMVSTATE.PMVS_LANG02 IS 'language 2';

COMMENT ON COLUMN SBS1_ADMIN.PMVSTATE.PMVS_LANG03 IS 'language 3';

COMMENT ON COLUMN SBS1_ADMIN.PMVSTATE.PMVS_LANG04 IS 'language 4';

COMMENT ON COLUMN SBS1_ADMIN.PMVSTATE.PMVS_VALUE1 IS 'value 1';

COMMENT ON COLUMN SBS1_ADMIN.PMVSTATE.PMVS_VALUE2 IS 'value 2';

COMMENT ON COLUMN SBS1_ADMIN.PMVSTATE.PMVS_VALUE3 IS 'value 3';

COMMENT ON COLUMN SBS1_ADMIN.PMVSTATE.PMVS_VALUE4 IS 'value 4';


--
-- PROTTYPE  (Table) 
--
CREATE TABLE SBS1_ADMIN.PROTTYPE
(
  PROTT_ID      VARCHAR2(10 BYTE)               NOT NULL,
  PROTT_CODE    VARCHAR2(10 BYTE)               NOT NULL,
  PROTT_LANG01  VARCHAR2(100 BYTE),
  PROTT_LANG02  VARCHAR2(100 BYTE),
  PROTT_LANG03  VARCHAR2(100 BYTE),
  PROTT_LANG04  VARCHAR2(100 BYTE),
  PROTT_VALUE1  VARCHAR2(100 BYTE),
  PROTT_VALUE2  VARCHAR2(100 BYTE),
  PROTT_VALUE3  VARCHAR2(100 BYTE),
  PROTT_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.PROTTYPE IS 'Protocol type';


--
-- PROXYTYPE  (Table) 
--
CREATE TABLE SBS1_ADMIN.PROXYTYPE
(
  PROXYT_ID      VARCHAR2(10 BYTE)              NOT NULL,
  PROXYT_CODE    VARCHAR2(10 BYTE)              NOT NULL,
  PROXYT_LANG01  VARCHAR2(100 BYTE),
  PROXYT_LANG02  VARCHAR2(100 BYTE),
  PROXYT_LANG03  VARCHAR2(100 BYTE),
  PROXYT_LANG04  VARCHAR2(100 BYTE),
  PROXYT_VALUE1  VARCHAR2(100 BYTE),
  PROXYT_VALUE2  VARCHAR2(100 BYTE),
  PROXYT_VALUE3  VARCHAR2(100 BYTE),
  PROXYT_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.PROXYTYPE IS 'Proxy address type';


--
-- QUEST_SL_TEMP_EXPLAIN1  (Table) 
--
CREATE GLOBAL TEMPORARY TABLE SBS1_ADMIN.QUEST_SL_TEMP_EXPLAIN1
(
  STATEMENT_ID       VARCHAR2(30 BYTE),
  TIMESTAMP          DATE,
  REMARKS            VARCHAR2(80 BYTE),
  OPERATION          VARCHAR2(30 BYTE),
  OPTIONS            VARCHAR2(255 BYTE),
  OBJECT_NODE        VARCHAR2(128 BYTE),
  OBJECT_OWNER       VARCHAR2(30 BYTE),
  OBJECT_NAME        VARCHAR2(30 BYTE),
  OBJECT_INSTANCE    NUMBER,
  OBJECT_TYPE        VARCHAR2(30 BYTE),
  OPTIMIZER          VARCHAR2(255 BYTE),
  SEARCH_COLUMNS     NUMBER,
  ID                 NUMBER,
  PARENT_ID          NUMBER,
  POSITION           NUMBER,
  COST               NUMBER,
  CARDINALITY        NUMBER,
  BYTES              NUMBER,
  OTHER_TAG          VARCHAR2(255 BYTE),
  PARTITION_START    VARCHAR2(255 BYTE),
  PARTITION_STOP     VARCHAR2(255 BYTE),
  PARTITION_ID       NUMBER,
  OTHER              LONG,
  DISTRIBUTION       VARCHAR2(30 BYTE),
  CPU_COST           NUMBER(38),
  IO_COST            NUMBER(38),
  TEMP_SPACE         NUMBER(38),
  ACCESS_PREDICATES  VARCHAR2(4000 BYTE),
  FILTER_PREDICATES  VARCHAR2(4000 BYTE)
)
ON COMMIT PRESERVE ROWS;


--
-- RACACHE  (Table) 
--
CREATE TABLE SBS1_ADMIN.RACACHE
(
  RAC_AUDIT_ID      VARCHAR2(10 BYTE)           NOT NULL,
  RAC_ACID          VARCHAR2(128 BYTE)          NOT NULL,
  RAC_PERIOD_TYPE   VARCHAR2(1 BYTE)            NOT NULL,
  RAC_PERIOD        DATE                        NOT NULL,
  RAC_ETID          VARCHAR2(10 BYTE)           NOT NULL,
  RAC_RESULT_PREV   NUMBER(20),
  RAC_DATE_PREV     DATE,
  RAC_COMMENT_PREV  VARCHAR2(128 BYTE),
  RAC_RESULT_CURR   NUMBER(20),
  RAC_DATE_CURR     DATE,
  RAC_COMMENT_CURR  VARCHAR2(128 BYTE)
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.RACACHE IS 'Caching information for revenue assurance data.
Enabling differentiation of counter transfers (new value - last value).


';

COMMENT ON COLUMN SBS1_ADMIN.RACACHE.RAC_ACID IS 'CDR file source type';

COMMENT ON COLUMN SBS1_ADMIN.RACACHE.RAC_PERIOD IS 'demo flag';

COMMENT ON COLUMN SBS1_ADMIN.RACACHE.RAC_ETID IS 'header id (imput attempt id)';

COMMENT ON COLUMN SBS1_ADMIN.RACACHE.RAC_DATE_PREV IS 'file processing date';


--
-- REQTYPE  (Table) 
--
CREATE TABLE SBS1_ADMIN.REQTYPE
(
  REQT_ID      VARCHAR2(10 BYTE)                NOT NULL,
  REQT_CODE    VARCHAR2(10 BYTE)                NOT NULL,
  REQT_LANG01  VARCHAR2(100 BYTE),
  REQT_LANG02  VARCHAR2(100 BYTE),
  REQT_LANG03  VARCHAR2(100 BYTE),
  REQT_LANG04  VARCHAR2(100 BYTE),
  REQT_VALUE1  VARCHAR2(100 BYTE),
  REQT_VALUE2  VARCHAR2(100 BYTE),
  REQT_VALUE3  VARCHAR2(100 BYTE),
  REQT_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.REQTYPE IS 'Request type';


--
-- RETSCHEMA  (Table) 
--
CREATE TABLE SBS1_ADMIN.RETSCHEMA
(
  RS_ID         VARCHAR2(10 BYTE)               NOT NULL,
  RS_LANG01     VARCHAR2(30 BYTE)               NOT NULL,
  RS_LANG02     VARCHAR2(30 BYTE),
  RS_LANG03     VARCHAR2(30 BYTE),
  RS_LANG04     VARCHAR2(30 BYTE),
  RS_MAXTRIES   NUMBER(2),
  RS_VALIDITY   NUMBER(9,4),
  RS_PRICE      NUMBER(6,4),
  RS_PRICEINT   NUMBER(6,4),
  RS_CODE       VARCHAR2(10 BYTE),
  RS_AVAILABLE  NUMBER(1)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.RETSCHEMA IS 'Retry Schema';


--
-- REVA_ANASTATE  (Table) 
--
CREATE TABLE SBS1_ADMIN.REVA_ANASTATE
(
  REVAST_SRCTYPE  VARCHAR2(10 BYTE)             NOT NULL,
  REVAST_ID       VARCHAR2(10 BYTE)             NOT NULL,
  REVAST_CODE     VARCHAR2(10 BYTE)             NOT NULL,
  REVAST_LANG01   VARCHAR2(100 BYTE)            NOT NULL,
  REVAST_LANG02   VARCHAR2(100 BYTE)            NOT NULL,
  REVAST_LANG03   VARCHAR2(100 BYTE),
  REVAST_LANG04   VARCHAR2(100 BYTE),
  REVAST_VALUE1   VARCHAR2(100 BYTE),
  REVAST_VALUE2   VARCHAR2(100 BYTE),
  REVAST_VALUE3   VARCHAR2(100 BYTE),
  REVAST_VALUE4   VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.REVA_ANASTATE IS 'Rvenue analysis state (in BIHEADER)';


--
-- REVA_ANASTYTE_STAG_BCK  (Table) 
--
CREATE TABLE SBS1_ADMIN.REVA_ANASTYTE_STAG_BCK
(
  REVAST_SRCTYPE  VARCHAR2(10 BYTE)             NOT NULL,
  REVAST_ID       VARCHAR2(10 BYTE)             NOT NULL,
  REVAST_CODE     VARCHAR2(10 BYTE)             NOT NULL,
  REVAST_LANG01   VARCHAR2(100 BYTE)            NOT NULL,
  REVAST_LANG02   VARCHAR2(100 BYTE)            NOT NULL,
  REVAST_LANG03   VARCHAR2(100 BYTE),
  REVAST_LANG04   VARCHAR2(100 BYTE),
  REVAST_VALUE1   VARCHAR2(100 BYTE),
  REVAST_VALUE2   VARCHAR2(100 BYTE),
  REVAST_VALUE3   VARCHAR2(100 BYTE),
  REVAST_VALUE4   VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_USERS
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;


--
-- REVA_BILLEDITEM  (Table) 
--
CREATE TABLE SBS1_ADMIN.REVA_BILLEDITEM
(
  REVABI_ID      VARCHAR2(10 BYTE)              NOT NULL,
  REVABI_CODE    VARCHAR2(10 BYTE)              NOT NULL,
  REVABI_LANG01  VARCHAR2(100 BYTE),
  REVABI_LANG02  VARCHAR2(100 BYTE),
  REVABI_LANG03  VARCHAR2(100 BYTE),
  REVABI_LANG04  VARCHAR2(100 BYTE),
  REVABI_VALUE1  VARCHAR2(100 BYTE),
  REVABI_VALUE2  VARCHAR2(100 BYTE),
  REVABI_VALUE3  VARCHAR2(100 BYTE),
  REVABI_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.REVA_BILLEDITEM IS 'billed item';

COMMENT ON COLUMN SBS1_ADMIN.REVA_BILLEDITEM.REVABI_ID IS 'type id';

COMMENT ON COLUMN SBS1_ADMIN.REVA_BILLEDITEM.REVABI_CODE IS 'code';

COMMENT ON COLUMN SBS1_ADMIN.REVA_BILLEDITEM.REVABI_LANG01 IS 'language 1';

COMMENT ON COLUMN SBS1_ADMIN.REVA_BILLEDITEM.REVABI_LANG02 IS 'language 2';

COMMENT ON COLUMN SBS1_ADMIN.REVA_BILLEDITEM.REVABI_LANG03 IS 'language 3';

COMMENT ON COLUMN SBS1_ADMIN.REVA_BILLEDITEM.REVABI_LANG04 IS 'language 4';

COMMENT ON COLUMN SBS1_ADMIN.REVA_BILLEDITEM.REVABI_VALUE1 IS 'value 1';

COMMENT ON COLUMN SBS1_ADMIN.REVA_BILLEDITEM.REVABI_VALUE2 IS 'value 2';

COMMENT ON COLUMN SBS1_ADMIN.REVA_BILLEDITEM.REVABI_VALUE3 IS 'value 3';

COMMENT ON COLUMN SBS1_ADMIN.REVA_BILLEDITEM.REVABI_VALUE4 IS 'value 4';


--
-- REVA_BILLTYPE  (Table) 
--
CREATE TABLE SBS1_ADMIN.REVA_BILLTYPE
(
  REVABT_ID      VARCHAR2(10 BYTE)              NOT NULL,
  REVABT_CODE    VARCHAR2(10 BYTE)              NOT NULL,
  REVABT_LANG01  VARCHAR2(100 BYTE),
  REVABT_LANG02  VARCHAR2(100 BYTE),
  REVABT_LANG03  VARCHAR2(100 BYTE),
  REVABT_LANG04  VARCHAR2(100 BYTE),
  REVABT_VALUE1  VARCHAR2(100 BYTE),
  REVABT_VALUE2  VARCHAR2(100 BYTE),
  REVABT_VALUE3  VARCHAR2(100 BYTE),
  REVABT_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.REVA_BILLTYPE IS 'signature type';

COMMENT ON COLUMN SBS1_ADMIN.REVA_BILLTYPE.REVABT_ID IS 'type id';

COMMENT ON COLUMN SBS1_ADMIN.REVA_BILLTYPE.REVABT_CODE IS 'code';

COMMENT ON COLUMN SBS1_ADMIN.REVA_BILLTYPE.REVABT_LANG01 IS 'language 1';

COMMENT ON COLUMN SBS1_ADMIN.REVA_BILLTYPE.REVABT_LANG02 IS 'language 2';

COMMENT ON COLUMN SBS1_ADMIN.REVA_BILLTYPE.REVABT_LANG03 IS 'language 3';

COMMENT ON COLUMN SBS1_ADMIN.REVA_BILLTYPE.REVABT_LANG04 IS 'language 4';

COMMENT ON COLUMN SBS1_ADMIN.REVA_BILLTYPE.REVABT_VALUE1 IS 'value 1';

COMMENT ON COLUMN SBS1_ADMIN.REVA_BILLTYPE.REVABT_VALUE2 IS 'value 2';

COMMENT ON COLUMN SBS1_ADMIN.REVA_BILLTYPE.REVABT_VALUE3 IS 'value 3';

COMMENT ON COLUMN SBS1_ADMIN.REVA_BILLTYPE.REVABT_VALUE4 IS 'value 4';


--
-- REVA_CONFIG  (Table) 
--
CREATE TABLE SBS1_ADMIN.REVA_CONFIG
(
  REVAC_ID              VARCHAR2(10 BYTE)       NOT NULL,
  REVAC_EXEC            NUMBER(1)               NOT NULL,
  REVAC_BATCHNORECORDS  NUMBER                  NOT NULL,
  REVAC_DEBUGMODE       NUMBER(1),
  REVAC_RUNTIMELIMIT    NUMBER(5),
  REVAC_FILE_MIN_AGE    NUMBER,
  REVAC_FILE_MAX_AGE    NUMBER
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.REVA_CONFIG IS 'Reva_Config';

COMMENT ON COLUMN SBS1_ADMIN.REVA_CONFIG.REVAC_ID IS 'config id';

COMMENT ON COLUMN SBS1_ADMIN.REVA_CONFIG.REVAC_EXEC IS 'execute';

COMMENT ON COLUMN SBS1_ADMIN.REVA_CONFIG.REVAC_BATCHNORECORDS IS 'batch no of record';

COMMENT ON COLUMN SBS1_ADMIN.REVA_CONFIG.REVAC_DEBUGMODE IS 'debug mode';


--
-- REVA_COUNTERS_HISTORY  (Table) 
--
CREATE TABLE SBS1_ADMIN.REVA_COUNTERS_HISTORY
(
  REVAC_MONTH     DATE,
  REVAC_REVASMID  VARCHAR2(20 BYTE)             NOT NULL,
  SUM_REVAC_IN    NUMBER,
  SUM_REVAC_OUT   NUMBER,
  REVAC_COUNT     NUMBER
)
TABLESPACE SBS1_USERS
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;


--
-- REVA_DEBUG  (Table) 
--
CREATE TABLE SBS1_ADMIN.REVA_DEBUG
(
  BIH_ID     VARCHAR2(10 BYTE)                  NOT NULL,
  BOH_ID     VARCHAR2(10 BYTE)                  NOT NULL,
  REVAH_ID   VARCHAR2(10 BYTE)                  NOT NULL,
  STARTDATE  DATE,
  ENDDATE    DATE,
  TIMEDIFF   DATE,
  RECCOUNT   NUMBER,
  HINT       VARCHAR2(4000 BYTE)
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.REVA_DEBUG IS 'reva_debug';

COMMENT ON COLUMN SBS1_ADMIN.REVA_DEBUG.BIH_ID IS 'bih_id';

COMMENT ON COLUMN SBS1_ADMIN.REVA_DEBUG.BOH_ID IS 'boh_id';

COMMENT ON COLUMN SBS1_ADMIN.REVA_DEBUG.REVAH_ID IS 'revah_id';

COMMENT ON COLUMN SBS1_ADMIN.REVA_DEBUG.STARTDATE IS 'startdate';

COMMENT ON COLUMN SBS1_ADMIN.REVA_DEBUG.ENDDATE IS 'enddate';

COMMENT ON COLUMN SBS1_ADMIN.REVA_DEBUG.TIMEDIFF IS 'timediff';

COMMENT ON COLUMN SBS1_ADMIN.REVA_DEBUG.RECCOUNT IS 'reccount';

COMMENT ON COLUMN SBS1_ADMIN.REVA_DEBUG.HINT IS 'hint';


--
-- REVA_HEADER_STAG_BCK  (Table) 
--
CREATE TABLE SBS1_ADMIN.REVA_HEADER_STAG_BCK
(
  REVAH_ID           VARCHAR2(10 BYTE)          NOT NULL,
  REVAH_SRCTYPE      VARCHAR2(10 BYTE)          NOT NULL,
  REVAH_PACID        VARCHAR2(10 BYTE)          NOT NULL,
  REVAH_BILLINGTYPE  VARCHAR2(10 BYTE),
  REVAH_BILLEDITEM   VARCHAR2(10 BYTE),
  REVAH_SQL          VARCHAR2(4000 BYTE)        NOT NULL,
  REVAH_DESC         VARCHAR2(1024 BYTE),
  REVAH_SIGDESC      VARCHAR2(2000 BYTE),
  REVAH_ESID         VARCHAR2(10 BYTE),
  REVAH_INSQL        VARCHAR2(4000 BYTE),
  REVAH_NEWSIGSQL    VARCHAR2(4000 BYTE)
)
TABLESPACE SBS1_USERS
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;


--
-- REVA_SIGMASK_PROD_BCK  (Table) 
--
CREATE TABLE SBS1_ADMIN.REVA_SIGMASK_PROD_BCK
(
  REVASM_ID       VARCHAR2(20 BYTE)             NOT NULL,
  REVASM_CODE     VARCHAR2(20 BYTE)             NOT NULL,
  REVASM_REVAHID  VARCHAR2(10 BYTE)             NOT NULL,
  REVASM_ESID     VARCHAR2(10 BYTE)             NOT NULL,
  REVASM_ETID     VARCHAR2(10 BYTE)             NOT NULL,
  REVASM_ORDER    NUMBER(8,4),
  REVASM_DESC     VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_USERS
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;


--
-- REVA_SIGMASK_STAG_BCK  (Table) 
--
CREATE TABLE SBS1_ADMIN.REVA_SIGMASK_STAG_BCK
(
  REVASM_ID       VARCHAR2(20 BYTE)             NOT NULL,
  REVASM_CODE     VARCHAR2(20 BYTE)             NOT NULL,
  REVASM_REVAHID  VARCHAR2(10 BYTE)             NOT NULL,
  REVASM_ESID     VARCHAR2(10 BYTE)             NOT NULL,
  REVASM_ETID     VARCHAR2(10 BYTE)             NOT NULL,
  REVASM_ORDER    NUMBER(8,4),
  REVASM_DESC     VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_USERS
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;


--
-- REVA_SIGTYPE  (Table) 
--
CREATE TABLE SBS1_ADMIN.REVA_SIGTYPE
(
  REVAT_ID      VARCHAR2(10 BYTE)               NOT NULL,
  REVAT_CODE    VARCHAR2(10 BYTE)               NOT NULL,
  REVAT_LANG01  VARCHAR2(100 BYTE),
  REVAT_LANG02  VARCHAR2(100 BYTE),
  REVAT_LANG03  VARCHAR2(100 BYTE),
  REVAT_LANG04  VARCHAR2(100 BYTE),
  REVAT_VALUE1  VARCHAR2(100 BYTE),
  REVAT_VALUE2  VARCHAR2(100 BYTE),
  REVAT_VALUE3  VARCHAR2(100 BYTE),
  REVAT_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.REVA_SIGTYPE IS 'signature type';

COMMENT ON COLUMN SBS1_ADMIN.REVA_SIGTYPE.REVAT_ID IS 'type id';

COMMENT ON COLUMN SBS1_ADMIN.REVA_SIGTYPE.REVAT_CODE IS 'code';

COMMENT ON COLUMN SBS1_ADMIN.REVA_SIGTYPE.REVAT_LANG01 IS 'language 1';

COMMENT ON COLUMN SBS1_ADMIN.REVA_SIGTYPE.REVAT_LANG02 IS 'language 2';

COMMENT ON COLUMN SBS1_ADMIN.REVA_SIGTYPE.REVAT_LANG03 IS 'language 3';

COMMENT ON COLUMN SBS1_ADMIN.REVA_SIGTYPE.REVAT_LANG04 IS 'language 4';

COMMENT ON COLUMN SBS1_ADMIN.REVA_SIGTYPE.REVAT_VALUE1 IS 'value 1';

COMMENT ON COLUMN SBS1_ADMIN.REVA_SIGTYPE.REVAT_VALUE2 IS 'value 2';

COMMENT ON COLUMN SBS1_ADMIN.REVA_SIGTYPE.REVAT_VALUE3 IS 'value 3';

COMMENT ON COLUMN SBS1_ADMIN.REVA_SIGTYPE.REVAT_VALUE4 IS 'value 4';


--
-- REVA_SPECIAL_DAYS  (Table) 
--
CREATE TABLE SBS1_ADMIN.REVA_SPECIAL_DAYS
(
  REVASD_DAY      DATE                          NOT NULL,
  REVASD_COMMENT  VARCHAR2(40 BYTE), 
  CONSTRAINT PK_REVA_SPECIAL_DAYS
  PRIMARY KEY
  (REVASD_DAY)
  ENABLE VALIDATE
)
ORGANIZATION INDEX
PCTTHRESHOLD 50
TABLESPACE SBS1_BASE_DATA
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

COMMENT ON TABLE SBS1_ADMIN.REVA_SPECIAL_DAYS IS 'List of special dates (abnormal communication usage to be expected)';


--
-- REVA_STATE  (Table) 
--
CREATE TABLE SBS1_ADMIN.REVA_STATE
(
  REVAS_ID      VARCHAR2(10 BYTE)               NOT NULL,
  REVAS_CODE    VARCHAR2(10 BYTE)               NOT NULL,
  REVAS_LANG01  VARCHAR2(100 BYTE)              NOT NULL,
  REVAS_LANG02  VARCHAR2(100 BYTE)              NOT NULL,
  REVAS_LANG03  VARCHAR2(100 BYTE),
  REVAS_LANG04  VARCHAR2(100 BYTE),
  REVAS_VALUE1  VARCHAR2(100 BYTE),
  REVAS_VALUE2  VARCHAR2(100 BYTE),
  REVAS_VALUE3  VARCHAR2(100 BYTE),
  REVAS_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.REVA_STATE IS 'reva state';

COMMENT ON COLUMN SBS1_ADMIN.REVA_STATE.REVAS_ID IS 'identification';

COMMENT ON COLUMN SBS1_ADMIN.REVA_STATE.REVAS_CODE IS 'state';

COMMENT ON COLUMN SBS1_ADMIN.REVA_STATE.REVAS_LANG01 IS 'state language1';

COMMENT ON COLUMN SBS1_ADMIN.REVA_STATE.REVAS_LANG02 IS 'state language2';

COMMENT ON COLUMN SBS1_ADMIN.REVA_STATE.REVAS_LANG03 IS 'state language3';

COMMENT ON COLUMN SBS1_ADMIN.REVA_STATE.REVAS_LANG04 IS 'state language4';

COMMENT ON COLUMN SBS1_ADMIN.REVA_STATE.REVAS_VALUE1 IS 'state value 1';

COMMENT ON COLUMN SBS1_ADMIN.REVA_STATE.REVAS_VALUE2 IS 'state value 2';

COMMENT ON COLUMN SBS1_ADMIN.REVA_STATE.REVAS_VALUE3 IS 'state value 3';

COMMENT ON COLUMN SBS1_ADMIN.REVA_STATE.REVAS_VALUE4 IS 'state value 4';


--
-- REVI_CONFIG  (Table) 
--
CREATE TABLE SBS1_ADMIN.REVI_CONFIG
(
  REVIC_ID             VARCHAR2(10 BYTE)        NOT NULL,
  REVIC_EXEC           NUMBER(1)                NOT NULL,
  REVIC_DELAY_SMS_SUB  NUMBER                   NOT NULL,
  REVIC_DELAY_SMS_DEL  NUMBER                   NOT NULL,
  REVIC_DELAY_MMS_SUB  NUMBER                   NOT NULL,
  REVIC_DELAY_MMS_DEL  NUMBER                   NOT NULL,
  REVIC_DELAY_BLK_SUB  NUMBER                   NOT NULL,
  REVIC_DELAY_BLK_DEL  NUMBER                   NOT NULL,
  REVIC_DEBUGMODE      NUMBER(1)                NOT NULL,
  REVIC_RUNTIMELIMIT   NUMBER(5)                NOT NULL
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;


--
-- REVI_CONTENT_DEL  (Table) 
--
CREATE TABLE SBS1_ADMIN.REVI_CONTENT_DEL
(
  REVICD_SEPID           VARCHAR2(6 BYTE)       NOT NULL,
  REVICD_SHORTID         VARCHAR2(6 BYTE)       NOT NULL,
  REVICD_ROWID_MASTER    ROWID                  NOT NULL,
  REVICD_COUNT_EXPECTED  NUMBER(2),
  REVICD_TABLE_SLAVE     VARCHAR2(10 BYTE),
  REVICD_ROWID_SLAVE     ROWID
)
NOCOMPRESS 
TABLESPACE SBS1_INFO_DATA_UC
PCTUSED    0
PCTFREE    30
INITRANS   1
MAXTRANS   255
STORAGE    (
            BUFFER_POOL      DEFAULT
           )
PARTITION BY RANGE (REVICD_SEPID)
(  
  PARTITION INFO201808 VALUES LESS THAN ('201809')
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201809 VALUES LESS THAN ('201810')
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201810 VALUES LESS THAN ('201811')
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201811 VALUES LESS THAN ('201812')
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201812 VALUES LESS THAN ('201901')
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201901 VALUES LESS THAN ('201902')
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201902 VALUES LESS THAN ('201903')
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               )
);

COMMENT ON TABLE SBS1_ADMIN.REVI_CONTENT_DEL IS 'Revenue assurance CDR matching index for Content CDRs to delivery records (used for Message Broker)';

COMMENT ON COLUMN SBS1_ADMIN.REVI_CONTENT_DEL.REVICD_SEPID IS 'datetime of submit';

COMMENT ON COLUMN SBS1_ADMIN.REVI_CONTENT_DEL.REVICD_SHORTID IS 'short id';


--
-- REVI_CONTENT_SUB  (Table) 
--
CREATE TABLE SBS1_ADMIN.REVI_CONTENT_SUB
(
  REVICS_SEPID           VARCHAR2(6 BYTE)       NOT NULL,
  REVICS_SHORTID         VARCHAR2(6 BYTE)       NOT NULL,
  REVICS_ROWID_MASTER    ROWID                  NOT NULL,
  REVICS_COUNT_EXPECTED  NUMBER(2),
  REVICS_TABLE_SLAVE     VARCHAR2(10 BYTE),
  REVICS_ROWID_SLAVE     ROWID
)
NOCOMPRESS 
TABLESPACE SBS1_INFO_DATA_UC
PCTUSED    0
PCTFREE    30
INITRANS   1
MAXTRANS   255
STORAGE    (
            BUFFER_POOL      DEFAULT
           )
PARTITION BY RANGE (REVICS_SEPID)
(  
  PARTITION INFO201808 VALUES LESS THAN ('201809')
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201809 VALUES LESS THAN ('201810')
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201810 VALUES LESS THAN ('201811')
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                INITIAL          8M
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201811 VALUES LESS THAN ('201812')
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                INITIAL          8M
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201812 VALUES LESS THAN ('201901')
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201901 VALUES LESS THAN ('201902')
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201902 VALUES LESS THAN ('201903')
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               )
);

COMMENT ON TABLE SBS1_ADMIN.REVI_CONTENT_SUB IS 'Revenue assurance CDR matching index for Content CDRs (used for Message Broker)';

COMMENT ON COLUMN SBS1_ADMIN.REVI_CONTENT_SUB.REVICS_SEPID IS 'datetime of submit';

COMMENT ON COLUMN SBS1_ADMIN.REVI_CONTENT_SUB.REVICS_SHORTID IS 'short id';


--
-- REVI_MMS  (Table) 
--
CREATE TABLE SBS1_ADMIN.REVI_MMS
(
  REVIM_SEPID    VARCHAR2(6 BYTE)               NOT NULL,
  REVIM_SHORTID  VARCHAR2(6 BYTE)               NOT NULL,
  REVIM_ROWID6   ROWID                          NOT NULL,
  REVIM_ROWID    ROWID
)
NOCOMPRESS 
TABLESPACE SBS1_INFO_DATA_UC
PCTUSED    0
PCTFREE    30
INITRANS   1
MAXTRANS   255
STORAGE    (
            BUFFER_POOL      DEFAULT
           )
PARTITION BY RANGE (REVIM_SEPID)
(  
  PARTITION INFO201808 VALUES LESS THAN ('201809')
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201809 VALUES LESS THAN ('201810')
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201810 VALUES LESS THAN ('201811')
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                INITIAL          8M
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201811 VALUES LESS THAN ('201812')
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201812 VALUES LESS THAN ('201901')
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201901 VALUES LESS THAN ('201902')
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201902 VALUES LESS THAN ('201903')
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               )
);

COMMENT ON TABLE SBS1_ADMIN.REVI_MMS IS 'Revenue assurance CDR matching index for MMS CDRs (used for Message Broker)';

COMMENT ON COLUMN SBS1_ADMIN.REVI_MMS.REVIM_SEPID IS 'datetime of submit';

COMMENT ON COLUMN SBS1_ADMIN.REVI_MMS.REVIM_SHORTID IS 'short id';


--
-- REVI_PRE  (Table) 
--
CREATE TABLE SBS1_ADMIN.REVI_PRE
(
  REVIPRE_SEPID           VARCHAR2(6 BYTE)      NOT NULL,
  REVIPRE_SHORTID         VARCHAR2(6 BYTE)      NOT NULL,
  REVIPRE_ROWID_MASTER    ROWID                 NOT NULL,
  REVIPRE_TABLE_SLAVE     VARCHAR2(10 BYTE),
  REVIPRE_ROWID_SLAVE     ROWID,
  REVIPRE_CHARGED_AMOUNT  NUMBER(10,4)
)
NOCOMPRESS 
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    30
INITRANS   1
MAXTRANS   255
STORAGE    (
            BUFFER_POOL      DEFAULT
           )
PARTITION BY RANGE (REVIPRE_SEPID)
(  
  PARTITION INFO201808 VALUES LESS THAN ('201809')
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201809 VALUES LESS THAN ('201810')
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201810 VALUES LESS THAN ('201811')
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                INITIAL          8M
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201811 VALUES LESS THAN ('201812')
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                INITIAL          8M
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201812 VALUES LESS THAN ('201901')
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201901 VALUES LESS THAN ('201902')
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201902 VALUES LESS THAN ('201903')
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               )
);

COMMENT ON TABLE SBS1_ADMIN.REVI_PRE IS 'Revenue assurance CDR matching index for Content CDRs (used for Message Broker). Used to find charging event on DSS for given Content CDRs.';

COMMENT ON COLUMN SBS1_ADMIN.REVI_PRE.REVIPRE_SEPID IS 'datetime of submit';

COMMENT ON COLUMN SBS1_ADMIN.REVI_PRE.REVIPRE_SHORTID IS 'short id';


--
-- REVIPRE_MMS  (Table) 
--
CREATE TABLE SBS1_ADMIN.REVIPRE_MMS
(
  REVIPREM_SEPID           VARCHAR2(6 BYTE)     NOT NULL,
  REVIPREM_SHORTID         VARCHAR2(6 BYTE)     NOT NULL,
  REVIPREM_ROWIDS          ROWID                NOT NULL,
  REVIPREM_ROWID           ROWID,
  REVIPREM_CHARGED_AMOUNT  NUMBER(10,4)
)
NOCOMPRESS 
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    30
INITRANS   1
MAXTRANS   255
STORAGE    (
            BUFFER_POOL      DEFAULT
           )
PARTITION BY RANGE (REVIPREM_SEPID)
(  
  PARTITION INFO201808 VALUES LESS THAN ('201809')
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201809 VALUES LESS THAN ('201810')
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201810 VALUES LESS THAN ('201811')
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201811 VALUES LESS THAN ('201812')
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201812 VALUES LESS THAN ('201901')
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201901 VALUES LESS THAN ('201902')
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201902 VALUES LESS THAN ('201903')
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               )
);

COMMENT ON TABLE SBS1_ADMIN.REVIPRE_MMS IS 'Revenue assurance CDR matching index for MMS charging events on DSS (used for Message Broker). Used to find SBS content CDR for entries in CDRMMS@DSS.';

COMMENT ON COLUMN SBS1_ADMIN.REVIPRE_MMS.REVIPREM_SEPID IS 'datetime of submit';

COMMENT ON COLUMN SBS1_ADMIN.REVIPRE_MMS.REVIPREM_SHORTID IS 'short id';


--
-- REVIPRE_SMS  (Table) 
--
CREATE TABLE SBS1_ADMIN.REVIPRE_SMS
(
  REVIPRES_SEPID           VARCHAR2(6 BYTE)     NOT NULL,
  REVIPRES_SHORTID         VARCHAR2(6 BYTE)     NOT NULL,
  REVIPRES_ROWIDS          ROWID                NOT NULL,
  REVIPRES_ROWID           ROWID,
  REVIPRES_CHARGED_AMOUNT  NUMBER(10,4)
)
NOCOMPRESS 
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    30
INITRANS   1
MAXTRANS   255
STORAGE    (
            BUFFER_POOL      DEFAULT
           )
PARTITION BY RANGE (REVIPRES_SEPID)
(  
  PARTITION INFO201808 VALUES LESS THAN ('201809')
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201809 VALUES LESS THAN ('201810')
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201810 VALUES LESS THAN ('201811')
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201811 VALUES LESS THAN ('201812')
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201812 VALUES LESS THAN ('201901')
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201901 VALUES LESS THAN ('201902')
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201902 VALUES LESS THAN ('201903')
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               )
);

COMMENT ON TABLE SBS1_ADMIN.REVIPRE_SMS IS 'Revenue assurance CDR matching index for SMS charging events on DSS (used for Message Broker). Used to find SBS content CDR for entries in CDRSMS@DSS.';

COMMENT ON COLUMN SBS1_ADMIN.REVIPRE_SMS.REVIPRES_SEPID IS 'datetime of submit';

COMMENT ON COLUMN SBS1_ADMIN.REVIPRE_SMS.REVIPRES_SHORTID IS 'short id';


--
-- REVI_SMS  (Table) 
--
CREATE TABLE SBS1_ADMIN.REVI_SMS
(
  REVIS_SEPID    VARCHAR2(6 BYTE)               NOT NULL,
  REVIS_SHORTID  VARCHAR2(6 BYTE)               NOT NULL,
  REVIS_ROWID1   ROWID                          NOT NULL,
  REVIS_ROWID    ROWID
)
NOCOMPRESS 
TABLESPACE SBS1_INFO_DATA_UC
PCTUSED    0
PCTFREE    30
INITRANS   1
MAXTRANS   255
STORAGE    (
            BUFFER_POOL      DEFAULT
           )
PARTITION BY RANGE (REVIS_SEPID)
(  
  PARTITION INFO201808 VALUES LESS THAN ('201809')
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201809 VALUES LESS THAN ('201810')
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201810 VALUES LESS THAN ('201811')
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                INITIAL          8M
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201811 VALUES LESS THAN ('201812')
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                INITIAL          8M
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201812 VALUES LESS THAN ('201901')
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201901 VALUES LESS THAN ('201902')
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201902 VALUES LESS THAN ('201903')
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               )
);

COMMENT ON TABLE SBS1_ADMIN.REVI_SMS IS 'Revenue assurance CDR matching index for SMS CDRs (used for Message Broker)';

COMMENT ON COLUMN SBS1_ADMIN.REVI_SMS.REVIS_SEPID IS 'datetime of submit';

COMMENT ON COLUMN SBS1_ADMIN.REVI_SMS.REVIS_SHORTID IS 'short id';


--
-- ROCSTATE  (Table) 
--
CREATE TABLE SBS1_ADMIN.ROCSTATE
(
  ROCS_ID      VARCHAR2(10 BYTE)                NOT NULL,
  ROCS_CODE    VARCHAR2(10 BYTE)                NOT NULL,
  ROCS_LANG01  VARCHAR2(100 BYTE),
  ROCS_LANG02  VARCHAR2(100 BYTE),
  ROCS_LANG03  VARCHAR2(100 BYTE),
  ROCS_LANG04  VARCHAR2(100 BYTE),
  ROCS_VALUE1  VARCHAR2(100 BYTE),
  ROCS_VALUE2  VARCHAR2(100 BYTE),
  ROCS_VALUE3  VARCHAR2(100 BYTE),
  ROCS_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.ROCSTATE IS 'roaming consolidation state';


--
-- ROCTYPE  (Table) 
--
CREATE TABLE SBS1_ADMIN.ROCTYPE
(
  ROCT_ID      VARCHAR2(10 BYTE)                NOT NULL,
  ROCT_CODE    VARCHAR2(10 BYTE)                NOT NULL,
  ROCT_LANG01  VARCHAR2(100 BYTE),
  ROCT_LANG02  VARCHAR2(100 BYTE),
  ROCT_LANG03  VARCHAR2(100 BYTE),
  ROCT_LANG04  VARCHAR2(100 BYTE),
  ROCT_VALUE1  VARCHAR2(100 BYTE),
  ROCT_VALUE2  VARCHAR2(100 BYTE),
  ROCT_VALUE3  VARCHAR2(100 BYTE),
  ROCT_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.ROCTYPE IS 'roaming consolidation type';


--
-- SBS0_STATS  (Table) 
--
CREATE TABLE SBS1_ADMIN.SBS0_STATS
(
  STATID   VARCHAR2(30 BYTE),
  TYPE     CHAR(1 BYTE),
  VERSION  NUMBER,
  FLAGS    NUMBER,
  C1       VARCHAR2(30 BYTE),
  C2       VARCHAR2(30 BYTE),
  C3       VARCHAR2(30 BYTE),
  C4       VARCHAR2(30 BYTE),
  C5       VARCHAR2(30 BYTE),
  N1       NUMBER,
  N2       NUMBER,
  N3       NUMBER,
  N4       NUMBER,
  N5       NUMBER,
  N6       NUMBER,
  N7       NUMBER,
  N8       NUMBER,
  N9       NUMBER,
  N10      NUMBER,
  N11      NUMBER,
  N12      NUMBER,
  D1       DATE,
  R1       RAW(32),
  R2       RAW(32),
  CH1      VARCHAR2(1000 BYTE),
  CL1      CLOB
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;


--
-- SCRIPTSTATE  (Table) 
--
CREATE TABLE SBS1_ADMIN.SCRIPTSTATE
(
  SCRS_ID      VARCHAR2(10 BYTE)                NOT NULL,
  SCRS_CODE    VARCHAR2(10 BYTE)                NOT NULL,
  SCRS_LANG01  VARCHAR2(100 BYTE),
  SCRS_LANG02  VARCHAR2(100 BYTE),
  SCRS_LANG03  VARCHAR2(100 BYTE),
  SCRS_LANG04  VARCHAR2(100 BYTE),
  SCRS_VALUE1  VARCHAR2(100 BYTE),
  SCRS_VALUE2  VARCHAR2(100 BYTE),
  SCRS_VALUE3  VARCHAR2(100 BYTE),
  SCRS_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.SCRIPTSTATE IS 'Execution state of script entry';


--
-- SEDSTATE  (Table) 
--
CREATE TABLE SBS1_ADMIN.SEDSTATE
(
  SEDS_ID      VARCHAR2(1 BYTE)                 NOT NULL,
  SEDS_CODE    VARCHAR2(10 BYTE)                NOT NULL,
  SEDS_LANG01  VARCHAR2(100 BYTE),
  SEDS_LANG02  VARCHAR2(100 BYTE),
  SEDS_LANG03  VARCHAR2(100 BYTE),
  SEDS_LANG04  VARCHAR2(100 BYTE),
  SEDS_VALUE1  VARCHAR2(100 BYTE),
  SEDS_VALUE2  VARCHAR2(100 BYTE),
  SEDS_VALUE3  VARCHAR2(100 BYTE),
  SEDS_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.SEDSTATE IS 'Settling detail state';


--
-- SEDTYPE  (Table) 
--
CREATE TABLE SBS1_ADMIN.SEDTYPE
(
  SEDT_ID      VARCHAR2(10 BYTE)                NOT NULL,
  SEDT_CODE    VARCHAR2(10 BYTE)                NOT NULL,
  SEDT_LANG01  VARCHAR2(100 BYTE),
  SEDT_LANG02  VARCHAR2(100 BYTE),
  SEDT_LANG03  VARCHAR2(100 BYTE),
  SEDT_LANG04  VARCHAR2(100 BYTE),
  SEDT_VALUE1  VARCHAR2(100 BYTE),
  SEDT_VALUE2  VARCHAR2(100 BYTE),
  SEDT_VALUE3  VARCHAR2(100 BYTE),
  SEDT_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.SEDTYPE IS 'Settling detail type';


--
-- SETDETAIL_201609  (Table) 
--
CREATE TABLE SBS1_ADMIN.SETDETAIL_201609
(
  SED_ID           VARCHAR2(10 BYTE)            NOT NULL,
  SED_SETID        VARCHAR2(10 BYTE)            NOT NULL,
  SED_DATECRE      DATE,
  SED_DATETIME     DATE,
  SED_POS          NUMBER(4)                    NOT NULL,
  SED_ETID         VARCHAR2(10 BYTE)            NOT NULL,
  SED_VISIBLE      NUMBER(1)                    NOT NULL,
  SED_DESC         VARCHAR2(50 BYTE),
  SED_ORDER        VARCHAR2(50 BYTE),
  SED_PMVID        VARCHAR2(10 BYTE),
  SED_TARID        VARCHAR2(1 BYTE),
  SED_PRICE        NUMBER(12,4),
  SED_QUANTITY     NUMBER(12,4)                 NOT NULL,
  SED_DISCOUNT     NUMBER(3)                    NOT NULL,
  SED_NET          NUMBER(12,4)                 NOT NULL,
  SED_VATID        VARCHAR2(10 BYTE)            NOT NULL,
  SED_VATRATE      NUMBER(12,4)                 NOT NULL,
  SED_VAT          NUMBER(12,4)                 NOT NULL,
  SED_TOTAL        NUMBER(12,4)                 NOT NULL,
  SED_COUNT1       NUMBER(8),
  SED_COUNT2       NUMBER(8),
  SED_CHARGE       VARCHAR2(20 BYTE),
  SED_BOHID        VARCHAR2(10 BYTE),
  SED_GOHID        VARCHAR2(10 BYTE),
  SED_DATE         DATE,
  SED_ESID         VARCHAR2(1 BYTE),
  SED_COMMENT      VARCHAR2(2000 BYTE),
  SED_INT          VARCHAR2(1 BYTE),
  SED_AMOUNTCU     NUMBER(12,4),
  SED_RETSHAREPV   NUMBER(12,4),
  SED_RETSHAREMO   NUMBER(12,4),
  SED_PREPAID      VARCHAR2(1 BYTE),
  SED_LONGID       NUMBER(11),
  SED_UFIH_STREAM  VARCHAR2(10 BYTE),
  SED_UFIH_OUT     VARCHAR2(400 BYTE),
  SED_UFIH_BOSID   VARCHAR2(1 BYTE),
  SED_UFIH_BOHID   VARCHAR2(10 BYTE)
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;


--
-- SETDETAIL_201707  (Table) 
--
CREATE TABLE SBS1_ADMIN.SETDETAIL_201707
(
  SED_ID           VARCHAR2(10 BYTE)            NOT NULL,
  SED_SETID        VARCHAR2(10 BYTE)            NOT NULL,
  SED_DATECRE      DATE,
  SED_DATETIME     DATE,
  SED_POS          NUMBER(4)                    NOT NULL,
  SED_ETID         VARCHAR2(10 BYTE)            NOT NULL,
  SED_VISIBLE      NUMBER(1)                    NOT NULL,
  SED_DESC         VARCHAR2(50 BYTE),
  SED_ORDER        VARCHAR2(50 BYTE),
  SED_PMVID        VARCHAR2(10 BYTE),
  SED_TARID        VARCHAR2(1 BYTE),
  SED_PRICE        NUMBER(12,4),
  SED_QUANTITY     NUMBER(12,4)                 NOT NULL,
  SED_DISCOUNT     NUMBER(3)                    NOT NULL,
  SED_NET          NUMBER(12,4)                 NOT NULL,
  SED_VATID        VARCHAR2(10 BYTE)            NOT NULL,
  SED_VATRATE      NUMBER(12,4)                 NOT NULL,
  SED_VAT          NUMBER(12,4)                 NOT NULL,
  SED_TOTAL        NUMBER(12,4)                 NOT NULL,
  SED_COUNT1       NUMBER(8),
  SED_COUNT2       NUMBER(8),
  SED_CHARGE       VARCHAR2(20 BYTE),
  SED_BOHID        VARCHAR2(10 BYTE),
  SED_GOHID        VARCHAR2(10 BYTE),
  SED_DATE         DATE,
  SED_ESID         VARCHAR2(1 BYTE),
  SED_COMMENT      VARCHAR2(2000 BYTE),
  SED_INT          VARCHAR2(1 BYTE),
  SED_AMOUNTCU     NUMBER(12,4),
  SED_RETSHAREPV   NUMBER(12,4),
  SED_RETSHAREMO   NUMBER(12,4),
  SED_PREPAID      VARCHAR2(1 BYTE),
  SED_LONGID       NUMBER(11),
  SED_UFIH_STREAM  VARCHAR2(10 BYTE),
  SED_UFIH_OUT     VARCHAR2(400 BYTE),
  SED_UFIH_BOSID   VARCHAR2(1 BYTE),
  SED_UFIH_BOHID   VARCHAR2(10 BYTE),
  SED_LONGID2      NUMBER(11),
  SED_LONGID_CNT   NUMBER(10)
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;


--
-- SETPERIOD  (Table) 
--
CREATE TABLE SBS1_ADMIN.SETPERIOD
(
  SEP_ID       VARCHAR2(10 BYTE)                NOT NULL,
  SEP_DATE1    DATE                             NOT NULL,
  SEP_DATE2    DATE                             NOT NULL,
  SEP_LANG01   VARCHAR2(100 BYTE),
  SEP_LANG02   VARCHAR2(100 BYTE),
  SEP_LANG03   VARCHAR2(100 BYTE),
  SEP_LANG04   VARCHAR2(100 BYTE),
  SEP_IWTSSID  VARCHAR2(10 BYTE)
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.SETPERIOD IS 'Settlement periods';

COMMENT ON COLUMN SBS1_ADMIN.SETPERIOD.SEP_IWTSSID IS 'interworking term settlement state';


--
-- SETSTATE  (Table) 
--
CREATE TABLE SBS1_ADMIN.SETSTATE
(
  SETS_ID      VARCHAR2(10 BYTE)                NOT NULL,
  SETS_CODE    VARCHAR2(10 BYTE)                NOT NULL,
  SETS_LANG01  VARCHAR2(100 BYTE),
  SETS_LANG02  VARCHAR2(100 BYTE),
  SETS_LANG03  VARCHAR2(100 BYTE),
  SETS_LANG04  VARCHAR2(100 BYTE),
  SETS_VALUE1  VARCHAR2(100 BYTE),
  SETS_VALUE2  VARCHAR2(100 BYTE),
  SETS_VALUE3  VARCHAR2(100 BYTE),
  SETS_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.SETSTATE IS 'Address state';


--
-- SETTLING_201707  (Table) 
--
CREATE TABLE SBS1_ADMIN.SETTLING_201707
(
  SET_ID        VARCHAR2(10 BYTE)               NOT NULL,
  SET_ETID      VARCHAR2(10 BYTE)               NOT NULL,
  SET_CONID     VARCHAR2(10 BYTE)               NOT NULL,
  SET_DEMO      NUMBER(1)                       NOT NULL,
  SET_SEPID     VARCHAR2(10 BYTE),
  SET_NUMBER    VARCHAR2(10 BYTE),
  SET_DATECRE   DATE                            NOT NULL,
  SET_DATEPRN1  DATE,
  SET_REPID1    VARCHAR2(10 BYTE),
  SET_DATEPRN2  DATE,
  SET_REPID2    VARCHAR2(10 BYTE),
  SET_DATECAN   DATE,
  SET_SETIDOLD  VARCHAR2(10 BYTE),
  SET_CURRENCY  VARCHAR2(10 BYTE),
  SET_NET       NUMBER(12,4)                    NOT NULL,
  SET_VAT       NUMBER(12,4)                    NOT NULL,
  SET_TOTAL     NUMBER(12,4)                    NOT NULL,
  SET_ESID      VARCHAR2(10 BYTE)               NOT NULL,
  SET_DATE1     DATE,
  SET_DATE2     DATE,
  SET_COMMENT   VARCHAR2(2000 BYTE)
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;


--
-- SETTYPE  (Table) 
--
CREATE TABLE SBS1_ADMIN.SETTYPE
(
  SETT_ID      VARCHAR2(10 BYTE)                NOT NULL,
  SETT_CODE    VARCHAR2(10 BYTE)                NOT NULL,
  SETT_LANG01  VARCHAR2(100 BYTE),
  SETT_LANG02  VARCHAR2(100 BYTE),
  SETT_LANG03  VARCHAR2(100 BYTE),
  SETT_LANG04  VARCHAR2(100 BYTE),
  SETT_VALUE1  VARCHAR2(100 BYTE),
  SETT_VALUE2  VARCHAR2(100 BYTE),
  SETT_VALUE3  VARCHAR2(100 BYTE),
  SETT_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.SETTYPE IS 'Settling type';


--
-- SMSCSTATE  (Table) 
--
CREATE TABLE SBS1_ADMIN.SMSCSTATE
(
  SMSCS_ID      VARCHAR2(10 BYTE)               NOT NULL,
  SMSCS_CODE    VARCHAR2(10 BYTE)               NOT NULL,
  SMSCS_LANG01  VARCHAR2(100 BYTE),
  SMSCS_LANG02  VARCHAR2(100 BYTE),
  SMSCS_LANG03  VARCHAR2(100 BYTE),
  SMSCS_LANG04  VARCHAR2(100 BYTE),
  SMSCS_VALUE1  VARCHAR2(100 BYTE),
  SMSCS_VALUE2  VARCHAR2(100 BYTE),
  SMSCS_VALUE3  VARCHAR2(100 BYTE),
  SMSCS_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.SMSCSTATE IS 'smsc state table';

COMMENT ON COLUMN SBS1_ADMIN.SMSCSTATE.SMSCS_ID IS 'state id';

COMMENT ON COLUMN SBS1_ADMIN.SMSCSTATE.SMSCS_CODE IS 'code';

COMMENT ON COLUMN SBS1_ADMIN.SMSCSTATE.SMSCS_LANG01 IS 'language 1';

COMMENT ON COLUMN SBS1_ADMIN.SMSCSTATE.SMSCS_LANG02 IS 'language 2';

COMMENT ON COLUMN SBS1_ADMIN.SMSCSTATE.SMSCS_LANG03 IS 'language 3';

COMMENT ON COLUMN SBS1_ADMIN.SMSCSTATE.SMSCS_LANG04 IS 'language 4';

COMMENT ON COLUMN SBS1_ADMIN.SMSCSTATE.SMSCS_VALUE1 IS 'value 1';

COMMENT ON COLUMN SBS1_ADMIN.SMSCSTATE.SMSCS_VALUE2 IS 'value 2';

COMMENT ON COLUMN SBS1_ADMIN.SMSCSTATE.SMSCS_VALUE3 IS 'value 3';

COMMENT ON COLUMN SBS1_ADMIN.SMSCSTATE.SMSCS_VALUE4 IS 'value 4';


--
-- SMS_IW_MT_ARCH  (Table) 
--
CREATE TABLE SBS1_ADMIN.SMS_IW_MT_ARCH
(
  BDA_DAY       DATE                            NOT NULL,
  BDA_SMSCID    VARCHAR2(10 BYTE)               NOT NULL,
  BDA_BIHID     VARCHAR2(10 BYTE)               NOT NULL,
  BDA_BIRECNO   NUMBER(8)                       NOT NULL,
  BDA_SCA       VARCHAR2(20 BYTE),
  BDA_DATETIME  DATE,
  BDA_MSISDN_A  VARCHAR2(20 BYTE),
  BDA_IMSI      VARCHAR2(20 BYTE),
  BDA_MSISDN_B  VARCHAR2(20 BYTE),
  BDA_MSCID     VARCHAR2(20 BYTE), 
  CONSTRAINT PK_SMS_IW_MT_ARCH
  PRIMARY KEY
  (BDA_DAY, BDA_SMSCID, BDA_BIHID, BDA_BIRECNO)
  ENABLE VALIDATE
)
ORGANIZATION INDEX
PCTTHRESHOLD 50
TABLESPACE SBS1_BASE_DATA
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            BUFFER_POOL      DEFAULT
           )
PARTITION BY RANGE (BDA_DAY)
(  
  PARTITION SMSA201808 VALUES LESS THAN (TO_DATE(' 2018-09-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_ARCHIV_DATA_NC
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSA201809 VALUES LESS THAN (TO_DATE(' 2018-10-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_ARCHIV_DATA_NC
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSA201810 VALUES LESS THAN (TO_DATE(' 2018-11-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_ARCHIV_DATA_NC
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSA201811 VALUES LESS THAN (TO_DATE(' 2018-12-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_ARCHIV_DATA_NC
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSA201812 VALUES LESS THAN (TO_DATE(' 2019-01-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_ARCHIV_DATA_NC
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSA201901 VALUES LESS THAN (TO_DATE(' 2019-02-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_ARCHIV_DATA_NC
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSA201902 VALUES LESS THAN (TO_DATE(' 2019-03-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_ARCHIV_DATA_NC
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               )
);

COMMENT ON TABLE SBS1_ADMIN.SMS_IW_MT_ARCH IS 'Archive for terminating interworking SMS';


--
-- SQLN_EXPLAIN_PLAN  (Table) 
--
CREATE TABLE SBS1_ADMIN.SQLN_EXPLAIN_PLAN
(
  STATEMENT_ID     VARCHAR2(30 BYTE),
  TIMESTAMP        DATE,
  REMARKS          VARCHAR2(80 BYTE),
  OPERATION        VARCHAR2(30 BYTE),
  OPTIONS          VARCHAR2(30 BYTE),
  OBJECT_NODE      VARCHAR2(128 BYTE),
  OBJECT_OWNER     VARCHAR2(30 BYTE),
  OBJECT_NAME      VARCHAR2(30 BYTE),
  OBJECT_INSTANCE  INTEGER,
  OBJECT_TYPE      VARCHAR2(30 BYTE),
  OPTIMIZER        VARCHAR2(255 BYTE),
  SEARCH_COLUMNS   INTEGER,
  ID               INTEGER,
  PARENT_ID        INTEGER,
  POSITION         INTEGER,
  COST             INTEGER,
  CARDINALITY      INTEGER,
  BYTES            INTEGER,
  OTHER_TAG        VARCHAR2(255 BYTE),
  PARTITION_START  VARCHAR2(255 BYTE),
  PARTITION_STOP   VARCHAR2(255 BYTE),
  PARTITION_ID     INTEGER,
  OTHER            LONG,
  DISTRIBUTION     VARCHAR2(30 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;


--
-- SRASTYPE  (Table) 
--
CREATE TABLE SBS1_ADMIN.SRASTYPE
(
  SRAST_ID      VARCHAR2(10 BYTE)               NOT NULL,
  SRAST_CODE    VARCHAR2(10 BYTE)               NOT NULL,
  SRAST_LANG01  VARCHAR2(100 BYTE),
  SRAST_LANG02  VARCHAR2(100 BYTE),
  SRAST_LANG03  VARCHAR2(100 BYTE),
  SRAST_LANG04  VARCHAR2(100 BYTE),
  SRAST_VALUE1  VARCHAR2(100 BYTE),
  SRAST_VALUE2  VARCHAR2(100 BYTE),
  SRAST_VALUE3  VARCHAR2(100 BYTE),
  SRAST_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.SRASTYPE IS 'SRAS address type';


--
-- SRCTYPE  (Table) 
--
CREATE TABLE SBS1_ADMIN.SRCTYPE
(
  SRCT_ID           VARCHAR2(10 BYTE)           NOT NULL,
  SRCT_CODE         VARCHAR2(10 BYTE)           NOT NULL,
  SRCT_LANG01       VARCHAR2(100 BYTE),
  SRCT_LANG02       VARCHAR2(100 BYTE),
  SRCT_LANG03       VARCHAR2(100 BYTE),
  SRCT_LANG04       VARCHAR2(100 BYTE),
  SRCT_VALUE1       VARCHAR2(100 BYTE),
  SRCT_VALUE2       VARCHAR2(100 BYTE),
  SRCT_VALUE3       VARCHAR2(100 BYTE),
  SRCT_VALUE4       VARCHAR2(100 BYTE),
  SRCT_CONTID       VARCHAR2(10 BYTE),
  SRCT_RESPACID     VARCHAR2(10 BYTE),
  SRCT_TEXT1LANG02  VARCHAR2(80 BYTE),
  SRCT_TEXT2LANG02  VARCHAR2(80 BYTE),
  SRCT_OPERNOT      VARCHAR2(1000 BYTE),
  SRCT_CCNOT        VARCHAR2(1000 BYTE),
  SRCT_MARNOT       VARCHAR2(1000 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.SRCTYPE IS 'Source type';


--
-- STA_CONFIG  (Table) 
--
CREATE TABLE SBS1_ADMIN.STA_CONFIG
(
  STAC_ID               VARCHAR2(10 BYTE)       NOT NULL,
  STAC_NAME             VARCHAR2(30 BYTE)       NOT NULL,
  STAC_LANGID           VARCHAR2(10 BYTE),
  STAC_SYSLOGGER        NUMBER                  NOT NULL,
  STAC_ACIDCRE          VARCHAR2(10 BYTE),
  STAC_DATECRE          DATE,
  STAC_ACIDMOD          VARCHAR2(10 BYTE),
  STAC_DATEMOD          DATE,
  STAC_COMMENT          VARCHAR2(2000 BYTE),
  STAC_CHNGCNT          NUMBER(5),
  STAC_DATEREPMAX       DATE                    NOT NULL,
  STAC_NOJOBSMAX        NUMBER(3)               NOT NULL,
  STAC_EXECSTAT         NUMBER(1)               NOT NULL,
  STAC_EXECREP          NUMBER(1)               NOT NULL,
  STAC_EXECPROC         NUMBER(1)               NOT NULL,
  STAC_STATACCESS       VARCHAR2(9 BYTE),
  STAC_SCHEDINADV       NUMBER(5)               NOT NULL,
  STAC_EXECSCHED        NUMBER(5)               NOT NULL,
  STAC_NOOFTRIALS       NUMBER(2)               NOT NULL,
  STAC_WAITFORWORK      NUMBER(3)               NOT NULL,
  STAC_LOGWARNING       NUMBER(1)               NOT NULL,
  STAC_SEPARATOR        CHAR(1 BYTE)            NOT NULL,
  STAC_EXECDELAY        NUMBER(2)               NOT NULL,
  STAC_MINDATEFROM      NUMBER(2)               NOT NULL,
  STAC_MAXDATETO        NUMBER(2)               NOT NULL,
  STAC_HINTSYSLOG       VARCHAR2(2000 BYTE),
  STAC_HINTDATEREPMAX   VARCHAR2(2000 BYTE),
  STAC_HINTNOJOBSMAX    VARCHAR2(2000 BYTE),
  STAC_HINTEXECSTAT     VARCHAR2(2000 BYTE),
  STAC_HINTEXECREP      VARCHAR2(2000 BYTE),
  STAC_HINTEXECPROC     VARCHAR2(2000 BYTE),
  STAC_HINTSCHEDINADV   VARCHAR2(2000 BYTE),
  STAC_HINTEXECSCHED    VARCHAR2(2000 BYTE),
  STAC_HINTWAITFORWORK  VARCHAR2(2000 BYTE),
  STAC_HINTEXECDELAY    VARCHAR2(2000 BYTE),
  STAC_HINTMINDATEFROM  VARCHAR2(2000 BYTE),
  STAC_HINTMAXDATETO    VARCHAR2(2000 BYTE),
  STAC_EXECPDF          NUMBER(1),
  STAC_ARCHIVEDIR       VARCHAR2(200 BYTE),
  STAC_MAXATTSIZE       NUMBER(8),
  STAC_HINTMAXATTSIZE   VARCHAR2(2000 BYTE),
  STAC_SMTPHOST         VARCHAR2(100 BYTE),
  STAC_SMTPPORT         NUMBER(5)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.STA_CONFIG IS 'STA Configuration';

COMMENT ON COLUMN SBS1_ADMIN.STA_CONFIG.STAC_ID IS 'Unique Id';

COMMENT ON COLUMN SBS1_ADMIN.STA_CONFIG.STAC_NAME IS 'Name';

COMMENT ON COLUMN SBS1_ADMIN.STA_CONFIG.STAC_LANGID IS 'Default language ID';

COMMENT ON COLUMN SBS1_ADMIN.STA_CONFIG.STAC_SYSLOGGER IS 'Syslogger on or off';

COMMENT ON COLUMN SBS1_ADMIN.STA_CONFIG.STAC_ACIDCRE IS 'Created by';

COMMENT ON COLUMN SBS1_ADMIN.STA_CONFIG.STAC_DATECRE IS 'Created on';

COMMENT ON COLUMN SBS1_ADMIN.STA_CONFIG.STAC_ACIDMOD IS 'Updated by';

COMMENT ON COLUMN SBS1_ADMIN.STA_CONFIG.STAC_DATEMOD IS 'Updated on';

COMMENT ON COLUMN SBS1_ADMIN.STA_CONFIG.STAC_COMMENT IS 'Comment';

COMMENT ON COLUMN SBS1_ADMIN.STA_CONFIG.STAC_CHNGCNT IS 'Change count';

COMMENT ON COLUMN SBS1_ADMIN.STA_CONFIG.STAC_DATEREPMAX IS 'Repeat until max date';

COMMENT ON COLUMN SBS1_ADMIN.STA_CONFIG.STAC_NOJOBSMAX IS 'Number of open jobs per account';

COMMENT ON COLUMN SBS1_ADMIN.STA_CONFIG.STAC_EXECSTAT IS 'Execute Statistic at all?';

COMMENT ON COLUMN SBS1_ADMIN.STA_CONFIG.STAC_EXECREP IS 'Execute EXCEL reports?';

COMMENT ON COLUMN SBS1_ADMIN.STA_CONFIG.STAC_EXECPROC IS 'Execute PDF reports?';

COMMENT ON COLUMN SBS1_ADMIN.STA_CONFIG.STAC_STATACCESS IS 'Default Stats Access Rights';

COMMENT ON COLUMN SBS1_ADMIN.STA_CONFIG.STAC_SCHEDINADV IS 'Schedule in advance in hrs';

COMMENT ON COLUMN SBS1_ADMIN.STA_CONFIG.STAC_EXECSCHED IS 'How long execute scheduled jobs (hrs)?';

COMMENT ON COLUMN SBS1_ADMIN.STA_CONFIG.STAC_NOOFTRIALS IS 'Number of max trials';

COMMENT ON COLUMN SBS1_ADMIN.STA_CONFIG.STAC_WAITFORWORK IS 'Waiting time for hanging jobs in hrs';

COMMENT ON COLUMN SBS1_ADMIN.STA_CONFIG.STAC_LOGWARNING IS 'Logging into WARNING';

COMMENT ON COLUMN SBS1_ADMIN.STA_CONFIG.STAC_SEPARATOR IS 'eMail separator';

COMMENT ON COLUMN SBS1_ADMIN.STA_CONFIG.STAC_EXECDELAY IS 'Execution delay in days';

COMMENT ON COLUMN SBS1_ADMIN.STA_CONFIG.STAC_MINDATEFROM IS 'Min Date from in months';

COMMENT ON COLUMN SBS1_ADMIN.STA_CONFIG.STAC_MAXDATETO IS 'Max Date to in months';

COMMENT ON COLUMN SBS1_ADMIN.STA_CONFIG.STAC_HINTSYSLOG IS 'Important Hints for web';

COMMENT ON COLUMN SBS1_ADMIN.STA_CONFIG.STAC_HINTDATEREPMAX IS 'Important Hints for web 2';

COMMENT ON COLUMN SBS1_ADMIN.STA_CONFIG.STAC_HINTNOJOBSMAX IS 'Important Hints for web 3';

COMMENT ON COLUMN SBS1_ADMIN.STA_CONFIG.STAC_HINTEXECSTAT IS 'Important Hints for web 4';

COMMENT ON COLUMN SBS1_ADMIN.STA_CONFIG.STAC_HINTEXECREP IS 'Important Hints for web 5';

COMMENT ON COLUMN SBS1_ADMIN.STA_CONFIG.STAC_HINTEXECPROC IS 'Important Hints for web 6';

COMMENT ON COLUMN SBS1_ADMIN.STA_CONFIG.STAC_HINTSCHEDINADV IS 'Important Hints for web 7';

COMMENT ON COLUMN SBS1_ADMIN.STA_CONFIG.STAC_HINTEXECSCHED IS 'Important Hints for web 8';

COMMENT ON COLUMN SBS1_ADMIN.STA_CONFIG.STAC_HINTWAITFORWORK IS 'Important HInts for web 9';

COMMENT ON COLUMN SBS1_ADMIN.STA_CONFIG.STAC_HINTEXECDELAY IS 'Important Hints for web 10';

COMMENT ON COLUMN SBS1_ADMIN.STA_CONFIG.STAC_HINTMINDATEFROM IS 'Important Hints for web 11';

COMMENT ON COLUMN SBS1_ADMIN.STA_CONFIG.STAC_HINTMAXDATETO IS 'Important Hints for web 12';


--
-- STA_DEBUG  (Table) 
--
CREATE TABLE SBS1_ADMIN.STA_DEBUG
(
  STADB_LINECNT   NUMBER,
  STADB_DEBUGSTR  VARCHAR2(2000 BYTE),
  STADB_HINT      VARCHAR2(2000 BYTE)
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.STA_DEBUG IS 'STA Debug';

COMMENT ON COLUMN SBS1_ADMIN.STA_DEBUG.STADB_LINECNT IS 'LineCount';

COMMENT ON COLUMN SBS1_ADMIN.STA_DEBUG.STADB_DEBUGSTR IS 'Debug String';

COMMENT ON COLUMN SBS1_ADMIN.STA_DEBUG.STADB_HINT IS 'Hint';


--
-- STA_JOBANALYZE  (Table) 
--
CREATE TABLE SBS1_ADMIN.STA_JOBANALYZE
(
  STAJA_PACID    VARCHAR2(10 BYTE),
  STAJA_DATEEXE  DATE,
  STAJA_DATESTA  DATE,
  STAJA_STD      NUMBER,
  STAJA_MIN      NUMBER,
  STAJA_SEK      NUMBER
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;


--
-- STA_JOBOTYPE  (Table) 
--
CREATE TABLE SBS1_ADMIN.STA_JOBOTYPE
(
  STAOT_ID      VARCHAR2(10 BYTE)               NOT NULL,
  STAOT_CODE    VARCHAR2(10 BYTE)               NOT NULL,
  STAOT_LANG01  VARCHAR2(100 BYTE),
  STAOT_LANG02  VARCHAR2(100 BYTE),
  STAOT_LANG03  VARCHAR2(100 BYTE),
  STAOT_LANG04  VARCHAR2(100 BYTE),
  STAOT_VALUE1  VARCHAR2(100 BYTE),
  STAOT_VALUE2  VARCHAR2(100 BYTE),
  STAOT_VALUE3  VARCHAR2(100 BYTE),
  STAOT_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.STA_JOBOTYPE IS 'STA JOBOTYPE';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOBOTYPE.STAOT_ID IS 'type id';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOBOTYPE.STAOT_CODE IS 'code';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOBOTYPE.STAOT_LANG01 IS 'language 1';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOBOTYPE.STAOT_LANG02 IS 'language 2';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOBOTYPE.STAOT_LANG03 IS 'language 3';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOBOTYPE.STAOT_LANG04 IS 'language 4';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOBOTYPE.STAOT_VALUE1 IS 'value 1';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOBOTYPE.STAOT_VALUE2 IS 'value 2';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOBOTYPE.STAOT_VALUE3 IS 'value 3';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOBOTYPE.STAOT_VALUE4 IS 'value 4';


--
-- STA_JOBSTATE  (Table) 
--
CREATE TABLE SBS1_ADMIN.STA_JOBSTATE
(
  STAJS_ID      VARCHAR2(10 BYTE)               NOT NULL,
  STAJS_CODE    VARCHAR2(10 BYTE)               NOT NULL,
  STAJS_LANG01  VARCHAR2(100 BYTE),
  STAJS_LANG02  VARCHAR2(100 BYTE),
  STAJS_LANG03  VARCHAR2(100 BYTE),
  STAJS_LANG04  VARCHAR2(100 BYTE),
  STAJS_VALUE1  VARCHAR2(100 BYTE),
  STAJS_VALUE2  VARCHAR2(100 BYTE),
  STAJS_VALUE3  VARCHAR2(100 BYTE),
  STAJS_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.STA_JOBSTATE IS 'STA  Job States';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOBSTATE.STAJS_ID IS 'job state id';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOBSTATE.STAJS_CODE IS 'job state code';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOBSTATE.STAJS_LANG01 IS 'job state language1';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOBSTATE.STAJS_LANG02 IS 'job state language2';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOBSTATE.STAJS_LANG03 IS 'job state language3';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOBSTATE.STAJS_LANG04 IS 'job state language4';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOBSTATE.STAJS_VALUE1 IS 'job state value 1';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOBSTATE.STAJS_VALUE2 IS 'job state value 2';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOBSTATE.STAJS_VALUE3 IS 'job state value 3';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOBSTATE.STAJS_VALUE4 IS 'job state value 4';


--
-- STA_SYSLOG  (Table) 
--
CREATE TABLE SBS1_ADMIN.STA_SYSLOG
(
  STAS_METHOD     VARCHAR2(100 BYTE),
  STAS_SQLCODE    NUMBER,
  STAS_SQLERRM    VARCHAR2(2000 BYTE),
  STAS_PARAMETER  VARCHAR2(2000 BYTE),
  STAS_DATELOG    DATE
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.STA_SYSLOG IS 'STA SysLogger';

COMMENT ON COLUMN SBS1_ADMIN.STA_SYSLOG.STAS_METHOD IS 'Method';

COMMENT ON COLUMN SBS1_ADMIN.STA_SYSLOG.STAS_SQLCODE IS 'SqlCode';

COMMENT ON COLUMN SBS1_ADMIN.STA_SYSLOG.STAS_SQLERRM IS 'Sql Error Message';

COMMENT ON COLUMN SBS1_ADMIN.STA_SYSLOG.STAS_PARAMETER IS 'Parameter';

COMMENT ON COLUMN SBS1_ADMIN.STA_SYSLOG.STAS_DATELOG IS 'Logger time';


--
-- STYPE  (Table) 
--
CREATE TABLE SBS1_ADMIN.STYPE
(
  ST_ID      VARCHAR2(10 BYTE)                  NOT NULL,
  ST_CODE    VARCHAR2(10 BYTE)                  NOT NULL,
  ST_LANG01  VARCHAR2(100 BYTE),
  ST_LANG02  VARCHAR2(100 BYTE),
  ST_LANG03  VARCHAR2(100 BYTE),
  ST_LANG04  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.STYPE IS 'Subscription Type';

COMMENT ON COLUMN SBS1_ADMIN.STYPE.ST_ID IS 'type id';

COMMENT ON COLUMN SBS1_ADMIN.STYPE.ST_CODE IS 'code';

COMMENT ON COLUMN SBS1_ADMIN.STYPE.ST_LANG01 IS 'language 1';

COMMENT ON COLUMN SBS1_ADMIN.STYPE.ST_LANG02 IS 'language 2';

COMMENT ON COLUMN SBS1_ADMIN.STYPE.ST_LANG03 IS 'language 3';

COMMENT ON COLUMN SBS1_ADMIN.STYPE.ST_LANG04 IS 'language 4';


--
-- TAB  (Table) 
--
CREATE TABLE SBS1_ADMIN.TAB
(
  A  INTEGER,
  B  INTEGER,
  C  INTEGER
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;


--
-- TABSPACE  (Table) 
--
CREATE TABLE SBS1_ADMIN.TABSPACE
(
  TBS_ID     VARCHAR2(10 BYTE)                  NOT NULL,
  TBS_NAME   VARCHAR2(30 BYTE)                  NOT NULL,
  TBS_DBID   VARCHAR2(10 BYTE)                  NOT NULL,
  TBS_BACK1  NUMBER(1),
  TBS_BACK2  NUMBER(1),
  TBS_BACK3  NUMBER(1),
  TBS_BACK4  NUMBER(1),
  TBS_BACK5  NUMBER(1),
  TBS_BACK6  NUMBER(1),
  TBS_BACK7  NUMBER(1)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.TABSPACE IS 'tabspace';


--
-- TDBSTATE  (Table) 
--
CREATE TABLE SBS1_ADMIN.TDBSTATE
(
  TDBS_ID      VARCHAR2(10 BYTE)                NOT NULL,
  TDBS_CODE    VARCHAR2(10 BYTE)                NOT NULL,
  TDBS_LANG01  VARCHAR2(100 BYTE),
  TDBS_LANG02  VARCHAR2(100 BYTE),
  TDBS_LANG03  VARCHAR2(100 BYTE),
  TDBS_LANG04  VARCHAR2(100 BYTE),
  TDBS_VALUE1  VARCHAR2(100 BYTE),
  TDBS_VALUE2  VARCHAR2(100 BYTE),
  TDBS_VALUE3  VARCHAR2(100 BYTE),
  TDBS_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.TDBSTATE IS 'This DB state';


--
-- TEST  (Table) 
--
CREATE TABLE SBS1_ADMIN.TEST
(
  ITEM              VARCHAR2(100 BYTE),
  VAL               VARCHAR2(1000 BYTE),
  BD_BIRECNO        VARCHAR2(8 BYTE),
  BD_DATAVOL        VARCHAR2(8 BYTE),
  BD_DURATION       VARCHAR2(20 BYTE),
  BD_NUMMSG         VARCHAR2(3 BYTE),
  BD_TAPNETRATE     VARCHAR2(15 BYTE),
  BD_TAPTAXRATE     VARCHAR2(15 BYTE),
  BD_CALLTYPE       VARCHAR2(2 BYTE),
  BD_IMSI           VARCHAR2(25 BYTE),
  BD_IMEI           VARCHAR2(17 BYTE),
  BD_CGI            VARCHAR2(25 BYTE),
  BD_STARTDATE      DATE,
  BD_OFFSET         NUMBER(10),
  BD_TRACSTARTDATE  DATE,
  BD_GSMPI          VARCHAR2(3 BYTE),
  BD_REMARK         VARCHAR2(80 BYTE),
  BD_UTXPARAMS      VARCHAR2(8 BYTE),
  BD_DATETIME       DATE,
  MO_MATCH_COUNT    NUMBER(8),
  MT_MATCH_COUNT    NUMBER(8),
  MO_MATCH_VOL      NUMBER(10),
  MT_MATCH_VOL      NUMBER(10)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;


--
-- TEST1  (Table) 
--
CREATE TABLE SBS1_ADMIN.TEST1
(
  ITEM  VARCHAR2(20 BYTE)
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;


--
-- THISDB  (Table) 
--
CREATE TABLE SBS1_ADMIN.THISDB
(
  TDB_ID    VARCHAR2(2 BYTE)                    NOT NULL,
  TDB_ESID  VARCHAR2(10 BYTE)                   NOT NULL
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.THISDB IS 'Active database';


--
-- TOAD_PLAN_TABLE  (Table) 
--
CREATE TABLE SBS1_ADMIN.TOAD_PLAN_TABLE
(
  STATEMENT_ID       VARCHAR2(30 BYTE),
  PLAN_ID            NUMBER,
  TIMESTAMP          DATE,
  REMARKS            VARCHAR2(4000 BYTE),
  OPERATION          VARCHAR2(30 BYTE),
  OPTIONS            VARCHAR2(255 BYTE),
  OBJECT_NODE        VARCHAR2(128 BYTE),
  OBJECT_OWNER       VARCHAR2(30 BYTE),
  OBJECT_NAME        VARCHAR2(30 BYTE),
  OBJECT_ALIAS       VARCHAR2(65 BYTE),
  OBJECT_INSTANCE    INTEGER,
  OBJECT_TYPE        VARCHAR2(30 BYTE),
  OPTIMIZER          VARCHAR2(255 BYTE),
  SEARCH_COLUMNS     NUMBER,
  ID                 INTEGER,
  PARENT_ID          INTEGER,
  DEPTH              INTEGER,
  POSITION           INTEGER,
  COST               INTEGER,
  CARDINALITY        INTEGER,
  BYTES              INTEGER,
  OTHER_TAG          VARCHAR2(255 BYTE),
  PARTITION_START    VARCHAR2(255 BYTE),
  PARTITION_STOP     VARCHAR2(255 BYTE),
  PARTITION_ID       INTEGER,
  OTHER              LONG,
  DISTRIBUTION       VARCHAR2(30 BYTE),
  CPU_COST           INTEGER,
  IO_COST            INTEGER,
  TEMP_SPACE         INTEGER,
  ACCESS_PREDICATES  VARCHAR2(4000 BYTE),
  FILTER_PREDICATES  VARCHAR2(4000 BYTE),
  PROJECTION         VARCHAR2(4000 BYTE),
  TIME               INTEGER,
  QBLOCK_NAME        VARCHAR2(30 BYTE),
  OTHER_XML          CLOB
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;


--
-- TPMCONSOL  (Table) 
--
CREATE TABLE SBS1_ADMIN.TPMCONSOL
(
  TPMC_MSISDN        NUMBER(16)                 NOT NULL,
  TPMC_CONSUB        VARCHAR2(10 BYTE)          NOT NULL,
  TPMC_TPID          NUMBER(4)                  NOT NULL,
  TPMC_SERVICE       VARCHAR2(20 BYTE)          NOT NULL,
  TPMC_BILLTEXT      VARCHAR2(30 BYTE)          NOT NULL,
  TPMC_PULLCOUNT     NUMBER(6),
  TPMC_PUSHCOUNT     NUMBER(6),
  TPMC_AMOUNTCU      NUMBER(9,4),
  TPMC_BILLTEXT_AGR  NUMBER(1), 
  CONSTRAINT PK_TPMCONSOL_H2
  PRIMARY KEY
  (TPMC_MSISDN, TPMC_CONSUB, TPMC_TPID, TPMC_SERVICE, TPMC_BILLTEXT)
  ENABLE VALIDATE
)
ORGANIZATION INDEX
PCTTHRESHOLD 50
TABLESPACE SBS1_APPLICATION_DATA
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );


--
-- TPMCONSOL_BAD  (Table) 
--
CREATE TABLE SBS1_ADMIN.TPMCONSOL_BAD
(
  TPMC_MSISDN     NUMBER(16),
  TPMC_CONSUB     VARCHAR2(10 BYTE),
  TPMC_TPID       NUMBER(4),
  TPMC_SERVICE    VARCHAR2(20 BYTE),
  TPMC_BILLTEXT   VARCHAR2(30 BYTE),
  TPMC_PULLCOUNT  NUMBER(6),
  TPMC_PUSHCOUNT  NUMBER(6),
  TPMC_AMOUNTCU   NUMBER(9,4)
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.TPMCONSOL_BAD IS 'Content consolidation for short IDs which use too many (individualized) billtexts';

COMMENT ON COLUMN SBS1_ADMIN.TPMCONSOL_BAD.TPMC_MSISDN IS 'msisdn of customer';

COMMENT ON COLUMN SBS1_ADMIN.TPMCONSOL_BAD.TPMC_CONSUB IS 'contract subtype';

COMMENT ON COLUMN SBS1_ADMIN.TPMCONSOL_BAD.TPMC_TPID IS 'third party id';

COMMENT ON COLUMN SBS1_ADMIN.TPMCONSOL_BAD.TPMC_SERVICE IS 'service';

COMMENT ON COLUMN SBS1_ADMIN.TPMCONSOL_BAD.TPMC_BILLTEXT IS 'billtext';

COMMENT ON COLUMN SBS1_ADMIN.TPMCONSOL_BAD.TPMC_PULLCOUNT IS 'pull counters';

COMMENT ON COLUMN SBS1_ADMIN.TPMCONSOL_BAD.TPMC_PUSHCOUNT IS 'push counters';

COMMENT ON COLUMN SBS1_ADMIN.TPMCONSOL_BAD.TPMC_AMOUNTCU IS 'customer amount';


--
-- TRCSTATE  (Table) 
--
CREATE TABLE SBS1_ADMIN.TRCSTATE
(
  TRCS_ID      VARCHAR2(10 BYTE)                NOT NULL,
  TRCS_CODE    VARCHAR2(10 BYTE)                NOT NULL,
  TRCS_LANG01  VARCHAR2(100 BYTE),
  TRCS_LANG02  VARCHAR2(100 BYTE),
  TRCS_LANG03  VARCHAR2(100 BYTE),
  TRCS_LANG04  VARCHAR2(100 BYTE),
  TRCS_VALUE1  VARCHAR2(100 BYTE),
  TRCS_VALUE2  VARCHAR2(100 BYTE),
  TRCS_VALUE3  VARCHAR2(100 BYTE),
  TRCS_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.TRCSTATE IS 'is consolidation table state';

COMMENT ON COLUMN SBS1_ADMIN.TRCSTATE.TRCS_ID IS 'state id';

COMMENT ON COLUMN SBS1_ADMIN.TRCSTATE.TRCS_CODE IS 'code';

COMMENT ON COLUMN SBS1_ADMIN.TRCSTATE.TRCS_LANG01 IS 'language 1';

COMMENT ON COLUMN SBS1_ADMIN.TRCSTATE.TRCS_LANG02 IS 'language 2';

COMMENT ON COLUMN SBS1_ADMIN.TRCSTATE.TRCS_LANG03 IS 'language 3';

COMMENT ON COLUMN SBS1_ADMIN.TRCSTATE.TRCS_LANG04 IS 'language 4';

COMMENT ON COLUMN SBS1_ADMIN.TRCSTATE.TRCS_VALUE1 IS 'value 1';

COMMENT ON COLUMN SBS1_ADMIN.TRCSTATE.TRCS_VALUE2 IS 'value 2';

COMMENT ON COLUMN SBS1_ADMIN.TRCSTATE.TRCS_VALUE3 IS 'value 3';

COMMENT ON COLUMN SBS1_ADMIN.TRCSTATE.TRCS_VALUE4 IS 'value 4';


--
-- TRCTYPE  (Table) 
--
CREATE TABLE SBS1_ADMIN.TRCTYPE
(
  TRCT_ID      VARCHAR2(10 BYTE)                NOT NULL,
  TRCT_CODE    VARCHAR2(10 BYTE)                NOT NULL,
  TRCT_LANG01  VARCHAR2(100 BYTE),
  TRCT_LANG02  VARCHAR2(100 BYTE),
  TRCT_LANG03  VARCHAR2(100 BYTE),
  TRCT_LANG04  VARCHAR2(100 BYTE),
  TRCT_VALUE1  VARCHAR2(100 BYTE),
  TRCT_VALUE2  VARCHAR2(100 BYTE),
  TRCT_VALUE3  VARCHAR2(100 BYTE),
  TRCT_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.TRCTYPE IS 'roaming consolidation type';

COMMENT ON COLUMN SBS1_ADMIN.TRCTYPE.TRCT_ID IS 'type id';

COMMENT ON COLUMN SBS1_ADMIN.TRCTYPE.TRCT_CODE IS 'code';

COMMENT ON COLUMN SBS1_ADMIN.TRCTYPE.TRCT_LANG01 IS 'language 1';

COMMENT ON COLUMN SBS1_ADMIN.TRCTYPE.TRCT_LANG02 IS 'language 2';

COMMENT ON COLUMN SBS1_ADMIN.TRCTYPE.TRCT_LANG03 IS 'language 3';

COMMENT ON COLUMN SBS1_ADMIN.TRCTYPE.TRCT_LANG04 IS 'language 4';

COMMENT ON COLUMN SBS1_ADMIN.TRCTYPE.TRCT_VALUE1 IS 'value 1';

COMMENT ON COLUMN SBS1_ADMIN.TRCTYPE.TRCT_VALUE2 IS 'value 2';

COMMENT ON COLUMN SBS1_ADMIN.TRCTYPE.TRCT_VALUE3 IS 'value 3';

COMMENT ON COLUMN SBS1_ADMIN.TRCTYPE.TRCT_VALUE4 IS 'value 4';


--
-- TRDIRECTION  (Table) 
--
CREATE TABLE SBS1_ADMIN.TRDIRECTION
(
  TRD_ID      VARCHAR2(10 BYTE)                 NOT NULL,
  TRD_CODE    VARCHAR2(10 BYTE)                 NOT NULL,
  TRD_LANG01  VARCHAR2(100 BYTE),
  TRD_LANG02  VARCHAR2(100 BYTE),
  TRD_LANG03  VARCHAR2(100 BYTE),
  TRD_LANG04  VARCHAR2(100 BYTE),
  TRD_VALUE1  VARCHAR2(100 BYTE),
  TRD_VALUE2  VARCHAR2(100 BYTE),
  TRD_VALUE3  VARCHAR2(100 BYTE),
  TRD_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.TRDIRECTION IS 'roaming consolidation type';

COMMENT ON COLUMN SBS1_ADMIN.TRDIRECTION.TRD_ID IS 'type id';

COMMENT ON COLUMN SBS1_ADMIN.TRDIRECTION.TRD_CODE IS 'code';

COMMENT ON COLUMN SBS1_ADMIN.TRDIRECTION.TRD_LANG01 IS 'language 1';

COMMENT ON COLUMN SBS1_ADMIN.TRDIRECTION.TRD_LANG02 IS 'language 2';

COMMENT ON COLUMN SBS1_ADMIN.TRDIRECTION.TRD_LANG03 IS 'language 3';

COMMENT ON COLUMN SBS1_ADMIN.TRDIRECTION.TRD_LANG04 IS 'language 4';

COMMENT ON COLUMN SBS1_ADMIN.TRDIRECTION.TRD_VALUE1 IS 'value 1';

COMMENT ON COLUMN SBS1_ADMIN.TRDIRECTION.TRD_VALUE2 IS 'value 2';

COMMENT ON COLUMN SBS1_ADMIN.TRDIRECTION.TRD_VALUE3 IS 'value 3';

COMMENT ON COLUMN SBS1_ADMIN.TRDIRECTION.TRD_VALUE4 IS 'value 4';


--
-- UAMLOG  (Table) 
--
CREATE TABLE SBS1_ADMIN.UAMLOG
(
  UAML_ACSHORT    VARCHAR2(15 BYTE)             NOT NULL,
  UAML_DATETIME   DATE                          NOT NULL,
  UAML_UAMPAID    VARCHAR2(20 BYTE)             NOT NULL,
  UAML_METHOD     VARCHAR2(30 BYTE)             NOT NULL,
  UAML_LOGIN_REQ  VARCHAR2(30 BYTE),
  UAML_ACID_REQ   VARCHAR2(30 BYTE),
  UAML_ACID       VARCHAR2(30 BYTE),
  UAML_NAME       VARCHAR2(100 BYTE),
  UAML_LANGID     VARCHAR2(2 BYTE),
  UAML_COMMENT    VARCHAR2(2000 BYTE),
  UAML_ACTYPE     VARCHAR2(10 BYTE),
  UAML_DEPT       VARCHAR2(100 BYTE),
  UAML_PHONE1     VARCHAR2(40 BYTE),
  UAML_PHONE2     VARCHAR2(40 BYTE),
  UAML_MOBILE     VARCHAR2(40 BYTE),
  UAML_FAX        VARCHAR2(40 BYTE),
  UAML_EMAIL      VARCHAR2(100 BYTE),
  UAML_ERROR      VARCHAR2(10 BYTE)
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.UAMLOG IS 'UAM access log
Logs reads and writes ececuted or attempted by UAM (User Access Management)';


--
-- UTL_RECOMP_BACKUP_JOBS  (Table) 
--
CREATE TABLE SBS1_ADMIN.UTL_RECOMP_BACKUP_JOBS
(
  JOB  NUMBER
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;


--
-- UTL_RECOMP_COMPILED  (Table) 
--
CREATE TABLE SBS1_ADMIN.UTL_RECOMP_COMPILED
(
  OBJ#  NUMBER
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;


--
-- UTL_RECOMP_INVALID  (Table) 
--
CREATE TABLE SBS1_ADMIN.UTL_RECOMP_INVALID
(
  OBJ#  NUMBER
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;


--
-- UTL_RECOMP_LOG  (Table) 
--
CREATE TABLE SBS1_ADMIN.UTL_RECOMP_LOG
(
  COMMAND  VARCHAR2(100 BYTE),
  STATUS   VARCHAR2(1000 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;


--
-- UTL_RECOMP_SORTED  (Table) 
--
CREATE TABLE SBS1_ADMIN.UTL_RECOMP_SORTED
(
  OBJ#   NUMBER,
  DEPTH  NUMBER
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;


--
-- VATCODE  (Table) 
--
CREATE TABLE SBS1_ADMIN.VATCODE
(
  VAT_ID      VARCHAR2(10 BYTE)                 NOT NULL,
  VAT_CODE01  VARCHAR2(10 BYTE)                 NOT NULL,
  VAT_CODE02  VARCHAR2(10 BYTE),
  VAT_CODE03  VARCHAR2(10 BYTE),
  VAT_CODE04  VARCHAR2(10 BYTE),
  VAT_LANG01  VARCHAR2(50 BYTE),
  VAT_LANG02  VARCHAR2(50 BYTE),
  VAT_LANG03  VARCHAR2(50 BYTE),
  VAT_LANG04  VARCHAR2(50 BYTE)
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.VATCODE IS 'VAT code';


--
-- VATRATE  (Table) 
--
CREATE TABLE SBS1_ADMIN.VATRATE
(
  VAR_ID     VARCHAR2(10 BYTE)                  NOT NULL,
  VAR_VATID  VARCHAR2(10 BYTE)                  NOT NULL,
  VAR_DATE1  DATE                               NOT NULL,
  VAR_DATE2  DATE                               NOT NULL,
  VAR_RATE   NUMBER(12,4)                       NOT NULL
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.VATRATE IS 'VAT rarte';


--
-- WARNING  (Table) 
--
CREATE TABLE SBS1_ADMIN.WARNING
(
  W_ID         VARCHAR2(10 BYTE)                NOT NULL,
  W_DATETIME   DATE                             NOT NULL,
  W_APPLIC     VARCHAR2(100 BYTE),
  W_PROCEDURE  VARCHAR2(200 BYTE),
  W_TOPIC      VARCHAR2(200 BYTE)               NOT NULL,
  W_MESSAGE    VARCHAR2(4000 BYTE),
  W_ERRORTIME  DATE                             NOT NULL,
  W_BIHID      VARCHAR2(10 BYTE),
  W_BOHID      VARCHAR2(10 BYTE),
  W_BDID       VARCHAR2(18 BYTE),
  W_SHORTID    VARCHAR2(6 BYTE),
  W_ERRORCODE  VARCHAR2(50 BYTE)
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.WARNING IS 'Warning log';


--
-- XPROCSTATE  (Table) 
--
CREATE TABLE SBS1_ADMIN.XPROCSTATE
(
  XPRS_ID      VARCHAR2(1 BYTE)                 NOT NULL,
  XPRS_CODE    VARCHAR2(10 BYTE)                NOT NULL,
  XPRS_LANG01  VARCHAR2(100 BYTE),
  XPRS_LANG02  VARCHAR2(100 BYTE),
  XPRS_LANG03  VARCHAR2(100 BYTE),
  XPRS_LANG04  VARCHAR2(100 BYTE),
  XPRS_VALUE1  VARCHAR2(100 BYTE),
  XPRS_VALUE2  VARCHAR2(100 BYTE),
  XPRS_VALUE3  VARCHAR2(100 BYTE),
  XPRS_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.XPROCSTATE IS 'XProc State';

COMMENT ON COLUMN SBS1_ADMIN.XPROCSTATE.XPRS_ID IS 'state id';

COMMENT ON COLUMN SBS1_ADMIN.XPROCSTATE.XPRS_CODE IS 'code';

COMMENT ON COLUMN SBS1_ADMIN.XPROCSTATE.XPRS_LANG01 IS 'language 1';

COMMENT ON COLUMN SBS1_ADMIN.XPROCSTATE.XPRS_LANG02 IS 'language 2';

COMMENT ON COLUMN SBS1_ADMIN.XPROCSTATE.XPRS_LANG03 IS 'language 3';

COMMENT ON COLUMN SBS1_ADMIN.XPROCSTATE.XPRS_LANG04 IS 'language 4';

COMMENT ON COLUMN SBS1_ADMIN.XPROCSTATE.XPRS_VALUE1 IS 'value 1';

COMMENT ON COLUMN SBS1_ADMIN.XPROCSTATE.XPRS_VALUE2 IS 'value 2';

COMMENT ON COLUMN SBS1_ADMIN.XPROCSTATE.XPRS_VALUE3 IS 'value 3';

COMMENT ON COLUMN SBS1_ADMIN.XPROCSTATE.XPRS_VALUE4 IS 'value 4';


--
-- ZNSTATE  (Table) 
--
CREATE TABLE SBS1_ADMIN.ZNSTATE
(
  ZNS_ID      VARCHAR2(1 BYTE)                  NOT NULL,
  ZNS_CODE    VARCHAR2(10 BYTE)                 NOT NULL,
  ZNS_LANG01  VARCHAR2(100 BYTE),
  ZNS_LANG02  VARCHAR2(100 BYTE),
  ZNS_LANG03  VARCHAR2(100 BYTE),
  ZNS_LANG04  VARCHAR2(100 BYTE),
  ZNS_VALUE1  VARCHAR2(100 BYTE),
  ZNS_VALUE2  VARCHAR2(100 BYTE),
  ZNS_VALUE3  VARCHAR2(100 BYTE),
  ZNS_VALUE4  VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.ZNSTATE IS 'Zone State';

COMMENT ON COLUMN SBS1_ADMIN.ZNSTATE.ZNS_ID IS 'state id';

COMMENT ON COLUMN SBS1_ADMIN.ZNSTATE.ZNS_CODE IS 'code';

COMMENT ON COLUMN SBS1_ADMIN.ZNSTATE.ZNS_LANG01 IS 'language 1';

COMMENT ON COLUMN SBS1_ADMIN.ZNSTATE.ZNS_LANG02 IS 'language 2';

COMMENT ON COLUMN SBS1_ADMIN.ZNSTATE.ZNS_LANG03 IS 'language 3';

COMMENT ON COLUMN SBS1_ADMIN.ZNSTATE.ZNS_LANG04 IS 'language 4';

COMMENT ON COLUMN SBS1_ADMIN.ZNSTATE.ZNS_VALUE1 IS 'value 1';

COMMENT ON COLUMN SBS1_ADMIN.ZNSTATE.ZNS_VALUE2 IS 'value 2';

COMMENT ON COLUMN SBS1_ADMIN.ZNSTATE.ZNS_VALUE3 IS 'value 3';

COMMENT ON COLUMN SBS1_ADMIN.ZNSTATE.ZNS_VALUE4 IS 'value 4';


--
-- ZONE  (Table) 
--
CREATE TABLE SBS1_ADMIN.ZONE
(
  ZN_ID          VARCHAR2(10 BYTE)              NOT NULL,
  ZN_CODE        VARCHAR2(20 BYTE)              NOT NULL,
  ZN_PRIORITY    VARCHAR2(10 BYTE)              NOT NULL,
  ZN_LANG01      VARCHAR2(100 BYTE),
  ZN_LANG02      VARCHAR2(100 BYTE),
  ZN_LANG03      VARCHAR2(100 BYTE),
  ZN_LANG04      VARCHAR2(100 BYTE),
  ZN_CGI         VARCHAR2(20 BYTE),
  ZN_PRICE       NUMBER(9,4),
  ZN_COMMENT     VARCHAR2(1000 BYTE),
  ZN_ESID        VARCHAR2(10 BYTE)              NOT NULL,
  ZN_DATECRE     DATE,
  ZN_ACIDCRE     VARCHAR2(10 BYTE),
  ZN_DATEMOD     DATE,
  ZN_ACIDMOD     VARCHAR2(10 BYTE),
  ZN_RATINGZONE  VARCHAR2(10 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.ZONE IS 'Zones';

COMMENT ON COLUMN SBS1_ADMIN.ZONE.ZN_ID IS 'zone id';

COMMENT ON COLUMN SBS1_ADMIN.ZONE.ZN_CODE IS 'code';

COMMENT ON COLUMN SBS1_ADMIN.ZONE.ZN_PRIORITY IS 'priority';

COMMENT ON COLUMN SBS1_ADMIN.ZONE.ZN_LANG01 IS 'language 1';

COMMENT ON COLUMN SBS1_ADMIN.ZONE.ZN_LANG02 IS 'language 2';

COMMENT ON COLUMN SBS1_ADMIN.ZONE.ZN_LANG03 IS 'language 3';

COMMENT ON COLUMN SBS1_ADMIN.ZONE.ZN_LANG04 IS 'language 4';

COMMENT ON COLUMN SBS1_ADMIN.ZONE.ZN_CGI IS 'cgi';

COMMENT ON COLUMN SBS1_ADMIN.ZONE.ZN_PRICE IS 'price';

COMMENT ON COLUMN SBS1_ADMIN.ZONE.ZN_COMMENT IS 'comment';

COMMENT ON COLUMN SBS1_ADMIN.ZONE.ZN_ESID IS 'zone state id';

COMMENT ON COLUMN SBS1_ADMIN.ZONE.ZN_DATECRE IS 'record creation date';

COMMENT ON COLUMN SBS1_ADMIN.ZONE.ZN_ACIDCRE IS 'record creator''s date';

COMMENT ON COLUMN SBS1_ADMIN.ZONE.ZN_DATEMOD IS 'record modification date';

COMMENT ON COLUMN SBS1_ADMIN.ZONE.ZN_ACIDMOD IS 'record modifiers date';


--
-- ZONEUSAGE  (Table) 
--
CREATE TABLE SBS1_ADMIN.ZONEUSAGE
(
  ZNU_ID       VARCHAR2(10 BYTE)                NOT NULL,
  ZNU_CODE     VARCHAR2(20 BYTE)                NOT NULL,
  ZNU_LANG01   VARCHAR2(100 BYTE),
  ZNU_COMMENT  VARCHAR2(1000 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.ZONEUSAGE IS 'Zone Usage';

COMMENT ON COLUMN SBS1_ADMIN.ZONEUSAGE.ZNU_ID IS 'usage id';

COMMENT ON COLUMN SBS1_ADMIN.ZONEUSAGE.ZNU_CODE IS 'usage code';

COMMENT ON COLUMN SBS1_ADMIN.ZONEUSAGE.ZNU_LANG01 IS 'language 01';

COMMENT ON COLUMN SBS1_ADMIN.ZONEUSAGE.ZNU_COMMENT IS 'comment';


--
-- BDETAIL2_HR_SEG_IND  (Index) 
--
CREATE INDEX SBS1_ADMIN.BDETAIL2_HR_SEG_IND ON SBS1_ADMIN.BDETAIL2_HR_SEG
(BD_SEG_COUNT, BD_ORIGSCA, BD_MSISDN_A, BD_MSISDN_B, BD_DATETIME)
TABLESPACE SBS1_ARCHIV_DATA_NC
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- DBSS_LOG_PK  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.DBSS_LOG_PK ON SBS1_ADMIN.DBSS_LOG
(CKEY)
TABLESPACE SBS1_APPLICATION_DATA
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_BDK_DATETIME  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BDK_DATETIME ON SBS1_ADMIN.BDKPI
(BDK_DATETIME)
  TABLESPACE SBS1_INFO_INDEX_UC
  PCTFREE    10
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION INFO201808
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201809
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201810
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201811
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201812
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201901
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201902
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               )
);

--
-- IDX_BDK_ID  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BDK_ID ON SBS1_ADMIN.BDKPI
(BDK_ID)
  TABLESPACE SBS1_INFO_INDEX_UC
  PCTFREE    10
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION INFO201808
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201809
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201810
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201811
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201812
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201901
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201902
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               )
);

--
-- IDX_IMR_CONOPKEY  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_IMR_CONOPKEY ON SBS1_ADMIN.IMSIRANGE
(IMR_CONOPKEY)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_IMR_MCC_MNC  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_IMR_MCC_MNC ON SBS1_ADMIN.IMSIRANGE
(IMR_MCC, IMR_MNC)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_ISCA_SEPID  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_ISCA_SEPID ON SBS1_ADMIN.ISC_AGGREGATION
(ISCA_SEPID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_NBR_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDX_NBR_CODE ON SBS1_ADMIN.NBRRANGE
(NBR_CODE)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_REVIC_CD_SHORTID_ROWID  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_REVIC_CD_SHORTID_ROWID ON SBS1_ADMIN.REVI_CONTENT_DEL
(REVICD_SHORTID, REVICD_ROWID_MASTER)
  TABLESPACE SBS1_INFO_INDEX_UC
  PCTFREE    2
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION INFO201808
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201809
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201810
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201811
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201812
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201901
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201902
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               )
);

--
-- IDX_REVIC_CS_SHORTID_ROWID  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_REVIC_CS_SHORTID_ROWID ON SBS1_ADMIN.REVI_CONTENT_SUB
(REVICS_SHORTID, REVICS_ROWID_MASTER)
  TABLESPACE SBS1_INFO_INDEX_UC
  PCTFREE    2
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION INFO201808
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201809
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201810
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201811
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201812
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201901
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201902
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               )
);

--
-- IDX_REVIM_SHORTID_ROWID6  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_REVIM_SHORTID_ROWID6 ON SBS1_ADMIN.REVI_MMS
(REVIM_SHORTID, REVIM_ROWID6)
  TABLESPACE SBS1_INFO_INDEX_UC
  PCTFREE    10
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION INFO201808
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201809
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201810
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201811
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201812
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201901
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201902
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               )
);

--
-- IDX_REVIPREM_SHORTID_ROWID  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_REVIPREM_SHORTID_ROWID ON SBS1_ADMIN.REVIPRE_MMS
(REVIPREM_SHORTID, REVIPREM_ROWIDS)
  TABLESPACE SBS1_INFO_INDEX_UC
  PCTFREE    10
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION INFO201808
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201809
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201810
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201811
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201812
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201901
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201902
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               )
);

--
-- IDX_REVIPRE_SHORTID_ROWID  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_REVIPRE_SHORTID_ROWID ON SBS1_ADMIN.REVI_PRE
(REVIPRE_SHORTID, REVIPRE_ROWID_MASTER)
  TABLESPACE SBS1_INFO_INDEX_UC
  PCTFREE    10
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION INFO201808
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201809
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201810
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201811
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201812
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201901
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201902
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               )
);

--
-- IDX_REVIPRES_SHORTID_ROWID  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_REVIPRES_SHORTID_ROWID ON SBS1_ADMIN.REVIPRE_SMS
(REVIPRES_SHORTID, REVIPRES_ROWIDS)
  TABLESPACE SBS1_INFO_INDEX_UC
  PCTFREE    10
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION INFO201808
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201809
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201810
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201811
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201812
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201901
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201902
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               )
);

--
-- IDX_REVIS_SHORTID_ROWID1  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_REVIS_SHORTID_ROWID1 ON SBS1_ADMIN.REVI_SMS
(REVIS_SHORTID, REVIS_ROWID1)
  TABLESPACE SBS1_INFO_INDEX_UC
  PCTFREE    2
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION INFO201808
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201809
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201810
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201811
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201812
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201901
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201902
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               )
);

--
-- IDX_TEST_DATETIME  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_TEST_DATETIME ON SBS1_ADMIN.TEST
(BD_DATETIME)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_ACS_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_ACS_CODE ON SBS1_ADMIN.ACSTATE
(ACS_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_ACT_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_ACT_CODE ON SBS1_ADMIN.ACTYPE
(ACT_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_ADRS_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_ADRS_CODE ON SBS1_ADMIN.ADRSTATE
(ADRS_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_ADRT_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_ADRT_CODE ON SBS1_ADMIN.ADRTYPE
(ADRT_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_UAML_AC_NAME  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_UAML_AC_NAME ON SBS1_ADMIN.UAMLOG
(UAML_NAME, UAML_DATETIME)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_UAML_DATE  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_UAML_DATE ON SBS1_ADMIN.UAMLOG
(UAML_DATETIME)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_UAML_SHORT  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_UAML_SHORT ON SBS1_ADMIN.UAMLOG
(UAML_ACSHORT, UAML_DATETIME)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_BDBS_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_BDBS_CODE ON SBS1_ADMIN.BDBSTATE
(BDBS_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_BDCS_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_BDCS_CODE ON SBS1_ADMIN.BDCSTATE
(BDCS_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_BDCT_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_BDCT_CODE ON SBS1_ADMIN.BDCTYPE
(BDCT_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_BD1S_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_BD1S_CODE ON SBS1_ADMIN.BD1STATUS
(BD1S_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_BD2S_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_BD2S_CODE ON SBS1_ADMIN.BD2STATUS
(BD2S_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_BIHS_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_BIHS_CODE ON SBS1_ADMIN.BIHSTATE
(BIHS_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_BOHS_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_BOHS_CODE ON SBS1_ADMIN.BOHSTATE
(BOHS_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_BOS_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_BOS_CODE ON SBS1_ADMIN.BOSTATE
(BOS_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_CDRT_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_CDRT_CODE ON SBS1_ADMIN.CDRTYPE
(CDRT_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_CD_TOPIC_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_CD_TOPIC_CODE ON SBS1_ADMIN.CODE
(CD_TOPIC, CD_CODE, CD_SUBCODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_CONS_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_CONS_CODE ON SBS1_ADMIN.CONSTATE
(CONS_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_CONT_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_CONT_CODE ON SBS1_ADMIN.CONTYPE
(CONT_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_CSS_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_CSS_CODE ON SBS1_ADMIN.CSSTATE
(CSS_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_CTRS_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_CTRS_CODE ON SBS1_ADMIN.CTRSTATE
(CTRS_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_CTRT_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_CTRT_CODE ON SBS1_ADMIN.CTRTYPE
(CTRT_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_DGTICS_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_DGTICS_CODE ON SBS1_ADMIN.DGTICSTATE
(DGTICS_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_DGTICT_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_DGTICT_CODE ON SBS1_ADMIN.DGTICTYPE
(DGTICT_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_ENPLARAT_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_ENPLARAT_CODE ON SBS1_ADMIN.ENPLAACTIONTYPE
(ENPLARAT_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_ENPLAR_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_ENPLAR_CODE ON SBS1_ADMIN.ENPLARANGE
(ENPLAR_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_ENPLARS_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_ENPLARS_CODE ON SBS1_ADMIN.ENPLARANGESTATE
(ENPLARS_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_ERRD_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_ERRD_CODE ON SBS1_ADMIN.ERRDEF
(ERRD_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          16K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_ERRT_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_ERRT_CODE ON SBS1_ADMIN.ERRTYPE
(ERRT_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_ET_CODE2  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_ET_CODE2 ON SBS1_ADMIN.SEDTYPE
(SEDT_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_GRT_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_GRT_CODE ON SBS1_ADMIN.GART
(GRT_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_ISCCDRTID  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_ISCCDRTID ON SBS1_ADMIN.ISCCDRTYPE
(SCCDRT_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_ISCS_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_ISCS_CODE ON SBS1_ADMIN.ISCSTATE
(ISCS_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_ISS_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_ISS_CODE ON SBS1_ADMIN.ISSTATE
(ISS_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_IST_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_IST_CODE ON SBS1_ADMIN.ISTYPE
(IST_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_IWD_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_IWD_CODE ON SBS1_ADMIN.IWDIRECTION
(IWD_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_IWTSS_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_IWTSS_CODE ON SBS1_ADMIN.IWTSSTATE
(IWTSS_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_LANG_CODES  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_LANG_CODES ON SBS1_ADMIN.LANGUAGE
(LANG_CODE, LANG_SUBCODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_LONGIDMS_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_LONGIDMS_CODE ON SBS1_ADMIN.LONGIDMSTATE
(LONGIDMS_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_LT_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_LT_CODE ON SBS1_ADMIN.LOOPTYPE
(LT_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_MAPS_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_MAPS_CODE ON SBS1_ADMIN.MAPSTATE
(MAPS_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_MAPS_CODE2  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_MAPS_CODE2 ON SBS1_ADMIN.PACSTATE
(PACS_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_MAPT_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_MAPT_CODE ON SBS1_ADMIN.MAPTYPE
(MAPT_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_MBU_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_MBU_CODE ON SBS1_ADMIN.MBUNIT
(MBU_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_MMSAT_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_MMSAT_CODE ON SBS1_ADMIN.MMSATYPE
(MMSAT_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_MMSCC_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_MMSCC_CODE ON SBS1_ADMIN.MMSCC
(MMSCC_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_MMSCCRT_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_MMSCCRT_CODE ON SBS1_ADMIN.MMSC_CDRRECTYPE
(MMSCCRT_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_MMSDZ_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_MMSDZ_CODE ON SBS1_ADMIN.MMSDZ
(MMSDZ_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_MMSRZ_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_MMSRZ_CODE ON SBS1_ADMIN.MMSRZ
(MMSRZ_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_MMSSZ_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_MMSSZ_CODE ON SBS1_ADMIN.MMSSZ
(MMSSZ_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_NOTS_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_NOTS_CODE ON SBS1_ADMIN.NOTIFICATIONSTATE
(NOTS_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_NOTT_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_NOTT_CODE ON SBS1_ADMIN.NOTIFICATIONTYPE
(NOTT_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_OGTICS_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_OGTICS_CODE ON SBS1_ADMIN.OGTICSTATE
(OGTICS_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_PACKS_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_PACKS_CODE ON SBS1_ADMIN.PACKINGSTATE
(PACKS_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_PACT_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_PACT_CODE ON SBS1_ADMIN.PACTYPE
(PACT_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_PACT_CODE2  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_PACT_CODE2 ON SBS1_ADMIN.STA_JOBOTYPE
(STAOT_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_PERIOD_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_PERIOD_CODE ON SBS1_ADMIN.PERIODICITY
(PERIOD_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_PMS_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_PMS_CODE ON SBS1_ADMIN.PMSTATE
(PMS_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_PMVS_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_PMVS_CODE ON SBS1_ADMIN.PMVSTATE
(PMVS_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_PROTT_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_PROTT_CODE ON SBS1_ADMIN.PROTTYPE
(PROTT_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_PROXYT_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_PROXYT_CODE ON SBS1_ADMIN.PROXYTYPE
(PROXYT_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_REQT_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_REQT_CODE ON SBS1_ADMIN.REQTYPE
(REQT_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_ROCS_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_ROCS_CODE ON SBS1_ADMIN.ROCSTATE
(ROCS_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_ROCT_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_ROCT_CODE ON SBS1_ADMIN.ROCTYPE
(ROCT_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_ROCT_CODE2  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_ROCT_CODE2 ON SBS1_ADMIN.TRCTYPE
(TRCT_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_ROCT_CODE3  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_ROCT_CODE3 ON SBS1_ADMIN.OGTICTYPE
(OGTICT_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_SCRS_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_SCRS_CODE ON SBS1_ADMIN.SCRIPTSTATE
(SCRS_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_SEDS_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_SEDS_CODE ON SBS1_ADMIN.SEDSTATE
(SEDS_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_SEP_DATE1  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_SEP_DATE1 ON SBS1_ADMIN.SETPERIOD
(SEP_DATE1)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_SETS_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_SETS_CODE ON SBS1_ADMIN.SETSTATE
(SETS_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_SETT_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_SETT_CODE ON SBS1_ADMIN.SETTYPE
(SETT_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_SMSCS_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_SMSCS_CODE ON SBS1_ADMIN.SMSCSTATE
(SMSCS_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_SRAST_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_SRAST_CODE ON SBS1_ADMIN.SRASTYPE
(SRAST_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_SRCT_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_SRCT_CODE ON SBS1_ADMIN.SRCTYPE
(SRCT_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_ST_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_ST_CODE ON SBS1_ADMIN.STYPE
(ST_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_TDBS_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_TDBS_CODE ON SBS1_ADMIN.TDBSTATE
(TDBS_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_TEST  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDXU_TEST ON SBS1_ADMIN.TEST
(ITEM)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_TRCS_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_TRCS_CODE ON SBS1_ADMIN.TRCSTATE
(TRCS_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_TRD_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_TRD_CODE ON SBS1_ADMIN.TRDIRECTION
(TRD_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_VAR_VATID_DATE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_VAR_VATID_DATE ON SBS1_ADMIN.VATRATE
(VAR_VATID, VAR_DATE1)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_XPROC_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_XPROC_CODE ON SBS1_ADMIN.XPROCSTATE
(XPRS_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_ZN_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_ZN_CODE ON SBS1_ADMIN.ZONE
(ZN_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_ZNS_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_ZNS_CODE ON SBS1_ADMIN.ZNSTATE
(ZNS_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_ZNU_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_ZNU_CODE ON SBS1_ADMIN.ZONEUSAGE
(ZNU_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_W_ERRORTIME  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_W_ERRORTIME ON SBS1_ADMIN.WARNING
(W_ERRORTIME)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- I_MLOG$_ACCOUNT  (Index) 
--
CREATE INDEX SBS1_ADMIN.I_MLOG$_ACCOUNT ON SBS1_ADMIN.MLOG$_ACCOUNT
(XID$$)
TABLESPACE SBS1_APPLICATION_DATA
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- I_MLOG$_CONTENTSERVICE  (Index) 
--
CREATE INDEX SBS1_ADMIN.I_MLOG$_CONTENTSERVICE ON SBS1_ADMIN.MLOG$_CONTENTSERVICE
(XID$$)
TABLESPACE SBS1_APPLICATION_DATA
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- I_MLOG$_CONTRACT  (Index) 
--
CREATE INDEX SBS1_ADMIN.I_MLOG$_CONTRACT ON SBS1_ADMIN.MLOG$_CONTRACT
(XID$$)
TABLESPACE SBS1_APPLICATION_DATA
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- I_MLOG$_ENPLAACTION  (Index) 
--
CREATE INDEX SBS1_ADMIN.I_MLOG$_ENPLAACTION ON SBS1_ADMIN.MLOG$_ENPLAACTION
(XID$$)
TABLESPACE SBS1_APPLICATION_DATA
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- I_MLOG$_ENPLARANGE  (Index) 
--
CREATE INDEX SBS1_ADMIN.I_MLOG$_ENPLARANGE ON SBS1_ADMIN.MLOG$_ENPLARANGE
(XID$$)
TABLESPACE SBS1_APPLICATION_DATA
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- I_MLOG$_ENPLARANGEENTRY  (Index) 
--
CREATE INDEX SBS1_ADMIN.I_MLOG$_ENPLARANGEENTRY ON SBS1_ADMIN.MLOG$_ENPLARANGEENTRY
(XID$$)
TABLESPACE SBS1_APPLICATION_DATA
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- I_MLOG$_ERRDEF  (Index) 
--
CREATE INDEX SBS1_ADMIN.I_MLOG$_ERRDEF ON SBS1_ADMIN.MLOG$_ERRDEF
(XID$$)
TABLESPACE SBS1_APPLICATION_DATA
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- I_MLOG$_GART  (Index) 
--
CREATE INDEX SBS1_ADMIN.I_MLOG$_GART ON SBS1_ADMIN.MLOG$_GART
(XID$$)
TABLESPACE SBS1_APPLICATION_DATA
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- I_MLOG$_IMSIRANGE  (Index) 
--
CREATE INDEX SBS1_ADMIN.I_MLOG$_IMSIRANGE ON SBS1_ADMIN.MLOG$_IMSIRANGE
(XID$$)
TABLESPACE SBS1_APPLICATION_DATA
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- I_MLOG$_KEYWORD  (Index) 
--
CREATE INDEX SBS1_ADMIN.I_MLOG$_KEYWORD ON SBS1_ADMIN.MLOG$_KEYWORD
(XID$$)
TABLESPACE SBS1_APPLICATION_DATA
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- I_MLOG$_LONGID  (Index) 
--
CREATE INDEX SBS1_ADMIN.I_MLOG$_LONGID ON SBS1_ADMIN.MLOG$_LONGID
(XID$$)
TABLESPACE SBS1_APPLICATION_DATA
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- I_MLOG$_MMSSZ  (Index) 
--
CREATE INDEX SBS1_ADMIN.I_MLOG$_MMSSZ ON SBS1_ADMIN.MLOG$_MMSSZ
(XID$$)
TABLESPACE SBS1_APPLICATION_DATA
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- I_MLOG$_NUMBERRANGE  (Index) 
--
CREATE INDEX SBS1_ADMIN.I_MLOG$_NUMBERRANGE ON SBS1_ADMIN.MLOG$_NUMBERRANGE
(XID$$)
TABLESPACE SBS1_APPLICATION_DATA
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- I_MLOG$_PRMODELENTRY  (Index) 
--
CREATE INDEX SBS1_ADMIN.I_MLOG$_PRMODELENTRY ON SBS1_ADMIN.MLOG$_PRMODELENTRY
(XID$$)
TABLESPACE SBS1_APPLICATION_DATA
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- I_MLOG$_PRMODELVER  (Index) 
--
CREATE INDEX SBS1_ADMIN.I_MLOG$_PRMODELVER ON SBS1_ADMIN.MLOG$_PRMODELVER
(XID$$)
TABLESPACE SBS1_APPLICATION_DATA
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- I_MLOG$_PRMODELVERTRANS  (Index) 
--
CREATE INDEX SBS1_ADMIN.I_MLOG$_PRMODELVERTRANS ON SBS1_ADMIN.MLOG$_PRMODELVERTRANS
(XID$$)
TABLESPACE SBS1_APPLICATION_DATA
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- I_MLOG$_RETSCHEMA  (Index) 
--
CREATE INDEX SBS1_ADMIN.I_MLOG$_RETSCHEMA ON SBS1_ADMIN.MLOG$_RETSCHEMA
(XID$$)
TABLESPACE SBS1_APPLICATION_DATA
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- I_MLOG$_SYSPARAMETERS  (Index) 
--
CREATE INDEX SBS1_ADMIN.I_MLOG$_SYSPARAMETERS ON SBS1_ADMIN.MLOG$_SYSPARAMETERS
(XID$$)
TABLESPACE SBS1_APPLICATION_DATA
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- I_MLOG$_TARIFF  (Index) 
--
CREATE INDEX SBS1_ADMIN.I_MLOG$_TARIFF ON SBS1_ADMIN.MLOG$_TARIFF
(XID$$)
TABLESPACE SBS1_APPLICATION_DATA
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- I_MLOG$_ZONE  (Index) 
--
CREATE INDEX SBS1_ADMIN.I_MLOG$_ZONE ON SBS1_ADMIN.MLOG$_ZONE
(XID$$)
TABLESPACE SBS1_APPLICATION_DATA
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- INDEXS_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.INDEXS_CODE ON SBS1_ADMIN.INDEXSTATE
(INDEXS_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- LOGGER_LOGS_IDX1  (Index) 
--
CREATE INDEX SBS1_ADMIN.LOGGER_LOGS_IDX1 ON SBS1_ADMIN.LOGGER_LOGS
(TIME_STAMP, LOGGER_LEVEL)
TABLESPACE SBS1_APPLICATION_DATA
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- LOGGER_LOGS_PK  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.LOGGER_LOGS_PK ON SBS1_ADMIN.LOGGER_LOGS
(ID)
TABLESPACE SBS1_APPLICATION_DATA
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_ACSTATE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_ACSTATE ON SBS1_ADMIN.ACSTATE
(ACS_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_ACTYPE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_ACTYPE ON SBS1_ADMIN.ACTYPE
(ACT_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_ADRSTATE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_ADRSTATE ON SBS1_ADMIN.ADRSTATE
(ADRS_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_ADRTYPE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_ADRTYPE ON SBS1_ADMIN.ADRTYPE
(ADRT_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_APP_PERMISSION  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_APP_PERMISSION ON SBS1_ADMIN.APP_PERMISSION
(APP_PERM_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_BDBSTATE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_BDBSTATE ON SBS1_ADMIN.BDBSTATE
(BDBS_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_BDCSTATE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_BDCSTATE ON SBS1_ADMIN.BDCSTATE
(BDCS_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_BDCTYPE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_BDCTYPE ON SBS1_ADMIN.BDCTYPE
(BDCT_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_BD1STATUS  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_BD1STATUS ON SBS1_ADMIN.BD1STATUS
(BD1S_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_BD2STATUS  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_BD2STATUS ON SBS1_ADMIN.BD2STATUS
(BD2S_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_BIHSTATE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_BIHSTATE ON SBS1_ADMIN.BIHSTATE
(BIHS_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_BOHSTATE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_BOHSTATE ON SBS1_ADMIN.BOHSTATE
(BOHS_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_BOSTATE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_BOSTATE ON SBS1_ADMIN.BOSTATE
(BOS_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_CARRIER  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_CARRIER ON SBS1_ADMIN.CARRIER
(CAR_ID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_CDRTYPE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_CDRTYPE ON SBS1_ADMIN.CDRTYPE
(CDRT_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_CODE ON SBS1_ADMIN.CODE
(CD_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_CONSTATE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_CONSTATE ON SBS1_ADMIN.CONSTATE
(CONS_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_CONTYPE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_CONTYPE ON SBS1_ADMIN.CONTYPE
(CONT_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_CSSTATE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_CSSTATE ON SBS1_ADMIN.CSSTATE
(CSS_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_CTRSTATE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_CTRSTATE ON SBS1_ADMIN.CTRSTATE
(CTRS_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_CTRTYPE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_CTRTYPE ON SBS1_ADMIN.CTRTYPE
(CTRT_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_CURRENCY  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_CURRENCY ON SBS1_ADMIN.CURRENCY
(CUR_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_DBASE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_DBASE ON SBS1_ADMIN.DBASE
(DB_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_DGTICSTATE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_DGTICSTATE ON SBS1_ADMIN.DGTICSTATE
(DGTICS_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_DGTICTYPE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_DGTICTYPE ON SBS1_ADMIN.DGTICTYPE
(DGTICT_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_ENPLAACTIONTYPE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_ENPLAACTIONTYPE ON SBS1_ADMIN.ENPLAACTIONTYPE
(ENPLARAT_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_ENPLARANGE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_ENPLARANGE ON SBS1_ADMIN.ENPLARANGE
(ENPLAR_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_ENPLARANGEENTRY  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_ENPLARANGEENTRY ON SBS1_ADMIN.ENPLARANGEENTRY
(ENPLARE_ENPLARID, ENPLARE_PREFIX, ENPLARE_START)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_ENPLARANGESTATE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_ENPLARANGESTATE ON SBS1_ADMIN.ENPLARANGESTATE
(ENPLARS_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_ENUMERATOR  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_ENUMERATOR ON SBS1_ADMIN.ENUMERATOR
(ENUM_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_ENUM256  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_ENUM256 ON SBS1_ADMIN.ENUM256
(ENUM_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_ERRDEF  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_ERRDEF ON SBS1_ADMIN.ERRDEF
(ERRD_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          16K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_ERRORVIEW  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_ERRORVIEW ON SBS1_ADMIN.ERRORVIEW
(ERV_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_ERRTYPE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_ERRTYPE ON SBS1_ADMIN.ERRTYPE
(ERRT_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_ERVPERMISSIONS  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_ERVPERMISSIONS ON SBS1_ADMIN.ERVPERMISSIONS
(ERVP_ACTID, ERVP_ERVID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_ERVTIMESPAN  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_ERVTIMESPAN ON SBS1_ADMIN.ERVTIMESPAN
(ERVTSP_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_EXCHANGERATE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_EXCHANGERATE ON SBS1_ADMIN.EXCHANGERATE
(EXR_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_GART  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_GART ON SBS1_ADMIN.GART
(GRT_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_IMSIRANGE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_IMSIRANGE ON SBS1_ADMIN.IMSIRANGE
(IMR_ID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_INDEXSTATE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_INDEXSTATE ON SBS1_ADMIN.INDEXSTATE
(INDEXS_MAPID, INDEXS_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_ISC_AGGREGATION  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_ISC_AGGREGATION ON SBS1_ADMIN.ISC_AGGREGATION
(ISCA_ID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_ISCCDRTYPE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_ISCCDRTYPE ON SBS1_ADMIN.ISCCDRTYPE
(ISCCDRT_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_ISCSTATE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_ISCSTATE ON SBS1_ADMIN.ISCSTATE
(ISCS_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

-- Index PK_ISMSTAT is created automatically by Oracle with index organized table ISMSTAT.

--
-- PK_ISSTATE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_ISSTATE ON SBS1_ADMIN.ISSTATE
(ISS_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_ISTYPE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_ISTYPE ON SBS1_ADMIN.ISTYPE
(IST_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_ITERATOR  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_ITERATOR ON SBS1_ADMIN.PACITERATOR
(PACI_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_IWDIRECTION  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_IWDIRECTION ON SBS1_ADMIN.IWDIRECTION
(IWD_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_IWTSSTATE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_IWTSSTATE ON SBS1_ADMIN.IWTSSTATE
(IWTSS_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_KPI_HISTORY  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_KPI_HISTORY ON SBS1_ADMIN.KPI_HISTORY
(KPIH_VIEW, KPIH_PERIOD)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_LANGUAGE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_LANGUAGE ON SBS1_ADMIN.LANGUAGE
(LANG_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_LONGIDMSTATE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_LONGIDMSTATE ON SBS1_ADMIN.LONGIDMSTATE
(LONGIDMS_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_LOOPTYPE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_LOOPTYPE ON SBS1_ADMIN.LOOPTYPE
(LT_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_MAPSTATE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_MAPSTATE ON SBS1_ADMIN.MAPSTATE
(MAPS_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_MAPTYPE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_MAPTYPE ON SBS1_ADMIN.MAPTYPE
(MAPT_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_MBUNIT  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_MBUNIT ON SBS1_ADMIN.MBUNIT
(MBU_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_MMSATYPE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_MMSATYPE ON SBS1_ADMIN.MMSATYPE
(MMSAT_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_MMSCC  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_MMSCC ON SBS1_ADMIN.MMSCC
(MMSCC_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_MMSC_CDRRECTYPE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_MMSC_CDRRECTYPE ON SBS1_ADMIN.MMSC_CDRRECTYPE
(MMSCCRT_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_MMSC_EVENTDISPTYPE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_MMSC_EVENTDISPTYPE ON SBS1_ADMIN.MMSC_EVENTDISPTYPE
(MMSCET_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_MMSC_MSGCLASS  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_MMSC_MSGCLASS ON SBS1_ADMIN.MMSC_MSGCLASS
(MMSCMC_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_MMSC_MSGTYPE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_MMSC_MSGTYPE ON SBS1_ADMIN.MMSC_MSGTYPE
(MMSCMT_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_MMSDZ  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_MMSDZ ON SBS1_ADMIN.MMSDZ
(MMSDZ_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_MMSRZ  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_MMSRZ ON SBS1_ADMIN.MMSRZ
(MMSRZ_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_MMSSZ  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_MMSSZ ON SBS1_ADMIN.MMSSZ
(MMSSZ_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_MOTYPE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_MOTYPE ON SBS1_ADMIN.MOTYPE
(MOT_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_NOTIFICATIONSTATE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_NOTIFICATIONSTATE ON SBS1_ADMIN.NOTIFICATIONSTATE
(NOTS_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_NOTIFICATIONTYPE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_NOTIFICATIONTYPE ON SBS1_ADMIN.NOTIFICATIONTYPE
(NOTT_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_OGTICSTATE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_OGTICSTATE ON SBS1_ADMIN.OGTICSTATE
(OGTICS_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_OGTICTYPE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_OGTICTYPE ON SBS1_ADMIN.OGTICTYPE
(OGTICT_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_PACKINGSTATE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_PACKINGSTATE ON SBS1_ADMIN.PACKINGSTATE
(PACKS_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_PACSTATE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_PACSTATE ON SBS1_ADMIN.PACSTATE
(PACS_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_PACTYPE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_PACTYPE ON SBS1_ADMIN.PACTYPE
(PACT_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_PARTAG_CONFIG  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_PARTAG_CONFIG ON SBS1_ADMIN.PARTAG_CONFIG
(PARTAGC_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_PERIODICITY  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_PERIODICITY ON SBS1_ADMIN.PERIODICITY
(PERIOD_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_PMSTATE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_PMSTATE ON SBS1_ADMIN.PMSTATE
(PMS_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_PMVSTATE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_PMVSTATE ON SBS1_ADMIN.PMVSTATE
(PMVS_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_PROTTYPE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_PROTTYPE ON SBS1_ADMIN.PROTTYPE
(PROTT_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_PROXYTYPE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_PROXYTYPE ON SBS1_ADMIN.PROXYTYPE
(PROXYT_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_RACACHE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_RACACHE ON SBS1_ADMIN.RACACHE
(RAC_AUDIT_ID, RAC_ACID, RAC_PERIOD_TYPE, RAC_PERIOD, RAC_ETID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_REQTYPE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_REQTYPE ON SBS1_ADMIN.REQTYPE
(REQT_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_RETSCHEMA  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_RETSCHEMA ON SBS1_ADMIN.RETSCHEMA
(RS_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_REVA_ANASTATE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_REVA_ANASTATE ON SBS1_ADMIN.REVA_ANASTATE
(REVAST_SRCTYPE, REVAST_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_REVA_BILLEDITEM  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_REVA_BILLEDITEM ON SBS1_ADMIN.REVA_BILLEDITEM
(REVABI_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_REVA_BILLTYPE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_REVA_BILLTYPE ON SBS1_ADMIN.REVA_BILLTYPE
(REVABT_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_REVA_CONFIG  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_REVA_CONFIG ON SBS1_ADMIN.REVA_CONFIG
(REVAC_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_REVA_SIGTYPE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_REVA_SIGTYPE ON SBS1_ADMIN.REVA_SIGTYPE
(REVAT_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

-- Index PK_REVA_SPECIAL_DAYS is created automatically by Oracle with index organized table REVA_SPECIAL_DAYS.

--
-- PK_REVA_STATE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_REVA_STATE ON SBS1_ADMIN.REVA_STATE
(REVAS_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_REVI_CONFIG  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_REVI_CONFIG ON SBS1_ADMIN.REVI_CONFIG
(REVIC_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_ROCSTATE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_ROCSTATE ON SBS1_ADMIN.ROCSTATE
(ROCS_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_ROCTYPE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_ROCTYPE ON SBS1_ADMIN.ROCTYPE
(ROCT_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_SCRIPTSTATE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_SCRIPTSTATE ON SBS1_ADMIN.SCRIPTSTATE
(SCRS_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_SEDSTATE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_SEDSTATE ON SBS1_ADMIN.SEDSTATE
(SEDS_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_SEDTYPE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_SEDTYPE ON SBS1_ADMIN.SEDTYPE
(SEDT_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_SETPERIOD  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_SETPERIOD ON SBS1_ADMIN.SETPERIOD
(SEP_ID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_SETSTATE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_SETSTATE ON SBS1_ADMIN.SETSTATE
(SETS_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_SETTYPE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_SETTYPE ON SBS1_ADMIN.SETTYPE
(SETT_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_SMSCSTATE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_SMSCSTATE ON SBS1_ADMIN.SMSCSTATE
(SMSCS_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

-- Index PK_SMS_IW_MT_ARCH is created automatically by Oracle with index organized table SMS_IW_MT_ARCH.

--
-- PK_SRASTYPE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_SRASTYPE ON SBS1_ADMIN.SRASTYPE
(SRAST_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_SRCTYPE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_SRCTYPE ON SBS1_ADMIN.SRCTYPE
(SRCT_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_STACONFIG  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_STACONFIG ON SBS1_ADMIN.STA_CONFIG
(STAC_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_STAJOBOTYPE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_STAJOBOTYPE ON SBS1_ADMIN.STA_JOBOTYPE
(STAOT_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_STAJOBSTATE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_STAJOBSTATE ON SBS1_ADMIN.STA_JOBSTATE
(STAJS_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_STYPE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_STYPE ON SBS1_ADMIN.STYPE
(ST_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_TABSPACE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_TABSPACE ON SBS1_ADMIN.TABSPACE
(TBS_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_TDBSTATE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_TDBSTATE ON SBS1_ADMIN.TDBSTATE
(TDBS_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_THISDB  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_THISDB ON SBS1_ADMIN.THISDB
(TDB_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

-- Index PK_TPMCONSOL_H2 is created automatically by Oracle with index organized table TPMCONSOL.

--
-- PK_TRCSTATE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_TRCSTATE ON SBS1_ADMIN.TRCSTATE
(TRCS_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_TRCTYPE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_TRCTYPE ON SBS1_ADMIN.TRCTYPE
(TRCT_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_TRDIRECTION  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_TRDIRECTION ON SBS1_ADMIN.TRDIRECTION
(TRD_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_VATCODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_VATCODE ON SBS1_ADMIN.VATCODE
(VAT_ID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_VATRATE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_VATRATE ON SBS1_ADMIN.VATRATE
(VAR_ID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_WARNING  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_WARNING ON SBS1_ADMIN.WARNING
(W_ID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_XPROCSTATE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_XPROCSTATE ON SBS1_ADMIN.XPROCSTATE
(XPRS_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_ZNSTATE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_ZNSTATE ON SBS1_ADMIN.ZNSTATE
(ZNS_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_ZONE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_ZONE ON SBS1_ADMIN.ZONE
(ZN_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_ZONEUSAGE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_ZONEUSAGE ON SBS1_ADMIN.ZONEUSAGE
(ZNU_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- SBS0_STATS  (Index) 
--
CREATE INDEX SBS1_ADMIN.SBS0_STATS ON SBS1_ADMIN.SBS0_STATS
(STATID, TYPE, C5, C1, C2, 
C3, C4, VERSION)
TABLESPACE SBS1_BASE_DATA
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- UTL_RECOMP_COMP_IDX1  (Index) 
--
CREATE INDEX SBS1_ADMIN.UTL_RECOMP_COMP_IDX1 ON SBS1_ADMIN.UTL_RECOMP_COMPILED
(OBJ#)
TABLESPACE SBS1_BASE_DATA
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- "PPB_RO_DBL.EXASTAG.PIOSCS"  (Database Link) 
--
CREATE DATABASE LINK "PPB_RO_DBL.EXASTAG.PIOSCS"
 CONNECT TO DBL_SBS
 IDENTIFIED BY <password>
 USING 'PPB_RO_DBL.EXASTAG.PIOSCS';


--
-- PKG_DEBUG  (Package) 
--
CREATE OR REPLACE PACKAGE SBS1_ADMIN.PKG_DEBUG
  IS

PROCEDURE debug_reva(
    lBih_id in varchar2,
    lBoh_id in varchar2,
    lRevah_id in varchar2,
    lReccount number,
    what in varchar2,
    lHint in varchar2
);

END;
/


--
-- PKG_STATS_DEBUG  (Package) 
--
CREATE OR REPLACE PACKAGE SBS1_ADMIN.PKG_STATS_DEBUG
  IS

procedure debug
     ( p_description in varchar2, p_value in varchar2, p_hint in varchar2);

procedure reset;

END; -- Package Specification PKG_STATS_DEBUG

 
/


--
-- PKG_ZONING  (Package) 
--
CREATE OR REPLACE PACKAGE SBS1_ADMIN.PKG_ZONING 
Is
    
Procedure SP_GET_ZONE_ID_MSC
(
  p_BD_SRCTYPE    In      Varchar2,
  p_BD_DEMO       In      Number,
  p_CdrType       In      Varchar2,                       -- in case of MSC: originating/terminating CDR
  p_MsisdnA       In      Varchar2,
  p_MsisdnB       In      Varchar2,
  p_Imsi          In      Varchar2,
  p_ZoneId        In Out  Varchar2,
  p_ZoneCode      In Out  Varchar2,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  ReturnStatus    In Out  Number
);

End; -- Package Specification PKG_ZONING


 
/


--
-- UTL_RECOMP  (Package) 
--
CREATE OR REPLACE PACKAGE SBS1_ADMIN.utl_recomp IS
   /*
    * NAME:
    *   recomp_parallel
    *
    * PARAMETERS:
    *   threads    (IN) - Number of recompile threads to run in parallel
    *                     If NULL, use the value of `job_queue_processes'.
    *   schema     (IN) - Schema in which to recompile invalid objects
    *                     If NULL, all invalid objects in the database
    *                     are recompiled.
    *   flags      (IN) - The following option flags are supported:
    *      SHARE_JOB_QUEUE - Allow user jobs in the job queue to run
    *                     concurrently with recompile jobs. This option
    *                     is useful if the recompile is executed on a
    *                     production system (i.e., not part of an upgrade)
    *      COMPILE_LOG  - Keep a log of the compile statements executed
    *                     and the status of execution.
    *      NO_REUSE_SETTINGS  - Do not reuse compiler settings for PL/SQL
    *                     compiles. *Note*: This setting will delete old
    *                     compiler settings stored with PL/SQL objects,
    *                     and must be used with caution.
    *
    * DESCRIPTION:
    *   This procedure is the main driver that recompiles invalid objects
    *   in the database (or in a given schema) in parallel in dependency
    *   order. It uses information in dependency$ to order recompilation
    *   of dependents after parents.
    *
    * NOTES:
    *   The parallel recompile exploits multiple CPUs to reduce the time
    *   taken to recompile invalid objects. However, please note that
    *   recompilation writes significant amounts of data to system tables,
    *   so the disk system may be a bottleneck and prevent significant
    *   speedups.
    */
   PROCEDURE recomp_parallel(threads PLS_INTEGER := NULL,
                             schema VARCHAR2 := NULL,
                             flags PLS_INTEGER := 0);

   SHARE_JOB_QUEUE   CONSTANT PLS_INTEGER := 1;
   COMPILE_LOG       CONSTANT PLS_INTEGER := 2;
   NO_REUSE_SETTINGS CONSTANT PLS_INTEGER := 4;

   /*
    * NAME:
    *   recomp_serial
    *
    * PARAMETERS:
    *   schema     (IN) - Schema in which to recompile invalid objects
    *                     If NULL, all invalid objects in the database
    *                     are recompiled.
    *   flags      (IN) - The following option flags are supported:
    *      COMPILE_LOG  - Keep a log of the compile statements executed
    *                     and the status of execution.
    *      NO_REUSE_SETTINGS  - Do not reuse compiler settings for PL/SQL
    *                     compiles. *Note*: This setting will delete old
    *                     compiler settings stored with PL/SQL objects,
    *                     and must be used with caution.
    *
    * DESCRIPTION:
    *   This procedure recompiles invalid objects in a given schema or
    *   all invalid objects in the database.
    */
   PROCEDURE recomp_serial(schema VARCHAR2 := NULL, flags PLS_INTEGER := 0);

   /*
    * NAME:
    *   parallel_slave
    *
    * PARAMETERS:
    *   batch_size   (IN) - Number of jobs to pick in each iteration
    *   flags      (IN) - The following option flags are supported:
    *      COMPILE_LOG  - Keep a log of the compile statements executed
    *                     and the status of execution.
    *      NO_REUSE_SETTINGS  - Do not reuse compiler settings for PL/SQL
    *                     compiles. *Note*: This setting will delete old
    *                     compiler settings stored with PL/SQL objects,
    *                     and must be used with caution.
    *
    * DESCRIPTION:
    *   This is an internal function that runs in each parallel thread.
    *   It picks up any remaining invalid objects from utl_recomp_sorted
    *   and recompiles them.
    */
   PROCEDURE parallel_slave(batch_size PLS_INTEGER, flags PLS_INTEGER);

   /*
    * NAME:
    *   restore_job_queue
    *
    * DESCRIPTION:
    *   This procedure restores all jobs in the job queue back to their
    *   original state. Call this procedure to restore the job queue if
    *   one of the recomp procedures ended abruptly.
    */
   PROCEDURE restore_job_queue;
END;
 
/


--
-- PKG_DEBUG  (Package Body) 
--
CREATE OR REPLACE PACKAGE BODY SBS1_ADMIN.PKG_DEBUG
IS
-- Purpose: Allow applications to write debug information to their respective debug tables
--
-- MODIFICATION HISTORY
-- Person   Date        Comments
-- -----    ----------  ------------------------------------------
-- 001SO    01.02.2006  Procedure debug_enpla added
-- 002SO    26.10.2008  Remove MMSVAS section
-- 003SO    13.12.2011  Remove CAT implementation
-- 004SO    14.12.2011  Remove schema qualifier "S B S 0 ."
-- 005SO    17.10.2018  Remove procedures debug_enpla and jschedule

vLineCount number;


PROCEDURE debug_reva(
    lBih_id in varchar2,
    lBoh_id in varchar2,
    lRevah_id in varchar2,
    lReccount number,
    what in varchar2,
    lHint in varchar2
)   IS
    ErrorCode number;
    ErrorMsg varchar2(4000);
    PRAGMA AUTONOMOUS_TRANSACTION;
BEGIN
  if (upper(what)='START') then
      insert into reva_debug (bih_id, boh_id,revah_id, startdate, hint)
          values (lBih_id, lBoh_id, lRevah_id, sysdate, lHint);
  else
      update reva_debug
        set enddate=sysdate, reccount=lReccount
        where bih_id=lBih_id and revah_id=lRevah_id;
  end if;
  commit;

  exception
    when Others then
       ErrorCode := SQLCODE;
       ErrorMsg  := SQLERRM;
END;

END;
/


--
-- PKG_STATS_DEBUG  (Package Body) 
--
CREATE OR REPLACE PACKAGE BODY SBS1_ADMIN.PKG_STATS_DEBUG
IS

vLineCount number;

procedure debug
     ( p_description in varchar2, p_value in varchar2, p_hint in varchar2)

is

PRAGMA AUTONOMOUS_TRANSACTION;

begin
    insert into sta_debug (stadb_linecnt, stadb_debugstr, stadb_hint)
        values (vLineCount, p_description || ':' || p_value, p_hint);

    commit;
    vLineCount := vLineCount+1;
end;

-----------------------------------------------------
procedure reset
is

PRAGMA AUTONOMOUS_TRANSACTION;

begin
    vLineCount := 1;
    delete from sta_debug;
    commit;
end;
-------------------------------------------------------
END; -- Package Body PKG_STATS_DEBUG


/


--
-- PKG_ZONING  (Package Body) 
--
CREATE OR REPLACE PACKAGE BODY SBS1_ADMIN.PKG_ZONING
Is

-- Purpose: Contains all the ZONE-related function and procedures

-- This procedure applies the Zoning rules to the input data and returns the ZONE

-- Called from:
--    PKG_BDETAIL_MSC.SP_INSERT_MSC 

-- MODIFICATION HISTORY
-- Person      Date         Comments
-- ---------   -----------  ------------------------------------------      
-- AA           03.06.2002  created the package and procedure (SP_GET_ZONE_ID)

Procedure SP_GET_ZONE_ID_MSC
(
  p_BD_SRCTYPE    In      Varchar2,
  p_BD_DEMO       In      Number,
  p_CdrType       In      Varchar2,                       -- in case of MSC: originating/terminating CDR
  p_MsisdnA       In      Varchar2,
  p_MsisdnB       In      Varchar2,
  p_Imsi          In      Varchar2,
  p_ZoneId        In Out  Varchar2,
  p_ZoneCode      In Out  Varchar2,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  ReturnStatus    In Out  Number
)
Is 
Begin 

  ReturnStatus := 1;
  If (p_MsisdnB <= 8) Then
    p_ZoneCode := 'VAS-SCM';
  ElsIf (p_Imsi Like '22801%') Or (p_Imsi Not Like '22801%') Or (p_CdrType = 'MSC-MT') Then
    p_ZoneCode := 'RAW';
  ElsIf (p_MsisdnB Not Like '41%') Then
    p_ZoneCode := 'SMS-INT';
  Else
    p_ZoneCode := 'SMS-NAT';
  End If;
  
  Select ZN_ID Into p_ZoneId
    From ZONE
    Where ZN_CODE = p_ZoneCode;
  If Sql%NotFound Then    
    p_ZoneId := Null;
    ReturnStatus := 0;
  End If;
  
Exception
When Others then
  ErrorCode := SqlCode;
  ErrorMsg  := SqlErrM;
  ReturnStatus := 0;
  p_ZoneId := Null;
End;

-- template for smsc zone lookup
/*
Procedure SP_GET_ZONE_ID_SMSC
(

)
Is 
Begin 

  
  
Exception
When Others then
  ErrorCode := SqlCode;
  ErrorMsg  := SqlErrM;
  ReturnStatus := 0;
  p_ZoneId := Null;
End;
*/

End; -- Package Body PKG_ZONING 


/


--
-- APP_CREATE_SYNONYM  (Procedure) 
--
CREATE OR REPLACE PROCEDURE SBS1_ADMIN.APP_CREATE_SYNONYM (
    obj in varchar2,
    src in varchar2,
    dest in varchar2,
    p_exec in number default 1
) 
IS
BEGIN
    ADMIN.APP_CREATE_SYNONYM (
        obj,
        src,
        dest,
        p_exec
    );
END;
/


--
-- GPSH_CURRENCY_PUT  (Procedure) 
--
CREATE OR REPLACE PROCEDURE SBS1_ADMIN.GPSH_CURRENCY_PUT(P_CUR_JSON IN VARCHAR2)
-- MODIFICATION HISTORY
-- ---------    ------      -------------------------------------------
-- Person       Date        Comments
-- SS           10.08.16    Created

IS  
    CODE      VARCHAR2(10);
    NAME      VARCHAR2(50);
    HEADVAL   VARCHAR2(15);
    T_CUR_ID   VARCHAR2(20);
BEGIN
    SELECT CUR_CODE, CUR_NAME, CUR_HEADVAL
    INTO CODE, NAME, HEADVAL
    FROM JSON_TABLE(P_CUR_JSON, '$' COLUMNS(
        CUR_CODE PATH '$.CODE',
        CUR_NAME PATH '$.NAME',
        CUR_HEADVAL PATH '$.HEADVAL'));

    SELECT CUR_ID INTO T_CUR_ID FROM CURRENCY RIGHT JOIN DUAL ON CUR_ID = CODE;
    IF T_CUR_ID IS NULL THEN
        INSERT INTO CURRENCY (CUR_ID, CUR_NAME, CUR_HEADVAL, CUR_DATECRE)
            VALUES (CODE, NAME, HEADVAL, SYSDATE);
    ELSE
        UPDATE CURRENCY SET
            CUR_NAME = NAME,
            CUR_HEADVAL = HEADVAL,
            CUR_DATEMOD = SYSDATE
        WHERE CUR_ID = CODE;
    END IF;
END;
/


--
-- L  (Procedure) 
--
CREATE OR REPLACE PROCEDURE SBS1_ADMIN.L(
    logline     In  Varchar,
    hint        IN  Varchar default NULL
)
Is

-- Log event to LOG_DEBUG table

-- MODIFICATION HISTORY
-- Person   Date        Comments
-- -------------------  ------------------------------------------
-- 001SO    11.10.2006  Adapted from earlier version. File insert added
-- 002SO    11.10.2006  Remove logging to file system

    PRAGMA AUTONOMOUS_TRANSACTION;

Begin

        insert into log_debug (
            LDB_LINECNT,
            LDB_TIME,
            LDB_DEBUGSTR,
            LDB_HINT
        ) values (
            TEST_SEQ.nextval,
            sysdate,
            logline,
            hint
        );
        commit;

Exception
    When Others Then
        Null;
End L; -- procedure L
/


--
-- LB  (Procedure) 
--
CREATE OR REPLACE PROCEDURE SBS1_ADMIN.LB(
    logline     In  Varchar,
    hint        IN  BOOLEAN
)
Is

-- Log event to LOG_DEBUG table

-- MODIFICATION HISTORY
-- Person   Date        Comments
-- -------------------  ------------------------------------------
-- 001SO    11.10.2006  Adapted from earlier version. File insert added
-- 002SO    11.10.2006  Remove logging to file system

    PRAGMA AUTONOMOUS_TRANSACTION;
    l_result    VARCHAR2(10);
Begin

    if hint is null then
        l_result := NULL;
    elsif hint then
        l_result := 'TRUE';
    else 
        l_result := 'FALSE';    
    end if;
    
    insert into log_debug (
    	LDB_LINECNT,
    	LDB_TIME,
    	LDB_DEBUGSTR,
    	LDB_HINT
    ) values (
        TEST_SEQ.nextval,
        sysdate,
        logline,
        l_result
    );
    commit;
    
Exception
    When Others Then
        Null;
End LB; -- procedure LB
 
/


--
-- PARTREORG  (Procedure) 
--
CREATE OR REPLACE PROCEDURE SBS1_ADMIN.partreorg ( own in varchar2, tbl in varchar2, part in varchar2)  is
  val varchar2(4000);
  tbs varchar2(30);
  felder varchar2(4000);
  felder2 varchar2(4000);
  sqlcmd varchar2(4000);
  objname varchar2(30);
  ref_obj varchar2(61);
begin
  select tablespace_name into tbs from all_tab_partitions where table_owner=own and table_name=tbl and partition_name=part;
  if tbs like '%_UC' then
     tbs:=substr(tbs,1,length(tbs)-3)||'_HC';
  end if;
  sqlcmd:='create table '||own||'.'||tbl||'_'||part||' tablespace '||tbs||' pctfree 0 compress for archive high as select * from '||own||'.'||tbl||' where 1=2';
  dbms_output.put_line(sqlcmd||';');
 execute immediate sqlcmd;
  sqlcmd:='insert /*+ append */ into '||own||'.'||tbl||'_'||part||' select * from '||own||'.'||tbl||' partition ('||part||')';
  dbms_output.put_line(sqlcmd||';');
 execute immediate sqlcmd;

  for ind in (
    select * from all_indexes --all_ind_columns
    where table_owner=own and table_name=tbl
    and (table_owner,table_name) in (select table_owner,table_name from all_tab_partitions where compression='DISABLED')
  ) loop
    felder:=null;
    for col in (
      select * from all_ind_columns
      where index_owner=own
      and table_name=tbl and index_name=ind.index_name  )
    loop
       select decode(felder,null,col.column_name,felder||','||col.column_name) into felder from dual;
    end loop;
    select tablespace_name into tbs from all_ind_partitions where index_owner=ind.owner and index_name=ind.index_name and partition_name=part;
    if length(ind.index_name||'_'||part) > 30 then
       objname:=substr(ind.index_name||'_'||part,-30);
    else
       objname:=ind.index_name||'_'||part;
    end if;
    sqlcmd:='create index '||ind.owner||'.'||objname||' on '||ind.table_owner||'.'||ind.table_name||'_'||part||' ('||felder||') tablespace '||tbs;
    dbms_output.put_line(sqlcmd||';');
    execute immediate sqlcmd;
  end loop ;

  for c0 in ( select constraint_name from all_constraints where owner=own and table_name=tbl and constraint_type='R' )
  loop
    felder:='';
    felder2:='';
    if length(c0.constraint_name||'_'||part) > 30 then
       objname:=substr(c0.constraint_name||'_'||part,-30);
    else
       objname:=c0.constraint_name||'_'||part;
    end if;
    for c1 in (
      select t.owner, t.constraint_name, t.table_name, t.r_owner, t.r_constraint_name, c.column_name, rc.column_name ref_col, rc.table_name ref_tbl, rc.owner ref_own
      from all_constraints t, all_cons_columns c , all_cons_columns rc
      where t.owner=c.owner and t.constraint_name=c.constraint_name
      and t.r_owner=rc.owner and t.r_constraint_name=rc.constraint_name and c.position=rc.position
      and t.owner=own and t.table_name=tbl and t.constraint_name=c0.constraint_name  )
    loop
      select decode(felder,null,c1.column_name,felder||','||c1.column_name) into felder from dual;
      select decode(felder2,null,c1.ref_col,felder2||','||c1.ref_col) into felder2 from dual;
      ref_obj:=c1.ref_own||'.'||c1.ref_tbl;
    end loop; --c1
    sqlcmd:='alter table '||own||'.'||tbl||'_'||part||' add constraint '||objname||' foreign key('||felder||') references '||ref_obj||'('||felder2||')';
    dbms_output.put_line (sqlcmd);
   execute immediate sqlcmd;
  end loop;  --c0

  sqlcmd:='alter table '||own||'.'||tbl||' exchange partition '||part||' with table '||own||'.'||tbl||'_'||part||' including indexes';
  dbms_output.put_line(sqlcmd||';');
 execute immediate sqlcmd;
end;
/


--
-- SP_INSERT_PERIOD  (Procedure) 
--
CREATE OR REPLACE PROCEDURE SBS1_ADMIN.SP_INSERT_PERIOD(
    p_CODE      IN varchar2
)IS 
BEGIN
    
    INSERT INTO SETPERIOD (
        SEP_ID, 
        SEP_DATE1, 
        SEP_DATE2, 
        SEP_LANG01, 
        SEP_LANG02, 
        SEP_LANG03, 
        SEP_LANG04 
    ) (
        SELECT
            p_CODE,
            to_date(p_CODE,'YYYYMM'),
            to_date(to_char(ADD_MONTHS(to_date(p_CODE,'yyyymm'),1),'yyyymm'),'YYYYMM'),
            to_char(to_date(p_CODE,'YYYYMM'),'Month','NLS_DATE_LANGUAGE = American') || ' ' || to_char(to_date(p_CODE,'YYYYMM'),'YYYY'),
            to_char(to_date(p_CODE,'YYYYMM'),'Month','NLS_DATE_LANGUAGE = German'  ) || ' ' || to_char(to_date(p_CODE,'YYYYMM'),'YYYY'),
            to_char(to_date(p_CODE,'YYYYMM'),'Month','NLS_DATE_LANGUAGE = French'  ) || ' ' || to_char(to_date(p_CODE,'YYYYMM'),'YYYY'),
            to_char(to_date(p_CODE,'YYYYMM'),'Month','NLS_DATE_LANGUAGE = Italian' ) || ' ' || to_char(to_date(p_CODE,'YYYYMM'),'YYYY')
        FROM DUAL
        WHERE NOT EXISTS (SELECT SEP_ID FROM SETPERIOD WHERE SEP_ID = p_CODE)
    );
END;
 
/


--
-- TESTNEWPROC  (Procedure) 
--
CREATE OR REPLACE PROCEDURE SBS1_ADMIN.TESTNEWPROC(p_persid in integer, p_cur out sys_refcursor)
        is
        begin
            open p_cur for 'select * from test';
        end TESTNEWPROC
        ;
/


--
-- AS_DATE  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.as_date(
    p_date date
) return date
is
begin
    return p_date;
end;
/


--
-- BILLTEXT_IN_UFIH  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.BILLTEXT_IN_UFIH(
    s IN VARCHAR2
)   RETURN  VARCHAR2 IS
-- cut out billtext from UFIH CDR
   pos_f30  INTEGER;
   pos_f31  INTEGER;
   pos_f32  INTEGER;
BEGIN
    pos_f30 := INSTR(s,'F30=');
    pos_f31 := INSTR(s,'F31=');
    pos_f32 := INSTR(s,'F32=');

    IF pos_f30 > 0 THEN
        if pos_f31 > 0 then
            return SUBSTR(s,pos_f30 + 5, pos_f31-pos_f30-7);
        elsif pos_f32 > 0 then
            return SUBSTR(s,pos_f30 + 5, pos_f32-pos_f30-7);
        end if;
    ELSE
        return NULL;
    END if;

END;

 
/


--
-- BITPOS  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.bitpos (
    p_Pos       IN number,
    p_BitStr    IN VARCHAR2
) RETURN  NUMBER IS
--
-- Purpose: Extract bit at given position (0 based) from bitstring (0 or 1 or NULL if bistring is too short)  
--
-- MODIFICATION HISTORY
-- Person   Date        Comments
-- ------   ----------  -------------------------------------------
-- 001SO    02.09.2014  Created

BEGIN
    if p_BitStr is NULL then 
        return NULL;
    elsif length(p_BitStr) < p_pos + 1 then
        return NULL;
    else 
        return to_number(substr(p_BitStr,p_pos + 1));
    end if;
END;
/


--
-- BITVAL  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.bitval (
    p_Pos       IN number,
    p_Number    IN number
) RETURN  NUMBER IS
--
-- Purpose: Extract bit at given position (0 based) from integer number
--
-- MODIFICATION HISTORY
-- Person   Date        Comments
-- ------   ----------  -------------------------------------------
-- 001SO    02.09.2014  Created

BEGIN
    if p_Number is NULL then
        return NULL;
    elsif bitand(p_Number,power(2,p_Pos))+0 = 0 then
        return 0;
    else
        return 1;
    end if;
END;
/


--
-- CONTRACTPERIODEND  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.CONTRACTPERIODEND ( p_CON_DATEEND IN date) RETURN  date IS
--
-- Purpose: gets end date of contract in last month
--
x_PeriodStartDate   Date;
x_PeriodEndDate     Date;

BEGIN 
    x_PeriodStartDate := ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1);
    x_PeriodEndDate := TRUNC(SYSDATE,'MONTH');
    
    if p_CON_DATEEND is NULL Then
        RETURN x_PeriodEndDate;
    elsif p_CON_DATEEND <= x_PeriodStartDate Then
        RETURN NULL;
    elsif p_CON_DATEEND <= x_PeriodEndDate Then
        RETURN p_CON_DATEEND;
    else
        RETURN x_PeriodEndDate;
    end if;
        
END; -- Function CONTRACTPERIODEND


 
/


--
-- CONTRACTPERIODSTART  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.CONTRACTPERIODSTART  ( p_CON_DATESTART IN date) RETURN  date IS
--
-- To modify this template, edit file FUNC.TXT in TEMPLATE 
-- directory of SQL Navigator
--
-- Purpose: gets start date of contract in last month
--
x_PeriodStartDate   Date;
x_PeriodEndDate     Date;

BEGIN 
    x_PeriodStartDate := ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1);
    x_PeriodEndDate := TRUNC(SYSDATE,'MONTH');
    
    if p_CON_DATESTART is NULL Then
        RETURN x_PeriodStartDate;
    elsif p_CON_DATESTART < x_PeriodStartDate Then
        RETURN x_PeriodStartDate;
    elsif p_CON_DATESTART < x_PeriodEndDate Then
        RETURN p_CON_DATESTART;
    else
        RETURN NULL;
    end if;
        
END; -- Function CONTRACTPERIODSTART


 
/


--
-- CS_SERVICE_KEY  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.CS_SERVICE_KEY (
    p_CS_SERVICE IN VARCHAR2
) RETURN  VARCHAR2 IS
--
-- Purpose: Return Content service code transformation which allows key collation
-- MODIFICATION HISTORY
-- Person   Date        Comments
-- ------   ----------  -------------------------------------------
-- 001SO    02.05.2014  Created
-- 002SO    05.05.2014  Replace ':' with '-'

l_medium    VARCHAR2(10);
l_direction VARCHAR2(10);
l_shortid   VARCHAR2(10);
l_extension VARCHAR2(10);

BEGIN
       l_medium    :=  REGEXP_SUBSTR(p_CS_SERVICE, '[^-]+', 1, 1);
       l_direction  :=  REGEXP_SUBSTR(p_CS_SERVICE, '[^-]+', 1, 2);
       l_shortid := REGEXP_SUBSTR(p_CS_SERVICE, '[^-]+', 1, 3);
       l_extension := REGEXP_SUBSTR(p_CS_SERVICE, '[^-]+', 1, 4);

       if REGEXP_SUBSTR(p_CS_SERVICE, '[^-]+', 1, 4) is NULL then
            return  l_shortid || '-' || l_medium || '-' || l_direction;
       else
            return  l_shortid || '-' || l_medium || '-' || l_direction || '-' || l_extension;
       end if;
END;
/


--
-- DURATION  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.DURATION (
        p_time_diff            In Number
    ) Return VARCHAR2
Is  
    l_retval            Varchar2(100);
    l_seconds           Number;                                   
Begin
    
    l_seconds := p_time_diff * 3600 * 24;
    
    if p_time_diff is null then
        l_retval := NULL;
    elsif l_seconds < 60 then
        l_retval := trim(to_char(round(l_seconds,0))) || ' sec';
    elsif l_seconds < 3600 then
        l_retval := trim(to_char(round(l_seconds/60,2))) || ' min';    
    elsif p_time_diff < 1.0 then
        l_retval := trim(to_char(round(l_seconds/3600,2))) || ' hrs';        
    else
        l_retval := trim(to_char(round(p_time_diff,2))) || ' days';        
    end if;
    
    RETURN REPLACE(l_retval,',','.');

End DURATION;
 
/


--
-- FROM_JSON_BOOLEAN  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.from_json_boolean(
    p_date VARCHAR2
) return number
is
begin

    if p_date is NULL then
        return NULL;
    elsif p_date = 'true' then
        return 1;
    elsif p_date = 'false' then
        return 0;
    else
        return NULL;
    end if;
end;
/


--
-- FROM_JSON_DATE  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.from_json_date(
    p_date VARCHAR2
) return date
is
begin

    if p_date is NULL then
        return NULL;
    else
        return to_date(replace(replace(replace(p_date,'T',' '),'Z',''),'"',''),'yyyy-mm-dd hh24:mi:ss');
    end if;
end;
/


--
-- GENERATEBASE36KEY  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.generatebase36key
return varchar2
is  
    result varchar2(10) DEFAULT '';
    charList VARCHAR2(36) DEFAULT '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ';
    remainNum INTEGER;
begin
    remainNum := bd6cuc_temp_seq.NEXTVAL;

    WHILE remainNum != 0 LOOP
        result := SUBSTR(charList, MOD(remainNum, 36)+1, 1) || result;
        remainNum := TRUNC(remainNum/36);
    END LOOP;

    WHILE LENGTH(result) <  10 LOOP
        result := '0' || result;
    END LOOP;
    
    RETURN result;
end;
/


--
-- GENERATEBASE36KPIKEY  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.generatebase36kpikey
return varchar2
is 
    result varchar2(10) DEFAULT '';
    charList VARCHAR2(36) DEFAULT '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ';
    remainNum INTEGER;
begin
    remainNum := BDKPI_SEQ.NEXTVAL;
    WHILE remainNum != 0 LOOP
        result := SUBSTR(charList, MOD(remainNum, 36)+1, 1) || result;
        remainNum := TRUNC(remainNum/36);
    END LOOP;

    WHILE LENGTH(result) <  10 LOOP
        result := '0' || result;
    END LOOP;

    RETURN result;
end;
/


--
-- GENERATEUNIQUEKEY  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.GenerateUniqueKey( identifier in char )
return varchar2 
is
  cUniqueKey varchar2(10);
begin
  if identifier = 'B' then
    select lpad(BDETAIL_SEQ.NEXTVAL, 10, '0') into cUniqueKey from dual;
  else
    select lpad(GENERAL_SEQ.NEXTVAL, 10, '0') into cUniqueKey from dual;  
  end if;
  return (cUniqueKey);
end;


 
/


--
-- GET_DDL  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.get_ddl(
    lvtype in varchar2,
    lvname in varchar2,
    lvschema in varchar2
)   return clob
is
    code clob;
begin
    code := dbms_metadata.get_ddl(lvtype,lvname,lvschema);
    return code;
exception
   WHEN OTHERS THEN return to_clob('ORA' || SQLCODE);
end;
/


--
-- GETUFIHFIELD  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.GETUFIHFIELD (
        p_Token                     In      Varchar2,
        p_CdrText                   IN      Varchar2
    ) Return VARCHAR2
    Is
        -- Utility function to be used in SQL
        -- NOTE: duplicated in Package PKG_MEC_HB on SBS0 Database
        
        -- get an UFIH field value from a single CDR text string
        -- 001SO    12.09.2007 Creates based on UFIH Knowledge Base v1.7
        -- 002SO    12.09.2007 Remove @ in Date fields
        
        pos1 integer;
        pos2 integer;
    Begin
        if p_Token in ('F4','F8','F9','F13','F21','F22','F24','F28','F30','F32','F33','F58')then
            -- search for string field
            pos1 := INSTR(p_CdrText,p_Token || '=''');      -- start of token
            if pos1 > 0 then
                pos1 := pos1 + length(p_Token) + 2;         -- start of value
                pos2 := INSTR(p_CdrText,''',',pos1);        -- pos of ',
                if pos2 > 0 then
                    return SUBSTR(p_CdrText,pos1, pos2-pos1);
                else
                    pos2 := INSTR(p_CdrText,'''}',pos1);    -- pos of '}
                    if pos2 > 0 then
                        return SUBSTR(p_CdrText,pos1, pos2-pos1);
                    else
                        Return NULL;
                    end if;
                end if;
            else
                Return NULL;
            end if;
        else
            pos1 := INSTR(p_CdrText,p_Token || '=');        -- start of token
            if pos1 > 0 then
                pos1 := pos1 + length(p_Token) + 1;         -- start of value
                pos2 := INSTR(p_CdrText,',',pos1);          -- pos of ,
                if pos2 > 0 then
                    if p_Token in ('F17','F19','F54','F56')then
                        return REPLACE(SUBSTR(p_CdrText,pos1, pos2-pos1),'@','');
                    else
                        return SUBSTR(p_CdrText,pos1, pos2-pos1);
                    end if;
                else
                    pos2 := INSTR(p_CdrText,'}',pos1);      -- pos of }
                    if pos2 > 0 then
                        if p_Token in ('F17','F19','F54','F56')then
                            return REPLACE(SUBSTR(p_CdrText,pos1, pos2-pos1),'@','');
                        else
                            return SUBSTR(p_CdrText,pos1, pos2-pos1);
                        end if;
                    else
                        Return NULL;
                    end if;
                end if;
            else
                Return NULL;
            end if;
        end if;
    End;
 
/


--
-- HASH_MD5  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.HASH_MD5 (var IN VARCHAR) RETURN VARCHAR2
IS
-- Return MD5 HASH of given input parameter
BEGIN 
    RETURN dbms_obfuscation_toolkit.MD5(input => utl_raw.cast_to_raw(NVL(var,'<NULL>')));
END;

 
/


--
-- IS_ALPHANUMERIC  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.is_alphanumeric (
    p_InputValue    In              Varchar2
)
Return Number
Is
    l_Len Number;
    l_Char Varchar(1);
    l_RetVal Number;
Begin
    l_RetVal := 1;
    l_Len := Length(p_InputValue);
    For I in 1 .. l_Len Loop
        l_Char := Substr(p_InputValue, I, 1);
        if (Upper(l_Char) >= 'A' and Upper(l_Char) <= 'Z')
            or (Upper(l_Char) >= '0' and Upper(l_Char) <= '9')
            or (l_Char = '_') then
            null;   -- still alphanumeric, do nothing
        else
            l_RetVal := 0;  -- exit with error (return value = 0)
        end if;
    end Loop;
    return l_RetVal;
    
Exception
When Others Then
    Return 0;
End IS_ALPHANUMERIC;

 
/


--
-- IS_INTEGER  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.is_integer (
    p_InputValue    In              Varchar2,
    p_MinValue      In              Number default NULL,
    p_MaxValue      In              Number default NULL
)
Return Number
Is
    l_Dummy         Number;
Begin
    If (p_InputValue Is Not Null) Then
        l_Dummy := To_Number(p_InputValue);     -- will raise an exception if non-numeric
        if l_Dummy < p_MinValue then
            Return 0;
        elsif l_Dummy > p_MaxValue then
            Return 0;
        elsif Trunc(l_Dummy) = l_Dummy then
            if instr(p_InputValue,'.') > 0 then
                Return 0;
            elsif instr(upper(p_InputValue),'E') > 0 then
                Return 0;
            else
                Return 1;
            end if;
        else
            Return 0;
        end if;
    Else
        Return 0;       --007AA return 0 if null value
    End If;
Exception
When Others Then
    Return 0;           -- it is not a number  --002SO
End is_integer;
/


--
-- IS_NUMERIC  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.is_numeric (
    p_InputValue    In              Varchar2,
    p_MinValue      In              Number default NULL,
    p_MaxValue      In              Number default NULL
)
Return Number
Is
    l_Dummy         Number;
Begin
    If (p_InputValue Is Not Null) Then
        l_Dummy := To_Number(p_InputValue);     -- will raise an exception if non-numeric
        if l_Dummy < p_MinValue then
            Return 0;
        elsif l_Dummy > p_MaxValue then
            Return 0;
        else
            Return 1;
        end if;    Else
        Return 0;       --007AA return 0 if null value
    End If;
Exception
When Others Then
    Return 0;           -- it is not a number  --002SO
End is_numeric;
/


--
-- JSON_BOOLEAN  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.json_boolean(
    p_1     in varchar2,
    p_2     in varchar2 default 'null'
) return varchar2
is
begin
    if p_1 is NULL then
        return p_2;
    elsif p_1 = '1' then
        return 'true';
    elsif p_1 = '0' then
        return 'false';
    elsif lower(p_1) = 'true' then
        return 'true';
    elsif lower(p_1) = 'false' then
        return 'false';
    else
        return p_2;
    end if;
end;
/


--
-- JSON_DATE  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.json_date(
    p_date date
) return varchar2
is
begin

    if p_date is NULL then
        return '""';
    else
        return '"' || replace(to_char(p_date,'yyyy-mm-dd hh24:mi:ss'),' ','T') || 'Z"';
    end if;
end;
/


--
-- JSON_DATE_MSEC  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.json_date_msec(
    p_date date,
    p_msec number
) return varchar2
is
begin

    if p_date is NULL then
        return '""';
    else
        return '"' || replace(to_char(p_date,'yyyy-mm-dd hh24:mi:ss'),' ','T') || '.' || trim(to_char(p_msec, 'fm000')) || 'Z"';
    end if;
end;
/


--
-- JSON_DATE_USEC  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.json_date_usec(
    p_date date ,
    p_usec number default 0
) return varchar2
is
    l_epoch NUMBER;
    l_mega NUMBER;
    l_secs NUMBER;
begin

    if p_date is NULL then
        return '""';
    else
        l_epoch := round(86400 * (p_date-to_date('01.01.1970 01:00','dd.mm.yyyy hh24:mi')));
        l_mega := round(l_epoch / 1000000);
        l_secs := l_epoch rem 1000000;

        return '"{' || l_mega || ',' || l_secs || ',' || trim(to_char(p_usec, 'fm000000')) || '}"';
    end if;
end;
/


--
-- JSOND0  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.jsond0(
    p_start varchar2,
    p_key varchar2,
    p_value date
) return varchar2
is  -- append a json date
begin
    if p_value is NULL then
        return p_start;
    elsif p_start is NULL then
        return '"' || p_key || '":' || json_date(p_value);
    elsif p_start like '%{' then
        return p_start || '"' || p_key || '":' || json_date(p_value);
    else
        return p_start || ',"' || p_key || '":' || json_date(p_value);
    end if;
end;
/


--
-- JSON_FOREIGN_KEYS_2  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.json_foreign_keys_2(
    p_1     in varchar2,
    p_2     in varchar2 default NULL
) return varchar2
is
    list      varchar2(100);
begin
    if trim(p_2) is null then
        return '{"fks":[["' || p_1 || '",null]]}';
    else
        list := replace(p_2,' ','');
        if substr(list,1,1) = ';' then
            list := substr(list,2);
        end if;
        if substr(list,length(list)) = ';' then
            list := substr(list,1,length(list)-1);
        end if;
        if list is null then
            return '{"fks":[["' || p_1 || '",null]]}';
        else
            list := replace(list,';','"],["' || p_1 ||'","');
            return '{"fks":[["' || p_1 || '","' || list || '"]]}';
        end if;
    end if;
end;
/


--
-- JSON_FOREIGN_KEY_2  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.json_foreign_key_2(
    p_1     in varchar2,
    p_2     in varchar2
) return varchar2
is
    p1      varchar2(100);
    p2      varchar2(100);
begin
    if p_1 is NULL then
        p1 := '""';
    else
        p1 := '"' || p_1 || '"';
    end if;
    if p_2 is NULL then
        p2 := '""';
    else
        p2 := '"' || p_2 || '"';
    end if;

    return '{"fk":[' || p1 ||',' || p2 || ']}';
end;
/


--
-- JSON_KEY_SN  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.json_key_sn(
    p_1     in varchar2,
    p_2     in NUMBER
) return varchar2
is
    p1      varchar2(100);
begin
    if p_1 is NULL then
        p1 := '[]';
    else
        p1 := '"' || p_1 || '"';
    end if;
    return '[' || p1 ||',' || p_2 || ']';

end;
/


--
-- JSON_KEY_SNN  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.json_key_snn(
    p_1     in varchar2,
    p_2     in NUMBER,
    p_3     in NUMBER
) return varchar2
is
    p1      varchar2(100);
begin
    if p_1 is NULL then
        p1 := '[]';
    else
        p1 := '"' || p_1 || '"';
    end if;
    return '[' || p1 ||',' || p_2 ||',' || p_3 || ']';

end;
/


--
-- JSON_NUMBER  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.json_number(
    p_1     in number,
    p_2     in number default NULL
) return varchar2
is
    l_num   VARCHAR2(100);
begin
    if p_1 is NULL then
        if p_2 is NULL then
            return 'null';
        else
            l_num := to_char(p_2);
            if l_num like '.%' then
                return '0' ||l_num;
            elsif l_num like '-.%' then
                return '-0' || substr(l_num,2);
            else
                return l_num;
            end if;
        end if;
    else
        l_num := to_char(p_1);
        if l_num like '.%' then
            return '0' ||l_num;
        elsif l_num like '-.%' then
            return '-0' || substr(l_num,2);
        else
            return l_num;
        end if;
    end if;
end;
/


--
-- JSON_NUMSTR  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.json_numstr(
    p_1     in number,
    p_2     in number default 0
) return varchar2
is
begin
    if p_1 is NULL then
        return '""';            -- NULL
    elsif p_2 = 0 then
        return '"' || ltrim(to_char(p_1,'999999999990')) || '"';
    elsif p_2 = 1 then
        return '"' || ltrim(to_char(p_1,'9999999990.0')) || '"';
    elsif p_2 = 2 then
        return '"' || ltrim(to_char(p_1,'999999990.00')) || '"';
    elsif p_2 = 3 then
        return '"' || ltrim(to_char(p_1,'99999990.000')) || '"';
    elsif p_2 = 4 then
        return '"' || ltrim(to_char(p_1,'9999990.0000')) || '"';
    else
        return '"' || ltrim(to_char(p_1)) || '"';
    end if;
end;
/


--
-- JSONN0  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.jsonn0(
    p_start varchar2,
    p_key varchar2,
    p_value number
) return varchar2
is  -- append a json number
begin
    if p_value is NULL then
        return p_start;
    elsif p_start is NULL then
        return '"' || p_key || '":' || json_number(p_value);
    elsif p_start like '%{' then
        return p_start || '"' || p_key || '":' || json_number(p_value);
    else
        return p_start || ',"' || p_key || '":' || json_number(p_value);
    end if;
end;
/


--
-- JSON_PREFIX  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.json_prefix(
    p_value     in varchar2
) return varchar2
is
begin
    if p_value is NULL then
        return NULL;
    else
        return ',' || p_value;
    end if;
end;
/


--
-- JSON_STRING  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.json_string(
    p_string varchar2
) return varchar2
is
begin
    return '"' || replace(replace(replace(replace(replace(replace(replace(p_string,
        '\', '\\'),
        '"', '\"'),
        chr(8), '\b'),
        chr(9), '\t'),
        chr(10), '\n'),
        chr(12), '\f'),
        chr(13), '\r') || '"';
end;
/


--
-- JSON_STRING_KEY  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.json_string_key(
    p_1     in varchar2,
    p_2     in varchar2 default NULL,
    p_3     in Varchar2 default NULL,
    p_4     in varchar2 default NULL,
    p_5     in varchar2 default NULL,
    p_6     in varchar2 default NULL,
    p_7     in varchar2 default NULL,
    p_8     in varchar2 default NULL,
    p_9     in varchar2 default NULL,
    p_A     in varchar2 default NULL
) return varchar2
is
    p1      varchar2(100);
begin
    if p_1 is NULL then
        p1 := '[]';
    else
        p1 := '"' || p_1 || '"';
    end if;

    if p_2 is NULL then
        return '[' || p1 ||']';
    elsif p_3 is NULL then
        return '[' || p1 ||',"' || p_2 || '"]';
    elsif p_4 is NULL then
        return '[' || p1 ||',"' || p_2 ||'","' || p_3 || '"]';
    elsif p_5 is NULL then
        return '[' || p1 ||',"' || p_2 ||'","' || p_3 || '","' || p_4 || '"]';
    elsif p_6 is NULL then
        return '[' || p1 ||',"' || p_2 ||'","' || p_3 || '","' || p_4 || '","' || p_5 || '"]';
    elsif p_7 is NULL then
        return '[' || p1 ||',"' || p_2 ||'","' || p_3 || '","' || p_4 || '","' || p_5 || '","' || p_6 || '"]';
    elsif p_8 is NULL then
        return '[' || p1 ||',"' || p_2 ||'","' || p_3 || '","' || p_4 || '","' || p_5 || '","' || p_6 || '","' || p_7 || '"]';
    elsif p_9 is NULL then
        return '[' || p1 ||',"' || p_2 ||'","' || p_3 || '","' || p_4 || '","' || p_5 || '","' || p_6 || '","' || p_7 || '","' || p_8 || '"]';
    elsif p_A is NULL then
        return '[' || p1 ||',"' || p_2 ||'","' || p_3 || '","' || p_4 || '","' || p_5 || '","' || p_6 || '","' || p_7 || '","' || p_8 || '","' || p_9 || '"]';
    else
        return '[' || p1 ||',"' || p_2 ||'","' || p_3 || '","' || p_4 || '","' || p_5 || '","' || p_6 || '","' || p_7 || '","' || p_8 || '","' || p_9  || '","' || p_A|| '"]';
    end if;

end;
/


--
-- JSON_STRING_KEY_2  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.json_string_key_2(
    p_1     in varchar2,
    p_2     in varchar2
) return varchar2
is
    p1      varchar2(100);
    p2      varchar2(100);
begin
    if p_1 is NULL then
        p1 := '[]';
    else
        p1 := '"' || p_1 || '"';
    end if;
    if p_2 is NULL then
        p2 := '""';
    else
        p2 := '"' || p_2 || '"';
    end if;
    return '[' || p1 ||',' || p2 || ']';
end;
/


--
-- JSON_SUFFIX  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.json_suffix(
    p_value     in varchar2
) return varchar2
is
begin
    if p_value is NULL then
        return NULL;
    else
        return p_value || ',' ;
    end if;
end;
/


--
-- JSONS0  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.jsons0(
    p_start varchar2,
    p_key varchar2,
    p_value varchar2
) return varchar2
is  -- append a json string
begin
    if p_value is NULL then
        return p_start;
    elsif p_start is NULL then
        return '"' || p_key || '":' || json_string(p_value);
    elsif p_start like '%{' then
        return p_start || '"' || p_key || '":' || json_string(p_value);
    else
        return p_start || ',"' || p_key || '":' || json_string(p_value);
    end if;
end;
/


--
-- JSON_TEXT  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.json_text(
    p_string1 varchar2,
    p_string2 varchar2 default NULL,
    p_string3 varchar2 default NULL
) return varchar2
is
    crlf varchar2(10) := CHR(13) || CHR(10);
begin
    if p_string3 is NULL then
        if p_string2 is NULL then
            return json_string(p_string1);
        else
            return json_string(p_string1 || crlf || p_string2);
        end if;
    else
        return json_string(p_string1 || crlf || p_string2 || crlf || p_string3);
    end if;
end;
/


--
-- JSON_TRUE  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.json_true(
    p_name      in varchar2,
    p_value     in varchar2
) return varchar2
is
begin
    if p_value is NULL then
        return NULL;
    elsif json_boolean(p_value,'false') ='true' then
        return ',"' || p_name || '":' || json_boolean(p_value,'false');
    else
        return null;
    end if;
end;
/


--
-- LOCAL_TIME  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.LOCAL_TIME( 
    P_DATETIME IN date, 
    P_OFFSET IN NUMBER,
    P_LOCAL_OFFSET IN NUMBER)
  RETURN  DATE IS
BEGIN 
    RETURN P_DATETIME - (P_OFFSET - P_LOCAL_OFFSET)/24/3600;  --  
END;
 
/


--
-- LONGID_RANGE  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.LONGID_RANGE (
    p_LONGID1       IN NUMBER
  , p_LONGID2       IN NUMBER
) RETURN  VARCHAR2 IS
--
-- Purpose: Return rendered range information for LongID
--
-- MODIFICATION HISTORY
-- Person   Date        Comments
-- ------   ----------  -------------------------------------------
-- 001SO    02.08.2017  Created
-- 002SO    04.08.2017  suppress single LongID range suffix and remove CNT

    result      VARCHAR2(100);

BEGIN

    result := to_char(p_LONGID1);

    if p_LONGID2 IS NOT NULL and p_LONGID2 > p_LONGID1 then                     -- 002SO
        result := result || '..' || SUBSTR(p_LONGID2, -5);
    end if;

    return result;

END;
/


--
-- MD5CHECKSUM  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.md5checksum(
    lvtype in varchar2,
    lvname in varchar2,
    lvschema in varchar2
)   return varchar2
is
begin
    return dbms_crypto.HASH(dbms_metadata.get_ddl(lvtype,lvname,lvschema), dbms_crypto.HASH_MD5);
exception
   WHEN OTHERS THEN return 'ORA' || SQLCODE;
end;
/


--
-- REVA_SIGMASK_MERGE  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.reva_sigmask_merge (
    s IN varchar2,
    m in varchar2
)
  RETURN  varchar2
IS
    l_result varchar2(100) := '';
    i integer;
BEGIN
    if length(s) <> length(m)
    then
        raise VALUE_ERROR;
    else
        for i in 1..length(s)
        loop
            if substr(s,i,1) = '_'
            then
                l_result := l_result || substr(m,i,1);
            else
                l_result := l_result || substr(s,i,1);
            end if;
        end loop;
    end if;
    return l_result;
END;
/


--
-- SERVICE_PARAMETER  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.service_parameter (
    p_type IN VARCHAR2,
    p_value IN VARCHAR2
) RETURN  VARCHAR2 IS
--
-- Purpose: Return Content service parameter string representation
-- MODIFICATION HISTORY
-- Person   Date        Comments
-- ------   ----------  -------------------------------------------
-- 001SO    19.05.2014  Created
-- 002SO    28.08.2014  Support for **null** in MBS config

l_result VARCHAR2(2000);

BEGIN
    if p_value is NULL then
        l_result := 'null';             -- 002SO
    elsif p_type = 'boolean' then
        l_result := lower(p_value);
    elsif p_type = 'string' then
        l_result := json_string(p_value);
    else
        l_result := p_value;
    end if;
    return l_result;
END;
/


--
-- SETTLEDDURATION  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.SettledDuration( CON_DATESTART  in date,CON_DATEEND in date )
return number
is
begin
  return (LEAST(NVL(CON_DATEEND,TRUNC(sysdate,'MONTH')),TRUNC(sysdate,'MONTH'))- GREATEST(NVL(CON_DATESTART,TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')),TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')));
end;


 
/


--
-- SIGMASK_MERGE  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.sigmask_merge (
    s IN varchar2,
    m in varchar2
)
  RETURN  varchar2
IS
    l_result varchar2(100) := '';
    i integer;
BEGIN
    if length(s) <> length(m)
    then
        raise VALUE_ERROR;
    else
        for i in 1..length(s)
        loop
            if substr(s,i,1) = '_'
            then
                l_result := l_result || substr(m,i,1);
            else
                l_result := l_result || substr(s,i,1);
            end if;
        end loop;
    end if;
    return l_result;
END;
/


--
-- SIMPLEHASH  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.SIMPLEHASH ( s IN varchar2 )
  RETURN  NUMBER
IS
   h                 NUMBER;
   i                 INTEGER;
BEGIN 
    h :=0;
    if LENGTH(s) > 0 then
        For I In 1..LENGTH(s) Loop
            h:= h + I * ascii(SUBSTR(s,I,1));
        end loop;
    end if;
    RETURN h ;
END;
 
/


--
-- SLOW_TEXT_TABLE  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.SLOW_TEXT_TABLE (
SQLT_STR_TEXT  IN Varchar2,
SQLT_INT_ROWS  IN INTEGER,
SQLT_VNR_DELAY IN NUMBER
) RETURN T_TEXT_TAB PIPELINED
is
begin
FOR i IN 1..SQLT_INT_ROWS LOOP
PIPE ROW(T_TEXT_ROW(SQLT_STR_TEXT || i));
sys.dbms_lock.sleep(SQLT_VNR_DELAY);
END LOOP;
end SLOW_TEXT_TABLE;

/


--
-- SPEED  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.SPEED(
    BIH_RECCOUNT IN NUMBER,
    BIH_START IN date,
    BIH_END IN date
)   RETURN  number IS

BEGIN

    if BIH_END IS NULL then
        RETURN NULL;
    elsif BIH_START IS NULL then
        RETURN NULL;
    elsif BIH_END = BIH_START THEN
        RETURN TRUNC(BIH_RECCOUNT);
    else
        RETURN TRUNC(BIH_RECCOUNT / ((BIH_END-BIH_START)*24*3600));
    end if;

END;
/


--
-- STRING_MATCH  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.STRING_MATCH ( s IN varchar2, m in varchar2 )
  RETURN  NUMBER
IS
BEGIN 
    if s is NULL then
        RETURN NULL;
    elsif m is null then 
        RETURN NULL;
    elsif s like m then
        RETURN 1 ;    
    else
        RETURN 0 ;    
    end if; 
END;
 
/


--
-- STRING_MATCH_COUNT  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.string_match_count ( s IN varchar2, m in varchar2 )
  RETURN  NUMBER
IS
    result pls_integer := 0;
BEGIN
    if s is NULL then
        result := NULL;
    elsif m is null then
        result := NULL;
    elsif s = m then
        result := length(s) ;
    elsif length(s) <= length(m) then
        for c in 1 .. length(s) loop
            if substr(s,c,1) = substr(m,c,1) then
                result := result + 1;
            end if;
        end loop;
    else
        for c in 1 .. length(m) loop
            if substr(s,c,1) = substr(m,c,1) then
                result := result + 1;
            end if;
        end loop;
    end if;

    RETURN result;
END;
/


--
-- TO_BASE  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.to_base( p_dec in number, p_base in number )
return varchar2
is
 l_str varchar2(255) default NULL;
 l_num number default p_dec;
 l_hex varchar2(16) default '0123456789ABCDEF';
begin
 if ( p_dec is null or p_base is null )
 then
  return null;
 end if;
 if ( trunc(p_dec) <> p_dec OR p_dec < 0 ) then
  raise PROGRAM_ERROR;
 end if;
 loop
  l_str := substr( l_hex, mod(l_num,p_base)+1, 1 ) || l_str;
  l_num := trunc( l_num/p_base );
  exit when ( l_num = 0 );
 end loop;
 return l_str;
end to_base;
/


--
-- A  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.A
(ENUM_ID)
BEQUEATH DEFINER
AS 
select ENUM_ID from ENUM256 where ENUM_ID in (1, 2, 3);


--
-- ALL_SBS_OBJECTS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.ALL_SBS_OBJECTS
(OWNER, OBJECT_NAME, SUBOBJECT_NAME, OBJECT_ID, DATA_OBJECT_ID, 
 OBJECT_TYPE, CREATED, LAST_DDL_TIME, TIMESTAMP, STATUS, 
 TEMPORARY, GENERATED, SECONDARY, NAMESPACE, EDITION_NAME)
BEQUEATH DEFINER
AS 
select "OWNER","OBJECT_NAME","SUBOBJECT_NAME","OBJECT_ID","DATA_OBJECT_ID","OBJECT_TYPE","CREATED","LAST_DDL_TIME","TIMESTAMP","STATUS","TEMPORARY","GENERATED","SECONDARY","NAMESPACE","EDITION_NAME" from all_objects where owner = 'SBS1_ADMIN' order by last_ddl_time desc;


--
-- ALL_SBS_VIEWS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.ALL_SBS_VIEWS
(OBJECT_NAME, CREATED, LAST_DDL_TIME, STATUS)
BEQUEATH DEFINER
AS 
select
    OBJECT_NAME
    ,
    CREATED
    ,
    LAST_DDL_TIME
    ,
    STATUS
  from
    all_objects
  where
      owner = 'SBS1_ADMIN' 
    and
      OBJECT_TYPE = 'VIEW' 
  order by
    3 desc;


--
-- APP_OBJECT  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.APP_OBJECT
(OWNER, OBJECT_NAME, SUBOBJECT_NAME, OBJECT_ID, DATA_OBJECT_ID, 
 OBJECT_TYPE, STATUS)
BEQUEATH DEFINER
AS 
SELECT   OWNER,   OBJECT_NAME,   SUBOBJECT_NAME,   OBJECT_ID,   DATA_OBJECT_ID,   OBJECT_TYPE,   STATUS
FROM   ALL_OBJECTS
WHERE   OWNER IN (user)
AND	OBJECT_TYPE NOT IN ('SYNONYM','INDEX','RULE SET','PACKAGE BODY','JOB','TRIGGER','LOB','TABLE PARTITION','INDEX PARTITION','LOB PARTITION')
AND	OBJECT_NAME NOT LIKE 'AQ$%' 
AND	OBJECT_NAME NOT LIKE 'RUPD$%'
AND	OBJECT_NAME NOT LIKE 'MLOG$%'
AND	OBJECT_NAME NOT LIKE 'SYS\_IOT\_OVER\_%' escape '\'
AND	OBJECT_NAME NOT LIKE 'SMP\_VD%' escape '\'
AND OBJECT_NAME NOT LIKE 'APP\_%\_GRANTS' escape '\'
AND OBJECT_NAME NOT IN ('APP_OBJECT','APP_OBJECT_GRANT','APP_PERMISSION','APP_TOKEN')
AND SUBOBJECT_NAME Is NULL;


--
-- B  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.B
(ENUM_ID)
BEQUEATH DEFINER
AS 
select ENUM_ID from ENUM256 where ENUM_ID in (2, 3, 4);


--
-- C  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.C
(ENUM_ID)
BEQUEATH DEFINER
AS 
select ENUM_ID from ENUM256 where ENUM_ID in (3, 4, 5);


--
-- CENTRUM_USERGROUP_LIST  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.CENTRUM_USERGROUP_LIST
(ACT_ID)
BEQUEATH DEFINER
AS 
SELECT 
ACT_ID
FROM ACTYPE
WHERE ACT_SHOWCENTRUM = 1;


--
-- DT_WARNING  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.DT_WARNING
(W_ERRORTIME, W_APPLIC, W_PROCEDURE, W_TOPIC, W_MESSAGE, 
 W_SHORTID, W_BIHID, W_BOHID, W_BDID)
BEQUEATH DEFINER
AS 
SELECT W_ERRORTIME, W_APPLIC, W_PROCEDURE, W_TOPIC, W_MESSAGE, W_SHORTID,
W_BIHID, W_BOHID, W_BDID
FROM WARNING;


--
-- DT_WARNING_RECENT  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.DT_WARNING_RECENT
(W_ERRORTIME, W_APPLIC, W_PROCEDURE, W_TOPIC, W_MESSAGE, 
 W_SHORTID, W_BIHID, W_BOHID, W_BDID)
BEQUEATH DEFINER
AS 
SELECT W_ERRORTIME, W_APPLIC, W_PROCEDURE, W_TOPIC, W_MESSAGE, W_SHORTID,
W_BIHID, W_BOHID, W_BDID
FROM DT_WARNING
WHERE W_ERRORTIME >= sysdate - 1
ORDER BY W_ERRORTIME;


--
-- EXCHANGERATE_BACKDIFF  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.EXCHANGERATE_BACKDIFF
(EXR_ID, EXR_CURID, EXR_VALUE, EXR_START, EXR_END, 
 EXR_CHNGCNT, EXR_ACIDCRE, EXR_DATECRE, EXR_ACIDMOD, EXR_DATEMOD, 
 EXR_COMMENT)
BEQUEATH DEFINER
AS 
SELECT "EXR_ID","EXR_CURID","EXR_VALUE","EXR_START","EXR_END","EXR_CHNGCNT","EXR_ACIDCRE","EXR_DATECRE","EXR_ACIDMOD","EXR_DATEMOD","EXR_COMMENT" FROM EXCHANGERATE
MINUS
SELECT "EXR_ID","EXR_CURID","EXR_VALUE","EXR_START","EXR_END","EXR_CHNGCNT","EXR_ACIDCRE","EXR_DATECRE","EXR_ACIDMOD","EXR_DATEMOD","EXR_COMMENT" FROM EXCHANGERATE@SBS0SBS1;


--
-- EXCHANGERATE_DIFF  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.EXCHANGERATE_DIFF
(EXR_ID, EXR_CURID, EXR_VALUE, EXR_START, EXR_END, 
 EXR_CHNGCNT, EXR_ACIDCRE, EXR_DATECRE, EXR_ACIDMOD, EXR_DATEMOD, 
 EXR_COMMENT)
BEQUEATH DEFINER
AS 
SELECT "EXR_ID","EXR_CURID","EXR_VALUE","EXR_START","EXR_END","EXR_CHNGCNT","EXR_ACIDCRE","EXR_DATECRE","EXR_ACIDMOD","EXR_DATEMOD","EXR_COMMENT" FROM EXCHANGERATE@SBS0SBS1
MINUS
SELECT "EXR_ID","EXR_CURID","EXR_VALUE","EXR_START","EXR_END","EXR_CHNGCNT","EXR_ACIDCRE","EXR_DATECRE","EXR_ACIDMOD","EXR_DATEMOD","EXR_COMMENT" FROM EXCHANGERATE;


--
-- FK_DEPENDENCIES  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.FK_DEPENDENCIES
(PARENT_TABLE, CHILD_TABLE)
BEQUEATH DEFINER
AS 
SELECT
    PARENT.TABLE_NAME,
    CHILD.TABLE_NAME
FROM
    ALL_CONSTRAINTS CHILD,
    ALL_CONSTRAINTS PARENT
WHERE
        PARENT.CONSTRAINT_NAME = CHILD.R_CONSTRAINT_NAME
    AND PARENT.TABLE_NAME <> CHILD.TABLE_NAME
    AND CHILD.OWNER = 'SBS0'
    AND CHILD.CONSTRAINT_TYPE = 'R'
    AND PARENT.OWNER = 'SBS0'
    AND PARENT.CONSTRAINT_TYPE = 'P'
GROUP BY
    PARENT.TABLE_NAME,
    CHILD.TABLE_NAME;


--
-- GPSH_CURRENCY_KEYLIST  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.GPSH_CURRENCY_KEYLIST
(CUR_KEY)
BEQUEATH DEFINER
AS 
SELECT   cur_key 
        FROM   ((  SELECT   '["cur","' || cur_id || '"]' AS cur_key FROM currency
                 UNION
                 SELECT      '["cur","'
                          || exr_curid
                          || '","exrate",'
                          || json_date (exr_start)
                          || ']'
                              AS cur_key
                   FROM   exchangerate)) a
    ORDER BY   1 ASC;


--
-- GPULL_KPI_JSON  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.GPULL_KPI_JSON
(CKEY, CVALUE, BDK_ID, BDK_CODE)
BEQUEATH DEFINER
AS 
select '[' || json_date(BDK_DATETIME) || ',"' || BDK_ID || '"]' ckey, 
       BDK_CVALUE cvalue, 
       bdk_id, 
       bdk_code 
from BDKPI 
where 
    BDK_DATETIME < (sysdate - INTERVAL '2' minute(1)) and 
    BDK_DATETIME > (sysdate - INTERVAL '30' minute(1))
order by BDK_ID;


--
-- IW_DO_SETTLEMENT  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.IW_DO_SETTLEMENT
(SEP_ID, IW_DO_SETTLEMENT)
BEQUEATH DEFINER
AS 
Select
  SEP_ID,
  Decode( SEP_IWTSSID , 'O', 1, 0) IW_DO_SETTLEMENT
From
  SETPERIOD
Where
  SEP_ID = To_Char(Add_Months(Sysdate,-1),'YYYYMM');


--
-- IW_GENERATE_BULK_FILES  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.IW_GENERATE_BULK_FILES
(SEP_ID, IW_GENERATE_BULK_FILES)
BEQUEATH DEFINER
AS 
Select
  SEP_ID, 
  Decode( SEP_IWTSSID , 'P', 1, 0) IW_GENERATE_BULK_FILES
From
  SETPERIOD
Where
  SEP_ID = To_Char(Add_Months(Sysdate,-1),'YYYYMM');


--
-- IW_SETTLE  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.IW_SETTLE
(SEP_ID, IW_SETTLE)
BEQUEATH DEFINER
AS 
Select
  SEP_ID,
  Decode( SEP_IWTSSID, 'O', 1, 0) IW_SETTLE
From
  SETPERIOD
Where
  SEP_ID = To_Char(Add_Months(Sysdate,-1),'YYYYMM');


--
-- IW_TERMINATED_DONE  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.IW_TERMINATED_DONE
(SEP_ID, IW_TERMINATED_DONE)
BEQUEATH DEFINER
AS 
Select
  SEP_ID,
  Decode( SEP_IWTSSID , 'D', 1, 0) IW_TERMINATED_DONE
From
  SETPERIOD
Where
  SEP_ID = To_Char(Add_Months(Sysdate,-1),'YYYYMM');


--
-- KPI_HISTORY_VIEW  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.KPI_HISTORY_VIEW
(KPIH_VIEW, KPIH_PERIOD, C01, C02, C03, 
 C04, C05, C06, C07, C08, 
 C09, C10, C11, C12, C13, 
 C14, C15, C16, C17, C18, 
 C19, C20)
BEQUEATH DEFINER
AS 
select KPIH_VIEW, KPIH_PERIOD, KPIH_C01, KPIH_C02, KPIH_C03, KPIH_C04, KPIH_C05, KPIH_C06, KPIH_C07, KPIH_C08, KPIH_C09, KPIH_C10, KPIH_C11, KPIH_C12, KPIH_C13, KPIH_C14, KPIH_C15, KPIH_C16, KPIH_C17, KPIH_C18, KPIH_C19, KPIH_C20 
from KPI_HISTORY;


--
-- MAY_START_SMSIW_SETTLEMENT  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.MAY_START_SMSIW_SETTLEMENT
(RESULT)
BEQUEATH DEFINER
AS 
Select
  DECODE( SEP_IWTSSID , 'O', 'TRUE', 'FALSE') IW_DO_SETTLEMENT
From
  SETPERIOD
Where
  SEP_ID = To_Char(Add_Months(Sysdate,-1),'YYYYMM');


--
-- ORDER_OBJECT_BY_DEPENDENCY  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.ORDER_OBJECT_BY_DEPENDENCY
(DLEVEL, OBJECT_ID)
BEQUEATH DEFINER
AS 
select max(level) as DLEVEL, object_id as OBJECT_ID 
from public_dependency
connect by nocycle object_id = prior referenced_object_id
group by object_id;


--
-- RAM_D_RTRA_OVERBILLING  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.RAM_D_RTRA_OVERBILLING
(ERRORTIME, ERRORTYPE, ERRORMESSAGE, ERRORPARAMS, ERRORCOUNT)
BEQUEATH DEFINER
AS 
SELECT
	TRUNC(W_ERRORTIME) ERRORTIME,
	'MB RA ERROR' ERRORTYPE,
	W_MESSAGE || ' ShortId ' || W_SHORTID ERRORMESSAGE,
	'First=' || MIN(W_TOPIC) || '<BR>Last=' || MAX(W_TOPIC) ERRORPARAMS,
	COUNT(*) ERRORCOUNT
FROM
	WARNING
WHERE
		W_ERRORTIME >= trunc(sysdate) - 4
	AND	W_ERRORTIME < trunc(sysdate)
	AND	W_APPLIC IN ('PKG_REVI')
	AND	W_TOPIC <> 'PLSQL-ERROR'
	AND	W_PROCEDURE = 'REVI_INDEX_CONTENT_FILE'
GROUP BY
	W_MESSAGE,
	W_SHORTID,
	TRUNC(W_ERRORTIME);


--
-- RAM_D_RTRA_UNDERBILLING  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.RAM_D_RTRA_UNDERBILLING
(ERRORTIME, ERRORTYPE, ERRORMESSAGE, ERRORPARAMS, ERRORCOUNT)
BEQUEATH DEFINER
AS 
SELECT
	trunc(W_ERRORTIME) ERRORTIME,
	'MB RA ERROR' ERRORTYPE,
	W_MESSAGE || ' ShortId ' || W_SHORTID ERRORMESSAGE,
	'First=' || MIN(W_TOPIC) || '<BR>Last=' || MAX(W_TOPIC) ERRORPARAMS,
	COUNT(*) ERRORCOUNT
FROM
	WARNING
WHERE
		W_ERRORTIME >= trunc(sysdate) - 4
	AND	W_ERRORTIME < trunc(sysdate)
	AND	W_APPLIC IN ('PKG_REVI')
	AND	W_TOPIC <> 'PLSQL-ERROR'
	AND	W_PROCEDURE <> 'REVI_INDEX_CONTENT_FILE'
GROUP BY
	W_MESSAGE,
	W_SHORTID,
	trunc(W_ERRORTIME);


--
-- RAM_D_SR075A_BASE_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.RAM_D_SR075A_BASE_1
(REVICS_SHORTID, REVICS_ROWID_MASTER, REVICS_COUNT_EXPECTED, REVICS_TABLE_SLAVE, REVICS_COUNT_MATCHING)
BEQUEATH DEFINER
AS 
SELECT
	REVICS_SHORTID,
	REVICS_ROWID_MASTER,
	REVICS_COUNT_EXPECTED,
	REVICS_TABLE_SLAVE,
	SUM(DECODE(REVICS_ROWID_SLAVE,NULL,0,1))
FROM
	REVI_CONTENT_SUB
WHERE
	REVICS_SEPID = to_char(sysdate-1,'YYYYMM')
GROUP BY
	REVICS_SHORTID,
	REVICS_ROWID_MASTER,
	REVICS_COUNT_EXPECTED,
	REVICS_TABLE_SLAVE;


--
-- RAM_D_SR075A_BASE_1A  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.RAM_D_SR075A_BASE_1A
(REVICS_SHORTID, REVICS_ROWID_MASTER, REVICS_TABLE_SLAVE, REVICS_COUNT_MATCHING)
BEQUEATH DEFINER
AS 
SELECT
	REVICS_SHORTID,
	REVICS_ROWID_MASTER,
	REVICS_TABLE_SLAVE,
	SIGN(SUM(REVICS_COUNT_MATCHING)-REVICS_COUNT_EXPECTED)
FROM
	RAM_D_SR075A_BASE_1
GROUP BY
	REVICS_SHORTID,
	REVICS_ROWID_MASTER,
	REVICS_COUNT_EXPECTED,
	REVICS_TABLE_SLAVE;


--
-- RAM_D_SR075A_BASE_2  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.RAM_D_SR075A_BASE_2
(REVIS_SHORTID, REVIS_ROWID_MASTER, REVIS_COUNT_EXPECTED, REVIS_TABLE_SLAVE, REVIS_COUNT_MATCHING)
BEQUEATH DEFINER
AS 
SELECT
	REVIS_SHORTID,
	REVIS_ROWID1,
	1,
	'BDETAIL',
	SUM(DECODE(REVIS_ROWID,NULL,0,1))
FROM
	REVI_SMS
WHERE
	REVIS_SEPID = to_char(sysdate-1,'YYYYMM')
GROUP BY
	REVIS_SHORTID,
	REVIS_ROWID1;


--
-- RAM_D_SR075A_BASE_2A  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.RAM_D_SR075A_BASE_2A
(REVIS_SHORTID, REVIS_ROWID_MASTER, REVIS_TABLE_SLAVE, REVIS_COUNT_MATCHING)
BEQUEATH DEFINER
AS 
SELECT
	REVIS_SHORTID,
	REVIS_ROWID_MASTER,
	REVIS_TABLE_SLAVE,
	SIGN(SUM(REVIS_COUNT_MATCHING)-REVIS_COUNT_EXPECTED)
FROM
	RAM_D_SR075A_BASE_2
GROUP BY
	REVIS_SHORTID,
	REVIS_ROWID_MASTER,
	REVIS_COUNT_EXPECTED,
	REVIS_TABLE_SLAVE;


--
-- RAM_D_SR075A_BASE_3  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.RAM_D_SR075A_BASE_3
(REVIM_SHORTID, REVIM_ROWID_MASTER, REVIM_COUNT_EXPECTED, REVIM_TABLE_SLAVE, REVIM_COUNT_MATCHING)
BEQUEATH DEFINER
AS 
SELECT
	REVIM_SHORTID,
	REVIM_ROWID6,
	1,
	'BDETAIL',
	SUM(DECODE(REVIM_ROWID,NULL,0,1))
FROM
	REVI_MMS
WHERE
	REVIM_SEPID = to_char(sysdate-1,'YYYYMM')
GROUP BY
	REVIM_SHORTID,
	REVIM_ROWID6;


--
-- RAM_D_SR075A_BASE_3A  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.RAM_D_SR075A_BASE_3A
(REVIM_SHORTID, REVIM_ROWID_MASTER, REVIM_TABLE_SLAVE, REVIM_COUNT_MATCHING)
BEQUEATH DEFINER
AS 
SELECT
	REVIM_SHORTID,
	REVIM_ROWID_MASTER,
	REVIM_TABLE_SLAVE,
	SIGN(SUM(REVIM_COUNT_MATCHING)-REVIM_COUNT_EXPECTED)
FROM
	RAM_D_SR075A_BASE_3
GROUP BY
	REVIM_SHORTID,
	REVIM_ROWID_MASTER,
	REVIM_COUNT_EXPECTED,
	REVIM_TABLE_SLAVE;


--
-- RAM_D_SR075A_BASE_5  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.RAM_D_SR075A_BASE_5
(REVICD_SHORTID, REVICD_ROWID_MASTER, REVICD_COUNT_EXPECTED, REVICD_TABLE_SLAVE, REVICD_COUNT_MATCHING)
BEQUEATH DEFINER
AS 
SELECT
	REVICD_SHORTID,
	REVICD_ROWID_MASTER,
	REVICD_COUNT_EXPECTED,
	REVICD_TABLE_SLAVE,
	SUM(DECODE(REVICD_ROWID_SLAVE,NULL,0,1))
FROM
	REVI_CONTENT_DEL
WHERE
	REVICD_SEPID = to_char(sysdate-1,'YYYYMM')
GROUP BY
	REVICD_SHORTID,
	REVICD_ROWID_MASTER,
	REVICD_COUNT_EXPECTED,
	REVICD_TABLE_SLAVE;


--
-- RAM_D_SR075A_BASE_5A  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.RAM_D_SR075A_BASE_5A
(REVICD_SHORTID, REVICD_ROWID_MASTER, REVICD_TABLE_SLAVE, REVICD_COUNT_MATCHING)
BEQUEATH DEFINER
AS 
SELECT
	REVICD_SHORTID,
	REVICD_ROWID_MASTER,
	REVICD_TABLE_SLAVE,
	SIGN(SUM(REVICD_COUNT_MATCHING)-REVICD_COUNT_EXPECTED)
FROM
	RAM_D_SR075A_BASE_5
GROUP BY
	REVICD_SHORTID,
	REVICD_ROWID_MASTER,
	REVICD_COUNT_EXPECTED,
	REVICD_TABLE_SLAVE;


--
-- RAM_D_SR075A_BASE_7A  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.RAM_D_SR075A_BASE_7A
(SHORTID, TABLE_SLAVE, TABLE_ROWID_MASTER, MATCH_COUNT, MISS_COUNT, 
 CHARGED_AMOUNT)
BEQUEATH DEFINER
AS 
SELECT
	REVIPRE_SHORTID,
    REVIPRE_TABLE_SLAVE,
    REVIPRE_ROWID_MASTER, 
	COUNT(*),
	SUM(DECODE(REVIPRE_ROWID_SLAVE,NULL,1,0)),
	SUM(REVIPRE_CHARGED_AMOUNT)
FROM    REVI_PRE
WHERE   REVIPRE_SEPID = to_char(sysdate-1,'YYYYMM')
GROUP BY
	REVIPRE_SHORTID,
    REVIPRE_TABLE_SLAVE,
    REVIPRE_ROWID_MASTER;


--
-- RAM_D_SR075A_BASE_7B  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.RAM_D_SR075A_BASE_7B
(SHORTID, TABLE_SLAVE, TABLE_ROWID_SLAVE, MATCH_COUNT, MISS_COUNT, 
 CHARGED_AMOUNT)
BEQUEATH DEFINER
AS 
SELECT
	REVIPRES_SHORTID,
	'CDRSMS',
	REVIPRES_ROWIDS,
    0,
	1,
	REVIPRES_CHARGED_AMOUNT
FROM
	REVIPRE_SMS
WHERE   REVIPRES_SEPID = to_char(sysdate-1,'YYYYMM')
AND     REVIPRES_ROWID Is NULL;


--
-- RAM_D_SR075A_BASE_7C  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.RAM_D_SR075A_BASE_7C
(SHORTID, TABLE_SLAVE, TABLE_ROWID_SLAVE, MATCH_COUNT, MISS_COUNT, 
 CHARGED_AMOUNT)
BEQUEATH DEFINER
AS 
SELECT
	REVIPREM_SHORTID,
	'CDRMMS',
	REVIPREM_ROWIDS,
    0,
	1,
	REVIPREM_CHARGED_AMOUNT
FROM
	REVIPRE_MMS
WHERE   REVIPREM_SEPID = to_char(sysdate-1,'YYYYMM')
AND     REVIPREM_ROWID Is NULL;


--
-- RAM_D_SR075A_DETAILS_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.RAM_D_SR075A_DETAILS_1
(REVICS_SHORTID, REVICS_MEDIUM, REVICS_COUNT_MASTER, REVICS_COUNT_MISSING, REVICS_FRACTION_MISSING, 
 REVICS_COUNT_MULTIPLES, REVICS_FRACTION_MULTIPLES)
BEQUEATH DEFINER
AS 
SELECT
	REVICS_SHORTID,
	DECODE(REVICS_TABLE_SLAVE,'BDETAIL1','SMS','BDETAIL6','MMS','MMS BULK'),
	COUNT(*),
	SUM(DECODE(REVICS_COUNT_MATCHING,-1.0,1,0)),
	SUM(DECODE(REVICS_COUNT_MATCHING,-1.0,1,0))/COUNT(*),	
	SUM(DECODE(REVICS_COUNT_MATCHING,1.0,1,0)),
	SUM(DECODE(REVICS_COUNT_MATCHING,1.0,1,0))/COUNT(*)	
FROM
	RAM_D_SR075A_BASE_1A
GROUP BY
	REVICS_SHORTID,
	REVICS_TABLE_SLAVE
ORDER BY
	REVICS_SHORTID,
	REVICS_TABLE_SLAVE;


--
-- RAM_D_SR075A_DETAILS_2  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.RAM_D_SR075A_DETAILS_2
(REVIS_SHORTID, REVIS_COUNT_MASTER, REVIS_COUNT_MISSING, REVIS_FRACTION_MISSING, REVIS_COUNT_MULTIPLES, 
 REVIS_FRACTION_MULTIPLES)
BEQUEATH DEFINER
AS 
SELECT
	REVIS_SHORTID,
	COUNT(*),
	SUM(DECODE(REVIS_COUNT_MATCHING,-1.0,1,0)),
	SUM(DECODE(REVIS_COUNT_MATCHING,-1.0,1,0))/COUNT(*),	
	SUM(DECODE(REVIS_COUNT_MATCHING,1.0,1,0)),
	SUM(DECODE(REVIS_COUNT_MATCHING,1.0,1,0))/COUNT(*)	
FROM
	RAM_D_SR075A_BASE_2A
GROUP BY
	REVIS_SHORTID,
	REVIS_TABLE_SLAVE
ORDER BY
	REVIS_SHORTID,
	REVIS_TABLE_SLAVE;


--
-- RAM_D_SR075A_DETAILS_3  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.RAM_D_SR075A_DETAILS_3
(REVIM_SHORTID, REVIM_COUNT_MASTER, REVIM_COUNT_MISSING, REVIM_FRACTION_MISSING, REVIM_COUNT_MULTIPLES, 
 REVIM_FRACTION_MULTIPLES)
BEQUEATH DEFINER
AS 
SELECT
	REVIM_SHORTID,
	COUNT(*),
	SUM(DECODE(REVIM_COUNT_MATCHING,-1.0,1,0)),
	SUM(DECODE(REVIM_COUNT_MATCHING,-1.0,1,0))/COUNT(*),	
	SUM(DECODE(REVIM_COUNT_MATCHING,1.0,1,0)),
	SUM(DECODE(REVIM_COUNT_MATCHING,1.0,1,0))/COUNT(*)	
FROM
	RAM_D_SR075A_BASE_3A
GROUP BY
	REVIM_SHORTID,
	REVIM_TABLE_SLAVE
ORDER BY
	REVIM_SHORTID,
	REVIM_TABLE_SLAVE;


--
-- RAM_D_SR075A_DETAILS_4  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.RAM_D_SR075A_DETAILS_4
(REVIB_SHORTID, REVIB_COUNT_MASTER, REVIB_COUNT_MISSING, REVIB_FRACTION_MISSING, REVIB_COUNT_MULTIPLES, 
 REVIB_FRACTION_MULTIPLES)
BEQUEATH DEFINER
AS 
SELECT
    NULL AS REVIB_SHORTID,
    0,
    0,
    0.00,   
    0,
    0.00    
FROM
    DUAL 
WHERE 0=1;


--
-- RAM_D_SR075A_DETAILS_5  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.RAM_D_SR075A_DETAILS_5
(REVICD_SHORTID, REVICD_MEDIUM, REVICD_COUNT_MASTER, REVICD_COUNT_MISSING, REVICD_FRACTION_MISSING, 
 REVICD_COUNT_MULTIPLES, REVICD_FRACTION_MULTIPLES)
BEQUEATH DEFINER
AS 
SELECT
	REVICD_SHORTID,
	DECODE(REVICD_TABLE_SLAVE,'BDETAIL2','SMS','BDETAIL6','MMS','MMS BULK'),
	COUNT(*),
	SUM(DECODE(REVICD_COUNT_MATCHING,-1.0,1,0)),
	SUM(DECODE(REVICD_COUNT_MATCHING,-1.0,1,0))/COUNT(*),	
	SUM(DECODE(REVICD_COUNT_MATCHING,1.0,1,0)),
	SUM(DECODE(REVICD_COUNT_MATCHING,1.0,1,0))/COUNT(*)	
FROM
	RAM_D_SR075A_BASE_5A
GROUP BY
	REVICD_SHORTID,
	REVICD_TABLE_SLAVE
ORDER BY
	REVICD_SHORTID,
	REVICD_TABLE_SLAVE;


--
-- SBS1_ALL_TAB_PARTITIONS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SBS1_ALL_TAB_PARTITIONS
(TABLE_OWNER, TABLE_NAME, COMPOSITE, PARTITION_NAME, SUBPARTITION_COUNT, 
 HIGH_VALUE, HIGH_VALUE_LENGTH, PARTITION_POSITION, TABLESPACE_NAME, PCT_FREE, 
 PCT_USED, INI_TRANS, MAX_TRANS, INITIAL_EXTENT, NEXT_EXTENT, 
 MIN_EXTENT, MAX_EXTENT, MAX_SIZE, PCT_INCREASE, FREELISTS, 
 FREELIST_GROUPS, LOGGING, COMPRESSION, COMPRESS_FOR, NUM_ROWS, 
 BLOCKS, EMPTY_BLOCKS, AVG_SPACE, CHAIN_CNT, AVG_ROW_LEN, 
 SAMPLE_SIZE, LAST_ANALYZED, BUFFER_POOL, FLASH_CACHE, CELL_FLASH_CACHE, 
 GLOBAL_STATS, USER_STATS, IS_NESTED, PARENT_TABLE_PARTITION, INTERVAL, 
 SEGMENT_CREATED)
BEQUEATH DEFINER
AS 
select "TABLE_OWNER","TABLE_NAME","COMPOSITE","PARTITION_NAME","SUBPARTITION_COUNT","HIGH_VALUE","HIGH_VALUE_LENGTH","PARTITION_POSITION","TABLESPACE_NAME","PCT_FREE","PCT_USED","INI_TRANS","MAX_TRANS","INITIAL_EXTENT","NEXT_EXTENT","MIN_EXTENT","MAX_EXTENT","MAX_SIZE","PCT_INCREASE","FREELISTS","FREELIST_GROUPS","LOGGING","COMPRESSION","COMPRESS_FOR","NUM_ROWS","BLOCKS","EMPTY_BLOCKS","AVG_SPACE","CHAIN_CNT","AVG_ROW_LEN","SAMPLE_SIZE","LAST_ANALYZED","BUFFER_POOL","FLASH_CACHE","CELL_FLASH_CACHE","GLOBAL_STATS","USER_STATS","IS_NESTED","PARENT_TABLE_PARTITION","INTERVAL","SEGMENT_CREATED" from ALL_TAB_PARTITIONS;


--
-- SBS2_ALL_TAB_PARTITIONS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SBS2_ALL_TAB_PARTITIONS
(TABLE_OWNER, TABLE_NAME, COMPOSITE, PARTITION_NAME, SUBPARTITION_COUNT, 
 HIGH_VALUE, HIGH_VALUE_LENGTH, PARTITION_POSITION, TABLESPACE_NAME, PCT_FREE, 
 PCT_USED, INI_TRANS, MAX_TRANS, INITIAL_EXTENT, NEXT_EXTENT, 
 MIN_EXTENT, MAX_EXTENT, MAX_SIZE, PCT_INCREASE, FREELISTS, 
 FREELIST_GROUPS, LOGGING, COMPRESSION, COMPRESS_FOR, NUM_ROWS, 
 BLOCKS, EMPTY_BLOCKS, AVG_SPACE, CHAIN_CNT, AVG_ROW_LEN, 
 SAMPLE_SIZE, LAST_ANALYZED, BUFFER_POOL, FLASH_CACHE, CELL_FLASH_CACHE, 
 GLOBAL_STATS, USER_STATS, IS_NESTED, PARENT_TABLE_PARTITION, INTERVAL, 
 SEGMENT_CREATED)
BEQUEATH DEFINER
AS 
select "TABLE_OWNER","TABLE_NAME","COMPOSITE","PARTITION_NAME","SUBPARTITION_COUNT","HIGH_VALUE","HIGH_VALUE_LENGTH","PARTITION_POSITION","TABLESPACE_NAME","PCT_FREE","PCT_USED","INI_TRANS","MAX_TRANS","INITIAL_EXTENT","NEXT_EXTENT","MIN_EXTENT","MAX_EXTENT","MAX_SIZE","PCT_INCREASE","FREELISTS","FREELIST_GROUPS","LOGGING","COMPRESSION","COMPRESS_FOR","NUM_ROWS","BLOCKS","EMPTY_BLOCKS","AVG_SPACE","CHAIN_CNT","AVG_ROW_LEN","SAMPLE_SIZE","LAST_ANALYZED","BUFFER_POOL","FLASH_CACHE","CELL_FLASH_CACHE","GLOBAL_STATS","USER_STATS","IS_NESTED","PARENT_TABLE_PARTITION","INTERVAL","SEGMENT_CREATED" from ALL_TAB_PARTITIONS WHERE TABLE_OWNER = 'SBS2_ADMIN';


--
-- SORTCHECK  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SORTCHECK
(WERT, POSITION)
BEQUEATH DEFINER
AS 
SELECT
  '_',
  '1st position'
FROM DUAL

UNION
SELECT
  'a',
  '2nd position'
FROM DUAL

UNION
SELECT
  'b',
  '3rd position'
FROM DUAL

UNION
SELECT
  'Z',
  '4th position'
FROM DUAL;


--
-- SR019A_DETAILS_4  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR019A_DETAILS_4
(MSISDN_COUNT, TPMC_PULLCOUNT, TPMC_PUSHCOUNT, PUSHPULL, AMOUNT_SUM)
BEQUEATH DEFINER
AS 
SELECT
    COUNT(DISTINCT TPMC_MSISDN),
    SUM(TPMC_PULLCOUNT),
    SUM(TPMC_PUSHCOUNT),
    SUM(TPMC_PULLCOUNT+TPMC_PUSHCOUNT),
    SUM(TPMC_AMOUNTCU)
FROM
    TPMCONSOL
WHERE TPMC_CONSUB IN ('BN','MVP');


--
-- SR020A_DETAILS_3  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR020A_DETAILS_3
(MSISDN_COUNT, PUSHPULL)
BEQUEATH DEFINER
AS 
SELECT
    COUNT(DISTINCT TPMC_MSISDN),
    SUM(TPMC_PULLCOUNT+TPMC_PUSHCOUNT)
FROM
    TPMCONSOL
WHERE TPMC_CONSUB = 'WCB';


--
-- SR041A_DETAILS_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR041A_DETAILS_1
(ISM_CONSUB, ISM_SHORTID, ISM_KEYWORD, COUNT_MSISDN, ISM_PULLCOUNT, 
 ISM_PUSHCOUNT, COUNT_ALL)
BEQUEATH DEFINER
AS 
SELECT
 ISM_CONSUB,
 ISM_SHORTID,
 ISM_KEYWORD,
 COUNT(DISTINCT ISM_MSISDN),
 SUM(ISM_PULLCOUNT),
 SUM(ISM_PUSHCOUNT),
 SUM(ISM_PULLCOUNT) + SUM(ISM_PUSHCOUNT)
FROM
 ISMSTAT
WHERE
 ISM_CONSUB In ('PTS')
GROUP BY
 ISM_CONSUB,
 ISM_SHORTID,
 ISM_KEYWORD
ORDER BY
 ISM_CONSUB,
 ISM_SHORTID,
 ISM_KEYWORD;


--
-- SR041A_DETAILS_2  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR041A_DETAILS_2
(ISM_CONSUB, ISM_SHORTID, COUNT_MSISDN, ISM_PULLCOUNT, ISM_PUSHCOUNT, 
 COUNT_ALL)
BEQUEATH DEFINER
AS 
SELECT
 ISM_CONSUB,
 ISM_SHORTID,
 COUNT(DISTINCT ISM_MSISDN),
 SUM(ISM_PULLCOUNT),
 SUM(ISM_PUSHCOUNT),
 SUM(ISM_PULLCOUNT) + SUM(ISM_PUSHCOUNT)
FROM
 ISMSTAT
WHERE
 ISM_CONSUB In ('PTS')
GROUP BY
 ISM_CONSUB,
 ISM_SHORTID
ORDER BY
 ISM_CONSUB,
 ISM_SHORTID;


--
-- SR041A_DETAILS_3  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR041A_DETAILS_3
(ISM_CONSUB, COUNT_MSISDN, ISM_PULLCOUNT, ISM_PUSHCOUNT, COUNT_ALL)
BEQUEATH DEFINER
AS 
SELECT
 ISM_CONSUB,
 COUNT(DISTINCT ISM_MSISDN),
 SUM(ISM_PULLCOUNT),
 SUM(ISM_PUSHCOUNT),
 SUM(ISM_PULLCOUNT) + SUM(ISM_PUSHCOUNT)
FROM
 ISMSTAT
WHERE
 ISM_CONSUB In ('PTS')
GROUP BY
 ISM_CONSUB;


--
-- SR046A_DETAILS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR046A_DETAILS
(TOPIC, SHORTID, MESSAGE, ERRORTIME)
BEQUEATH DEFINER
AS 
SELECT W_TOPIC, W_SHORTID, W_MESSAGE, W_ERRORTIME
FROM WARNING
WHERE
W_ERRORTIME >= sysdate -12/24 AND W_APPLIC = 'CHECK OC'
ORDER BY
to_number(W_SHORTID), W_TOPIC;


--
-- SR075A_BASE_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR075A_BASE_1
(REVICS_SHORTID, REVICS_ROWID_MASTER, REVICS_COUNT_EXPECTED, REVICS_TABLE_SLAVE, REVICS_COUNT_MATCHING)
BEQUEATH DEFINER
AS 
SELECT
	REVICS_SHORTID,
	REVICS_ROWID_MASTER,
	REVICS_COUNT_EXPECTED,
	REVICS_TABLE_SLAVE,
	SUM(DECODE(REVICS_ROWID_SLAVE,NULL,0,1))
FROM
	REVI_CONTENT_SUB
WHERE
	REVICS_SEPID = to_char(add_months(sysdate,-1),'YYYYMM')
GROUP BY
	REVICS_SHORTID,
	REVICS_ROWID_MASTER,
	REVICS_COUNT_EXPECTED,
	REVICS_TABLE_SLAVE;


--
-- SR075A_BASE_1A  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR075A_BASE_1A
(REVICS_SHORTID, REVICS_ROWID_MASTER, REVICS_TABLE_SLAVE, REVICS_COUNT_MATCHING)
BEQUEATH DEFINER
AS 
SELECT
	REVICS_SHORTID,
	REVICS_ROWID_MASTER,
	REVICS_TABLE_SLAVE,
	SIGN(SUM(REVICS_COUNT_MATCHING)-REVICS_COUNT_EXPECTED)
FROM
	SR075A_BASE_1
GROUP BY
	REVICS_SHORTID,
	REVICS_ROWID_MASTER,
	REVICS_COUNT_EXPECTED,
	REVICS_TABLE_SLAVE;


--
-- SR075A_BASE_2  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR075A_BASE_2
(REVIS_SHORTID, REVIS_ROWID_MASTER, REVIS_COUNT_EXPECTED, REVIS_TABLE_SLAVE, REVIS_COUNT_MATCHING)
BEQUEATH DEFINER
AS 
SELECT
	REVIS_SHORTID,
	REVIS_ROWID1,
	1,
	'BDETAIL',
	SUM(DECODE(REVIS_ROWID,NULL,0,1))
FROM
	REVI_SMS
WHERE
	REVIS_SEPID = to_char(add_months(sysdate,-1),'YYYYMM')
GROUP BY
	REVIS_SHORTID,
	REVIS_ROWID1;


--
-- SR075A_BASE_2A  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR075A_BASE_2A
(REVIS_SHORTID, REVIS_ROWID_MASTER, REVIS_TABLE_SLAVE, REVIS_COUNT_MATCHING)
BEQUEATH DEFINER
AS 
SELECT
	REVIS_SHORTID,
	REVIS_ROWID_MASTER,
	REVIS_TABLE_SLAVE,
	SIGN(SUM(REVIS_COUNT_MATCHING)-REVIS_COUNT_EXPECTED)
FROM
	SR075A_BASE_2
GROUP BY
	REVIS_SHORTID,
	REVIS_ROWID_MASTER,
	REVIS_COUNT_EXPECTED,
	REVIS_TABLE_SLAVE;


--
-- SR075A_BASE_3  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR075A_BASE_3
(REVIM_SHORTID, REVIM_ROWID_MASTER, REVIM_COUNT_EXPECTED, REVIM_TABLE_SLAVE, REVIM_COUNT_MATCHING)
BEQUEATH DEFINER
AS 
SELECT
	REVIM_SHORTID,
	REVIM_ROWID6,
	1,
	'BDETAIL',
	SUM(DECODE(REVIM_ROWID,NULL,0,1))
FROM
	REVI_MMS
WHERE
	REVIM_SEPID = to_char(add_months(sysdate,-1),'YYYYMM')
GROUP BY
	REVIM_SHORTID,
	REVIM_ROWID6;


--
-- SR075A_BASE_3A  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR075A_BASE_3A
(REVIM_SHORTID, REVIM_ROWID_MASTER, REVIM_TABLE_SLAVE, REVIM_COUNT_MATCHING)
BEQUEATH DEFINER
AS 
SELECT
	REVIM_SHORTID,
	REVIM_ROWID_MASTER,
	REVIM_TABLE_SLAVE,
	SIGN(SUM(REVIM_COUNT_MATCHING)-REVIM_COUNT_EXPECTED)
FROM
	SR075A_BASE_3
GROUP BY
	REVIM_SHORTID,
	REVIM_ROWID_MASTER,
	REVIM_COUNT_EXPECTED,
	REVIM_TABLE_SLAVE;


--
-- SR075A_BASE_5  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR075A_BASE_5
(REVICD_SHORTID, REVICD_ROWID_MASTER, REVICD_COUNT_EXPECTED, REVICD_TABLE_SLAVE, REVICD_COUNT_MATCHING)
BEQUEATH DEFINER
AS 
SELECT
	REVICD_SHORTID,
	REVICD_ROWID_MASTER,
	REVICD_COUNT_EXPECTED,
	REVICD_TABLE_SLAVE,
	SUM(DECODE(REVICD_ROWID_SLAVE,NULL,0,1))
FROM
	REVI_CONTENT_DEL
WHERE
	REVICD_SEPID = to_char(add_months(sysdate,-1),'YYYYMM')
GROUP BY
	REVICD_SHORTID,
	REVICD_ROWID_MASTER,
	REVICD_COUNT_EXPECTED,
	REVICD_TABLE_SLAVE;


--
-- SR075A_BASE_5A  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR075A_BASE_5A
(REVICD_SHORTID, REVICD_ROWID_MASTER, REVICD_TABLE_SLAVE, REVICD_COUNT_MATCHING)
BEQUEATH DEFINER
AS 
SELECT
	REVICD_SHORTID,
	REVICD_ROWID_MASTER,
	REVICD_TABLE_SLAVE,
	SIGN(SUM(REVICD_COUNT_MATCHING)-REVICD_COUNT_EXPECTED)
FROM
	SR075A_BASE_5
GROUP BY
	REVICD_SHORTID,
	REVICD_ROWID_MASTER,
	REVICD_COUNT_EXPECTED,
	REVICD_TABLE_SLAVE;


--
-- SR075A_BASE_7A  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR075A_BASE_7A
(SHORTID, TABLE_SLAVE, TABLE_ROWID_MASTER, MATCH_COUNT, MISS_COUNT, 
 CHARGED_AMOUNT)
BEQUEATH DEFINER
AS 
SELECT
	REVIPRE_SHORTID,
    REVIPRE_TABLE_SLAVE,
    REVIPRE_ROWID_MASTER, 
	COUNT(*),
	SUM(DECODE(REVIPRE_ROWID_SLAVE,NULL,1,0)),
	SUM(REVIPRE_CHARGED_AMOUNT)
FROM    REVI_PRE
WHERE   REVIPRE_SEPID = to_char(add_months(sysdate,-1),'YYYYMM')
GROUP BY
	REVIPRE_SHORTID,
    REVIPRE_TABLE_SLAVE,
    REVIPRE_ROWID_MASTER;


--
-- SR075A_BASE_7B  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR075A_BASE_7B
(SHORTID, TABLE_SLAVE, TABLE_ROWID_SLAVE, MATCH_COUNT, MISS_COUNT, 
 CHARGED_AMOUNT)
BEQUEATH DEFINER
AS 
SELECT
	REVIPRES_SHORTID,
	'CDRSMS',
	REVIPRES_ROWIDS,
    0,
	1,
	REVIPRES_CHARGED_AMOUNT
FROM
	REVIPRE_SMS
WHERE   REVIPRES_SEPID = to_char(add_months(sysdate,-1),'YYYYMM')
AND     REVIPRES_ROWID Is NULL;


--
-- SR075A_BASE_7C  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR075A_BASE_7C
(SHORTID, TABLE_SLAVE, TABLE_ROWID_SLAVE, MATCH_COUNT, MISS_COUNT, 
 CHARGED_AMOUNT)
BEQUEATH DEFINER
AS 
SELECT
	REVIPREM_SHORTID,
	'CDRMMS',
	REVIPREM_ROWIDS,
    0,
	1,
	REVIPREM_CHARGED_AMOUNT
FROM
	REVIPRE_MMS
WHERE   REVIPREM_SEPID = to_char(add_months(sysdate,-1),'YYYYMM')
AND     REVIPREM_ROWID Is NULL;


--
-- SR075A_DETAILS_2  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR075A_DETAILS_2
(REVIS_SHORTID, REVIS_COUNT_MASTER, REVIS_COUNT_MISSING, REVIS_FRACTION_MISSING, REVIS_COUNT_MULTIPLES, 
 REVIS_FRACTION_MULTIPLES)
BEQUEATH DEFINER
AS 
SELECT
	REVIS_SHORTID,
	COUNT(*),
	SUM(DECODE(REVIS_COUNT_MATCHING,-1.0,1,0)),
	SUM(DECODE(REVIS_COUNT_MATCHING,-1.0,1,0))/COUNT(*),	
	SUM(DECODE(REVIS_COUNT_MATCHING,1.0,1,0)),
	SUM(DECODE(REVIS_COUNT_MATCHING,1.0,1,0))/COUNT(*)	
FROM
	SR075A_BASE_2A
GROUP BY
	REVIS_SHORTID,
	REVIS_TABLE_SLAVE
ORDER BY
	to_number(REVIS_SHORTID),
	2;


--
-- SR075A_DETAILS_3  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR075A_DETAILS_3
(REVIM_SHORTID, REVIM_COUNT_MASTER, REVIM_COUNT_MISSING, REVIM_FRACTION_MISSING, REVIM_COUNT_MULTIPLES, 
 REVIM_FRACTION_MULTIPLES)
BEQUEATH DEFINER
AS 
SELECT
	REVIM_SHORTID,
	COUNT(*),
	SUM(DECODE(REVIM_COUNT_MATCHING,-1.0,1,0)),
	SUM(DECODE(REVIM_COUNT_MATCHING,-1.0,1,0))/COUNT(*),	
	SUM(DECODE(REVIM_COUNT_MATCHING,1.0,1,0)),
	SUM(DECODE(REVIM_COUNT_MATCHING,1.0,1,0))/COUNT(*)	
FROM
	SR075A_BASE_3A
GROUP BY
	REVIM_SHORTID,
	REVIM_TABLE_SLAVE
ORDER BY
	to_number(REVIM_SHORTID),
	3;


--
-- SR075A_DETAILS_4  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR075A_DETAILS_4
(REVIB_SHORTID, REVIB_COUNT_MASTER, REVIB_COUNT_MISSING, REVIB_FRACTION_MISSING, REVIB_COUNT_MULTIPLES, 
 REVIB_FRACTION_MULTIPLES)
BEQUEATH DEFINER
AS 
SELECT
	NULL AS REVIB_SHORTID,
	0,
	0,
	0.00,	
	0,
	0.00	
FROM
	DUAL -- SR075A_BASE_4A
WHERE 0=1;


--
-- SR075A_DETAILS_5  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR075A_DETAILS_5
(REVICD_SHORTID, REVICD_MEDIUM, REVICD_COUNT_MASTER, REVICD_COUNT_MISSING, REVICD_FRACTION_MISSING, 
 REVICD_COUNT_MULTIPLES, REVICD_FRACTION_MULTIPLES)
BEQUEATH DEFINER
AS 
SELECT
	REVICD_SHORTID,
	DECODE(REVICD_TABLE_SLAVE,'BDETAIL2','SMS','BDETAIL6','MMS','MMS BULK'),
	COUNT(*),
	SUM(DECODE(REVICD_COUNT_MATCHING,-1.0,1,0)),
	SUM(DECODE(REVICD_COUNT_MATCHING,-1.0,1,0))/COUNT(*),	
	SUM(DECODE(REVICD_COUNT_MATCHING,1.0,1,0)),
	SUM(DECODE(REVICD_COUNT_MATCHING,1.0,1,0))/COUNT(*)	
FROM
	SR075A_BASE_5A
GROUP BY
	REVICD_SHORTID,
	REVICD_TABLE_SLAVE
ORDER BY
	to_number(REVICD_SHORTID),
	2;


--
-- SR111A_BASE_6  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR111A_BASE_6
(DATE_DAY, COUNT_MSISDN)
BEQUEATH DEFINER
AS 
select
    TRUNC(SNL_DEQUEUE_DATE)
    ,
    COUNT(DISTINCT SNL_MSISDN)

from    SBS0_ADMIN.SISNOTLOG
where   SNL_DEQUEUE_DATE >= ADD_MONTHS(TRUNC(SYSDATE ,'MONTH'),-13)
and     SNL_DEQUEUE_DATE < TRUNC(SYSDATE ,'MONTH')
group by TRUNC(SNL_DEQUEUE_DATE);


--
-- SR111A_BASE_8  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR111A_BASE_8
(DATE_DAY, COUNT_SEARCH)
BEQUEATH DEFINER
AS 
select
    TRUNC(ILPL_DATETIME)
    ,
    COUNT(*)

from    SBS2_ADMIN.ILPLOG
where   ILPL_DATETIME >= ADD_MONTHS(TRUNC(SYSDATE ,'MONTH'),-13)
and     ILPL_DATETIME < TRUNC(SYSDATE ,'MONTH')
group by TRUNC(ILPL_DATETIME);


--
-- SR111A_BASE_9  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR111A_BASE_9
(DATE_DAY, COUNT_BARRING, COUNT_UNBARRING, COUNT_TSCROSS)
BEQUEATH DEFINER
AS 
select
    TRUNC(AAAL_DATE)
    ,
    COUNT(DISTINCT AAAL_MSISDN)
    ,
    0
    ,
    0
from    SBS0_ADMIN.AAALOG
where   AAAL_DATE >= ADD_MONTHS(TRUNC(SYSDATE ,'MONTH'),-13)
and     AAAL_DATE  < TRUNC(SYSDATE ,'MONTH')
and     GREATEST(AAAL_BARSCMOLD,AAAL_BARCUOLD) < GREATEST(AAAL_BARSCMNEW,AAAL_BARCUNEW)
group by TRUNC(AAAL_DATE)

UNION ALL

select
    TRUNC(AAAL_DATE)
    ,
    0
    ,
    COUNT(DISTINCT AAAL_MSISDN)
    ,
    0
from    SBS0_ADMIN.AAALOG
where   AAAL_DATE >= ADD_MONTHS(TRUNC(SYSDATE ,'MONTH'),-13)
and     AAAL_DATE  < TRUNC(SYSDATE ,'MONTH')
and     GREATEST(AAAL_BARSCMOLD,AAAL_BARCUOLD) > GREATEST(AAAL_BARSCMNEW,AAAL_BARCUNEW)
group by TRUNC(AAAL_DATE)

UNION ALL

select
    TRUNC(aaatl_datetime)
    ,
    0
    ,
    0
    ,
    COUNT(DISTINCT to_char(substr(AAATL_MESSAGE,1,11)))
from    SBS0_ADMIN.aaatinlog
where   aaatl_datetime >= ADD_MONTHS(TRUNC(SYSDATE ,'MONTH'),-13)
and     aaatl_datetime  < TRUNC(SYSDATE ,'MONTH')
and     AAATL_MESSAGE LIKE '%#TPB_TopStop_reached#%'
group by TRUNC(aaatl_datetime);


--
-- SR111A_DETAILS_HIST  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR111A_DETAILS_HIST
(KPIH_VIEW, P, C01, C02, C03, 
 C04, C05, C06, C07, C08, 
 C09, C10, C11, C12, C13, 
 C14, C15, C16, C17, C18, 
 C19, C20)
BEQUEATH DEFINER
AS 
SELECT KPIH_VIEW, KPIH_PERIOD, C01, C02, C03, C04, C05, C06, C07, C08, C09, C10,
C11, C12, C13, C14, C15, C16, C17, C18, C19, C20
from KPI_HISTORY_VIEW
where KPIH_PERIOD >= TO_CHAR(ADD_MONTHS(TRUNC ( SYSDATE , 'MONTH' ),0 - 13),'YYYY-MM')
order by 1 asc, 2 asc;


--
-- SR111A_PERIOD  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR111A_PERIOD
(ENUM_ID, DATE_FROM, DATE_UNTIL, DATE_PERIOD, DATE_DAYS)
BEQUEATH DEFINER
AS 
select
    0-ENUM_ID
    ,
      ADD_MONTHS
        (
            TRUNC ( SYSDATE , 'MONTH' ) 
          ,
            0 - ENUM_ID 
        )
    ,
      ADD_MONTHS
        (
            TRUNC ( SYSDATE , 'MONTH' ) 
          ,
            1 - ENUM_ID 
        )
    ,
      TO_CHAR(ADD_MONTHS(TRUNC ( SYSDATE , 'MONTH' ),0 - ENUM_ID),'YYYY-MM')
    ,
      ADD_MONTHS(TRUNC(SYSDATE ,'MONTH'),1 - ENUM_ID) - ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0 - ENUM_ID)
  from
    ENUMERATOR
  where ENUM_ID = 1;


--
-- STA_CHECKBT_TPMCONSOL  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.STA_CHECKBT_TPMCONSOL
(MINDATE, MAXDATE)
BEQUEATH DEFINER
AS 
select sysdate minDate, sysdate maxDate
from dual;


--
-- TORA_D_0056_DETAILS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.TORA_D_0056_DETAILS
(DUMMY, HDR, AC_ID, PROC_DATE, PERIOD_TYPE, 
 PERIOD, RESULT, TXT)
BEQUEATH DEFINER
AS 
SELECT
	'DUMMY',
	RAC_ETID HDR,
	RAC_AUDIT_ID || ':' || RAC_ACID AC_ID,
	TO_CHAR(RAC_DATE_CURR,'yyyymmddhh24miss') PROC_DATE,
	RAC_PERIOD_TYPE PERIOD_TYPE,
	TO_CHAR(RAC_PERIOD,'yyyymmdd') PERIOD,
	RAC_RESULT_CURR-NVL(RAC_RESULT_PREV,0) RESULT,
	RAC_COMMENT_CURR TXT
FROM
	RACACHE
WHERE   RAC_AUDIT_ID = 'RA_0056'
AND (RAC_RESULT_CURR-NVL(RAC_RESULT_PREV,0) <> 0 OR RAC_PERIOD = trunc(sysdate)-1)
ORDER BY 6 desc, 3;


--
-- TORA_D_0065_DETAILS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.TORA_D_0065_DETAILS
(DUMMY, HDR, AC_ID, PROC_DATE, PERIOD_TYPE, 
 PERIOD, RESULT, TXT)
BEQUEATH DEFINER
AS 
SELECT
	'DUMMY',
	RAC_ETID HDR,
	RAC_AUDIT_ID || ':' || RAC_ACID AC_ID,
	TO_CHAR(RAC_DATE_CURR,'yyyymmddhh24miss') PROC_DATE,
	RAC_PERIOD_TYPE PERIOD_TYPE,
	TO_CHAR(RAC_PERIOD,'yyyymmdd') PERIOD,
	RAC_RESULT_CURR-NVL(RAC_RESULT_PREV,0) RESULT,
	RAC_COMMENT_CURR TXT
FROM
	RACACHE
WHERE   RAC_AUDIT_ID = 'RA_0065'
AND     RAC_RESULT_CURR-NVL(RAC_RESULT_PREV,0) <> 0
ORDER BY 6 desc, 3;


--
-- TORA_D_0067_DETAILS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.TORA_D_0067_DETAILS
(DUMMY, HDR, AC_ID, PROC_DATE, PERIOD_TYPE, 
 PERIOD, RESULT, TXT)
BEQUEATH DEFINER
AS 
SELECT
	'DUMMY',
	RAC_ETID HDR,
	RAC_AUDIT_ID || ':' || RAC_ACID AC_ID,
	TO_CHAR(RAC_DATE_CURR,'yyyymmddhh24miss') PROC_DATE,
	RAC_PERIOD_TYPE PERIOD_TYPE,
	TO_CHAR(RAC_PERIOD,'yyyymmdd') PERIOD,
	RAC_RESULT_CURR-NVL(RAC_RESULT_PREV,0) RESULT,
	RAC_COMMENT_CURR TXT
FROM
	RACACHE
WHERE   RAC_AUDIT_ID = 'RA_0067'
AND     RAC_RESULT_CURR-NVL(RAC_RESULT_PREV,0) <> 0
ORDER BY 6 desc, 3;


--
-- TPM_OVER_100_PER_MSISDN  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.TPM_OVER_100_PER_MSISDN
(TPMC_MSISDN, TPMC_AMOUNT)
BEQUEATH DEFINER
AS 
SELECT  TPMC_MSISDN,       SUM(TPMC_AMOUNTCU) AS TPMC_AMOUNT  FROM   SBS1_ADMIN.TPMCONSOL  WHERE   TPMC_CONSUB IN ('BN')  GROUP BY TPMC_MSISDN  HAVING SUM(TPMC_AMOUNTCU) > 100;


--
-- UAM_DIFF  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.UAM_DIFF
(ITEM)
BEQUEATH DEFINER
AS 
select ITEM from TEST1  minus select ITEM from TEST;


--
-- WARNINGS_RECENT  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.WARNINGS_RECENT
(W_ID, W_DATETIME, W_APPLIC, W_PROCEDURE, W_TOPIC, 
 W_MESSAGE, W_ERRORTIME, W_BIHID, W_BOHID, W_BDID, 
 W_SHORTID, W_ERRORCODE)
BEQUEATH DEFINER
AS 
SELECT "W_ID","W_DATETIME","W_APPLIC","W_PROCEDURE","W_TOPIC","W_MESSAGE","W_ERRORTIME","W_BIHID","W_BOHID","W_BDID","W_SHORTID","W_ERRORCODE"
  FROM warning where w_errortime > sysdate-1;


--
-- AAA_AGE_PROFILE  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.AAA_AGE_PROFILE FOR SBS0_ADMIN.AAA_AGE_PROFILE;


--
-- AAABLEVEL  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.AAABLEVEL FOR SBS0_ADMIN.AAABLEVEL;


--
-- AAABP  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.AAABP FOR SBS0_ADMIN.AAABP;


--
-- AAABPSTATE  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.AAABPSTATE FOR SBS0_ADMIN.AAABPSTATE;


--
-- AAABPTYPE  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.AAABPTYPE FOR SBS0_ADMIN.AAABPTYPE;


--
-- AAACACHE  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.AAACACHE FOR SBS0_ADMIN.AAACACHE;


--
-- AAACBSS  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.AAACBSS FOR SBS0_ADMIN.AAACBSS;


--
-- AAACUSTBAR  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.AAACUSTBAR FOR SBS0_ADMIN.AAACUSTBAR;


--
-- AAAIMPORT  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.AAAIMPORT FOR SBS0_ADMIN.AAAIMPORT;


--
-- AAAISTATE  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.AAAISTATE FOR SBS0_ADMIN.AAAISTATE;


--
-- AAA_LAST_BULK_BIHID  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.AAA_LAST_BULK_BIHID FOR SBS0_ADMIN.AAA_LAST_BULK_BIHID;


--
-- AAALOG  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.AAALOG FOR SBS0_ADMIN.AAALOG;


--
-- AAAMESSAGETYPE  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.AAAMESSAGETYPE FOR SBS0_ADMIN.AAAMESSAGETYPE;


--
-- AAAREQTYPE  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.AAAREQTYPE FOR SBS0_ADMIN.AAAREQTYPE;


--
-- AAASCAP  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.AAASCAP FOR SBS0_ADMIN.AAASCAP;


--
-- AAASC_EVAL  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.AAASC_EVAL FOR SBS0_ADMIN.AAASC_EVAL;


--
-- AAASCI  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.AAASCI FOR SBS0_ADMIN.AAASCI;


--
-- AAASCL  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.AAASCL FOR SBS0_ADMIN.AAASCL;


--
-- AAASCM  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.AAASCM FOR SBS0_ADMIN.AAASCM;


--
-- AAASCMS  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.AAASCMS FOR SBS0_ADMIN.AAASCMS;


--
-- AAASCO  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.AAASCO FOR SBS0_ADMIN.AAASCO;


--
-- AAASCP  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.AAASCP FOR SBS0_ADMIN.AAASCP;


--
-- AAASCPAGEBASE  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.AAASCPAGEBASE FOR SBS0_ADMIN.AAASCPAGEBASE;


--
-- AAASCPAGEFORM  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.AAASCPAGEFORM FOR SBS0_ADMIN.AAASCPAGEFORM;


--
-- AAASCPSIIDS  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.AAASCPSIIDS FOR SBS0_ADMIN.AAASCPSIIDS;


--
-- AAASCPU  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.AAASCPU FOR SBS0_ADMIN.AAASCPU;


--
-- AAASCS  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.AAASCS FOR SBS0_ADMIN.AAASCS;


--
-- AAASCSDEFAULT  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.AAASCSDEFAULT FOR SBS0_ADMIN.AAASCSDEFAULT;


--
-- AAASC_SIIDS  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.AAASC_SIIDS FOR SBS0_ADMIN.AAASC_SIIDS;


--
-- AAASCSTYPE  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.AAASCSTYPE FOR SBS0_ADMIN.AAASCSTYPE;


--
-- AAASC_TICKLER  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.AAASC_TICKLER FOR SBS0_ADMIN.AAASC_TICKLER;


--
-- AAASELECTION  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.AAASELECTION FOR SBS0_ADMIN.AAASELECTION;


--
-- AAASELECTION_RESULT  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.AAASELECTION_RESULT FOR SBS0_ADMIN.AAASELECTION_RESULT;


--
-- AAASELECTION_STATS  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.AAASELECTION_STATS FOR SBS0_ADMIN.AAASELECTION_STATS;


--
-- AAASYNCLOG  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.AAASYNCLOG FOR SBS0_ADMIN.AAASYNCLOG;


--
-- AAASYNCPRIO  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.AAASYNCPRIO FOR SBS0_ADMIN.AAASYNCPRIO;


--
-- AAASYNCTEXT  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.AAASYNCTEXT FOR SBS0_ADMIN.AAASYNCTEXT;


--
-- AAATEXTTYPE  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.AAATEXTTYPE FOR SBS0_ADMIN.AAATEXTTYPE;


--
-- AAATINLOG  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.AAATINLOG FOR SBS0_ADMIN.AAATINLOG;


--
-- AAATOPSTOP_EXTRAP  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.AAATOPSTOP_EXTRAP FOR SBS0_ADMIN.AAATOPSTOP_EXTRAP;


--
-- AAATOPSTOP_LAST  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.AAATOPSTOP_LAST FOR SBS0_ADMIN.AAATOPSTOP_LAST;


--
-- AAATOPSTOP_OVER  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.AAATOPSTOP_OVER FOR SBS0_ADMIN.AAATOPSTOP_OVER;


--
-- AAATRACKING  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.AAATRACKING FOR SBS0_ADMIN.AAATRACKING;


--
-- AAATSTATE  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.AAATSTATE FOR SBS0_ADMIN.AAATSTATE;


--
-- AAAULEVEL  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.AAAULEVEL FOR SBS0_ADMIN.AAAULEVEL;


--
-- BDCSTATUS  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.BDCSTATUS FOR SBS2_ADMIN.BDCSTATUS;


--
-- BDCUC  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.BDCUC FOR SBS2_ADMIN.BDCUC;


--
-- BDCUCIDXA  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.BDCUCIDXA FOR SBS2_ADMIN.BDCUCIDXA;


--
-- BDCUCIDXB  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.BDCUCIDXB FOR SBS2_ADMIN.BDCUCIDXB;


--
-- BDETAIL_TRLOG  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.BDETAIL_TRLOG FOR SBS2_ADMIN.BDETAIL_TRLOG;


--
-- BD6CUCIDXA  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.BD6CUCIDXA FOR SBS2_ADMIN.BD6CUCIDXA;


--
-- BD6CUCIDXAE  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.BD6CUCIDXAE FOR SBS2_ADMIN.BD6CUCIDXAE;


--
-- BD6CUCIDXB  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.BD6CUCIDXB FOR SBS2_ADMIN.BD6CUCIDXB;


--
-- BD6CUCIDXBE  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.BD6CUCIDXBE FOR SBS2_ADMIN.BD6CUCIDXBE;


--
-- DATA_PARTITIONS_CUC  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.DATA_PARTITIONS_CUC FOR SBS2_ADMIN.DATA_PARTITIONS_CUC;


--
-- GRANT_USER  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.GRANT_USER FOR ADMIN.GRANT_USER;


--
-- HBHEADER  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.HBHEADER FOR SBS0_ADMIN.HBHEADER;


--
-- HIHEADER  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.HIHEADER FOR SBS0_ADMIN.HIHEADER;


--
-- HIMISSING  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.HIMISSING FOR SBS0_ADMIN.HIMISSING;


--
-- LOGIN_AUDIT_INFO  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.LOGIN_AUDIT_INFO FOR SYS.LOGIN_AUDIT_INFO;


--
-- MAY_USE_DAY_PARTITIONS  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.MAY_USE_DAY_PARTITIONS FOR SBS2_ADMIN.MAY_USE_DAY_PARTITIONS;


--
-- MMCA_OBJECTS  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.MMCA_OBJECTS FOR SBS2_ADMIN.MMCA_OBJECTS;


--
-- MMCA_TRAUD  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.MMCA_TRAUD FOR SBS2_ADMIN.MMCA_TRAUD;


--
-- MMCA_TRCMN  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.MMCA_TRCMN FOR SBS2_ADMIN.MMCA_TRCMN;


--
-- MMCA_TRIMG  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.MMCA_TRIMG FOR SBS2_ADMIN.MMCA_TRIMG;


--
-- MMCA_TRLOG  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.MMCA_TRLOG FOR SBS2_ADMIN.MMCA_TRLOG;


--
-- MMCA_TRVID  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.MMCA_TRVID FOR SBS2_ADMIN.MMCA_TRVID;


--
-- PKG_AAA_HB  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.PKG_AAA_HB FOR SBS0_ADMIN.PKG_AAA_HB;


--
-- PKG_AAA_PROV_WEB  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.PKG_AAA_PROV_WEB FOR SBS0_ADMIN.PKG_AAA_PROV_WEB;


--
-- PKG_AAA_PROV_WS  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.PKG_AAA_PROV_WS FOR SBS0_ADMIN.PKG_AAA_PROV_WS;


--
-- PKG_AAA_SIS  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.PKG_AAA_SIS FOR SBS0_ADMIN.PKG_AAA_SIS;


--
-- PKG_AAA_TICKLER  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.PKG_AAA_TICKLER FOR SBS0_ADMIN.PKG_AAA_TICKLER;


--
-- PKG_BDETAIL_CUCA  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.PKG_BDETAIL_CUCA FOR SBS2_ADMIN.PKG_BDETAIL_CUCA;


--
-- PKG_BDETAIL_CUCM  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.PKG_BDETAIL_CUCM FOR SBS2_ADMIN.PKG_BDETAIL_CUCM;


--
-- PKG_BDETAIL_MMCA  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.PKG_BDETAIL_MMCA FOR SBS2_ADMIN.PKG_BDETAIL_MMCA;


--
-- PKG_CONSOL_SOX  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.PKG_CONSOL_SOX FOR SBS0_ADMIN.PKG_CONSOL_SOX;


--
-- SBS_TAB_PARTITIONS  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SBS_TAB_PARTITIONS FOR SYS.SBS_TAB_PARTITIONS;


--
-- SICACHE  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SICACHE FOR SBS0_ADMIN.SICACHE;


--
-- SICPM  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SICPM FOR SBS0_ADMIN.SICPM;


--
-- SI049A_DETAILS  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SI049A_DETAILS FOR SBS2_ADMIN.SI049A_DETAILS;


--
-- SI052A_DETAILS  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SI052A_DETAILS FOR SBS2_ADMIN.SI052A_DETAILS;


--
-- SI053A_DETAILS  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SI053A_DETAILS FOR SBS2_ADMIN.SI053A_DETAILS;


--
-- SI064A_DETAILS_1  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SI064A_DETAILS_1 FOR SBS2_ADMIN.SI064A_DETAILS_1;


--
-- SI064A_DETAILS_2  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SI064A_DETAILS_2 FOR SBS2_ADMIN.SI064A_DETAILS_2;


--
-- SI064A_DETAILS_3  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SI064A_DETAILS_3 FOR SBS2_ADMIN.SI064A_DETAILS_3;


--
-- SI064A_DETAILS_4  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SI064A_DETAILS_4 FOR SBS2_ADMIN.SI064A_DETAILS_4;


--
-- SI065A_DETAILS_1  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SI065A_DETAILS_1 FOR SBS2_ADMIN.SI065A_DETAILS_1;


--
-- SI065A_DETAILS_2  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SI065A_DETAILS_2 FOR SBS2_ADMIN.SI065A_DETAILS_2;


--
-- SI065A_DETAILS_3  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SI065A_DETAILS_3 FOR SBS2_ADMIN.SI065A_DETAILS_3;


--
-- SI065A_DETAILS_4  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SI065A_DETAILS_4 FOR SBS2_ADMIN.SI065A_DETAILS_4;


--
-- SI066A_DETAILS_1  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SI066A_DETAILS_1 FOR SBS2_ADMIN.SI066A_DETAILS_1;


--
-- SI066A_DETAILS_2  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SI066A_DETAILS_2 FOR SBS2_ADMIN.SI066A_DETAILS_2;


--
-- SI066A_DETAILS_3  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SI066A_DETAILS_3 FOR SBS2_ADMIN.SI066A_DETAILS_3;


--
-- SI066A_DETAILS_4  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SI066A_DETAILS_4 FOR SBS2_ADMIN.SI066A_DETAILS_4;


--
-- SI067A_DETAILS_1  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SI067A_DETAILS_1 FOR SBS2_ADMIN.SI067A_DETAILS_1;


--
-- SI067A_DETAILS_2  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SI067A_DETAILS_2 FOR SBS2_ADMIN.SI067A_DETAILS_2;


--
-- SI067A_DETAILS_3  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SI067A_DETAILS_3 FOR SBS2_ADMIN.SI067A_DETAILS_3;


--
-- SI067A_DETAILS_4  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SI067A_DETAILS_4 FOR SBS2_ADMIN.SI067A_DETAILS_4;


--
-- SI069A_DETAILS_1  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SI069A_DETAILS_1 FOR SBS2_ADMIN.SI069A_DETAILS_1;


--
-- SI069A_DETAILS_2  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SI069A_DETAILS_2 FOR SBS2_ADMIN.SI069A_DETAILS_2;


--
-- SI069A_DETAILS_3  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SI069A_DETAILS_3 FOR SBS2_ADMIN.SI069A_DETAILS_3;


--
-- SI069A_DETAILS_4  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SI069A_DETAILS_4 FOR SBS2_ADMIN.SI069A_DETAILS_4;


--
-- SR033A_DETAILS  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SR033A_DETAILS FOR SBS0_ADMIN.SR033A_DETAILS;


--
-- SR033A_DETAILS_WINGO  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SR033A_DETAILS_WINGO FOR SBS0_ADMIN.SR033A_DETAILS_WINGO;


--
-- SR062A_ALL  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SR062A_ALL FOR SBS0_ADMIN.SR062A_ALL;


--
-- SR062A_BASE  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SR062A_BASE FOR SBS0_ADMIN.SR062A_BASE;


--
-- SR062A_DETAILS  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SR062A_DETAILS FOR SBS0_ADMIN.SR062A_DETAILS;


--
-- SR062A_MISSING  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SR062A_MISSING FOR SBS0_ADMIN.SR062A_MISSING;


--
-- SR063A_DETAILS_1  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SR063A_DETAILS_1 FOR SBS2_ADMIN.SR063A_DETAILS_1;


--
-- SR063A_DETAILS_2  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SR063A_DETAILS_2 FOR SBS2_ADMIN.SR063A_DETAILS_2;


--
-- SR063A_DETAILS_3  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SR063A_DETAILS_3 FOR SBS2_ADMIN.SR063A_DETAILS_3;


--
-- SR063A_DETAILS_4  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SR063A_DETAILS_4 FOR SBS2_ADMIN.SR063A_DETAILS_4;


--
-- SR070A_DETAILS_1  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SR070A_DETAILS_1 FOR SBS2_ADMIN.SR070A_DETAILS_1;


--
-- SR070A_DETAILS_2  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SR070A_DETAILS_2 FOR SBS2_ADMIN.SR070A_DETAILS_2;


--
-- SR070A_DETAILS_3  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SR070A_DETAILS_3 FOR SBS2_ADMIN.SR070A_DETAILS_3;


--
-- SR070A_DETAILS_4  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SR070A_DETAILS_4 FOR SBS2_ADMIN.SR070A_DETAILS_4;


--
-- SR072A_DETAILS  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SR072A_DETAILS FOR SBS2_ADMIN.SR072A_DETAILS;


--
-- SR085A_BASE_1  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SR085A_BASE_1 FOR SBS2_ADMIN.SR085A_BASE_1;


--
-- SR085A_BASE_3  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SR085A_BASE_3 FOR SBS2_ADMIN.SR085A_BASE_3;


--
-- SR085A_BASE_3_A  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SR085A_BASE_3_A FOR SBS2_ADMIN.SR085A_BASE_3_A;


--
-- SR085A_BASE_3_B  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SR085A_BASE_3_B FOR SBS2_ADMIN.SR085A_BASE_3_B;


--
-- SR085A_BASE_4  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SR085A_BASE_4 FOR SBS2_ADMIN.SR085A_BASE_4;


--
-- SR085A_CTRL_2  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SR085A_CTRL_2 FOR SBS2_ADMIN.SR085A_CTRL_2;


--
-- SR085A_CTRL_3  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SR085A_CTRL_3 FOR SBS2_ADMIN.SR085A_CTRL_3;


--
-- SR086A_BASE_1  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SR086A_BASE_1 FOR SBS2_ADMIN.SR086A_BASE_1;


--
-- SR086A_BASE_3  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SR086A_BASE_3 FOR SBS2_ADMIN.SR086A_BASE_3;


--
-- SR086A_BASE_3_A  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SR086A_BASE_3_A FOR SBS2_ADMIN.SR086A_BASE_3_A;


--
-- SR086A_BASE_3_B  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SR086A_BASE_3_B FOR SBS2_ADMIN.SR086A_BASE_3_B;


--
-- SR086A_CTRL_2  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SR086A_CTRL_2 FOR SBS2_ADMIN.SR086A_CTRL_2;


--
-- SR086A_CTRL_3  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.SR086A_CTRL_3 FOR SBS2_ADMIN.SR086A_CTRL_3;


--
-- ADDRESS  (Table) 
--
CREATE TABLE SBS1_ADMIN.ADDRESS
(
  ADR_ID              VARCHAR2(10 BYTE)         NOT NULL,
  ADR_ETID            VARCHAR2(10 BYTE)         NOT NULL,
  ADR_DEMO            NUMBER(1)                 NOT NULL,
  ADR_ESID            VARCHAR2(10 BYTE)         NOT NULL,
  ADR_COMPANY         VARCHAR2(100 BYTE),
  ADR_NAME            VARCHAR2(100 BYTE),
  ADR_FNAME           VARCHAR2(100 BYTE),
  ADR_STREET1         VARCHAR2(100 BYTE),
  ADR_STREET2         VARCHAR2(100 BYTE),
  ADR_STREET3         VARCHAR2(100 BYTE),
  ADR_STREET4         VARCHAR2(100 BYTE),
  ADR_STREET5         VARCHAR2(100 BYTE),
  ADR_ZIP             VARCHAR2(12 BYTE),
  ADR_TOWN            VARCHAR2(100 BYTE),
  ADR_COUNTRY         VARCHAR2(100 BYTE),
  ADR_PHONE1          VARCHAR2(40 BYTE),
  ADR_PHONE2          VARCHAR2(40 BYTE),
  ADR_MOBILE          VARCHAR2(40 BYTE),
  ADR_FAX             VARCHAR2(40 BYTE),
  ADR_EMAIL           VARCHAR2(100 BYTE),
  ADR_COMMENT         VARCHAR2(2000 BYTE),
  ADR_INFOFAX         NUMBER(1),
  ADR_INFOEMAIL       NUMBER(1),
  ADR_INFOSMS         NUMBER(1),
  ADR_CHNGCNT         NUMBER(5),
  ADR_PHONE1_BAK      VARCHAR2(40 BYTE),
  ADR_PHONE2_BAK      VARCHAR2(40 BYTE),
  ADR_MOBILE_BAK      VARCHAR2(40 BYTE),
  ADR_FAX_BAK         VARCHAR2(40 BYTE),
  ADR_INFOFAX_BAK     NUMBER(1),
  ADR_INFOEMAIL_BAK   NUMBER(1),
  ADR_INFOSMS_BAK     NUMBER(1),
  ADR_INVOICEEMAIL    NUMBER(1),
  ADR_STATISTICSMAIL  NUMBER(1),
  ADR_ROLE            VARCHAR2(20 CHAR)
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.ADDRESS IS 'Address';


--
-- APP_OBJECT_GRANT  (Table) 
--
CREATE TABLE SBS1_ADMIN.APP_OBJECT_GRANT
(
  OBJECT_NAME     VARCHAR2(40 BYTE)             NOT NULL,
  GRANTEE         VARCHAR2(40 BYTE)             NOT NULL,
  PERMISSION      VARCHAR2(40 BYTE)             NOT NULL,
  REVOKE_COMMENT  VARCHAR2(100 BYTE),
  OBJECT_TYPE     VARCHAR2(40 BYTE),
  TAG             NUMBER(10)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.APP_OBJECT_GRANT IS 'Table used to maintain and generate access grants to tables, views, functions, procedures, sequences and packages.
Entries are filled in manually by the application deverlopers or can be "guessed" for some roles or users (e.g. full permission application user).

Generation of sysnonyms and grants must only be executed if  REVOKE_COMMENT is NULL

';


--
-- CONSUBTYPE  (Table) 
--
CREATE TABLE SBS1_ADMIN.CONSUBTYPE
(
  CONST_ID      VARCHAR2(10 BYTE)               NOT NULL,
  CONST_CONTID  VARCHAR2(10 BYTE)               NOT NULL,
  CONST_CODE    VARCHAR2(10 BYTE)               NOT NULL,
  CONST_LANG01  VARCHAR2(100 BYTE),
  CONST_LANG02  VARCHAR2(100 BYTE),
  CONST_LANG03  VARCHAR2(100 BYTE),
  CONST_LANG04  VARCHAR2(100 BYTE),
  CONST_TARID   VARCHAR2(10 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.CONSUBTYPE IS 'Contract subtype';

COMMENT ON COLUMN SBS1_ADMIN.CONSUBTYPE.CONST_ID IS 'type id';

COMMENT ON COLUMN SBS1_ADMIN.CONSUBTYPE.CONST_CONTID IS 'contract type id';

COMMENT ON COLUMN SBS1_ADMIN.CONSUBTYPE.CONST_CODE IS 'code';

COMMENT ON COLUMN SBS1_ADMIN.CONSUBTYPE.CONST_LANG01 IS 'language 1';

COMMENT ON COLUMN SBS1_ADMIN.CONSUBTYPE.CONST_LANG02 IS 'language 2';

COMMENT ON COLUMN SBS1_ADMIN.CONSUBTYPE.CONST_LANG03 IS 'language 3';

COMMENT ON COLUMN SBS1_ADMIN.CONSUBTYPE.CONST_LANG04 IS 'language 4';

COMMENT ON COLUMN SBS1_ADMIN.CONSUBTYPE.CONST_TARID IS 'internal tariff id';


--
-- CSTYPE  (Table) 
--
CREATE TABLE SBS1_ADMIN.CSTYPE
(
  CST_ID       VARCHAR2(10 BYTE)                NOT NULL,
  CST_CODE     VARCHAR2(10 BYTE)                NOT NULL,
  CST_SRCTYPE  VARCHAR2(10 BYTE)                NOT NULL,
  CST_LANG01   VARCHAR2(100 BYTE),
  CST_LANG02   VARCHAR2(100 BYTE),
  CST_LANG03   VARCHAR2(100 BYTE),
  CST_LANG04   VARCHAR2(100 BYTE),
  CST_VALUE1   VARCHAR2(100 BYTE),
  CST_VALUE2   VARCHAR2(100 BYTE),
  CST_VALUE3   VARCHAR2(100 BYTE),
  CST_VALUE4   VARCHAR2(100 BYTE),
  CST_TRCTID   VARCHAR2(10 BYTE),
  CST_GROUP    VARCHAR2(10 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.CSTYPE IS 'Content Service Type';

COMMENT ON COLUMN SBS1_ADMIN.CSTYPE.CST_ID IS 'type id';

COMMENT ON COLUMN SBS1_ADMIN.CSTYPE.CST_CODE IS 'code';

COMMENT ON COLUMN SBS1_ADMIN.CSTYPE.CST_SRCTYPE IS 'source type';

COMMENT ON COLUMN SBS1_ADMIN.CSTYPE.CST_LANG01 IS 'language 1';

COMMENT ON COLUMN SBS1_ADMIN.CSTYPE.CST_LANG02 IS 'language 2';

COMMENT ON COLUMN SBS1_ADMIN.CSTYPE.CST_LANG03 IS 'language 3';

COMMENT ON COLUMN SBS1_ADMIN.CSTYPE.CST_LANG04 IS 'language 4';

COMMENT ON COLUMN SBS1_ADMIN.CSTYPE.CST_VALUE1 IS 'value 1';

COMMENT ON COLUMN SBS1_ADMIN.CSTYPE.CST_VALUE2 IS 'value 2';

COMMENT ON COLUMN SBS1_ADMIN.CSTYPE.CST_VALUE3 IS 'value 3';

COMMENT ON COLUMN SBS1_ADMIN.CSTYPE.CST_VALUE4 IS 'value 4';

COMMENT ON COLUMN SBS1_ADMIN.CSTYPE.CST_TRCTID IS 'transport medium type';

COMMENT ON COLUMN SBS1_ADMIN.CSTYPE.CST_GROUP IS 'group code';


--
-- DGTICONSOL  (Table) 
--
CREATE TABLE SBS1_ADMIN.DGTICONSOL
(
  DGTIC_ID             VARCHAR2(10 BYTE)        NOT NULL,
  DGTIC_ETID           VARCHAR2(10 BYTE)        NOT NULL,
  DGTIC_ESID           VARCHAR2(10 BYTE)        NOT NULL,
  DGTIC_SEPID          VARCHAR2(10 BYTE)        NOT NULL,
  DGTIC_DGTI           VARCHAR2(20 BYTE),
  DGTIC_DATE           DATE,
  DGTIC_FROMDATE       DATE,
  DGTIC_TODATE         DATE,
  DGTIC_STATUS         VARCHAR2(2 BYTE),
  DGTIC_CONID          VARCHAR2(10 BYTE),
  DGTIC_CONSOLIDATION  VARCHAR2(6 BYTE),
  DGTIC_PREPAID        VARCHAR2(1 BYTE),
  DGTIC_VSMSCID        VARCHAR2(20 BYTE),
  DGTIC_COUNT          NUMBER(12),
  DGTIC_OPKEY          VARCHAR2(10 BYTE)
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    30
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.DGTICONSOL IS 'DGTI Consolidation';

COMMENT ON COLUMN SBS1_ADMIN.DGTICONSOL.DGTIC_ID IS 'id';

COMMENT ON COLUMN SBS1_ADMIN.DGTICONSOL.DGTIC_ETID IS 'type';

COMMENT ON COLUMN SBS1_ADMIN.DGTICONSOL.DGTIC_ESID IS 'state';

COMMENT ON COLUMN SBS1_ADMIN.DGTICONSOL.DGTIC_SEPID IS 'period';

COMMENT ON COLUMN SBS1_ADMIN.DGTICONSOL.DGTIC_DGTI IS 'dgti field';

COMMENT ON COLUMN SBS1_ADMIN.DGTICONSOL.DGTIC_DATE IS 'date';

COMMENT ON COLUMN SBS1_ADMIN.DGTICONSOL.DGTIC_FROMDATE IS 'from date';

COMMENT ON COLUMN SBS1_ADMIN.DGTICONSOL.DGTIC_TODATE IS 'to date';

COMMENT ON COLUMN SBS1_ADMIN.DGTICONSOL.DGTIC_STATUS IS 'status';

COMMENT ON COLUMN SBS1_ADMIN.DGTICONSOL.DGTIC_CONID IS 'contract id';

COMMENT ON COLUMN SBS1_ADMIN.DGTICONSOL.DGTIC_CONSOLIDATION IS 'consolidation';

COMMENT ON COLUMN SBS1_ADMIN.DGTICONSOL.DGTIC_PREPAID IS 'prepaid flag';

COMMENT ON COLUMN SBS1_ADMIN.DGTICONSOL.DGTIC_VSMSCID IS 'vsmscid';

COMMENT ON COLUMN SBS1_ADMIN.DGTICONSOL.DGTIC_COUNT IS 'count';

COMMENT ON COLUMN SBS1_ADMIN.DGTICONSOL.DGTIC_OPKEY IS 'operator key';


--
-- ENPLAACTION  (Table) 
--
CREATE TABLE SBS1_ADMIN.ENPLAACTION
(
  ENPLAA_ID          VARCHAR2(10 BYTE)          NOT NULL,
  ENPLAA_SRCTYPE     VARCHAR2(10 BYTE)          NOT NULL,
  ENPLAA_ENPLARID    VARCHAR2(10 BYTE)          NOT NULL,
  ENPLAA_ETID        VARCHAR2(10 BYTE)          NOT NULL,
  ENPLAA_NAME        VARCHAR2(40 BYTE)          NOT NULL,
  ENPLAA_START_DATE  DATE,
  ENPLAA_END_DATE    DATE,
  ENPLAA_COMMENT     VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.ENPLAACTION IS 'Enabler Platform Address Range Action (MEC Engine special processing if address matches a range)';


--
-- ISCONSOL  (Table) 
--
CREATE TABLE SBS1_ADMIN.ISCONSOL
(
  ISC_ID               VARCHAR2(10 BYTE)        NOT NULL,
  ISC_DATE             DATE,
  ISC_SEPID            VARCHAR2(10 BYTE),
  ISC_ESID             VARCHAR2(10 BYTE)        NOT NULL,
  ISC_SRCTYPE          VARCHAR2(4 BYTE),
  ISC_CONID            VARCHAR2(10 BYTE),
  ISC_CONSTYPE         VARCHAR2(10 BYTE),
  ISC_SHORTID          VARCHAR2(10 BYTE),
  ISC_SERVICE          VARCHAR2(20 BYTE),
  ISC_KEYWORD          VARCHAR2(80 BYTE),
  ISC_BILLTEXT         VARCHAR2(80 BYTE),
  ISC_COUNT            NUMBER(12),
  ISC_PRICE            NUMBER(9,4),
  ISC_AMOUNTCU         NUMBER(12,4),
  ISC_RETSHAREPV       NUMBER(12,4),
  ISC_RETSHAREMO       NUMBER(12,4),
  ISC_PREPAID          VARCHAR2(1 BYTE),
  ISC_REQTYPE          NUMBER(4),
  ISC_BILLRATE         NUMBER(3),
  ISC_STYPE            VARCHAR2(10 BYTE),
  ISC_PMVID            VARCHAR2(10 BYTE),
  ISC_BILLINGDOMAIN    VARCHAR2(10 BYTE),
  ISC_TRANSPORTMEDIUM  VARCHAR2(10 BYTE),
  ISC_CATEGORY         VARCHAR2(20 BYTE),
  ISC_CDRTID           VARCHAR2(10 BYTE),
  ISC_VSPRCID          VARCHAR2(10 BYTE),
  ISC_COUNTTR          NUMBER(12),
  ISC_AMOUNTTR         NUMBER(12,4),
  ISC_BILLTEXT_AGR     NUMBER(1),
  ISC_GART             VARCHAR2(10 BYTE),
  ISC_SHOW             VARCHAR2(32 BYTE),
  ISC_CAMPAIGN         VARCHAR2(32 BYTE)
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON COLUMN SBS1_ADMIN.ISCONSOL.ISC_BILLINGDOMAIN IS 'billing domain';

COMMENT ON COLUMN SBS1_ADMIN.ISCONSOL.ISC_TRANSPORTMEDIUM IS 'transportmedium';

COMMENT ON COLUMN SBS1_ADMIN.ISCONSOL.ISC_CATEGORY IS 'category';

COMMENT ON COLUMN SBS1_ADMIN.ISCONSOL.ISC_CDRTID IS 'cdr type id';


--
-- LONGID  (Table) 
--
CREATE TABLE SBS1_ADMIN.LONGID
(
  LONG_ID         NUMBER(11)                    NOT NULL,
  LONG_ESID       VARCHAR2(10 BYTE)             NOT NULL,
  LONG_DATESTART  DATE,
  LONG_DATEEND    DATE,
  LONG_SHORTID    VARCHAR2(6 BYTE),
  LONG_PRICE      NUMBER(9,4),
  LONG_COMMENT    VARCHAR2(2000 BYTE),
  LONG_CHANGEID   NUMBER(10)                    NOT NULL,
  LONG_FORCE      NUMBER(1)                     NOT NULL
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.LONGID IS 'Long IDs used for P2A SMS from foreign networks.
Includes the mapping to ShortIDs
';


--
-- LONGIDMAP  (Table) 
--
CREATE TABLE SBS1_ADMIN.LONGIDMAP
(
  LONGM_LONGID1    NUMBER(11)                   NOT NULL,
  LONGM_LONGID2    NUMBER(11)                   NOT NULL,
  LONGM_ESID       VARCHAR2(10 BYTE)            NOT NULL,
  LONGM_DATESTART  DATE,
  LONGM_DATEEND    DATE,
  LONGM_SHORTID    VARCHAR2(6 BYTE),
  LONGM_PRICE      NUMBER(9,4),
  LONGM_OCCUPIED   NUMBER(8)                    NOT NULL,
  LONGM_AVAILABLE  NUMBER(8)                    NOT NULL
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.LONGIDMAP IS 'Long ID mappings used for P2A SMS from foreign networks.
Includes the condensed representation of the ShortID mappings for presentation in GUI.  
';


--
-- MAPPING  (Table) 
--
CREATE TABLE SBS1_ADMIN.MAPPING
(
  MAP_ID               VARCHAR2(10 BYTE)        NOT NULL,
  MAP_NAME             VARCHAR2(30 BYTE)        NOT NULL,
  MAP_ETID             VARCHAR2(10 BYTE)        NOT NULL,
  MAP_FILE_MASK        VARCHAR2(100 BYTE),
  MAP_FS_FIRST_CHAR    NUMBER(2),
  MAP_FS_CHAR_COUNT    NUMBER(2),
  MAP_SOX_CODE         VARCHAR2(10 BYTE),
  MAP_SOX_NAME         VARCHAR2(100 BYTE),
  MAP_SOX_REPORT       NUMBER(1),
  MAP_MAX_PROC_DELAY   NUMBER(4),
  MAP_FILE_INTERVAL    NUMBER(4),
  MAP_NEXTSEQ          NUMBER(10),
  MAP_EXECUTE          NUMBER(1)                NOT NULL,
  MAP_CONDITIONALEXEC  VARCHAR2(4000 BYTE),
  MAP_SRCTID           VARCHAR2(10 BYTE),
  MAP_DEBUG            NUMBER(1),
  MAP_PERIODID         VARCHAR2(10 BYTE),
  MAP_STARTDAY         NUMBER(3),
  MAP_STARTHOUR        NUMBER(2),
  MAP_STARTMINUTE      NUMBER(2),
  MAP_DATETRY          DATE,
  MAP_DATEDONE         DATE,
  MAP_ENDCLEARANCE     NUMBER(8)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.MAPPING IS 'Mapping';

COMMENT ON COLUMN SBS1_ADMIN.MAPPING.MAP_ID IS 'mapping id';

COMMENT ON COLUMN SBS1_ADMIN.MAPPING.MAP_NAME IS 'mapping name';

COMMENT ON COLUMN SBS1_ADMIN.MAPPING.MAP_ETID IS 'mapping type';

COMMENT ON COLUMN SBS1_ADMIN.MAPPING.MAP_FILE_MASK IS 'file mask (SQL)';

COMMENT ON COLUMN SBS1_ADMIN.MAPPING.MAP_FS_FIRST_CHAR IS 'file sequence first char';

COMMENT ON COLUMN SBS1_ADMIN.MAPPING.MAP_FS_CHAR_COUNT IS 'file sequence char count';

COMMENT ON COLUMN SBS1_ADMIN.MAPPING.MAP_SOX_CODE IS 'sox report code';

COMMENT ON COLUMN SBS1_ADMIN.MAPPING.MAP_SOX_NAME IS 'sox report name';

COMMENT ON COLUMN SBS1_ADMIN.MAPPING.MAP_SOX_REPORT IS 'sox report on off';

COMMENT ON COLUMN SBS1_ADMIN.MAPPING.MAP_MAX_PROC_DELAY IS 'max processing delay (minutes)';

COMMENT ON COLUMN SBS1_ADMIN.MAPPING.MAP_FILE_INTERVAL IS 'max file interval (minutes)';


--
-- MMSPRICE  (Table) 
--
CREATE TABLE SBS1_ADMIN.MMSPRICE
(
  MMSP_MMSRZID  VARCHAR2(10 BYTE)               NOT NULL,
  MMSP_MMSDZID  VARCHAR2(10 BYTE)               NOT NULL,
  MMSP_MMSSZID  VARCHAR2(10 BYTE)               NOT NULL,
  MMSP_PRICE    NUMBER(8,4)                     NOT NULL, 
  CONSTRAINT PK_MMSPRICE
  PRIMARY KEY
  (MMSP_MMSRZID, MMSP_MMSDZID, MMSP_MMSSZID)
  ENABLE VALIDATE
)
ORGANIZATION INDEX
PCTTHRESHOLD 50
TABLESPACE SBS1_BASE_DATA
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

COMMENT ON TABLE SBS1_ADMIN.MMSPRICE IS 'MMS price';


--
-- MMSRPRICE  (Table) 
--
CREATE TABLE SBS1_ADMIN.MMSRPRICE
(
  MMSRP_MMSRZID1  VARCHAR2(10 BYTE)             NOT NULL,
  MMSRP_MMSRZID2  VARCHAR2(10 BYTE)             NOT NULL,
  MMSRP_MMSSZID   VARCHAR2(10 BYTE)             NOT NULL,
  MMSRP_PRICE     NUMBER(8,4)                   NOT NULL, 
  CONSTRAINT PK_MMSRPRICE
  PRIMARY KEY
  (MMSRP_MMSRZID1, MMSRP_MMSRZID2, MMSRP_MMSSZID)
  ENABLE VALIDATE
)
ORGANIZATION INDEX
PCTTHRESHOLD 50
TABLESPACE SBS1_BASE_DATA
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

COMMENT ON TABLE SBS1_ADMIN.MMSRPRICE IS 'MMS roaming price';


--
-- NOTIFICATIONTEMPL  (Table) 
--
CREATE TABLE SBS1_ADMIN.NOTIFICATIONTEMPL
(
  NOT_ID          VARCHAR2(10 BYTE)             NOT NULL,
  NOT_SUBJECT     VARCHAR2(200 BYTE),
  NOT_BODY        VARCHAR2(4000 BYTE)           NOT NULL,
  NOT_SENDERDISP  VARCHAR2(200 BYTE),
  NOT_SENDERTXT   VARCHAR2(500 BYTE),
  NOT_RECDISP     VARCHAR2(200 BYTE),
  NOT_ADRFROM     VARCHAR2(2000 BYTE)           NOT NULL,
  NOT_ADRTO       VARCHAR2(2000 BYTE)           NOT NULL,
  NOT_ADRCC       VARCHAR2(2000 BYTE),
  NOT_ADRBCC      VARCHAR2(2000 BYTE),
  NOT_ATTFILE     NUMBER(1),
  NOT_ACIDCRE     VARCHAR2(10 BYTE),
  NOT_DATECRE     DATE,
  NOT_ACIDMOD     VARCHAR2(10 BYTE),
  NOT_DATEMOD     DATE,
  NOT_CHNGCNT     NUMBER(5),
  NOT_ESID        VARCHAR2(10 BYTE)             NOT NULL,
  NOT_ETID        VARCHAR2(10 BYTE)             NOT NULL,
  NOT_MAXATTSIZE  NUMBER(8)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.NOTIFICATIONTEMPL IS 'Notification Template';

COMMENT ON COLUMN SBS1_ADMIN.NOTIFICATIONTEMPL.NOT_ID IS 'notification template id';

COMMENT ON COLUMN SBS1_ADMIN.NOTIFICATIONTEMPL.NOT_SUBJECT IS 'notification email subject';

COMMENT ON COLUMN SBS1_ADMIN.NOTIFICATIONTEMPL.NOT_BODY IS 'notification email body';

COMMENT ON COLUMN SBS1_ADMIN.NOTIFICATIONTEMPL.NOT_SENDERDISP IS 'Display name sender';

COMMENT ON COLUMN SBS1_ADMIN.NOTIFICATIONTEMPL.NOT_SENDERTXT IS 'NOT_SENDERTXT';

COMMENT ON COLUMN SBS1_ADMIN.NOTIFICATIONTEMPL.NOT_RECDISP IS 'display name recipient';

COMMENT ON COLUMN SBS1_ADMIN.NOTIFICATIONTEMPL.NOT_ADRFROM IS 'notification email adr from';

COMMENT ON COLUMN SBS1_ADMIN.NOTIFICATIONTEMPL.NOT_ADRTO IS 'notification email adr to';

COMMENT ON COLUMN SBS1_ADMIN.NOTIFICATIONTEMPL.NOT_ADRCC IS 'notification email adr cc';

COMMENT ON COLUMN SBS1_ADMIN.NOTIFICATIONTEMPL.NOT_ADRBCC IS 'notification email adr bcc';

COMMENT ON COLUMN SBS1_ADMIN.NOTIFICATIONTEMPL.NOT_ATTFILE IS 'notification email attachement file';

COMMENT ON COLUMN SBS1_ADMIN.NOTIFICATIONTEMPL.NOT_ACIDCRE IS 'notification acid creation';

COMMENT ON COLUMN SBS1_ADMIN.NOTIFICATIONTEMPL.NOT_DATECRE IS 'notification date creation';

COMMENT ON COLUMN SBS1_ADMIN.NOTIFICATIONTEMPL.NOT_ACIDMOD IS 'notification acid modification';

COMMENT ON COLUMN SBS1_ADMIN.NOTIFICATIONTEMPL.NOT_DATEMOD IS 'notification date modification';

COMMENT ON COLUMN SBS1_ADMIN.NOTIFICATIONTEMPL.NOT_CHNGCNT IS 'notification change count';

COMMENT ON COLUMN SBS1_ADMIN.NOTIFICATIONTEMPL.NOT_ESID IS 'notification state';

COMMENT ON COLUMN SBS1_ADMIN.NOTIFICATIONTEMPL.NOT_ETID IS 'notification type';


--
-- NOT_PARAM  (Table) 
--
CREATE TABLE SBS1_ADMIN.NOT_PARAM
(
  NOTP_ID     VARCHAR2(10 BYTE)                 NOT NULL,
  NOTP_NOTID  VARCHAR2(10 BYTE)                 NOT NULL,
  NOTP_NAME   VARCHAR2(100 BYTE)                NOT NULL,
  NOTP_VALUE  VARCHAR2(2000 BYTE),
  NOTP_WEB    NUMBER(1)                         NOT NULL,
  NOTP_ABS    NUMBER(1)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.NOT_PARAM IS 'NOT_PARAM';

COMMENT ON COLUMN SBS1_ADMIN.NOT_PARAM.NOTP_ID IS 'Unique ID';

COMMENT ON COLUMN SBS1_ADMIN.NOT_PARAM.NOTP_NOTID IS 'Notification id';

COMMENT ON COLUMN SBS1_ADMIN.NOT_PARAM.NOTP_NAME IS 'Parameter tag';

COMMENT ON COLUMN SBS1_ADMIN.NOT_PARAM.NOTP_VALUE IS 'Parameter value';

COMMENT ON COLUMN SBS1_ADMIN.NOT_PARAM.NOTP_WEB IS 'Show on Web';

COMMENT ON COLUMN SBS1_ADMIN.NOT_PARAM.NOTP_ABS IS 'Absolute value';


--
-- NUMBERRANGE  (Table) 
--
CREATE TABLE SBS1_ADMIN.NUMBERRANGE
(
  NBR_ID        VARCHAR2(10 BYTE)               NOT NULL,
  NBR_CONOPKEY  VARCHAR2(10 BYTE),
  NBR_CODE      VARCHAR2(10 BYTE),
  NBR_DETECTED  DATE,
  NBR_COUNTDET  NUMBER(8),
  NBR_DATECRE   DATE,
  NBR_ACIDCRE   VARCHAR2(10 BYTE),
  NBR_DATEMOD   DATE,
  NBR_ACIDMOD   VARCHAR2(10 BYTE),
  NBR_CHNGCNT   NUMBER(5),
  NBR_PPRZNID   VARCHAR2(10 BYTE)
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;


--
-- OGTICONSOL  (Table) 
--
CREATE TABLE SBS1_ADMIN.OGTICONSOL
(
  OGTIC_ID             VARCHAR2(10 BYTE)        NOT NULL,
  OGTIC_ETID           VARCHAR2(10 BYTE)        NOT NULL,
  OGTIC_ESID           VARCHAR2(10 BYTE)        NOT NULL,
  OGTIC_SEPID          VARCHAR2(10 BYTE)        NOT NULL,
  OGTIC_OGTI           VARCHAR2(20 BYTE),
  OGTIC_DATE           DATE,
  OGTIC_FROMDATE       DATE,
  OGTIC_TODATE         DATE,
  OGTIC_STATUS         VARCHAR2(2 BYTE),
  OGTIC_CONID          VARCHAR2(10 BYTE),
  OGTIC_CONSOLIDATION  VARCHAR2(6 BYTE),
  OGTIC_PREPAID        VARCHAR2(1 BYTE),
  OGTIC_VSMSCID        VARCHAR2(20 BYTE),
  OGTIC_COUNT          NUMBER(12),
  OGTIC_OPKEY          VARCHAR2(10 BYTE)
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    30
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.OGTICONSOL IS 'OGTI Consolidation';

COMMENT ON COLUMN SBS1_ADMIN.OGTICONSOL.OGTIC_ID IS 'id';

COMMENT ON COLUMN SBS1_ADMIN.OGTICONSOL.OGTIC_ETID IS 'type';

COMMENT ON COLUMN SBS1_ADMIN.OGTICONSOL.OGTIC_ESID IS 'state';

COMMENT ON COLUMN SBS1_ADMIN.OGTICONSOL.OGTIC_SEPID IS 'period';

COMMENT ON COLUMN SBS1_ADMIN.OGTICONSOL.OGTIC_OGTI IS 'ogti field';

COMMENT ON COLUMN SBS1_ADMIN.OGTICONSOL.OGTIC_DATE IS 'date';

COMMENT ON COLUMN SBS1_ADMIN.OGTICONSOL.OGTIC_FROMDATE IS 'from date';

COMMENT ON COLUMN SBS1_ADMIN.OGTICONSOL.OGTIC_TODATE IS 'to date';

COMMENT ON COLUMN SBS1_ADMIN.OGTICONSOL.OGTIC_STATUS IS 'status';

COMMENT ON COLUMN SBS1_ADMIN.OGTICONSOL.OGTIC_CONID IS 'contract id';

COMMENT ON COLUMN SBS1_ADMIN.OGTICONSOL.OGTIC_CONSOLIDATION IS 'consolidation';

COMMENT ON COLUMN SBS1_ADMIN.OGTICONSOL.OGTIC_PREPAID IS 'prepaid flag';

COMMENT ON COLUMN SBS1_ADMIN.OGTICONSOL.OGTIC_VSMSCID IS 'vsmscid';

COMMENT ON COLUMN SBS1_ADMIN.OGTICONSOL.OGTIC_COUNT IS 'count';

COMMENT ON COLUMN SBS1_ADMIN.OGTICONSOL.OGTIC_OPKEY IS 'operator key';


--
-- PRMODEL  (Table) 
--
CREATE TABLE SBS1_ADMIN.PRMODEL
(
  PM_ID       VARCHAR2(10 BYTE)                 NOT NULL,
  PM_PMSID    VARCHAR2(10 BYTE)                 NOT NULL,
  PM_NAME     VARCHAR2(30 BYTE)                 NOT NULL,
  PM_SRCTYPE  VARCHAR2(10 BYTE)                 NOT NULL,
  PM_COMMENT  VARCHAR2(1000 BYTE),
  PM_CHNGCNT  NUMBER(5),
  PM_ACIDCRE  VARCHAR2(10 BYTE),
  PM_DATECRE  DATE,
  PM_ACIDMOD  VARCHAR2(10 BYTE),
  PM_DATEMOD  DATE
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.PRMODEL IS 'Pricing Model';


--
-- PRMODELVER  (Table) 
--
CREATE TABLE SBS1_ADMIN.PRMODELVER
(
  PMV_ID       VARCHAR2(10 BYTE)                NOT NULL,
  PMV_PMID     VARCHAR2(10 BYTE)                NOT NULL,
  PMV_NAME     VARCHAR2(30 BYTE)                NOT NULL,
  PMV_START    DATE                             NOT NULL,
  PMV_END      DATE                             DEFAULT to_date('01.01.2100','dd.mm.yyyy') NOT NULL,
  PMV_COMMENT  VARCHAR2(1000 BYTE),
  PMV_CHNGCNT  NUMBER(5),
  PMV_ACIDCRE  VARCHAR2(10 BYTE),
  PMV_DATECRE  DATE,
  PMV_ACIDMOD  VARCHAR2(10 BYTE),
  PMV_DATEMOD  DATE,
  PMV_ESID     VARCHAR2(10 BYTE)                NOT NULL
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.PRMODELVER IS 'Pricing Model Version';

COMMENT ON COLUMN SBS1_ADMIN.PRMODELVER.PMV_ESID IS 'version state';


--
-- PRMODELVERTRANS  (Table) 
--
CREATE TABLE SBS1_ADMIN.PRMODELVERTRANS
(
  PMVT_ID         VARCHAR2(10 BYTE)             NOT NULL,
  PMVT_PMVID      VARCHAR2(10 BYTE)             NOT NULL,
  PMVT_TRCLASS    NUMBER(10,3)                  NOT NULL,
  PMVT_CLASSTYPE  VARCHAR2(10 BYTE)             NOT NULL,
  PMVT_CLASSDESC  VARCHAR2(100 BYTE),
  PMVT_AMOUNTMO   NUMBER(9,4)                   NOT NULL,
  PMVT_AMOUNTMT   NUMBER(9,4)                   NOT NULL,
  PMVT_COMMENT    VARCHAR2(1000 BYTE),
  PMVT_CHNGCNT    NUMBER(5)
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.PRMODELVERTRANS IS 'Pricing model version transport';

COMMENT ON COLUMN SBS1_ADMIN.PRMODELVERTRANS.PMVT_ID IS 'model version transport id';

COMMENT ON COLUMN SBS1_ADMIN.PRMODELVERTRANS.PMVT_PMVID IS 'model version id';

COMMENT ON COLUMN SBS1_ADMIN.PRMODELVERTRANS.PMVT_TRCLASS IS 'transport class';

COMMENT ON COLUMN SBS1_ADMIN.PRMODELVERTRANS.PMVT_CLASSTYPE IS 'transport class type';

COMMENT ON COLUMN SBS1_ADMIN.PRMODELVERTRANS.PMVT_CLASSDESC IS 'transport class description';

COMMENT ON COLUMN SBS1_ADMIN.PRMODELVERTRANS.PMVT_AMOUNTMO IS 'amount mobile originating';

COMMENT ON COLUMN SBS1_ADMIN.PRMODELVERTRANS.PMVT_AMOUNTMT IS 'amount mobile terminating';

COMMENT ON COLUMN SBS1_ADMIN.PRMODELVERTRANS.PMVT_COMMENT IS 'comments';

COMMENT ON COLUMN SBS1_ADMIN.PRMODELVERTRANS.PMVT_CHNGCNT IS 'change counter';


--
-- PROXY  (Table) 
--
CREATE TABLE SBS1_ADMIN.PROXY
(
  PROXY_ID       VARCHAR2(10 BYTE)              NOT NULL,
  PROXY_ETID     VARCHAR2(10 BYTE)              NOT NULL,
  PROXY_ADDRESS  VARCHAR2(20 BYTE),
  PROXY_NAME     VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.PROXY IS 'PROXY , including IP address, used for creating proxy whitelists for TCP/IP SMSC access';


--
-- REVA_HEADER  (Table) 
--
CREATE TABLE SBS1_ADMIN.REVA_HEADER
(
  REVAH_ID           VARCHAR2(10 BYTE)          NOT NULL,
  REVAH_SRCTYPE      VARCHAR2(10 BYTE)          NOT NULL,
  REVAH_PACID        VARCHAR2(10 BYTE)          NOT NULL,
  REVAH_BILLINGTYPE  VARCHAR2(10 BYTE),
  REVAH_BILLEDITEM   VARCHAR2(10 BYTE),
  REVAH_SQL          VARCHAR2(4000 BYTE)        NOT NULL,
  REVAH_DESC         VARCHAR2(1024 BYTE),
  REVAH_SIGDESC      VARCHAR2(2000 BYTE),
  REVAH_ESID         VARCHAR2(10 BYTE),
  REVAH_INSQL        VARCHAR2(4000 BYTE),
  REVAH_NEWSIGSQL    VARCHAR2(4000 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.REVA_HEADER IS 'REVA Header';

COMMENT ON COLUMN SBS1_ADMIN.REVA_HEADER.REVAH_ID IS 'id';

COMMENT ON COLUMN SBS1_ADMIN.REVA_HEADER.REVAH_SRCTYPE IS 'input stream';

COMMENT ON COLUMN SBS1_ADMIN.REVA_HEADER.REVAH_PACID IS 'output stream';

COMMENT ON COLUMN SBS1_ADMIN.REVA_HEADER.REVAH_BILLINGTYPE IS 'billing type';

COMMENT ON COLUMN SBS1_ADMIN.REVA_HEADER.REVAH_BILLEDITEM IS 'billed item';

COMMENT ON COLUMN SBS1_ADMIN.REVA_HEADER.REVAH_SQL IS 'signature sql';

COMMENT ON COLUMN SBS1_ADMIN.REVA_HEADER.REVAH_DESC IS 'mask description';

COMMENT ON COLUMN SBS1_ADMIN.REVA_HEADER.REVAH_SIGDESC IS 'signature desc';

COMMENT ON COLUMN SBS1_ADMIN.REVA_HEADER.REVAH_ESID IS 'state';

COMMENT ON COLUMN SBS1_ADMIN.REVA_HEADER.REVAH_INSQL IS 'count input sql';

COMMENT ON COLUMN SBS1_ADMIN.REVA_HEADER.REVAH_NEWSIGSQL IS 'new sig sql';


--
-- REVA_SIGMASK  (Table) 
--
CREATE TABLE SBS1_ADMIN.REVA_SIGMASK
(
  REVASM_ID       VARCHAR2(20 BYTE)             NOT NULL,
  REVASM_CODE     VARCHAR2(20 BYTE)             NOT NULL,
  REVASM_REVAHID  VARCHAR2(10 BYTE)             NOT NULL,
  REVASM_ESID     VARCHAR2(10 BYTE)             NOT NULL,
  REVASM_ETID     VARCHAR2(10 BYTE)             NOT NULL,
  REVASM_ORDER    NUMBER(8,4),
  REVASM_DESC     VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.REVA_SIGMASK IS 'Signature Descriptions';

COMMENT ON COLUMN SBS1_ADMIN.REVA_SIGMASK.REVASM_ID IS 'id';

COMMENT ON COLUMN SBS1_ADMIN.REVA_SIGMASK.REVASM_CODE IS 'code';

COMMENT ON COLUMN SBS1_ADMIN.REVA_SIGMASK.REVASM_REVAHID IS 'sig header';

COMMENT ON COLUMN SBS1_ADMIN.REVA_SIGMASK.REVASM_ESID IS 'state';

COMMENT ON COLUMN SBS1_ADMIN.REVA_SIGMASK.REVASM_ETID IS 'type';

COMMENT ON COLUMN SBS1_ADMIN.REVA_SIGMASK.REVASM_ORDER IS 'sort order';

COMMENT ON COLUMN SBS1_ADMIN.REVA_SIGMASK.REVASM_DESC IS 'description';


--
-- ROCONSOLIDATION  (Table) 
--
CREATE TABLE SBS1_ADMIN.ROCONSOLIDATION
(
  ROC_ID             VARCHAR2(10 BYTE)          NOT NULL,
  ROC_ETID           VARCHAR2(10 BYTE)          NOT NULL,
  ROC_ESID           VARCHAR2(10 BYTE)          NOT NULL,
  ROC_SEPID          VARCHAR2(10 BYTE)          NOT NULL,
  ROC_DATE           DATE,
  ROC_FROMDATE       DATE,
  ROC_TODATE         DATE,
  ROC_CONID          VARCHAR2(10 BYTE),
  ROC_NBRCODE        VARCHAR2(10 BYTE),
  ROC_NBRMIN         VARCHAR2(10 BYTE),
  ROC_NBRMAX         VARCHAR2(10 BYTE),
  ROC_CARID          VARCHAR2(10 BYTE),
  ROC_CONSOLIDATION  VARCHAR2(6 BYTE),
  ROC_COUNT          NUMBER(12),
  ROC_AMOUNTCU       NUMBER(12,4),
  ROC_RETSHAREPV     NUMBER(12,4),
  ROC_RETSHAREMO     NUMBER(12,4),
  ROC_TOCID          VARCHAR2(10 BYTE),
  ROC_IOT            NUMBER(12,4),
  ROC_STATUS         VARCHAR2(2 BYTE),
  ROC_INT            VARCHAR2(1 BYTE),
  ROC_IW             VARCHAR2(1 BYTE),
  ROC_IOT_INTERNAL   NUMBER(12,4)
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    30
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.ROCONSOLIDATION IS 'roaming';


--
-- SCRIPT  (Table) 
--
CREATE TABLE SBS1_ADMIN.SCRIPT
(
  SCR_ID        VARCHAR2(10 BYTE)               NOT NULL,
  SCR_NAME      VARCHAR2(30 BYTE),
  SCR_LINE      NUMBER(4),
  SCR_TEXT      VARCHAR2(2000 BYTE),
  SCR_JOB       VARCHAR2(2 BYTE),
  SCR_DATETIME  DATE,
  SCR_BOHID     VARCHAR2(10 BYTE),
  SCR_ESID      VARCHAR2(10 BYTE),
  SCR_DATEEND   DATE,
  SCR_RESPONSE  VARCHAR2(2000 BYTE)
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.SCRIPT IS 'script';


--
-- SMSC  (Table) 
--
CREATE TABLE SBS1_ADMIN.SMSC
(
  SMSC_ID             VARCHAR2(10 BYTE)         NOT NULL,
  SMSC_CONOPKEY       VARCHAR2(10 BYTE)         NOT NULL,
  SMSC_CODE           VARCHAR2(20 BYTE)         NOT NULL,
  SMSC_DETECTED       DATE,
  SMSC_COUNTDET       NUMBER(8),
  SMSC_DATECRE        DATE,
  SMSC_ACIDCRE        VARCHAR2(10 BYTE),
  SMSC_DATEMOD        DATE,
  SMSC_ACIDMOD        VARCHAR2(10 BYTE),
  SMSC_CHNGCNT        NUMBER(5),
  SMSC_ESID           VARCHAR2(10 BYTE),
  SMSC_CONOPKEY_PROP  VARCHAR2(10 BYTE)
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON COLUMN SBS1_ADMIN.SMSC.SMSC_ID IS 'id';

COMMENT ON COLUMN SBS1_ADMIN.SMSC.SMSC_CONOPKEY IS 'contract opkey';

COMMENT ON COLUMN SBS1_ADMIN.SMSC.SMSC_CODE IS 'code';

COMMENT ON COLUMN SBS1_ADMIN.SMSC.SMSC_DETECTED IS 'last detected';

COMMENT ON COLUMN SBS1_ADMIN.SMSC.SMSC_COUNTDET IS 'count detected';

COMMENT ON COLUMN SBS1_ADMIN.SMSC.SMSC_DATECRE IS 'creation date';

COMMENT ON COLUMN SBS1_ADMIN.SMSC.SMSC_ACIDCRE IS 'creator account id';

COMMENT ON COLUMN SBS1_ADMIN.SMSC.SMSC_DATEMOD IS 'modification date';

COMMENT ON COLUMN SBS1_ADMIN.SMSC.SMSC_ACIDMOD IS 'modifier account id';

COMMENT ON COLUMN SBS1_ADMIN.SMSC.SMSC_CHNGCNT IS 'change counter';


--
-- SRAS  (Table) 
--
CREATE TABLE SBS1_ADMIN.SRAS
(
  SRAS_ID       VARCHAR2(10 BYTE)               NOT NULL,
  SRAS_ETID     VARCHAR2(10 BYTE)               NOT NULL,
  SRAS_ADDRESS  VARCHAR2(20 BYTE),
  SRAS_NAME     VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.SRAS IS 'SRAS , including IP address, used for creating proxy whitelists for ISDN SMSC access';


--
-- TARIFF  (Table) 
--
CREATE TABLE SBS1_ADMIN.TARIFF
(
  TAR_ID             VARCHAR2(1 BYTE)           NOT NULL,
  TAR_CODE           VARCHAR2(10 BYTE)          NOT NULL,
  TAR_LANG01         VARCHAR2(100 BYTE),
  TAR_LANG02         VARCHAR2(100 BYTE),
  TAR_LANG03         VARCHAR2(100 BYTE),
  TAR_LANG04         VARCHAR2(100 BYTE),
  TAR_PRICE          NUMBER(6,4),
  TAR_PRICEINT       NUMBER(6,4),
  TAR_PRICEHG        NUMBER(6,4),
  TAR_MINCHARGE      NUMBER(12,4),
  TAR_THROUGHPUT     NUMBER(9,4),
  TAR_HGZNID         VARCHAR2(10 BYTE),
  TAR_PRICEMO        NUMBER(6,4),
  TAR_PRICEMOFN_DEF  NUMBER(6,4),
  TAR_IWRS_DEF       NUMBER(7,4),
  TAR_MFGR_DEF       NUMBER(10,4),
  TAR_MFLID_DEF      NUMBER(6,4)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.TARIFF IS 'tariff';


--
-- TARIFFUSAGE  (Table) 
--
CREATE TABLE SBS1_ADMIN.TARIFFUSAGE
(
  TARUS_TARID    VARCHAR2(1 BYTE)               NOT NULL,
  TARUS_CONTID   VARCHAR2(10 BYTE)              NOT NULL,
  TARUS_SECTION  NUMBER(2)                      NOT NULL,
  TARUS_ORDER    NUMBER(6,4)                    NOT NULL
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.TARIFFUSAGE IS 'tariff usage per contract type';


--
-- TRCONSOL  (Table) 
--
CREATE TABLE SBS1_ADMIN.TRCONSOL
(
  TRC_ID        VARCHAR2(10 BYTE)               NOT NULL,
  TRC_DATE      DATE,
  TRC_SEPID     VARCHAR2(10 BYTE),
  TRC_ESID      VARCHAR2(10 BYTE)               NOT NULL,
  TRC_ETID      VARCHAR2(10 BYTE),
  TRC_TRDID     VARCHAR2(10 BYTE),
  TRC_CONID     VARCHAR2(10 BYTE),
  TRC_SHORTID   VARCHAR2(10 BYTE),
  TRC_SERVICE   VARCHAR2(20 BYTE),
  TRC_COUNT     NUMBER(12),
  TRC_PRICE     NUMBER(9,4),
  TRC_AMOUNT    NUMBER(12,4),
  TRC_TRCLASS   NUMBER(10,3),
  TRC_PREPAID   VARCHAR2(1 BYTE),
  TRC_GART      VARCHAR2(10 BYTE),
  TRC_SHOW      VARCHAR2(32 BYTE),
  TRC_CAMPAIGN  VARCHAR2(32 BYTE)
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.TRCONSOL IS 'trconsol';

COMMENT ON COLUMN SBS1_ADMIN.TRCONSOL.TRC_ID IS 'entity id';

COMMENT ON COLUMN SBS1_ADMIN.TRCONSOL.TRC_DATE IS 'date';

COMMENT ON COLUMN SBS1_ADMIN.TRCONSOL.TRC_SEPID IS 'settlement period id';

COMMENT ON COLUMN SBS1_ADMIN.TRCONSOL.TRC_ESID IS 'entity state';

COMMENT ON COLUMN SBS1_ADMIN.TRCONSOL.TRC_ETID IS 'entity type id';

COMMENT ON COLUMN SBS1_ADMIN.TRCONSOL.TRC_TRDID IS 'direction id';

COMMENT ON COLUMN SBS1_ADMIN.TRCONSOL.TRC_CONID IS 'contract';

COMMENT ON COLUMN SBS1_ADMIN.TRCONSOL.TRC_SHORTID IS 'short id';

COMMENT ON COLUMN SBS1_ADMIN.TRCONSOL.TRC_SERVICE IS 'service';

COMMENT ON COLUMN SBS1_ADMIN.TRCONSOL.TRC_COUNT IS 'counter';

COMMENT ON COLUMN SBS1_ADMIN.TRCONSOL.TRC_PRICE IS 'price';

COMMENT ON COLUMN SBS1_ADMIN.TRCONSOL.TRC_AMOUNT IS 'amount transport';

COMMENT ON COLUMN SBS1_ADMIN.TRCONSOL.TRC_TRCLASS IS 'transport class';

COMMENT ON COLUMN SBS1_ADMIN.TRCONSOL.TRC_PREPAID IS 'prepaid';


--
-- XPROC  (Table) 
--
CREATE TABLE SBS1_ADMIN.XPROC
(
  XPR_ID       VARCHAR2(50 BYTE)                NOT NULL,
  XPR_ETID     VARCHAR2(10 BYTE)                NOT NULL,
  XPR_NAME     VARCHAR2(100 BYTE)               NOT NULL,
  XPR_ESID     VARCHAR2(10 BYTE)                NOT NULL,
  XPR_ACIDCRE  VARCHAR2(10 BYTE),
  XPR_DATECRE  DATE,
  XPR_ACIDMOD  VARCHAR2(10 BYTE),
  XPR_DATEMOD  DATE,
  XPR_CHNGCNT  NUMBER(5),
  XPR_INFO     VARCHAR2(1000 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.XPROC IS 'XProc';

COMMENT ON COLUMN SBS1_ADMIN.XPROC.XPR_ID IS 'Unique ID';

COMMENT ON COLUMN SBS1_ADMIN.XPROC.XPR_ETID IS 'procedure type';

COMMENT ON COLUMN SBS1_ADMIN.XPROC.XPR_NAME IS 'procedure name';

COMMENT ON COLUMN SBS1_ADMIN.XPROC.XPR_ESID IS 'procedure state';

COMMENT ON COLUMN SBS1_ADMIN.XPROC.XPR_ACIDCRE IS 'acid creation';

COMMENT ON COLUMN SBS1_ADMIN.XPROC.XPR_DATECRE IS 'date creation';

COMMENT ON COLUMN SBS1_ADMIN.XPROC.XPR_ACIDMOD IS 'acid modificated';

COMMENT ON COLUMN SBS1_ADMIN.XPROC.XPR_DATEMOD IS 'date mod';

COMMENT ON COLUMN SBS1_ADMIN.XPROC.XPR_CHNGCNT IS 'change count';

COMMENT ON COLUMN SBS1_ADMIN.XPROC.XPR_INFO IS 'info';


--
-- ZNZNU  (Table) 
--
CREATE TABLE SBS1_ADMIN.ZNZNU
(
  ZNZNU_ZNID   VARCHAR2(10 BYTE)                NOT NULL,
  ZNZNU_ZNUID  VARCHAR2(10 BYTE)                NOT NULL
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.ZNZNU IS 'Zone ZoneUsage';

COMMENT ON COLUMN SBS1_ADMIN.ZNZNU.ZNZNU_ZNID IS 'zone id';

COMMENT ON COLUMN SBS1_ADMIN.ZNZNU.ZNZNU_ZNUID IS 'zone usage id';


--
-- IDX_ADR_CITY  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_ADR_CITY ON SBS1_ADMIN.ADDRESS
(ADR_TOWN)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_ADR_COMPANY  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_ADR_COMPANY ON SBS1_ADMIN.ADDRESS
(ADR_COMPANY)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_ADR_NAME  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_ADR_NAME ON SBS1_ADMIN.ADDRESS
(ADR_NAME)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_ADR_PCODE  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_ADR_PCODE ON SBS1_ADMIN.ADDRESS
(ADR_ZIP)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_DGTIC_SEPID  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_DGTIC_SEPID ON SBS1_ADMIN.DGTICONSOL
(DGTIC_SEPID, DGTIC_ETID, DGTIC_ESID, DGTIC_CONSOLIDATION)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_ISC_SEPID  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_ISC_SEPID ON SBS1_ADMIN.ISCONSOL
(ISC_SEPID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_LONGID_ESID  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_LONGID_ESID ON SBS1_ADMIN.LONGID
(LONG_ESID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_LONGID_SHORTID  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_LONGID_SHORTID ON SBS1_ADMIN.LONGID
(LONG_SHORTID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_LONGM_ESID  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_LONGM_ESID ON SBS1_ADMIN.LONGIDMAP
(LONGM_ESID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_LONGM_SHORTID  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_LONGM_SHORTID ON SBS1_ADMIN.LONGIDMAP
(LONGM_SHORTID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_NBR_CONOPKEY  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_NBR_CONOPKEY ON SBS1_ADMIN.NUMBERRANGE
(NBR_CONOPKEY)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_OGTIC_SEPID  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_OGTIC_SEPID ON SBS1_ADMIN.OGTICONSOL
(OGTIC_SEPID, OGTIC_ETID, OGTIC_ESID, OGTIC_CONSOLIDATION)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_PMVT_PMVID  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_PMVT_PMVID ON SBS1_ADMIN.PRMODELVERTRANS
(PMVT_PMVID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_PMVT_PMVID_CLASS  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_PMVT_PMVID_CLASS ON SBS1_ADMIN.PRMODELVERTRANS
(PMVT_PMVID, PMVT_TRCLASS, PMVT_CLASSTYPE)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_REVASM_REVAHID  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_REVASM_REVAHID ON SBS1_ADMIN.REVA_SIGMASK
(REVASM_REVAHID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_ROC_SEPID  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_ROC_SEPID ON SBS1_ADMIN.ROCONSOLIDATION
(ROC_SEPID, ROC_ETID, ROC_ESID, ROC_CONSOLIDATION)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_SMSC_CONOPKEY  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_SMSC_CONOPKEY ON SBS1_ADMIN.SMSC
(SMSC_CONOPKEY)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_TRC_SEPID  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_TRC_SEPID ON SBS1_ADMIN.TRCONSOL
(TRC_SEPID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_CONST_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_CONST_CODE ON SBS1_ADMIN.CONSUBTYPE
(CONST_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_CST_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_CST_CODE ON SBS1_ADMIN.CSTYPE
(CST_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_NBR_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_NBR_CODE ON SBS1_ADMIN.NUMBERRANGE
(NBR_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_PMVDATE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_PMVDATE ON SBS1_ADMIN.PRMODELVER
(PMV_PMID, PMV_START, PMV_ESID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_SMSC_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_SMSC_CODE ON SBS1_ADMIN.SMSC
(SMSC_CODE)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_TAR_CODE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_TAR_CODE ON SBS1_ADMIN.TARIFF
(TAR_CODE)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_ADDRESS  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_ADDRESS ON SBS1_ADMIN.ADDRESS
(ADR_ID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_APP_OBJECT_GRANT  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_APP_OBJECT_GRANT ON SBS1_ADMIN.APP_OBJECT_GRANT
(OBJECT_NAME, GRANTEE, PERMISSION)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_CONSUBTYPE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_CONSUBTYPE ON SBS1_ADMIN.CONSUBTYPE
(CONST_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_CSTYPE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_CSTYPE ON SBS1_ADMIN.CSTYPE
(CST_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_DGTICONSOL  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_DGTICONSOL ON SBS1_ADMIN.DGTICONSOL
(DGTIC_ID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_ENPLAACTION  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_ENPLAACTION ON SBS1_ADMIN.ENPLAACTION
(ENPLAA_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_ISCONSOL  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_ISCONSOL ON SBS1_ADMIN.ISCONSOL
(ISC_ID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_LONGID  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_LONGID ON SBS1_ADMIN.LONGID
(LONG_ID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_LONGIDMAP  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_LONGIDMAP ON SBS1_ADMIN.LONGIDMAP
(LONGM_LONGID1)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_MAPPING  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_MAPPING ON SBS1_ADMIN.MAPPING
(MAP_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

-- Index PK_MMSPRICE is created automatically by Oracle with index organized table MMSPRICE.

-- Index PK_MMSRPRICE is created automatically by Oracle with index organized table MMSRPRICE.

--
-- PK_NOTIFICATIONTEMPL  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_NOTIFICATIONTEMPL ON SBS1_ADMIN.NOTIFICATIONTEMPL
(NOT_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_NOTPARAM  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_NOTPARAM ON SBS1_ADMIN.NOT_PARAM
(NOTP_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_NUMBERRANGE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_NUMBERRANGE ON SBS1_ADMIN.NUMBERRANGE
(NBR_ID)
TABLESPACE SBS1_BASE_DATA
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_OGTICONSOL  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_OGTICONSOL ON SBS1_ADMIN.OGTICONSOL
(OGTIC_ID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_PRMODEL  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_PRMODEL ON SBS1_ADMIN.PRMODEL
(PM_ID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_PRMODELVER  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_PRMODELVER ON SBS1_ADMIN.PRMODELVER
(PMV_ID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_PRMODELVERTRANS  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_PRMODELVERTRANS ON SBS1_ADMIN.PRMODELVERTRANS
(PMVT_ID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_PROXY  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_PROXY ON SBS1_ADMIN.PROXY
(PROXY_ID)
TABLESPACE SBS1_BASE_DATA
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_REVA_HEADER  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_REVA_HEADER ON SBS1_ADMIN.REVA_HEADER
(REVAH_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_REVA_SIGMASK  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_REVA_SIGMASK ON SBS1_ADMIN.REVA_SIGMASK
(REVASM_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_ROCONSOLIDATION  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_ROCONSOLIDATION ON SBS1_ADMIN.ROCONSOLIDATION
(ROC_ID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_SCRIPT  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_SCRIPT ON SBS1_ADMIN.SCRIPT
(SCR_ID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_SMSC  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_SMSC ON SBS1_ADMIN.SMSC
(SMSC_ID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_SRAS  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_SRAS ON SBS1_ADMIN.SRAS
(SRAS_ID)
TABLESPACE SBS1_BASE_DATA
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_TARIFF  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_TARIFF ON SBS1_ADMIN.TARIFF
(TAR_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_TARIFFUSAGE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_TARIFFUSAGE ON SBS1_ADMIN.TARIFFUSAGE
(TARUS_TARID, TARUS_CONTID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_TRCONSOL  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_TRCONSOL ON SBS1_ADMIN.TRCONSOL
(TRC_ID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_XPROC  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_XPROC ON SBS1_ADMIN.XPROC
(XPR_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_ZNZNU  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_ZNZNU ON SBS1_ADMIN.ZNZNU
(ZNZNU_ZNID, ZNZNU_ZNUID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- UIDX_REVAH_SRCTYPE_PACID_ESID  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.UIDX_REVAH_SRCTYPE_PACID_ESID ON SBS1_ADMIN.REVA_HEADER
(REVAH_ESID, REVAH_SRCTYPE, REVAH_PACID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PKG_COMMON  (Package) 
--
CREATE OR REPLACE PACKAGE SBS1_ADMIN.PKG_COMMON
  IS
--
--  Purpose: Common routines for SBS handlers and converters
--
--  MODIFICATION HISTORY (see Package Body)

-- Source Type
Type tSrcType Is Record (
    CCNDC             SrcType.Srct_Id%Type  := 'CCNDC',                         --013DA
    ISRV              SrcType.Srct_Id%Type  := 'ISRV',
    MBS               SrcType.Srct_Id%Type  := 'MBS',
    MCA_MM1           SrcType.Srct_Id%Type  := 'MCA_MM1',                       --013DA
    MCA_MM3           SrcType.Srct_Id%Type  := 'MCA_MM3',                       --013DA
    MCA_STI           SrcType.Srct_Id%Type  := 'MCA_STI',                       --013DA
    MCA_IMG           SrcType.Srct_Id%Type  := 'MCA_IMG',                       --013DA
    MCA_VID           SrcType.Srct_Id%Type  := 'MCA_VID',                       --013DA
    MCA_AUD           SrcType.Srct_Id%Type  := 'MCA_AUD',                       --013DA
    MCCMNC            SrcType.Srct_Id%Type  := 'MCCMNC',                        --013DA
    MMSB              SrcType.Srct_Id%Type  := 'MMSB',                          --011SO
    MMSC              SrcType.Srct_Id%Type  := 'MMSC',
    MSC               SrcType.Srct_Id%Type  := 'MSC',
    OPER              SrcType.Srct_Id%Type  := 'OPER',                          --013DA: OPER may be removed if checked
    OTA               SrcType.Srct_Id%Type  := 'OTA',
    POS               SrcType.Srct_Id%Type  := 'POS',
    SMSC              SrcType.Srct_Id%Type  := 'SMSC',
    STAN              SrcType.Srct_Id%Type  := 'STAN',                          --012SO
    VASP              SrcType.Srct_Id%Type  := 'VASP',
    M2M               SrcType.Srct_Id%Type  := 'M2M',                           --021SO
    SMSN              SrcType.Srct_Id%Type  := 'SMSN'                           --023SO
);


    EXCP_RDY_ERR_HEADER_FOUND       Exception;
    ENO_RDY_ERR_HEADER_FOUND        Number := 1001;
    EDESC_RDY_ERR_HEADER_FOUND      Varchar2(255) := 'A File with this name and creation date already processed earlier has Ready/Error state.';

    EXCP_RDY_ERR_MANY_RETRIES       Exception;
    ENO_RDY_ERR_MANY_RETRIES        Number := 1002;
    EDESC_RDY_ERR_MANY_RETRIES      Varchar2(255) := 'A File with this name had too many processing failures. Change the file or rename one header file name to try one more time with file from error directory.';

    EXCP_INCONVENIENT_TIME          Exception;
    ENO_INCONVENIENT_TIME           Number := 1003;
    EDESC_INCONVENIENT_TIME         Varchar2(255) := 'The desired operation cannot be executed at this time. Try later.';

    EXCP_RECCOUNT_MISMATCH          Exception;
    ENO_RECCOUNT_MISMATCH           Number := 1004;
    EDESC_RECCOUNT_MISMATCH         Varchar2(255) := 'The database detail record count does not match the record counter evaluated in the driver';

    EXCP_MISSING_HEADER_FLD         Exception;
    ENO_MISSING_HEADER_FLD          Number := 1005;
    EDESC_MISSING_HEADER_FLD        Varchar2(255) := 'Processing header field not found';

    RETURN_STATUS_FAILURE           Number := 0;
    RETURN_STATUS_OK                Number := 1;
    RETURN_STATUS_SUSPENDED         Number := 2;

procedure INSERT_WARNING                         --002AH
(    p_W_APPLIC      IN varchar2,
     p_W_PROCEDURE   IN varchar2,
     p_W_TOPIC       IN varchar2,
     p_W_MESSAGE     IN varchar2,
     p_W_BIHID       IN varchar2 DEFAULT NULL,
     p_W_BOHID       IN varchar2 DEFAULT NULL,
     p_W_BDID        IN varchar2 DEFAULT NULL,
     p_W_SHORTID     IN varchar2 DEFAULT NULL,
     p_W_USERERRCODE IN varchar2 DEFAULT NULL                                   --002SO
);

procedure SP_INSERT_WARNING(
    p_W_APPLIC      IN varchar2,
    p_W_PROCEDURE   IN varchar2,
    p_W_TOPIC       IN varchar2,
    p_W_MESSAGE     IN varchar2,
    p_W_BIHID       IN varchar2 DEFAULT NULL,
    p_W_BOHID       IN varchar2 DEFAULT NULL,
    p_W_BDID        IN varchar2 DEFAULT NULL,
    p_W_SHORTID     IN varchar2 DEFAULT NULL,
    p_W_USERERRCODE IN varchar2 DEFAULT NULL,                                   --002SO
    p_ErrorCode     OUT number,
    p_ErrorMsg      OUT varchar2,
    p_ReturnStatus  OUT number
);

procedure SP_ANALYZE_TABLES(
   p_PACT_ID            IN varchar2,
   p_BOH_ID             IN varchar2,
   p_RecordsAffected    OUT number,
   p_ErrorCode          OUT number,
   p_ErrorMsg           OUT varchar2,
   p_ReturnStatus       IN OUT number
);

procedure COMPILE_ALL;                      --003SO

Function SP_IS_NUMERIC (
  p_InputValue    In              Varchar2
) Return Number;

Function getHardErrorDesc
Return Varchar2;

Function CutFirstItem (
    p_ItemList          In Out  Varchar2,
    p_Separator         In      Varchar2,
    p_TrimItem          In      Boolean := True
) Return Varchar2;

Function getHeaderField (
    p_HeaderData        In      Varchar2,
    p_Token             In      Varchar2
) Return Varchar2;

Function getRequiredHeaderField (
    p_HeaderData        In      Varchar2,
    p_Token             In      Varchar2
) Return Varchar2;

Function isDoneInPeriod (
    p_PERIOD_ID     IN  varchar2,
    p_DATEDONE      IN  DATE
)
Return boolean; --009SO

Function isTimeForProcess (
    p_PERIOD_ID     IN  varchar2,
    p_STARTDAY      IN  integer,
    p_STARTHOUR     IN  integer,
    p_STARTMINUTE   IN  integer,
    p_ENDCLEARANCE  IN  integer,    --010SO
    p_DATEDONE      IN  DATE
)
Return boolean;

Procedure SP_DB_SLEEP(
   p_PAC_ID         IN varchar2,
   p_BOH_ID         IN OUT varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     OUT number
);  --013SO

  Procedure getDatesForPeriod(
    p_PERIOD_ID     IN  varchar2,
    p_period_start  OUT DATE,
    p_period_end    OUT DATE
);  --015SO
END; -- Package Specification PKG_COMMON
/


--
-- PKG_SCRIPT  (Package) 
--
CREATE OR REPLACE PACKAGE SBS1_ADMIN.PKG_SCRIPT
  IS

--
-- Purpose: Handle inserts and updates in script logging table SCRIPT
--          Used for Execute Immediate Statements in Partition Ageing
--          in Module PKG_PARTAG


FUNCTION CREATE_ENTRY(
    P_SCR_NAME IN VARCHAR2,
    P_SCR_LINE IN NUMBER,
    P_SCR_TEXT IN VARCHAR2,
    P_SCR_JOB IN VARCHAR2,
    P_SCR_BOHID IN VARCHAR2
    )
    RETURN  VARCHAR2
;

PROCEDURE UPDATE_ENTRY(
    P_SCR_ID IN VARCHAR2,
    P_SCR_BOHID IN VARCHAR2,
    P_SCR_ESID IN VARCHAR2,
    P_SCR_RESPONSE IN VARCHAR2
    )
;

FUNCTION CREATE_AND_EXECUTE(
    P_SCR_NAME IN VARCHAR2,
    P_SCR_LINE IN NUMBER,
    P_SCR_TEXT IN VARCHAR2,
    P_SCR_JOB IN VARCHAR2,
    P_SCR_BOHID IN VARCHAR2,
    P_SCR_ESID OUT VARCHAR2
    )
    RETURN  VARCHAR2
;

FUNCTION ENTRY_STATE(
    P_SCR_ID IN VARCHAR2
    )
    RETURN  VARCHAR2
;


  FUNCTION CREATE_AND_DELETE(
      P_SCR_NAME IN VARCHAR2,
      P_SCR_LINE IN NUMBER,  -- 0=do not execute 1...n=do execute
      P_SCR_TABLE IN VARCHAR2,
      P_SCR_WHERE IN VARCHAR2,
      P_SCR_JOB IN VARCHAR2,
      P_SCR_BOHID IN VARCHAR2,
      P_SCR_ESID OUT VARCHAR2
      )
      RETURN  VARCHAR2;

END; -- Package spec
/


--
-- PKG_COMMON  (Package Body) 
--
CREATE OR REPLACE PACKAGE BODY SBS1_ADMIN.PKG_COMMON
IS
--
--  Common to all SBS instances
--
--  MODIFICATION HISTORY
--  Person  Date        Comments
--  -----   ----------  ----------------------------------------------
--001SO     14.01.2010  Created as subset of PKG_BDETAIL_COMMON
--002SO     15.01.2010  Move error id to the end in insert warning
--003SO     15.01.2010  Rename SP_COMPILE_ALL to COMPILE_ALL
--004SO     25.01.2010  Add Error handling to COMPILE_ALL (in PKG_COMMON only)
--005SO     25.01.2010  Add Default Description for hard errors
--006SO     25.01.2010  Move CutFirstItem to PKG_COMMON
--007SO     25.01.2010  Move getHeaderField / getRequiredHeaderField to PKG_COMMON
--008SO     26.01.2010  Implement isTimeForProcess (mapping/packing)
--009SO     01.02.2010  Implement isDoneInPeriod
--010SO     01.02.2010  Implement clearance window for process execution (suspended seconds before period end)
--011SO     02.03.2010  Remove DLS stuff
--012SO     28.03.2010  Add Statistics workflow abort exception but move them to PKG_COMMON_PACKING later
--013SO     31.03.2010  Add SP_DB_SLEEP (moved from PKG_BDETAIL_COMMON)
--014SO     12.04.2010  Correct bug in isTimeForProcess
--015SO     13.04.2010  Implement getDatesForPeriod
--016SO     28.04.2010  Remove Oracle 11 option
--017SO     28.04.2010  Correct getDatesForPeriod
--018SO     04.05.2010  Go back to Oracle 11 option (revert --016SO)
--019SO     28.09.2010  Bugfix in packing scheduler
--020SO     04.05.2012  Limit Compile_all to code owner and current user
--021SO     01.10.2013  Add source type M2M
--022SO     15.04.2014  Support up to 16 KB records in CutFirstItem
--023SO     19.08.2015  Add source type SMSN (new OMN SMSC)
--024SO     21.07.2016  Replace DBA_OBJECTS with ALL_OBJECTS

    cstrTab                         Varchar2(1) := Chr(9);
    cstrCR                          Varchar2(1) := Chr(13);
    cstrLF                          Varchar2(1) := Chr(10);

    cstrMecDateTimeFormat           Varchar2(20) := 'YYYYMMDDHH24MISS';         --032SO
    cMaxTries                       Number := 3;                                -- Procedure SP_INSERT_BIHEADER_MEC (for same FileName and FileDate)



Procedure SP_DB_SLEEP(
   p_PAC_ID         IN varchar2,
   p_BOH_ID         IN OUT varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     OUT number
)
Is  --013SO
Begin

  Dbms_Lock.Sleep(10);

  RecordsAffected:=0;
  ErrorCode:=0;
  ErrorMsg:=null;
  Returnstatus := 1;

Return;
Exception
When Others then

  RecordsAffected:=0;
  ErrorCode := SqlCode;
  ErrorMsg  := SqlErrm;
  ReturnStatus := 0;

End SP_DB_SLEEP;


Procedure INSERT_WARNING(
     p_W_APPLIC      IN varchar2,
     p_W_PROCEDURE   IN varchar2,
     p_W_TOPIC       IN varchar2,
     p_W_MESSAGE     IN varchar2,
     p_W_BIHID       IN varchar2 DEFAULT NULL,
     p_W_BOHID       IN varchar2 DEFAULT NULL,
     p_W_BDID        IN varchar2 DEFAULT NULL,
     p_W_SHORTID     IN varchar2 DEFAULT NULL,
     p_W_USERERRCODE IN varchar2 DEFAULT NULL                                   --002SO
)
  IS

  PRAGMA AUTONOMOUS_TRANSACTION;

Begin

  Insert into Warning(
    W_ID,
    W_DATETIME,
    W_APPLIC,
    W_TOPIC,
    W_PROCEDURE,
    W_MESSAGE,
    W_ERRORTIME,
    W_BIHID,
    W_BOHID,
    W_BDID,
    W_SHORTID,
    W_ERRORCODE
  ) Values (
    GenerateUniqueKey('G'),
    SYSDATE,
    p_W_APPLIC,
    p_W_TOPIC,
    p_W_PROCEDURE,
    SUBSTR(p_W_MESSAGE,1,4000),
    SYSDATE,
    p_W_BIHID,
    p_W_BOHID,
    p_W_BDID,
    p_W_SHORTID,
    p_W_USERERRCODE
  );

  commit;

Exception
  When Others then
    null;
END INSERT_WARNING;


procedure SP_INSERT_WARNING(
    p_W_APPLIC      IN varchar2,
    p_W_PROCEDURE   IN varchar2,
    p_W_TOPIC       IN varchar2,
    p_W_MESSAGE     IN varchar2,
    p_W_BIHID       IN varchar2 DEFAULT NULL,
    p_W_BOHID       IN varchar2 DEFAULT NULL,
    p_W_BDID        IN varchar2 DEFAULT NULL,
    p_W_SHORTID     IN varchar2 DEFAULT NULL,
    p_W_USERERRCODE IN varchar2 DEFAULT NULL,                                   --002SO
    p_ErrorCode     OUT number,
    p_ErrorMsg      OUT varchar2,
    p_ReturnStatus  OUT number
)
IS
BEGIN

    INSERT_WARNING(
        p_W_APPLIC,
        p_W_PROCEDURE,
        p_W_TOPIC,
        p_W_MESSAGE,
        p_W_BIHID,
        p_W_BOHID,
        p_W_BDID,
        p_W_SHORTID,
        p_W_USERERRCODE                                                         --002SO
    );
    p_ErrorCode := NULL;
    p_ErrorMsg := NULL;
    p_ReturnStatus := RETURN_STATUS_OK;
    Return;

Exception
  When Others then
    p_ErrorCode := SQLCODE;
    p_ErrorMsg  := SQLERRM;
    p_ReturnStatus := RETURN_STATUS_FAILURE;
END;

procedure SP_ANALYZE_TABLES(
   p_PACT_ID            IN varchar2,
   p_BOH_ID             IN varchar2,
   p_RecordsAffected    OUT number,
   p_ErrorCode          OUT number,
   p_ErrorMsg           OUT varchar2,
   p_ReturnStatus       IN OUT number
)
IS
  CURSOR unpart_tables IS SELECT TABLE_NAME FROM USER_TABLES WHERE TABLESPACE_NAME Is Not NULL;
  CURSOR unpart_indexes IS SELECT INDEX_NAME FROM USER_INDEXES WHERE TABLESPACE_NAME Is Not NULL;
  v_cursor  INTEGER;
  v_ddl   VARCHAR2(32000);
  v_dummy   INTEGER;
  v_success INTEGER;
  v_retries INTEGER;
BEGIN

  p_RecordsAffected := 0;
  p_ErrorCode := 0;
  p_ReturnStatus := RETURN_STATUS_OK;

  v_success := 0;
  v_retries := 3;

  FOR i IN unpart_tables
  LOOP
    v_success := 0;
    v_retries := 3;
    LOOP
      BEGIN
        v_ddl := 'ANALYZE TABLE ' || i.table_name || ' ESTIMATE STATISTICS SAMPLE 5000000 ROWS ';
        v_cursor := dbms_sql.open_cursor;
        dbms_sql.parse(v_cursor,v_ddl,dbms_sql.native);
        v_dummy := dbms_sql.execute(v_cursor);
        dbms_sql.close_cursor(v_cursor);
        v_success := 1;
        p_RecordsAffected := p_RecordsAffected + 1;
      EXCEPTION
        WHEN OTHERS THEN
          dbms_sql.close_cursor(v_cursor);
        sys.dbms_lock.sleep(10);
      END;
      EXIT WHEN v_success = 1;
      v_retries := v_retries -1;
      EXIT WHEN v_retries = 0;
    END LOOP;
    IF v_success = 0 then
      p_ErrorCode := 10012;
      p_ReturnStatus := RETURN_STATUS_FAILURE;
    END IF;
  END LOOP;


  FOR i IN unpart_indexes
  LOOP
    v_success := 0;
    v_retries := 3;
    LOOP
      BEGIN
        v_ddl := 'ANALYZE INDEX ' || i.index_name ||  ' COMPUTE STATISTICS ';
        v_cursor := dbms_sql.open_cursor;
        dbms_sql.parse(v_cursor,v_ddl,dbms_sql.native);
        v_dummy := dbms_sql.execute(v_cursor);
        dbms_sql.close_cursor(v_cursor);
        v_success := 1;
        p_RecordsAffected := p_RecordsAffected + 1;
      EXCEPTION
        WHEN OTHERS THEN
          dbms_sql.close_cursor(v_cursor);
        sys.dbms_lock.sleep(10);
      END;
      EXIT WHEN v_success = 1;
      v_retries := v_retries -1;
      EXIT WHEN v_retries = 0;
    END LOOP;
    IF v_success = 0 then
      p_ErrorCode := 10012;
      p_ReturnStatus := RETURN_STATUS_FAILURE;
    END IF;
  END LOOP;

  Return;

Exception
  When Others then
    p_ErrorCode := SQLCODE;
    p_ErrorMsg  := SQLERRM;
    p_ReturnStatus := RETURN_STATUS_FAILURE;

END SP_ANALYZE_TABLES;

procedure COMPILE_ALL
IS  --003SO
  CURSOR invalid_objects(code_owner VARCHAR2) IS
    SELECT decode (OBJECT_TYPE,
      'PACKAGE BODY', 'alter package ' || OWNER ||'.'||OBJECT_NAME || ' compile body',
                      'alter ' || OBJECT_TYPE || ' ' || OWNER||'.'||OBJECT_NAME || ' compile'
      ) compile_sql
    FROM   ALL_OBJECTS A, ORDER_OBJECT_BY_DEPENDENCY B
    WHERE  A.OBJECT_ID = B.OBJECT_ID (+)
    AND    A.STATUS = 'INVALID'
    AND    A.OWNER IN (code_owner,user)
    -- AND    A.object_name not like 'SIS_SUBSCRIBER%'
    -- AND    A.object_name not like 'SIS_MSISDN%'
    AND    A.OBJECT_TYPE in ('PACKAGE BODY','PACKAGE','FUNCTION','PROCEDURE','TRIGGER','VIEW')
    ORDER by B.DLEVEL desc, A.OBJECT_TYPE, A.OBJECT_NAME;                       --024SO
    --020SO

    v_ddl           VARCHAR2(4000);
    v_code_owner    Varchar2(32);

BEGIN

  SELECT OWNER INTO v_code_owner
  FROM ALL_OBJECTS
  WHERE OBJECT_NAME = 'PKG_COMMON'
  AND OBJECT_TYPE = 'PACKAGE BODY'
  ;

  FOR io_row IN invalid_objects(v_code_owner)
  LOOP
    BEGIN
        v_ddl := io_row.compile_sql;
        EXECUTE IMMEDIATE v_ddl ;
    EXCEPTION
      WHEN OTHERS THEN
        Insert_Warning(
                'PKG_COMMON',
                 'COMPILE_ALL',
                  'CANNOT EXECUTE',
                   '(ORA' || to_char(SqlCode) ||')  **** ' || v_ddl
        );
        sys.dbms_lock.sleep(10);
    END;
  END LOOP;

  Return;

Exception
    WHEN others then
        Insert_Warning(
                'PKG_COMMON',
                 'COMPILE_ALL',
                  'CANNOT QUERY INVALID_OBJECTS',
                   SqlErrM
        );  --004SO
END COMPILE_ALL;


Function SP_IS_NUMERIC (
    p_InputValue    In              Varchar2
)
Return Number
Is
    l_Dummy         Number;
Begin
    If (p_InputValue Is Not Null) Then
        l_Dummy := To_Number(p_InputValue);     -- will raise an exception if non-numeric
        Return 1;       -- it is a number
    Else
        Return 0;       --007AA return 0 if null value
    End If;
Exception
When Others Then
    Return 0;           -- it is not a number  --002SO
End SP_IS_NUMERIC;

Function getHardErrorDesc
Return Varchar2
IS  --005SO
    l_error_code        Number;
    l_error_desc        VARCHAR2(32000);
    l_show_stack        boolean := true;
BEGIN
    l_error_code := SqlCode;
    if l_error_code = -14400 then
        l_error_desc := 'ORA' || to_char(l_error_code) || ' NO_PARTITION';
    elsif l_show_stack then
        l_error_desc := DBMS_UTILITY.format_error_backtrace;                    --018SO--016SO
    else
        l_error_desc  := SqlErrM;
    end if;
    Return l_error_desc;
Exception
    When others then
        Return 'CANNOT RESOLVE ERROR MESSAGE';
END;

Function CutFirstItem (
    p_ItemList          In Out  Varchar2,
    p_Separator         In      Varchar2,
    p_TrimItem          In      Boolean := True
) Return Varchar2
Is  --006SO
    l_RetVal            Varchar2(16000);    --022SO
    l_Pos               Integer;
Begin

    l_Pos := InStr(p_ItemList, p_Separator);

    If (l_Pos > 0) Then
        If p_TrimItem Then
            l_RetVal := RTrim(SubStr(p_ItemList, 1, l_Pos - 1));
        Else
            l_RetVal := SubStr(p_ItemList, 1, l_Pos - 1);
        End If;
        If Length(p_ItemList) > l_Pos Then
            p_ItemList := RTrim(SubStr(p_ItemList, l_Pos + Length(p_Separator)));
        Else
            p_ItemList := '';                                               -- List ends with separator
        End If;
    Else
        If p_TrimItem Then
            l_RetVal := RTrim(p_ItemList);
        Else
            l_RetVal := p_ItemList;
        End If;
        p_ItemList := '';
    End If;

    Return l_RetVal;

End CutFirstItem;

Function getHeaderField (
    p_HeaderData        In      Varchar2,
    p_Token             In      Varchar2
) Return Varchar2
Is  --007SO
    l_RetVal            Varchar2(100);
    l_Pos               Integer;
    l_HeaderData        Varchar2(4000);
    l_HeaderLine        Varchar2(4000);
Begin
    l_RetVal := NULL;
    l_HeaderData := p_HeaderData;
    loop
        l_HeaderLine := PKG_COMMON.CutFirstItem(l_HeaderData, '<br>', True);
        if l_HeaderLine LIKE p_Token || cstrTab || '%' then
            l_RetVal := SUBSTR(l_HeaderLine,LENGTH(p_Token) + 2);
            EXIT;
        end if;
        EXIT WHEN l_HeaderData is NULL;
    end loop;
    Return l_RetVal;

End getHeaderField;

Function getRequiredHeaderField (
    p_HeaderData        In      Varchar2,
    p_Token             In      Varchar2
) Return Varchar2
Is  --007SO
    l_RetVal            Varchar2(100);
Begin
    l_RetVal := getHeaderField(p_HeaderData,p_Token);

    if l_RetVal is NULL then
        RAISE EXCP_MISSING_HEADER_FLD;
    end if;
    Return l_RetVal;

End getRequiredHeaderField;

Procedure getDatesForPeriod(
    p_PERIOD_ID     IN  varchar2,
    p_period_start  OUT DATE,
    p_period_end    OUT DATE
)
IS  --015SO
begin
    if NVL(p_PERIOD_ID,'NONE') <> 'NONE' then
        p_period_end := sysdate;       -- modified below                        --017SO
        if p_PERIOD_ID = 'YEARLY' then
            p_period_end := trunc(p_period_end,'YEAR');                         --017SO
            p_period_start := add_months(p_period_end,-12);                     --017SO
        elsif p_PERIOD_ID = 'MONTHLY' then
            p_period_end := trunc(p_period_end,'MONTH');                        --017SO
            p_period_start := add_months(p_period_end,-1);                      --017SO
        elsif p_PERIOD_ID = 'WEEKLY' then
            p_period_end := trunc(p_period_end,'day');                          --017SO
            p_period_start := p_period_end - 7;                                 --017SO
        elsif p_PERIOD_ID = 'DAILY' then
            p_period_end := trunc(p_period_end);                                --017SO
            p_period_start := p_period_end - 1;                                 --017SO
        elsif p_PERIOD_ID = 'HOURLY' then
            p_period_end := trunc(p_period_end,'HH24');                         --017SO
            p_period_start := p_period_end - 1/24;                              --017SO
        end if;
    end if;
end;

Function isTimeForProcess
(
    p_PERIOD_ID     IN  varchar2,
    p_STARTDAY      IN  integer,
    p_STARTHOUR     IN  integer,
    p_STARTMINUTE   IN  integer,
    p_ENDCLEARANCE  IN  integer,    --010SO
    p_DATEDONE      IN  DATE
)
Return boolean
is  --008SO
    bGo                 boolean;
    l_period_start      date;       --010SO
    l_period_end        date;       --010SO
    l_last_date         date;
    l_scheduled_date    date;
BEGIN
    bGo := true;

    -- Check if this is a convenient time for processing according to the schedule
    if NVL(p_PERIOD_ID,'NONE') <> 'NONE' then
        l_last_date := NVL(p_DATEDONE,sysdate-400);                             -- more than one year back
        l_period_start := sysdate;                                              -- modified below
        if p_PERIOD_ID = 'YEARLY' then
            l_period_start := trunc(l_period_start,'YEAR');                     --010SO
            l_period_end := add_months(l_period_start,12);                      --010SO
            l_scheduled_date := l_period_start + NVL(p_STARTDAY,1) -1 + NVL(p_STARTHOUR,0)/24 + NVL(p_STARTMINUTE,0)/24/60;
        elsif p_PERIOD_ID = 'MONTHLY' then
            l_period_start := trunc(l_period_start,'MONTH');                    --010SO
            l_period_end := add_months(l_period_start,1);                       --010SO
            l_scheduled_date := l_period_start + NVL(p_STARTDAY,1) -1 + NVL(p_STARTHOUR,0)/24 + NVL(p_STARTMINUTE,0)/24/60;
        elsif p_PERIOD_ID = 'WEEKLY' then
            l_period_start := trunc(l_period_start,'day');                      --010SO
            l_period_end := l_period_start + 7;                                 --010SO
            l_scheduled_date := l_period_start + NVL(p_STARTDAY,1) -1 + NVL(p_STARTHOUR,0)/24 + NVL(p_STARTMINUTE,0)/24/60;
        elsif p_PERIOD_ID = 'DAILY' then
            l_period_start := trunc(l_period_start);                            --010SO
            l_period_end := l_period_start + 1;                                 --010SO
            l_scheduled_date := trunc(sysdate) + NVL(p_STARTHOUR,0)/24 + NVL(p_STARTMINUTE,0)/24/60;
        elsif p_PERIOD_ID = 'HOURLY' then
            l_period_start := trunc(l_period_start,'HH24');                     --010SO
            l_period_end := l_period_start + 1/24;                              --010SO
            l_scheduled_date := trunc(sysdate,'HH24') + NVL(p_STARTMINUTE,0)/24/60;
        end if;
        bGo := (l_last_date < l_period_start) and  (sysdate >= l_scheduled_date) and (sysdate < l_period_end - NVL(p_ENDCLEARANCE,0)/24/3600);  --019SO was l_scheduled_date --014SO  --010SO
    end if;

    Return bGo;

END;

Function isDoneInPeriod
(
    p_PERIOD_ID     IN  varchar2,
    p_DATEDONE      IN  DATE
)
Return boolean
is  --009SO
    bDone               boolean;
    l_last_date         date;
    l_scheduled_date    date;
BEGIN
    bDone := false;

    if NVL(p_PERIOD_ID,'NONE') <> 'NONE' then
        -- Check if this processing was alredy done in the current period
        l_last_date := NVL(p_DATEDONE,sysdate-400);     -- more than one year back
        if p_PERIOD_ID = 'YEARLY' then
            l_scheduled_date := trunc(sysdate,'YEAR');
        elsif p_PERIOD_ID = 'MONTHLY' then
            l_scheduled_date := trunc(sysdate,'MONTH');
        elsif p_PERIOD_ID = 'WEEKLY' then
            l_scheduled_date := trunc(sysdate,'day');
        elsif p_PERIOD_ID = 'DAILY' then
            l_scheduled_date := trunc(sysdate);
        elsif p_PERIOD_ID = 'HOURLY' then
            l_scheduled_date := trunc(sysdate,'HH24');
        end if;
        bDone := (l_last_date >= l_scheduled_date);
    end if;

    Return bDone;

END;



END; -- Package Body PKG_COMMON
/


--
-- PKG_SCRIPT  (Package Body) 
--
CREATE OR REPLACE PACKAGE BODY SBS1_ADMIN.PKG_SCRIPT
IS
--
-- Purpose: Used for the management of daily partitions and data ageing
--          Execute Immediate Statements in Partition Ageing and Cleanup
--          Log attempts and results to the SCRIPT table with the help of
--          PKG_SCRIPT
--
--MODIFICATION HISTORY
--Code  Date        Comments
------- ----------  ------------------------------------------
--001SO 09.11.2005  Package creation
--002SO 29.11.2016  Use dynsql DBA package for immediate sql execution
--003SO 29.11.2016  Add CREATE_AND_DELETE method calling dynsql.delete

FUNCTION CREATE_ENTRY(
    P_SCR_NAME IN VARCHAR2,
    P_SCR_LINE IN NUMBER,
    P_SCR_TEXT IN VARCHAR2,
    P_SCR_JOB IN VARCHAR2,
    P_SCR_BOHID IN VARCHAR2
    )
    RETURN  VARCHAR2
IS

    PRAGMA AUTONOMOUS_TRANSACTION;

    id  varchar2(10);

BEGIN
    id := GenerateUniqueKey('G');
    INSERT INTO SCRIPT (
    SCR_ID,
    SCR_NAME,
    SCR_LINE,
    SCR_TEXT,
    SCR_JOB,
    SCR_DATETIME,
    SCR_BOHID,
    SCR_ESID
    ) VALUES (
    id,
    P_SCR_NAME,
    P_SCR_LINE,
    P_SCR_TEXT,
    P_SCR_JOB,
    sysdate,
    P_SCR_BOHID,
    'W'
    );
    COMMIT;
    RETURN id;

EXCEPTION
    WHEN others THEN
        ROLLBACK;
        RETURN NULL;
END;

PROCEDURE UPDATE_ENTRY(
    P_SCR_ID IN VARCHAR2,
    P_SCR_BOHID IN VARCHAR2,
    P_SCR_ESID IN VARCHAR2,
    P_SCR_RESPONSE IN VARCHAR2
    )
IS
    PRAGMA AUTONOMOUS_TRANSACTION;

BEGIN

    UPDATE SCRIPT SET
        SCR_BOHID = NVL(P_SCR_BOHID,SCR_BOHID),
        SCR_ESID = P_SCR_ESID,
        SCR_DATEEND = sysdate,
        SCR_RESPONSE = NVL(P_SCR_RESPONSE,SCR_RESPONSE)
    WHERE
        SCR_ID = P_SCR_ID
    ;
    COMMIT;

EXCEPTION
    WHEN others THEN
        ROLLBACK;
END;


FUNCTION CREATE_AND_EXECUTE(
    P_SCR_NAME IN VARCHAR2,
    P_SCR_LINE IN NUMBER,  -- 0=do not execute 1...n=do execute
    P_SCR_TEXT IN VARCHAR2,
    P_SCR_JOB IN VARCHAR2,
    P_SCR_BOHID IN VARCHAR2,
    P_SCR_ESID OUT VARCHAR2
    )
    RETURN  VARCHAR2
IS
    id  varchar2(10);
BEGIN
    id := CREATE_ENTRY(P_SCR_NAME, P_SCR_LINE, P_SCR_TEXT, P_SCR_JOB, P_SCR_BOHID);
    BEGIN
        if P_SCR_LINE > 0 then
            -- only execute if line is not 0
            dynsql.exec(P_SCR_TEXT);    --002SO EXECUTE IMMEDIATE P_SCR_TEXT;
            P_SCR_ESID := 'OK';
            UPDATE_ENTRY(id, P_SCR_BOHID, P_SCR_ESID, NULL);
        else
            P_SCR_ESID := 'OK';
        end if;
EXCEPTION
    WHEN others THEN
        ROLLBACK;
        P_SCR_ESID := 'E';
        UPDATE_ENTRY(id, P_SCR_BOHID, P_SCR_ESID, SqlErrm);
    END;
    RETURN id;
END;

FUNCTION CREATE_AND_DELETE(
    P_SCR_NAME IN VARCHAR2,
    P_SCR_LINE IN NUMBER,  -- 0=do not execute 1...n=do execute
    P_SCR_TABLE IN VARCHAR2,
    P_SCR_WHERE IN VARCHAR2,
    P_SCR_JOB IN VARCHAR2,
    P_SCR_BOHID IN VARCHAR2,
    P_SCR_ESID OUT VARCHAR2
    )
    RETURN  VARCHAR2
IS  --003SO
    id          varchar2(10);
    cmd         varchar2(2000);
    deleted     NUMBER;
BEGIN
    deleted := 0;
    cmd := 'DELETE FROM ' || P_SCR_TABLE || ' WHERE ' || P_SCR_WHERE;
    id := CREATE_ENTRY(P_SCR_NAME, P_SCR_LINE, cmd, P_SCR_JOB, P_SCR_BOHID);
    BEGIN
        if P_SCR_LINE > 0 then
            -- only execute if line is not 0
            dynsql.delete(P_SCR_TABLE, P_SCR_WHERE, deleted);
            P_SCR_ESID := 'OK';
            UPDATE_ENTRY(id, P_SCR_BOHID, P_SCR_ESID, to_char(deleted));
        else
            P_SCR_ESID := 'OK';
        end if;
EXCEPTION
    WHEN others THEN
        ROLLBACK;
        P_SCR_ESID := 'E';
        UPDATE_ENTRY(id, P_SCR_BOHID, P_SCR_ESID, SqlErrm);
    END;
    RETURN id;
END;

FUNCTION ENTRY_STATE(
    P_SCR_ID IN VARCHAR2
    )
    RETURN  VARCHAR2
IS
    st  VARCHAR2(10);
BEGIN

    select SCR_ESID into st
    from SCRIPT
    where SCR_ID = P_SCR_ID;

    RETURN st;

END
;
END;
/


--
-- APP_MERGE_APP_GRANTS  (Procedure) 
--
CREATE OR REPLACE PROCEDURE SBS1_ADMIN.APP_MERGE_APP_GRANTS (
    P_GRANTEE       IN  VARCHAR2
)
   IS

-- Merge all application object grants with the existing ones in table APP_OBJECT_GRANT

-- APP_OBJECTS  :  view of potential useful objects for access by non schema owners

-- MODIFICATION HISTORY
-- ---------    ------      -------------------------------------------
-- Person       Date        Comments
-- 001SO        08.03.2012  Created
-- 002SO        09.03.2012  Use SELECT on Sequences

BEGIN


INSERT INTO APP_OBJECT_GRANT (
    OBJECT_NAME,
    GRANTEE,
    PERMISSION,
    OBJECT_TYPE
)
SELECT
    APP_OBJECT.OBJECT_NAME,
    P_GRANTEE,
    APP_PERMISSION.APP_PERM_ID,
    APP_OBJECT.OBJECT_TYPE
FROM
    APP_OBJECT,
    APP_PERMISSION
WHERE
    (
        APP_PERM_ID ='EXECUTE' AND APP_OBJECT.OBJECT_TYPE in ('PROCEDURE','FUNCTION','PACKAGE')
    OR  APP_PERM_ID IN ('SELECT','INSERT','UPDATE','DELETE') AND APP_OBJECT.OBJECT_TYPE in ('TABLE')
    OR  APP_PERM_ID IN ('SELECT') AND APP_OBJECT.OBJECT_TYPE in ('VIEW','MATERIALIZED VIEW', 'SEQUENCE')
    OR  APP_PERM_ID IN ('ENQUEUE','DEQUEUE') AND APP_OBJECT.OBJECT_TYPE in ('QUEUE')
    OR  APP_PERM_ID IN ('USE') AND APP_OBJECT.OBJECT_TYPE in ('SYNONYM')
    )
    AND not exists
        (
            SELECT ROWID
            FROM APP_OBJECT_GRANT
            WHERE OBJECT_NAME = APP_OBJECT.OBJECT_NAME
            AND GRANTEE = P_GRANTEE
            AND PERMISSION = APP_PERM_ID
        )
    AND (APP_OBJECT.OBJECT_TYPE <> 'TABLE' OR not exists
            (
                SELECT AO2.OBJECT_NAME
                FROM APP_OBJECT AO2
                WHERE AO2.OBJECT_NAME=APP_OBJECT.OBJECT_NAME
                AND  AO2.OBJECT_TYPE = 'MATERIALIZED VIEW'
            )
        )
    AND APP_OBJECT.OBJECT_NAME NOT IN (
        SELECT OBJECT_NAME || '_' || SUBOBJECT_NAME
        FROM ALL_OBJECTS
        WHERE OWNER = user
        AND OBJECT_TYPE IN ('TABLE PARTITION')
        )
GROUP BY
    APP_OBJECT.OBJECT_NAME,
    APP_PERMISSION.APP_PERM_ID,
    APP_OBJECT.OBJECT_TYPE
;



COMMIT WORK;

END; -- Procedure
/


--
-- APP_MERGE_TOKEN_GRANTS  (Procedure) 
--
CREATE OR REPLACE PROCEDURE SBS1_ADMIN.APP_MERGE_TOKEN_GRANTS (
    P_GRANTEE       IN  VARCHAR2
)
   IS

-- Merge needed object grants with the existing ones in table APP_OBJECT_GRANT

-- APP_OBJECTS  :  view of potential useful objects for access by non schema owners
-- APP_TOKEN    :  staging table for found tokens in source code (some matching the ones in USER_OBJECTS)

-- MODIFICATION HISTORY
-- ---------    ------      -------------------------------------------
-- Person       Date        Comments
-- SO           01.03.2012  Created
-- 001SO        08.03.2012  Use baic filtering in view APP_OBJECTS
-- 002SO        09.03.2012  Use SELECT on Sequences

BEGIN

UPDATE APP_TOKEN SET TOKEN = UPPER(TOKEN);


INSERT INTO APP_OBJECT_GRANT (
    OBJECT_NAME,
    GRANTEE,
    PERMISSION,
    OBJECT_TYPE
)
SELECT
    APP_TOKEN.TOKEN,
    P_GRANTEE,
    APP_PERMISSION.APP_PERM_ID,
    APP_OBJECT.OBJECT_TYPE
FROM
    APP_OBJECT,
    APP_TOKEN,
    APP_PERMISSION
WHERE
        APP_OBJECT.OBJECT_NAME = APP_TOKEN.TOKEN
    AND (
        APP_PERM_ID IN ('EXECUTE') AND APP_OBJECT.OBJECT_TYPE in ('PROCEDURE','FUNCTION','PACKAGE')
    OR  APP_PERM_ID IN ('SELECT','INSERT','UPDATE','DELETE') AND APP_OBJECT.OBJECT_TYPE in ('TABLE')
    OR  APP_PERM_ID IN ('SELECT') AND APP_OBJECT.OBJECT_TYPE in ('VIEW','MATERIALIZED VIEW', 'SEQUENCE')
    OR  APP_PERM_ID IN ('ENQUEUE','DEQUEUE') AND APP_OBJECT.OBJECT_TYPE in ('QUEUE')
    OR  APP_PERM_ID IN ('USE') AND APP_OBJECT.OBJECT_TYPE in ('SYNONYM')
   )
    AND not exists
        (
            SELECT ROWID
            FROM APP_OBJECT_GRANT
            WHERE OBJECT_NAME = APP_TOKEN.TOKEN
            AND GRANTEE = P_GRANTEE
            AND PERMISSION = APP_PERM_ID
        )
    AND (APP_OBJECT.OBJECT_TYPE <> 'TABLE' OR not exists
            (
                SELECT AO2.OBJECT_NAME
                FROM APP_OBJECT AO2
                WHERE AO2.OBJECT_NAME=APP_TOKEN.TOKEN
                AND  AO2.OBJECT_TYPE = 'MATERIALIZED VIEW'
            )
        )
GROUP BY
    APP_TOKEN.TOKEN,
    APP_PERMISSION.APP_PERM_ID,
    APP_OBJECT.OBJECT_TYPE
;

COMMIT WORK;

END; -- Procedure
 
/


--
-- CLEANUP_DELETE  (Procedure) 
--
CREATE OR REPLACE PROCEDURE SBS1_ADMIN.CLEANUP_DELETE (
    pInTableName    IN  VARCHAR2,
    pInWhereClause  IN  VARCHAR2,
    pInBOH_ID       IN  VARCHAR2,
    pOutDeleted     OUT NUMBER
) IS
    v_script_id     VARCHAR2(10);
    v_script_state  VARCHAR2(10);
BEGIN
    v_script_id := PKG_SCRIPT.CREATE_AND_DELETE(
        'CLEANUP_DELETE',1,pInTableName,
        pInWhereClause,NULL,pInBOH_ID,
        v_script_state);
    if v_script_state = 'OK' then
        pOutDeleted := 1;       -- for true
    else
        -- do an error logging
        PKG_COMMON.INSERT_WARNING(
              'ANONYMOUS',
              'CLEANUP_DELETE',
              pInTableName,
              'See SCRIPT ID = ' || v_script_id,
              NULL,
              pInBOH_ID
            );
        pOutDeleted := 0;       -- for false
    end if;
END;
/


--
-- GPSH_PRICE_MODEL_PUT  (Procedure) 
--
CREATE OR REPLACE PROCEDURE SBS1_ADMIN.GPSH_PRICE_MODEL_PUT(
    P_PM_ID IN VARCHAR2,
    P_PM_JSON IN VARCHAR2)
-- MODIFICATION HISTORY
-- ---------    ------      -------------------------------------------
-- Person       Date        Comments
-- SS           25.07.16    Created

IS
    NAME      VARCHAR2(50);
    COMMENT   VARCHAR2(4000);
    T_PM_ID   VARCHAR2(20);
BEGIN
    SELECT PM_NAME, PM_COMMENT
    INTO NAME, COMMENT
    FROM JSON_TABLE(P_PM_JSON, '$' COLUMNS(
        PM_NAME PATH '$.NAME',
        PM_COMMENT PATH '$.COMMENT'));

    SELECT PM_ID INTO T_PM_ID FROM PRMODEL RIGHT JOIN DUAL ON PM_ID = P_PM_ID;
    IF T_PM_ID IS NULL THEN
        INSERT INTO PRMODEL (PM_ID, PM_PMSID, PM_NAME, PM_SRCTYPE, PM_COMMENT, PM_DATECRE)
            VALUES (P_PM_ID, 'A', NAME, 'MBS', COMMENT, SYSDATE);
    ELSE
        UPDATE PRMODEL SET
            PM_PMSID = 'A',
            PM_NAME = NAME,
            PM_COMMENT = COMMENT,
            PM_DATEMOD = SYSDATE
        WHERE PM_ID = P_PM_ID;
    END IF;
END;
/


--
-- GPSH_PRICE_TRANSPORT_PUT  (Procedure) 
--
CREATE OR REPLACE PROCEDURE SBS1_ADMIN.GPSH_PRICE_TRANSPORT_PUT(
    P_PMVT_PMVID IN VARCHAR2,
    P_PMVT_JSON IN VARCHAR2)

-- MODIFICATION HISTORY
-- ---------    ------      -------------------------------------------
-- Person       Date        Comments
-- SS           25.07.16    Created
-- SS001        17.04.17    checking if the pmv_id exists if not integrity constraint error occurs
-- SS002        05.05.17    Deleting and inserting if the rows and size of the list dont match

IS
    PM_TRANS_COUNT NUMBER;
    PMV_COUNT NUMBER;

    CURSOR TRANS_CUR (TRANS_JSON_IN IN VARCHAR2)
        IS SELECT *
            FROM JSON_TABLE(TRANS_JSON_IN, '$[*]'
                COLUMNS(CLASS PATH '$.CLASS', MEDIUM PATH '$.MEDIUM', PRICEMO PATH '$.PRICEMO', PRICEMT PATH '$.PRICEMT', REMARK PATH '$.REMARK'));
BEGIN

     SELECT COUNT(*) INTO PMV_COUNT FROM PRMODELVER WHERE PMV_ID = P_PMVT_PMVID;

     IF PMV_COUNT = 1 THEN  --checking if the pmv_id exists if not integrity constraint error occurs

        SELECT COUNT(*) INTO PM_TRANS_COUNT FROM (
             SELECT ROW_COUNT FROM (
                 SELECT COUNT(*) AS ROW_COUNT FROM PRMODELVERTRANS WHERE PMVT_PMVID = P_PMVT_PMVID) A
             INNER JOIN
                 (SELECT COUNT(*) AS JROW_COUNT FROM JSON_TABLE(P_PMVT_JSON, '$[*]' COLUMNS (CLASS PATH '$.CLASS'))) B
             ON ROW_COUNT = JROW_COUNT);

        IF PM_TRANS_COUNT <> 0 THEN
            SELECT COUNT(*) INTO PM_TRANS_COUNT FROM (
                   SELECT COUNT(*) AS ROW_COUNT FROM PRMODELVERTRANS A INNER JOIN (select * from JSON_TABLE
                    (P_PMVT_JSON , '$[*]' COLUMNS (CLASS PATH '$.CLASS', MEDIUM PATH '$.MEDIUM', PRICEMO PATH '$.PRICEMO',
                                                   PRICEMT PATH '$.PRICEMT', REMARK PATH '$.REMARK'))) B
                    ON A.PMVT_PMVID = P_PMVT_PMVID
                    AND A.PMVT_TRCLASS = B.CLASS
                    AND A.PMVT_CLASSTYPE = B.MEDIUM
                    AND A.PMVT_AMOUNTMO = B.PRICEMO
                    AND A.PMVT_AMOUNTMT = B.PRICEMT
                    AND NVL(A.PMVT_COMMENT, 'NA') = NVL(B.REMARK, 'NA')
            )
            where ROW_COUNT = (select count(*) from JSON_TABLE(P_PMVT_JSON, '$[*]'
                COLUMNS (CLASS PATH '$.CLASS')));
        END IF;

        IF PM_TRANS_COUNT = 0 THEN
            DELETE FROM PRMODELVERTRANS WHERE PMVT_PMVID = P_PMVT_PMVID;
            FOR CUR IN TRANS_CUR(P_PMVT_JSON)
            LOOP
                INSERT INTO PRMODELVERTRANS (PMVT_ID, PMVT_PMVID, PMVT_TRCLASS, PMVT_CLASSTYPE, PMVT_AMOUNTMO, PMVT_AMOUNTMT, PMVT_COMMENT)
                VALUES (GENERATEUNIQUEKEY('G'), P_PMVT_PMVID, CUR.CLASS, CUR.MEDIUM, CUR.PRICEMO, CUR.PRICEMT, CUR.REMARK);
            END LOOP;
        END IF;
    END IF;
END;
/


--
-- GPSH_PRICE_VERSION_DEL  (Procedure) 
--
CREATE OR REPLACE PROCEDURE SBS1_ADMIN.gpsh_price_version_del(
      P_PMV_ID IN VARCHAR2
)
   IS
-- MODIFICATION HISTORY
-- ---------    ------      -------------------------------------------
-- Person       Date        Comments
-- SS           26.07.2016  Created

BEGIN

    UPDATE PRMODELVER SET PMV_ESID = 'D', PMV_DATEMOD = SYSDATE
    WHERE PMV_ID = P_PMV_ID;

END; -- Procedure
/


--
-- GPSH_PRICE_VERSION_PUT  (Procedure) 
--
CREATE OR REPLACE PROCEDURE SBS1_ADMIN.GPSH_PRICE_VERSION_PUT(
    P_PMV_PMID IN VARCHAR2,
    P_PMV_ID IN VARCHAR2,
    P_PMV_JSON IN VARCHAR2)

-- MODIFICATION HISTORY
-- ---------    ------      -------------------------------------------
-- Person       Date        Comments
-- SS           25.07.2016  Created
-- SO001        16.02.2017  Defaul NULL end Date to 01.01.2100
-- SS002        17.04.17    checking if the pm_id exists if not integrity constraint error occurs

IS
    NAME      VARCHAR2(50);
    COMMENT   VARCHAR2(4000);
    STARTDATE VARCHAR2(50);
    ENDDATE   VARCHAR2(50);
    T_PMV_ID  VARCHAR2(20);
    PM_COUNT NUMBER;
BEGIN

    SELECT COUNT(*) INTO PM_COUNT FROM PRMODEL WHERE PM_ID = P_PMV_PMID;

    IF PM_COUNT = 1 THEN  --checking if the pmv_id exists if not integrity constraint error occurs

        SELECT PMV_NAME, PMV_END, PMV_START, PMV_COMMENT
        INTO NAME, ENDDATE, STARTDATE, COMMENT
        FROM JSON_TABLE(P_PMV_JSON, '$' COLUMNS(
            PMV_NAME PATH '$.NAME',
            PMV_END PATH '$.END',
            PMV_START PATH '$.START',
            PMV_COMMENT PATH '$.COMMENT'));

        SELECT PMV_ID INTO T_PMV_ID FROM PRMODELVER RIGHT JOIN DUAL ON PMV_ID = P_PMV_ID;
        IF T_PMV_ID IS NULL THEN
            INSERT INTO PRMODELVER (PMV_ID, PMV_PMID, PMV_ESID, PMV_NAME, PMV_START,
                                    PMV_END, PMV_COMMENT, PMV_DATECRE)
                VALUES (P_PMV_ID, P_PMV_PMID, 'A', NAME, from_json_date(STARTDATE),
                        NVL(from_json_date(ENDDATE),to_date('01.01.2100','dd.mm.yyyy')), COMMENT, SYSDATE); -- SO001
        ELSE
            UPDATE PRMODELVER SET
                PMV_ESID = 'A',
                PMV_START = from_json_date(STARTDATE),
                PMV_END = NVL(from_json_date(ENDDATE),to_date('01.01.2100','dd.mm.yyyy')),  -- SO001
                PMV_PMID = P_PMV_PMID,
                PMV_NAME = NAME,
                PMV_COMMENT = COMMENT,
                PMV_DATEMOD = SYSDATE
            WHERE PMV_ID = P_PMV_ID;
        END IF;
    END IF;
END;
/


--
-- GPSH_TOAC_SMSC_DEL  (Procedure) 
--
CREATE OR REPLACE PROCEDURE SBS1_ADMIN.gpsh_toac_smsc_del(
      P_SMSC_CODE  IN VARCHAR2,
      P_SMSC_CONOPKEY IN VARCHAR2
)
   IS
-- MODIFICATION HISTORY
-- ---------    ------      -------------------------------------------
-- Person       Date        Comments
-- SS           05.10.2017  Created

BEGIN
    DELETE FROM SMSC WHERE SMSC_CODE = P_SMSC_CODE and SMSC_CONOPKEY = P_SMSC_CONOPKEY;
END; -- Procedure
/


--
-- GPSH_TOAC_SMSC_PUT  (Procedure) 
--
CREATE OR REPLACE PROCEDURE SBS1_ADMIN.GPSH_TOAC_SMSC_PUT(
    P_CONOP_KEY   IN VARCHAR2,
    P_SMSC_JSON   IN VARCHAR2
)

-- MODIFICATION HISTORY
-- ---------    ------      -------------------------------------------
-- Person       Date        Comments
-- SS           05.10.17    Created

IS
    CODE        VARCHAR2(50);
    ID          VARCHAR2(50);
    ESID        VARCHAR2(10);
    PROP_OPKEY  VARCHAR2(20);
    T_SMSC_ID   VARCHAR(20);
BEGIN
    SELECT SMSC_ID, SMSC_CODE, SMSC_ESID, SMSC_CONOPKEY_PROP
    INTO ID, CODE, ESID, PROP_OPKEY
    FROM JSON_TABLE(P_SMSC_JSON, '$' COLUMNS(
        SMSC_ID PATH '$.SMSC_ID',
        SMSC_CODE PATH '$.NAME',
        SMSC_ESID PATH '$.STATE.fk[1]',
        SMSC_CONOPKEY_PROP PATH '$.PROP_OPKEY'));

    SELECT SMSC_ID INTO T_SMSC_ID FROM SMSC RIGHT JOIN DUAL ON SMSC_ID = ID;

    IF T_SMSC_ID IS NULL THEN
        INSERT INTO SMSC (SMSC_ID, SMSC_CONOPKEY, SMSC_CODE, SMSC_ESID, SMSC_CONOPKEY_PROP, SMSC_DATECRE)
            VALUES (ID, P_CONOP_KEY, CODE, ESID, PROP_OPKEY, SYSDATE);
    ELSE
        UPDATE SMSC SET
           SMSC_CONOPKEY = P_CONOP_KEY,
           SMSC_CODE = CODE,
           SMSC_ESID = ESID,
           SMSC_CONOPKEY_PROP = PROP_OPKEY,
           SMSC_DATEMOD = SYSDATE
        WHERE SMSC_ID = ID;
    END IF;
END;
/


--
-- GPSH_TPAC_LONGID_MAP_DEL  (Procedure) 
--
CREATE OR REPLACE PROCEDURE SBS1_ADMIN.gpsh_tpac_longid_map_del(
    P_LONGM_LONGID1     IN VARCHAR2
  , P_LONGM_LONGID2     IN VARCHAR2
)
   IS
-- MODIFICATION HISTORY
-- ---------    ------      -------------------------------------------
-- Person       Date        Comments
-- SO           21.06.2017  Created

BEGIN

    DELETE FROM LONGIDMAP 
    WHERE   LONGM_LONGID2 >= P_LONGM_LONGID1
    AND     LONGM_LONGID1 <= P_LONGM_LONGID2
    ;

END; -- Procedure
/


--
-- GPSH_TPAC_LONGID_MAP_PUT  (Procedure) 
--
CREATE OR REPLACE PROCEDURE SBS1_ADMIN.gpsh_tpac_longid_map_put(
   P_LONGID_JSON   IN VARCHAR2
)
   IS
    LONGID1   VARCHAR2(15);
    LONGID2   VARCHAR2(15);
    ESID      VARCHAR2(1);
    DATESTART VARCHAR2(20);
    DATEEND   VARCHAR2(20);
    SHORTID   VARCHAR2(7);
    PRICE     VARCHAR2(10);
    OCCUPIED  VARCHAR2(6);

-- MODIFICATION HISTORY
-- ---------    ------      -------------------------------------------
-- Person       Date        Comments
-- SO           25.04.2016  Created
-- SO           21.06.2017  Deletion added (to be converted to use JSON)
-- SS           22.06.2017  Using JSON input
BEGIN

    SELECT P_LONGID1, P_LONGID2, P_ESID, P_DATESTART,
           P_DATEEND, P_SHORTID, P_PRICE, P_OCCUPIED
        INTO LONGID1, LONGID2, ESID, DATESTART, DATEEND,
             SHORTID, PRICE, OCCUPIED
        FROM JSON_TABLE(P_LONGID_JSON, '$' COLUMNS(
            P_LONGID1 PATH '$.LONGID1',
            P_LONGID2 PATH '$.LONGID2',
            P_ESID PATH '$.STATUS.fk[1]',
            P_DATESTART PATH '$.DATESTART',
            P_DATEEND PATH '$.DATEEND',
            P_SHORTID PATH '$.SHORTID',
            P_PRICE PATH '$.PRICE',
            P_OCCUPIED PATH '$.OCCUPIED'));

    UPDATE LONGIDMAP SET
        LONGM_AVAILABLE = 0
      , LONGM_DATEEND = from_json_date(DATEEND)
      , LONGM_DATESTART = from_json_date(DATESTART)
      , LONGM_ESID = ESID
      , LONGM_OCCUPIED = OCCUPIED
      , LONGM_PRICE = PRICE
      , LONGM_SHORTID = SHORTID
    WHERE   LONGM_LONGID1 = LONGID1
    AND     LONGM_LONGID2 = LONGID2
    ;

    If (Sql%RowCount = 0) Then

        GPSH_TPAC_LONGID_MAP_DEL(LONGID1, LONGID2);

        INSERT INTO LONGIDMAP (
              LONGM_AVAILABLE
            , LONGM_DATEEND
            , LONGM_DATESTART
            , LONGM_ESID
            , LONGM_LONGID1
            , LONGM_LONGID2
            , LONGM_OCCUPIED
            , LONGM_PRICE
            , LONGM_SHORTID
        ) VALUES (
              0
            , from_json_date(DATEEND)
            , from_json_date(DATESTART)
            , ESID
            , to_number(LONGID1)
            , to_number(LONGID2)
            , OCCUPIED
            , PRICE
            , SHORTID
        );
    end if;

END; -- Procedure
/


--
-- SP_COMPILE_ALL  (Procedure) 
--
CREATE OR REPLACE PROCEDURE SBS1_ADMIN.SP_COMPILE_ALL
IS
  CURSOR invalid_objects IS
    SELECT decode (OBJECT_TYPE,
      'PACKAGE BODY', 'alter package ' || OWNER ||'.'||OBJECT_NAME || ' compile body',
                      'alter ' || OBJECT_TYPE || ' ' || OWNER||'.'||OBJECT_NAME || ' compile'
      ) compile_sql
    FROM   ALL_OBJECTS A, ORDER_OBJECT_BY_DEPENDENCY B
    WHERE  A.OBJECT_ID = B.OBJECT_ID (+)
    AND    A.STATUS = 'INVALID'
    -- AND    A.object_name not like 'SIS__SUBSCRIBERDATAMSISDN'
    AND    A.OBJECT_TYPE in ('PACKAGE BODY','PACKAGE','FUNCTION','PROCEDURE','TRIGGER','VIEW')
    ORDER by B.DLEVEL desc, A.OBJECT_TYPE, A.OBJECT_NAME;

    invalid_objects_row invalid_objects%rowtype;
    v_cursor  INTEGER;
    v_ddl   VARCHAR2(32000);
    v_dummy   INTEGER;
BEGIN

  FOR invalid_objects_row IN invalid_objects
  LOOP
    BEGIN
      v_ddl := invalid_objects_row.compile_sql ;
      v_cursor := dbms_sql.open_cursor;
      dbms_sql.parse(v_cursor,v_ddl,dbms_sql.native);
      v_dummy := dbms_sql.execute(v_cursor);
      dbms_sql.close_cursor(v_cursor);
    EXCEPTION
      WHEN OTHERS THEN
        dbms_sql.close_cursor(v_cursor);
      sys.dbms_lock.sleep(10);
    END;
  END LOOP;

END;
/


--
-- SP_INSERT_NEXT_PERIOD  (Procedure) 
--
CREATE OR REPLACE PROCEDURE SBS1_ADMIN.SP_INSERT_NEXT_PERIOD(
   p_PACT_ID        IN varchar2,
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT number
)
IS 

BEGIN

    SP_INSERT_PERIOD(to_char(add_months(sysdate,1),'YYYYMM'));
    
    ErrorCode :=0;
    ErrorMsg :=NULL;
    ReturnStatus:= 1;

    return;
Exception
  When Others then
    ErrorCode := SQLCODE;
    ErrorMsg  := SQLERRM;
    ReturnStatus := 0;
    RecordsAffected := 0;
END;
 
/


--
-- GETHIERARCHICALHASH  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.GETHIERARCHICALHASH(p_Details IN varchar2 ) RETURN VARCHAR2
-- get hierarchical hash from lines of text containing prefixes
/*
Input text:

XXX:A..CrLf
XXX:B..CrLf
YYY:a..CrLf
YYY:b..CrLf
YYY:c..CrLf
ZZZ:1..CrLf

Output text:

XXX:HASH_MD5(XXX section)
YYY:HASH_MD5(YYY section)
ZZZ:HASH_MD5(ZZZ section)

Hash includes sets of whole lines, e.g. "XXX:B..CrLf"

*/

is
    CrLf                    VARCHAR2(2) := CHR(13) || CHR(10);
    l_sep                   VARCHAR2(1) := ':';
    
    l_result                VARCHAR2(1000);

    l_curLineStartPos       INTEGER;
    l_curLineEndPos         INTEGER;    -- begining of line sep chars
    l_curSectionStartPos    INTEGER;
    l_curSectionEndPos      INTEGER;
    l_curSectionPrefix      VARCHAR2(41);
    l_newSectionPrefix      VARCHAR2(41);
    
begin

    l_result := NULL;
    l_curLineStartPos := 1;
    l_curSectionStartPos := 1;
    l_curSectionPrefix := NULL;
    l_curLineEndPos := INSTR(p_Details,CrLf,l_curLineStartPos);
    while l_curLineEndPos > l_curLineStartPos loop
        -- find the current line's end
        if SUBSTR(p_Details,l_curLineStartPos,1) = l_sep then
            l_newSectionPrefix := l_sep;
        else
            l_newSectionPrefix := SUBSTR(p_Details,l_curLineStartPos,INSTR(p_Details,l_sep,l_curLineStartPos)-l_curLineStartPos + 1);
        end if;
        if l_curSectionPrefix is NULL then
            l_curSectionPrefix := l_newSectionPrefix;
        elsif l_newSectionPrefix <> l_curSectionPrefix then
            -- prefix changed. Time to add a hash line to the output
            l_curSectionEndPos := l_curLineStartPos -1;
            l_result := l_result || l_curSectionPrefix || HASH_MD5(SUBSTR(p_Details,l_curSectionStartPos,l_curSectionEndPos - l_curSectionStartPos + 1)) || CrLf ;
            l_curSectionStartPos := l_curLineStartPos;
            l_curSectionPrefix := l_newSectionPrefix;
        end if;
        l_curLineStartPos := l_curLineEndPos + LENGTH(CrLf);
        l_curLineEndPos := INSTR(p_Details,CrLf,l_curLineStartPos);
    end loop;
    if l_newSectionPrefix is not null then
        l_curSectionEndPos := l_curLineStartPos - 1;
        l_result := l_result || l_curSectionPrefix || HASH_MD5(SUBSTR(p_Details,l_curSectionStartPos,l_curSectionEndPos - l_curSectionStartPos + 1)) || CrLf ;
    end if;
    return l_result;
end;

 
/


--
-- GPSH_TPAC_NEW_ADR_ID  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.gpsh_tpac_new_adr_id
(
  p_ADR_EMAIL           In      Varchar2,
  p_ADR_INVOICEEMAIL    In      NUMBER DEFAULT 0,
  p_ADR_STATISTICSMAIL  In      NUMBER DEFAULT 0
)
Return
  Varchar2
Is
--
-- Purpose: Return The Adr_Id of a new tpac address
-- Modification History
-- Person       Date        Comments
-- ----------   ----------  -------------------------------------------
-- SO           11.04.2016  Initial version

  l_Adr_Id Varchar2(10);

Begin

  Select
    GENERATEUNIQUEKEY('G') Into l_Adr_Id
  From Dual;

  Insert Into ADDRESS (
    ADR_ID,
    ADR_ETID,
    ADR_DEMO,
    ADR_ESID,
    ADR_EMAIL,
    ADR_INVOICEEMAIL,
    ADR_STATISTICSMAIL,
    ADR_CHNGCNT
  )
  Select
    l_Adr_Id,
    'STD',
    0,
    'A',
    p_ADR_EMAIL,
    p_ADR_INVOICEEMAIL,
    p_ADR_STATISTICSMAIL,
    0
  From Dual;
  Return l_Adr_Id;

END;
/


--
-- GPULL_CURRENCY_JSON  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.gpull_currency_json
  (P_CUR_KEY IN VARCHAR2
  ) RETURN  VARCHAR2 IS

-- Purpose: To generate JSON value (sbsgui like) for the corresponding currency key
--
-- MODIFICATION HISTORY
-- Person      Date    Comments
-- ---------   ------  -------------------------------------------
-- SS          17.8.16 Created
-- SS          04.8.17 Added ID to the exchangerate vlaue

    P_CUR_ID    VARCHAR2(5);
    P_START     VARCHAR2(20);
    RETURN_VAL  VARCHAR2(5000);

    T_EXR_END  VARCHAR2(100);

BEGIN
    SELECT CUR_KEY
    INTO RETURN_VAL
    FROM gpsh_currency_keylist
    RIGHT JOIN DUAL ON CUR_KEY = P_CUR_KEY;

    IF RETURN_VAL IS NULL THEN
        RETURN 'null';
    ELSE
        SELECT CUR_ID, EXR_START
        INTO P_CUR_ID, P_START
        FROM JSON_TABLE(P_CUR_KEY, '$'
        COLUMNS(CUR_ID PATH '$[1]',
                EXR_START PATH '$[3]'));

        IF P_START IS NULL THEN
            SELECT '{'
                    || '"CODE":' || json_string(CUR_ID) || ','
                    || '"HEADVAL":' || json_number(CUR_HEADVAL) || ','
                    || '"NAME":' || json_string(CUR_NAME)
                    || '}'
            INTO RETURN_VAL
            FROM CURRENCY
            WHERE CUR_ID = P_CUR_ID;
        ELSE
            SELECT '{'
                    || '"ID":' || json_string(EXR_ID) || ','
                    || '"RATE":' || json_number(EXR_VALUE) || ','
                    || '"VALID_FROM":' || json_date(EXR_START)
                    || '}'
            INTO RETURN_VAL
            FROM EXCHANGERATE
            WHERE EXR_CURID = P_CUR_ID
            AND EXR_START = from_json_date(P_START);
        END IF;

        RETURN RETURN_VAL;

    END IF;
END;
/


--
-- GPULL_TOAC_SMSC_JSON  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.gpull_toac_smsc_json
  (P_SMSC_CODE IN VARCHAR2
  ) RETURN  VARCHAR2 IS

-- Purpose: To generate toac smsc JSON value (sbsgui like) 
--
-- MODIFICATION HISTORY
-- Person      Date    Comments
-- ---------   ------  -------------------------------------------
-- SS          04.10.17 Created

    
    ID                 VARCHAR2(10);
    PROP_OP_KEY        VARCHAR2(50);
    ESID               VARCHAR2(10);
    RETURN_VAL         VARCHAR2(5000);
    
BEGIN
    SELECT SMSC_ID, SMSC_CONOPKEY_PROP, SMSC_ESID
    INTO ID, PROP_OP_KEY, ESID
    FROM SMSC
    RIGHT JOIN DUAL ON SMSC_CODE =  P_SMSC_CODE;


    IF ID IS NULL THEN
        RETURN 'null';
    ELSE
        RETURN_VAL := '{' || '"NAME":'                     || json_string(P_SMSC_CODE) || ','
                          || '"PROP_OPKEY":'               || json_string(PROP_OP_KEY) || ','
                          || '"SMSC_ID":'                  || json_string(ID) || ','
                          || '"STATE":{"fk":["smsc_state",'|| json_string(ESID) || ']}'
                          || '}';
        RETURN RETURN_VAL;

    END IF;
END;
/


--
-- IMS_LTE_CELL_ID  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.Ims_Lte_Cell_Id(
    p_PaniHeader                 In     Varchar2
) Return varchar2
IS -- 597SO
    l_pani                  Varchar2(200);
    l_dummy                 Varchar2(200);                                      -- 666SO
    l_result                Varchar2(200);                                      -- 666SO
begin
    l_pani := lower(p_PaniHeader);
    if l_pani not like '%;utran-cell-id-3gpp=%' then
        if l_pani not like '%;cgi-3gpp=%' then
            l_result := NULL;                                                   -- 666SO
        else
            l_dummy := PKG_COMMON.CutFirstItem(l_pani, ';cgi-3gpp=');
            l_result:= PKG_COMMON.CutFirstItem(l_pani, ';');                    -- 666SO -- 642SO
        end if;
    else
        l_dummy := PKG_COMMON.CutFirstItem(l_pani, ';utran-cell-id-3gpp=');
        l_result := PKG_COMMON.CutFirstItem(l_pani, ';');                       -- 666SO
    end if;
    return REPLACE(l_result,'"');                                               -- 666SO
end;
/


--
-- IMS_WIFI_MCC  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.ims_wifi_mcc(
    p_PaniHeader                 In     Varchar2
) Return varchar2
IS -- 597SO
    l_pani                  Varchar2(200);
    l_dummy                 Varchar2(200);
begin
    l_pani := trim(lower(p_PaniHeader)) || ';';                             -- 612SO
    if l_pani not like '%;mcc=%' then
        return NULL;
    elsif l_pani like '%;mcc=228;%' then                                    -- 600SO
        return '228';                                                       -- 600SO
    else
        l_dummy := PKG_COMMON.CutFirstItem(l_pani, ';mcc=');
        return PKG_COMMON.CutFirstItem(l_pani, ';');
    end if;
end;
/


--
-- IMS_WLAN_NODE_ID  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.IMS_WLAN_NODE_ID(
    p_PaniHeader                 In     Varchar2
) Return varchar2
IS -- 597SO
    l_pani                  Varchar2(200);
    l_dummy                 Varchar2(200);
    l_result                Varchar2(200);                                      -- 679SO
begin
    l_pani := lower(p_PaniHeader);
    if l_pani not like '%;i-wlan-node-id=%' then
        l_result := 'ffffffffffff';                                             -- 663SO
    else
        l_dummy := PKG_COMMON.CutFirstItem(l_pani, ';i-wlan-node-id=');
        l_result := NVL(PKG_COMMON.CutFirstItem(l_pani, ';'), 'ffffffffffff');  -- 679SO-- 663SO
    end if;
    return REPLACE(l_result,'"');                                               -- 679SO
end;
/


--
-- IS_ROAMING_PANI  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.Is_Roaming_Pani(
    p_PaniHeader                 In     Varchar2
) Return number
IS -- 592SO
    l_pani                  Varchar2(200);
    l_cell                  Varchar2(200);
begin
    l_pani := trim(lower(p_PaniHeader)) || ';';                             -- 612SO
    if l_pani is NULL then
        return 0;
    elsif l_pani like 'ieee-802.11%' then
        -- WiFi PANI
        if l_pani not like '%;mcc=%' then                                   -- 593SO
            return 0;
        elsif l_pani like '%;mcc=228;%' then                                -- 600SO -- 593SO
            return 0;
        else
            return 1;
        end if;
    else
        -- LTE PANI
        l_cell := Ims_Lte_Cell_Id(l_pani);
        if l_cell is NULL then
            return 0;
        elsif l_cell like '228%' then
            return 0;
        elsif l_cell like '29501%' then
            return 0;                                                   -- 651SO
        else
            return 1;
        end if;
    end if;
end;
/


--
-- JSOND  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.jsond(
    p_start varchar2,
    p_key varchar2,
    p_value date
) return varchar2
is  -- append a json date
begin
    if p_start is NULL then
        return '"' || p_key || '":' || json_date(p_value);
    elsif p_start like '%{' then
        return p_start || '"' || p_key || '":' || json_date(p_value);
    else
        return p_start || ',"' || p_key || '":' || json_date(p_value);
    end if;
end;
/


--
-- JSON_FOREIGN_KEY  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.json_foreign_key(
    p_1     in varchar2,
    p_2     in varchar2 default NULL,
    p_3     in Varchar2 default NULL,
    p_4     in varchar2 default NULL,
    p_5     in varchar2 default NULL,
    p_6     in varchar2 default NULL,
    p_7     in varchar2 default NULL,
    p_8     in varchar2 default NULL,
    p_9     in varchar2 default NULL,
    p_A     in varchar2 default NULL
) return varchar2
is
    p1      varchar2(100);
begin
    return '{"fk":' || json_string_key(p_1,p_2,p_3,p_4,p_5,p_6,p_7,p_8) || '}';
end;
/


--
-- JSON_FOREIGN_KEYS  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.json_foreign_keys(
    p_1     in varchar2,
    p_2     in varchar2 default NULL,
    p_3     in Varchar2 default NULL,
    p_4     in varchar2 default NULL,
    p_5     in varchar2 default NULL,
    p_6     in varchar2 default NULL,
    p_7     in varchar2 default NULL,
    p_8     in varchar2 default NULL,
    p_9     in varchar2 default NULL,
    p_A     in varchar2 default NULL
) return varchar2
is
    p1      varchar2(100);
begin
    return '{"fks":[' || json_string_key(p_1,p_2,p_3,p_4,p_5,p_6,p_7,p_8) || ']}';
end;
/


--
-- JSON_KEY_SNS  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.json_key_sns(
    p_1     in varchar2,
    p_2     in NUMBER,
    p_3     in varchar2
) return varchar2
is
    p1      varchar2(100);
begin
    if p_1 is NULL then
        p1 := '[]';
    else
        p1 := JSON_STRING(p_1);
    end if;
    return '[' || p1 ||',' || p_2 ||',' || JSON_STRING(p_3) || ']';

end;
/


--
-- JSONN  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.jsonn(
    p_start varchar2,
    p_key varchar2,
    p_value number
) return varchar2
is  -- append a json number
begin
    if p_start is NULL then
        return '"' || p_key || '":' || json_number(p_value);
    elsif p_start like '%{' then
        return p_start || '"' || p_key || '":' || json_number(p_value);
    else
        return p_start || ',"' || p_key || '":' || json_number(p_value);
    end if;
end;
/


--
-- JSON_NOT_NULL  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.json_not_null(
    p_name      in varchar2,
    p_value     in varchar2
) return varchar2
is
begin
    if p_value is NULL then
        return NULL;
    elsif p_value ='""' then
        return NULL;
    else
        return ',"' || p_name || '":' || json_string(p_value);
    end if;
end;
/


--
-- JSON_NUM  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.json_num(
    p_1     in varchar2,
    p_2     in number default 0
) return varchar2
is
begin
    if p_1 is NULL then
        return to_char(p_2);
    else
        return to_char(to_number(p_1));
    end if;
Exception
When Others then
   return json_string(p_1);
end;
/


--
-- JSONS  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.jsons(
    p_start varchar2,
    p_key varchar2,
    p_value varchar2
) return varchar2
is  -- append a json string
begin
    if p_start is NULL then
        return '"' || p_key || '":' || json_string(p_value);
    elsif p_start like '%{' then
        return p_start || '"' || p_key || '":' || json_string(p_value);
    else
        return p_start || ',"' || p_key || '":' || json_string(p_value);
    end if;
end;
/


--
-- JSON_TYPE  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.json_type(
    p_1     in varchar2,
    p_2     in varchar2 default NULL
) return varchar2
is
begin
    -- if p_1 = 'string' and p_2 = '**null**' then
    --     return '""';
    if p_2 = '**null**' then
        return 'null';
    elsif p_1 = 'integer' and p_2 is NULL then
        return 'null';
    elsif p_1 = 'integer' then
        return json_num(p_2);
    elsif p_1 = 'double' and p_2 is NULL then
        return 'null';
    elsif p_1 = 'double' then
        return json_num(p_2);
    elsif p_1 = 'boolean' and p_2 is NULL then
        return 'null';
    elsif p_1 = 'boolean' then
        return json_boolean(p_2);
    else
        return json_string(p_2);
    end if;
end;
/


--
-- NORMALIZEDMSISDN  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.normalizedmsisdn( msisdn in varchar2 )
return varchar2
is
-- 001SO    23.04.2013  remove Msisdn mapping 077.. -> 432..
-- 002SO    14.04.2016  Accept 9 digit MSISDNs without national/international prefi
begin
    if msisdn Like '+%' Then
        return SUBSTR(msisdn,2);
    elsif LENGTH(msisdn)< 9 then
        return msisdn;
    elsif LENGTH(msisdn)>= 19 Then
        return msisdn;
    elsif INSTR(msisdn,'A') > 0 Then
        return msisdn;
    elsif INSTR(msisdn,'B') > 0 Then
        return msisdn;
    elsif INSTR(msisdn,'C') > 0 Then
        return msisdn;
    elsif INSTR(msisdn,'D') > 0 Then
        return msisdn;
    elsif INSTR(msisdn,'E') > 0 Then
        return msisdn;
    elsif INSTR(msisdn,'F') > 0 Then
        return msisdn;
    elsif msisdn like '00%' then
        return SUBSTR(msisdn,3);
    elsif msisdn like '0%' then
        return '41' || SUBSTR(msisdn,2);
    Elsif (PKG_COMMON.SP_IS_NUMERIC(msisdn)=1) and (length(msisdn) = 9) then
        Return '41' || msisdn;                       
    else
        return msisdn;
    end if; -- 001SO
end;
/


--
-- OPKEY_FROM_GT  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.OPKEY_FROM_GT (
        msisdn            In Varchar2
    ) Return VARCHAR2
Is  
    Cursor c1
        IS  SELECT /*+ INDEX(NUMBERRANGE, IDXU_NBR_CODE) */ NBR_CONOPKEY
        FROM NUMBERRANGE
        WHERE NBR_CODE <= msisdn
        AND NBR_CODE Like SUBSTR(msisdn,1,3) || '%'
        AND NBR_CODE = SUBSTR(msisdn,1,LENGTH(NBR_CODE))
        AND ROWNUM <= 1;

    l_retval            Varchar2(100);
Begin

    open c1;
    fetch c1 into l_retval;
    close c1;
    
    RETURN l_retval;

End OPKEY_FROM_GT;
 
/


--
-- PARTREORG_EXCH_PARTITION  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.partreorg_exch_partition ( own in varchar2, tbl in varchar2, part in varchar2)
-- $Id: function.sbs1_admin.partreorg_part_exchange.sql 24 2012-12-06 10:32:54Z svnrepo $
return number
  --  -1: prepared table to exchange does not exist
  --   1: Before exchange: prepared table and corresponding partition with different number of rows
  --   2: After  exchange: prepared table and corresponding partition with different number of rows
  --   3: Exchange partition unsuccessful
is
  val varchar2(4000);
  sqlcmd varchar2(4000);
  prt number;
  tab number := -1;
  cnt number;
  ungleich1 exception;
  ungleich2 exception;
  tbl_not_exists exception;
begin
  select count(*) into cnt from all_tables where table_name=upper(tbl||'_'||part) and owner=upper(own);
  if cnt = 0 then
    val := 'compressed part_table does not exist';
    dbms_output.put_line(val);
    PKG_COMMON.INSERT_WARNING('EXCHANGE', 'exchange partition', tbl || '(' || part || ')', val, NULL, NULL);
    return -1;
  else
    execute immediate 'select count(*) from '||own||'.'||tbl||'_'||part into tab;
    execute immediate 'select count(*) from '||own||'.'||tbl||' partition ('||part||')'  into prt;
    if prt <> tab then
      val := 'rows in partition=' || prt || ' part_table=' || tab;
      dbms_output.put_line(val);
      PKG_COMMON.INSERT_WARNING('EXCHANGE', 'rowcount difference before exchange', tbl || '(' || part || ')', val, NULL, NULL);
      return 1;
    end if;
    sqlcmd:='alter table '||own||'.'||tbl||' exchange partition '||part||' with table '||own||'.'||tbl||'_'||part||' including indexes';
    dbms_output.put_line(sqlcmd||';');
    begin
      execute immediate sqlcmd;
    exception
      when others then
        val := SqlErrM;
        dbms_output.put_line(val);
        PKG_COMMON.INSERT_WARNING('EXCHANGE', 'exchange partition', tbl || '(' || part || ')', val, NULL, NULL);
        return 3;
    end;
    -- check once again
    execute immediate 'select count(*) from '||own||'.'||tbl||'_'||part into tab;
    execute immediate 'select count(*) from '||own||'.'||tbl||' partition ('||part||')'  into prt;
    if prt <> tab then
      val := 'rows in partition=' || prt || ' part_table=' || tab;
      dbms_output.put_line(val);
      PKG_COMMON.INSERT_WARNING('EXCHANGE', 'rowcount difference after exchange', tbl || '(' || part || ')', val, NULL, NULL);
      return 2;
    end if;
    sqlcmd:='drop table '||own||'.'||tbl||'_'||part;
    dbms_output.put_line(sqlcmd||';');
    execute immediate sqlcmd;
  end if;
  dbms_output.put_line('anz partition: '||prt||' ; anz tabelle '||tab);
  return 0;

exception
  when others then
    val := SqlErrM;
    dbms_output.put_line(val);
    PKG_COMMON.INSERT_WARNING('EXCHANGE', 'unspecified operation', tbl || '(' || part || ')', val, NULL, NULL);
    RAISE;
end ;
/


--
-- PARTREORG_PREPARE  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.partreorg_prepare ( own in varchar2, tbl in varchar2, part in varchar2)
-- $Id: function.sbs1_admin.partreorg_prepare.sql 24 2012-12-06 10:32:54Z svnrepo $

--027SO 09.09.2015  Patch Compression rules for re-compressing badly compressed older partitions $$$$ TO BE REMOVED $$$$

return number
  --   1: prepared table and corresponding partition with different number of rows
  --   2: specified table-partition does not exist
  --   3: reorg-table already exists
is
  val varchar2(4000);
  sdat date;
  diff number;
  prt number;
  tab number := -1;
  tbs varchar2(30);
  felder varchar2(4000);
  felder2 varchar2(4000);
  sqlcmd varchar2(4000);
  objname varchar2(30);
  ref_obj varchar2(61);
  ungleich1 exception;
begin
  -- Bestimmung Tablespace-Name der Partition. TBS fr komprimierte Partition ist *_QC  (Query Compressed)
  sqlcmd:='select tablespace_name from all_tab_partitions where table_owner='''||own||''' and table_name='''||tbl||''' and partition_name='''||part||'''';
  dbms_output.put_line(sqlcmd||';');
  begin
    select tablespace_name into tbs from all_tab_partitions where table_owner=own and table_name=tbl and partition_name=part;
  exception
    when no_data_found then
      val := 'Partition '||own||'.'||tbl||'.'||part||' does not exist';
      dbms_output.put_line(val);
      PKG_COMMON.INSERT_WARNING('COMPRESS', 'tablespace_name', tbl || '(' || part || ')', val, NULL, NULL);
      return 2;
    when others then
      val := SqlErrM;
      dbms_output.put_line(val);
      PKG_COMMON.INSERT_WARNING('COMPRESS', 'tablespace_name', tbl || '(' || part || ')', val, NULL, NULL);
      RAISE;
  end;
  if tbs like '%_UC' then
     tbs:=substr(tbs,1,length(tbs)-3)||'_QC';
  elsif tbs like '%_NC' then
     tbs:=substr(tbs,1,length(tbs)-3)||'_QC';
  elsif tbs like '%_HC' then
     tbs:=substr(tbs,1,length(tbs)-3)||'_QC';   --027SO
  end if;

  -- erstellen der neuen komprimierten Tabelle fuer den Partition-Exchange
  sqlcmd:='create table '||own||'.'||tbl||'_'||part||' compress for query high parallel 8 tablespace '||tbs||' as select * from '||own||'.'||tbl||' partition ('||part||')';
  begin
    dbms_output.put_line(to_char(sysdate,'yyyy-mm-dd hh24:mi:ss'));
    dbms_output.put_line(sqlcmd||';');
    sdat := sysdate;
    execute immediate sqlcmd;
    diff := sysdate-sdat;
    dbms_output.put_line('Duration (create table): '||trunc(diff*24)||':'||trunc( mod(diff*24*60, 60 ))||':'||trunc( mod(diff*24*60*60, 60 ) ));
  exception
    when others then
      IF SQLCODE = -955 THEN   -- ORA-00955: name is already used by an existing object
          val := 'Table '||own||'.'||tbl||'_'||part||' for re-organization already exists';
          dbms_output.put_line(val);
          PKG_COMMON.INSERT_WARNING('COMPRESS', 'create table', tbl || '(' || part || ')', val, NULL, NULL);
          return 3;
      ELSE
          val := SqlErrM;
          dbms_output.put_line(val);
          PKG_COMMON.INSERT_WARNING('COMPRESS', 'create table', tbl || '(' || part || ')', val, NULL, NULL);
      END IF;
  end;

  begin
      -- Erstellen der Indices
      tbs := replace(tbs,'DATA','INDEX');
      for ind in (
        select * from all_indexes --all_ind_columns
        where table_owner=own and table_name=tbl
        and (table_owner,table_name) in (select table_owner,table_name from all_tab_partitions) --027SO where compression='DISABLED'
      ) loop
        felder:=null;
        for col in (
          select * from all_ind_columns
          where index_owner=own
          and table_name=tbl and index_name=ind.index_name  )
        loop
           select decode(felder,null,col.column_name,felder||','||col.column_name) into felder from dual;
        end loop;
        if length(ind.index_name||'_'||part) > 30 then
           objname:=substr(ind.index_name||'_'||part,-30); --indexnamen muessen eindeutig sein. Bei aktueller Namenskonvention funktioniert das
        else
           objname:=ind.index_name||'_'||part;
        end if;
        sqlcmd:='create index '||ind.owner||'.'||objname||' on '||ind.table_owner||'.'||ind.table_name||'_'||part||' ('||felder||') tablespace '||tbs;
        dbms_output.put_line(sqlcmd||';');
        sdat := sysdate;
        begin
            execute immediate sqlcmd;
        exception
            when others then
              val := SqlErrM;
              dbms_output.put_line(val);
              PKG_COMMON.INSERT_WARNING('COMPRESS', 'create index ' || objname, tbl || '(' || part || ')', val, NULL, NULL);
              RAISE;
        end;
        diff := sysdate-sdat;
        dbms_output.put_line('Duration (create index'||objname||'): '||trunc(diff*24)||':'||trunc( mod(diff*24*60, 60 ))||':'||trunc( mod(diff*24*60*60, 60 )));
      end loop ;

      -- Foreign Key Constraints (novalidate)
      for c0 in ( select constraint_name,  decode(status,'ENABLED',' enable ','disable ') en
                  from all_constraints where owner=own and table_name=tbl and constraint_type='R' )
      loop
        felder:='';
        felder2:='';
        if length(c0.constraint_name||'_'||part) > 30 then
           objname:='R_'||substr(c0.constraint_name||'_'||part,-28);
        else
           objname:=c0.constraint_name||'_'||part;
        end if;
        for c1 in (
          select t.owner, t.constraint_name, t.table_name, t.r_owner, t.r_constraint_name, c.column_name, rc.column_name ref_col, rc.table_name ref_tbl, rc.owner ref_own
          from all_constraints t, all_cons_columns c , all_cons_columns rc
          where t.owner=c.owner and t.constraint_name=c.constraint_name
          and t.r_owner=rc.owner and t.r_constraint_name=rc.constraint_name and c.position=rc.position
          and t.owner=own and t.table_name=tbl and t.constraint_name=c0.constraint_name  )
        loop
          select decode(felder,null,c1.column_name,felder||','||c1.column_name) into felder from dual;
          select decode(felder2,null,c1.ref_col,felder2||','||c1.ref_col) into felder2 from dual;
          ref_obj:=c1.ref_own||'.'||c1.ref_tbl;
        end loop; --c1
        sqlcmd:='alter table '||own||'.'||tbl||'_'||part||' add constraint '||objname||' foreign key('||felder||') references '||ref_obj||'('||felder2||')'||c0.en||'novalidate';
        dbms_output.put_line (sqlcmd||';');
        sdat := sysdate;
        begin
            execute immediate sqlcmd;
        exception
            when others then
              val := SqlErrM;
              dbms_output.put_line(val);
              PKG_COMMON.INSERT_WARNING('COMPRESS', 'add constraint ' || objname, tbl || '(' || part || ')', val, NULL, NULL);
              RAISE;
        end;
        diff := sysdate-sdat;
        dbms_output.put_line('Duration: '||trunc(diff*24)||':'||trunc( mod(diff*24*60, 60 ))||':'||trunc( mod(diff*24*60*60, 60 )) );
      end loop;  --c0

      -- Foreign Key Constraints (validate)
      for c0 in ( select constraint_name
                  from all_constraints where owner=own and table_name=tbl and constraint_type='R' and status='ENABLED' and validated = 'VALIDATED')
      loop
        if length(c0.constraint_name||'_'||part) > 30 then
           objname:='R_'||substr(c0.constraint_name||'_'||part,-28);
        else
           objname:=c0.constraint_name||'_'||part;
        end if;
        sqlcmd:='alter table '||own||'.'||tbl||'_'||part||' enable constraint '||objname;
        dbms_output.put_line (sqlcmd||';');
        sdat := sysdate;
        begin
            execute immediate sqlcmd;
        exception
            when others then
              val := SqlErrM;
              dbms_output.put_line(val);
              PKG_COMMON.INSERT_WARNING('COMPRESS', 'enable constraint ' || objname, tbl || '(' || part || ')', val, NULL, NULL);
              RAISE;
        end;
        diff := sysdate-sdat;
        dbms_output.put_line('Duration: '||trunc(diff*24)||':'||trunc( mod(diff*24*60, 60 ))||':'||trunc( mod(diff*24*60*60, 60 )) );
      end loop;  --c0

      execute immediate 'select count(*) from '||own||'.'||tbl||'_'||part into tab;
      execute immediate 'select count(*) from '||own||'.'||tbl||' partition ('||part||')'  into prt;
      if prt <> tab then
          val := 'rows in original partition / compressed: '||part||' / '||tab;
          dbms_output.put_line(val);
          PKG_COMMON.INSERT_WARNING('COMPRESS', 'check counts', tbl || '(' || part || ')', val, NULL, NULL);
          return 1;
      end if;
      return 0;

    exception
        when others then
          val := SqlErrM;
          dbms_output.put_line(val);
          PKG_COMMON.INSERT_WARNING('COMPRESS', 'enable constraint ' || objname, tbl || '(' || part || ')', val, NULL, NULL);
          begin
                sqlcmd := 'drop table ' ||own||'.'||tbl||'_'||part;
                dbms_output.put_line (sqlcmd||';');
                execute immediate sqlcmd;
          exception
                when others then NULL;
          end;
          RAISE;
    end;

end ;
/


--
-- PARTREORG_PREPARE_FK_ONLY  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.partreorg_prepare_fk_only ( own in varchar2, tbl in varchar2, part in varchar2)
-- $Id: function.sbs1_admin.partreorg_prepare.sql 24 2012-12-06 10:32:54Z svnrepo $
return number
  --   1: prepared table and corresponding partition with different number of rows
  --   2: specified table-partition does not exist
  --   2: reorg-table already exists
is
  val varchar2(4000);
  sdat date;
  diff number;
  prt number;
  tab number := -1;
  tbs varchar2(30);
  felder varchar2(4000);
  felder2 varchar2(4000);
  sqlcmd varchar2(4000);
  objname varchar2(30);
  ref_obj varchar2(61);
  ungleich1 exception;
begin
  -- Bestimmung Tablespace-Name der Partition. TBS fr komprimierte Partition ist *_HC
  sqlcmd:='select tablespace_name from all_tab_partitions where table_owner='''||own||''' and table_name='''||tbl||''' and partition_name='''||part||'''';
  dbms_output.put_line(sqlcmd||';');
  begin
    select tablespace_name into tbs from all_tab_partitions where table_owner=own and table_name=tbl and partition_name=part;
  exception
    when no_data_found then
      dbms_output.put_line('Partition '||own||'.'||tbl||'.'||part||' does not exist');
      return 2;
  end;
  if tbs like '%_UC' then
     tbs:=substr(tbs,1,length(tbs)-3)||'_HC';
  elsif tbs like '%_NC' then
     tbs:=substr(tbs,1,length(tbs)-3)||'_HC';
  end if;

  -- erstellen der neuen komprimierten Tabelle fuer den Partition-Exchange
  sqlcmd:='create table '||own||'.'||tbl||'_'||part||' tablespace '||tbs||' pctfree 0 compress for archive high as select * from '||own||'.'||tbl||' where 1=2';
  dbms_output.put_line(sqlcmd||';');
  begin
NULL;
--     execute immediate sqlcmd;
  exception
   WHEN OTHERS THEN
      IF SQLCODE = -955 THEN   -- ORA-00955: name is already used by an existing object
         dbms_output.put_line('Table '||own||'.'||tbl||'_'||part||' for re-organization already exists');
         return 3;
      ELSE
         RAISE;
      END IF;
  end;

  begin
      -- Umkopieren (und HCC komprimieren) der Daten
      sqlcmd:='insert /*+ append */ into '||own||'.'||tbl||'_'||part||' select /* parallel(t,8) */ * from '||own||'.'||tbl||' partition ('||part||') t';
      dbms_output.put_line(to_char(sysdate,'yyyy-mm-dd hh24:mi:ss'));
      dbms_output.put_line(sqlcmd||';');
      sdat := sysdate;
--    execute immediate sqlcmd;
      diff := sysdate-sdat;
      dbms_output.put_line('Duration: '||trunc(diff*24)||':'||trunc( mod(diff*24*60, 60 ))||':'||trunc( mod(diff*24*60*60, 60 ) ));

      -- Erstellen der Indices
      for ind in (
        select * from all_indexes --all_ind_columns
        where table_owner=own and table_name=tbl
        and (table_owner,table_name) in (select table_owner,table_name from all_tab_partitions where compression='DISABLED')
      ) loop
        felder:=null;
        for col in (
          select * from all_ind_columns
          where index_owner=own
          and table_name=tbl and index_name=ind.index_name  )
        loop
           select decode(felder,null,col.column_name,felder||','||col.column_name) into felder from dual;
        end loop;
        select tablespace_name into tbs from all_ind_partitions where index_owner=ind.owner and index_name=ind.index_name and partition_name=part;
        if length(ind.index_name||'_'||part) > 30 then
           objname:=substr(ind.index_name||'_'||part,-30); --indexnamen muessen eindeutig sein. Bei aktueller Namenskonvention funktioniert das
        else
           objname:=ind.index_name||'_'||part;
        end if;
        sqlcmd:='create index '||ind.owner||'.'||objname||' on '||ind.table_owner||'.'||ind.table_name||'_'||part||' ('||felder||') tablespace '||tbs;
        dbms_output.put_line(sqlcmd||';');
        sdat := sysdate;
        execute immediate sqlcmd;
        diff := sysdate-sdat;
        dbms_output.put_line('Duration: '||trunc(diff*24)||':'||trunc( mod(diff*24*60, 60 ))||':'||trunc( mod(diff*24*60*60, 60 ) ));
      end loop ;

      -- Foreign Key Constraints (novalidate)
      for c0 in ( select constraint_name,  decode(status,'ENABLED',' enable ','disable ') en
                  from all_constraints where owner=own and table_name=tbl and constraint_type='R' )
      loop
        felder:='';
        felder2:='';
        if length(c0.constraint_name||'_'||part) > 30 then
           objname:='R_'||substr(c0.constraint_name||'_'||part,-28);
        else
           objname:=c0.constraint_name||'_'||part;
        end if;
        for c1 in (
          select t.owner, t.constraint_name, t.table_name, t.r_owner, t.r_constraint_name, c.column_name, rc.column_name ref_col, rc.table_name ref_tbl, rc.owner ref_own
          from all_constraints t, all_cons_columns c , all_cons_columns rc
          where t.owner=c.owner and t.constraint_name=c.constraint_name
          and t.r_owner=rc.owner and t.r_constraint_name=rc.constraint_name and c.position=rc.position
          and t.owner=own and t.table_name=tbl and t.constraint_name=c0.constraint_name  )
        loop
          select decode(felder,null,c1.column_name,felder||','||c1.column_name) into felder from dual;
          select decode(felder2,null,c1.ref_col,felder2||','||c1.ref_col) into felder2 from dual;
          ref_obj:=c1.ref_own||'.'||c1.ref_tbl;
        end loop; --c1
        sqlcmd:='alter table '||own||'.'||tbl||'_'||part||' add constraint '||objname||' foreign key('||felder||') references '||ref_obj||'('||felder2||')'||c0.en||'novalidate';
        dbms_output.put_line (sqlcmd||';');
        sdat := sysdate;
        execute immediate sqlcmd;
        diff := sysdate-sdat;
        dbms_output.put_line('Duration: '||trunc(diff*24)||':'||trunc( mod(diff*24*60, 60 ))||':'||trunc( mod(diff*24*60*60, 60 )) );
      end loop;  --c0

      -- Foreign Key Constraints (validate)
      for c0 in ( select constraint_name
                  from all_constraints where owner=own and table_name=tbl and constraint_type='R' and status='ENABLED' and validated = 'VALIDATED')
      loop
        if length(c0.constraint_name||'_'||part) > 30 then
           objname:='R_'||substr(c0.constraint_name||'_'||part,-28);
        else
           objname:=c0.constraint_name||'_'||part;
        end if;
        sqlcmd:='alter table '||own||'.'||tbl||'_'||part||' enable constraint '||objname;
        dbms_output.put_line (sqlcmd||';');
        sdat := sysdate;
        execute immediate sqlcmd;
        diff := sysdate-sdat;
        dbms_output.put_line('Duration: '||trunc(diff*24)||':'||trunc( mod(diff*24*60, 60 ))||':'||trunc( mod(diff*24*60*60, 60 )) );
      end loop;  --c0

      execute immediate 'select count(*) from '||own||'.'||tbl||'_'||part into tab;
      execute immediate 'select count(*) from '||own||'.'||tbl||' partition ('||part||')'  into prt;
      if prt <> tab then
          dbms_output.put_line('rows in original partition / compressed: '||part||' / '||tab);
          return 1;
      end if;
      return 0;

    exception
        When Others then
            begin
                dbms_output.put_line('ERROR: Compress partition unsuccessful ' ||SQLCODE||' : '||SQLERRM);
                PKG_COMMON.INSERT_WARNING(
                  'PKG_PARTAG',
                  'partreorg_prepare',
                  'Compress partition command unsuccessful' ||SQLCODE||' : '||SQLERRM,
                  own||'.'||tbl || '_' || part,
                  NULL,
                  NULL
                );
                sqlcmd := 'drop table ' ||own||'.'||tbl||'_'||part;
                dbms_output.put_line (sqlcmd||';');
                execute immediate sqlcmd;
            exception
                when others then NULL;
            end;
            RAISE;
    end;

end ;
/


--
-- ALL_STATES  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.ALL_STATES
(COMPARE_VALUE)
BEQUEATH DEFINER
AS 
SELECT 'AAAISTATE/'||AAAIS_ID||'/'||AAAIS_CODE FROM AAAISTATE UNION                                                                                                                                                                                                             
SELECT 'AAATSTATE/'||AAATS_ID||'/'||AAATS_CODE FROM AAATSTATE UNION                                                                                                                                                                                                             
SELECT 'ACSTATE/'||ACS_ID||'/'||ACS_CODE FROM ACSTATE UNION                                                                                                                                                                                                                     
SELECT 'ADRSTATE/'||ADRS_ID||'/'||ADRS_CODE FROM ADRSTATE UNION                                                                                                                                                                                                                 
SELECT 'BDCSTATE/'||BDCS_ID||'/'||BDCS_CODE FROM BDCSTATE UNION                                                                                                                                                                                                                 
SELECT 'BIHSTATE/'||BIHS_ID||'/'||BIHS_CODE FROM BIHSTATE UNION                                                                                                                                                                                                                 
SELECT 'BOHSTATE/'||BOHS_ID||'/'||BOHS_CODE FROM BOHSTATE UNION                                                                                                                                                                                                                 
SELECT 'CONSTATE/'||CONS_ID||'/'||CONS_CODE FROM CONSTATE UNION                                                                                                                                                                                                                 
SELECT 'CTRSTATE/'||CTRS_ID||'/'||CTRS_CODE FROM CTRSTATE UNION                                                                                                                                                                                                                 
SELECT 'DGTICSTATE/'||DGTICS_ID||'/'||DGTICS_CODE FROM DGTICSTATE UNION                                                                                                                                                                                                         
SELECT 'ISCSTATE/'||ISCS_ID||'/'||ISCS_CODE FROM ISCSTATE UNION                                                                                                                                                                                                                 
SELECT 'ISSTATE/'||ISS_ID||'/'||ISS_CODE FROM ISSTATE UNION                                                                                                                                                                                                                     
SELECT 'IWTSSTATE/'||IWTSS_ID||'/'||IWTSS_CODE FROM IWTSSTATE UNION                                                                                                                                                                                                             
SELECT 'MAPSTATE/'||MAPS_ID||'/'||MAPS_CODE FROM MAPSTATE UNION                                                                                                                                                                                                                 
SELECT 'NOTIFICATIONSTATE/'||NOTS_ID||'/'||NOTS_CODE FROM NOTIFICATIONSTATE UNION                                                                                                                                                                                               
SELECT 'OGTICSTATE/'||OGTICS_ID||'/'||OGTICS_CODE FROM OGTICSTATE UNION                                                                                                                                                                                                         
SELECT 'PACKINGSTATE/'||PACKS_ID||'/'||PACKS_CODE FROM PACKINGSTATE UNION                                                                                                                                                                                                       
SELECT 'PACSTATE/'||PACS_ID||'/'||PACS_CODE FROM PACSTATE UNION                                                                                                                                                                                                                 
SELECT 'PMSTATE/'||PMS_ID||'/'||PMS_CODE FROM PMSTATE UNION                                                                                                                                                                                                                     
SELECT 'PMVSTATE/'||PMVS_ID||'/'||PMVS_CODE FROM PMVSTATE UNION                                                                                                                                                                                                                 
SELECT 'ROCSTATE/'||ROCS_ID||'/'||ROCS_CODE FROM ROCSTATE UNION                                                                                                                                                                                                                 
SELECT 'SEDSTATE/'||SEDS_ID||'/'||SEDS_CODE FROM SEDSTATE UNION                                                                                                                                                                                                                 
SELECT 'SETSTATE/'||SETS_ID||'/'||SETS_CODE FROM SETSTATE UNION                                                                                                                                                                                                                 
SELECT 'SMSCSTATE/'||SMSCS_ID||'/'||SMSCS_CODE FROM SMSCSTATE UNION                                                                                                                                                                                                             
SELECT 'STA_JOBSTATE/'||STAJS_ID||'/'||STAJS_CODE FROM STA_JOBSTATE UNION                                                                                                                                                                                                       
SELECT 'TDBSTATE/'||TDBS_ID||'/'||TDBS_CODE FROM TDBSTATE UNION                                                                                                                                                                                                                 
SELECT 'TRCSTATE/'||TRCS_ID||'/'||TRCS_CODE FROM TRCSTATE UNION                                                                                                                                                                                                                 
SELECT 'XPROCSTATE/'||XPRS_ID||'/'||XPRS_CODE FROM XPROCSTATE UNION                                                                                                                                                                                                             
SELECT 'ZNSTATE/'||ZNS_ID||'/'||ZNS_CODE FROM ZNSTATE                                                                                                                                                                                                                    

ORDER BY 1;


--
-- GPSH_CURRENCY_JSON  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.GPSH_CURRENCY_JSON
(CKEY, CVALUE)
BEQUEATH DEFINER
AS 
SELECT   cur_key as ckey, gpull_currency_json(cur_key) cvalue
        FROM gpsh_currency_keylist
    ORDER BY   1 ASC;


--
-- GPSH_PRICE_KEYLIST  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.GPSH_PRICE_KEYLIST
(PRICE_KEY)
BEQUEATH DEFINER
AS 
select  price_key from (
select price_key, sort1, sort2, sort3 from (
select distinct '["ipprc","' || a.PM_ID || '"]' as  price_key, a.pm_id as sort1, '0' as sort2, 'ipprc' as sort3 from prmodel a, prmodelver b where b.pmv_esid = 'A' and b.pmv_pmid = a.pm_id
UNION
select '["ipprc","' || PMV_PMID || '","ipprcv","' || PMV_ID || '"]' as  price_key, pmv_pmid as sort1, pmv_id as sort2, 'ipprcv' as sort3 from prmodelver where pmv_esid = 'A'
UNION
select '["ipprc","' || PMV_PMID || '","ipprcv","' || PMV_ID || '","ipprcvbr"]' as  price_key, pmv_pmid as sort1, pmv_id as sort2, 'ipprcvbr' as sort3 from prmodelver where pmv_esid = 'A'
UNION
select '["ipprc","' || PMV_PMID || '","ipprcv","' || PMV_ID || '","ipprcvtr"]' as  price_key,  pmv_pmid as sort1, pmv_id as sort2, 'ipprcvtr' as sort3 from prmodelver where pmv_esid = 'A'
)order by  NLSSORT(sort1, 'NLS_SORT=BINARY') asc, NLSSORT(sort2, 'NLS_SORT=BINARY')asc, NLSSORT(sort3, 'NLS_SORT=BINARY') asc
);


--
-- GPSH_TOAC_SMSC_KEYLIST  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.GPSH_TOAC_SMSC_KEYLIST
(SMSC_KEY, SMSC_CODE, SMSC_CONOPKEY)
BEQUEATH DEFINER
AS 
SELECT  json_string_key(smsc_code,smsc_conopkey) smsc_key, smsc_code, smsc_conopkey
  from
    smsc
  order by
     NLSSORT(smsc_code,'NLS_SORT=BINARY' ) asc
    ,
      NLSSORT(smsc_conopkey,'NLS_SORT=BINARY' ) asc;


--
-- GPSH_TPAC_LONGID_MAP_JSON  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.GPSH_TPAC_LONGID_MAP_JSON
(CKEY, CVALUE, LONGID1)
BEQUEATH DEFINER
AS 
select
    json_key_snn('longid_map',LONGM_LONGID1,LONGM_LONGID2)
    ,
    '{' ||
    '"DATEEND":' || JSON_DATE(LONGM_DATEEND) || ',' ||
    '"DATESTART":' || JSON_DATE(LONGM_DATESTART) || ',' ||
    '"STATUS":{"fk":["longid_status",' || json_string(LONGM_ESID) || ']},' ||
    '"LONGID1":' || longm_longid1 || ',' ||
    '"LONGID2":' || longm_longid2 || ',' ||
    '"OCCUPIED":' || JSON_NUMBER(LONGM_OCCUPIED) || ',' ||
    '"PRICE":' || JSON_NUMBER(LONGM_PRICE) || ',' ||
    '"SHORTID":' || JSON_STRING(LONGM_SHORTID) ||
    '}',
    LONGM_LONGID1
from    LONGIDMAP
order by LONGM_LONGID1 asc;


--
-- LONGID_DIFF  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.LONGID_DIFF
(LONG_ID, LONG_ESID, LONG_DATESTART, LONG_DATEEND, LONG_SHORTID, 
 LONG_PRICE, LONG_COMMENT, LONG_CHANGEID, LONG_FORCE)
BEQUEATH DEFINER
AS 
SELECT   LONG_ID,   LONG_ESID,   LONG_DATESTART,   LONG_DATEEND,   LONG_SHORTID,   LONG_PRICE,   LONG_COMMENT,   LONG_CHANGEID,   LONG_FORCE  FROM   LONGID@SBS0SBS1  MINUS  SELECT   LONG_ID,   LONG_ESID,   LONG_DATESTART,   LONG_DATEEND,   LONG_SHORTID,   LONG_PRICE,   LONG_COMMENT,   LONG_CHANGEID,   LONG_FORCE  FROM   SBS1_ADMIN.LONGID;


--
-- RAM_D_FILE_PROCESSING  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.RAM_D_FILE_PROCESSING
(HIH_ID, HIH_SRCTYPE, HIH_MAPID, HIH_FILESEQ, HIH_DATETIME, 
 HIH_FILENAME, HIH_RECCOUNT, HIH_ESID, HIH_DATEFC, HIH_DATELC, 
 HIH_EXE, HIH_VERSION, HIH_JOB, HIH_HOST)
BEQUEATH DEFINER
AS 
SELECT
	HIH_ID,
	HIH_SRCTYPE,
	HIH_MAPID,
	HIH_FILESEQ,
	HIH_DATETIME,
	HIH_FILENAME,
	HIH_RECCOUNT,
	HIH_ESID,
	HIH_DATEFC,
	HIH_DATELC,
	HIH_EXE,
	HIH_VERSION,
	HIH_JOB,
	HIH_HOST
FROM
	HIHEADER
WHERE
	HIH_DATETIME >= trunc(sysdate)-4
AND HIH_DATETIME < trunc(sysdate);


--
-- RAM_D_FSEQ_MISSING  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.RAM_D_FSEQ_MISSING
(ERRORTIME, ERRORTYPE, ERRORMESSAGE, ERRORPARAMS, ERRORCOUNT)
BEQUEATH DEFINER
AS 
SELECT
	HIH_DATETIME ERRORTIME,
	HIH_TRSID ERRORTYPE,
	HIH_FILENAME ERRORMESSAGE,
	'Mapping=' || HIH_MAPID ERRORPARAMS,
	1 ERRORCOUNT
FROM
	SR062A_MISSING
WHERE
	HIH_DATETIME >= trunc(SYSDATE) - 4
AND HIH_DATETIME < trunc(SYSDATE)
ORDER BY
	HIH_DATETIME,
	HIH_FILENAME;


--
-- RAM_D_SR062A_DETAILS_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.RAM_D_SR062A_DETAILS_1
(HIH_DATETIME, HIH_SRCTYPE, HIH_MAPID, HIH_RECCOUNT, HIH_ESID, 
 HIH_FILESEQ, HIH_ID, HIH_FILENAME, HIH_DATEFC, HIH_DATELC)
BEQUEATH DEFINER
AS 
SELECT
	HIH_DATETIME,
	HIH_SRCTYPE,
	HIH_MAPID,
	HIH_RECCOUNT,
	HIH_ESID,
	HIH_FILESEQ,
	HIH_ID,
	HIH_FILENAME,
	HIH_DATEFC,
	HIH_DATELC
FROM
	HIHEADER
WHERE
	HIH_DATETIME >= sysdate-35;


--
-- REVA_SIGNATURE_CHECK  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.REVA_SIGNATURE_CHECK
(REVAH_ID, M1_REVASM_ID, M1_REVASM_CODE, M1_REVASM_ETID, M1_REVASM_DESC, 
 PROBLEM, M2_REVASM_ID, M2_REVASM_CODE, M2_REVASM_ETID, M2_REVASM_DESC, 
 CORRECTION)
BEQUEATH DEFINER
AS 
SELECT
	REVAH_ID,
	M1.REVASM_ID M1_REVASM_ID,
	M1.REVASM_CODE M1_REVASM_CODE,
	M1.REVASM_ETID M1_REVASM_ETID,
	M1.REVASM_DESC M1_REVASM_DESC,
	'is contained in' problem,
	M2.REVASM_ID M2_REVASM_ID,
	M2.REVASM_CODE M2_REVASM_CODE,
	M2.REVASM_ETID M2_REVASM_ETID,
	M2.REVASM_DESC M2_REVASM_DESC,
	'DELETE FROM REVA_SIGMASK WHERE REVASM_ID = ''' || M1.REVASM_ID || ''';' correction
FROM
	REVA_SIGMASK M1,
	REVA_SIGMASK M2,
	REVA_HEADER
WHERE
		M1.REVASM_REVAHID = REVAH_ID
	AND	M2.REVASM_REVAHID = M1.REVASM_REVAHID
	AND	M1.REVASM_ID <> M2.REVASM_ID
	AND	REVA_SIGMASK_MERGE(M1.REVASM_CODE,M2.REVASM_CODE) LIKE M2.REVASM_CODE
	AND	REVAH_ESID = 'A'
	AND	M1.REVASM_ESID = 'A'
	AND	M2.REVASM_ESID = 'A';


--
-- SI055A_DETAILS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SI055A_DETAILS
(DESCRIPTION, BARRING, EXSCUPRE, NEWCUPRE, ALLCUPRE, 
 EXSCUPOST, NEWCUPOST, ALLCUPOST, TOTAL)
BEQUEATH DEFINER
AS 
SELECT
	'Sperrung Adult Content (Pornografie)' Description,
	'Kunde' BARRING,
	SUM(CASE WHEN (AAAT_PREPAID = 'Y' AND AAAT_DATECRE<SYSDATE-180) THEN 1 ELSE 0 END) AS EXSCUPRE,
	SUM(CASE WHEN (AAAT_PREPAID = 'Y' AND AAAT_DATECRE>=SYSDATE-180) THEN 1 ELSE 0 END) AS NEWCUPRE,
	SUM(CASE WHEN (AAAT_PREPAID = 'Y') THEN 1 ELSE 0 END) AS ALLCUPRE,
	SUM(CASE WHEN (AAAT_PREPAID = 'N' AND AAAT_DATECRE<SYSDATE-180) THEN 1 ELSE 0 END) AS EXSCUPOST,
	SUM(CASE WHEN (AAAT_PREPAID = 'N' AND AAAT_DATECRE>=SYSDATE-180) THEN 1 ELSE 0 END) AS NEWCUPOST,
	SUM(CASE WHEN (AAAT_PREPAID = 'N') THEN 1 ELSE 0 END) AS ALLCUPOST,
	SUM(CASE WHEN (AAAT_PREPAID IS NOT NULL) THEN 1 ELSE 0 END) AS TOTAL
FROM
	AAATRACKING
WHERE
	AAAT_BARCU='6'
    AND AAAT_ESID <> 'C'
	
UNION ALL
SELECT
	'Sperrung Premium Content allgemein' Description,
	'Kunde' BARRING,
	SUM(CASE WHEN (AAAT_PREPAID = 'Y' AND AAAT_DATECRE<SYSDATE-180) THEN 1 ELSE 0 END) AS EXSCUPRE,
	SUM(CASE WHEN (AAAT_PREPAID = 'Y' AND AAAT_DATECRE>=SYSDATE-180) THEN 1 ELSE 0 END) AS NEWCUPRE,
	SUM(CASE WHEN (AAAT_PREPAID = 'Y') THEN 1 ELSE 0 END) AS ALLCUPRE,
	SUM(CASE WHEN (AAAT_PREPAID = 'N' AND AAAT_DATECRE<SYSDATE-180) THEN 1 ELSE 0 END) AS EXSCUPOST,
	SUM(CASE WHEN (AAAT_PREPAID = 'N' AND AAAT_DATECRE>=SYSDATE-180) THEN 1 ELSE 0 END) AS NEWCUPOST,
	SUM(CASE WHEN (AAAT_PREPAID = 'N') THEN 1 ELSE 0 END) AS ALLCUPOST,
	SUM(CASE WHEN (AAAT_PREPAID IS NOT NULL) THEN 1 ELSE 0 END) AS TOTAL
FROM
	AAATRACKING
WHERE
	AAAT_BARCU='9'
    AND AAAT_ESID <> 'C'

UNION ALL
SELECT
	'Sperrung Adult Content (Pornografie)' Description,
	'Swisscom Mobile' BARRING,
	SUM(CASE WHEN (AAAT_PREPAID = 'Y' AND AAAT_DATECRE<SYSDATE-180) THEN 1 ELSE 0 END) AS EXSCUPRE,
	SUM(CASE WHEN (AAAT_PREPAID = 'Y' AND AAAT_DATECRE>=SYSDATE-180) THEN 1 ELSE 0 END) AS NEWCUPRE,
	SUM(CASE WHEN (AAAT_PREPAID = 'Y') THEN 1 ELSE 0 END) AS ALLCUPRE,
	SUM(CASE WHEN (AAAT_PREPAID = 'N' AND AAAT_DATECRE<SYSDATE-180) THEN 1 ELSE 0 END) AS EXSCUPOST,
	SUM(CASE WHEN (AAAT_PREPAID = 'N' AND AAAT_DATECRE>=SYSDATE-180) THEN 1 ELSE 0 END) AS NEWCUPOST,
	SUM(CASE WHEN (AAAT_PREPAID = 'N') THEN 1 ELSE 0 END) AS ALLCUPOST,
	SUM(CASE WHEN (AAAT_PREPAID IS NOT NULL) THEN 1 ELSE 0 END) AS TOTAL
FROM
	AAATRACKING
WHERE
	AAAT_BARSCM='6'
    AND AAAT_ESID <> 'C'

UNION ALL
SELECT
	'Sperrung Premium Content allgemein' Description,
	'Swisscom Mobile' BARRING,
	SUM(CASE WHEN (AAAT_PREPAID = 'Y' AND AAAT_DATECRE<SYSDATE-180) THEN 1 ELSE 0 END) AS EXSCUPRE,
	SUM(CASE WHEN (AAAT_PREPAID = 'Y' AND AAAT_DATECRE>=SYSDATE-180) THEN 1 ELSE 0 END) AS NEWCUPRE,
	SUM(CASE WHEN (AAAT_PREPAID = 'Y') THEN 1 ELSE 0 END) AS ALLCUPRE,
	SUM(CASE WHEN (AAAT_PREPAID = 'N' AND AAAT_DATECRE<SYSDATE-180) THEN 1 ELSE 0 END) AS EXSCUPOST,
	SUM(CASE WHEN (AAAT_PREPAID = 'N' AND AAAT_DATECRE>=SYSDATE-180) THEN 1 ELSE 0 END) AS NEWCUPOST,
	SUM(CASE WHEN (AAAT_PREPAID = 'N') THEN 1 ELSE 0 END) AS ALLCUPOST,
	SUM(CASE WHEN (AAAT_PREPAID IS NOT NULL) THEN 1 ELSE 0 END) AS TOTAL
FROM
	AAATRACKING
WHERE
	AAAT_BARSCM='9'
    AND AAAT_ESID <> 'C'

UNION ALL
SELECT
	'Ausgabenlimite Standard' Description,
	'Swisscom Mobile' BARRING,
	SUM(CASE WHEN (AAAT_PREPAID = 'Y' AND AAAT_DATECRE<SYSDATE-180) THEN 1 ELSE 0 END) AS EXSCUPRE,
	SUM(CASE WHEN (AAAT_PREPAID = 'Y' AND AAAT_DATECRE>=SYSDATE-180) THEN 1 ELSE 0 END) AS NEWCUPRE,
	SUM(CASE WHEN (AAAT_PREPAID = 'Y') THEN 1 ELSE 0 END) AS ALLCUPRE,
	SUM(CASE WHEN (AAAT_PREPAID = 'N' AND AAAT_DATECRE<SYSDATE-180) THEN 1 ELSE 0 END) AS EXSCUPOST,
	SUM(CASE WHEN (AAAT_PREPAID = 'N' AND AAAT_DATECRE>=SYSDATE-180) THEN 1 ELSE 0 END) AS NEWCUPOST,
	SUM(CASE WHEN (AAAT_PREPAID = 'N') THEN 1 ELSE 0 END) AS ALLCUPOST,
	SUM(CASE WHEN (AAAT_PREPAID IS NOT NULL) THEN 1 ELSE 0 END) AS TOTAL
FROM
	AAATRACKING
WHERE
	AAAT_TOPSCM IN ('0')
    AND AAAT_ESID <> 'C'


UNION ALL
SELECT
	'Ausgabenlimite CHF ' || AAAT_TOPSCM Description,
    'Swisscom Mobile' BARRING,
	SUM(CASE WHEN (AAAT_PREPAID = 'Y' AND AAAT_DATECRE<SYSDATE-180) THEN 1 ELSE 0 END) AS EXSCUPRE,
	SUM(CASE WHEN (AAAT_PREPAID = 'Y' AND AAAT_DATECRE>=SYSDATE-180) THEN 1 ELSE 0 END) AS NEWCUPRE,
	SUM(CASE WHEN (AAAT_PREPAID = 'Y') THEN 1 ELSE 0 END) AS ALLCUPRE,
	SUM(CASE WHEN (AAAT_PREPAID = 'N' AND AAAT_DATECRE<SYSDATE-180) THEN 1 ELSE 0 END) AS EXSCUPOST,
	SUM(CASE WHEN (AAAT_PREPAID = 'N' AND AAAT_DATECRE>=SYSDATE-180) THEN 1 ELSE 0 END) AS NEWCUPOST,
	SUM(CASE WHEN (AAAT_PREPAID = 'N') THEN 1 ELSE 0 END) AS ALLCUPOST,
	SUM(CASE WHEN (AAAT_PREPAID IS NOT NULL) THEN 1 ELSE 0 END) AS TOTAL
FROM
	AAATRACKING
WHERE
	AAAT_TOPSCM NOT IN ('0')
    AND AAAT_ESID <> 'C'
GROUP BY
	AAAT_TOPSCM

UNION ALL
SELECT
	'Erreichte Ausgabelimite' Description,
	'' BARRING,
	SUM(CASE WHEN (AAAT_PREPAID = 'Y' AND AAAT_DATECRE<SYSDATE-180) THEN 1 ELSE 0 END) AS EXSCUPRE,
	SUM(CASE WHEN (AAAT_PREPAID = 'Y' AND AAAT_DATECRE>=SYSDATE-180) THEN 1 ELSE 0 END) AS NEWCUPRE,
	SUM(CASE WHEN (AAAT_PREPAID = 'Y') THEN 1 ELSE 0 END) AS ALLCUPRE,
	SUM(CASE WHEN (AAAT_PREPAID = 'N' AND AAAT_DATECRE<SYSDATE-180) THEN 1 ELSE 0 END) AS EXSCUPOST,
	SUM(CASE WHEN (AAAT_PREPAID = 'N' AND AAAT_DATECRE>=SYSDATE-180) THEN 1 ELSE 0 END) AS NEWCUPOST,
	SUM(CASE WHEN (AAAT_PREPAID = 'N') THEN 1 ELSE 0 END) AS ALLCUPOST,
	SUM(CASE WHEN (AAAT_PREPAID IS NOT NULL) THEN 1 ELSE 0 END) AS TOTAL
FROM
	AAATRACKING
WHERE
	AAAT_CHARGED >= DECODE(AAAT_TOPSCM,0,300,AAAT_TOPSCM)
    AND AAAT_ESID <> 'C'
    AND NOT (AAAT_PREPAID='Y' AND AAAT_TOPSCM = '0');


--
-- SR035A_DETAILS_2  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR035A_DETAILS_2
(OGTI, SMSCOUNT)
BEQUEATH DEFINER
AS 
SELECT
    OGTIC_OGTI,
    SUM(OGTIC_COUNT)
FROM
    OGTICONSOL
WHERE
        OGTIC_ESID = 'R'
    AND OGTIC_ETID = 'SUBMIT'
    AND OGTIC_SEPID = to_char(add_months(trunc(sysdate,'MONTH'),-1),'YYYYMM')
    AND OGTIC_OGTI Is Not NULL
    AND OGTIC_OPKEY Is NULL
GROUP BY
    OGTIC_OGTI
ORDER BY
    OGTIC_OGTI;


--
-- SR035A_DETAILS_3  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR035A_DETAILS_3
(DGTI, SMSCOUNT)
BEQUEATH DEFINER
AS 
SELECT
    DGTIC_DGTI,
    SUM(DGTIC_COUNT)
FROM
    DGTICONSOL
WHERE
        DGTIC_STATUS = '0'
    AND DGTIC_OPKEY Is NULL
    AND DGTIC_DGTI Is Not NULL
    AND DGTIC_ETID = 'DELIVERY'
    AND DGTIC_ESID = 'R'
    AND DGTIC_SEPID = to_char(add_months(trunc(sysdate,'MONTH'),-1),'YYYYMM')
GROUP BY
    DGTIC_DGTI
ORDER BY
    DGTIC_DGTI;


--
-- SR055A_DETAILS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR055A_DETAILS
(DESCRIPTION, BARRING, EXSCUPRE, NEWCUPRE, ALLCUPRE, 
 EXSCUPOST, NEWCUPOST, ALLCUPOST, TOTAL, ORDERING)
BEQUEATH DEFINER
AS 
SELECT
	'Sperrung Adult Content (Pornografie)' Description,
	'Kunde' BARRING,
	SUM(CASE WHEN (AAAT_PREPAID = 'Y' AND AAAT_DATECRE<SYSDATE-180) THEN 1 ELSE 0 END) AS EXSCUPRE,
	SUM(CASE WHEN (AAAT_PREPAID = 'Y' AND AAAT_DATECRE>=SYSDATE-180) THEN 1 ELSE 0 END) AS NEWCUPRE,
	SUM(CASE WHEN (AAAT_PREPAID = 'Y') THEN 1 ELSE 0 END) AS ALLCUPRE,
	SUM(CASE WHEN (AAAT_PREPAID = 'N' AND AAAT_DATECRE<SYSDATE-180) THEN 1 ELSE 0 END) AS EXSCUPOST,
	SUM(CASE WHEN (AAAT_PREPAID = 'N' AND AAAT_DATECRE>=SYSDATE-180) THEN 1 ELSE 0 END) AS NEWCUPOST,
	SUM(CASE WHEN (AAAT_PREPAID = 'N') THEN 1 ELSE 0 END) AS ALLCUPOST,
	SUM(CASE WHEN (AAAT_PREPAID IS NOT NULL) THEN 1 ELSE 0 END) AS TOTAL,
	-4.0
FROM    AAATRACKING, SICACHE
WHERE   SIC_MSISDN = to_number(AAAT_MSISDN)
AND     AAAT_BARCU='6'
AND     AAAT_ESID <> 'C'
AND     SIC_PAYMENT_METHOD <> 9
	
UNION ALL
SELECT
	'Sperrung Premium Content allgemein' Description,
	'Kunde' BARRING,
	SUM(CASE WHEN (AAAT_PREPAID = 'Y' AND AAAT_DATECRE<SYSDATE-180) THEN 1 ELSE 0 END) AS EXSCUPRE,
	SUM(CASE WHEN (AAAT_PREPAID = 'Y' AND AAAT_DATECRE>=SYSDATE-180) THEN 1 ELSE 0 END) AS NEWCUPRE,
	SUM(CASE WHEN (AAAT_PREPAID = 'Y') THEN 1 ELSE 0 END) AS ALLCUPRE,
	SUM(CASE WHEN (AAAT_PREPAID = 'N' AND AAAT_DATECRE<SYSDATE-180) THEN 1 ELSE 0 END) AS EXSCUPOST,
	SUM(CASE WHEN (AAAT_PREPAID = 'N' AND AAAT_DATECRE>=SYSDATE-180) THEN 1 ELSE 0 END) AS NEWCUPOST,
	SUM(CASE WHEN (AAAT_PREPAID = 'N') THEN 1 ELSE 0 END) AS ALLCUPOST,
	SUM(CASE WHEN (AAAT_PREPAID IS NOT NULL) THEN 1 ELSE 0 END) AS TOTAL,
	-3.0
FROM    AAATRACKING, SICACHE
WHERE   SIC_MSISDN = to_number(AAAT_MSISDN)
AND     AAAT_BARCU='9'
AND     AAAT_ESID <> 'C'
AND     SIC_PAYMENT_METHOD <> 9

UNION ALL
SELECT
	'Sperrung Adult Content (Pornografie)' Description,
	'Swisscom' BARRING,
	SUM(CASE WHEN (AAAT_PREPAID = 'Y' AND AAAT_DATECRE<SYSDATE-180) THEN 1 ELSE 0 END) AS EXSCUPRE,
	SUM(CASE WHEN (AAAT_PREPAID = 'Y' AND AAAT_DATECRE>=SYSDATE-180) THEN 1 ELSE 0 END) AS NEWCUPRE,
	SUM(CASE WHEN (AAAT_PREPAID = 'Y') THEN 1 ELSE 0 END) AS ALLCUPRE,
	SUM(CASE WHEN (AAAT_PREPAID = 'N' AND AAAT_DATECRE<SYSDATE-180) THEN 1 ELSE 0 END) AS EXSCUPOST,
	SUM(CASE WHEN (AAAT_PREPAID = 'N' AND AAAT_DATECRE>=SYSDATE-180) THEN 1 ELSE 0 END) AS NEWCUPOST,
	SUM(CASE WHEN (AAAT_PREPAID = 'N') THEN 1 ELSE 0 END) AS ALLCUPOST,
	SUM(CASE WHEN (AAAT_PREPAID IS NOT NULL) THEN 1 ELSE 0 END) AS TOTAL,
	-2.0
FROM    AAATRACKING, SICACHE
WHERE   SIC_MSISDN = to_number(AAAT_MSISDN)
AND     AAAT_BARSCM='6'
AND     AAAT_ESID <> 'C'
AND     SIC_PAYMENT_METHOD <> 9

UNION ALL
SELECT
	'Sperrung Premium Content allgemein' Description,
	'Swisscom' BARRING,
	SUM(CASE WHEN (AAAT_PREPAID = 'Y' AND AAAT_DATECRE<SYSDATE-180) THEN 1 ELSE 0 END) AS EXSCUPRE,
	SUM(CASE WHEN (AAAT_PREPAID = 'Y' AND AAAT_DATECRE>=SYSDATE-180) THEN 1 ELSE 0 END) AS NEWCUPRE,
	SUM(CASE WHEN (AAAT_PREPAID = 'Y') THEN 1 ELSE 0 END) AS ALLCUPRE,
	SUM(CASE WHEN (AAAT_PREPAID = 'N' AND AAAT_DATECRE<SYSDATE-180) THEN 1 ELSE 0 END) AS EXSCUPOST,
	SUM(CASE WHEN (AAAT_PREPAID = 'N' AND AAAT_DATECRE>=SYSDATE-180) THEN 1 ELSE 0 END) AS NEWCUPOST,
	SUM(CASE WHEN (AAAT_PREPAID = 'N') THEN 1 ELSE 0 END) AS ALLCUPOST,
	SUM(CASE WHEN (AAAT_PREPAID IS NOT NULL) THEN 1 ELSE 0 END) AS TOTAL,
	-1.0
FROM    AAATRACKING, SICACHE
WHERE   SIC_MSISDN = to_number(AAAT_MSISDN)
AND     AAAT_BARSCM='9'
AND     AAAT_ESID <> 'C'
AND     SIC_PAYMENT_METHOD <> 9

UNION ALL
SELECT
	'Ausgabenlimite Standard' Description,
	'Swisscom' BARRING,
	SUM(CASE WHEN (AAAT_PREPAID = 'Y' AND AAAT_DATECRE<SYSDATE-180) THEN 1 ELSE 0 END) AS EXSCUPRE,
	SUM(CASE WHEN (AAAT_PREPAID = 'Y' AND AAAT_DATECRE>=SYSDATE-180) THEN 1 ELSE 0 END) AS NEWCUPRE,
	SUM(CASE WHEN (AAAT_PREPAID = 'Y') THEN 1 ELSE 0 END) AS ALLCUPRE,
	SUM(CASE WHEN (AAAT_PREPAID = 'N' AND AAAT_DATECRE<SYSDATE-180) THEN 1 ELSE 0 END) AS EXSCUPOST,
	SUM(CASE WHEN (AAAT_PREPAID = 'N' AND AAAT_DATECRE>=SYSDATE-180) THEN 1 ELSE 0 END) AS NEWCUPOST,
	SUM(CASE WHEN (AAAT_PREPAID = 'N') THEN 1 ELSE 0 END) AS ALLCUPOST,
	SUM(CASE WHEN (AAAT_PREPAID IS NOT NULL) THEN 1 ELSE 0 END) AS TOTAL,
	0.0
FROM    AAATRACKING, SICACHE
WHERE   SIC_MSISDN = to_number(AAAT_MSISDN)
AND     AAAT_TOPSCM = 0
AND     AAAT_ESID <> 'C'
AND     SIC_PAYMENT_METHOD <> 9

UNION ALL
SELECT
	'Ausgabenlimite CHF ' || AAAT_TOPSCM Description,
    'Swisscom' BARRING,
	SUM(CASE WHEN (AAAT_PREPAID = 'Y' AND AAAT_DATECRE<SYSDATE-180) THEN 1 ELSE 0 END) AS EXSCUPRE,
	SUM(CASE WHEN (AAAT_PREPAID = 'Y' AND AAAT_DATECRE>=SYSDATE-180) THEN 1 ELSE 0 END) AS NEWCUPRE,
	SUM(CASE WHEN (AAAT_PREPAID = 'Y') THEN 1 ELSE 0 END) AS ALLCUPRE,
	SUM(CASE WHEN (AAAT_PREPAID = 'N' AND AAAT_DATECRE<SYSDATE-180) THEN 1 ELSE 0 END) AS EXSCUPOST,
	SUM(CASE WHEN (AAAT_PREPAID = 'N' AND AAAT_DATECRE>=SYSDATE-180) THEN 1 ELSE 0 END) AS NEWCUPOST,
	SUM(CASE WHEN (AAAT_PREPAID = 'N') THEN 1 ELSE 0 END) AS ALLCUPOST,
	SUM(CASE WHEN (AAAT_PREPAID IS NOT NULL) THEN 1 ELSE 0 END) AS TOTAL,
	AAAT_TOPSCM
FROM    AAATRACKING, SICACHE
WHERE   SIC_MSISDN = to_number(AAAT_MSISDN)
AND     AAAT_TOPSCM <> 0.00
AND     AAAT_ESID <> 'C'
AND     SIC_PAYMENT_METHOD <> 9
GROUP BY AAAT_TOPSCM
	
UNION ALL
SELECT
	'Ausgabenlimite CHF ' || AAAT_TOPCU Description,
    'Kunde' BARRING,
	SUM(CASE WHEN (AAAT_PREPAID = 'Y' AND AAAT_DATECRE<SYSDATE-180) THEN 1 ELSE 0 END) AS EXSCUPRE,
	SUM(CASE WHEN (AAAT_PREPAID = 'Y' AND AAAT_DATECRE>=SYSDATE-180) THEN 1 ELSE 0 END) AS NEWCUPRE,
	SUM(CASE WHEN (AAAT_PREPAID = 'Y') THEN 1 ELSE 0 END) AS ALLCUPRE,
	SUM(CASE WHEN (AAAT_PREPAID = 'N' AND AAAT_DATECRE<SYSDATE-180) THEN 1 ELSE 0 END) AS EXSCUPOST,
	SUM(CASE WHEN (AAAT_PREPAID = 'N' AND AAAT_DATECRE>=SYSDATE-180) THEN 1 ELSE 0 END) AS NEWCUPOST,
	SUM(CASE WHEN (AAAT_PREPAID = 'N') THEN 1 ELSE 0 END) AS ALLCUPOST,
	SUM(CASE WHEN (AAAT_PREPAID IS NOT NULL) THEN 1 ELSE 0 END) AS TOTAL,
	AAAT_TOPCU
FROM    AAATRACKING, SICACHE
WHERE   SIC_MSISDN = to_number(AAAT_MSISDN)
AND     AAAT_TOPCU <> 0.00
AND     AAAT_ESID <> 'C'
AND     SIC_PAYMENT_METHOD <> 9
GROUP BY AAAT_TOPCU
	
UNION ALL
SELECT
	'Erreichte Ausgabelimite' Description,
	'' BARRING,
	SUM(CASE WHEN (AAAT_PREPAID = 'Y' AND AAAT_DATECRE<SYSDATE-180) THEN 1 ELSE 0 END) AS EXSCUPRE,
	SUM(CASE WHEN (AAAT_PREPAID = 'Y' AND AAAT_DATECRE>=SYSDATE-180) THEN 1 ELSE 0 END) AS NEWCUPRE,
	SUM(CASE WHEN (AAAT_PREPAID = 'Y') THEN 1 ELSE 0 END) AS ALLCUPRE,
	SUM(CASE WHEN (AAAT_PREPAID = 'N' AND AAAT_DATECRE<SYSDATE-180) THEN 1 ELSE 0 END) AS EXSCUPOST,
	SUM(CASE WHEN (AAAT_PREPAID = 'N' AND AAAT_DATECRE>=SYSDATE-180) THEN 1 ELSE 0 END) AS NEWCUPOST,
	SUM(CASE WHEN (AAAT_PREPAID = 'N') THEN 1 ELSE 0 END) AS ALLCUPOST,
	SUM(CASE WHEN (AAAT_PREPAID IS NOT NULL) THEN 1 ELSE 0 END) AS TOTAL,
	999999.99
FROM    AAATRACKING, SICACHE
WHERE   SIC_MSISDN = to_number(AAAT_MSISDN)
AND     AAAT_CHARGED >= DECODE(AAAT_TOPSCM,0,500,AAAT_TOPSCM)
AND     AAAT_ESID <> 'C'
AND     SIC_PAYMENT_METHOD <> 9
ORDER BY 2, 10;


--
-- SR086A_DETAILS_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR086A_DETAILS_1
(ERROR_CODE, ERRD_VALUE1, ERRD_VALUE2, ERRD_LANG01, BDCTL_DATEFC, 
 BDCTL_DATELC, BDCTL_COUNT_SUB, BDCTL_COUNT_DEL, BDCTL_COUNT_TRY)
BEQUEATH DEFINER
AS 
SELECT
    bdctl_errid, --'SMSC' || to_char(to_number(bdctl_errid) - 2000000000),
    ERRD_VALUE1,
    '0x' || ERRD_VALUE2,
    ERRD_LANG01,
    BDCTL_DATEFC,
    BDCTL_DATELC,
    BDCTL_COUNT_SUB,
    BDCTL_COUNT_DEL,
    BDCTL_COUNT_TRY
FROM
    SR086A_BASE_1,
    ERRDEF
WHERE
    ERRD_ID(+) = BDCTL_ERRID
ORDER BY
    BDCTL_COUNT_SUB DESC,
    BDCTL_COUNT_TRY DESC;


--
-- SR086A_DETAILS_2  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR086A_DETAILS_2
(ITEM_RANK, ERROR_CODE, ERROR_DESC, ERROR_NUM, ERROR_HEX, 
 PEAL_COUNT)
BEQUEATH DEFINER
AS 
SELECT
    "ITEM",
    ERRD_CODE,
    ERRD_LANG01,
    SUBSTR(ERRD_CODE,5),
    '0x' || ERRD_VALUE2,
    "BDCTL_COUNT"
FROM
    SR086A_CTRL_2,
    ERRDEF
WHERE
    BDCTL_ERRID = ERRDEF.ERRD_ID(+);


--
-- SR086A_DETAILS_3  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR086A_DETAILS_3
(BDCTL_DATETIME, BDCTL_SUBMITS, BDCTL_RETALL, BDCTL_RET1, BDCTL_RET2, 
 BDCTL_RET3, BDCTL_RET4, BDCTL_RET5, BDCTL_RETOTHERS)
BEQUEATH DEFINER
AS 
SELECT
   to_char(BDCTL_DATETIME,'Mon YYYY','NLS_DATE_LANGUAGE = American'),
   DECODE(SUM(BDCTL_SUBMITS),0,0.001,SUM(BDCTL_SUBMITS)),
   DECODE(SUM(BDCTL_RETALL),0,0.001,SUM(BDCTL_RETALL)),
   DECODE(SUM(BDCTL_RET1),0,0.001,SUM(BDCTL_RET1)),
   DECODE(SUM(BDCTL_RET2),0,0.001,SUM(BDCTL_RET2)),
   DECODE(SUM(BDCTL_RET3),0,0.001,SUM(BDCTL_RET3)),
   DECODE(SUM(BDCTL_RET4),0,0.001,SUM(BDCTL_RET4)),
   DECODE(SUM(BDCTL_RET5),0,0.001,SUM(BDCTL_RET5)),
   DECODE(SUM(BDCTL_RETALL-BDCTL_RET1-BDCTL_RET2-BDCTL_RET3-BDCTL_RET4-BDCTL_RET5),0,0.001,SUM(BDCTL_RETALL-BDCTL_RET1-BDCTL_RET2-BDCTL_RET3-BDCTL_RET4-BDCTL_RET5))
FROM    SR086A_BASE_3
GROUP BY BDCTL_DATETIME
ORDER BY BDCTL_DATETIME;


--
-- SR111A_DETAILS_13  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR111A_DETAILS_13
(ENUM_ID, DATE_PERIOD, DATE_DAYS, COUNT_LONGIDS)
BEQUEATH DEFINER
AS 
select
    ENUM_ID
    ,
    DATE_PERIOD
    ,
    DATE_DAYS
    ,
    COUNT(*)
from    LONGID, SR111A_PERIOD
where   NVL(LONG_DATEEND,DATE_UNTIL) >= DATE_FROM
and     LONG_DATESTART  < DATE_UNTIL
and     LONG_ESID = 'M'
and     LONG_ID >= 41798070000
and     LONG_ID <= 41798079999
group by ENUM_ID, DATE_PERIOD, DATE_DAYS

order by 1;


--
-- SR111A_DETAILS_6  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR111A_DETAILS_6
(ENUM_ID, DATE_PERIOD, DATE_DAYS, COUNT_MONTH, COUNT_DAY, 
 COUNT_MIN, COUNT_MAX)
BEQUEATH DEFINER
AS 
select
    ENUM_ID
    ,
    DATE_PERIOD
    ,
    DATE_DAYS
    ,
    SUM(COUNT_MSISDN)
    ,
    SUM(COUNT_MSISDN) / DATE_DAYS
    ,
    MIN(COUNT_MSISDN)
    ,
    MAX(COUNT_MSISDN)

from    SR111A_BASE_6, SR111A_PERIOD
where   DATE_DAY >= DATE_FROM
and     DATE_DAY < DATE_UNTIL
group by ENUM_ID, DATE_PERIOD, DATE_DAYS
order by 1;


--
-- SR111A_DETAILS_8  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR111A_DETAILS_8
(ENUM_ID, DATE_PERIOD, DATE_DAYS, COUNT_MONTH, COUNT_DAY, 
 COUNT_MIN, COUNT_MAX)
BEQUEATH DEFINER
AS 
select
    ENUM_ID
    ,
    DATE_PERIOD
    ,
    DATE_DAYS
    ,
    SUM(COUNT_SEARCH)
    ,
    SUM(COUNT_SEARCH) / DATE_DAYS
    ,
    MIN(COUNT_SEARCH)
    ,
    MAX(COUNT_SEARCH)

from    SR111A_BASE_8, SR111A_PERIOD
where   DATE_DAY >= DATE_FROM
and     DATE_DAY < DATE_UNTIL
group by ENUM_ID, DATE_PERIOD, DATE_DAYS
order by 1;


--
-- SR111A_DETAILS_9  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR111A_DETAILS_9
(ENUM_ID, DATE_PERIOD, DATE_DAYS, BARRINGS_MONTH, BARRINGS_DAY, 
 BARRINGS_MIN, BARRINGS_MAX, UNBARRINGS_MONTH, UNBARRINGS_DAY, UNBARRINGS_MIN, 
 UNBARRINGS_MAX, TSCROSS_MONTH, TSCROSS_DAY, TSCROSS_MIN, TSCROSS_MAX)
BEQUEATH DEFINER
AS 
select
    ENUM_ID
    ,
    DATE_PERIOD
    ,
    DATE_DAYS
    ,
    SUM(COUNT_BARRING)
    ,
    SUM(COUNT_BARRING) / DATE_DAYS
    ,
    MIN(COUNT_BARRING)
    ,
    MAX(COUNT_BARRING)
    ,
    SUM(COUNT_UNBARRING)
    ,
    SUM(COUNT_UNBARRING) / DATE_DAYS
    ,
    MIN(COUNT_UNBARRING)
    ,
    MAX(COUNT_UNBARRING)
    ,
    SUM(COUNT_TSCROSS)
    ,
    SUM(COUNT_TSCROSS) / DATE_DAYS
    ,
    MIN(COUNT_TSCROSS)
    ,
    MAX(COUNT_TSCROSS)

from    SR111A_BASE_9, SR111A_PERIOD
where   DATE_DAY >= DATE_FROM
and     DATE_DAY < DATE_UNTIL
group by ENUM_ID, DATE_PERIOD, DATE_DAYS
order by 1;


--
-- STA_CHECKBT_ISCONSOL  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.STA_CHECKBT_ISCONSOL
(MINDATE, MAXDATE)
BEQUEATH DEFINER
AS 
select min(minDate) minDate, max(maxDate) maxDate
from (
  select min(isc_date) minDate, to_date(null) maxDate
  from isconsol
  where isc_esid='R'
  union
  select to_date(null) minDate, max(isc_date) maxDate
  from isconsol
  where isc_esid='R'
);


--
-- STA_CHECKBT_ROCONSOLIDATION  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.STA_CHECKBT_ROCONSOLIDATION
(MINDATE, MAXDATE)
BEQUEATH DEFINER
AS 
select min(minDate) minDate, max(maxDate) maxDate
from (
  select min(roc_fromdate) minDate, to_date(null) maxDate
  from roconsolidation
  where roc_esid='R'
  union
  select to_date(null) minDate, max(roc_todate) maxDate
  from roconsolidation
  where roc_esid='R'
);


--
-- STA_CHECKBT_TRCONSOL  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.STA_CHECKBT_TRCONSOL
(MINDATE, MAXDATE)
BEQUEATH DEFINER
AS 
select min(minDate) minDate, max(maxDate) maxDate
from (
  select trunc(to_date(trc_sepid, 'YYYYMM')) minDate, to_date(null) maxDate
  from trconsol
  where trc_esid='R'
  union
  select to_date(null) minDate, trunc(add_months(to_date(trc_sepid, 'YYYYMM'),1))-1 maxDate
  from trconsol
  where trc_esid='R'
);


--
-- LONGID_MAPPING  (Trigger) 
--
CREATE OR REPLACE TRIGGER SBS1_ADMIN.longid_mapping
 AFTER
   INSERT OR DELETE OR UPDATE OF longm_price, longm_dateend, longm_datestart, longm_shortid, longm_longid1, longm_longid2, longm_esid
 ON SBS1_ADMIN.LONGIDMAP
REFERENCING NEW AS NEW OLD AS OLD
 FOR EACH ROW
DECLARE
-- Purpose: Keep LONGID table in sync with LONGIDMAP when the latter is modified
--
-- MODIFICATION HISTORY
-- Person   Date        Comments
-- -----    ----------  ------------------------------------------
-- 001SO    23.06.2017  Trigger created
-- 002SO    23.06.2017  fix inconsistancies in update/insert combinations

/*
    LONG_ID,
    LONG_ESID,
    LONG_DATESTART,
    LONG_DATEEND,
    LONG_SHORTID,
    LONG_PRICE,
    LONG_COMMENT,
    LONG_CHANGEID,
    LONG_FORCE
    
    M   MAPPED
    I   INACTIVE
    F   FRESH
    R   RECOVERED
    D   DELETED

        LONGM_LONGID1
        LONGM_LONGID2
        LONGM_ESID
        LONGM_DATESTART
        LONGM_DATEEND
        LONGM_SHORTID
        LONGM_PRICE
        LONGM_OCCUPIED
        LONGM_AVAILABLE
*/
    vMe                varchar2(30) := 'LONGID_MAPPING';
    bDebug             boolean := true;

    l_shortid   VARCHAR2(10) := NULL;
    l_operation VARCHAR2(40) := NULL;
    l_longid    NUMBER;
begin

    if INSERTING then

        FOR l_longid IN 0 .. (:new.LONGM_LONGID2 - :new.LONGM_LONGID1) LOOP
            UPDATE LONGID SET
                LONG_ESID = :new.LONGM_ESID,
                LONG_DATESTART = :new.LONGM_DATESTART,
                LONG_DATEEND = :new.LONGM_DATEEND,
                LONG_SHORTID = :new.LONGM_SHORTID,
                LONG_PRICE = :new.LONGM_PRICE,
                LONG_CHANGEID = LONGIDHIST_SEQ.NEXTVAL,
                LONG_FORCE = 0
            WHERE LONG_ID = :new.LONGM_LONGID1 + l_longid;
            IF sql%rowcount = 0 THEN                                            -- 002SO 
                INSERT INTO LONGID (
                    LONG_ID,
                    LONG_ESID,
                    LONG_DATESTART,
                    LONG_DATEEND,
                    LONG_SHORTID,
                    LONG_PRICE,
                    LONG_CHANGEID,
                    LONG_FORCE
                ) VALUES (
                    :new.LONGM_LONGID1 + l_longid,
                    :new.LONGM_ESID,
                    :new.LONGM_DATESTART,
                    :new.LONGM_DATEEND,
                    :new.LONGM_SHORTID,
                    :new.LONGM_PRICE,
                    LONGIDHIST_SEQ.NEXTVAL,
                    0
                );
            END IF;

        END LOOP;

    elsif DELETING then

        DELETE FROM LONGID 
        WHERE LONG_ID >= :old.LONGM_LONGID1
        and LONG_ID <= :old.LONGM_LONGID2
        ;

    elsif UPDATING and ( :new.LONGM_ESID <> :old.LONGM_ESID
                 or :new.LONGM_DATESTART <> :old.LONGM_DATESTART
                 or NVL(:new.LONGM_DATEEND,sysdate) <> NVL(:old.LONGM_DATEEND,sysdate)
                 or NVL(:new.LONGM_SHORTID,'NA') <> NVL(:old.LONGM_SHORTID,'NA')
                 or NVL(:new.LONGM_PRICE, -9.9999) <> NVL(:old.LONGM_PRICE, -9.9999)
            ) then

        FOR l_longid IN 0 .. (:new.LONGM_LONGID2 - :new.LONGM_LONGID1) LOOP
            UPDATE LONGID SET
                LONG_ESID = :new.LONGM_ESID,
                LONG_DATESTART = :new.LONGM_DATESTART,
                LONG_DATEEND = :new.LONGM_DATEEND,
                LONG_SHORTID = :new.LONGM_SHORTID,
                LONG_PRICE = :new.LONGM_PRICE,
                LONG_CHANGEID = LONGIDHIST_SEQ.NEXTVAL,
                LONG_FORCE = 0
            WHERE LONG_ID = :new.LONGM_LONGID1 + l_longid;
            IF sql%rowcount = 0 THEN                                            -- 002SO 
                INSERT INTO LONGID (
                    LONG_ID,
                    LONG_ESID,
                    LONG_DATESTART,
                    LONG_DATEEND,
                    LONG_SHORTID,
                    LONG_PRICE,
                    LONG_CHANGEID,
                    LONG_FORCE
                ) VALUES (
                    :new.LONGM_LONGID1 + l_longid,
                    :new.LONGM_ESID,
                    :new.LONGM_DATESTART,
                    :new.LONGM_DATEEND,
                    :new.LONGM_SHORTID,
                    :new.LONGM_PRICE,
                    LONGIDHIST_SEQ.NEXTVAL,
                    0
                );
            END IF;
        END LOOP;

    end if;

end;
/


--
-- ACCOUNT  (Table) 
--
CREATE TABLE SBS1_ADMIN.ACCOUNT
(
  AC_ID                 VARCHAR2(10 BYTE)       NOT NULL,
  AC_ETID               VARCHAR2(10 BYTE)       NOT NULL,
  AC_DEMO               NUMBER(1)               NOT NULL,
  AC_NUMBER             VARCHAR2(10 BYTE),
  AC_NAME               VARCHAR2(100 BYTE)      NOT NULL,
  AC_SHORT              VARCHAR2(15 BYTE)       NOT NULL,
  AC_PWD                VARCHAR2(60 BYTE),
  AC_MBUNIT             VARCHAR2(10 BYTE),
  AC_LOGRET             NUMBER(2)               NOT NULL,
  AC_MAXLOG             NUMBER(2),
  AC_LASTLOGINTIME      DATE,
  AC_IPMASK             VARCHAR2(50 BYTE),
  AC_LANGID             VARCHAR2(2 BYTE)        NOT NULL,
  AC_VAT                NUMBER(1)               NOT NULL,
  AC_VATIDENT           VARCHAR2(10 BYTE),
  AC_ACCPAYNO           VARCHAR2(10 BYTE),
  AC_DEPTORNO           VARCHAR2(10 BYTE),
  AC_PAYTERMS           VARCHAR2(80 BYTE),
  AC_CURRENCY           VARCHAR2(10 BYTE)       NOT NULL,
  AC_VATNUMBER          VARCHAR2(40 BYTE),
  AC_ESID               VARCHAR2(10 BYTE)       NOT NULL,
  AC_DEPTID             VARCHAR2(10 BYTE),
  AC_ADRID_MAIN         VARCHAR2(10 BYTE)       NOT NULL,
  AC_ADRID_MAINCONTACT  VARCHAR2(10 BYTE),
  AC_ADRID_MARKETING    VARCHAR2(10 BYTE),
  AC_ADRID_TECHNICAL    VARCHAR2(10 BYTE),
  AC_ADRID_HELPDESK     VARCHAR2(10 BYTE),
  AC_ADRID_FINANCE      VARCHAR2(10 BYTE),
  AC_ADRID_OTHERS       VARCHAR2(10 BYTE),
  AC_ADRID_INVOICE      VARCHAR2(10 BYTE),
  AC_ACCNUMBER          VARCHAR2(40 BYTE),
  AC_ACCNAME            VARCHAR2(40 BYTE),
  AC_ACCADDRESS         VARCHAR2(1000 BYTE),
  AC_ACCCLEARNO         VARCHAR2(40 BYTE),
  AC_DATECRE            DATE,
  AC_ACIDCRE            VARCHAR2(10 BYTE),
  AC_DATEMOD            DATE,
  AC_ACIDMOD            VARCHAR2(10 BYTE),
  AC_DBIDSTORE          VARCHAR2(2 BYTE),
  AC_DBIDARCH           VARCHAR2(2 BYTE),
  AC_COMMENT            VARCHAR2(2000 BYTE),
  AC_CHNGCNT            NUMBER(5),
  AC_DEPT               VARCHAR2(40 BYTE),
  AC_REMOTEADDR         VARCHAR2(40 BYTE),
  AC_TPID               VARCHAR2(10 BYTE),
  AC_PWDHIST            VARCHAR2(1000 BYTE),
  AC_DATEPWDMOD         DATE,
  AC_PWDVALIDITY        NUMBER(2),
  AC_BN_STATS_EMAILS    VARCHAR2(4000 BYTE),
  AC_LA_INVOICE_EMAILS  VARCHAR2(4000 BYTE)
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.ACCOUNT IS 'Account';

COMMENT ON COLUMN SBS1_ADMIN.ACCOUNT.AC_PWD IS 'password encrypted';

COMMENT ON COLUMN SBS1_ADMIN.ACCOUNT.AC_TPID IS 'third party id';


--
-- BDCONSOLIDATION  (Table) 
--
CREATE TABLE SBS1_ADMIN.BDCONSOLIDATION
(
  BDC_ID             VARCHAR2(10 BYTE)          NOT NULL,
  BDC_ETID           VARCHAR2(10 BYTE)          NOT NULL,
  BDC_ESID           VARCHAR2(10 BYTE)          NOT NULL,
  BDC_DATE           DATE,
  BDC_SEPID          VARCHAR2(10 BYTE),
  BDC_FROMDATE       DATE,
  BDC_TODATE         DATE,
  BDC_CONID          VARCHAR2(10 BYTE),
  BDC_CONSOLIDATION  VARCHAR2(6 BYTE),
  BDC_PMVID          VARCHAR2(10 BYTE),
  BDC_TARID          VARCHAR2(1 BYTE),
  BDC_VSMSCID        VARCHAR2(20 BYTE),
  BDC_NPI_A          VARCHAR2(3 BYTE),
  BDC_PID_A          VARCHAR2(3 BYTE),
  BDC_TON_A          VARCHAR2(3 BYTE),
  BDC_NPI_B          VARCHAR2(3 BYTE),
  BDC_PID_B          VARCHAR2(3 BYTE),
  BDC_TON_B          VARCHAR2(3 BYTE),
  BDC_COUNT          NUMBER(12),
  BDC_AMOUNTCU       NUMBER(12,4),
  BDC_RETSHAREPV     NUMBER(12,4),
  BDC_RETSHAREMO     NUMBER(12,4),
  BDC_PREPAID        VARCHAR2(1 BYTE),
  BDC_SERVICE        VARCHAR2(10 BYTE),
  BDC_BILLRATE       NUMBER(3),
  BDC_REQTYPE        NUMBER(4),
  BDC_INT            VARCHAR2(1 BYTE)
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.BDCONSOLIDATION IS 'bd consolidation';


--
-- BIHEADER  (Table) 
--
CREATE TABLE SBS1_ADMIN.BIHEADER
(
  BIH_ID            VARCHAR2(10 BYTE)           NOT NULL,
  BIH_SRCTYPE       VARCHAR2(10 BYTE)           NOT NULL,
  BIH_DEMO          NUMBER(1)                   NOT NULL,
  BIH_IDENT         VARCHAR2(6 BYTE),
  BIH_FILESEQ       NUMBER(8)                   NOT NULL,
  BIH_FILEFORM      NUMBER(2),
  BIH_DATETIME      DATE                        NOT NULL,
  BIH_FILENAME      VARCHAR2(100 BYTE)          NOT NULL,
  BIH_FILEDATE      DATE                        NOT NULL,
  BIH_RECCOUNT      NUMBER(8),
  BIH_DATEFC        DATE,
  BIH_DATELC        DATE,
  BIH_MAPID         VARCHAR2(10 BYTE)           NOT NULL,
  BIH_START         DATE,
  BIH_END           DATE,
  BIH_ESID          VARCHAR2(3 BYTE),
  BIH_DATEIDX       DATE,
  BIH_EXE           VARCHAR2(100 BYTE),
  BIH_VERSION       VARCHAR2(10 BYTE),
  BIH_JOB           NUMBER(2),
  BIH_HOST          VARCHAR2(100 BYTE),
  BIH_HIHID         VARCHAR2(10 BYTE),
  BIH_REVASID       VARCHAR2(10 BYTE),
  BIH_DATEANALYZED  DATE,
  BIH_WHSYNCSID     VARCHAR2(10 BYTE),
  BIH_WHSYNCDATE    DATE,
  BIH_ERRCOUNT      NUMBER(8),
  BIH_THREAD        VARCHAR2(100 BYTE),
  BIH_INDEXSID      VARCHAR2(1 BYTE)
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          104K
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.BIHEADER IS 'Billing input header';


--
-- CONTRACT  (Table) 
--
CREATE TABLE SBS1_ADMIN.CONTRACT
(
  CON_ID              VARCHAR2(10 BYTE)         NOT NULL,
  CON_SRCTYPE         VARCHAR2(10 BYTE)         NOT NULL,
  CON_ETID            VARCHAR2(10 BYTE)         NOT NULL,
  CON_ACID            VARCHAR2(10 BYTE)         NOT NULL,
  CON_NAME            VARCHAR2(100 BYTE),
  CON_PSCALL          VARCHAR2(20 BYTE),
  CON_OPKEY           VARCHAR2(10 BYTE),
  CON_HDGROUP         NUMBER(1),
  CON_RSID            VARCHAR2(10 BYTE),
  CON_INVCONTPERSON   VARCHAR2(100 BYTE),
  CON_PMID            VARCHAR2(10 BYTE),
  CON_ESID            VARCHAR2(10 BYTE)         NOT NULL,
  CON_MBUID           VARCHAR2(10 BYTE),
  CON_CONSOL          VARCHAR2(6 BYTE),
  CON_TARID           VARCHAR2(1 BYTE),
  CON_PRICE           NUMBER(6,4),
  CON_PRICEINT        NUMBER(6,4),
  CON_PRICEHG         NUMBER(6,4),
  CON_MINCHARGE       NUMBER(12,4),
  CON_TESTSTART       DATE,
  CON_TESTEND         DATE,
  CON_THROUGPUT       NUMBER(9,4),
  CON_DATECRE         DATE,
  CON_ACIDCRE         VARCHAR2(10 BYTE),
  CON_DATEMOD         DATE,
  CON_ACIDMOD         VARCHAR2(10 BYTE),
  CON_DATESTART       DATE,
  CON_DATETEST        DATE,
  CON_DATEEND         DATE,
  CON_DATEBLOCK       DATE,
  CON_CHNGCNT         NUMBER(5),
  CON_CODE            VARCHAR2(10 BYTE),
  CON_MCEFF           NUMBER(12,4),
  CON_MCAPPLIED       NUMBER(12,4),
  CON_IPCONID         VARCHAR2(10 BYTE),
  CON_PRICECU         NUMBER(6,4),
  CON_REFUNDCU        NUMBER(6,4),
  CON_RETSHAREPV      NUMBER(6,4),
  CON_MOROAMINGPROM   NUMBER(1),
  CON_MTROAMINGPROM   NUMBER(1),
  CON_IGNORE_DUOBILL  NUMBER(1),
  CON_RARR_ALLOWED    NUMBER(1),
  CON_RARR_HIDDEN     NUMBER(1),
  CON_ESTID           VARCHAR2(10 BYTE),
  CON_SHORTID         VARCHAR2(6 BYTE),
  CON_PRICEMO         NUMBER(6,4),
  CON_PRICEMOFN       NUMBER(6,4),
  CON_IWRS            NUMBER(7,4),
  CON_MFGR            NUMBER(10,4),
  CON_MFLID           NUMBER(6,4),
  CON_VIRTUAL         NUMBER(1),
  CON_HUB             VARCHAR2(10 BYTE),
  CON_ULNRP           VARCHAR2(500 BYTE),
  CON_VATO            NUMBER(10,4),
  CON_VATT            NUMBER(10,4),
  CON_JSON            VARCHAR2(4000 BYTE),
  CON_SETOPT          VARCHAR2(10 BYTE),
  CON_PRICEPG         NUMBER(6,4),
  CON_HOTLINEPHONE    VARCHAR2(100 BYTE),
  CON_HOTLINEEMAIL    VARCHAR2(100 BYTE),
  CON_PROVIDERNAME    VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.CONTRACT IS 'Contract';

COMMENT ON COLUMN SBS1_ADMIN.CONTRACT.CON_ETID IS 'contract type id (entity type)';

COMMENT ON COLUMN SBS1_ADMIN.CONTRACT.CON_MCEFF IS 'effective min charge';

COMMENT ON COLUMN SBS1_ADMIN.CONTRACT.CON_MCAPPLIED IS 'applied min charge';

COMMENT ON COLUMN SBS1_ADMIN.CONTRACT.CON_RARR_ALLOWED IS 'allow RARR routing when sending';

COMMENT ON COLUMN SBS1_ADMIN.CONTRACT.CON_RARR_HIDDEN IS 'hide RARR shortid when receiving';

COMMENT ON COLUMN SBS1_ADMIN.CONTRACT.CON_ESTID IS 'contract subtype id (entity subtype)';

COMMENT ON COLUMN SBS1_ADMIN.CONTRACT.CON_SHORTID IS 'Short ID';


--
-- ISSUE  (Table) 
--
CREATE TABLE SBS1_ADMIN.ISSUE
(
  IS_ID             VARCHAR2(10 BYTE)           NOT NULL,
  IS_CHNGCNT        NUMBER(6),
  IS_ACIDCRE        VARCHAR2(10 BYTE),
  IS_DATECRE        DATE,
  IS_ACIDMOD        VARCHAR2(10 BYTE),
  IS_DATEMOD        DATE,
  IS_ACIDRESP       VARCHAR2(10 BYTE)           NOT NULL,
  IS_CONID          VARCHAR2(10 BYTE),
  IS_DESCRIPTION    VARCHAR2(2000 BYTE),
  IS_ETID           VARCHAR2(10 BYTE)           NOT NULL,
  IS_ESID           VARCHAR2(10 BYTE)           NOT NULL,
  IS_DEADLINE       DATE,
  IS_VISUM          VARCHAR2(10 BYTE),
  IS_DATEFINALIZED  DATE,
  IS_ACID           VARCHAR2(10 BYTE)
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.ISSUE IS 'issue';

COMMENT ON COLUMN SBS1_ADMIN.ISSUE.IS_ACID IS 'Issue belongs to Account Id ';


--
-- KEYWORD  (Table) 
--
CREATE TABLE SBS1_ADMIN.KEYWORD
(
  KEY_ID        VARCHAR2(10 BYTE)               NOT NULL,
  KEY_CONID     VARCHAR2(10 BYTE)               NOT NULL,
  KEY_KEYWORD   VARCHAR2(40 BYTE),
  KEY_BILLRATE  VARCHAR2(3 BYTE),
  KEY_ALLOWED   NUMBER(1),
  KEY_DETECTED  DATE,
  KEY_COUNTDET  NUMBER(8),
  KEY_DATECRE   DATE,
  KEY_ACIDCRE   VARCHAR2(10 BYTE),
  KEY_DATEMOD   DATE,
  KEY_ACIDMOD   VARCHAR2(10 BYTE),
  KEY_CHNGCNT   NUMBER(5)
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.KEYWORD IS 'Keyword';


--
-- LONGIDHIST  (Table) 
--
CREATE TABLE SBS1_ADMIN.LONGIDHIST
(
  LONGH_ID        VARCHAR2(10 BYTE)             NOT NULL,
  LONGH_DATETIME  DATE                          NOT NULL,
  LONGH_ACID      VARCHAR2(10 BYTE)             NOT NULL,
  LONGH_FORCE     NUMBER(1)                     NOT NULL,
  LONGH_COMMENT   VARCHAR2(2000 BYTE)
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.LONGIDHIST IS 'History of Long ID mapping changes
';


--
-- LONGIDHISTDET  (Table) 
--
CREATE TABLE SBS1_ADMIN.LONGIDHISTDET
(
  LONGHD_LONGHID   VARCHAR2(10 BYTE)            NOT NULL,
  LONGHD_SHORTID   VARCHAR2(5 BYTE),
  LONGHD_LONGID    NUMBER(11)                   NOT NULL,
  LONGHD_DATETIME  DATE                         NOT NULL,
  LONGHD_MESSAGE   VARCHAR2(2000 BYTE)
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.LONGIDHISTDET IS 'History Details of Long ID mapping changes
';


--
-- MMSCADD  (Table) 
--
CREATE TABLE SBS1_ADMIN.MMSCADD
(
  MMSA_ADRID    VARCHAR2(10 BYTE)               NOT NULL,
  MMSA_CONID    VARCHAR2(10 BYTE)               NOT NULL,
  MMSA_ETID     VARCHAR2(10 BYTE)               NOT NULL,
  MMSA_ADDRESS  VARCHAR2(20 BYTE),
  MMSA_CHANNEL  VARCHAR2(20 BYTE),
  MMSA_CPORT    NUMBER(5),
  MMSA_LPORT    NUMBER(5),
  MMSA_TASK     VARCHAR2(1 BYTE),
  MMSA_CHNGCNT  NUMBER(5)
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.MMSCADD IS 'MMSC Contract Address';

COMMENT ON COLUMN SBS1_ADMIN.MMSCADD.MMSA_ADRID IS 'mms large account address id';

COMMENT ON COLUMN SBS1_ADMIN.MMSCADD.MMSA_CONID IS 'mmsc contract id';

COMMENT ON COLUMN SBS1_ADMIN.MMSCADD.MMSA_ETID IS 'type';

COMMENT ON COLUMN SBS1_ADMIN.MMSCADD.MMSA_ADDRESS IS 'address';

COMMENT ON COLUMN SBS1_ADMIN.MMSCADD.MMSA_CHANNEL IS 'channel';

COMMENT ON COLUMN SBS1_ADMIN.MMSCADD.MMSA_CPORT IS 'connection port';

COMMENT ON COLUMN SBS1_ADMIN.MMSCADD.MMSA_LPORT IS 'listener port';

COMMENT ON COLUMN SBS1_ADMIN.MMSCADD.MMSA_TASK IS 'mmsc task';

COMMENT ON COLUMN SBS1_ADMIN.MMSCADD.MMSA_CHNGCNT IS 'change counter';


--
-- MMSCONSOLIDATION  (Table) 
--
CREATE TABLE SBS1_ADMIN.MMSCONSOLIDATION
(
  MMSC_ID               VARCHAR2(10 BYTE)       NOT NULL,
  MMSC_ETID             VARCHAR2(10 BYTE)       NOT NULL,
  MMSC_ESID             VARCHAR2(10 BYTE)       NOT NULL,
  MMSC_DATE             DATE,
  MMSC_SEPID            VARCHAR2(10 BYTE),
  MMSC_FROMDATE         DATE,
  MMSC_TODATE           DATE,
  MMSC_PREPAID          VARCHAR2(1 BYTE),
  MMSC_MSGPRIORITY      NUMBER(8),
  MMSC_MSGCLASS         NUMBER(8),
  MMSC_CDRRECTYPE       VARCHAR2(10 BYTE),
  MMSC_FWDCOPYIND       NUMBER(8),
  MMSC_EVENTDISP        NUMBER(8),
  MMSC_LEGACYINDICATOR  NUMBER(8),
  MMSC_TRCLASS          NUMBER(10,3),
  MMSC_SHORTID          VARCHAR2(6 BYTE),
  MMSC_CONID            VARCHAR2(10 BYTE),
  MMSC_PMVID            VARCHAR2(10 BYTE),
  MMSC_ZNID             VARCHAR2(10 BYTE),
  MMSC_COUNT            NUMBER(12),
  MMSC_NUMNOTIFICATION  NUMBER(12),
  MMSC_NUMHOMERECIP     NUMBER(12),
  MMSC_NUMNONHOMERECIP  NUMBER(12),
  MMSC_NUMINTLRECIP     NUMBER(12),
  MMSC_NUMEMAILRECIP    NUMBER(12),
  MMSC_NUMSCODERECIP    NUMBER(12),
  MMSC_MSGTYPE          NUMBER(2),
  MMSC_AMOUNTTR         NUMBER(12,4),
  MMSC_AMOUNTCU         NUMBER(12,4),
  MMSC_RETSHAREPV       NUMBER(12,4),
  MMSC_RETSHAREMO       NUMBER(12,4),
  MMSC_TARID            VARCHAR2(1 BYTE),
  MMSC_TOCID            VARCHAR2(10 BYTE),
  MMSC_INT              VARCHAR2(1 BYTE),
  MMSC_IW               VARCHAR2(1 BYTE),
  MMSC_IOT              NUMBER(12,4),
  MMSC_IOT_INTERNAL     NUMBER(12,4)
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.MMSCONSOLIDATION IS 'MMS consolidation';


--
-- PRMODELENTRY  (Table) 
--
CREATE TABLE SBS1_ADMIN.PRMODELENTRY
(
  PME_ID           VARCHAR2(10 BYTE)            NOT NULL,
  PME_PMVID        VARCHAR2(10 BYTE)            NOT NULL,
  PME_BILLRATE     NUMBER(3)                    NOT NULL,
  PME_RATEDESC     VARCHAR2(30 BYTE)            NOT NULL,
  PME_AMOUNTCU     NUMBER(9,4)                  NOT NULL,
  PME_AMOUNTPV     NUMBER(9,4)                  NOT NULL,
  PME_AMOUNTMO     NUMBER(9,4)                  NOT NULL,
  PME_PERCENT      NUMBER(1),
  PME_COMMENT      VARCHAR2(1000 BYTE),
  PME_CHNGCNT      NUMBER(5),
  PME_KW_CHECK     NUMBER(1),
  PME_KW_REVIEW    NUMBER(1),
  PME_AMOUNTPV_PP  NUMBER(9,4),
  PME_AMOUNTMO_PP  NUMBER(9,4)
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.PRMODELENTRY IS 'Pricing model split entry';


--
-- REVA_COUNTER  (Table) 
--
CREATE TABLE SBS1_ADMIN.REVA_COUNTER
(
  REVAC_DATE      DATE                          NOT NULL,
  REVAC_REVASMID  VARCHAR2(20 BYTE)             NOT NULL,
  REVAC_IN        NUMBER(8)                     NOT NULL,
  REVAC_OUT       NUMBER(8)                     NOT NULL
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.REVA_COUNTER IS 'REVAO Counter';

COMMENT ON COLUMN SBS1_ADMIN.REVA_COUNTER.REVAC_DATE IS 'date';

COMMENT ON COLUMN SBS1_ADMIN.REVA_COUNTER.REVAC_REVASMID IS 'sig mask id';

COMMENT ON COLUMN SBS1_ADMIN.REVA_COUNTER.REVAC_IN IS 'cdr count in';

COMMENT ON COLUMN SBS1_ADMIN.REVA_COUNTER.REVAC_OUT IS 'cdr count out';


--
-- SETTLING  (Table) 
--
CREATE TABLE SBS1_ADMIN.SETTLING
(
  SET_ID        VARCHAR2(10 BYTE)               NOT NULL,
  SET_ETID      VARCHAR2(10 BYTE)               NOT NULL,
  SET_CONID     VARCHAR2(10 BYTE)               NOT NULL,
  SET_DEMO      NUMBER(1)                       NOT NULL,
  SET_SEPID     VARCHAR2(10 BYTE),
  SET_NUMBER    VARCHAR2(10 BYTE),
  SET_DATECRE   DATE                            NOT NULL,
  SET_DATEPRN1  DATE,
  SET_REPID1    VARCHAR2(10 BYTE),
  SET_DATEPRN2  DATE,
  SET_REPID2    VARCHAR2(10 BYTE),
  SET_DATECAN   DATE,
  SET_SETIDOLD  VARCHAR2(10 BYTE),
  SET_CURRENCY  VARCHAR2(10 BYTE),
  SET_NET       NUMBER(12,4)                    NOT NULL,
  SET_VAT       NUMBER(12,4)                    NOT NULL,
  SET_TOTAL     NUMBER(12,4)                    NOT NULL,
  SET_ESID      VARCHAR2(10 BYTE)               NOT NULL,
  SET_DATE1     DATE,
  SET_DATE2     DATE,
  SET_COMMENT   VARCHAR2(2000 BYTE)
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.SETTLING IS 'Settlement';


--
-- SYSPARAMETERS  (Table) 
--
CREATE TABLE SBS1_ADMIN.SYSPARAMETERS
(
  SYS_ID              VARCHAR2(10 BYTE)         NOT NULL,
  SYS_COMPANY         VARCHAR2(100 BYTE)        NOT NULL,
  SYS_STREET1         VARCHAR2(100 BYTE),
  SYS_STREET2         VARCHAR2(100 BYTE),
  SYS_STREET3         VARCHAR2(100 BYTE),
  SYS_STREET4         VARCHAR2(100 BYTE),
  SYS_STREET5         VARCHAR2(100 BYTE),
  SYS_COUNTRY         VARCHAR2(100 BYTE),
  SYS_ZIP             VARCHAR2(12 BYTE),
  SYS_TOWN            VARCHAR2(100 BYTE),
  SYS_MAXLOG          NUMBER(2)                 NOT NULL,
  SYS_DELAY           NUMBER(3),
  SYS_MINPASSLENGTH   NUMBER(2),
  SYS_NOTIFYDAYS      NUMBER(2),
  SYS_NOTIFYEMAIL     VARCHAR2(100 BYTE),
  SYS_LANGID          VARCHAR2(2 BYTE),
  SYS_AT              VARCHAR2(20 BYTE),
  SYS_ACCOUNT         VARCHAR2(20 BYTE),
  SYS_COSTTYPE        VARCHAR2(10 BYTE),
  SYS_CURRENCY        VARCHAR2(3 BYTE)          NOT NULL,
  SYS_TAX             NUMBER(4,2),
  SYS_TAXNUMBER       VARCHAR2(30 BYTE),
  SYS_LASTINVOICENO   NUMBER(10),
  SYS_VASPTEXT1       VARCHAR2(80 BYTE),
  SYS_VASPTEXT2       VARCHAR2(80 BYTE),
  SYS_SMSCTEXT1       VARCHAR2(80 BYTE),
  SYS_SMSCTEXT2       VARCHAR2(80 BYTE),
  SYS_SDCTEXT1        VARCHAR2(80 BYTE),
  SYS_SDCTEXT2        VARCHAR2(80 BYTE),
  SYS_OTATEXT1        VARCHAR2(80 BYTE),
  SYS_OTATEXT2        VARCHAR2(80 BYTE),
  SYS_ESRVTEXT1       VARCHAR2(80 BYTE),
  SYS_ESRVTEXT2       VARCHAR2(80 BYTE),
  SYS_OPERVASPNOT     VARCHAR2(1000 BYTE),
  SYS_OPERSMSCNOT     VARCHAR2(1000 BYTE),
  SYS_OPERSDCNOT      VARCHAR2(1000 BYTE),
  SYS_OPEROTANOT      VARCHAR2(1000 BYTE),
  SYS_OPERESRVNOT     VARCHAR2(1000 BYTE),
  SYS_OPERVASPRESP    VARCHAR2(10 BYTE),
  SYS_OPERSMSCRESP    VARCHAR2(10 BYTE),
  SYS_OPERSDCRESP     VARCHAR2(10 BYTE),
  SYS_OPEROTARESP     VARCHAR2(10 BYTE),
  SYS_OPERESRVRESP    VARCHAR2(10 BYTE),
  SYS_CCVASPNOT       VARCHAR2(1000 BYTE),
  SYS_CCSMSCNOT       VARCHAR2(1000 BYTE),
  SYS_CCSDCNOT        VARCHAR2(1000 BYTE),
  SYS_CCOTANOT        VARCHAR2(1000 BYTE),
  SYS_CCESRVNOT       VARCHAR2(1000 BYTE),
  SYS_MARVASPNOT      VARCHAR2(1000 BYTE),
  SYS_MARSMSCNOT      VARCHAR2(1000 BYTE),
  SYS_MARSDCNOT       VARCHAR2(1000 BYTE),
  SYS_MAROTANOT       VARCHAR2(1000 BYTE),
  SYS_MARESRVNOT      VARCHAR2(1000 BYTE),
  SYS_CHNGCNT         NUMBER(5),
  SYS_PWDVALIDITY     NUMBER(5),
  SYS_PWDMINSPLCHARS  NUMBER(2),
  SYS_PWDMINDIGITS    NUMBER(2),
  SYS_UTCOFFSET       NUMBER(3)                 NOT NULL,
  SYS_DLSSTART        DATE                      NOT NULL,
  SYS_DLSEND          DATE                      NOT NULL,
  SYS_DLSOFFSET       NUMBER(3)                 NOT NULL
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.SYSPARAMETERS IS 'System Parameters';


--
-- IDX_AC_TPID  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_AC_TPID ON SBS1_ADMIN.ACCOUNT
(AC_TPID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_BDC_SEPID  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BDC_SEPID ON SBS1_ADMIN.BDCONSOLIDATION
(BDC_SEPID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_BIH_DATETIME  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BIH_DATETIME ON SBS1_ADMIN.BIHEADER
(BIH_DATETIME)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_BIH_FILESIGNATURE  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BIH_FILESIGNATURE ON SBS1_ADMIN.BIHEADER
(BIH_FILENAME, BIH_FILEDATE)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_BIH_INDEXSID  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BIH_INDEXSID ON SBS1_ADMIN.BIHEADER
(BIH_MAPID, BIH_INDEXSID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_BIH_REVASID  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BIH_REVASID ON SBS1_ADMIN.BIHEADER
(BIH_SRCTYPE, BIH_REVASID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_BIH_WHSYNCSID  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BIH_WHSYNCSID ON SBS1_ADMIN.BIHEADER
(BIH_WHSYNCSID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_CON_ACID  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_CON_ACID ON SBS1_ADMIN.CONTRACT
(CON_ACID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_CON_CONSOL  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_CON_CONSOL ON SBS1_ADMIN.CONTRACT
(CON_CONSOL)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_CON_HUB  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_CON_HUB ON SBS1_ADMIN.CONTRACT
(CON_HUB)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_CON_NAME  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_CON_NAME ON SBS1_ADMIN.CONTRACT
(UPPER("CON_NAME"))
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_CON_OPKEY  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_CON_OPKEY ON SBS1_ADMIN.CONTRACT
(CON_OPKEY)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_CON_PMID  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_CON_PMID ON SBS1_ADMIN.CONTRACT
(CON_PMID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_CON_PSCALL  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_CON_PSCALL ON SBS1_ADMIN.CONTRACT
(CON_PSCALL)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_CON_SHORTID  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_CON_SHORTID ON SBS1_ADMIN.CONTRACT
(CON_SHORTID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_IS_ACCOUNT  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_IS_ACCOUNT ON SBS1_ADMIN.ISSUE
(IS_ACID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_IS_ACIDCRE  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_IS_ACIDCRE ON SBS1_ADMIN.ISSUE
(IS_ACIDCRE)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_IS_ACIDRESP  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_IS_ACIDRESP ON SBS1_ADMIN.ISSUE
(IS_ACIDRESP, IS_ESID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_IS_CONID  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_IS_CONID ON SBS1_ADMIN.ISSUE
(IS_CONID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_IS_DATECRE  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_IS_DATECRE ON SBS1_ADMIN.ISSUE
(IS_DATECRE)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_IS_DEADLINE  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_IS_DEADLINE ON SBS1_ADMIN.ISSUE
(IS_DEADLINE)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_IS_ESID  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_IS_ESID ON SBS1_ADMIN.ISSUE
(IS_ESID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_KEY_CONID  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_KEY_CONID ON SBS1_ADMIN.KEYWORD
(KEY_CONID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_LONGHD_DATE  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_LONGHD_DATE ON SBS1_ADMIN.LONGIDHISTDET
(LONGHD_DATETIME)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_LONGHD_ID  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_LONGHD_ID ON SBS1_ADMIN.LONGIDHISTDET
(LONGHD_LONGHID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_LONGHD_LONGID  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_LONGHD_LONGID ON SBS1_ADMIN.LONGIDHISTDET
(LONGHD_LONGID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_LONGHD_SHORTID  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_LONGHD_SHORTID ON SBS1_ADMIN.LONGIDHISTDET
(LONGHD_SHORTID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_MMSA_CONID  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_MMSA_CONID ON SBS1_ADMIN.MMSCADD
(MMSA_CONID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_MMSA_TASK  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_MMSA_TASK ON SBS1_ADMIN.MMSCADD
(MMSA_TASK)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_MMSC_SEPID  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_MMSC_SEPID ON SBS1_ADMIN.MMSCONSOLIDATION
(MMSC_SEPID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_PME_PMVID  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_PME_PMVID ON SBS1_ADMIN.PRMODELENTRY
(PME_PMVID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_AC_NAME  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDXU_AC_NAME ON SBS1_ADMIN.ACCOUNT
(UPPER("AC_NAME"))
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_AC_SHORT  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_AC_SHORT ON SBS1_ADMIN.ACCOUNT
(AC_SHORT)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_PME_PMVID_RATE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_PME_PMVID_RATE ON SBS1_ADMIN.PRMODELENTRY
(PME_PMVID, PME_BILLRATE)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_SET_CONID  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_SET_CONID ON SBS1_ADMIN.SETTLING
(SET_CONID, "SET_SEPID" DESC)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_ACCOUNT  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_ACCOUNT ON SBS1_ADMIN.ACCOUNT
(AC_ID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_BDCONSOLIDATION  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_BDCONSOLIDATION ON SBS1_ADMIN.BDCONSOLIDATION
(BDC_ID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_BIHEADER  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_BIHEADER ON SBS1_ADMIN.BIHEADER
(BIH_ID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_CONTRACT  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_CONTRACT ON SBS1_ADMIN.CONTRACT
(CON_ID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_ISSUE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_ISSUE ON SBS1_ADMIN.ISSUE
(IS_ID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_KEYWORD  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_KEYWORD ON SBS1_ADMIN.KEYWORD
(KEY_ID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_LONGIDHIST  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_LONGIDHIST ON SBS1_ADMIN.LONGIDHIST
(LONGH_ID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_MMSCADD  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_MMSCADD ON SBS1_ADMIN.MMSCADD
(MMSA_ADRID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_MMSCONSOLIDATION  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_MMSCONSOLIDATION ON SBS1_ADMIN.MMSCONSOLIDATION
(MMSC_ID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_PRMODELENTRY  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_PRMODELENTRY ON SBS1_ADMIN.PRMODELENTRY
(PME_ID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_SETTLING  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_SETTLING ON SBS1_ADMIN.SETTLING
(SET_ID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_SYSPARAMETERS  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_SYSPARAMETERS ON SBS1_ADMIN.SYSPARAMETERS
(SYS_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- UIDX_REVAC_DATE_REVASMID  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.UIDX_REVAC_DATE_REVASMID ON SBS1_ADMIN.REVA_COUNTER
(REVAC_DATE, REVAC_REVASMID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PKG_COMMON_MAPPING  (Package) 
--
CREATE OR REPLACE PACKAGE SBS1_ADMIN.PKG_COMMON_MAPPING
  IS
--
--  Purpose: Common routines for SBS input converters (associated with control table BIHEADER)
--
--  MODIFICATION HISTORY (see Package Body)

-- Mapping States
Type tMapEsId Is Record (
  Mapping           MapState.Maps_Id%Type := 'M',
  MapNoSet          MapState.Maps_Id%Type := 'm',
  Ignore            MapState.Maps_Id%Type := 'I',
  Error             MapState.Maps_Id%Type := 'E',
  Ready             MapState.Maps_Id%Type := 'R'
);

-- (Billing/Handler) Input Header States
Type tIhEsId Is Record (
  Mapping           bihstate.bihs_id%Type := 'MAP',
  ErrorInRec        bihstate.bihs_id%Type := 'ERR',
  ErrorInFile       bihstate.bihs_id%Type := 'ERF',
  Ready             bihstate.bihs_id%Type := 'RDY',
  Indexed           bihstate.bihs_id%Type := 'IDX'
);

Procedure INSERT_BIHEADER (
    p_BIH_ID            In Out  Varchar2,
    p_BIH_DEMO          In      Number,
    p_BIH_FILESEQ       In      Number,
    p_BIH_FILENAME      In      Varchar2,
    p_BIH_FILEDATE      In      Varchar2,
    p_BIH_MAPID         In      Varchar2,
    p_AppName           In      Varchar2,
    p_AppVer            In      Varchar2,
    p_Thread            IN      Varchar2,                                       --025SO                           
    p_TaskId            In      Number,         --006SO was p_JobId
    p_HostName          In      Varchar2,
    P_Status            In      Varchar
);  

Function isTimeForMapping 
(
    p_BIH_MAPID   IN varchar2
)
Return integer;

Function getTypeForMapping 
(
    p_BIH_MAPID   IN varchar2
)
Return VARCHAR2;

Function getSrcTypeForMapping 
(
    p_BIH_MAPID   IN varchar2
)
Return VARCHAR2;

Function getSrcTypeForBiHeader 
(
    p_BIH_ID   IN varchar2
)
Return VARCHAR2;


Procedure SP_INSERT_HEADER (
    p_BIH_ID            In Out  Varchar2,
    p_BIH_DEMO          In      Number,
    p_BIH_FILESEQ       In      Number,
    p_BIH_FILENAME      In      Varchar2,
    p_BIH_FILEDATE      In      Varchar2,
    p_BIH_MAPID         In      Varchar2,
    p_AppName           In      Varchar2,
    p_AppVer            In      Varchar2,
    p_Thread            In      Varchar2,                                                           
    p_JobId             In      Number,
    p_HostName          In      Varchar2,
    p_Status            In      Varchar,
    p_ErrorCode         Out     Number,
    p_ErrorDesc         Out     Varchar2,
    p_ReturnStatus      Out     Number 
);  --009SO

    
  Function getMappingIdForBiHeader 
(
    p_BIH_ID   IN varchar2
)
Return VARCHAR2;
END; -- Package Specification PKG_COMMON_MAPPING
 
/


--
-- PKG_MEC_IC_CSV  (Package) 
--
CREATE OR REPLACE PACKAGE SBS1_ADMIN.PKG_MEC_IC_CSV
Is
-- Change History
-- See Package Body

    Type ArrBdReqNo                 Is Table Of Number(8)       Index By Binary_Integer;
    Type ArrRecNr                   Is Table Of Number(8)       Index By Binary_Integer;    
    Type ArrRecData                 Is Table Of Varchar2(4000)  Index By Binary_Integer;    

Procedure SP_INSERT_HEADER (
    p_BIH_ID            In Out  Varchar2,
    p_BIH_DEMO          In      Number,
    p_BIH_FILESEQ       In      Number,
    p_BIH_FILENAME      In      Varchar2,
    p_BIH_FILEDATE      In      Varchar2,
    p_BIH_MAPID         In      Varchar2,
    p_AppName           In      Varchar2,
    p_AppVer            In      Varchar2,
    p_Thread            IN      Varchar2,                                                           
    p_JobId             In      Number,
    p_HostName          In      Varchar2,
    p_Status            In      Varchar,
    p_ErrorCode         Out     Number,
    p_ErrorDesc         Out     Varchar2,
    p_ReturnStatus      Out     Number 
); 

    
Procedure SP_INSERT_CSV (
    p_BiHId                     In      VarChar2,
    p_BatchSize                 In      Integer,
    p_MaxAge                    In      Number,
    p_DataHeader                In      VarChar2,

    p_RecordNr                  In      ArrRecNr,
    p_RecordData                In      ArrRecData,

    p_RecCount                  In Out  Number,
    p_PreParseErrCount          In Out  Number,
    p_ErrCount                  In Out  Number,
    p_DateFc                    In Out  Varchar2,
    p_DateLc                    In Out  Varchar2,
    p_ErrorCode                 Out     Number,
    p_ErrorDesc                 Out     Varchar2,
    p_ReturnStatus              Out     Number
);


Procedure SP_UPDATE_HEADER (
    p_BiHId             In      Varchar2,
    p_MaxAge            In      Number,
    p_DataHeader        In      VarChar2,       -- 012SO

    p_RecCount          In      Number,
    p_PreParseErrCount  In      Number,
    p_ErrCount          In      Number,
    p_DateFc            In      Varchar2,
    p_DateLc            In      Varchar2,
    p_ErrorCode         Out     Number,
    p_ErrorDesc         Out     Varchar2,
    p_ReturnStatus      Out     Number
);
      
End; -- PKG_MEC_IC_CSV
 
/


--
-- PKG_PARTAG  (Package) 
--
CREATE OR REPLACE PACKAGE SBS1_ADMIN.PKG_PARTAG
  IS

--
-- Purpose: Used for the management of daily partitions and data ageing
--          Execute Immediate Statements in Partition Ageing
--          Log attempts and results to the SCRIPT table with the help of
--          PKG_SCRIPT
--


procedure SP_ADD_MONTH_PARTITION (
    p_BOH_ID            IN varchar2,    -- e.g. 0000012345
    p_table_prefix      IN varchar2,    -- e.g. BDCUC, BDCUCIDX, BD6CUCIDX
    p_table_ext         IN varchar2,    -- e.g. <NULL>, A, B, AE, BE
    p_partition_prefix  IN varchar2,    -- e.g. CUCA
    p_partition_code    IN varchar2,    -- e.g. 20051128
    p_tablespace_prefix IN varchar2,    -- e.g. CUCA_DATA
    p_indexspace_prefix IN varchar2     -- e.g. CUCA_INDEX
    );

procedure SP_DROP_MONTH_PARTITION (
    p_BOH_ID            IN varchar2,    -- e.g. 0000012345
    p_table_prefix      IN varchar2,    -- e.g. BDCUC, BDCUCIDX, BD6CUCIDX
    p_table_ext         IN varchar2,    -- e.g. <NULL>, A, B, AE, BE
    p_partition_prefix  IN varchar2,    -- e.g. CUCA
    p_partition_code    IN varchar2     -- e.g. 20051128
    );

procedure SP_AGE_MONTH_PARTITIONS (
    p_BOH_ID            IN varchar2,    -- e.g. 0000012345
    p_table_prefix      IN varchar2,    -- e.g. BDCUC, BDCUCIDX, BD6CUCIDX
    p_table_ext         IN varchar2,    -- e.g. <NULL>, A, B, AE, BE
    p_partition_prefix  IN varchar2,    -- e.g. CUCA
    p_tablespace_prefix IN varchar2,    -- e.g. CUCA_DATA
    p_indexspace_prefix IN varchar2     -- e.g. CUCA_INDEX
    );

--------------------------------------------------------------------------------

procedure SP_ADD_SMSA_PARTITIONS(
    p_PACT_ID        IN varchar2,
    p_BOH_ID         IN varchar2,
    RecordsAffected  OUT number,
    ErrorCode        OUT number,
    ErrorMsg         OUT varchar2,
    ReturnStatus     IN OUT number
);

procedure SP_ADD_SMSA_PARTITIONS_MAN(
    p_partition_code        IN varchar2
);

procedure SP_ADD_SMSC_PARTITIONS(
   p_PACT_ID        IN varchar2,
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT number
);

procedure SP_ADD_SMSC_PARTITIONS_MAN(
   p_partition_code IN varchar2
);

procedure SP_ADD_SMSD_PARTITIONS(
   p_PACT_ID        IN varchar2,
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT number
);
procedure SP_ADD_SMSD_PARTITIONS_MAN(
   p_partition_code IN varchar2
);

procedure SP_ADD_INFO_PARTITIONS(
   p_PACT_ID        IN varchar2,
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT number
);

procedure SP_ADD_INFO_PARTITIONS_MAN(
   p_partition_code IN varchar2
);


procedure SP_ADD_MMSC_PARTITIONS(
   p_PACT_ID        IN varchar2,
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT number
);

procedure SP_ADD_MMSC_PARTITIONS_MAN(
   p_partition_code IN varchar2
);

procedure SP_ADD_MSCA_PARTITIONS(
   p_PACT_ID        IN varchar2,
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT number
);

procedure SP_ADD_MSCA_PARTITIONS_MAN(
   p_partition_code IN varchar2
);

procedure SP_CPR_MONTH_PARTITIONS (
  p_BOH_ID            IN varchar2,    -- e.g. 0000012345
  p_table_prefix      IN varchar2,    -- e.g. BDCUC, BDCUCIDX, BD6CUCIDX
  p_table_ext         IN varchar2,    -- e.g. <NULL>, A, B, AE, BE
  p_partition_prefix  IN varchar2,    -- e.g. CUCA
  p_tablespace_prefix IN varchar2,    -- e.g. CUCA_DATA
  p_indexspace_prefix IN varchar2     -- e.g. CUCA_INDEX
);

  procedure SP_CPR_INFO_PARTITIONS
  (
     p_PACT_ID        IN varchar2,
     p_BOH_ID         IN varchar2,
     RecordsAffected  OUT number,
     ErrorCode        OUT number,
     ErrorMsg         OUT varchar2,
     ReturnStatus     IN OUT number );

  procedure SP_CPR_MMSC_PARTITIONS
  (
     p_PACT_ID        IN varchar2,
     p_BOH_ID         IN varchar2,
     RecordsAffected  OUT number,
     ErrorCode        OUT number,
     ErrorMsg         OUT varchar2,
     ReturnStatus     IN OUT number );

  procedure SP_CPR_MSCA_PARTITIONS
  (
     p_PACT_ID        IN varchar2,
     p_BOH_ID         IN varchar2,
     RecordsAffected  OUT number,
     ErrorCode        OUT number,
     ErrorMsg         OUT varchar2,
     ReturnStatus     IN OUT number );

  procedure SP_CPR_REVI_PARTITIONS
  (
     p_PACT_ID        IN varchar2,
     p_BOH_ID         IN varchar2,
     RecordsAffected  OUT number,
     ErrorCode        OUT number,
     ErrorMsg         OUT varchar2,
     ReturnStatus     IN OUT number );

  procedure SP_CPR_SMSC_PARTITIONS
  (
     p_PACT_ID        IN varchar2,
     p_BOH_ID         IN varchar2,
     RecordsAffected  OUT number,
     ErrorCode        OUT number,
     ErrorMsg         OUT varchar2,
     ReturnStatus     IN OUT number );

  procedure SP_CPR_SMSD_PARTITIONS
  (
     p_PACT_ID        IN varchar2,
     p_BOH_ID         IN varchar2,
     RecordsAffected  OUT number,
     ErrorCode        OUT number,
     ErrorMsg         OUT varchar2,
     ReturnStatus     IN OUT number );

END; -- Package spec
/


--
-- PKG_WHSYNC  (Package) 
--
CREATE OR REPLACE PACKAGE SBS1_ADMIN.PKG_WHSYNC IS

    -- Interface for SBS output to data warehouse (DB to DB)

    -- 1) Client starts a transaction
    -- 2) Client calls getSyncHeader() to get one file header id which was not
    --    committed before (any one, no sorting guaranteed)
    -- 3) Client transfers detail data using a dedicated view (depending on the type of data)
    -- 4) Client calls commitSyncHeader() for header id just successfully processed (inserted into his DB)
    -- 5) Client commits transaction
    
  FUNCTION getSyncHeader(
        p_SrcType IN VARCHAR2,
        p_MappingId IN Varchar2,
        p_NextBiHeaderForSync OUT VARCHAR2
        ) RETURN INTEGER;                           -- 001SO
        -- for now to be called with p_SrcType = 'MMSC', p_MappingId = 'MEC'
        -- p_NextBiHeaderForSync is VARCHAR2(10)
        -- Return value is true of successful function evaluation
        -- p_NextBiHeaderForSync may be empty if no file available for transfer

  FUNCTION commitSyncHeader(
        p_BiHeaderSyncDone IN VARCHAR2
        ) RETURN INTEGER;                           -- 001SO
        -- must only be called after successful transfer of this header's details
        -- p_BiHeaderSyncDone is VARCHAR2(10)
        -- Return value is true of successful function evaluation
        -- Transaction must be rolled back if return value is false

END PKG_WHSYNC;
 
/


--
-- PKG_COMMON_MAPPING  (Package Body) 
--
CREATE OR REPLACE PACKAGE BODY SBS1_ADMIN.PKG_COMMON_MAPPING 
IS
--
--  MODIFICATION HISTORY 
--  Person  Date        Comments
--  -----   ----------  ----------------------------------------------
--001SO     14.01.2010  Created as subset of PKG_BDETAIL_COMMON
--002SO     14.01.2010  Implement Duplicate check for input converters 
--003SO     26.01.2010  Set try date in Mapping table for tracking purposes
--004SO     26.01.2010  Check scheduling for mapping
--005SO     01.02.2010  Implement clearance window for process execution (suspended seconds before period end)
--006SO     28.03.2010  Raname p_JobId to p_TaskId
--007SO     05.04.2010  Implement getMappingIdForBiHeader 
--008SO     07.04.2010  Implement file timestamp tolerance in duplicate checking
--009SO     03.05.2010  Duplicate SP_INSERT_HEADER stub here (from ind. input converters)
--010SO     14.12.2011  Remove schema qualifier "S B S 0 ."

    rInputHeaderState               tIhEsId;                                    --002SO
    cstrMecDateTimeFormat           Varchar2(20) := 'YYYYMMDDHH24MISS';         --002SO
    cMaxTries                       Number := 3;                                -- Procedure SP_INSERT_BIHEADER_MEC (for same FileName and FileDate)

    cFileTimeTolerance              NUMBER(4) := 10;                            --008SO 10 second tolerance in duplicate file check


Function getMappingIdForBiHeader 
(
    p_BIH_ID   IN varchar2
)
Return VARCHAR2
is  --007SO
    l_result VARCHAR2(10);
BEGIN

    SELECT  BIH_MAPID INTO l_result
    FROM    BIHEADER
    WHERE   BIH_ID = p_BIH_ID
    ;
    Return l_result;
    
END;


Function getSrcTypeForBiHeader 
(
    p_BIH_ID   IN varchar2
)
Return VARCHAR2
is  
    l_result VARCHAR2(10);
BEGIN

    SELECT  BIH_SRCTYPE INTO l_result
    FROM    BIHEADER
    WHERE   BIH_ID = p_BIH_ID
    ;
    Return l_result;
    
END;


Function getSrcTypeForMapping 
(
    p_BIH_MAPID   IN varchar2
)
Return VARCHAR2
is  
    l_result VARCHAR2(10);
BEGIN

    SELECT  MAP_SRCTID INTO l_result
    FROM    MAPPING
    WHERE   MAP_ID = p_BIH_MAPID
    ;
    Return l_result;
    
END;

Function getTypeForMapping 
(
    p_BIH_MAPID   IN varchar2
)
Return VARCHAR2
is  
    l_result VARCHAR2(10);
BEGIN

    SELECT  MAP_ETID INTO l_result
    FROM    MAPPING
    WHERE   MAP_ID = p_BIH_MAPID
    ;
    Return l_result;
    
END;

Function isTimeForMapping 
(
    p_BIH_MAPID   IN varchar2
)
Return integer
is  
    
    Cursor cInconvenientTime Is
    SELECT  
            MAP_EXECUTE, 
            MAP_CONDITIONALEXEC,
            MAP_PERIODID,
            MAP_STARTDAY,
            MAP_STARTHOUR,
            MAP_STARTMINUTE,
            MAP_ENDCLEARANCE,                                                   --005SO
            MAP_DATETRY,
            MAP_DATEDONE
    FROM    MAPPING
    WHERE   MAP_ID = p_BIH_MAPID
    ;              
    cInconvenientTimeRow cInconvenientTime%RowType;
    
    Type tCurDef is ref cursor;
    cvCurVar tCurDef;
    l_sql   VARCHAR2(4000);
    bGo boolean;
    vGo varchar2(4000);

BEGIN
    bGo := false;
    -- Check if this is a convenient time for processing
    For cInconvenientTimeRow in cInconvenientTime loop
        if cInconvenientTimeRow.MAP_EXECUTE = 1 then
            if cInconvenientTimeRow.MAP_CONDITIONALEXEC IS NULL then
                bGO := true; 
            else
                if SUBSTR(UPPER(cInconvenientTimeRow.MAP_CONDITIONALEXEC),1,6) = 'SELECT' then 
                    -- must check a condition sql
                    l_sql := cInconvenientTimeRow.MAP_CONDITIONALEXEC;
                else
                    -- condition view or table name given
                    l_sql := 'SELECT  * FROM ' || cInconvenientTimeRow.MAP_CONDITIONALEXEC;
                end if;
                
                open cvCurVar for l_sql;
                fetch cvCurVar into vGo;    -- ignore result
                bGo := cvCurVar%FOUND;      -- any result is a GO
                if bGO then
                    if UPPER(NVL(TRIM(vGO),'FALSE')) IN ('FALSE','0','NO') then 
                        bGO := false;       -- execpt if it is 0 or false or no
                    end if;
                end if;
                close cvCurVar;
            end if;
            if bGo = true then
                bGo := PKG_COMMON.isTimeForProcess(
                            cInconvenientTimeRow.MAP_PERIODID,
                            cInconvenientTimeRow.MAP_STARTDAY,
                            cInconvenientTimeRow.MAP_STARTHOUR,
                            cInconvenientTimeRow.MAP_STARTMINUTE,
                            cInconvenientTimeRow.MAP_ENDCLEARANCE,              --005SO
                            cInconvenientTimeRow.MAP_DATEDONE
                       );   --004SO
            end if;
        end if;
    end loop;
    
    if bGo then
        Return 1;
    else
        Return 0;
    end if;
END;


Procedure INSERT_BIHEADER (
    p_BIH_ID            In Out  Varchar2,
    p_BIH_DEMO          In      Number,
    p_BIH_FILESEQ       In      Number,
    p_BIH_FILENAME      In      Varchar2,
    p_BIH_FILEDATE      In      Varchar2,
    p_BIH_MAPID         In      Varchar2,
    p_AppName           In      Varchar2,
    p_AppVer            In      Varchar2,
    p_Thread            IN      Varchar2,                                                                 
    p_TaskId            In      Number,         --006SO was p_JobId
    p_HostName          In      Varchar2,
    P_Status            In      Varchar                                         
    )
Is

    Cursor cHeaderDup(p_FileName Varchar2, FileCreDate date) Is            
        Select
            SUM(DECODE(UPPER(BIH_ESID),rInputHeaderState.Mapping,0,1)) DoneCount,
            SUM(DECODE(UPPER(BIH_ESID),rInputHeaderState.Mapping,1,0)) NotDoneCount
        From
            BIHEADER
        Where
            BIH_FILENAME = p_FileName
            And BIH_FILEDATE >= FileCreDate - cFileTimeTolerance/24/3600        --008SO
            And BIH_FILEDATE <= FileCreDate + cFileTimeTolerance/24/3600        --008SO
            And UPPER(BIH_ESID) In (rInputHeaderState.Ready, rInputHeaderState.ErrorInRec, rInputHeaderState.Mapping)
        ;   --002SO 

    --002SO all below
    l_CountDone                     Number;                                     
    l_CountNotDone                  Number;                                     

    l_FILEDATE                      date;

Begin
    
    if isTimeForMapping(p_BIH_MAPID) = 0 then
        RAISE PKG_COMMON.EXCP_INCONVENIENT_TIME;
    end if;

    if p_BIH_ID IS NULL then
       p_BIH_ID := GenerateUniqueKey('G');             
    end if;

    -- Check to see if this file (with same timestamp) was entered in the table before
    -- If yes and has state READY or ERROR, then do not process again
    -- If yes and state was left on MAP or set to ERF, then retry once again (i.e., generate Header Id and continue as normal)
    l_FILEDATE := to_date(p_BIH_FILEDATE,cstrMecDateTimeFormat); 
    Open cHeaderDup (p_BIH_FILENAME, l_FILEDATE);                     
    Fetch cHeaderDup Into l_CountDone, l_CountNotDone;
    Close cHeaderDup;
    If (l_CountDone > 0) Then
        Raise PKG_COMMON.EXCP_RDY_ERR_HEADER_FOUND;                                    --002SO                                  
    elsif l_CountNotDone >= cMaxTries then
        Raise PKG_COMMON.EXCP_RDY_ERR_MANY_RETRIES;                                    --002SO                                    
    else
        -- No READY or excess ERROR states found for this filename (and file timestamp)
        -- Driver may process this file
        Insert into BIHeader (
            BIH_ID ,
            BIH_SRCTYPE,
            BIH_DEMO,
            BIH_FILESEQ,
            BIH_DATETIME,
            BIH_FILENAME,
            BIH_FILEDATE,
            BIH_MAPID,
            BIH_EXE,
            BIH_VERSION,
            BIH_THREAD,                                                     
            BIH_JOB,
            BIH_HOST,
            BIH_START,
            BIH_ESID
        )
        ( SELECT
            p_BIH_ID,
            MAP_SRCTID,
            p_BIH_DEMO,
            p_BIH_FILESEQ,
            SYSDATE,
            p_BIH_FILENAME,
            to_date(p_BIH_FILEDATE, 'YYYY-MM-DD HH24:MI:SS'),
            p_BIH_MAPID,
            p_AppName,
            p_AppVer,                                                       
            p_Thread,
            p_TaskId,
            p_HostName,
            SYSDATE,
            'MAP'
          FROM MAPPING WHERE MAP_ID = p_BIH_MAPID
        );
        
        UPDATE MAPPING SET  
            MAP_DATETRY = SYSDATE                                               --003SO
        WHERE   MAP_ID = p_BIH_MAPID
        ;
        
    End if;
    Return;

END INSERT_BIHEADER;

Procedure SP_INSERT_HEADER (
    p_BIH_ID            In Out  Varchar2,
    p_BIH_DEMO          In      Number,
    p_BIH_FILESEQ       In      Number,
    p_BIH_FILENAME      In      Varchar2,
    p_BIH_FILEDATE      In      Varchar2,
    p_BIH_MAPID         In      Varchar2,
    p_AppName           In      Varchar2,
    p_AppVer            In      Varchar2,
    p_Thread            In      Varchar2,                                                           
    p_JobId             In      Number,
    p_HostName          In      Varchar2,
    p_Status            In      Varchar,
    p_ErrorCode         Out     Number,
    p_ErrorDesc         Out     Varchar2,
    p_ReturnStatus      Out     Number 
    )
Is  --009SO
Begin

    INSERT_BIHEADER(                                    
        p_BIH_ID,
        p_BIH_DEMO,
        p_BIH_FILESEQ,
        p_BIH_FILENAME,
        p_BIH_FILEDATE,
        p_BIH_MAPID,
        p_AppName,
        p_AppVer,
        p_Thread,                                                            
        p_JobId,
        p_HostName,
        P_Status              
    );

    p_ReturnStatus := PKG_COMMON.RETURN_STATUS_OK;

Exception
    when PKG_COMMON.EXCP_RDY_ERR_HEADER_FOUND then
        p_ErrorCode := PKG_COMMON.ENO_RDY_ERR_HEADER_FOUND;
        p_ErrorDesc := PKG_COMMON.EDESC_RDY_ERR_HEADER_FOUND;
        p_ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
    when PKG_COMMON.EXCP_RDY_ERR_MANY_RETRIES then              
        p_ErrorCode := PKG_COMMON.ENO_RDY_ERR_MANY_RETRIES;         
        p_ErrorDesc := PKG_COMMON.EDESC_RDY_ERR_MANY_RETRIES;
        p_ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
    when PKG_COMMON.EXCP_INCONVENIENT_TIME then
        p_ErrorCode := PKG_COMMON.ENO_INCONVENIENT_TIME;         
        p_ErrorDesc := PKG_COMMON.EDESC_INCONVENIENT_TIME;  
        p_ReturnStatus := PKG_COMMON.RETURN_STATUS_SUSPENDED;
/*
    When others then 
        p_ErrorCode := SqlCode;
        p_ErrorDesc := PKG_COMMON.getHardErrorDesc;                             
        p_ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
*/
END;


END; -- Package Body PKG_COMMON_MAPPING
/


--
-- PKG_MEC_IC_CSV  (Package Body) 
--
CREATE OR REPLACE PACKAGE BODY SBS1_ADMIN.PKG_MEC_IC_CSV
IS
--
-- Purpose:
-- Message Event Consolidation Input Converter
-- Putting CSV-Data into SBS1
--
-- MODIFICATION HISTORY
-- Person       Date        Comments
-- ---------    ----------  ------------------------------------------
-- 001SO        08.01.2010  Created based on module used for ASCII0 before:
    -- 075SO    02.11.2009  Implement SP_INSERT_HEADER by calling PKG_BDETAIL_COMMON
    -- 076SO    02.11.2009  Evaluate SrcType from Mapping and rename inputParameter to MapTypeId 
    -- 077SO    03.11.2009  Remove correction of MM4 submit timestamp done in -- 039SO
    -- 078DA    13.11.2009  Return p_ReturnStatus for SP_INSERT_MEC
    -- 079DA    24.11.2009  New procedure SP_INSERT_CSV created
    -- 080DA    25.11.2009  New (internal) procedures INSERT_CSV_CCNDC and INSERT_CSV_MCCMNC created
    -- 081DA    25.11.2009  New procedure SP_UPDATE_HEADER with generic interface created
-- 002SO        12.01.2010  Create new package using only new bookeeping concept
-- 003SO        13.01.2010  Use latest version of InsertBiHeader from common package
-- 004SO        14.01.2009  Delete Operator Number Range entries after successful header insert
-- 005SO        14.01.2009  Treat all exceptions as hard errors and log details
-- 006SO        14.01.2009  Exclude Swisscom MSCs and HLRs from import for CCNDC
-- 007SO        14.01.2009  Abandon PKG_BDETAIL_COMMON and use PKG_COMMON and PKG_BIHEADER instead
-- 008SO        15.01.2010  Move error id to the end in insert warning
-- 009SO        18.01.2010  Invoke renamed common packages
-- 010SO        18.01.2010  Add (yet unused) source type parameter to internal record interface
-- 011SO        18.01.2010  Add (yet unused) record version to internal record interface
-- 012SO        18.01.2010  Add parameter p_DataHeader to SP_UPDATE_HEADER
-- 013DA        21.01.2010  Convert varchar dates to valid date format in SP_UPDATE_HEADER
-- 014SO        25.01.2010  Use standardized hardErrorMessage
-- 015SO        25.01.2010  Move PKG_COMMON.CutFirstItem to PKG_COMMON
-- 016SO        26.01.2010  Set date done in Mapping table for tracking purposes
-- 017SO        22.04.2010  Remove Filtering of Swisscom Number Ranges
-- 018SO        22.04.2010  Limit Operator Code input to 20 characters
-- 019SO        06.05.2010  Clear the ALL_ tables upon receipt of the first batch
-- 020SO        14.12.2011  Remove schema qualifier "S B S 0 ."
-- 021SO        14.04.2016  Ignore non-numeric OpKeys

    cstrTab                         Varchar2(1) := Chr(9);
    cstrCR                          Varchar2(1) := Chr(13);
    cstrLF                          Varchar2(1) := Chr(10);
    cstrComma                       Varchar2(1) := ',';                         -- 080DA
    cstrSemicolon                   Varchar2(1) := ';';                         -- 080DA

    rSourceType                     PKG_COMMON.tSrcType;                        -- 007SO 
    rMappingState                   PKG_COMMON_MAPPING.tMapEsId;                -- 009SO -- 007SO 

    cstrMecDateTimeFormat           Varchar2(20) := 'YYYYMMDDHH24MISS';

    cstrFieldSeparator              Varchar(1) := cstrTab;


Procedure SP_INSERT_HEADER (
    p_BIH_ID            In Out  Varchar2,
    p_BIH_DEMO          In      Number,
    p_BIH_FILESEQ       In      Number,
    p_BIH_FILENAME      In      Varchar2,
    p_BIH_FILEDATE      In      Varchar2,
    p_BIH_MAPID         In      Varchar2,
    p_AppName           In      Varchar2,
    p_AppVer            In      Varchar2,
    p_Thread            In      Varchar2,                                                           
    p_JobId             In      Number,
    p_HostName          In      Varchar2,
    p_Status            In      Varchar,
    p_ErrorCode         Out     Number,
    p_ErrorDesc         Out     Varchar2,
    p_ReturnStatus      Out     Number 
    )
Is  
    l_SrcType                   Varchar2(10);                                   -- 004SO                               
Begin

    PKG_COMMON_MAPPING.INSERT_BIHEADER(                                         -- 009SO -- 007SO -- 003SO
        p_BIH_ID,
        p_BIH_DEMO,
        p_BIH_FILESEQ,
        p_BIH_FILENAME,
        p_BIH_FILEDATE,
        p_BIH_MAPID,
        p_AppName,
        p_AppVer,
        p_Thread,                                                            
        p_JobId,
        p_HostName,
        P_Status              
    );

    l_SrcType := PKG_COMMON_MAPPING.getSrcTypeForBiheader(p_BIH_ID);            -- 009SO              
    If (l_SrcType = rSourceType.CCNDC) Then
        DELETE FROM ALL_CC_NDC;
    ElsIf (l_SrcType = rSourceType.MCCMNC) Then
        DELETE FROM ALL_MCC_MNC;
    End If;        

    p_ReturnStatus := PKG_COMMON.RETURN_STATUS_OK;

Exception
    when PKG_COMMON.EXCP_RDY_ERR_HEADER_FOUND then
        p_ErrorCode := PKG_COMMON.ENO_RDY_ERR_HEADER_FOUND;
        p_ErrorDesc := PKG_COMMON.EDESC_RDY_ERR_HEADER_FOUND;
        p_ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
    when PKG_COMMON.EXCP_RDY_ERR_MANY_RETRIES then              
        p_ErrorCode := PKG_COMMON.ENO_RDY_ERR_MANY_RETRIES;         
        p_ErrorDesc := PKG_COMMON.EDESC_RDY_ERR_MANY_RETRIES;
        p_ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
    when PKG_COMMON.EXCP_INCONVENIENT_TIME then
        p_ErrorCode := PKG_COMMON.ENO_INCONVENIENT_TIME;         
        p_ErrorDesc := PKG_COMMON.EDESC_INCONVENIENT_TIME;  
        p_ReturnStatus := PKG_COMMON.RETURN_STATUS_SUSPENDED;
    When others then 
        p_ErrorCode := SqlCode;
        p_ErrorDesc := PKG_COMMON.getHardErrorDesc;                             -- 014SO
        p_ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
END;


Procedure INSERT_CSV_CCNDC (
    p_SrcType               In      Varchar2,   -- 010SO
    p_BiHId                 In      VarChar2,
    p_DataHeader            In      VarChar2,

    p_RecordNr              In      Number,
    p_RecordData            In      VarChar2,
    p_RecordVersion         In      Varchar2,   -- 011SO  

    p_Inserted              Out     Boolean,
    p_Ignored               Out     Boolean,
    p_DateTime              Out     Varchar2,
    p_SoftErrorId           Out     Varchar2,
    p_SoftErrDesc           Out     Varchar2
)
Is

    Type tCcndcRecInfo Is Record (
        CCandNDC        VarChar2(20),
        Country_Name    VarChar2(100),
        Operator_Name   VarChar2(100),
        OperatorKey     VarChar2(100),      -- 006SO allow some reserve for checking
        Location        VarChar2(100)
    );

    l_RecordData            Varchar2(4000);
    l_oRecInfo              tCcndcRecInfo;
Begin

    p_Inserted := FALSE;
    p_Ignored := FALSE;     
    p_DateTime := NULL;
    p_SoftErrorId := NULL;
    p_SoftErrDesc := NULL;
    
    -- tab-separated data
    l_RecordData := p_RecordData;
    
    -- split the values and assign them to the structure one by one
    l_oRecInfo.CCandNDC := PKG_COMMON.CutFirstItem(l_RecordData, cstrSemicolon);    -- 015SO
    l_oRecInfo.Country_Name := PKG_COMMON.CutFirstItem(l_RecordData, cstrSemicolon);
    l_oRecInfo.Operator_Name := PKG_COMMON.CutFirstItem(l_RecordData, cstrSemicolon);
    l_oRecInfo.OperatorKey := PKG_COMMON.CutFirstItem(l_RecordData, cstrSemicolon);
    l_oRecInfo.Location := PKG_COMMON.CutFirstItem(l_RecordData, cstrSemicolon);
    
    if PKG_COMMON.SP_IS_NUMERIC(l_oRecInfo.OperatorKey) = 0  then
        p_Ignored := TRUE;                                                      -- 021SO -- 017SO -- 006SO
    end if;

    if p_Ignored = FALSE then
        Insert into ALL_CC_NDC (
            ACNDC_NBR,
            ACNDC_COUNTRY,
            ACNDC_OPNAME,
            ACNDC_OPKEY
        )
        Values (
            l_oRecInfo.CCandNDC,
            l_oRecInfo.Country_Name,
            l_oRecInfo.Operator_Name,
            SUBSTR(l_oRecInfo.OperatorKey,1,20)                                 -- 018SO
        );
        p_Inserted := TRUE;
    end if;
    
    Return;
    
Exception
    -- 005SO
    -- When INVALID_NUMBER Then
    --     p_SoftErrorId := '';
    --     p_SoftErrDesc := 'INVALID_NUMBER';
    -- When VALUE_ERROR Then
    --     p_SoftErrorId := '';
    --     p_SoftErrDesc := 'VALUE_ERROR';
    When others then 
        RAISE;        
End INSERT_CSV_CCNDC;


Procedure INSERT_CSV_MCCMNC (
    p_SrcType               In      Varchar2,   -- 010SO
    p_BiHId                 In      VarChar2,
    p_DataHeader            In      VarChar2,

    p_RecordNr              In      Number,
    p_RecordData            In      VarChar2,
    p_RecordVersion         In      Varchar2,   -- 011SO  

    p_Inserted              Out     Boolean,
    p_Ignored               Out     Boolean,
    p_DateTime              Out     Varchar2,
    p_SoftErrorId           Out     Varchar2,
    p_SoftErrDesc           Out     Varchar2
)
Is

    Type tMccmncRecInfo Is Record (
        MCC             VarChar2(10),
        MNC             VarChar2(10),
        Country_Name    VarChar2(100),
        Operator_Name   VarChar2(100),
        Operator_Key    VarChar2(100),                                          -- 018SO
        Start_Date      VarChar2(20),
        Ceased_Date     VarChar2(20)
    );

    l_RecordData            Varchar2(4000);
    l_oRecInfo              tMccmncRecInfo;
Begin

    p_Inserted := FALSE;
    p_Ignored := FALSE;
    p_DateTime := NULL;
    p_SoftErrorId := NULL;
    p_SoftErrDesc := NULL;

    -- tab-separated data
    l_RecordData := p_RecordData;
    
    -- split the values and assign them to the structure one by one
    l_oRecInfo.MCC := PKG_COMMON.CutFirstItem(l_RecordData, cstrSemicolon);     -- 015SO
    l_oRecInfo.MNC := PKG_COMMON.CutFirstItem(l_RecordData, cstrSemicolon);
    l_oRecInfo.Country_Name := PKG_COMMON.CutFirstItem(l_RecordData, cstrSemicolon);
    l_oRecInfo.Operator_Name := PKG_COMMON.CutFirstItem(l_RecordData, cstrSemicolon);
    l_oRecInfo.Operator_Key := PKG_COMMON.CutFirstItem(l_RecordData, cstrSemicolon);
    l_oRecInfo.Start_Date := PKG_COMMON.CutFirstItem(l_RecordData, cstrSemicolon);
    l_oRecInfo.Ceased_Date := PKG_COMMON.CutFirstItem(l_RecordData, cstrSemicolon);

    if is_numeric(l_oRecInfo.Operator_Key) = 0  then
        p_Ignored := TRUE;                                                      -- 021SO
    end if;

    if p_Ignored = FALSE then
        Insert into ALL_MCC_MNC (
            AMCMNC_MCC,
            AMCMNC_MNC,
            AMCMNC_COUNTRY,
            AMCMNC_OPNAME,
            AMCMNC_OPKEY,
            AMCMNC_STARTDATE,
            AMCMNC_CEASEDATE
        )
        Values (
            l_oRecInfo.MCC,
            l_oRecInfo.MNC,
            l_oRecInfo.Country_Name,
            l_oRecInfo.Operator_Name,
            SUBSTR(l_oRecInfo.Operator_Key,1,20),                               -- 018SO
            l_oRecInfo.Start_Date,
            l_oRecInfo.Ceased_Date
        );
        p_Inserted := TRUE;
    end if;
    
    Return;
    
Exception
    -- 005SO
    -- When INVALID_NUMBER Then
    --     p_SoftErrorId := '';
    --     p_SoftErrDesc := 'INVALID_NUMBER';
    -- When VALUE_ERROR Then
    --     p_SoftErrorId := '';
    --     p_SoftErrDesc := 'VALUE_ERROR';
    When others then
        RAISE;
End INSERT_CSV_MCCMNC;


Procedure SP_INSERT_CSV (
    p_BiHId                     In      VarChar2,
    p_BatchSize                 In      Integer,
    p_MaxAge                    In      Number,
    p_DataHeader                In      VarChar2,

    p_RecordNr                  In      ArrRecNr,
    p_RecordData                In      ArrRecData,

    p_RecCount                  In Out  Number,
    p_PreParseErrCount          In Out  Number,
    p_ErrCount                  In Out  Number,
    p_DateFc                    In Out  Varchar2,
    p_DateLc                    In Out  Varchar2,
    p_ErrorCode                 Out     Number,
    p_ErrorDesc                 Out     Varchar2,
    p_ReturnStatus              Out     Number
)
Is
    l_SrcType                   Varchar2(10);                               
    
    l_inserted                  Boolean;
    l_ignored                   Boolean;
    l_error                     Boolean;
    l_DateTime                  Varchar2(20);
    l_SoftErrorId               Varchar2(10);
    l_SoftErrDesc               Varchar2(2000);
    
    l_count_errors              Boolean := TRUE;                                -- Rec counting default behaviour
    l_count_ignores             Boolean := TRUE;                                -- Rec counting default behaviour 
    l_recordIndex               INTEGER;
    l_record_version            Varchar2(20);                                   -- 011SO  
    
Begin
    
    -- get source type from biheader id
    l_SrcType := PKG_COMMON_MAPPING.getSrcTypeForBiheader(p_BiHId);             -- 009SO
    l_record_version := NULL;                                                   -- 011SO (may later be extracted from the header)  
    
    if p_BatchSize > 0 then
        if p_RecordNr(1) < p_BatchSize then
            -- used to detect the first batch                                   -- 019SO         
            If (l_SrcType = rSourceType.CCNDC) Then
                DELETE FROM ALL_CC_NDC;                                    -- 019SO
            ElsIf (l_SrcType = rSourceType.MCCMNC) Then
                DELETE FROM ALL_MCC_MNC;                                   -- 019SO
            End If;        
        End if;
    End if;
    
    For I In 1..p_BatchSize Loop
    
        l_recordIndex := I;
        l_error := FALSE;
        
        If (l_SrcType = rSourceType.CCNDC) Then
            INSERT_CSV_CCNDC(l_SrcType, p_BiHId, p_DataHeader, p_RecordNr(I), p_RecordData(I), l_record_version, l_Inserted, l_Ignored, l_DateTime, l_SoftErrorId, l_SoftErrDesc);    -- 010SO
        ElsIf (l_SrcType = rSourceType.MCCMNC) Then
            INSERT_CSV_MCCMNC(l_SrcType, p_BiHId, p_DataHeader, p_RecordNr(I), p_RecordData(I), l_record_version, l_Inserted, l_Ignored, l_DateTime, l_SoftErrorId, l_SoftErrDesc);   -- 010SO
        End If;

        -- set first and last datetime of record and do the record counting                                      
        if l_Inserted then
            p_RecCount := p_RecCount + 1;                                
            If (l_DateTime is not NULL) and (l_DateTime < p_DateFc) Then
                p_DateFc := l_DateTime;
            End If;
            If (l_DateTime is not NULL) and (l_DateTime > p_DateLc) Then
                p_DateLc := l_DateTime;
            End If;
        else 
            if l_Ignored then
                if l_count_ignores then
                    p_RecCount := p_RecCount + 1;
                end if;
            else
                -- must be an error, even when not specified in  l_SoftErrorId or l_SoftErrDesc
                l_error := TRUE;
                p_ErrCount := p_ErrCount + 1;
                if l_count_errors then
                    p_RecCount := p_RecCount + 1;
                end if;                
            end if;
        end if;
        
        -- soft error logging
        If l_error Then
            PKG_COMMON.Insert_Warning(                                          -- 007SO 
                    'PKG_MEC_IC_CSV', 
                     'SP_INSERT_CSV', 
                      'INSERT_CSV_' || l_SrcType ,
                       l_SoftErrDesc || ' *** ' || p_RecordData(I),
                        p_BiHId, 
                         Null, 
                          Null,
                           Null,
                            l_SoftErrorId                                       -- 008SO
            );
        End If;
    End Loop;
    
    p_ReturnStatus := PKG_COMMON.RETURN_STATUS_OK;                                                    
    Return;

Exception
    When PKG_COMMON.EXCP_MISSING_HEADER_FLD then                                -- not used yet        
        p_ErrorCode := PKG_COMMON.ENO_MISSING_HEADER_FLD;
        p_ErrorDesc := PKG_COMMON.EDESC_MISSING_HEADER_FLD || ': ????? in *** ' || p_DataHeader;
        p_ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
    When Others Then
        p_ErrorCode := SqlCode;
        p_ErrorDesc  := PKG_COMMON.getHardErrorDesc;                            -- 014SO
        p_ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;                     -- 014SO
        -- hard error logging                                                   -- 005SO
        PKG_COMMON.Insert_Warning(                                              -- 007SO 
                'PKG_MEC_IC_CSV', 
                 'SP_INSERT_CSV', 
                  'INSERT_CSV_' || l_SrcType ,
                   p_ErrorDesc || ' *** ' || p_RecordData(l_recordIndex),       -- 014SO
                    p_BiHId                                                     -- 008SO                                                    
        );
        Return;
End SP_INSERT_CSV;


Procedure SP_UPDATE_HEADER (
    p_BiHId             In      Varchar2,
    p_MaxAge            In      Number,
    p_DataHeader        In      VarChar2,       -- 012SO
    p_RecCount          In      Number,
    p_PreParseErrCount  In      Number,
    p_ErrCount          In      Number,
    p_DateFc            In      Varchar2,
    p_DateLc            In      Varchar2,
    p_ErrorCode         Out     Number,
    p_ErrorDesc         Out     Varchar2,
    p_ReturnStatus      Out     Number
)
Is
    l_SrcType                   Varchar2(10);
    l_HeaderState               Varchar2(10);                  
Begin
    l_SrcType := PKG_COMMON_MAPPING.getSrcTypeForBiheader(p_BiHId);             -- 009SO           

    -- Update the given Biheader Id with the information supplied        
    if p_ErrCount + p_PreParseErrCount = 0 then
        l_HeaderState := 'RDY';
    else
        l_HeaderState := 'ERR';
    end if;
    Update BIHeader Set
        BIH_ESID = l_HeaderState,
        BIH_DATEFC = To_Date(p_DateFc, cstrMecDateTimeFormat),                  -- 013DA
        BIH_DATELC = To_Date(p_DateLc, cstrMecDateTimeFormat),                  -- 013DA
        BIH_RECCOUNT = p_RecCount,
        BIH_ERRCOUNT = p_ErrCount + p_PreParseErrCount,
        BIH_END = SysDate
    Where BIH_ID = p_BiHId;

    UPDATE MAPPING SET  
        MAP_DATEDONE = SYSDATE                                                  -- 016SO
    WHERE   MAP_ID IN (SELECT BIH_MAPID FROM BIHEADER WHERE BIH_ID = p_BiHId) 
    ;

    p_ReturnStatus := PKG_COMMON.RETURN_STATUS_OK;
    Return;
Exception
    When PKG_COMMON.EXCP_MISSING_HEADER_FLD then                                -- not used yet        
        p_ErrorCode := PKG_COMMON.ENO_MISSING_HEADER_FLD;
        p_ErrorDesc := PKG_COMMON.EDESC_MISSING_HEADER_FLD;
        p_ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
    When PKG_COMMON.EXCP_RECCOUNT_MISMATCH then                                 -- 014SO not used yet        
        p_ErrorCode := PKG_COMMON.ENO_RECCOUNT_MISMATCH;
        p_ErrorDesc := PKG_COMMON.EDESC_RECCOUNT_MISMATCH;
        p_ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
    When Others then
        p_ErrorCode := SqlCode;
        p_ErrorDesc := PKG_COMMON.getHardErrorDesc;                             -- 014SO
        p_ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
        Return;
End SP_UPDATE_HEADER;
    
END;
/


--
-- PKG_PARTAG  (Package Body) 
--
CREATE OR REPLACE PACKAGE BODY SBS1_ADMIN.PKG_PARTAG
IS
--
-- Purpose: Used for the management of daily partitions and data ageing
--          Execute Immediate Statements in Partition Ageing
--          Log attempts and results to the SCRIPT table with the help of
--          PKG_SCRIPT
--
--MODIFICATION HISTORY
--Code  Date        Comments
------- ----------  ------------------------------------------
--001SO 09.11.2005  Package creation
--002SO 19.11.2005  Bring all data ageing procedures here from the other packages
--002SO 20.11.2005  Do not try to rebuild indexes ONLINE. Does not work in execute immediate.
--003SO 20.11.2005  Use MODIFY DEFAULT ATTRIBUTE when creating normal (non IOT) partitions with indexes
--004SO 20.11.2005  Rename partition and tablespase prefix from MMCA to MTRC (MessageTRansCoder)
--005SO 17.10.2006  Include MMS Bulk Index table (only B) into partition ageing
--006SO 14.09.2009  Take over from SBS2. Replace daily ageing by monthly ageing.
--007SO 21.10.2009  Correct Tablespaces
--008SO 15.01.2010  Use PKG_COMMON instead of PKG_BDETAIL_COMMON
--009SO 15.01.2010  Add partition ageing for INFO, MMSC, MMSB and MSCA
--010SO 02.04.2010  Correct BDINFO -> BDITEM
--011SO 03.04.2010  Add partition ageing for REVI-Tables (date code partition keys)
--012SO 06.03.2012  Clean out obsolete code for MMSB
--013SO 01.05.2012  Create new partition in single TS using _UC postfix
--014SO 06.05.2012  Correct TS name for SMS IW archive
--015SO 14.05.2012  Correct TS name for other tables
--016SO 14.05.2012  Remove code fro BDITEM
--017SO 14.05.2012  Remove code fro REVI_BLK
--018SO 29.05.2012  Bugfix Tablespace naming
--019SO 16.05.2013  Implement table compression and partition exchange
--020SO 13.06.2013  Use 'NC' instead on 'UC' for uncompressed tablespaces
--021SO 23.08.2013  Improve error logging with stack trace
--022SO 21.10.2013  Add BDETAIL7 for M2M SMS Delivery CDRs
--023SO 09.11.2013  Use SMSD as partition Prefix for M2M Data in BDETAIL7
--024SO 01.06.2015  Use *_UC for partitions which are to be compressed, *_NC for others
--025SO 01.06.2015  Use *_QC for compressed partitions
--026SO 13.06.2015  Compress BDETAIL7 partitions too
--027SO 09.09.2015  Patch Compression rules for re-compressing badly compressed older partitions $$$$ TO BE REMOVED $$$$
--028SO 23.11.2017  Revert --028SO
--029SO 23.11.2017  Compress BDKPI partitions too
--030SO 23.11.2017  Roll BDKPI partitions too


-- GLOBALS

    vMyPkg varchar2(30) := 'PKG_PARTAG';
        rConfig            partag_config%rowtype;
        bDebug             boolean   := true;

        cSmsAchiveTS       VARCHAR2(20) := 'SBS1_ARCHIV_DATA';              --014SO --007SO --006SO use 'ARCHIV_DATA' for Prod

FUNCTION getPartAgConfig (
    P_DATA_TYPE In VARCHAR2 DEFAULT 'DEFAULT'
)   return partag_config%rowtype
IS
vConfig            partag_config%rowtype;
BEGIN
    select * into vConfig
    from partag_config
    where partagc_id = P_DATA_TYPE;

        if (vConfig.partagc_debugmode=1) then
                bDebug:=true;
        else
                bDebug:=false;
        end if;

    return vConfig;

END; --function getPartAgConfig


function GET_TAB_PARTITION_COUNT (
    p_table_name        IN varchar2,    -- e.g. BDCUC, BDCUCIDXA, BD6CUCIDXBE
    p_partition_name    IN varchar2,    -- e.g. CUCA20051128
    p_tablespace_name   IN varchar2     -- e.g. CUCA_DATA_O1 (empty means ANY)
) RETURN INTEGER
IS
    v_partition_count           INTEGER;
BEGIN
    if p_tablespace_name IS NOT NULL then
        SELECT Count(*) into v_partition_count
        FROM ALL_TAB_PARTITIONS
        WHERE TABLE_NAME = p_table_name
        AND PARTITION_NAME = p_partition_name
        AND TABLESPACE_NAME = p_tablespace_name;
    else
        SELECT Count(*) into v_partition_count
        FROM ALL_TAB_PARTITIONS
        WHERE TABLE_NAME = p_table_name
        AND PARTITION_NAME = p_partition_name;
    end if;

    return v_partition_count;
END;

function GET_IND_PARTITION_COUNT(
    p_index_name        IN varchar2,    -- e.g. IDX_BDA_DATETIME_TRAUD
    p_partition_name    IN varchar2,    -- e.g. MTRC20051231
    p_tablespace_name   IN varchar2     -- e.g. MTRC_INDEX_01 (empty means ANY)
) RETURN INTEGER
IS
    v_partition_count           INTEGER;
BEGIN
    if p_tablespace_name IS NOT NULL then
        SELECT COUNT(*) into v_partition_count
        FROM ALL_IND_PARTITIONS
        WHERE INDEX_NAME = p_index_name
        AND     PARTITION_NAME = p_partition_name
        AND     TABLESPACE_NAME = p_tablespace_name;
    else
        SELECT COUNT(*) into v_partition_count
        FROM ALL_IND_PARTITIONS
        WHERE INDEX_NAME = p_index_name
        AND     PARTITION_NAME = p_partition_name;
    end if;
    return v_partition_count;
END;

procedure SP_ADD_MONTH_PARTITION (
    p_BOH_ID            IN varchar2,    -- e.g. 0000012345
    p_table_prefix      IN varchar2,    -- e.g. BDCUC, BDCUCIDX, BD6CUCIDX
    p_table_ext         IN varchar2,    -- e.g. <NULL>, A, B, AE, BE
    p_partition_prefix  IN varchar2,    -- e.g. CUCA
    p_partition_code    IN varchar2,    -- e.g. 20051128
    p_tablespace_prefix IN varchar2,    -- e.g. CUCA_DATA
    p_indexspace_prefix IN varchar2     -- e.g. CUCA_INDEX
    )
IS  --006SO

    CURSOR  cIndexes (x_table_name VARCHAR2) IS
    SELECT  index_name
    FROM    user_indexes
    WHERE   table_name = x_table_name
    AND     index_type = 'NORMAL';

    v_ddl                       VARCHAR2(2000);
    v_script_id                 VARCHAR2(10);
    v_script_state              VARCHAR2(10);

    v_table_name                VARCHAR2(20);
    v_partition_name                    VARCHAR2(12);
    v_partition_start_date      DATE;
    v_partition_end_date        DATE;
    v_tablespace_name           VARCHAR2(20);
    v_tablespace_code           VARCHAR2(2);
    v_indexspace_name           VARCHAR2(20);

BEGIN

    rConfig := getPartAgConfig(p_partition_prefix);                             --006SO

    v_partition_start_date := to_date(p_partition_code,'YYYYMM');               --006SO
    v_partition_end_date := add_months(v_partition_start_date,1);               --006SO -- one month
    v_partition_name := p_partition_prefix || p_partition_code;
    v_table_name := p_table_prefix || p_table_ext;

    if rConfig.PARTAGC_TABLESPACES = 1
       and p_tablespace_prefix in ('SBS1_INFO_DATA','SBS1_SMSC_DATA','SBS1_SMSD_DATA') then
        v_tablespace_code := 'UC';                                              --024SO
        v_tablespace_name := NVL(p_tablespace_prefix, p_indexspace_prefix) || '_' || v_tablespace_code;
        v_indexspace_name := p_indexspace_prefix || '_' || v_tablespace_code;
    elsif rConfig.PARTAGC_TABLESPACES = 1 then                                  -- no compression, use *_NC
        v_tablespace_code := 'NC';                                              --020SO --013SO
        v_tablespace_name := NVL(p_tablespace_prefix, p_indexspace_prefix) || '_' || v_tablespace_code;   --018SO
        v_indexspace_name := p_indexspace_prefix || '_' || v_tablespace_code;   --013SO
    else
        -- rotate tablespaces
        v_tablespace_code := TO_CHAR(MOD(MONTHS_BETWEEN(to_date(p_partition_code,'yyyymm'),to_date('199909','yyyymm')),rConfig.PARTAGC_TABLESPACES)+ 1, 'fm00');
        v_tablespace_name := NVL(p_tablespace_prefix, p_indexspace_prefix) || '_' || v_tablespace_code;
        v_indexspace_name := p_indexspace_prefix || '_' || v_tablespace_code;
    End If;

  BEGIN

        v_script_state := 'OK';   -- in case partition alredy exist in correct tablespace

        if GET_TAB_PARTITION_COUNT(v_table_name,v_partition_name,NULL) = 0 then
        -- partition does not exist

        -- make sure indexes will be created in proper tablespace               --003SO whole block added
        FOR i IN cIndexes(v_table_name)
        LOOP
            -- IOTs won't have any additional indexes besides the PK
            v_ddl := 'ALTER INDEX ' || i.index_name ||  ' MODIFY DEFAULT ATTRIBUTES ' ||
                     ' TABLESPACE ' || v_indexspace_name ;
            v_script_id := PKG_SCRIPT.CREATE_AND_EXECUTE('CreateTabPartition',rConfig.PARTAGC_EXECUTE,v_ddl,p_table_ext,p_BOH_ID,v_script_state);
            if v_script_state <> 'OK' then
                -- do an error logging
                PKG_COMMON.INSERT_WARNING(                                      --008SO
                      'PKG_PARTAG',
                      'SP_ADD_SINGLE_MONTH_PARTITION',
                      'Scripting Error',
                      'See SCRIPT ID = ' || v_script_id,
                      NULL,
                      p_BOH_ID
                    );
            end if;
        END LOOP;

        if v_table_name like 'REVI%' then                                       --011SO
            -- Create candidate partition for a date code partition key  YYYYMM(DD)
            v_ddl := 'ALTER TABLE ' || v_table_name ||
                     ' ADD PARTITION ' || v_partition_name ||
                     ' VALUES LESS THAN (''' || to_char(v_partition_end_date,'YYYYMM') || ''')' ||
                         ' TABLESPACE ' || v_tablespace_name ;
        else
            -- Create candidate partition for a date partition key
            v_ddl := 'ALTER TABLE ' || v_table_name ||
                     ' ADD PARTITION ' || v_partition_name ||
                     ' VALUES LESS THAN (to_date(''' || to_char(v_partition_end_date,'YYYYMMDD') || ''',''YYYYMMDD''))' ||
                         ' TABLESPACE ' || v_tablespace_name ;
        end if;
        v_script_id := PKG_SCRIPT.CREATE_AND_EXECUTE('CreateTabPartition',rConfig.PARTAGC_EXECUTE,v_ddl,p_table_ext,p_BOH_ID,v_script_state);
    end if;

    if p_tablespace_prefix IS NULL then
        -- It's an IOT
        if GET_IND_PARTITION_COUNT('PK_' || v_table_name,v_partition_name,v_indexspace_name) = 0 then
            -- IOT partition may exist, but in wrong tablespace
            -- Correcting Oracle Bug No. 1541222
            v_ddl := 'ALTER TABLE ' || v_table_name ||
                     ' MOVE PARTITION ' || v_partition_name ||
                     ' TABLESPACE ' || v_indexspace_name ;
            v_script_id := PKG_SCRIPT.CREATE_AND_EXECUTE('MoveIotPartition',rConfig.PARTAGC_EXECUTE,v_ddl,p_table_ext,p_BOH_ID,v_script_state);
        end if;
        else
        -- It is an ordinary partitioned table
        if GET_TAB_PARTITION_COUNT(v_table_name,v_partition_name,v_tablespace_name) = 0 then
            -- partition may exist, but in wrong tablespace
            -- Correcting Oracle Bug No. 1541222
            v_ddl := 'ALTER TABLE ' || v_table_name ||
                     ' MOVE PARTITION ' || v_partition_name ||
                     ' TABLESPACE ' || v_tablespace_name ;
            v_script_id := PKG_SCRIPT.CREATE_AND_EXECUTE('MoveTabPartition',rConfig.PARTAGC_EXECUTE,v_ddl,p_table_ext,p_BOH_ID,v_script_state);
        end if;
    end if;

    if v_script_state <> 'OK' then
        -- do an error logging
        PKG_COMMON.INSERT_WARNING(                                              --008SO
              'PKG_PARTAG',
              'SP_ADD_SINGLE_MONTH_PARTITION',
              'Scripting Error',
              'See SCRIPT ID = ' || v_script_id,
              NULL,
              p_BOH_ID
            );
    end if;

    FOR i IN cIndexes(v_table_name)
    LOOP
        -- IOTs won't have any additional indexes besides the PK
        if GET_IND_PARTITION_COUNT(i.index_name,v_partition_name,NULL) > 0 then
            -- candidate index exists
            if GET_IND_PARTITION_COUNT(i.index_name,v_partition_name,v_indexspace_name) = 0 then
                -- but not in correct tablespace. Need to move it!
                v_ddl := 'ALTER INDEX ' || i.index_name ||
                         ' REBUILD PARTITION ' || v_partition_name ||
                         ' TABLESPACE ' || v_indexspace_name ;                  --002SO  ' ONLINE'
                v_script_id := PKG_SCRIPT.CREATE_AND_EXECUTE('RebuildIndPartition',rConfig.PARTAGC_EXECUTE,v_ddl,p_table_ext,p_BOH_ID,v_script_state);
                if v_script_state <> 'OK' then
                    -- do an error logging
                    PKG_COMMON.INSERT_WARNING(                                  --008SO
                          'PKG_PARTAG',
                          'SP_ADD_SINGLE_MONTH_PARTITION',
                          'Scripting Error',
                          'See SCRIPT ID = ' || v_script_id,
                          NULL,
                          p_BOH_ID
                        );
                end if;
            end if;
        end if;
    END LOOP;

  END;

  Return;

END SP_ADD_MONTH_PARTITION;

procedure SP_DROP_MONTH_PARTITION (
    p_BOH_ID            IN varchar2,    -- e.g. 0000012345
    p_table_prefix      IN varchar2,    -- e.g. BDCUC, BDCUCIDX, BD6CUCIDX
    p_table_ext         IN varchar2,    -- e.g. <NULL>, A, B, AE, BE
    p_partition_prefix  IN varchar2,    -- e.g. CUCA
    p_partition_code    IN varchar2     -- e.g. 20051128
    )
IS  --006SO
    v_ddl                       VARCHAR2(2000);
    v_script_id                 VARCHAR2(10);
    v_script_state              VARCHAR2(10);

    v_table_name                VARCHAR2(20);
    v_partition_name                    VARCHAR2(12);

BEGIN
    v_partition_name := p_partition_prefix || p_partition_code;
    v_table_name := p_table_prefix || p_table_ext;
        v_script_state := 'OK';   -- in case partition alredy exist in correct tablespace

        if GET_TAB_PARTITION_COUNT(v_table_name,v_partition_name,NULL) > 0 then
        -- partition does exist
        -- Drop candidate partition
        v_ddl := 'ALTER TABLE ' || v_table_name ||
                 ' DROP PARTITION ' || v_partition_name ;
        v_script_id := PKG_SCRIPT.CREATE_AND_EXECUTE('DropPartition',1,v_ddl,p_table_ext,p_BOH_ID,v_script_state);
    end if;

    if v_script_state <> 'OK' then
        -- do an error logging
        PKG_COMMON.INSERT_WARNING(                                              --008SO
              'PKG_PARTAG',
              'SP_DROP_SINGLE_MONTH_PARTITION',
              'Scripting Error',
              'See SCRIPT ID = ' || v_script_id,
              NULL,
              p_BOH_ID
            );
    end if;

END;

procedure SP_AGE_MONTH_PARTITIONS (
    p_BOH_ID            IN varchar2,    -- e.g. 0000012345
    p_table_prefix      IN varchar2,    -- e.g. BDCUC, BDCUCIDX, BD6CUCIDX
    p_table_ext         IN varchar2,    -- e.g. <NULL>, A, B, AE, BE
    p_partition_prefix  IN varchar2,    -- e.g. CUCA
    p_tablespace_prefix IN varchar2,    -- e.g. CUCA_DATA
    p_indexspace_prefix IN varchar2     -- e.g. CUCA_INDEX
    )
IS  --006SO
    cursor oldest_partition is
        select NVL(MIN(PARTITION_NAME),'none')
        from  ALL_TAB_PARTITIONS
        where TABLE_NAME = p_table_prefix || p_table_ext
        and   PARTITION_NAME like p_partition_prefix || '______'                --006SO
        ;

    cursor newest_partition is
        select NVL(MAX(PARTITION_NAME), 'none')
        from  ALL_TAB_PARTITIONS
        where TABLE_NAME = p_table_prefix || p_table_ext
        and   PARTITION_NAME like p_partition_prefix || '______'                --006SO
        ;

    cursor exchange_partition is
        select  MIN(SUBSTR(TABLE_NAME,LENGTH(p_table_prefix || p_table_ext || '_')+1)) AS PARTITION_NAME
        from    ALL_TABLES
        where   OWNER = 'SBS1_ADMIN'
        and     TABLESPACE_NAME like '%_QC'
        and     TABLE_NAME LIKE p_table_prefix || p_table_ext || '_' || p_partition_prefix || '______'
        ; --025SO --019SO

    v_partition_date_old      date;       -- partitions older than this are to be deleted
    v_partition_date_new      date;       -- partitions older or equal to this are to be created

    v_partition_name          varchar2(20);
    v_partition_start_date    date;
    v_partition_code          varchar2(8);

    v_result_code             integer;    --019SO

    v_retries                 integer;    -- create/delete attempts per invocation
    v_retries_max_deletes     integer;    -- max. number of delete tries per run
    v_retries_max_creates     integer;    -- max. number of create tries per run
    v_retries_max_exchanges   integer;    --019SO -- max. number of exchange tries per run

BEGIN
    rConfig := getPartAgConfig(p_partition_prefix);

    v_partition_date_old := ADD_MONTHS(trunc(sysdate,'MONTH'), - rConfig.PARTAGC_HISTORY);   -- partitions older than this will be deleted; standard = 60
    v_partition_date_new := ADD_MONTHS(trunc(sysdate,'MONTH'), rConfig.PARTAGC_ADVANCED);  -- partitions older or equal to this should be created

    v_retries_max_deletes := 7;     -- not more than 7 partition delete attempts in one round
    v_retries_max_creates := 7;     -- not more than 7 partition insert attempts in one round
    v_retries_max_exchanges := 3;   --019SO -- not more than 3 partition exchange attempts in one round

    -- PART 1 ADD NEW PARTITIONS
    v_retries := 0;
    LOOP
        open newest_partition;
        fetch newest_partition into v_partition_name;
        if newest_partition%NotFound then
            -- the next one to be created will be for 'this month'
            v_partition_name := p_partition_prefix || to_char(add_months(sysdate,-1),'YYYYMM');
        end if;
        close newest_partition;

        -- calculate partition code for next partition to be created
        v_partition_start_date := add_months(to_date(substr(v_partition_name,LENGTH(p_partition_prefix)+1,6),'YYYYMM'),1);
        v_partition_code := to_char(v_partition_start_date,'YYYYMM');

        exit when v_partition_start_date > v_partition_date_new;

        SP_ADD_MONTH_PARTITION (
            p_BOH_ID,
            p_table_prefix,
            p_table_ext,
            p_partition_prefix,
            v_partition_code,
            p_tablespace_prefix,
            p_indexspace_prefix
        );

        v_retries := v_retries + 1;
        exit when v_retries > v_retries_max_creates;
    END LOOP;

    -- PART 2 DELETE OLD PARTITIONS

    v_retries := 0;
    LOOP

        open oldest_partition;
        fetch oldest_partition into v_partition_name;
        if oldest_partition%NotFound then
            v_partition_name := 'none';
        end if;
        close oldest_partition;
        exit when v_partition_name = 'none';

        -- calculate partition code for this potentially outdated partition
        v_partition_start_date := to_date(substr(v_partition_name,LENGTH(p_partition_prefix)+1,6),'YYYYMM');
        v_partition_code := to_char(v_partition_start_date,'YYYYMM');

        exit when v_partition_start_date >= v_partition_date_old;

        SP_DROP_MONTH_PARTITION (
            p_BOH_ID,
            p_table_prefix,
            p_table_ext,
            p_partition_prefix,
            v_partition_code
        );

        v_retries := v_retries + 1;
        exit when v_retries > v_retries_max_deletes;
    END LOOP;

    -- PART 3 EXCHANGE COMPRESSED PARTITIONS                                    --019SO

    v_retries := 0;
    LOOP
        open exchange_partition;
        fetch exchange_partition into v_partition_name;
            if exchange_partition%NotFound then
                v_partition_name := 'none';
            end if;
        close exchange_partition;
        exit when v_partition_name = 'none';

        -- calculate partition start date for this potentially outdated exchange partition
        v_partition_start_date := to_date(substr(v_partition_name,LENGTH(p_partition_prefix)+1,6),'YYYYMM');

        if (v_partition_start_date >= v_partition_date_old) and
            (v_partition_start_date < trunc(sysdate,'MONTH'))then
            -- only swap-in partitions in the correct time range
            v_result_code := sbs1_admin.partreorg_exch_partition('SBS1_ADMIN',p_table_prefix || p_table_ext,v_partition_name);
            case
            when v_result_code = -1 then    -- -1: prepared table to exchange does not exist
                RAISE NO_DATA_FOUND;
            when v_result_code = 0 then     -- 0: success
                NULL;
            when v_result_code = 1 then     -- 1: Before exchange row count mismatch
                RAISE TOO_MANY_ROWS;
            when v_result_code = 2 then     -- 2: After  exchange  row count mismatch
                RAISE TOO_MANY_ROWS;
            when v_result_code = 3 then     -- 3: Exchange partition command unsuccessful
                RAISE STORAGE_ERROR;
            else
                RAISE VALUE_ERROR;
            end case;
        end if;
        v_retries := v_retries + 1;
        exit when v_retries > v_retries_max_exchanges;
    END LOOP;

END;

procedure SP_CPR_MONTH_PARTITIONS (
    p_BOH_ID            IN varchar2,    -- e.g. 0000012345
    p_table_prefix      IN varchar2,    -- e.g. BDCUC, BDCUCIDX, BD6CUCIDX
    p_table_ext         IN varchar2,    -- e.g. <NULL>, A, B, AE, BE
    p_partition_prefix  IN varchar2,    -- e.g. CUCA
    p_tablespace_prefix IN varchar2,    -- e.g. CUCA_DATA
    p_indexspace_prefix IN varchar2     -- e.g. CUCA_INDEX
    )
IS  --019SO
    cursor uncompressed_partition is
        SELECT  MIN(P.PARTITION_NAME)
        FROM    ALL_TAB_PARTITIONS P
        WHERE   P.TABLE_NAME = p_table_prefix || p_table_ext
        AND     P.COMPRESSION = 'DISABLED'                                      --028SO
        AND     P.TABLE_OWNER = 'SBS1_ADMIN'
        AND NOT EXISTS (
            select  A.TABLE_NAME
            from    ALL_TABLES A
            where   A.OWNER = P.TABLE_OWNER
            and     A.TABLESPACE_NAME like '%_QC'
            and     A.TABLE_NAME = P.TABLE_NAME || '_' || PARTITION_NAME
        ); --025SO --019SO

    v_partition_date_old      date;       -- partitions older than this are to be deleted
    v_partition_date_new      date;       -- partitions older or equal to this are to be created

    v_partition_name          varchar2(20);
    v_partition_start_date    date;

    v_result_code             integer;    --019SO

    v_retries                 integer;    -- create/delete attempts per invocation
    v_retries_max             integer;    --019SO -- max. number of compressing tries per run

BEGIN
    rConfig := getPartAgConfig(p_partition_prefix);

    v_partition_date_old := ADD_MONTHS(trunc(sysdate,'MONTH'), - rConfig.PARTAGC_HISTORY);   -- partitions older than this will be deleted; standard = 60
    v_partition_date_new := ADD_MONTHS(trunc(sysdate,'MONTH'), rConfig.PARTAGC_ADVANCED);  -- partitions older or equal to this should be created

    v_retries_max := 3;   --019SO -- not more than 3 partition compress attempts in one round
    v_retries := 0;
    LOOP
        open uncompressed_partition;
        fetch uncompressed_partition into v_partition_name;
            if uncompressed_partition%NotFound then
                v_partition_name := 'none';
            end if;
        close uncompressed_partition;
        exit when v_partition_name = 'none';

        -- calculate partition start date for this potentially outdated uncompressed partition
        v_partition_start_date := to_date(substr(v_partition_name,LENGTH(p_partition_prefix)+1,6),'YYYYMM');

        if (v_partition_start_date < trunc(sysdate,'MONTH'))then
            -- only compress partitions in the correct time range
            v_result_code := sbs1_admin.partreorg_prepare('SBS1_ADMIN',p_table_prefix || p_table_ext,v_partition_name);
            case
            when v_result_code = 0 then     -- 0: success
                NULL;
            when v_result_code = 1 then     -- 1: prepared table and corresponding partition with different number of rows
                RAISE TOO_MANY_ROWS;
            when v_result_code = 2 then     -- 2: specified table-partition does not exist
                RAISE NO_DATA_FOUND;
            when v_result_code = 3 then     -- 3: reorg-table already exists
                RAISE DUP_VAL_ON_INDEX;
            else
                RAISE VALUE_ERROR;
            end case;
        end if;
        v_retries := v_retries + 1;
        exit when v_retries > v_retries_max;
    END LOOP;

END;

procedure SP_ADD_SMSA_PARTITIONS
(
   p_PACT_ID        IN varchar2,
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT number )
IS  --006SO
BEGIN

    PKG_PARTAG.SP_AGE_MONTH_PARTITIONS (
        p_BOH_ID,
        'SMS_IW_MT_ARCH',
        NULL,
        'SMSA',
        NULL,
        cSmsAchiveTS
    );

    PKG_COMMON.COMPILE_ALL;     --008SO

    ErrorCode :=0;
    ErrorMsg :=NULL;
    ReturnStatus:= 1;

    return;

Exception
  When Others then
    ErrorCode := SQLCODE;
    ErrorMsg  := PKG_COMMON.getHardErrorDesc;   --021SO
    ReturnStatus := 0;
    RecordsAffected := 0;
END SP_ADD_SMSA_PARTITIONS;

procedure SP_ADD_SMSA_PARTITIONS_MAN
  ( p_partition_code IN varchar2
  )
  IS
  BEGIN

    PKG_PARTAG.SP_ADD_MONTH_PARTITION (
        NULL,
        'SMS_IW_MT_ARCH',
        NULL,
        'SMSA',
        p_partition_code,
        NULL,
        cSmsAchiveTS
    );

    PKG_COMMON.COMPILE_ALL;     --008SO

    Return;

END SP_ADD_SMSA_PARTITIONS_MAN;


procedure SP_ADD_SMSC_PARTITIONS
(
   p_PACT_ID        IN varchar2,
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT number )
IS  --006SO
BEGIN

    PKG_PARTAG.SP_AGE_MONTH_PARTITIONS (
        p_BOH_ID,
        'BDETAIL1',
        NULL,
        'SMSC',
        'SBS1_SMSC_DATA',
        'SBS1_SMSC_INDEX'
    ); --015SO

    PKG_COMMON.COMPILE_ALL;     --008SO

    ErrorCode :=0;
    ErrorMsg :=NULL;
    ReturnStatus:= 1;

    return;
Exception
  When Others then
    ErrorCode := SQLCODE;
    ErrorMsg  := PKG_COMMON.getHardErrorDesc;   --021SO
    ReturnStatus := 0;
    RecordsAffected := 0;
END SP_ADD_SMSC_PARTITIONS;

procedure SP_CPR_SMSC_PARTITIONS
(
   p_PACT_ID        IN varchar2,
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT number )
IS  --019SO
BEGIN

    PKG_PARTAG.SP_CPR_MONTH_PARTITIONS (
        p_BOH_ID,
        'BDETAIL1',
        NULL,
        'SMSC',
        'SBS1_SMSC_DATA',
        'SBS1_SMSC_INDEX'
    );

    PKG_COMMON.COMPILE_ALL;

    ErrorCode :=0;
    ErrorMsg :=NULL;
    ReturnStatus:= 1;

    return;
Exception
  When Others then
    ErrorCode := SQLCODE;
    ErrorMsg  := PKG_COMMON.getHardErrorDesc;   --021SO
    ReturnStatus := 0;
    RecordsAffected := 0;
END SP_CPR_SMSC_PARTITIONS;

procedure SP_ADD_SMSC_PARTITIONS_MAN
  ( p_partition_code IN varchar2
  )
  IS
  BEGIN

    PKG_PARTAG.SP_ADD_MONTH_PARTITION (
        NULL,
        'BDETAIL1',
        NULL,
        'SMSC',
        p_partition_code,
        'SBS1_SMSC_DATA',
        'SBS1_SMSC_INDEX'
    );--015SO

    PKG_COMMON.COMPILE_ALL;     --008SO

    Return;

END SP_ADD_SMSC_PARTITIONS_MAN;

procedure SP_ADD_SMSD_PARTITIONS
(
   p_PACT_ID        IN varchar2,
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT number )
IS  --006SO
BEGIN

    PKG_PARTAG.SP_AGE_MONTH_PARTITIONS (
        p_BOH_ID,
        'BDETAIL2',
        NULL,
        'SMSD',
        'SBS1_SMSD_DATA',                                                       --007SO
        'SBS1_SMSD_INDEX'                                                       --007SO
    );--015SO

    PKG_PARTAG.SP_AGE_MONTH_PARTITIONS (
        p_BOH_ID,
        'BDETAIL7',
        NULL,
        'SMSD',
        'SBS1_SMSD_DATA',
        'SBS1_SMSD_INDEX'
    );  --023SO --022SO

    PKG_COMMON.COMPILE_ALL;     --008SO

    ErrorCode :=0;
    ErrorMsg :=NULL;
    ReturnStatus:= 1;

    return;
Exception
  When Others then
    ErrorCode := SQLCODE;
    ErrorMsg  :=  PKG_COMMON.getHardErrorDesc;   --021SO
    ReturnStatus := 0;
    RecordsAffected := 0;
END SP_ADD_SMSD_PARTITIONS;

procedure SP_CPR_SMSD_PARTITIONS
(
   p_PACT_ID        IN varchar2,
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT number )
IS  --019SO
BEGIN

    PKG_PARTAG.SP_CPR_MONTH_PARTITIONS (
        p_BOH_ID,
        'BDETAIL2',
        NULL,
        'SMSD',
        'SBS1_SMSD_DATA',
        'SBS1_SMSD_INDEX'
    );

    PKG_PARTAG.SP_CPR_MONTH_PARTITIONS (
        p_BOH_ID,
        'BDETAIL7',
        NULL,
        'SMSD',
        'SBS1_SMSD_DATA',
        'SBS1_SMSD_INDEX'
    );  --026SO

    PKG_COMMON.COMPILE_ALL;     --008SO

    ErrorCode :=0;
    ErrorMsg :=NULL;
    ReturnStatus:= 1;

    return;
Exception
  When Others then
    ErrorCode := SQLCODE;
    ErrorMsg  :=  PKG_COMMON.getHardErrorDesc;   --021SO
    ReturnStatus := 0;
    RecordsAffected := 0;
END SP_CPR_SMSD_PARTITIONS;


procedure SP_ADD_SMSD_PARTITIONS_MAN
  ( p_partition_code IN varchar2
  )
  IS
  BEGIN

    PKG_PARTAG.SP_ADD_MONTH_PARTITION (
        NULL,
        'BDETAIL2',
        NULL,
        'SMSD',
        p_partition_code,
        'SBS1_SMSD_DATA',                                                       --007SO
        'SBS1_SMSD_INDEX'                                                       --007SO
    );  --015SO

    PKG_PARTAG.SP_ADD_MONTH_PARTITION (
        NULL,
        'BDETAIL7',
        NULL,
        'SMSD',
        p_partition_code,
        'SBS1_SMSD_DATA',                                                       --007SO
        'SBS1_SMSD_INDEX'                                                       --007SO
    );  --023SO --022SO

    PKG_COMMON.COMPILE_ALL;     --008SO

    Return;

END SP_ADD_SMSD_PARTITIONS_MAN;


procedure SP_ADD_INFO_PARTITIONS
(
   p_PACT_ID        IN varchar2,
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT number )
IS  --009SO
BEGIN

    PKG_PARTAG.SP_AGE_MONTH_PARTITIONS (
        p_BOH_ID,
        'BDETAIL',
        NULL,
        'INFO',
        'SBS1_INFO_DATA',
        'SBS1_INFO_INDEX'
    );--015SO

    PKG_PARTAG.SP_AGE_MONTH_PARTITIONS (
        p_BOH_ID,
        'BDETAIL9',
        NULL,
        'INFO',
        'SBS1_INFO_DATA',
        'SBS1_INFO_INDEX'
    );--015SO

    PKG_PARTAG.SP_AGE_MONTH_PARTITIONS (
        p_BOH_ID,
        'REVI_CONTENT_SUB',
        NULL,
        'INFO',
        'SBS1_INFO_DATA',
        'SBS1_INFO_INDEX'
    );  --011SO

    PKG_PARTAG.SP_AGE_MONTH_PARTITIONS (
        p_BOH_ID,
        'REVI_CONTENT_DEL',
        NULL,
        'INFO',
        'SBS1_INFO_DATA',
        'SBS1_INFO_INDEX'
    );--015SO  --011SO

    PKG_PARTAG.SP_AGE_MONTH_PARTITIONS (
        p_BOH_ID,
        'REVI_SMS',
        NULL,
        'INFO',
        'SBS1_INFO_DATA',
        'SBS1_INFO_INDEX'
    );--015SO  --011SO

    PKG_PARTAG.SP_AGE_MONTH_PARTITIONS (
        p_BOH_ID,
        'REVI_MMS',
        NULL,
        'INFO',
        'SBS1_INFO_DATA',
        'SBS1_INFO_INDEX'
    );--015SO  --011SO

    PKG_PARTAG.SP_AGE_MONTH_PARTITIONS (
        p_BOH_ID,
        'REVI_PRE',
        NULL,
        'INFO',
        'SBS1_INFO_DATA',
        'SBS1_INFO_INDEX'
    );--015SO  --011SO

    PKG_PARTAG.SP_AGE_MONTH_PARTITIONS (
        p_BOH_ID,
        'REVIPRE_SMS',
        NULL,
        'INFO',
        'SBS1_INFO_DATA',
        'SBS1_INFO_INDEX'
    );--015SO  --011SO

    PKG_PARTAG.SP_AGE_MONTH_PARTITIONS (
        p_BOH_ID,
        'REVIPRE_MMS',
        NULL,
        'INFO',
        'SBS1_INFO_DATA',
        'SBS1_INFO_INDEX'
    );--015SO  --011SO

    PKG_PARTAG.SP_AGE_MONTH_PARTITIONS (
        p_BOH_ID,
        'BDKPI',
        NULL,
        'INFO',
        'SBS1_INFO_DATA',
        'SBS1_INFO_INDEX'
    );  --030SO

    PKG_COMMON.COMPILE_ALL;     --008SO

    ErrorCode :=0;
    ErrorMsg :=NULL;
    ReturnStatus:= 1;

    return;
Exception
  When Others then
    ErrorCode := SQLCODE;
    ErrorMsg  :=  PKG_COMMON.getHardErrorDesc;   --021SO
    ReturnStatus := 0;
    RecordsAffected := 0;
END SP_ADD_INFO_PARTITIONS;

procedure SP_CPR_INFO_PARTITIONS
(
   p_PACT_ID        IN varchar2,
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT number )
IS  --019SO
BEGIN

    PKG_PARTAG.SP_CPR_MONTH_PARTITIONS (
        p_BOH_ID,
        'BDETAIL',
        NULL,
        'INFO',
        'SBS1_INFO_DATA',
        'SBS1_INFO_INDEX'
    );

    PKG_PARTAG.SP_CPR_MONTH_PARTITIONS (
        p_BOH_ID,
        'BDETAIL9',
        NULL,
        'INFO',
        'SBS1_INFO_DATA',
        'SBS1_INFO_INDEX'
    );

    PKG_PARTAG.SP_CPR_MONTH_PARTITIONS (
        p_BOH_ID,
        'BDKPI',
        NULL,
        'INFO',
        'SBS1_INFO_DATA',
        'SBS1_INFO_INDEX'
    );  --029SO

    PKG_COMMON.COMPILE_ALL;

    ErrorCode :=0;
    ErrorMsg :=NULL;
    ReturnStatus:= 1;

    return;
Exception
  When Others then
    ErrorCode := SQLCODE;
    ErrorMsg  :=  PKG_COMMON.getHardErrorDesc;   --021SO
    ReturnStatus := 0;
    RecordsAffected := 0;
END SP_CPR_INFO_PARTITIONS;

procedure SP_CPR_REVI_PARTITIONS
(
   p_PACT_ID        IN varchar2,
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT number )
IS  --019SO
BEGIN

    PKG_PARTAG.SP_CPR_MONTH_PARTITIONS (
        p_BOH_ID,
        'REVI_CONTENT_SUB',
        NULL,
        'INFO',
        'SBS1_INFO_DATA',
        'SBS1_INFO_INDEX'
    );

    PKG_PARTAG.SP_CPR_MONTH_PARTITIONS (
        p_BOH_ID,
        'REVI_CONTENT_DEL',
        NULL,
        'INFO',
        'SBS1_INFO_DATA',
        'SBS1_INFO_INDEX'
    );

    PKG_PARTAG.SP_CPR_MONTH_PARTITIONS (
        p_BOH_ID,
        'REVI_SMS',
        NULL,
        'INFO',
        'SBS1_INFO_DATA',
        'SBS1_INFO_INDEX'
    );

    PKG_PARTAG.SP_CPR_MONTH_PARTITIONS (
        p_BOH_ID,
        'REVI_MMS',
        NULL,
        'INFO',
        'SBS1_INFO_DATA',
        'SBS1_INFO_INDEX'
    );

    PKG_PARTAG.SP_CPR_MONTH_PARTITIONS (
        p_BOH_ID,
        'REVI_PRE',
        NULL,
        'INFO',
        'SBS1_INFO_DATA',
        'SBS1_INFO_INDEX'
    );

    PKG_PARTAG.SP_CPR_MONTH_PARTITIONS (
        p_BOH_ID,
        'REVIPRE_SMS',
        NULL,
        'INFO',
        'SBS1_INFO_DATA',
        'SBS1_INFO_INDEX'
    );

    PKG_PARTAG.SP_CPR_MONTH_PARTITIONS (
        p_BOH_ID,
        'REVIPRE_MMS',
        NULL,
        'INFO',
        'SBS1_INFO_DATA',
        'SBS1_INFO_INDEX'
    );

    PKG_COMMON.COMPILE_ALL;

    ErrorCode :=0;
    ErrorMsg :=NULL;
    ReturnStatus:= 1;

    return;
Exception
  When Others then
    ErrorCode := SQLCODE;
    ErrorMsg  :=  PKG_COMMON.getHardErrorDesc;   --021SO
    ReturnStatus := 0;
    RecordsAffected := 0;
END SP_CPR_REVI_PARTITIONS;

procedure SP_ADD_INFO_PARTITIONS_MAN
  ( p_partition_code IN varchar2
  )
  IS
  BEGIN

    PKG_PARTAG.SP_ADD_MONTH_PARTITION (
        NULL,
        'BDETAIL',
        NULL,
        'INFO',
        p_partition_code,
        'SBS1_INFO_DATA',
        'SBS1_INFO_INDEX'
    );--015SO

    PKG_PARTAG.SP_ADD_MONTH_PARTITION (
        NULL,
        'BDETAIL9',
        NULL,
        'INFO',
        p_partition_code,
        'SBS1_INFO_DATA',
        'SBS1_INFO_INDEX'
    );--015SO

    PKG_PARTAG.SP_ADD_MONTH_PARTITION (
        NULL,
        'REVI_CONTENT_SUB',
        NULL,
        'INFO',
        p_partition_code,
        'SBS1_INFO_DATA',
        'SBS1_INFO_INDEX'
    );--015SO  --011SO

    PKG_PARTAG.SP_ADD_MONTH_PARTITION (
        NULL,
        'REVI_CONTENT_DEL',
        NULL,
        'INFO',
        p_partition_code,
        'SBS1_INFO_DATA',
        'SBS1_INFO_INDEX'
    );--015SO  --011SO

    PKG_PARTAG.SP_ADD_MONTH_PARTITION (
        NULL,
        'REVI_SMS',
        NULL,
        'INFO',
        p_partition_code,
        'SBS1_INFO_DATA',
        'SBS1_INFO_INDEX'
    );--015SO  --011SO

    PKG_PARTAG.SP_ADD_MONTH_PARTITION (
        NULL,
        'REVI_MMS',
        NULL,
        'INFO',
        p_partition_code,
        'SBS1_INFO_DATA',
        'SBS1_INFO_INDEX'
    );--015SO  --011SO

    PKG_PARTAG.SP_ADD_MONTH_PARTITION (
        NULL,
        'REVI_PRE',
        NULL,
        'INFO',
        p_partition_code,
        'SBS1_INFO_DATA',
        'SBS1_INFO_INDEX'
    );--015SO  --011SO

    PKG_PARTAG.SP_ADD_MONTH_PARTITION (
        NULL,
        'REVIPRE_SMS',
        NULL,
        'INFO',
        p_partition_code,
        'SBS1_INFO_DATA',
        'SBS1_INFO_INDEX'
    );--015SO  --011SO

    PKG_PARTAG.SP_ADD_MONTH_PARTITION (
        NULL,
        'REVIPRE_MMS',
        NULL,
        'INFO',
        p_partition_code,
        'SBS1_INFO_DATA',
        'SBS1_INFO_INDEX'
    );--015SO  --011SO

    PKG_PARTAG.SP_ADD_MONTH_PARTITION (
        NULL,
        'BDKPI',
        NULL,
        'INFO',
        p_partition_code,
        'SBS1_INFO_DATA',
        'SBS1_INFO_INDEX'
    );  --030SO
    
    PKG_COMMON.COMPILE_ALL;     --008SO

    Return;

END SP_ADD_INFO_PARTITIONS_MAN;

procedure SP_ADD_MMSC_PARTITIONS
(
   p_PACT_ID        IN varchar2,
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT number )
IS  --009SO
BEGIN

    PKG_PARTAG.SP_AGE_MONTH_PARTITIONS (
        p_BOH_ID,
        'BDETAIL6',
        NULL,
        'MMSC',
        'SBS1_MMSC_DATA',
        'SBS1_MMSC_INDEX'
    );

    PKG_COMMON.COMPILE_ALL;     --008SO

    ErrorCode :=0;
    ErrorMsg :=NULL;
    ReturnStatus:= 1;

    return;
Exception
  When Others then
    ErrorCode := SQLCODE;
    ErrorMsg  :=  PKG_COMMON.getHardErrorDesc;   --021SO
    ReturnStatus := 0;
    RecordsAffected := 0;
END SP_ADD_MMSC_PARTITIONS;

procedure SP_CPR_MMSC_PARTITIONS
(
   p_PACT_ID        IN varchar2,
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT number )
IS  --019SO
BEGIN

    PKG_PARTAG.SP_CPR_MONTH_PARTITIONS (
        p_BOH_ID,
        'BDETAIL6',
        NULL,
        'MMSC',
        'SBS1_MMSC_DATA',
        'SBS1_MMSC_INDEX'
    );

    PKG_COMMON.COMPILE_ALL;

    ErrorCode :=0;
    ErrorMsg :=NULL;
    ReturnStatus:= 1;

    return;
Exception
  When Others then
    ErrorCode := SQLCODE;
    ErrorMsg  :=  PKG_COMMON.getHardErrorDesc;   --021SO
    ReturnStatus := 0;
    RecordsAffected := 0;
END SP_CPR_MMSC_PARTITIONS;

procedure SP_ADD_MMSC_PARTITIONS_MAN
  ( p_partition_code IN varchar2
  )
  IS
  BEGIN

    PKG_PARTAG.SP_ADD_MONTH_PARTITION (
        NULL,
        'BDETAIL6',
        NULL,
        'MMSC',
        p_partition_code,
        'SBS1_MMSC_DATA',
        'SBS1_MMSC_INDEX'
    );

    PKG_COMMON.COMPILE_ALL;     --008SO

    Return;

END SP_ADD_MMSC_PARTITIONS_MAN;


procedure SP_ADD_MSCA_PARTITIONS
(
   p_PACT_ID        IN varchar2,
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT number )
IS  --009SO
BEGIN

    PKG_PARTAG.SP_AGE_MONTH_PARTITIONS (
        p_BOH_ID,
        'BDETAIL4',
        NULL,
        'MSCA',
        'SBS1_MSCA_DATA',
        'SBS1_MSCA_INDEX'
    );

    PKG_COMMON.COMPILE_ALL;     --008SO

    ErrorCode :=0;
    ErrorMsg :=NULL;
    ReturnStatus:= 1;

    return;
Exception
  When Others then
    ErrorCode := SQLCODE;
    ErrorMsg  :=  PKG_COMMON.getHardErrorDesc;   --021SO
    ReturnStatus := 0;
    RecordsAffected := 0;
END SP_ADD_MSCA_PARTITIONS;

procedure SP_CPR_MSCA_PARTITIONS
(
   p_PACT_ID        IN varchar2,
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT number )
IS  --019SO
BEGIN

    PKG_PARTAG.SP_CPR_MONTH_PARTITIONS (
        p_BOH_ID,
        'BDETAIL4',
        NULL,
        'MSCA',
        'SBS1_MSCA_DATA',
        'SBS1_MSCA_INDEX'
    );

    PKG_COMMON.COMPILE_ALL;

    ErrorCode :=0;
    ErrorMsg :=NULL;
    ReturnStatus:= 1;

    return;
Exception
  When Others then
    ErrorCode := SQLCODE;
    ErrorMsg  :=  PKG_COMMON.getHardErrorDesc;   --021SO
    ReturnStatus := 0;
    RecordsAffected := 0;
END SP_CPR_MSCA_PARTITIONS;

procedure SP_ADD_MSCA_PARTITIONS_MAN
  ( p_partition_code IN varchar2
  )
  IS
  BEGIN

    PKG_PARTAG.SP_ADD_MONTH_PARTITION (
        NULL,
        'BDETAIL4',
        NULL,
        'MSCA',
        p_partition_code,
        'SBS1_MSCA_DATA',
        'SBS1_MSCA_INDEX'
    );

    PKG_COMMON.COMPILE_ALL;     --008SO

    Return;

END SP_ADD_MSCA_PARTITIONS_MAN;

END;
/


--
-- PKG_WHSYNC  (Package Body) 
--
CREATE OR REPLACE PACKAGE BODY SBS1_ADMIN.PKG_WHSYNC IS

--
-- Purpose:
-- Interface for SBS output to data warehouse (DB to DB)
    -- 1) Client starts a transaction
    -- 2) Client calls getSyncHeader() to get one file header id which was not
    --    committed before (any one, no sorting guaranteed)
    -- 3) Client transfers detail data using a dedicated view (depending on the type of data)
    -- 4) Client calls commitSyncHeader() for header id just successfully processed (inserted into his DB)
    -- 5) Client commits transaction

-- MODIFICATION HISTORY
-- Person   Date        Comments
-- -------------------  ------------------------------------------
-- 000SO    27.09.2004  Created this package
-- 001SO    13.12.2007  Change return value boolean to integer
-- 002SO    14.12.2011  Remove schema qualifier "S B S 0 ."



  FUNCTION getSyncHeader(
        p_SrcType IN VARCHAR2,
        p_MappingId IN Varchar2,
        p_NextBiHeaderForSync OUT VARCHAR2)
  	RETURN INTEGER IS                            -- 001SO
	
	CURSOR cNextSyncHeader IS
	SELECT BIH_ID
    FROM BIHEADER
    WHERE BIH_MAPID = p_MappingId
	AND	BIH_SRCTYPE = p_SrcType
	AND	BIH_WHSYNCSID = 'S'
    AND ROWNUM <= 1
	;
	
  BEGIN

    p_NextBiHeaderForSync := NULL;
    
    OPEN cNextSyncHeader;
    FETCH cNextSyncHeader INTO p_NextBiHeaderForSync;
    CLOSE cNextSyncHeader;
    
    RETURN 0;                                   -- 001SO

  EXCEPTION
   WHEN OTHERS THEN
     p_NextBiHeaderForSync := NULL;
     RETURN 1;                                  -- 001SO

  END getSyncHeader;


  FUNCTION commitSyncHeader(p_BiHeaderSyncDone IN VARCHAR2)
  	RETURN INTEGER IS                            -- 001SO
	
  BEGIN

    UPDATE BIHEADER SET
        BIH_WHSYNCSID = 'D',
        BIH_WHSYNCDATE = SYSDATE
	WHERE  BIH_ID = p_BiHeaderSyncDone
	;
	
	if (SQL%ROWCOUNT = 0) then
        RETURN 1;                               -- 001SO
    else
        RETURN 0;                               -- 001SO
    end if;
    
  EXCEPTION
   WHEN OTHERS THEN
     RETURN 1;                                  -- 001SO

  END commitSyncHeader;

END PKG_WHSYNC;
/


--
-- CLEANUP  (Procedure) 
--
CREATE OR REPLACE PROCEDURE SBS1_ADMIN.CLEANUP (
   p_PACT_ID        IN varchar2,
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT number
) IS
    vDeleted NUMBER;
BEGIN
    ErrorCode := 0;
    ErrorMsg := NULL;
    RecordsAffected := 0;

/*  -- SBS0
    CLEANUP_DELETE('aaasynclog','aaasl_datetime < ADD_MONTHS(TRUNC(SYSDATE),-3) and ROWNUM < 100000', p_BOH_ID, vDeleted);
    RecordsAffected := RecordsAffected +  vDeleted;
    CLEANUP_DELETE('aaatinlog','aaatl_datetime < ADD_MONTHS(TRUNC(SYSDATE),-6) and ROWNUM < 100000', p_BOH_ID, vDeleted);
    RecordsAffected := RecordsAffected +  vDeleted;
    CLEANUP_DELETE('boheader','boh_datetime < ADD_MONTHS(TRUNC(SYSDATE),-6) and ROWNUM < 100000', p_BOH_ID, vDeleted);
    RecordsAffected := RecordsAffected +  vDeleted;
    CLEANUP_DELETE('hbheader','hbh_datetime < ADD_MONTHS(TRUNC(SYSDATE),-6) and ROWNUM < 100000', p_BOH_ID, vDeleted);
    RecordsAffected := RecordsAffected +  vDeleted;
    CLEANUP_DELETE('hiheader','hih_datetime < ADD_MONTHS(TRUNC(SYSDATE),-6) and ROWNUM < 100000', p_BOH_ID, vDeleted);
    RecordsAffected := RecordsAffected +  vDeleted;
    CLEANUP_DELETE('warning','w_errortime < ADD_MONTHS(TRUNC(SYSDATE),-6) and ROWNUM < 100000', p_BOH_ID, vDeleted);
    RecordsAffected := RecordsAffected +  vDeleted;
*/
    -- SBS1
    CLEANUP_DELETE('biheader','bih_datetime < ADD_MONTHS(TRUNC(SYSDATE),-17) and ROWNUM < 100000', p_BOH_ID, vDeleted);
    RecordsAffected := RecordsAffected +  vDeleted;
    CLEANUP_DELETE('boheader','boh_datetime < ADD_MONTHS(TRUNC(SYSDATE),-17) and ROWNUM < 100000', p_BOH_ID, vDeleted);
    RecordsAffected := RecordsAffected +  vDeleted;
    CLEANUP_DELETE('dgticonsol','TO_DATE(dgtic_sepid,''YYYYMM'') < ADD_MONTHS(TRUNC(SYSDATE),-17) and ROWNUM < 100000', p_BOH_ID, vDeleted);
    RecordsAffected := RecordsAffected +  vDeleted;
    CLEANUP_DELETE('ogticonsol','TO_DATE(ogtic_sepid,''yyyymm'') < ADD_MONTHS(TRUNC(SYSDATE),-17) and ROWNUM < 100000', p_BOH_ID, vDeleted);
    RecordsAffected := RecordsAffected +  vDeleted;
    CLEANUP_DELETE('warning','w_errortime < ADD_MONTHS(TRUNC(SYSDATE),-17) and ROWNUM < 100000', p_BOH_ID, vDeleted);
    RecordsAffected := RecordsAffected +  vDeleted;

/*  -- SBS2
    CLEANUP_DELETE('biheader','bih_datetime < ADD_MONTHS(TRUNC(SYSDATE),-17) and ROWNUM < 100000', p_BOH_ID, vDeleted);
    RecordsAffected := RecordsAffected +  vDeleted;
    CLEANUP_DELETE('boheader','boh_datetime < ADD_MONTHS(TRUNC(SYSDATE),-17) and ROWNUM < 100000', p_BOH_ID, vDeleted);
    RecordsAffected := RecordsAffected +  vDeleted;
*/

    ReturnStatus:= 1;

EXCEPTION
  When Others then
    ErrorCode := SQLCODE;
    ErrorMsg  := PKG_COMMON.getHardErrorDesc;
    ReturnStatus := 0;
END;
/


--
-- GPSH_PRICE_CONTENT_PUT  (Procedure) 
--
CREATE OR REPLACE PROCEDURE SBS1_ADMIN.GPSH_PRICE_CONTENT_PUT(
    P_PME_PMVID IN VARCHAR2,
    P_PME_JSON IN VARCHAR2)

-- MODIFICATION HISTORY
-- ---------    ------      -------------------------------------------
-- Person       Date        Comments
-- SS           25.07.16    Created
-- SS001        28.02.17    Deleting and inserting if the rows and size of the list dont match
-- SS002        17.04.17    checking if the pmv_id exists if not integrity constraint error occurs
-- SS003        28.01.18    PM content prepaid revenue not using nvl
-- SS004        29.01.18    PM PME_AMOUNTMO removed nvl as ACU and SPO are required fields
-- SS005        29.01.18    Checking difference between json and table using (A - B) <> 0 and (B - A) <> 0 

IS

    PMV_COUNT NUMBER;
    JSON_MINUS_TABLE_COUNT NUMBER;
    TABLE_MINUS_JSON_COUNT NUMBER;

    CURSOR CONTENT_CUR (CONTENTS_IN IN VARCHAR2)
        IS SELECT *
            FROM JSON_TABLE(CONTENTS_IN, '$[*]'
                COLUMNS(ACU PATH '$.ACU', BR PATH '$.BR', DSC PATH '$.DSC', SPO PATH '$.SPO', CHK PATH '$.CHK', REV PATH '$.REV', REM PATH '$.REM', SPR PATH '$.SPR'));
BEGIN

    SELECT COUNT(*) INTO PMV_COUNT FROM PRMODELVER WHERE PMV_ID = P_PME_PMVID;
    
    IF PMV_COUNT = 1 THEN  --checking if the pmv_id exists if not integrity constraint error occurs
                            
        SELECT COUNT(*) INTO JSON_MINUS_TABLE_COUNT FROM(
            SELECT ACU, BR, DSC, SPO, CHK, REV, REM, SPR 
            FROM JSON_TABLE(P_PME_JSON, '$[*]' 
            COLUMNS (ACU NUMBER PATH '$.ACU'
                    , BR NUMBER PATH '$.BR'
                    , DSC PATH '$.DSC'
                    , SPO NUMBER PATH '$.SPO'
                    , CHK PATH '$.CHK'
                    , REV PATH '$.REV'
                    , REM PATH '$.REM'
                    , SPR NUMBER PATH '$.SPR'))
            MINUS
            SELECT PME_AMOUNTCU, PME_BILLRATE, PME_RATEDESC, PME_AMOUNTPV, DECODE(PME_KW_CHECK, 0, 'false', 1, 'true', 'false'), DECODE(PME_KW_REVIEW, 0, 'false', 1, 'true', 'false'), PME_COMMENT, PME_AMOUNTPV_PP 
            FROM PRMODELENTRY
            WHERE PME_PMVID = P_PME_PMVID);
        
        SELECT COUNT(*) INTO TABLE_MINUS_JSON_COUNT FROM(
            SELECT PME_AMOUNTCU, PME_BILLRATE, PME_RATEDESC, PME_AMOUNTPV, DECODE(PME_KW_CHECK, 0, 'false', 1, 'true', 'false'), DECODE(PME_KW_REVIEW, 0, 'false', 1, 'true', 'false'), PME_COMMENT, PME_AMOUNTPV_PP 
            FROM PRMODELENTRY
            WHERE PME_PMVID = P_PME_PMVID
            MINUS
            SELECT ACU, BR, DSC, SPO, CHK, REV, REM, SPR 
            FROM JSON_TABLE(P_PME_JSON, '$[*]' 
            COLUMNS (ACU NUMBER PATH '$.ACU'
                    , BR NUMBER PATH '$.BR'
                    , DSC PATH '$.DSC'
                    , SPO NUMBER PATH '$.SPO'
                    , CHK PATH '$.CHK'
                    , REV PATH '$.REV'
                    , REM PATH '$.REM'
                    , SPR NUMBER PATH '$.SPR')));
     
        IF (JSON_MINUS_TABLE_COUNT <> 0  OR TABLE_MINUS_JSON_COUNT <> 0) THEN
            DELETE FROM PRMODELENTRY WHERE PME_PMVID = P_PME_PMVID;
            FOR CUR IN CONTENT_CUR(P_PME_JSON)
            LOOP
                INSERT INTO PRMODELENTRY (PME_ID, PME_PMVID, PME_BILLRATE, PME_AMOUNTCU, PME_RATEDESC, PME_AMOUNTPV, PME_AMOUNTMO, PME_AMOUNTPV_PP, PME_AMOUNTMO_PP, PME_COMMENT, PME_KW_CHECK, PME_KW_REVIEW)
                VALUES (GENERATEUNIQUEKEY('G'), P_PME_PMVID, CUR.BR, CUR.ACU, NVL(CUR.DSC, 'undefined rate'), CUR.SPO, CUR.ACU - CUR.SPO, CUR.SPR, CUR.ACU - CUR.SPR, CUR.REM, DECODE(CUR.CHK, 'false', 0, 'true', 1, 0), DECODE(CUR.REV, 'false', 0, 'true', 1, 0));
            END LOOP;
        END IF;
    END IF;
END;
/


--
-- GPSH_TOAC_CON_DEL  (Procedure) 
--
CREATE OR REPLACE PROCEDURE SBS1_ADMIN.gpsh_toac_con_del(
      P_CON_ID IN VARCHAR2
)
   IS
-- MODIFICATION HISTORY
-- ---------    ------      -------------------------------------------
-- Person       Date        Comments
-- SS           21.07.2016  Created

BEGIN

    UPDATE CONTRACT SET CON_ESID = 'D'
    WHERE CON_ID = P_CON_ID;

END; -- Procedure
/


--
-- GPSH_TPAC_CON_DEL  (Procedure) 
--
CREATE OR REPLACE PROCEDURE SBS1_ADMIN.gpsh_tpac_con_del(
      P_CON_ID IN VARCHAR2
)
   IS
-- MODIFICATION HISTORY
-- ---------    ------      -------------------------------------------
-- Person       Date        Comments
-- SO           11.04.2016  Created

BEGIN

    UPDATE CONTRACT SET CON_ESID = 'D'
    WHERE CON_ID = P_CON_ID;
    
END; -- Procedure
/


--
-- GPSH_TPAC_CON_PUT  (Procedure) 
--
CREATE OR REPLACE PROCEDURE SBS1_ADMIN.gpsh_tpac_con_put(
      P_CON_ID IN VARCHAR2
    , P_CON_JSON IN VARCHAR2)

   IS
-- MODIFICATION HISTORY
-- ---------    ------      -------------------------------------------
-- Person       Date        Comments
-- SO           11.04.2016  Created
-- SO           18.04.2016  Added CON_SRCTYPE
-- SS           25.07.2016  Added CON_SETOPT
-- 001SO        07.08.2016  Added CON_DATECRE, CON_DATEMOD attributes
-- SS           11.01.2018  Removed CON_IGNORE_DUOBILL attribute
-- 002SS        15.02.2018  Removed CON_MFLID and added CON_PRICEPG
-- 003SO        15.11.2018  Remove CON_DEMO CON_PROTOCOL
-- 003SS        16.11.2018  Changed interface to accept json and added MWD paramters

    ACID                     VARCHAR2(20);
    CONSOL                   VARCHAR2(6);
    DATEBLOCK                VARCHAR2(25);
    DATEEND                  VARCHAR2(25);
    DATESTART                VARCHAR2(25);
    ESID                     VARCHAR(1);
    ESTID                    VARCHAR2(10);
    ETID                     VARCHAR2(10);
    HDGROUP                  NUMBER(1,0);
    HOTLINEPHONE             VARCHAR2(100);   -- 003SS
    HOTLINEEMAIL             VARCHAR2(100);   -- 003SS
    IWRS                     NUMBER(7,4);
    MFGR                     NUMBER(10,4);
    MINCHARGE                NUMBER(12,4);
    MOROAMINGPROM            NUMBER(1,0);
    MTROAMINGPROM            NUMBER(1,0);
    NAME                     VARCHAR2(100);
    PMID                     VARCHAR2(10);
    PRICE                    NUMBER(6,4);
    PRICEHG                  NUMBER(6,4);
    PRICEINT                 NUMBER(6,4);
    PRICEMOFN                NUMBER(6,4);
    PRICEPG                  NUMBER(6,4);
    PROVIDERNAME             VARCHAR2(100);  -- 003SS
    PSCALL                   VARCHAR2(20);
    RARR_ALLOWED             NUMBER(1,0);
    RARR_HIDDEN              NUMBER(1,0);
    RSID                     VARCHAR2(10);
    SETOPT                   VARCHAR2(10);
    SHORTID                  VARCHAR2(6);
    TARID                    VARCHAR2(1);
    THROUGPUT                NUMBER(9,4);

    L_AC_ID   VARCHAR2(10);

    CURSOR CACC (CON_ACID_IN IN VARCHAR2)
        IS SELECT AC_ID
            FROM   ACCOUNT
            WHERE  AC_ID = CON_ACID_IN;

BEGIN

    SELECT CON_ACID,
           CON_CONSOL,
           CON_DATEBLOCK,
           CON_DATEEND,
           CON_DATESTART,
           CON_ESID,
           CON_ESTID,
           CON_ETID,
           CON_HDGROUP,
           CON_HOTLINEPHONE,
           CON_HOTLINEEMAIL,
           CON_IWRS,
           CON_MFGR,
           CON_MINCHARGE,
           CON_MOROAMINGPROM,
           CON_MTROAMINGPROM,
           CON_NAME,
           CON_PMID,
           CON_PRICE,
           CON_PRICEHG,
           CON_PRICEINT,
           CON_PRICEMOFN,
           CON_PRICEPG,
           CON_PROVIDERNAME,
           CON_PSCALL,
           CON_RARR_ALLOWED,
           CON_RARR_HIDDEN,
           CON_RSID,
           CON_SETOPT,
           CON_SHORTID,
           CON_TARID,
           CON_THROUGPUT
  INTO   ACID,
         CONSOL,
         DATEBLOCK,
         DATEEND,
         DATESTART,
         ESID,
         ESTID,
         ETID,
         HDGROUP,
         HOTLINEPHONE,
         HOTLINEEMAIL,
         IWRS,
         MFGR,
         MINCHARGE,
         MOROAMINGPROM,
         MTROAMINGPROM,
         NAME,
         PMID,
         PRICE,
         PRICEHG,
         PRICEINT,
         PRICEMOFN,
         PRICEPG,
         PROVIDERNAME,
         PSCALL,
         RARR_ALLOWED,
         RARR_HIDDEN,
         RSID,
         SETOPT,
         SHORTID,
         TARID,
         THROUGPUT
  FROM JSON_TABLE(P_CON_JSON, '$' COLUMNS(
        CON_ACID            PATH '$.CON_ACID',
        CON_CODE            PATH '$.CON_CODE',
        CON_CONSOL          PATH '$.CON_CONSOL',
        CON_DATEBLOCK       PATH '$.CON_DATEBLOCK',
        CON_DATEEND         PATH '$.CON_DATEEND',
        CON_DATESTART       PATH '$.CON_DATESTART',
        CON_ESID            PATH '$.CON_ESID',
        CON_ESTID           PATH '$.CON_ESTID',
        CON_ETID            PATH '$.CON_ETID',
        CON_HDGROUP         NUMBER PATH '$.CON_HDGROUP',
        CON_HOTLINEPHONE    PATH '$.CON_HOTLINEPHONE',
        CON_HOTLINEEMAIL    PATH '$.CON_HOTLINEEMAIL',
        CON_IWRS            NUMBER PATH '$.CON_IWRS',
        CON_MFGR            NUMBER PATH '$.CON_MFGR',
        CON_MINCHARGE       NUMBER PATH '$.CON_MINCHARGE',
        CON_MOROAMINGPROM   NUMBER PATH '$.CON_MOROAMINGPROM',
        CON_MTROAMINGPROM   NUMBER PATH '$.CON_MTROAMINGPROM',
        CON_NAME            PATH '$.CON_NAME',
        CON_PMID            PATH '$.CON_PMID',
        CON_PRICE           NUMBER PATH '$.CON_PRICE',
        CON_PRICEHG         NUMBER PATH '$.CON_PRICEHG',
        CON_PRICEINT        NUMBER PATH '$.CON_PRICEINT',
        CON_PRICEMOFN       NUMBER PATH '$.CON_PRICEMOFN',
        CON_PRICEPG         NUMBER PATH '$.CON_PRICEPG',
        CON_PROVIDERNAME    PATH '$.CON_PROVIDERNAME',
        CON_PSCALL          PATH '$.CON_PSCALL',
        CON_RARR_ALLOWED    NUMBER PATH '$.CON_RARR_ALLOWED',
        CON_RARR_HIDDEN     NUMBER PATH '$.CON_RARR_HIDDEN',
        CON_RSID            PATH '$.CON_RSID',
        CON_SETOPT          PATH '$.CON_SETOPT',
        CON_SHORTID         PATH '$.CON_SHORTID',
        CON_TARID           PATH '$.CON_TARID',
        CON_THROUGPUT       NUMBER PATH '$.CON_THROUGHPUT'));  -- 003SS

    OPEN CACC(ACID);
    FETCH CACC into L_AC_ID;
    if CACC%Notfound then
        Insert Into ACCOUNT (
        AC_ID,
        AC_ETID,
        AC_DEMO,
        AC_SHORT,
        AC_NAME,
        AC_LOGRET,
        AC_LANGID,
        AC_VAT,
        AC_CURRENCY,
        AC_ESID,
        AC_ADRID_MAIN,
        AC_ADRID_MAINCONTACT,
        AC_DATECRE,
        AC_CHNGCNT
        )
        Select
        ACID,
        'LA',
        0,
        ACID,
        ACID,
        0,
        'de',
        0,
        'CHF',
        'A',
        gpsh_tpac_new_adr_id(NULL),
        gpsh_tpac_new_adr_id(NULL),
        SysDate,
        0
        From Dual;
    end if;
    Close cAcc;

    UPDATE CONTRACT SET
      CON_ACID = ACID
    , CON_CONSOL = CONSOL
    , CON_DATEBLOCK = from_json_date(DATEBLOCK)
    , CON_DATEEND = from_json_date(DATEEND)
    , CON_DATESTART = from_json_date(DATESTART)
    , CON_ESID = ESID
    , CON_ESTID = ESTID
    , CON_ETID = ETID
    , CON_HOTLINEPHONE = HOTLINEPHONE
    , CON_HOTLINEEMAIL = HOTLINEEMAIL
    , CON_HDGROUP = HDGROUP
    , CON_IWRS = IWRS
    , CON_MFGR = MFGR
    , CON_MINCHARGE = MINCHARGE
    , CON_MOROAMINGPROM = MOROAMINGPROM
    , CON_MTROAMINGPROM = MTROAMINGPROM
    , CON_NAME = NAME
    , CON_PMID = PMID
    , CON_PRICE = PRICE
    , CON_PRICEHG = PRICEHG
    , CON_PRICEINT = PRICEINT
    , CON_PRICEMOFN = PRICEMOFN
    , CON_PRICEPG = PRICEPG    -- 002SS
    , CON_PROVIDERNAME = PROVIDERNAME
    , CON_PSCALL = PSCALL
    , CON_RARR_ALLOWED = RARR_ALLOWED
    , CON_RARR_HIDDEN = RARR_HIDDEN
    , CON_RSID = RSID
    , CON_SHORTID = SHORTID
    , CON_TARID = TARID
    , CON_THROUGPUT = THROUGPUT
    , CON_SETOPT = SETOPT
    , CON_DATEMOD = sysdate         -- 001SO
    WHERE CON_ID = P_CON_ID;        -- 003SS

    If (Sql%RowCount = 0) Then
        INSERT INTO CONTRACT (
              CON_ID, CON_ACID, CON_CONSOL, CON_DATEBLOCK, CON_DATEEND, CON_DATESTART
            , CON_ESID, CON_ESTID, CON_ETID, CON_HOTLINEEMAIL, CON_HOTLINEPHONE, CON_HDGROUP, CON_IWRS
            , CON_MFGR, CON_MINCHARGE, CON_MOROAMINGPROM, CON_MTROAMINGPROM
            , CON_NAME, CON_PMID, CON_PRICE, CON_PRICEHG, CON_PRICEINT, CON_PRICEMOFN, CON_PRICEPG   -- 002SS
            , CON_PROVIDERNAME, CON_PSCALL, CON_RARR_ALLOWED, CON_RARR_HIDDEN, CON_RSID
            , CON_SHORTID, CON_TARID, CON_THROUGPUT, CON_SRCTYPE, CON_SETOPT
            , CON_DATECRE
        ) VALUES (
              P_CON_ID, ACID, CONSOL, from_json_date(DATEBLOCK), from_json_date(DATEEND), from_json_date(DATESTART)
            , ESID, ESTID, ETID, HOTLINEEMAIL, HOTLINEPHONE, HDGROUP, IWRS
            , MFGR, MINCHARGE, MOROAMINGPROM, MTROAMINGPROM
            , NAME, PMID, PRICE, PRICEHG, PRICEINT, PRICEMOFN, PRICEPG-- 002SS
            , PROVIDERNAME, PSCALL, RARR_ALLOWED, RARR_HIDDEN,RSID, SHORTID
            , TARID, THROUGPUT, DECODE(ETID,'LAC','SMSC','MLC','MMSC','ISRV'),SETOPT
            , sysdate
        );
    end if; -- 003SO -- 001SO -- 003SS

END; -- Procedure
/


--
-- GPSH_TPAC_DEL  (Procedure) 
--
CREATE OR REPLACE PROCEDURE SBS1_ADMIN.gpsh_tpac_del(
      P_AC_ID IN VARCHAR2
)
   IS
-- MODIFICATION HISTORY
-- ---------    ------      -------------------------------------------
-- Person       Date        Comments
-- SS           24.02.2017  Created

BEGIN

    UPDATE ACCOUNT SET AC_ESID = 'D'
    WHERE AC_ID = P_AC_ID;
    
END;
/


--
-- GPSH_TPAC_KEYWORD_DEL  (Procedure) 
--
CREATE OR REPLACE PROCEDURE SBS1_ADMIN.gpsh_tpac_keyword_del(
      P_CON_ID IN VARCHAR2
)
   IS
-- MODIFICATION HISTORY
-- ---------    ------      -------------------------------------------
-- Person       Date        Comments
-- SS           28.08.2016  Created

BEGIN
    DELETE FROM KEYWORD WHERE   KEY_CONID = P_CON_ID;

END; -- Procedure
/


--
-- GPSH_TPAC_KEYWORD_PUT  (Procedure) 
--
CREATE OR REPLACE PROCEDURE SBS1_ADMIN.GPSH_TPAC_KEYWORD_PUT(
    P_CON_ID IN VARCHAR2,
    P_KEY_JSON IN VARCHAR2)

-- MODIFICATION HISTORY
-- ---------    ------      -------------------------------------------
-- Person       Date        Comments
-- SS001        28.09.2016  Created
-- SO002        28.09.2016  Counter datatypes and comparison changed
-- SS003        05.05.2017  Checking the count of input and data in db before comparing values

IS

    KEYWORDS_IN_COUNT NUMBER(5);    -- SO002
    KEYWORDS_DB_COUNT NUMBER(5);    -- SO002

    CURSOR KEYWORD_CUR (KEY_IN IN VARCHAR2)
    IS
        SELECT J.KEYWORD, J.BILLRATE, J.ALLOWED
        FROM JSON_TABLE(KEY_IN, '$[*]'
            COLUMNS(KEYWORD PATH '$.KEYWORD', BILLRATE PATH '$.BILLRATE', ALLOWED PATH '$.ALLOWED')) AS J;

BEGIN

    SELECT COUNT(*) INTO KEYWORDS_IN_COUNT
     FROM JSON_TABLE(P_KEY_JSON, '$[*]' COLUMNS (KEYWORD PATH '$.KEYWORD'));

    SELECT COUNT(*) INTO KEYWORDS_DB_COUNT
     FROM KEYWORD WHERE KEY_CONID = P_CON_ID;

    IF KEYWORDS_IN_COUNT = KEYWORDS_DB_COUNT THEN
        SELECT COUNT(*) INTO KEYWORDS_DB_COUNT
        FROM KEYWORD A  INNER JOIN
            (select * from JSON_TABLE
                (P_KEY_JSON , '$[*]' COLUMNS (KEYWORD PATH '$.KEYWORD', BILLRATE PATH '$.BILLRATE', ALLOWED PATH '$.ALLOWED'))) B
             ON A.KEY_KEYWORD = B.KEYWORD
             AND A.KEY_BILLRATE = B.BILLRATE
             AND A.KEY_ALLOWED = from_json_boolean(B.ALLOWED)
             AND A.KEY_CONID = P_CON_ID;
    END IF;

    IF KEYWORDS_IN_COUNT <> KEYWORDS_DB_COUNT THEN
        DELETE FROM KEYWORD WHERE KEY_CONID = P_CON_ID;
        FOR CUR IN KEYWORD_CUR(P_KEY_JSON)
        LOOP
             INSERT INTO KEYWORD (KEY_ID, KEY_CONID, KEY_KEYWORD, KEY_BILLRATE, KEY_ALLOWED, KEY_DATECRE)
             VALUES (GENERATEUNIQUEKEY('G'), P_CON_ID, CUR.KEYWORD, CUR.BILLRATE, from_json_boolean(CUR.ALLOWED), SYSDATE);
        END LOOP;
    END IF;
END;
/


--
-- GPSH_TPAC_PUT  (Procedure) 
--
CREATE OR REPLACE PROCEDURE SBS1_ADMIN.GPSH_TPAC_PUT(
    P_AC_ID IN VARCHAR2,
    P_AC_JSON IN VARCHAR2)

-- MODIFICATION HISTORY
-- ---------    ------      -------------------------------------------
-- Person       Date        Comments
-- SS           24.02.2017  Created
-- SS           25.07.2017  Added MBUNIT

IS
    NAME             VARCHAR2(100);
    INVOICE_EMAILS   VARCHAR2(4000);
    MBUNIT           VARCHAR2(15);
    STATS_EMAILS     VARCHAR2(4000);
    T_AC_ID          VARCHAR2(20);
BEGIN
    SELECT AC_NAME, AC_IN_EMAILS, AC_MBUNIT, AC_ST_EMAILS
    INTO NAME, INVOICE_EMAILS, MBUNIT, STATS_EMAILS
    FROM JSON_TABLE(P_AC_JSON, '$' COLUMNS(
        AC_NAME PATH '$.NAME',
        AC_IN_EMAILS PATH '$.INVOICE_EMAILIDS',
        AC_MBUNIT PATH '$.MBUNIT',
        AC_ST_EMAILS PATH '$.STATISTICS_EMAILIDS'));

    SELECT AC_ID INTO T_AC_ID FROM ACCOUNT RIGHT JOIN DUAL ON AC_ID = P_AC_ID;
    IF T_AC_ID IS NULL THEN
        Insert Into ACCOUNT (
            AC_ID,
            AC_ETID,
            AC_DEMO,
            AC_SHORT,
            AC_NAME,
            AC_LOGRET,
            AC_LANGID,
            AC_VAT,
            AC_CURRENCY,
            AC_ESID,
            AC_ADRID_MAIN,
            AC_ADRID_MAINCONTACT,
            AC_DATECRE,
            AC_CHNGCNT,
            AC_LA_INVOICE_EMAILS,
            AC_BN_STATS_EMAILS,
            AC_MBUNIT
        )
        Select
            P_AC_ID,
            'LA',
            0,
            P_AC_ID,
            NAME,
            0,
            'de',
            0,
            'CHF',
            'A',
            gpsh_tpac_new_adr_id(NULL),
            gpsh_tpac_new_adr_id(NULL),
            SysDate,
            0,
            INVOICE_EMAILS,
            STATS_EMAILS,
            MBUNIT
        From Dual;
    ELSE
        UPDATE ACCOUNT SET
            AC_ESID = 'A',
            AC_NAME = NAME,
            AC_LA_INVOICE_EMAILS = INVOICE_EMAILS,
            AC_BN_STATS_EMAILS = STATS_EMAILS,
            AC_MBUNIT = MBUNIT,
            AC_DATEMOD = SYSDATE
        WHERE AC_ID = P_AC_ID;
    END IF;
END;
/


--
-- BN_STATS_EMAILS  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.BN_STATS_EMAILS (
    p_AC_ID IN VARCHAR2
) RETURN  VARCHAR2 IS
--
-- Purpose: Return concatenated eMail adresses for BN-Statistics for given AC_ID
--
-- MODIFICATION HISTORY
-- Person   Date        Comments
-- ------   ----------  -------------------------------------------
-- 001SO    27.08.2011  Created
-- 002SO    23.02.2017  Use ACCOUNT.AC_BN_STATS_EMAILS directly
-- 003SO    25.04.2017  Longer Variables
-- 004SO    05.05.2017  Simplify Body

    CURSOR cEmails IS
    SELECT  AC_BN_STATS_EMAILS as ADR_EMAIL
    FROM    ACCOUNT
    WHERE   AC_ID = p_AC_ID
    ; -- 002SO

    l_retval      VARCHAR2(4000);   -- 003SO

BEGIN

    l_retval := null;

    OPEN cEmails;
    FETCH cEmails into l_retval;
    CLOSE cEmails;
    RETURN l_retval;
    
END;
/


--
-- CONTRACT_AMOUNT_RANGE  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.CONTRACT_AMOUNT_RANGE (
        p_CON_ID            In Varchar2
    ) Return Varchar2
Is  

    -- return Amount range for given contract from current price model version 
    
    l_retval            Varchar2(20);                                   

Begin

    SELECT
    	DECODE(trim(to_char(MIN(PME_AMOUNTCU),'99990.00')) || '..' || trim(to_char(MAX(PME_AMOUNTCU),'99990.00')),'..','-0.01',trim(to_char(MIN(PME_AMOUNTCU),'99990.00')) || '..' || trim(to_char(MAX(PME_AMOUNTCU),'99990.00')))
   	INTO l_retval
    FROM  (
    SELECT
    	PME_AMOUNTCU
    FROM
        CONTRACT,
    	PRMODELVER,
    	PRMODELENTRY
    WHERE   CONTRACT.CON_PMID = PRMODELVER.PMV_PMID
    	AND	PRMODELVER.PMV_ID = PRMODELENTRY.PME_PMVID
    	AND	CON_ID = p_CON_ID
    	AND	PMV_START <= sysdate
    	AND	PMV_END > sysdate
    	AND	PMV_ESID IN ('A')
    	AND PME_RATEDESC <> 'undefined Rate'
    	AND	(PME_BILLRATE = 50 OR PME_BILLRATE IN (SELECT     MIN(PME_BILLRATE)-1     FROM PRMODELVER, PRMODELENTRY     WHERE PRMODELVER.PMV_ID = PRMODELENTRY.PME_PMVID     AND PMV_PMID = CON_PMID     AND PMV_START <= sysdate     AND PMV_END > sysdate     AND PMV_ESID IN ('A')     AND PME_BILLRATE >= 51     AND (PME_RATEDESC = 'undefined Rate'     OR PME_KW_CHECK <> 0     OR PME_KW_REVIEW <> 0)     ))
    );

    return l_retval;
        
End CONTRACT_AMOUNT_RANGE;
 
/


--
-- CONTRACT_BILLRATES  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.CONTRACT_BILLRATES (
        p_CON_ID            In Varchar2
    ) Return Varchar2
Is  

    -- return list of colon separated valid bill rates for for given IP contract

    Cursor cBillRates IS
    SELECT
    	PME_BILLRATE
    FROM
        CONTRACT,
    	PRMODELVER,
    	PRMODELENTRY
    WHERE   CONTRACT.CON_PMID = PRMODELVER.PMV_PMID
    	AND	PRMODELVER.PMV_ID = PRMODELENTRY.PME_PMVID
    	AND	CON_ID = p_CON_ID
    	AND	PMV_START <= sysdate
    	AND	PMV_END > sysdate
    	AND	PMV_ESID IN ('A')
    	AND PME_RATEDESC <> 'undefined Rate'
   	ORDER BY PME_BILLRATE 
    ;

    
    l_retval            Varchar2(300):= '';                                   

Begin

    for cBillRatesRow in cBillRates loop
        if l_retval IS NULL then
            l_retval := trim(to_char(cBillRatesRow.PME_BILLRATE));
        else
            l_retval := l_retval || ';' || trim(to_char(cBillRatesRow.PME_BILLRATE));        
        end if;
    end loop;
    return l_retval;
        
End CONTRACT_BILLRATES;
 
/


--
-- CONTRACTCOUNTFORACCOUNT  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.CONTRACTCOUNTFORACCOUNT 
  ( P_AC_ID IN VARCHAR2)
  RETURN  NUMBER IS
--
-- Returns the number of "active" accounts belonging to an account
-- Condition: CON_ESID IN ('A','E','T')

    Cursor cContractCount(p_ac_id varchar2) is
        SELECT  COUNT(CON_ESID)
        FROM ACCOUNT, CONTRACT
        WHERE ACCOUNT.AC_ID = CONTRACT.CON_ACID
	    AND	AC_ID = p_ac_id
	    AND	CON_ESID IN ('A','E','T')
    ;

   contract_count                 NUMBER;

BEGIN 
    
    Open cContractCount(P_AC_ID);
    Fetch cContractCount into contract_count;
    If cContractCount%NotFound Then
        contract_count := 0;
    End If;
    Close cContractCount;
        
    RETURN contract_count ;
    
END; -- Function CONTRACTCOUNTFORACCOUNT
 
/


--
-- CONTRACT_IS_ACTIVE  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.CONTRACT_IS_ACTIVE (
    p_CON_ID IN VARCHAR2
) RETURN  NUMBER IS
--
-- Purpose: Return activity status of contract, depending on entity state,
-- start- and end date
--
-- MODIFICATION HISTORY
-- Person   Date        Comments
-- ------   ----------  -------------------------------------------
-- 001SO    27.01.2006  Created
-- 002SO    01.02.2006  Added code dup warning

-- ATTENTION: LOGIC IS DUPLICATED IN TRIGGERS               -- 002SO
--              ENPLA_ACCOUNT
--              ENPLA_CONTRACT

    l_esid          CONTRACT.con_esid%type;
    l_date_start    DATE;
    l_date_end      DATE;
    l_date_block    DATE;
    l_date_now      DATE;
    
BEGIN
    l_date_now := SYSDATE;
    
    SELECT  CON_ESID, CON_DATESTART, CON_DATEEND, CON_DATEBLOCK
    INTO    l_esid, l_date_start, l_date_end, l_date_block
    FROM    CONTRACT
    WHERE   CON_ID = p_CON_ID
    ;
    if l_esid <> 'A' then
        RETURN 0;
    elsif l_date_block <= l_date_now then
        RETURN 0;
    else
        if (l_date_start is NULL OR l_date_start <= l_date_now)
            AND (l_date_end is NULL OR l_date_end > l_date_now) then
            return 1;
        else
            return 0;
        end if;
    end if;
END;
 
/


--
-- CONTRACT_IS_ACTIVE_OR_TEST  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.CONTRACT_IS_ACTIVE_OR_TEST (
    p_CON_ID IN VARCHAR2
) RETURN  NUMBER IS
--
-- Purpose: Return activity status of contract, depending on entity state,
-- start- and end date
-- Returns 1 if contract is active (state A and in time frame)
-- returne 1 if contract is active or test and we are before start (considered as test mode)
--
-- MODIFICATION HISTORY
-- Person   Date        Comments
-- ------   ----------  -------------------------------------------
-- 001SO    30.04.2007  Created
-- 002SO    18.04.2010  REMOVE S B S 0 schema reference

-- ATTENTION: LOGIC IS DUPLICATED IN TRIGGERS
--              ENPLA_ACCOUNT
--              ENPLA_CONTRACT

    l_esid          CONTRACT.con_esid%type;
    l_date_start    DATE;
    l_date_end      DATE;
    l_date_block    DATE;
    l_date_now      DATE;
    
BEGIN
    l_date_now := SYSDATE;
    
    SELECT  CON_ESID, CON_DATESTART, CON_DATEEND, CON_DATEBLOCK
    INTO    l_esid, l_date_start, l_date_end, l_date_block
    FROM    CONTRACT
    WHERE   CON_ID = p_CON_ID
    ;
    if l_esid not in ('A','T') then
        RETURN 0;
    elsif l_date_block <= l_date_now then
        RETURN 0;
    else
        if (l_date_end is NULL OR l_date_end > l_date_now) then
            return 1;
        else
            return 0;
        end if;
    end if;
END;
/


--
-- CONTRACT_STATE  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.CONTRACT_STATE (
    p_CON_ID IN VARCHAR2
) RETURN  NUMBER IS
--
-- Purpose: Return activity status of contract, depending on entity state,
-- start- and end date
-- Returns 0 if contract is inactive, out of time frame or suspended
-- Returns 1 if contract is active (state A and in time frame)
-- Returne 2 if contract is test or we are before start (considered as test mode)
-- This mapping corresponds to the SBS instances as defined by MB (1_prod 2=test)
--
-- MODIFICATION HISTORY
-- Person   Date        Comments
-- ------   ----------  -------------------------------------------
-- 001SO    30.04.2007  Created

-- ATTENTION: LOGIC IS DUPLICATED IN TRIGGERS
--              ENPLA_ACCOUNT
--              ENPLA_CONTRACT

    l_esid          CONTRACT.con_esid%type;
    l_date_start    DATE;
    l_date_end      DATE;
    l_date_block    DATE;
    l_date_now      DATE;
    
BEGIN
    l_date_now := SYSDATE;
    
    SELECT  CON_ESID, CON_DATESTART, CON_DATEEND, CON_DATEBLOCK
    INTO    l_esid, l_date_start, l_date_end, l_date_block
    FROM    CONTRACT
    WHERE   CON_ID = p_CON_ID
    ;
    if l_esid not in ('A','T') then
        RETURN 0;
    elsif l_date_block <= l_date_now then
        RETURN 0;
    elsif (l_date_start is NULL OR l_date_start <= l_date_now)
            AND (l_date_end is NULL OR l_date_end > l_date_now) then
        if l_esid = 'A' then
            RETURN 1;
        else
            RETURN 2;
        end if;
    elsif (l_date_end is NULL OR l_date_end > l_date_now) then
        RETURN 2;
    else
        RETURN 0;
    end if;
END;
 
/


--
-- CONTRACT_ZERO_BILLRATES  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.CONTRACT_ZERO_BILLRATES (
        p_CON_ID            In Varchar2
    ) Return Varchar2
Is  

    -- return list of colon separated valid bill rates with zero Amount for for given IP contract

    Cursor cBillRates IS
    SELECT
    	PME_BILLRATE
    FROM
        CONTRACT,
    	PRMODELVER,
    	PRMODELENTRY
    WHERE   CONTRACT.CON_PMID = PRMODELVER.PMV_PMID
    	AND	PRMODELVER.PMV_ID = PRMODELENTRY.PME_PMVID
    	AND	CON_ID = p_CON_ID
    	AND	PMV_START <= sysdate
    	AND	PMV_END > sysdate
    	AND	PMV_ESID IN ('A')
    	AND PME_RATEDESC <> 'undefined Rate'
    	AND PME_AMOUNTCU = 0
   	ORDER BY PME_BILLRATE 
    ;

    
    l_retval            Varchar2(300):= '';                                   

Begin

    for cBillRatesRow in cBillRates loop
        if l_retval IS NULL then
            l_retval := trim(to_char(cBillRatesRow.PME_BILLRATE));
        else
            l_retval := l_retval || ';' || trim(to_char(cBillRatesRow.PME_BILLRATE));        
        end if;
    end loop;
    return l_retval;
        
End CONTRACT_ZERO_BILLRATES;
 
/


--
-- GETPRICERANGE  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.GETPRICERANGE (
        p_PM_ID            In Varchar2
    ) Return Varchar2
Is  

    -- used for evaluation of Amount range for given price model 
    
    l_retval            Varchar2(20);                                   

Begin

    SELECT
    	DECODE(trim(to_char(MIN(PME_AMOUNTCU),'99990.00')) || '..' || trim(to_char(MAX(PME_AMOUNTCU),'99990.00')),'..','-0.01',trim(to_char(MIN(PME_AMOUNTCU),'99990.00')) || '..' || trim(to_char(MAX(PME_AMOUNTCU),'99990.00')))
   	INTO l_retval
    FROM  (
    SELECT
    	PME_AMOUNTCU
    FROM
    	PRMODELVER,
    	PRMODELENTRY
    WHERE
    		PRMODELVER.PMV_ID = PRMODELENTRY.PME_PMVID
    	AND	PMV_PMID = p_PM_ID
    	AND	PMV_START <= sysdate
    	AND	PMV_END > sysdate
    	AND	PMV_ESID IN ('A')
    	AND PME_RATEDESC <> 'undefined Rate'
    	AND	(PME_BILLRATE = 50 OR PME_BILLRATE IN (SELECT     MIN(PME_BILLRATE)-1     FROM PRMODELVER, PRMODELENTRY     WHERE PRMODELVER.PMV_ID = PRMODELENTRY.PME_PMVID     AND PMV_PMID = p_PM_ID     AND PMV_START <= sysdate     AND PMV_END > sysdate     AND PMV_ESID IN ('A')     AND PME_BILLRATE >= 51     AND (PME_RATEDESC = 'undefined Rate'     OR PME_KW_CHECK <> 0     OR PME_KW_REVIEW <> 0)     ))
    );

    return l_retval;
        
End GETPRICERANGE;
 
/


--
-- GPULL_KEYWORD_JSON  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.gpull_keyword_json
  (P_CON_ID IN VARCHAR2
  ) RETURN  VARCHAR2 IS

-- Purpose: To generate keyword JSON value (sbsgui like) for the corresponding to contract id
--
-- MODIFICATION HISTORY
-- Person      Date    Comments
-- ---------   ------  -------------------------------------------
-- SS          14.10.16 Created

    RETURN_VAL  VARCHAR2(5000);
    
    CURSOR KEY_CUR (KEY_CONID_IN IN VARCHAR2)
    IS SELECT KEY_KEYWORD, KEY_BILLRATE, KEY_ALLOWED
        FROM KEYWORD
        WHERE KEY_CONID = KEY_CONID_IN
        ORDER BY KEY_KEYWORD, KEY_BILLRATE;

BEGIN
    SELECT DISTINCT KEY_CONID
    INTO RETURN_VAL
    FROM KEYWORD
    RIGHT JOIN DUAL ON KEY_CONID = P_CON_ID;

    IF RETURN_VAL IS NULL THEN
        RETURN 'null';
    ELSE
        RETURN_VAL := '{';
        FOR CUR IN KEY_CUR(P_CON_ID)
        LOOP
            RETURN_VAL := RETURN_VAL || json_string(CUR.KEY_KEYWORD) || ':{'
                                     || '"ALLOWED":' || json_boolean(CUR.KEY_ALLOWED) ||','
                                     || '"BILLRATE":' || json_number(CUR.KEY_BILLRATE) 
                                     || '},';
        END LOOP;
        RETURN_VAL := TRIM(TRAILING ',' FROM RETURN_VAL) || '}';
        
        RETURN RETURN_VAL;

    END IF;
END;
/


--
-- GPULL_PRICE_JSON  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.gpull_price_json
  (P_PRICE_KEY IN VARCHAR2
  ) RETURN  VARCHAR2 IS

-- Purpose: To generate JSON value (sbsgui like) for the corresponding price key
--
-- MODIFICATION HISTORY
-- Person      Date    Comments
-- ---------   ------  -------------------------------------------
-- SS          17.08.2016 Created
-- SO001       16.02.2017 NULL PM Version End Date if 01.01.2100
-- SS002       28.02.2017 PM version return "" instead of null
-- SS003       28.01.2018 PM content prepaid revenue not using nvl

    P_PM_ID     VARCHAR2(15);
    P_PMV_ID    VARCHAR2(15);
    P_PMV_TYPE  VARCHAR2(10);
    RETURN_VAL  VARCHAR2(10000);

    CURSOR PMVT_CUR (PMV_ID_IN IN VARCHAR2)
    IS SELECT PMVT_TRCLASS, PMVT_CLASSTYPE, PMVT_CLASSDESC, PMVT_AMOUNTMO, PMVT_AMOUNTMT, PMVT_COMMENT
        FROM PRMODELVERTRANS
        WHERE PMVT_PMVID = PMV_ID_IN
        ORDER BY PMVT_CLASSTYPE, PMVT_TRCLASS;

    CURSOR PME_CUR (PMV_ID_IN IN VARCHAR2)
    IS SELECT PME_BILLRATE, PME_AMOUNTCU, DECODE(PME_RATEDESC, 'undefined_rate', '', PME_RATEDESC) PME_RATEDESC, PME_AMOUNTPV, PME_AMOUNTPV_PP, PME_COMMENT, PME_KW_CHECK, PME_KW_REVIEW
        FROM PRMODELENTRY
        WHERE PME_PMVID = PMV_ID_IN
        ORDER BY PME_BILLRATE;

BEGIN
    SELECT PRICE_KEY
    INTO RETURN_VAL
    FROM gpsh_price_keylist
    RIGHT JOIN DUAL ON PRICE_KEY = P_PRICE_KEY;

    IF RETURN_VAL IS NULL THEN
        RETURN_VAL := 'null';
    ELSE
        SELECT PM_ID, PMV_ID, PMV_TYPE
        INTO P_PM_ID, P_PMV_ID, P_PMV_TYPE
        FROM JSON_TABLE(P_PRICE_KEY, '$'
        COLUMNS(PM_ID PATH '$[1]',
                PMV_ID PATH '$[3]',
                PMV_TYPE PATH '$[4]'));

        IF P_PMV_TYPE IS NULL THEN
            IF P_PMV_ID IS NULL THEN
                --Build price model
                SELECT '{'
                        || '"COMMENT":' || json_string(PM_COMMENT) || ','
                        || '"NAME":' || json_string(PM_NAME)
                        || '}'
                INTO RETURN_VAL
                FROM PRMODEL
                WHERE PM_ID = P_PM_ID;
            ELSE
                --Build price model version
                SELECT '{'
                        || '"COMMENT":' || json_string(PMV_COMMENT) || ','
                        || '"END":' || DECODE(PMV_END,to_date('01.01.2100','dd.mm.yyyy'),'""',json_date(PMV_END)) || ',' --SS002
                        || '"NAME":' || json_string(PMV_NAME) || ','
                        || '"START":' || json_date(PMV_START)
                        || '}'
                INTO RETURN_VAL
                FROM PRMODELVER
                WHERE PMV_ID = P_PMV_ID AND PMV_PMID = P_PM_ID;                 -- SO001
            END IF;

        ELSIF P_PMV_TYPE = 'ipprcvbr' THEN
            --Build price model version content
            RETURN_VAL := '[';
            FOR CUR IN PME_CUR(P_PMV_ID)
            LOOP
                RETURN_VAL := RETURN_VAL || '{'
                                         || '"ACU":' || json_number(CUR.PME_AMOUNTCU) ||','
                                         || '"BR":'  || json_number(CUR.PME_BILLRATE) ||','
                                         || '"DSC":' || json_string(CUR.PME_RATEDESC) ||','
                                         || '"SPO":' || json_number(CUR.PME_AMOUNTPV) ||','
                                         || '"CHK":' || json_boolean(CUR.PME_KW_CHECK) ||','
                                         || '"REV":' || json_boolean(CUR.PME_KW_REVIEW) ||','
                                         || '"REM":' || json_string(CUR.PME_COMMENT) ||','
                                         || '"SPR":' || json_number(CUR.PME_AMOUNTPV_PP)      -- SS003
                                         || '},';
            END LOOP;
            RETURN_VAL := TRIM(TRAILING ',' FROM RETURN_VAL) || ']';

        ELSIF P_PMV_TYPE = 'ipprcvtr' THEN
            --Build price model version transport
            RETURN_VAL := '[';
            FOR CUR IN PMVT_CUR(P_PMV_ID)
            LOOP
                RETURN_VAL := RETURN_VAL || '{'
                                         || '"CLASS":' || json_number(CUR.PMVT_TRCLASS) ||','
                                         || '"MEDIUM":' || json_string(CUR.PMVT_CLASSTYPE) ||','
                                         || '"PRICEMO":' || json_number(CUR.PMVT_AMOUNTMO) ||','
                                         || '"PRICEMT":' || json_number(CUR.PMVT_AMOUNTMT) ||','
                                         || '"REMARK":' || json_string(CUR.PMVT_COMMENT)
                                         || '},';
            END LOOP;
            RETURN_VAL := TRIM(TRAILING ',' FROM RETURN_VAL) || ']';

        ELSE
            RETURN_VAL := 'null';
        END IF;

    END IF;
    RETURN RETURN_VAL;
END;

--[{"ACU":0,"BR":0,"DSC":"0% / 0%","SPO":0},{"ACU":0.1,"BR":1,"DSC":"0% / 100%","SPO":0},{"ACU":0.2,"BR":2,"DSC":"0% / 100%","SPO":0},{"ACU":0.3,"BR":3,"DSC":"0% / 100%","SPO":0},{"ACU":0.4,"BR":4,"DSC":"0% / 100%","SPO":0},{"ACU":0.5,"BR":5,"DSC":"0% / 100%","SPO":0},{"ACU":0.6,"BR":6,"DSC":"0% / 100%","SPO":0},{"ACU":0.7,"BR":7,"DSC":"0% / 100%","SPO":0},{"ACU":0.8,"BR":8,"DSC":"0% / 100%","SPO":0},{"ACU":0.9,"BR":9,"DSC":"0% / 100%","SPO":0},{"ACU":1,"BR":10,"DSC":"0% / 100%","SPO":0},{"ACU":1.1,"BR":11,"DSC":"0% / 100%","SPO":0},{"ACU":1.2,"BR":12,"DSC":"0% / 100%","SPO":0},{"ACU":1.3,"BR":13,"DSC":"0% / 100%","SPO":0},{"ACU":1.4,"BR":14,"DSC":"0% / 100%","SPO":0},{"ACU":1.5,"BR":15,"DSC":"0% / 100%","SPO":0},{"ACU":1.6,"BR":16,"DSC":"0% / 100%","SPO":0},{"ACU":1.7,"BR":17,"DSC":"0% / 100%","SPO":0},{"ACU":1.8,"BR":18,"DSC":"0% / 100%","SPO":0},{"ACU":1.9,"BR":19,"DSC":"0% / 100%","SPO":0},{"ACU":2,"BR":20,"DSC":"0% / 100%","SPO":0},{"ACU":2.1,"BR":21,"DSC":"0% / 100%","SPO":0},{"ACU":2.2,"BR":22,"DSC":"0% / 100%","SPO":0},{"ACU":2.3,"BR":23,"DSC":"0% / 100%","SPO":0},{"ACU":2.4,"BR":24,"DSC":"0% / 100%","SPO":0},{"ACU":2.5,"BR":25,"DSC":"0% / 100%","SPO":0},{"ACU":2.6,"BR":26,"DSC":"0% / 100%","SPO":0},{"ACU":2.7,"BR":27,"DSC":"0% / 100%","SPO":0},{"ACU":2.8,"BR":28,"DSC":"0% / 100%","SPO":0},{"ACU":2.9,"BR":29,"DSC":"0% / 100%","SPO":0},{"ACU":3,"BR":30,"DSC":"0% / 100%","SPO":0},{"ACU":0.2,"BR":40,"DSC":"0%/100%","SPO":0},{"ACU":0,"BR":41,"DSC":"0%/100%","SPO":0},{"ACU":0.2,"BR":42,"DSC":"0%/100%","SPO":0},{"ACU":0.5,"BR":44,"DSC":"0%/100%","SPO":0},{"ACU":0.5,"BR":45,"DSC":"0%/100%","SPO":0},{"ACU":0,"BR":50,"DSC":"Special Split","SPO":0},{"ACU":0.1,"BR":51,"DSC":"0%/100%","SPO":0},{"ACU":0.2,"BR":52,"DSC":"0%/100%","SPO":0},{"ACU":3,"BR":53,"DSC":"0%/100%","SPO":0},{"ACU":20,"BR":54,"DSC":"0%/100%","SPO":0}]
--[{"CLASS":1,"MEDIUM":"MMS","PRICEMO":0.12,"PRICEMT":0.12,"REMARK":""},{"CLASS":30,"MEDIUM":"MMS","PRICEMO":0.3,"PRICEMT":0.3,"REMARK":""},{"CLASS":300,"MEDIUM":"MMS","PRICEMO":0.54,"PRICEMT":0.54,"REMARK":""},{"CLASS":160,"MEDIUM":"SMS","PRICEMO":0.05,"PRICEMT":0.05,"REMARK":""}]
/


--
-- GPULL_TPAC_JSON  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.gpull_tpac_json
  (P_AC_ID  IN VARCHAR2
  ) RETURN  VARCHAR2 IS

-- Purpose: To generate tpac JSON value (sbsgui like) for the corresponding to account id
--
-- MODIFICATION HISTORY
-- Person      Date    Comments
-- ---------   ------  -------------------------------------------
-- SS          24.02.17 Created
-- 001SS       24.07.17 MBUNIT added

    NAME            VARCHAR2(100);
    INVOICE_EMAILS   VARCHAR2(4000);
    STATS_EMAILS    VARCHAR2(4000);
    MBUNIT          VARCHAR2(20);
    RETURN_VAL      VARCHAR2(8100);

BEGIN
    SELECT AC_NAME, AC_LA_INVOICE_EMAILS, AC_BN_STATS_EMAILS, AC_MBUNIT
    INTO NAME, INVOICE_EMAILS, STATS_EMAILS, MBUNIT
    FROM ACCOUNT
    RIGHT JOIN DUAL ON AC_ID =  P_AC_ID;

    IF NAME IS NULL THEN
        RETURN 'null';
    ELSE
        RETURN_VAL := '{' || '"INVOICE_EMAILIDS":'         || json_string(INVOICE_EMAILS) || ','
                          || '"MBUNIT":'                   || json_string(MBUNIT) || ','
                          || '"NAME":'                     || json_string(NAME) || ','
                          || '"STATISTICS_EMAILIDS":'      || json_string(STATS_EMAILS)
                          || '}';
        RETURN RETURN_VAL;

    END IF;
END;
/


--
-- LA_ACNAME  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.la_acname (
    p_CONSOL IN VARCHAR2
) RETURN  VARCHAR2 IS
--
-- Purpose: Return current account name for large account with givne consolidation field
--
-- MODIFICATION HISTORY
-- Person   Date        Comments
-- ------   ----------  -------------------------------------------
-- 001SO    08.03.2009  Created

    CURSOR  cActive IS
    SELECT  AC_NAME
    FROM    CONTRACT, ACCOUNT
    WHERE   AC_ID = CON_ACID
    AND     CON_ETID = 'LAC'
    AND     CON_ESID In ('A')
    AND     (SYSDATE >= CON_DATESTART OR CON_DATESTART IS NULL)
    AND     (SYSDATE < CON_DATEEND OR CON_DATEEND IS NULL)
    AND     CON_CONSOL = p_CONSOL
    ;

    CURSOR  cActiveFuture IS
    SELECT  AC_NAME
    FROM    CONTRACT, ACCOUNT
    WHERE   AC_ID = CON_ACID
    AND     CON_ETID = 'LAC'
    AND     CON_ESID In ('A')
    AND     CON_CONSOL = p_CONSOL
    ORDER BY CON_DATESTART
    ;

    CURSOR  cInActive IS
    SELECT  AC_NAME
    FROM    CONTRACT, ACCOUNT
    WHERE   AC_ID = CON_ACID
    AND     CON_ETID = 'LAC'
    AND     CON_ESID In ('I')
    AND     CON_CONSOL = p_CONSOL
    ORDER BY CON_DATEEND DESC
    ;

    result      VARCHAR2(100);

BEGIN

    result := null;

    open cActive;
    fetch cActive into result;
    close cActive;
    if not (result is NULL) then
        return result;
    end if;

    open cActiveFuture;
    fetch cActiveFuture into result;
    close cActiveFuture;
    if not (result is NULL) then
        return result;
    end if;

    open cInActive;
    fetch cInActive into result;
    close cInActive;
    return result;

END;
/


--
-- LAC_IPC_ACID  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.lac_ipc_acid (
    p_CON_ID IN VARCHAR2
) RETURN  VARCHAR2 IS
--
-- Purpose: Return true account ID for SMS-LA contract (matching IPC account's ID)
--
-- MODIFICATION HISTORY
-- Person   Date        Comments
-- ------   ----------  -------------------------------------------
-- 001SO    16.03.2015  Created

    CURSOR  cActiveLac IS
    SELECT  CON_ACID as AC_ID
    FROM    CONTRACT
    WHERE   CON_ID = p_CON_ID
    AND     CON_ETID = 'LAC'
    AND     CON_ESID In ('A','T')
    AND     CON_TARID NOT IN ('P','S')
    AND     (SYSDATE >= CON_DATESTART OR CON_DATESTART IS NULL)
    AND     (SYSDATE < CON_DATEEND OR CON_DATEEND IS NULL)
    ;

    CURSOR  cActiveLacFuture IS
    SELECT  CON_ACID as AC_ID
    FROM    CONTRACT
    WHERE   CON_ID = p_CON_ID
    AND     CON_ETID = 'LAC'
    AND     CON_ESID In ('E','A','T')
    AND     CON_TARID NOT IN ('P','S')
    ;

    CURSOR  cActiveIpc IS
    SELECT  NVL((
                SELECT IPC.CON_ACID
                FROM CONTRACT IPC
                WHERE LAC.CON_CONSOL = IPC.CON_SHORTID
                AND IPC.CON_ETID = 'IPC'
                AND IPC.CON_ESID In ('A','T')
                AND (SYSDATE >= IPC.CON_DATESTART OR IPC.CON_DATESTART IS NULL)
                AND (SYSDATE < IPC.CON_DATEEND OR IPC.CON_DATEEND IS NULL)
                )
            ,LAC.CON_ACID) as AC_ID
    FROM    CONTRACT LAC
    WHERE   LAC.CON_ID = p_CON_ID
    AND     LAC.CON_ETID = 'LAC'
    AND     LAC.CON_ESID In ('A','T')
    AND     LAC.CON_TARID IN ('P','S')
    AND     (SYSDATE >= LAC.CON_DATESTART OR LAC.CON_DATESTART IS NULL)
    AND     (SYSDATE < LAC.CON_DATEEND OR LAC.CON_DATEEND IS NULL)
    ;

    CURSOR  cInActive IS
    SELECT  CON_ACID as AC_ID
    FROM    CONTRACT
    WHERE   CON_ID = p_CON_ID
    AND     CON_ETID = 'LAC'
    -- AND     CON_ESID NOT In ('E','A','T')
    ;

    result      VARCHAR2(100);

BEGIN

    result := null;

    open cActiveLac;
    fetch cActiveLac into result;
    close cActiveLac;
    if not (result is NULL) then
        return result;
    end if;

    open cActiveLacFuture;
    fetch cActiveLacFuture into result;
    close cActiveLacFuture;
    if not (result is NULL) then
        return result;
    end if;

    open cActiveIpc;
    fetch cActiveIpc into result;
    close cActiveIpc;
    if not (result is NULL) then
        return result;
    end if;

    open cInActive;
    fetch cInActive into result;
    close cInActive;
    return result;

END;
/


--
-- LA_INVOICE_EMAILS  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.LA_INVOICE_EMAILS (
    p_AC_ID IN VARCHAR2
) RETURN  VARCHAR2 IS
--
-- Purpose: Return concatenated eMail adresses for invoices for given AC_ID
--
-- MODIFICATION HISTORY
-- Person   Date        Comments
-- ------   ----------  -------------------------------------------
-- 001SO    08.12.2009  Created
-- 002SO    23.02.2017  Use ACCOUNT.AC_LA_INVOICE_EMAILS directly
-- 003SO    25.04.2017  Longer Variables
-- 004SO    05.05.2017  Simplify Body

    CURSOR cEmails IS
    SELECT  AC_LA_INVOICE_EMAILS as ADR_EMAIL
    FROM    ACCOUNT
    WHERE   AC_ID = p_AC_ID
    ; -- 002SO

    l_retval      VARCHAR2(4000);   -- 003SO

BEGIN

    l_retval := null;

    OPEN cEmails;
    FETCH cEmails into l_retval;
    CLOSE cEmails;
    RETURN l_retval;

END;
/


--
-- MLC_IPC_ACID  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.mlc_ipc_acid (
    p_CON_ID IN VARCHAR2
) RETURN  VARCHAR2 IS
--
-- Purpose: Return true account ID for MMS-LA contract (matching IPC account's ID)
--
-- MODIFICATION HISTORY
-- Person   Date        Comments
-- ------   ----------  -------------------------------------------
-- 001SO    16.03.2015  Created

    CURSOR  cActiveLac IS
    SELECT  CON_ACID as AC_ID
    FROM    CONTRACT
    WHERE   CON_ID = p_CON_ID
    AND     CON_ETID = 'MLC'
    AND     CON_ESID In ('A','T')
    AND     CON_TARID NOT IN ('P','S')
    AND     (SYSDATE >= CON_DATESTART OR CON_DATESTART IS NULL)
    AND     (SYSDATE < CON_DATEEND OR CON_DATEEND IS NULL)
    ;

    CURSOR  cActiveLacFuture IS
    SELECT  CON_ACID as AC_ID
    FROM    CONTRACT
    WHERE   CON_ID = p_CON_ID
    AND     CON_ETID = 'MLC'
    AND     CON_ESID In ('E','A','T')
    AND     CON_TARID NOT IN ('P','S')
    ;

    CURSOR  cActiveIpc IS
    SELECT  NVL((
                SELECT IPC.CON_ACID
                FROM CONTRACT IPC
                WHERE LAC.CON_CONSOL = IPC.CON_SHORTID
                AND IPC.CON_ETID = 'IPC'
                AND IPC.CON_ESID In ('A','T')
                AND (SYSDATE >= IPC.CON_DATESTART OR IPC.CON_DATESTART IS NULL)
                AND (SYSDATE < IPC.CON_DATEEND OR IPC.CON_DATEEND IS NULL)
                )
            ,LAC.CON_ACID) as AC_ID
    FROM    CONTRACT LAC
    WHERE   LAC.CON_ID = p_CON_ID
    AND     LAC.CON_ETID = 'MLC'
    AND     LAC.CON_ESID In ('A','T')
    AND     LAC.CON_TARID IN ('P','S')
    AND     (SYSDATE >= LAC.CON_DATESTART OR LAC.CON_DATESTART IS NULL)
    AND     (SYSDATE < LAC.CON_DATEEND OR LAC.CON_DATEEND IS NULL)
    ;

    CURSOR  cInActive IS
    SELECT  CON_ACID as AC_ID
    FROM    CONTRACT
    WHERE   CON_ID = p_CON_ID
    AND     CON_ETID = 'MLC'
    -- AND     CON_ESID NOT In ('E','A','T')
    ;

    result      VARCHAR2(100);

BEGIN

    result := null;

    open cActiveLac;
    fetch cActiveLac into result;
    close cActiveLac;
    if not (result is NULL) then
        return result;
    end if;

    open cActiveLacFuture;
    fetch cActiveLacFuture into result;
    close cActiveLacFuture;
    if not (result is NULL) then
        return result;
    end if;

    open cActiveIpc;
    fetch cActiveIpc into result;
    close cActiveIpc;
    if not (result is NULL) then
        return result;
    end if;

    open cInActive;
    fetch cInActive into result;
    close cInActive;
    return result;

END;
/


--
-- PMV_BILLRATES  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.PMV_BILLRATES (
        p_PMV_ID            In Varchar2
    ) Return Varchar2
Is  

    -- return list of colon separated valid bill rates
    -- 0=-100;1=0;2=100 ... 99=0 
    -- before = Billrate 0..99 (integer)
    -- after  = Amount Customer in 0.001 CHF (integer)
    -- used for provisioning ISCP with end user prices

    Cursor cBillRates IS
    SELECT
    	to_char(PME_BILLRATE) || '=' || to_char(round(PME_AMOUNTCU*1000,0)) as item
    FROM
    	PRMODELENTRY
    WHERE   PRMODELENTRY.PME_PMVID = p_PMV_ID 
    	AND PME_RATEDESC <> 'undefined Rate'
   	ORDER BY PME_BILLRATE 
    ;
    
    l_retval            Varchar2(2000):= '';                                   
Begin

    for cBillRatesRow in cBillRates loop
        if l_retval IS NULL then
            l_retval := cBillRatesRow.item;
        else
            l_retval := l_retval || ';' || cBillRatesRow.item;      
        end if;
    end loop;
    return l_retval;
        
End PMV_BILLRATES;
 
/


--
-- RE_RATED_SMS_CDR  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.re_rated_sms_cdr (
    VasContractId       IN varchar2,
    TariffId            IN varchar2
) RETURN  NUMBER IS
--
-- Purpose: Used for re-rating of SMS CDRs (correction of incident in SBS Release 14.02.01)
--
-- MODIFICATION HISTORY
-- Person   Date        Comments
-- ------   ----------  -------------------------------------------
-- 001SO    16.09.2014  Created

    Cursor cSmsLaMtTariff(CONID VARCHAR2, TARID VARCHAR2)
        IS  SELECT
            NVL(CON_PRICE,TAR_PRICE) + DECODE(NVL(CON_PRICE,TAR_PRICE),0.00,0.00,RS_PRICE)  scm_price,                  -- 384SO -- SCM price  / + NVL(CON_NOTFLAG * CON_NOTCHARGE,0.0)
            NVL(CON_PRICEINT,TAR_PRICEINT) + DECODE(NVL(CON_PRICEINT,TAR_PRICEINT),0.00,0.00,RS_PRICEINT) int_price,    -- 384SO -- INT price  / + NVL(CON_NOTFLAG * CON_NOTCHARGE,0.0)
            NVL(CON_HDGROUP,0) MOTID,
            CON_PRICE,                                                      -- mV: transport price
            CON_REFUNDCU                                                    -- mV: end user refund
        FROM CONTRACT, TARIFF, RETSCHEMA
        WHERE CON_ID = CONID
        AND TAR_ID = TARID
        AND RS_ID = NVL(CON_RSID,'P0')
        ;                                                                   -- 226SO
    cSmsLaMtTariffRow           cSmsLaMtTariff%rowtype;

    Cursor cSmsMoLaTariff(conid VARCHAR2, tarid VARCHAR2)
        Is  select
        NVL(CON_HDGROUP,0) MOTID,
        NVL(CON_PRICEHG,TAR_PRICEHG) PRICEHG,
        TAR_HGZNID HGZNID,
        CON_PRICE,                                      -- mV: transport price
        CON_PRICECU,                                    -- mV: end user price
        CON_REFUNDCU,                                   -- mV: end user refund
        CON_RETSHAREPV,                                 -- mV: revenue share LA
        NVL(CON_PRICEMOFN,TAR_PRICEMOFN_DEF) CON_PRICEMOFN                  -- 345SO
        FROM CONTRACT,TARIFF
        WHERE TARIFF.TAR_ID = tarid
        AND CON_ID = conid
        ;
    cSmsMoLaTariffRow   cSmsMoLaTariff%rowtype;

    l_TransportCost  number(12,4);

BEGIN

   -- Only made for processing (rerating) SMS-LA CDRs withe BD_NPI_B = 1 BD_PID_B = 0 and BD_AMOUNTTR NOT NULL

   OPEN cSmsLaMtTariff(VasContractId,TariffId);
   FETCH cSmsLaMtTariff INTO cSmsLaMtTariffRow;
   if cSmsLaMtTariff%NOTFOUND then
       l_TransportCost := 0.00;        -- 116SO
   else
       -- Finalize the price calculation, now that we know about domestic / international
       -- Use LA pricing. Distinguish domestic and international price.    -- 226SO moved here, Lcase condition dropped
       -- If p_CdrInfo.PaymentMethod = cintPaymentUnknown then
           -- International price
       --    l_TransportCost := cSmsLaMtTariffRow.int_price;     -- 116SO
       --else
           -- Domestic price used for SCM network termination.
           l_TransportCost := cSmsLaMtTariffRow.scm_price; -- 116SO
       -- end if;
   end if;
   CLOSE cSmsLaMtTariff;

   return l_TransportCost;

END;
/


--
-- SMS_LA_MT_PRICE  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.sms_la_mt_price (
    VasContractId       IN varchar2,
    TariffId            IN varchar2,
    PaymentMethod       IN number
) RETURN  NUMBER IS
--
-- Purpose: Used for re-rating of SMS CDRs (correction of incident in SBS Release 14.02.01)
--
-- MODIFICATION HISTORY
-- Person   Date        Comments
-- ------   ----------  -------------------------------------------
-- 001SO    17.09.2014  Created

    Cursor cSmsLaMtTariff(CONID VARCHAR2, TARID VARCHAR2)
        IS  SELECT
            NVL(CON_PRICE,TAR_PRICE) + DECODE(NVL(CON_PRICE,TAR_PRICE),0.00,0.00,RS_PRICE)  scm_price,                  -- 384SO -- SCM price  / + NVL(CON_NOTFLAG * CON_NOTCHARGE,0.0)
            NVL(CON_PRICEINT,TAR_PRICEINT) + DECODE(NVL(CON_PRICEINT,TAR_PRICEINT),0.00,0.00,RS_PRICEINT) int_price,    -- 384SO -- INT price  / + NVL(CON_NOTFLAG * CON_NOTCHARGE,0.0)
            NVL(CON_HDGROUP,0) MOTID,
            CON_PRICE,                                                      -- mV: transport price
            CON_REFUNDCU                                                    -- mV: end user refund
        FROM CONTRACT, TARIFF, RETSCHEMA
        WHERE CON_ID = CONID
        AND TAR_ID = TARID
        AND RS_ID = NVL(CON_RSID,'P0')
        ;                                                                   -- 226SO
    cSmsLaMtTariffRow           cSmsLaMtTariff%rowtype;

    Cursor cSmsMoLaTariff(conid VARCHAR2, tarid VARCHAR2)
        Is  select
        NVL(CON_HDGROUP,0) MOTID,
        NVL(CON_PRICEHG,TAR_PRICEHG) PRICEHG,
        TAR_HGZNID HGZNID,
        CON_PRICE,                                      -- mV: transport price
        CON_PRICECU,                                    -- mV: end user price
        CON_REFUNDCU,                                   -- mV: end user refund
        CON_RETSHAREPV,                                 -- mV: revenue share LA
        NVL(CON_PRICEMOFN,TAR_PRICEMOFN_DEF) CON_PRICEMOFN                  -- 345SO
        FROM CONTRACT,TARIFF
        WHERE TARIFF.TAR_ID = tarid
        AND CON_ID = conid
        ;
    cSmsMoLaTariffRow   cSmsMoLaTariff%rowtype;

    l_TransportCost  number(12,4);

BEGIN

   -- Only made for processing (rerating) SMS-LA CDRs withe BD_NPI_B = 1 BD_PID_B = 0 (and maybe BD_AMOUNTTR NOT NULL)

   OPEN cSmsLaMtTariff(VasContractId,TariffId);
   FETCH cSmsLaMtTariff INTO cSmsLaMtTariffRow;
   if cSmsLaMtTariff%NOTFOUND then
       l_TransportCost := 0.00;        -- 116SO
   else
       -- Finalize the price calculation, now that we know about domestic / international
       -- Use LA pricing. Distinguish domestic and international price.    -- 226SO moved here, Lcase condition dropped
       If NVL(PaymentMethod,0) = 0 then
           -- International price
           l_TransportCost := cSmsLaMtTariffRow.int_price;     -- 116SO
       else
           -- Domestic price used for SCM network termination.
           l_TransportCost := cSmsLaMtTariffRow.scm_price; -- 116SO
       end if;
   end if;
   CLOSE cSmsLaMtTariff;

   return l_TransportCost;

END;
/


--
-- ALL_LA_EMAILS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.ALL_LA_EMAILS
(CON_CONSOL, AC_NAME, CON_NAME, CON_TARID, ADR_TYPE, 
 ADR_EMAIL)
BEQUEATH DEFINER
AS 
SELECT
    CON_CONSOL
    ,   AC_NAME
    ,   CON_NAME
    ,   CON_TARID
    ,   'AC_ADRID_MAIN' ADR_TYPE
    ,   A_MAIN.ADR_EMAIL ADR_EMAIL
FROM   CONTRACT,   ACCOUNT,   ADDRESS A_MAIN
WHERE    CONTRACT.CON_ACID = ACCOUNT.AC_ID
AND A_MAIN.ADR_ID = ACCOUNT.AC_ADRID_MAIN
AND CON_ETID = 'LAC'
AND CON_ESID In ('A','E')

UNION
SELECT
    CON_CONSOL
    ,   AC_NAME
    ,   CON_NAME
    ,   CON_TARID
    ,   'AC_ADRID_MAINCONTACT'
    ,   A_MAINCONTACT.ADR_EMAIL
FROM   CONTRACT,   ACCOUNT,   ADDRESS A_MAINCONTACT
WHERE    CONTRACT.CON_ACID = ACCOUNT.AC_ID
AND A_MAINCONTACT.ADR_ID = ACCOUNT.AC_ADRID_MAINCONTACT
AND CON_ETID = 'LAC'
AND CON_ESID In ('A','E')

UNION
SELECT
    CON_CONSOL,   AC_NAME,   CON_NAME,   CON_TARID,   'AC_ADRID_MARKETING',   A_MARKETING.ADR_EMAIL  FROM   CONTRACT,   ACCOUNT,   ADDRESS A_MARKETING  WHERE    CONTRACT.CON_ACID = ACCOUNT.AC_ID   AND A_MARKETING.ADR_ID = ACCOUNT.AC_ADRID_MARKETING   AND CON_ETID = 'LAC'   AND CON_ESID In ('A','E')  UNION  SELECT   CON_CONSOL,   AC_NAME,   CON_NAME,   CON_TARID,   'AC_ADRID_TECHNICAL',   A_TECHNICAL.ADR_EMAIL  FROM   CONTRACT,   ACCOUNT,   ADDRESS A_TECHNICAL  WHERE    CONTRACT.CON_ACID = ACCOUNT.AC_ID   AND A_TECHNICAL.ADR_ID = ACCOUNT.AC_ADRID_TECHNICAL   AND CON_ETID = 'LAC'   AND CON_ESID In ('A','E')  UNION  SELECT   CON_CONSOL,   AC_NAME,   CON_NAME,   CON_TARID,   'AC_ADRID_HELPDESK',   A_HELPDESK.ADR_EMAIL  FROM   CONTRACT,   ACCOUNT,   ADDRESS A_HELPDESK  WHERE    CONTRACT.CON_ACID = ACCOUNT.AC_ID   AND A_HELPDESK.ADR_ID = ACCOUNT.AC_ADRID_HELPDESK   AND CON_ETID = 'LAC'   AND CON_ESID In ('A','E')  UNION  SELECT   CON_CONSOL,   AC_NAME,   CON_NAME,   CON_TARID,   'AC_ADRID_FINANCE',   A_FINANCE.ADR_EMAIL  FROM   CONTRACT,   ACCOUNT,   ADDRESS A_FINANCE  WHERE    CONTRACT.CON_ACID = ACCOUNT.AC_ID   AND A_FINANCE.ADR_ID = ACCOUNT.AC_ADRID_FINANCE   AND CON_ETID = 'LAC'   AND CON_ESID In ('A','E')  UNION  SELECT   CON_CONSOL,   AC_NAME,   CON_NAME,   CON_TARID,   'AC_ADRID_OTHERS',   A_OTHERS.ADR_EMAIL  FROM   CONTRACT,   ACCOUNT,   ADDRESS A_OTHERS  WHERE    CONTRACT.CON_ACID = ACCOUNT.AC_ID   AND A_OTHERS.ADR_ID = ACCOUNT.AC_ADRID_OTHERS   AND CON_ETID = 'LAC'   AND CON_ESID In ('A','E')  UNION  SELECT   CON_CONSOL,   AC_NAME,   CON_NAME,   CON_TARID,   'AC_ADRID_INVOICE',   A_INVOICE.ADR_EMAIL  FROM   CONTRACT,   ACCOUNT,   ADDRESS A_INVOICE  WHERE    CONTRACT.CON_ACID = ACCOUNT.AC_ID   AND A_INVOICE.ADR_ID = ACCOUNT.AC_ADRID_INVOICE   AND CON_ETID = 'LAC'   AND CON_ESID In ('A','E');


--
-- BIHEADER_SBS1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.BIHEADER_SBS1
(BIH_ID, BIH_SRCTYPE, BIH_DEMO, BIH_IDENT, BIH_FILESEQ, 
 BIH_FILEFORM, BIH_DATETIME, BIH_FILENAME, BIH_FILEDATE, BIH_RECCOUNT, 
 BIH_DATEFC, BIH_DATELC, BIH_MAPID, BIH_START, BIH_END, 
 BIH_ESID, BIH_DATEIDX, BIH_EXE, BIH_VERSION, BIH_JOB, 
 BIH_HOST, BIH_HIHID, BIH_REVASID, BIH_DATEANALYZED, BIH_WHSYNCSID, 
 BIH_WHSYNCDATE, BIH_ERRCOUNT, BIH_THREAD, BIH_INDEXSID)
BEQUEATH DEFINER
AS 
SELECT "BIH_ID","BIH_SRCTYPE","BIH_DEMO","BIH_IDENT","BIH_FILESEQ","BIH_FILEFORM","BIH_DATETIME","BIH_FILENAME","BIH_FILEDATE","BIH_RECCOUNT","BIH_DATEFC","BIH_DATELC","BIH_MAPID","BIH_START","BIH_END","BIH_ESID","BIH_DATEIDX","BIH_EXE","BIH_VERSION","BIH_JOB","BIH_HOST","BIH_HIHID","BIH_REVASID","BIH_DATEANALYZED","BIH_WHSYNCSID","BIH_WHSYNCDATE","BIH_ERRCOUNT","BIH_THREAD","BIH_INDEXSID" FROM BIHEADER;


--
-- CENTRUM_USER_LIST  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.CENTRUM_USER_LIST
(AC_ID, AC_ETID, AC_DEMO, AC_NUMBER, AC_NAME, 
 AC_SHORT, AC_MBUNIT, AC_LASTLOGINTIME, AC_LANGID, AC_ESID, 
 AC_DEPT, AC_ADRID_MAIN, AC_DATECRE, AC_ACIDCRE, AC_DATEMOD, 
 AC_ACIDMOD, AC_COMMENT, AC_CHNGCNT, ADR_ID, ADR_ESID, 
 ADR_COMPANY, ADR_NAME, ADR_FNAME, ADR_STREET1, ADR_STREET2, 
 ADR_STREET3, ADR_STREET4, ADR_STREET5, ADR_ZIP, ADR_TOWN, 
 ADR_COUNTRY, ADR_PHONE1, ADR_PHONE2, ADR_MOBILE, ADR_FAX, 
 ADR_EMAIL, ADR_COMMENT, ADR_INFOFAX, ADR_INFOEMAIL, ADR_INFOSMS, 
 ADR_CHNGCNT)
BEQUEATH DEFINER
AS 
SELECT 
AC_ID,
AC_ETID,
AC_DEMO,
AC_NUMBER,
AC_NAME,
AC_SHORT,
AC_MBUNIT,
AC_LASTLOGINTIME,
AC_LANGID,
AC_ESID,
AC_DEPT,
AC_ADRID_MAIN,
AC_DATECRE,
AC_ACIDCRE,
AC_DATEMOD,
AC_ACIDMOD,
AC_COMMENT,
AC_CHNGCNT,
ADR_ID,
ADR_ESID,
ADR_COMPANY,
ADR_NAME,
ADR_FNAME,
ADR_STREET1,
ADR_STREET2,
ADR_STREET3,
ADR_STREET4,
ADR_STREET5,
ADR_ZIP,
ADR_TOWN,
ADR_COUNTRY,
ADR_PHONE1,
ADR_PHONE2,
ADR_MOBILE,
ADR_FAX,
ADR_EMAIL,
ADR_COMMENT,
ADR_INFOFAX,
ADR_INFOEMAIL,
ADR_INFOSMS,
ADR_CHNGCNT 
FROM ACCOUNT, ADDRESS
WHERE  ACCOUNT.AC_ADRID_MAIN = ADDRESS.ADR_ID
AND AC_ETID In (Select ACT_ID From CENTRUM_USERGROUP_LIST);


--
-- CONTRACTS_BY_SHORTID  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.CONTRACTS_BY_SHORTID
(SHORTID, CON_ACID, CON_ID, CON_SRCTYPE, CON_ETID, 
 CON_ESTID, CON_NAME, CON_PSCALL, CON_SERVICE, CON_PMID, 
 CON_TARID, CON_GART, CON_MBUID, CON_MCEFF, CON_MCAPPLIED, 
 CON_IPCONID, CON_PROXY_ENPLAID, CON_SMSC_ENPLAID, CON_MBRO_ENPLAID)
BEQUEATH DEFINER
AS 
SELECT
    NVL(CON_CONSOL,CON_SHORTID)  SHORTID
    ,   CON_ACID
    ,   CON_ID
    ,   CON_SRCTYPE
    ,   CON_ETID
    ,   CON_ESTID
    ,   CON_NAME
    ,   CON_PSCALL
    ,   NULL CON_SERVICE
    ,   CON_PMID
    ,   CON_TARID
    ,   NULL CON_GART
    ,   CON_MBUID
    ,   CON_MCEFF
    ,   CON_MCAPPLIED
    ,   CON_IPCONID
    ,   NULL CON_PROXY_ENPLAID
    ,   NULL CON_SMSC_ENPLAID
    ,   NULL CON_MBRO_ENPLAID
FROM   CONTRACT
WHERE    CON_ESID IN ('A')
ORDER BY   CON_ETID;


--
-- CONTRACTS_BY_SHORTID_A  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.CONTRACTS_BY_SHORTID_A
(SHORTID, CON_ACID, CON_ID, CON_SRCTYPE, CON_ETID, 
 CON_ESTID, CON_NAME, CON_PSCALL, CON_SERVICE, CON_PMID, 
 CON_TARID, CON_GART, CON_MBUID, CON_MCEFF, CON_MCAPPLIED, 
 CON_IPCONID, CON_PROXY_ENPLAID, CON_SMSC_ENPLAID, CON_MBRO_ENPLAID)
BEQUEATH DEFINER
AS 
SELECT
    NVL(CON_CONSOL,CON_SHORTID)  SHORTID
    ,   CON_ACID
    ,   CON_ID
    ,   CON_SRCTYPE
    ,   CON_ETID
    ,   CON_ESTID
    ,   CON_NAME
    ,   CON_PSCALL
    ,   NULL CON_SERVICE
    ,   CON_PMID
    ,   CON_TARID
    ,   NULL CON_GART
    ,   CON_MBUID
    ,   CON_MCEFF
    ,   CON_MCAPPLIED
    ,   CON_IPCONID
    ,   NULL CON_PROXY_ENPLAID
    ,   NULL CON_SMSC_ENPLAID
    ,   NULL CON_MBRO_ENPLAID
FROM   CONTRACT  
WHERE    CON_ESID IN ('A')  
and (con_dateend > sysdate or con_dateend is null)
and (con_dateblock is null or con_dateblock > sysdate);


--
-- CONTRACT_SCATTER  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.CONTRACT_SCATTER
(SHORTID, CON_COUNT)
BEQUEATH DEFINER
AS 
select NVL(CON_CONSOL, CON_SHORTID) as SHORTID, COUNT(*) as CON_COUNT 
from contract 
where CON_ETID in ('LAC', 'MLC', 'IPC') 
and not (CON_ESID in ('R', 'D')) 
and (CON_DATEEND is null or CON_DATEEND >= trunc(SYSDATE, 'MONTH')) 
and CON_NAME <> 'MBS Load Test' 
group by NVL(CON_CONSOL, CON_SHORTID) 
having COUNT(*) > 1;


--
-- DT_BIH  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.DT_BIH
(BIH_ID, BIH_SRCTYPE, BIH_MAPID, BIH_DATETIME, BIH_FILENAME, 
 BIH_RECCOUNT, BIH_ERRCOUNT, BIH_ESID, BIH_DATEFC, BIH_DATELC, 
 PROC_DURATION, PROC_SPEED, PROC_DLAY, BIH_HOST, BIH_EXE, 
 BIH_VERSION, BIH_THREAD, BIH_JOB, BIH_START, BIH_END)
BEQUEATH DEFINER
AS 
SELECT BIH_ID, BIH_SRCTYPE, BIH_MAPID, BIH_DATETIME, BIH_FILENAME,
BIH_RECCOUNT, BIH_ERRCOUNT, BIH_ESID, BIH_DATEFC, BIH_DATELC,
DURATION(BIH_END-BIH_START), SPEED(BIH_RECCOUNT,BIH_START,BIH_END), DURATION(BIH_END-BIH_DATEFC),
BIH_HOST, BIH_EXE, BIH_VERSION, BIH_THREAD, BIH_JOB, BIH_START, BIH_END
FROM BIHEADER;


--
-- DT_BIH_RECENT  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.DT_BIH_RECENT
(BIH_ID, BIH_SRCTYPE, BIH_MAPID, BIH_DATETIME, BIH_FILENAME, 
 BIH_RECCOUNT, BIH_ERRCOUNT, BIH_ESID, BIH_DATEFC, BIH_DATELC, 
 PROC_DURATION, PROC_SPEED, PROC_DLAY, BIH_HOST, BIH_EXE, 
 BIH_VERSION, BIH_THREAD, BIH_JOB, BIH_START, BIH_END)
BEQUEATH DEFINER
AS 
SELECT BIH_ID, BIH_SRCTYPE, BIH_MAPID, BIH_DATETIME, BIH_FILENAME,
BIH_RECCOUNT, BIH_ERRCOUNT, BIH_ESID, BIH_DATEFC, BIH_DATELC,
DURATION(BIH_END-BIH_START), SPEED(BIH_RECCOUNT,BIH_START,BIH_END), DURATION(BIH_END-BIH_DATEFC),
BIH_HOST, BIH_EXE, BIH_VERSION, BIH_THREAD, BIH_JOB, BIH_START, BIH_END
FROM DT_BIH
WHERE BIH_DATETIME > SYSDATE -1/24;


--
-- DT_BIH_RECENT_MBS_CO  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.DT_BIH_RECENT_MBS_CO
(BIH_ID, BIH_SRCTYPE, BIH_MAPID, BIH_DATETIME, BIH_FILENAME, 
 BIH_RECCOUNT, BIH_ERRCOUNT, BIH_ESID, BIH_DATEFC, BIH_DATELC, 
 PROC_DURATION, PROC_SPEED, PROC_DLAY, BIH_HOST, BIH_EXE, 
 BIH_VERSION, BIH_THREAD, BIH_JOB, BIH_START, BIH_END)
BEQUEATH DEFINER
AS 
SELECT BIH_ID, BIH_SRCTYPE, BIH_MAPID, BIH_DATETIME, BIH_FILENAME,
BIH_RECCOUNT, BIH_ERRCOUNT, BIH_ESID, BIH_DATEFC, BIH_DATELC,
DURATION(BIH_END-BIH_START), SPEED(BIH_RECCOUNT,BIH_START,BIH_END), DURATION(BIH_END-BIH_DATEFC),
BIH_HOST, BIH_EXE, BIH_VERSION, BIH_THREAD, BIH_JOB, BIH_START, BIH_END
FROM DT_BIH
WHERE BIH_DATETIME > SYSDATE -1/24
AND BIH_SRCTYPE IN ('ISRV')
AND BIH_MAPID IN ('MBS_CO')
ORDER BY BIH_DATETIME;


--
-- DT_BIH_RECENT_MBS_MO  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.DT_BIH_RECENT_MBS_MO
(BIH_ID, BIH_SRCTYPE, BIH_MAPID, BIH_DATETIME, BIH_FILENAME, 
 BIH_RECCOUNT, BIH_ERRCOUNT, BIH_ESID, BIH_DATEFC, BIH_DATELC, 
 PROC_DURATION, PROC_SPEED, PROC_DLAY, BIH_HOST, BIH_EXE, 
 BIH_VERSION, BIH_THREAD, BIH_JOB, BIH_START, BIH_END)
BEQUEATH DEFINER
AS 
SELECT BIH_ID, BIH_SRCTYPE, BIH_MAPID, BIH_DATETIME, BIH_FILENAME,
BIH_RECCOUNT, BIH_ERRCOUNT, BIH_ESID, BIH_DATEFC, BIH_DATELC,
DURATION(BIH_END-BIH_START), SPEED(BIH_RECCOUNT,BIH_START,BIH_END), DURATION(BIH_END-BIH_DATEFC),
BIH_HOST, BIH_EXE, BIH_VERSION, BIH_THREAD, BIH_JOB, BIH_START, BIH_END
FROM DT_BIH
WHERE BIH_DATETIME > SYSDATE -1/24
AND BIH_SRCTYPE IN ('ISRV')
AND BIH_MAPID IN ('MBS_MO')
ORDER BY BIH_DATETIME;


--
-- DT_BIH_RECENT_MMSC  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.DT_BIH_RECENT_MMSC
(BIH_ID, BIH_SRCTYPE, BIH_MAPID, BIH_DATETIME, BIH_FILENAME, 
 BIH_RECCOUNT, BIH_ERRCOUNT, BIH_ESID, BIH_DATEFC, BIH_DATELC, 
 PROC_DURATION, PROC_SPEED, PROC_DLAY, BIH_HOST, BIH_EXE, 
 BIH_VERSION, BIH_THREAD, BIH_JOB, BIH_START, BIH_END)
BEQUEATH DEFINER
AS 
SELECT BIH_ID, BIH_SRCTYPE, BIH_MAPID, BIH_DATETIME, BIH_FILENAME,
BIH_RECCOUNT, BIH_ERRCOUNT, BIH_ESID, BIH_DATEFC, BIH_DATELC,
DURATION(BIH_END-BIH_START), SPEED(BIH_RECCOUNT,BIH_START,BIH_END), DURATION(BIH_END-BIH_DATEFC),
BIH_HOST, BIH_EXE, BIH_VERSION, BIH_THREAD, BIH_JOB, BIH_START, BIH_END
FROM DT_BIH
WHERE BIH_DATETIME > SYSDATE -1/24
AND BIH_SRCTYPE IN ('MMSC')
ORDER BY BIH_DATETIME;


--
-- DT_BIH_RECENT_MSC  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.DT_BIH_RECENT_MSC
(BIH_ID, BIH_SRCTYPE, BIH_MAPID, BIH_DATETIME, BIH_FILENAME, 
 BIH_RECCOUNT, BIH_ERRCOUNT, BIH_ESID, BIH_DATEFC, BIH_DATELC, 
 PROC_DURATION, PROC_SPEED, PROC_DLAY, BIH_HOST, BIH_EXE, 
 BIH_VERSION, BIH_THREAD, BIH_JOB, BIH_START, BIH_END)
BEQUEATH DEFINER
AS 
SELECT BIH_ID, BIH_SRCTYPE, BIH_MAPID, BIH_DATETIME, BIH_FILENAME,
BIH_RECCOUNT, BIH_ERRCOUNT, BIH_ESID, BIH_DATEFC, BIH_DATELC,
DURATION(BIH_END-BIH_START), SPEED(BIH_RECCOUNT,BIH_START,BIH_END), DURATION(BIH_END-BIH_DATEFC),
BIH_HOST, BIH_EXE, BIH_VERSION, BIH_THREAD, BIH_JOB, BIH_START, BIH_END
FROM DT_BIH
WHERE BIH_DATETIME > SYSDATE -1/24
AND BIH_SRCTYPE IN ('MSC')
ORDER BY BIH_DATETIME;


--
-- DT_BIH_RECENT_MVP  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.DT_BIH_RECENT_MVP
(BIH_ID, BIH_SRCTYPE, BIH_MAPID, BIH_DATETIME, BIH_FILENAME, 
 BIH_RECCOUNT, BIH_ERRCOUNT, BIH_ESID, BIH_DATEFC, BIH_DATELC, 
 PROC_DURATION, PROC_SPEED, PROC_DLAY, BIH_HOST, BIH_EXE, 
 BIH_VERSION, BIH_THREAD, BIH_JOB, BIH_START, BIH_END)
BEQUEATH DEFINER
AS 
SELECT BIH_ID, BIH_SRCTYPE, BIH_MAPID, BIH_DATETIME, BIH_FILENAME,
BIH_RECCOUNT, BIH_ERRCOUNT, BIH_ESID, BIH_DATEFC, BIH_DATELC,
DURATION(BIH_END-BIH_START), SPEED(BIH_RECCOUNT,BIH_START,BIH_END), DURATION(BIH_END-BIH_DATEFC),
BIH_HOST, BIH_EXE, BIH_VERSION, BIH_THREAD, BIH_JOB, BIH_START, BIH_END
FROM DT_BIH
WHERE BIH_DATETIME > SYSDATE -1
AND BIH_MAPID = 'MVP_CO'
ORDER BY BIH_DATETIME;


--
-- DT_BIH_RECENT_OPER  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.DT_BIH_RECENT_OPER
(BIH_ID, BIH_SRCTYPE, BIH_MAPID, BIH_DATETIME, BIH_FILENAME, 
 BIH_RECCOUNT, BIH_ERRCOUNT, BIH_ESID, BIH_DATEFC, BIH_DATELC, 
 PROC_DURATION, PROC_SPEED, PROC_DLAY, BIH_HOST, BIH_EXE, 
 BIH_VERSION, BIH_THREAD, BIH_JOB, BIH_START, BIH_END)
BEQUEATH DEFINER
AS 
SELECT BIH_ID, BIH_SRCTYPE, BIH_MAPID, BIH_DATETIME, BIH_FILENAME,
BIH_RECCOUNT, BIH_ERRCOUNT, BIH_ESID, BIH_DATEFC, BIH_DATELC,
DURATION(BIH_END-BIH_START), SPEED(BIH_RECCOUNT,BIH_START,BIH_END), DURATION(BIH_END-BIH_DATEFC),
BIH_HOST, BIH_EXE, BIH_VERSION, BIH_THREAD, BIH_JOB, BIH_START, BIH_END
FROM DT_BIH
WHERE BIH_DATETIME > SYSDATE -3
AND BIH_SRCTYPE In ('MCCMNC','CCNDC','OPER')
ORDER BY BIH_DATETIME;


--
-- DT_BIH_RECENT_SMSC  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.DT_BIH_RECENT_SMSC
(BIH_ID, BIH_SRCTYPE, BIH_MAPID, BIH_DATETIME, BIH_FILENAME, 
 BIH_RECCOUNT, BIH_ERRCOUNT, BIH_ESID, BIH_DATEFC, BIH_DATELC, 
 PROC_DURATION, PROC_SPEED, PROC_DLAY, BIH_HOST, BIH_EXE, 
 BIH_VERSION, BIH_THREAD, BIH_JOB, BIH_START, BIH_END)
BEQUEATH DEFINER
AS 
SELECT BIH_ID, BIH_SRCTYPE, BIH_MAPID, BIH_DATETIME, BIH_FILENAME,
BIH_RECCOUNT, BIH_ERRCOUNT, BIH_ESID, BIH_DATEFC, BIH_DATELC,
DURATION(BIH_END-BIH_START), SPEED(BIH_RECCOUNT,BIH_START,BIH_END), DURATION(BIH_END-BIH_DATEFC),
BIH_HOST, BIH_EXE, BIH_VERSION, BIH_THREAD, BIH_JOB, BIH_START, BIH_END
FROM DT_BIH
WHERE BIH_DATETIME > SYSDATE -1/24
AND BIH_SRCTYPE IN ('SMSC')
ORDER BY BIH_DATETIME;


--
-- DT_BIH_RECENT_STAN  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.DT_BIH_RECENT_STAN
(BIH_ID, BIH_SRCTYPE, BIH_MAPID, BIH_DATETIME, BIH_FILENAME, 
 BIH_RECCOUNT, BIH_ERRCOUNT, BIH_ESID, BIH_DATEFC, BIH_DATELC, 
 PROC_DURATION, PROC_SPEED, PROC_DLAY, BIH_HOST, BIH_EXE, 
 BIH_VERSION, BIH_THREAD, BIH_JOB, BIH_START, BIH_END)
BEQUEATH DEFINER
AS 
SELECT BIH_ID, BIH_SRCTYPE, BIH_MAPID, BIH_DATETIME, BIH_FILENAME,
BIH_RECCOUNT, BIH_ERRCOUNT, BIH_ESID, BIH_DATEFC, BIH_DATELC,
DURATION(BIH_END-BIH_START), SPEED(BIH_RECCOUNT,BIH_START,BIH_END), DURATION(BIH_END-BIH_DATEFC),
BIH_HOST, BIH_EXE, BIH_VERSION, BIH_THREAD, BIH_JOB, BIH_START, BIH_END
FROM DT_BIH
WHERE BIH_DATETIME > SYSDATE -1/24
AND BIH_SRCTYPE IN ('STAN')
ORDER BY BIH_DATETIME;


--
-- DUPLICATE_CHECK_LAC  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.DUPLICATE_CHECK_LAC
(WTYPE, CONTRACT_ID_1, CONTRACT_ID_2, WARNING, AC_NAME_1, 
 AC_NAME_2)
BEQUEATH DEFINER
AS 
SELECT
 'W',
 C1.CON_ID,
 NULL,
 'An SMS LA Contract owned by ''<AC_NAME_1>'' is not assigned to Org. Einheit ''Third Party Business''. It should normally have a ZERO Interworking Revenue Share',
 A1.AC_NAME,
 NULL
FROM
 CONTRACT C1,
 ACCOUNT A1
WHERE
  C1.CON_ACID = A1.AC_ID
 AND C1.CON_ESID in ('A','T')
 AND C1.CON_ETID = 'LAC'
 AND C1.con_tarid IN ('M','S','P','T','V','X')
 AND NVL(C1.CON_MBUID,'N/A') NOT IN ('TPB')
 AND C1.CON_IWRS > 0.0
UNION
SELECT
    'E',
    C1.CON_ID,
    C2.CON_ID,
    'A Contract of ''<AC_NAME_1>'' conflicts with another one of ''<AC_NAME_2>'': Validity periods may be overlapping or duplicate Short-IDs used',
  A1.AC_NAME,
  A2.AC_NAME
FROM
    CONTRACT C1,
    CONTRACT C2,
    ACCOUNT A1,
    ACCOUNT A2
WHERE
        C1.CON_ACID = A1.AC_ID
    AND C2.CON_ACID = A2.AC_ID
    AND C2.CON_ID > C1.CON_ID
    AND C1.CON_ESID in ('A','T')
    AND C1.CON_ETID = 'LAC'
    AND C2.CON_ESID in ('A','T')
    AND C2.CON_ETID = 'LAC'
    AND C2.CON_CONSOL = C1.CON_CONSOL
    AND (((NVL(C2.CON_DATEEND,to_date('2200','YYYY')) > NVL(C1.CON_DATESTART,to_date('1900','YYYY'))) AND (NVL(C2.CON_DATEEND,to_date('2200','YYYY')) <= NVL(C1.CON_DATEEND,to_date('2200','YYYY')))) OR ((NVL(C2.CON_DATESTART,to_date('1900','YYYY')) >= NVL(C1.CON_DATESTART,to_date('1900','YYYY'))) AND (NVL(C2.CON_DATESTART,to_date('1900','YYYY')) < NVL(C1.CON_DATEEND,to_date('2200','YYYY')))))
UNION
SELECT
 'E',
 NULL,
 NULL,
 'Third Party ''' || A1.AC_NAME || ''' conflicts with another one ''' || A2.AC_NAME || ''': Duplicate Third Party ID ' || A1.AC_TPID,
 A1.AC_NAME,
 A2.AC_NAME
FROM
 ACCOUNT A1,
 ACCOUNT A2
WHERE   A2.AC_ID > A1.AC_ID
    AND A1.AC_ETID IN ('IP','LA')
    AND A2.AC_ETID IN ('IP','LA')
    AND A1.AC_ESID = 'A'
    AND A2.AC_ESID = 'A'
    AND A2.AC_TPID = A1.AC_TPID
UNION
SELECT
 'E',
 C1.CON_ID,
 NULL,
 'An LA Contract of ''<AC_NAME_1>'' cannot have handygroup status for tariff g or h',
 A1.AC_NAME,
 NULL
FROM
 CONTRACT C1,
 ACCOUNT A1
WHERE
  C1.CON_ACID = A1.AC_ID
 AND C1.CON_ESID in ('A','T')
 AND C1.CON_ETID = 'LAC'
 AND C1.CON_TARID IN ('g','h')
 AND C1.CON_HDGROUP = 1
UNION
SELECT
    'E',
    C1.CON_ID,
    NULL,
    'Invalid Pseudo-Callnumber. Must start with (417...) and have 11 digits.',
    NULL,
    NULL
FROM
    CONTRACT C1
WHERE
        C1.CON_ESID in ('A','T')
    AND C1.CON_ETID = 'LAC'
    AND C1.CON_HDGROUP IN ('0','1')
    AND ((C1.CON_PSCALL IS NULL)
       OR (C1.CON_PSCALL NOT LIKE '417%')
       OR (LENGTH(C1.CON_PSCALL) <> 11))
UNION
SELECT
    'W',
    C1.CON_ID,
    NULL,
    'The prices for mVoting contracts must be given. Please enter them NOW using the Tariff-Button!',
    NULL,
    NULL
FROM
    CONTRACT C1
WHERE
        C1.CON_ESID in ('A','T')
    AND C1.CON_ETID = 'LAC'
    AND C1.CON_HDGROUP IN ('2','3')
    AND ((C1.CON_REFUNDCU IS NULL) OR (C1.CON_RETSHAREPV IS NULL) OR (C1.CON_PRICECU IS NULL))
UNION
SELECT
    'W',
    C1.CON_ID,
    NULL,
    'The premium price for an active mVoting contract must be positive and not exceed CHF 3.00',
    NULL,
    NULL
FROM
    CONTRACT C1
WHERE
        C1.CON_ESID in ('A','T')
    AND C1.CON_ETID = 'LAC'
    AND C1.CON_HDGROUP IN ('2')
    AND ((C1.CON_PRICECU < 0) OR (C1.CON_PRICECU > 3.00))
UNION
SELECT
    'W',
    C1.CON_ID,
    NULL,
    'The premium price for a standby mVoting contract must be positive and not exceed CHF 0.20',
    NULL,
    NULL
FROM
    CONTRACT C1
WHERE
        C1.CON_ESID in ('A','T')
    AND C1.CON_ETID = 'LAC'
    AND C1.CON_HDGROUP IN ('3')
    AND ((C1.CON_PRICECU < 0) OR (C1.CON_PRICECU > 0.20))
UNION
SELECT
    'W',
    C1.CON_ID,
    NULL,
    'The transport cost value for an mVoting contract must be positive and not exceed CHF 0.20',
    NULL,
    NULL
FROM
    CONTRACT C1
WHERE
        C1.CON_ESID in ('A','T')
    AND C1.CON_ETID = 'LAC'
    AND C1.CON_HDGROUP IN ('3')
    AND ((C1.CON_PRICE < 0) OR (C1.CON_PRICE > 0.20))
UNION
SELECT
    'W',
    C1.CON_ID,
    NULL,
    'The revenue share for an mVoting contract must be positive and not exceed the premium price',
    NULL,
    NULL
FROM
    CONTRACT C1
WHERE
        C1.CON_ESID in ('A','T')
    AND C1.CON_ETID = 'LAC'
    AND C1.CON_HDGROUP IN ('2','3')
    AND ((C1.CON_RETSHAREPV < 0) OR (C1.CON_RETSHAREPV > C1.CON_PRICECU))
UNION
SELECT
    'W',
    C1.CON_ID,
    NULL,
    'The customer refund for an mVoting contract must be positive and not exceed the premium price for the vote)',
    NULL,
    NULL
FROM
    CONTRACT C1
WHERE
        C1.CON_ESID in ('A','T')
    AND C1.CON_ETID = 'LAC'
    AND C1.CON_HDGROUP IN ('2')
    AND ((C1.CON_REFUNDCU > 0) OR (C1.CON_REFUNDCU + C1.CON_PRICECU < 0.0))
UNION
SELECT
    'W',
    C1.CON_ID,
    NULL,
    'This active mVoting contract has an invalid premium price for the vote (must be positive and not exceed CHF 3.00)',
    NULL,
    NULL
FROM
    CONTRACT C1
WHERE
        C1.CON_ESID in ('A','T')
    AND C1.CON_ETID = 'LAC'
    AND C1.CON_HDGROUP IN ('2')
    AND ((C1.CON_PRICECU < 0) OR (C1.CON_PRICECU > 3.0))
UNION
SELECT
    'W',
    C1.CON_ID,
    NULL,
    'Customer refund values for standby mVoting contracts must be 0.00',
    NULL,
    NULL
FROM
    CONTRACT C1
WHERE
        C1.CON_ESID in ('A','T')
    AND C1.CON_ETID = 'LAC'
    AND C1.CON_HDGROUP IN ('3')
    AND C1.CON_REFUNDCU <> 0
UNION
SELECT
    'W',
    C1.CON_ID,
    NULL,
    'mVoting contracts cannot have an empty contract description (Vertragsbezeichnung)',
    NULL,
    NULL
FROM
    CONTRACT C1
WHERE
        C1.CON_ESID in ('A','T')
    AND C1.CON_ETID = 'LAC'
    AND C1.CON_HDGROUP IN ('2','3')
    AND TRIM(C1.CON_NAME) IS NULL
UNION
SELECT
    'W',
    C1.CON_ID,
    NULL,
    'SMS roaming promotions lead to billing loss. Use for Swisscom internal services only!',
    NULL,
    NULL
FROM
    CONTRACT C1
WHERE
        C1.CON_ESID in ('A','T')
    AND C1.CON_ETID = 'LAC'
    AND C1.CON_MOROAMINGPROM = 1
UNION
SELECT
    'E',
    C1.CON_ID,
    NULL,
    'The value for ShortID must be in the range from 100 to 99999 and the Tariff cannot be empty.',
    NULL,
    NULL
FROM
    CONTRACT C1
WHERE
        C1.CON_ESID in ('A','T')
    AND C1.CON_ETID = 'LAC'
    AND ( C1.CON_CONSOL IS NULL OR LENGTH(C1.CON_CONSOL) < 3 OR LENGTH(C1.CON_CONSOL) > 5 OR CON_TARID IS NULL)
UNION
SELECT
    'E',
    C1.CON_ID,
    C2.CON_ID,
    'A Contract of ''<AC_NAME_1>'' conflicts with another one of ''<AC_NAME_2>'': Validity periods may be overlapping or duplicate Short-IDs used',
  A1.AC_NAME,
  A2.AC_NAME
FROM
    CONTRACT C1,
    CONTRACT C2,
    ACCOUNT A1,
    ACCOUNT A2
WHERE
        C1.CON_ACID = A1.AC_ID
    AND C2.CON_ACID = A2.AC_ID
    AND C2.CON_ID > C1.CON_ID
    AND C1.CON_ESID in ('A','T')
    AND C1.CON_ETID = 'LAC'
    AND C2.CON_ESID in ('A','T')
    AND C2.CON_ETID = 'LAC'
    AND C2.CON_CONSOL = C1.CON_CONSOL
    AND (((NVL(C2.CON_DATEEND,to_date('2200','YYYY')) > NVL(C1.CON_DATESTART,to_date('1900','YYYY'))) AND (NVL(C2.CON_DATEEND,to_date('2200','YYYY')) <= NVL(C1.CON_DATEEND,to_date('2200','YYYY')))) OR ((NVL(C2.CON_DATESTART,to_date('1900','YYYY')) >= NVL(C1.CON_DATESTART,to_date('1900','YYYY'))) AND (NVL(C2.CON_DATESTART,to_date('1900','YYYY')) < NVL(C1.CON_DATEEND,to_date('2200','YYYY')))))
UNION
SELECT
 'E',
 NULL,
 NULL,
 'Third Party ''' || A1.AC_NAME || ''' conflicts with another one ''' || A2.AC_NAME || ''': Duplicate Third Party ID ' || A1.AC_TPID,
 A1.AC_NAME,
 A2.AC_NAME
FROM
 ACCOUNT A1,
 ACCOUNT A2
WHERE   A2.AC_ID > A1.AC_ID
    AND A1.AC_ETID IN ('IP','LA')
    AND A2.AC_ETID IN ('IP','LA')
    AND A1.AC_ESID = 'A'
    AND A2.AC_ESID = 'A'
    AND A2.AC_TPID = A1.AC_TPID
UNION
SELECT
 'E',
 C1.CON_ID,
 NULL,
 'An LA Contract of ''<AC_NAME_1>'' cannot have handygroup status for tariff g or h',
 A1.AC_NAME,
 NULL
FROM
 CONTRACT C1,
 ACCOUNT A1
WHERE
  C1.CON_ACID = A1.AC_ID
 AND C1.CON_ESID in ('A','T')
 AND C1.CON_ETID = 'LAC'
 AND C1.CON_TARID IN ('g','h')
 AND C1.CON_HDGROUP = 1
UNION
SELECT
    'E',
    C1.CON_ID,
    NULL,
    'Invalid Pseudo-Callnumber. Must start with (417...) and have 11 digits.',
    NULL,
    NULL
FROM
    CONTRACT C1
WHERE
        C1.CON_ESID in ('A','T')
    AND C1.CON_ETID = 'LAC'
    AND C1.CON_HDGROUP IN ('0','1')
    AND ((C1.CON_PSCALL IS NULL)
       OR (C1.CON_PSCALL NOT LIKE '417%')
       OR (LENGTH(C1.CON_PSCALL) <> 11))
UNION
SELECT
    'W',
    C1.CON_ID,
    NULL,
    'The prices for mVoting contracts must be given. Please enter them NOW using the Tariff-Button!',
    NULL,
    NULL
FROM
    CONTRACT C1
WHERE
        C1.CON_ESID in ('A','T')
    AND C1.CON_ETID = 'LAC'
    AND C1.CON_HDGROUP IN ('2','3')
    AND ((C1.CON_REFUNDCU IS NULL) OR (C1.CON_RETSHAREPV IS NULL) OR (C1.CON_PRICECU IS NULL))
UNION
SELECT
    'W',
    C1.CON_ID,
    NULL,
    'The premium price for an active mVoting contract must be positive and not exceed CHF 3.00',
    NULL,
    NULL
FROM
    CONTRACT C1
WHERE
        C1.CON_ESID in ('A','T')
    AND C1.CON_ETID = 'LAC'
    AND C1.CON_HDGROUP IN ('2')
    AND ((C1.CON_PRICECU < 0) OR (C1.CON_PRICECU > 3.00))
UNION
SELECT
    'W',
    C1.CON_ID,
    NULL,
    'The premium price for a standby mVoting contract must be positive and not exceed CHF 0.20',
    NULL,
    NULL
FROM
    CONTRACT C1
WHERE
        C1.CON_ESID in ('A','T')
    AND C1.CON_ETID = 'LAC'
    AND C1.CON_HDGROUP IN ('3')
    AND ((C1.CON_PRICECU < 0) OR (C1.CON_PRICECU > 0.20))
UNION
SELECT
    'W',
    C1.CON_ID,
    NULL,
    'The transport cost value for an mVoting contract must be positive and not exceed CHF 0.20',
    NULL,
    NULL
FROM
    CONTRACT C1
WHERE
        C1.CON_ESID in ('A','T')
    AND C1.CON_ETID = 'LAC'
    AND C1.CON_HDGROUP IN ('3')
    AND ((C1.CON_PRICE < 0) OR (C1.CON_PRICE > 0.20))
UNION
SELECT
    'W',
    C1.CON_ID,
    NULL,
    'The revenue share for an mVoting contract must be positive and not exceed the premium price',
    NULL,
    NULL
FROM
    CONTRACT C1
WHERE
        C1.CON_ESID in ('A','T')
    AND C1.CON_ETID = 'LAC'
    AND C1.CON_HDGROUP IN ('2','3')
    AND ((C1.CON_RETSHAREPV < 0) OR (C1.CON_RETSHAREPV > C1.CON_PRICECU))
UNION
SELECT
    'W',
    C1.CON_ID,
    NULL,
    'The customer refund for an mVoting contract must be positive and not exceed the premium price for the vote)',
    NULL,
    NULL
FROM
    CONTRACT C1
WHERE
        C1.CON_ESID in ('A','T')
    AND C1.CON_ETID = 'LAC'
    AND C1.CON_HDGROUP IN ('2')
    AND ((C1.CON_REFUNDCU > 0) OR (C1.CON_REFUNDCU + C1.CON_PRICECU < 0.0))
UNION
SELECT
    'W',
    C1.CON_ID,
    NULL,
    'This active mVoting contract has an invalid premium price for the vote (must be positive and not exceed CHF 3.00)',
    NULL,
    NULL
FROM
    CONTRACT C1
WHERE
        C1.CON_ESID in ('A','T')
    AND C1.CON_ETID = 'LAC'
    AND C1.CON_HDGROUP IN ('2')
    AND ((C1.CON_PRICECU < 0) OR (C1.CON_PRICECU > 3.0))
UNION
SELECT
    'W',
    C1.CON_ID,
    NULL,
    'Customer refund values for standby mVoting contracts must be 0.00',
    NULL,
    NULL
FROM
    CONTRACT C1
WHERE
        C1.CON_ESID in ('A','T')
    AND C1.CON_ETID = 'LAC'
    AND C1.CON_HDGROUP IN ('3')
    AND C1.CON_REFUNDCU <> 0
UNION
SELECT
    'W',
    C1.CON_ID,
    NULL,
    'mVoting contracts cannot have an empty contract description (Vertragsbezeichnung)',
    NULL,
    NULL
FROM
    CONTRACT C1
WHERE
        C1.CON_ESID in ('A','T')
    AND C1.CON_ETID = 'LAC'
    AND C1.CON_HDGROUP IN ('2','3')
    AND TRIM(C1.CON_NAME) IS NULL
UNION
SELECT
    'W',
    C1.CON_ID,
    NULL,
    'SMS roaming promotions lead to billing loss. Use for Swisscom internal services only!',
    NULL,
    NULL
FROM
    CONTRACT C1
WHERE
        C1.CON_ESID in ('A','T')
    AND C1.CON_ETID = 'LAC'
    AND C1.CON_MOROAMINGPROM = 1
UNION
SELECT
    'E',
    C1.CON_ID,
    NULL,
    'The value for ShortID must be in the range from 100 to 99999 and the Tariff cannot be empty.',
    NULL,
    NULL
FROM
    CONTRACT C1
WHERE
        C1.CON_ESID in ('A','T')
    AND C1.CON_ETID = 'LAC'
    AND ( C1.CON_CONSOL IS NULL OR LENGTH(C1.CON_CONSOL) < 3 OR LENGTH(C1.CON_CONSOL) > 5 OR CON_TARID IS NULL)
UNION

SELECT
 'E' wtype,
  C1.CON_ID,
  NULL,
  'Invalid Short ID (' || C1.CON_CONSOL || ') found for ' || A1.AC_NAME  warning,
  A1.AC_NAME,
  null
FROM
    CONTRACT C1,
    ACCOUNT A1
WHERE
        C1.CON_ACID = A1.AC_ID
    AND C1.CON_ESID IN ('A','T','E')
    AND C1.CON_ETID = 'LAC'
    AND is_integer(C1.CON_CONSOL,100,99999) = 0

ORDER BY 1, 2;


--
-- DUPLICATE_CHECK_MLC  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.DUPLICATE_CHECK_MLC
(WTYPE, CONTRACT_ID_1, CONTRACT_ID_2, WARNING, AC_NAME_1, 
 AC_NAME_2)
BEQUEATH DEFINER
AS 
SELECT
    'E' wtype,
    C1.CON_ID contract_id_1,
    C2.CON_ID contract_id_2,
    'A Contract of ''<AC_NAME_1>'' conflicts with another one of ''<AC_NAME_2>'': Validity periods may be overlapping or duplicate Short-IDs used' warning,
  A1.AC_NAME ac_name_1,
  A2.AC_NAME ac_name_2
FROM
    CONTRACT C1,
    CONTRACT C2,
    ACCOUNT A1,
    ACCOUNT A2
WHERE
        C1.CON_ACID = A1.AC_ID
    AND C2.CON_ACID = A2.AC_ID
    AND C2.CON_ID > C1.CON_ID
    AND C1.CON_ESID in ('A','T')
    AND C1.CON_ETID = 'MLC'
    AND C2.CON_ESID in ('A','T')
    AND C2.CON_ETID = 'MLC'
    AND C2.CON_CONSOL = C1.CON_CONSOL
    AND (((NVL(C2.CON_DATEEND,to_date('2200','YYYY')) > NVL(C1.CON_DATESTART,to_date('1900','YYYY'))) AND (NVL(C2.CON_DATEEND,to_date('2200','YYYY')) <= NVL(C1.CON_DATEEND,to_date('2200','YYYY')))) OR ((NVL(C2.CON_DATESTART,to_date('1900','YYYY')) >= NVL(C1.CON_DATESTART,to_date('1900','YYYY'))) AND (NVL(C2.CON_DATESTART,to_date('1900','YYYY')) < NVL(C1.CON_DATEEND,to_date('2200','YYYY')))))
UNION
SELECT
 'E' wtype,
 NULL contract_id_1,
 NULL contract_id_2,
 'Third Party ''' || A1.AC_NAME || ''' conflicts with another one ''' || A2.AC_NAME || ''': Duplicate Third Party ID ' || A1.AC_TPID warning,
 A1.AC_NAME  ac_name_1,
 A2.AC_NAME  ac_name_2
FROM
 ACCOUNT A1,
 ACCOUNT A2
WHERE   A2.AC_ID > A1.AC_ID
    AND A1.AC_ETID IN ('IP','LA')
    AND A2.AC_ETID IN ('IP','LA')
    AND A1.AC_ESID = 'A'
    AND A2.AC_ESID = 'A'
    AND A2.AC_TPID = A1.AC_TPID

UNION

SELECT
 'W' wtype,
  C1.CON_ID,
  NULL,
  'An Info Provider Service of type ' || CST.CONST_LANG01 || ' must be created for ' || A1.AC_NAME || ' with Short ID (' || C1.CON_CONSOL || ')'  warning,
  A1.AC_NAME,
  null
FROM
    CONTRACT C1,
    ACCOUNT A1,
    CONSUBTYPE CST
WHERE
        C1.CON_ACID = A1.AC_ID
    AND C1.CON_ESID IN ('A','T','I','E')
    AND C1.CON_ETID = 'MLC'
    AND C1.CON_ESTID IN ('MMSBN','MMSPS')
    AND CST.CONST_ID = DECODE(C1.CON_ESTID,'MMSBN','BN','PTS')
    AND 1=2                                                         -- join to MMS MB service to be added
    AND NOT EXISTS (
        SELECT C2.CON_ID
    FROM CONTRACT C2 WHERE C2.CON_SHORTID = C1.CON_CONSOL
    AND C2.CON_ETID = 'IPC'
    AND C2.CON_ESTID = CST.CONST_ID
    AND C2.CON_ESID IN ('A',C1.CON_ESID)
    )

UNION

SELECT
 'W' wtype,
  C1.CON_ID,
  NULL,
  'An MMS-LA Info Provider Service must be created for ' || A1.AC_NAME || ' with Short ID (' || C1.CON_CONSOL || ')'  warning,
  A1.AC_NAME,
  null
FROM
    CONTRACT C1,
    ACCOUNT A1
WHERE
        C1.CON_ACID = A1.AC_ID
    AND C1.CON_ESID IN ('A','T','E')
    AND C1.CON_ETID = 'MLC'
    AND C1.CON_ESTID IN ('MMSLA')
    AND NOT EXISTS (
        SELECT C2.CON_ID
    FROM CONTRACT C2 WHERE C2.CON_SHORTID = C1.CON_CONSOL
    AND C2.CON_ETID = 'IPC'
    AND C2.CON_ESID IN ('A',C1.CON_ESID)
    )

UNION

SELECT
 'W' wtype,
  C1.CON_ID,
  NULL,
  'Tariff is inconsistent with Contract subtype for ' || A1.AC_NAME || ' with Short ID (' || C1.CON_CONSOL || ')'  warning,
  A1.AC_NAME,
  null
FROM
    CONTRACT C1,
    ACCOUNT A1
WHERE
        C1.CON_ACID = A1.AC_ID
    AND C1.CON_ESID IN ('A','T','E')
    AND C1.CON_ETID = 'MLC'
    AND C1.CON_ESTID || C1.CON_TARID NOT IN ('MMSBNS','MMSPSP','MMSLAX','MMSLAV','MMSLA1','MMSLA2','MMSLA3','MMSLA4','MMSLA5','MMSLA6','MMSLA7','MMSLA8','MMSLA9')

UNION

SELECT
 'E' wtype,
  C1.CON_ID,
  NULL,
  'Invalid Short ID (' || C1.CON_CONSOL || ') found for ' || A1.AC_NAME  warning,
  A1.AC_NAME,
  null
FROM
    CONTRACT C1,
    ACCOUNT A1
WHERE
        C1.CON_ACID = A1.AC_ID
    AND C1.CON_ESID IN ('A','T','E')
    AND C1.CON_ETID = 'MLC'
    AND is_integer(C1.CON_CONSOL,100,99999) = 0

ORDER BY 1, 2;


--
-- DUPLICATE_CHECK_TOC  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.DUPLICATE_CHECK_TOC
(WTYPE, CONTRACT_ID_1, CONTRACT_ID_2, WARNING, AC_NAME_1, 
 AC_NAME_2)
BEQUEATH DEFINER
AS 
SELECT
    'E',
    C1.CON_ID,
    C2.CON_ID,
    'A contract of ''<AC_NAME_1>'' conflicts with another one of ''<AC_NAME_2>'': Validity period may be overlapping or duplicate PMN code or operator key used',
  A1.AC_NAME,
  A2.AC_NAME
FROM
    CONTRACT C1,
    CONTRACT C2,
    ACCOUNT A1,
    ACCOUNT A2
WHERE
        C1.CON_ACID = A1.AC_ID
    AND C2.CON_ACID = A2.AC_ID
    AND C2.CON_ID > C1.CON_ID
    AND C1.CON_ESID in ('A','I')
    AND C1.CON_ETID = 'TOC'
    AND C2.CON_ESID in ('A','I')
    AND C2.CON_ETID = 'TOC'
    AND ((C2.CON_ACID = C1.CON_ACID)
    OR  (C2.CON_CODE = C1.CON_CODE)
    OR  (C2.CON_OPKEY = C1.CON_OPKEY))
    AND (((NVL(C2.CON_DATEEND,to_date('2200','YYYY')) > NVL(C1.CON_DATESTART,to_date('1900','YYYY'))) AND (NVL(C2.CON_DATEEND,to_date('2200','YYYY')) <= NVL(C1.CON_DATEEND,to_date('2200','YYYY')))) OR ((NVL(C2.CON_DATESTART,to_date('1900','YYYY')) >= NVL(C1.CON_DATESTART,to_date('1900','YYYY'))) AND (NVL(C2.CON_DATESTART,to_date('1900','YYYY')) < NVL(C1.CON_DATEEND,to_date('2200','YYYY')))));


--
-- GPSH_KEYWORD_JSON  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.GPSH_KEYWORD_JSON
(CKEY, CVALUE)
BEQUEATH DEFINER
AS 
select
    distinct KEY_CONID as ckey
    ,
      gpull_keyword_json(KEY_CONID) as cvalue
  from
    KEYWORD 
  order by
      NLSSORT(KEY_CONID,'NLS_SORT=BINARY' ) asc;


--
-- GPSH_PRICE_JSON  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.GPSH_PRICE_JSON
(CKEY, CVALUE)
BEQUEATH DEFINER
AS 
SELECT  price_key as ckey,
        gpull_price_json(price_key) as cvalue
FROM gpsh_price_keylist;


--
-- GPSH_TOAC_SMSC_JSON  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.GPSH_TOAC_SMSC_JSON
(CKEY, CVALUE, SMSC_CODE, SMSC_CONOPKEY)
BEQUEATH DEFINER
AS 
SELECT   smsc_key as ckey, gpull_toac_smsc_json(smsc_code) cvalue, smsc_code, smsc_conopkey
        FROM gpsh_toac_smsc_keylist
    ORDER BY   1 ASC;


--
-- GPSH_TPAC_CON_JSON  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.GPSH_TPAC_CON_JSON
(CKEY, CVALUE)
BEQUEATH DEFINER
AS 
select
    CON_ID,
    '{' ||
    '"CON_ACID":' || JSON_STRING(CON_ACID) || ',' ||
    '"CON_CONSOL":' || JSON_STRING(CON_CONSOL) || ',' ||
    '"CON_DATEBLOCK":' || JSON_DATE(CON_DATEBLOCK) || ',' ||
    '"CON_DATEEND":' || JSON_DATE(CON_DATEEND) || ',' ||
    '"CON_DATESTART":' || JSON_DATE(CON_DATESTART) || ',' ||
    '"CON_ESID":' || JSON_STRING(CON_ESID) || ',' ||
    '"CON_ESTID":' || JSON_STRING(CON_ESTID) || ',' ||
    '"CON_ETID":' || JSON_STRING(CON_ETID) || ',' ||
    '"CON_HOTLINEEMAIL":' || JSON_STRING(CON_HOTLINEEMAIL) || ',' ||
    '"CON_HOTLINEPHONE":' || JSON_STRING(CON_HOTLINEPHONE) || ',' ||
    '"CON_HDGROUP":' || JSON_BOOLEAN(CON_HDGROUP,'null') || ',' ||
    '"CON_IWRS":' || JSON_NUMBER(CON_IWRS) || ',' ||
    '"CON_MFGR":' || JSON_NUMBER(CON_MFGR) || ',' ||
    '"CON_MINCHARGE":' || JSON_NUMBER(CON_MINCHARGE) || ',' ||
    '"CON_MOROAMINGPROM":' || JSON_BOOLEAN(CON_MOROAMINGPROM,'null') || ',' ||
    '"CON_MTROAMINGPROM":' || JSON_BOOLEAN(CON_MTROAMINGPROM,'null') || ',' ||
    '"CON_NAME":' || JSON_STRING(CON_NAME) || ',' ||
    '"CON_PMID":' || JSON_STRING(CON_PMID) || ',' ||
    '"CON_PRICE":' || JSON_NUMBER(CON_PRICE) || ',' ||
    '"CON_PRICEHG":' || JSON_NUMBER(CON_PRICEHG) || ',' ||
    '"CON_PRICEINT":' || JSON_NUMBER(CON_PRICEINT) || ',' ||
    '"CON_PRICEMOFN":' || JSON_NUMBER(CON_PRICEMOFN) || ',' ||
    '"CON_PRICEPG":' || JSON_NUMBER(CON_PRICEPG) || ',' ||
    '"CON_PROVIDERNAME":' || JSON_STRING(CON_PROVIDERNAME) || ',' ||
    '"CON_PSCALL":' || JSON_STRING(CON_PSCALL) || ',' ||
    '"CON_RARR_ALLOWED":' || JSON_BOOLEAN(CON_RARR_ALLOWED,'null') || ',' ||
    '"CON_RARR_HIDDEN":' || JSON_BOOLEAN(CON_RARR_HIDDEN,'null') || ',' ||
    '"CON_RSID":' || JSON_STRING(CON_RSID) || ',' ||
    '"CON_SETOPT":' || JSON_STRING(CON_SETOPT) || ',' ||
    '"CON_SHORTID":' || JSON_STRING(CON_SHORTID) || ',' ||
    '"CON_TARID":' || JSON_STRING(CON_TARID) || ',' ||
    '"CON_THROUGHPUT":' || JSON_NUMBER(CON_THROUGPUT) ||
    '}'
from    CONTRACT
where   CON_ESID in('E','A','T','I')
and     CON_ETID in('LAC','MLC','IPC')
order by NLSSORT(CON_ID, 'NLS_SORT=BINARY') asc;


--
-- GPSH_TPAC_CON_KEYLIST  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.GPSH_TPAC_CON_KEYLIST
(CON_ID)
BEQUEATH DEFINER
AS 
select
 CON_ID
from    CONTRACT
where   CON_ESID in('E','A','T','I')
and     CON_ETID in('LAC','MLC','IPC')
order by NLSSORT(CON_ID, 'NLS_SORT=BINARY') asc;


--
-- GPSH_TPAC_JSON  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.GPSH_TPAC_JSON
(CKEY, CVALUE)
BEQUEATH DEFINER
AS 
select AC_ID as ckey
    ,
      gpull_tpac_json(AC_ID) as cvalue
  from
    ACCOUNT where AC_ESID = 'A' and AC_ETID IN ('LA','IP')
  order by
      NLSSORT(AC_ID,'NLS_SORT=BINARY' ) asc;


--
-- GPULL_TOAC_JSON  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.GPULL_TOAC_JSON
(CKEY, CVALUE)
BEQUEATH DEFINER
AS 
select
    CON_OPKEY,
    '{' ||
    '"AC_ADRID_MAIN":' || JSON_STRING(AC_ADRID_MAIN) || ',' ||
    '"AC_ID":' || JSON_STRING(AC_ID) || ',' ||
    '"CODE":' || JSON_STRING(CON_OPKEY) || ',' ||
    '"COUNTRY":' || JSON_STRING(ADR_COUNTRY) || ',' ||
    '"CREATED_ON":' || JSON_DATE(AC_DATECRE) || ',' ||
    '"NAME":' || JSON_STRING(AC_NAME) || ',' ||
    '"child_imsi_":' || json_string_key('toac',CON_OPKEY,'imsi') || ',' ||
    '"child_msisdn_":' || json_string_key('toac',CON_OPKEY,'msisdn') || ',' ||
    '"child_smsc_":' || json_string_key('toac',CON_OPKEY,'smsc') || ',' ||
    '"child_tocon_":' || json_string_key('toac',CON_OPKEY,'tocon') ||
    '}'
from CONTRACT, ACCOUNT, ADDRESS
where AC_ID = CON_ACID
and ADR_ID = AC_ADRID_MAIN
and AC_ETID = 'TOP'
and AC_ESID = 'A'
AND CON_ESID NOT IN ('R','D')
GROUP BY     CON_OPKEY
    ,AC_ID
    ,AC_ESID
    ,AC_NAME
    ,AC_ADRID_MAIN
    ,AC_DATECRE
    ,ADR_COUNTRY;


--
-- INFO_CONTENT_TRANSPORT_JOIN_BN  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.INFO_CONTENT_TRANSPORT_JOIN_BN
(AC_NAME, SHORTID, AMT_CONTENT, AMT_TRAFFIC, AMT_TOTAL)
BEQUEATH DEFINER
AS 
SELECT
    AC_NAME
    , NVL(TRC_SHORTID
    , TRC_SERVICE)
    , 0.0
    , 0.0 - TRC_AMOUNT
    , 0.0 - TRC_AMOUNT
FROM      TRCONSOL,      CONTRACT,      ACCOUNT  
WHERE          TRCONSOL.TRC_CONID = CONTRACT.CON_ID      
AND ACCOUNT.AC_ID = CONTRACT.CON_ACID      
AND CON_ESTID IN ( 'BN','MVP')
AND TRC_ESID = 'R'      
AND TRC_SEPID =  to_char(ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1),'YYYYMM')  

UNION ALL 
SELECT
    AC_NAME
    , NVL(ISC_SHORTID,ISC_SERVICE)
    , ISC_RETSHAREPV
    , 0.0
    , ISC_RETSHAREPV
FROM   ISCONSOL,   CONTRACT,   ACCOUNT  
WHERE    ISCONSOL.ISC_CONID = CONTRACT.CON_ID   
AND ACCOUNT.AC_ID = CONTRACT.CON_ACID   
AND CON_ESTID IN ( 'BN','MVP')
AND ISC_ESID = 'R'   
AND ISC_PRICE IS NOT NULL
AND ISC_CDRTID = 'CTB-CO'
AND ISC_SEPID = to_char(ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1),'YYYYMM');


--
-- LA_LIST  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.LA_LIST
(VERTRAGSBEZEICHNUNG, FIRMENBEZEICHNUNG, ADRESSE1, ADRESSE2, ADRESSE3, 
 ADRESSE4, ADRESSE5, PLZ, ORT, LAND, 
 NAME_KONTAKT, VORNAME_KONTAKT, TELEFON_KONTAKT, FAX_KONTAKT, EMAIL_KONTAKT, 
 SBU, STATUS, TARIFSTUFE, PREIS, SHORTID, 
 PSEUDORUFNR, HANDYGRUPPE, CON_ID, CONS_ID, CON_MBUID, 
 AC_ID, AC_ADRID_MAIN, AC_ADRID_MAINCONTACT)
BEQUEATH DEFINER
AS 
SELECT
  CON_NAME,
  AM.ADR_COMPANY,
  AM.ADR_STREET1,
  AM.ADR_STREET2,
  AM.ADR_STREET3,
  AM.ADR_STREET4,
  AM.ADR_STREET5,
  AM.ADR_ZIP,
  AM.ADR_TOWN,
  AM.ADR_COUNTRY,
  AC.ADR_NAME,
  AC.ADR_FNAME,
  AC.ADR_PHONE1,
  AC.ADR_FAX,
  AC.ADR_EMAIL,
  MBU_LANG02,
  CONS_LANG02,
  CON_TARID,
  TAR_PRICE,
  CON_CONSOL,
  CON_PSCALL,
  CON_HDGROUP,
  CON_ID,
  CONS_ID,
  CON_MBUID,
  AC_ID,
  AC_ADRID_MAIN,
  AC_ADRID_MAINCONTACT
FROM
  CONTRACT,
  CONSTATE,
  MBUNIT,
  TARIFF,
  ACCOUNT,
  ADDRESS AM,
  ADDRESS AC
WHERE
    CONTRACT.CON_ESID = CONSTATE.CONS_ID
  AND CONTRACT.CON_MBUID = MBUNIT.MBU_ID
  AND CONTRACT.CON_TARID = TARIFF.TAR_ID
  AND CONTRACT.CON_ACID = ACCOUNT.AC_ID
  AND ACCOUNT.AC_ADRID_MAIN = AM.ADR_ID
  AND ACCOUNT.AC_ADRID_MAINCONTACT = AC.ADR_ID
  AND CON_ETID='LAC'
  AND CON_ESID NOT IN ('D','R','I')
ORDER BY
  AM.ADR_COMPANY, CON_NAME;


--
-- LA_MINCHARGE_PER_SHORTID  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.LA_MINCHARGE_PER_SHORTID
(CON_PSCALL, CON_CONSOL, FRACTIONAL_MIN_CHARGE, CON_ID)
BEQUEATH DEFINER
AS 
SELECT
  CON_PSCALL,
  CON_CONSOL,
  NVL(CON_MINCHARGE,TAR_MINCHARGE) * SettledDuration( CON_DATESTART,CON_DATEEND)/(TRUNC(sysdate,'MONTH')-TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')),
  CON_ID
FROM
  CONTRACT,
  TARIFF
WHERE
    CON_TARID = TAR_ID
  AND CON_ETID = 'LAC'
  AND CON_ESID IN ('A','I')
  AND (( CON_DATESTART < TRUNC(sysdate,'MONTH'))
  OR  ( CON_DATESTART IS NULL))
  AND (( CON_DATEEND > TRUNC(ADD_MONTHS(sysdate,-1),'MONTH'))
  OR  ( CON_DATEEND IS NULL))
  AND CON_TARID NOT IN ('P','Q','R','S','T','U','V','W','X','Y','Z');


--
-- LA_SETTLING_SUMMARY_1BN  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.LA_SETTLING_SUMMARY_1BN
(SEP_ID, SEP_DATE1, SEP_DATE2, SEP_LANG01, SEP_LANG02, 
 CON_ACNAME, CON_NAME, CON_MBUID, CON_ESID, CON_PSCALL, 
 CON_CONSOL, CON_PRICE, CON_NOTFLAG, SED_CHARGE, SED_TARID, 
 SED_COUNT1, SED_COUNT2, SED_COUNT_ALL, SED_TOTAL_CDRS, SED_TOTAL, 
 ADR_COUNTRY, SED_COUNT1FN)
BEQUEATH DEFINER
AS 
SELECT
  SEP_ID,
  to_char(SEP_DATE1,'dd.mm.yyyy'),
  to_char(SEP_DATE2-1,'dd.mm.yyyy'),
  SEP_LANG01,
  SEP_LANG02,
  AC_NAME,
  NVL(C1.CON_NAME,AC_NAME),
  C1.CON_MBUID,
  DECODE(C1.CON_ESID,'A','A','I'),
  C1.CON_PSCALL,
  NVL(BDC_CONSOLIDATION, C1.CON_CONSOL),
  C1.CON_PRICE,
  NULL CON_NOTFLAG,
  C1.CON_PSCALL,
  NVL(BDC_TARID,C1.CON_TARID),
  SUM(DECODE(BDC_NPI_B || BDC_PID_B || NVL(BDC_INT,'0'), '100',BDC_COUNT,0)),
  SUM(DECODE(BDC_NPI_A || BDC_PID_A, '10',BDC_COUNT,0)),
  SUM(DECODE(BDC_NPI_B || BDC_PID_B, '10',BDC_COUNT,0) + DECODE(BDC_NPI_A || BDC_PID_A, '10',BDC_COUNT,0)),
  0.0,
  0.0,
  ADR_COUNTRY,
  SUM(DECODE(BDC_NPI_B || BDC_PID_B || NVL(BDC_INT,'0'), '101',BDC_COUNT,0))
FROM
  SETPERIOD, CONTRACT C1, ACCOUNT, BDCONSOLIDATION, ADDRESS
WHERE   C1.CON_ETID = 'LAC'
  AND C1.CON_ACID = AC_ID
  AND EXISTS (
      SELECT C2.CON_ID
      FROM CONTRACT C2
      WHERE C2.CON_ETID = 'IPC'
        AND C2.CON_ESID <> 'D'
        AND C2.CON_ESID <> 'R'
        AND C2.CON_SHORTID = NVL(BDC_CONSOLIDATION, C1.CON_CONSOL)
        AND C2.CON_ESTID in ('BN','MVP')
      )
  AND ADR_ID = AC_ADRID_MAIN
  AND SEP_DATE1 = TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
  AND BDC_SEPID = SEP_ID
  AND BDC_CONID = C1.CON_ID
  AND BDC_ETID = 'SMSC-RAW'
  AND BDC_ESID = 'R'
GROUP BY
  SEP_ID,
  SEP_DATE1,
  SEP_DATE2,
  SEP_LANG01,
  SEP_LANG02,
  AC_NAME,
  ADR_COUNTRY,
  NVL(C1.CON_NAME,AC_NAME),
  C1.CON_MBUID,
  DECODE(C1.CON_ESID,'A','A','I'),
  C1.CON_PSCALL,
  NVL(BDC_CONSOLIDATION, C1.CON_CONSOL),
  C1.CON_PRICE,
  C1.CON_PSCALL,
  NVL(BDC_TARID,C1.CON_TARID)
UNION
SELECT
  SEP_ID,
  to_char(SEP_DATE1,'dd.mm.yyyy'),
  to_char(SEP_DATE2-1,'dd.mm.yyyy'),
  SEP_LANG01,
  SEP_LANG02,
  AC_NAME,
  NVL(C1.CON_NAME,AC_NAME),
  C1.CON_MBUID,
  DECODE(C1.CON_ESID,'A','A','I'),
  C1.CON_PSCALL,
  C1.CON_CONSOL,
  C1.CON_PRICE,
  NULL CON_NOTFLAG,
  C1.CON_PSCALL,
  C1.CON_TARID,
  0,
  0,
  0,
  0.0,
  0.0,
  ADR_COUNTRY,
  0
FROM
  SETPERIOD, CONTRACT C1, ACCOUNT, ADDRESS
WHERE   C1.CON_ETID = 'LAC'
  AND ADR_ID = AC_ADRID_MAIN
  AND C1.CON_ACID = AC_ID
  AND EXISTS (
      SELECT C2.CON_ID 
      FROM CONTRACT C2
      WHERE C2.CON_ETID = 'IPC'
        AND C2.CON_ESID <> 'D'
        AND C2.CON_ESID <> 'R'
        AND C2.CON_SHORTID = C1.CON_CONSOL
        AND C2.CON_ESTID IN ('BN','MVP')
      )
  AND SEP_DATE1 = TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
  AND C1.CON_NAME <> 'generated empty'
  AND C1.CON_ESID = 'A'
  AND NOT EXISTS (
    SELECT BDC_ID FROM BDCONSOLIDATION
    WHERE  BDC_SEPID = SEP_ID
    AND BDC_CONID = C1.CON_ID
    AND BDC_ETID = 'SMSC-RAW'
    AND BDC_ESID = 'R'
    )
GROUP BY
  SEP_ID,
  SEP_DATE1,
  SEP_DATE2,
  SEP_LANG01,
  SEP_LANG02,
  AC_NAME,
  ADR_COUNTRY,
  NVL(C1.CON_NAME,AC_NAME),
  C1.CON_MBUID,
  DECODE(C1.CON_ESID,'A','A','I'),
  C1.CON_PSCALL,
  C1.CON_CONSOL,
  C1.CON_PRICE,
  C1.CON_PSCALL,
  C1.CON_TARID;


--
-- MAY_START_ISRV_SETTLEMENT  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.MAY_START_ISRV_SETTLEMENT
(RESULT)
BEQUEATH DEFINER
AS 
SELECT NVL(MIN(RESULT),'FALSE') as RESULT FROM 
(
SELECT DISTINCT
	'FALSE' as RESULT
FROM
	BIHEADER
WHERE
		BIH_DATETIME >= sysdate-1/24
	AND	BIH_SRCTYPE = 'ISRV'
	AND	BIH_ESID In ('RDY','ERR')
	AND	BIH_DATEFC < trunc(sysdate,'MONTH')

UNION	SELECT DISTINCT
	'FALSE' as RESULT
FROM
	BIHEADER
WHERE
		BIH_DATETIME >= sysdate-1/24
	AND	BIH_SRCTYPE = 'ISRV'
	AND	BIH_ESID In ('MAP')

UNION 	SELECT DISTINCT
	'TRUE' as RESULT
FROM
	BIHEADER
WHERE
		BIH_DATETIME >= sysdate-1/24
	AND	BIH_SRCTYPE = 'ISRV'
	AND	BIH_ESID In ('RDY','ERR')
	AND	BIH_DATEFC > trunc(sysdate,'MONTH')
);


--
-- MAY_START_MMSC_SETTLEMENT  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.MAY_START_MMSC_SETTLEMENT
(RESULT)
BEQUEATH DEFINER
AS 
SELECT NVL(MIN(RESULT),'FALSE') as RESULT FROM 
(
SELECT DISTINCT
	'FALSE' as RESULT
FROM
	BIHEADER
WHERE
		BIH_DATETIME >= sysdate-1/24
	AND	BIH_SRCTYPE = 'MMSC'
	AND	BIH_ESID In ('RDY','ERR')
	AND	BIH_DATEFC < trunc(sysdate,'MONTH')

UNION	SELECT DISTINCT
	'FALSE' as RESULT
FROM
	BIHEADER
WHERE
		BIH_DATETIME >= sysdate-1/24
	AND	BIH_SRCTYPE = 'MMSC'
	AND	BIH_ESID In ('MAP')

UNION 	SELECT DISTINCT
	'TRUE' as RESULT
FROM
	BIHEADER
WHERE
		BIH_DATETIME >= sysdate-1/24
	AND	BIH_SRCTYPE = 'MMSC'
	AND	BIH_ESID In ('RDY','ERR')
	AND	BIH_DATEFC > trunc(sysdate,'MONTH')
);


--
-- MAY_START_MSC_SETTLEMENT  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.MAY_START_MSC_SETTLEMENT
(RESULT)
BEQUEATH DEFINER
AS 
SELECT NVL(MIN(RESULT),'FALSE') as RESULT FROM 
(
SELECT DISTINCT
	'FALSE' as RESULT
FROM
	BIHEADER
WHERE
		BIH_DATETIME >= sysdate-1/24
	AND	BIH_SRCTYPE = 'MSC'
	AND	BIH_ESID In ('RDY','ERR')
	AND	BIH_DATEFC < trunc(sysdate,'MONTH')

UNION	SELECT DISTINCT
	'FALSE' as RESULT
FROM
	BIHEADER
WHERE
		BIH_DATETIME >= sysdate-1/24
	AND	BIH_SRCTYPE = 'MSC'
	AND	BIH_ESID In ('MAP')

UNION 	SELECT DISTINCT
	'TRUE' as RESULT
FROM
	BIHEADER
WHERE
		BIH_DATETIME >= sysdate-1/24
	AND	BIH_SRCTYPE = 'MSC'
	AND	BIH_ESID In ('RDY','ERR')
	AND	BIH_DATEFC > trunc(sysdate,'MONTH')
);


--
-- MAY_START_SMSC_SETTLEMENT  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.MAY_START_SMSC_SETTLEMENT
(RESULT)
BEQUEATH DEFINER
AS 
SELECT NVL(MIN(RESULT),'FALSE') as RESULT FROM 
(
SELECT DISTINCT
    'FALSE' as RESULT
FROM
    BIHEADER
WHERE
        BIH_DATETIME >= sysdate-1/24
    AND BIH_SRCTYPE in ('SMSC','SMSN')
    AND BIH_ESID In ('RDY','ERR')
    AND BIH_DATEFC < trunc(sysdate,'MONTH')

UNION   SELECT DISTINCT
    'FALSE' as RESULT
FROM
    BIHEADER
WHERE
        BIH_DATETIME >= sysdate-1/24
    AND BIH_SRCTYPE in ('SMSC','SMSN')
    AND BIH_ESID In ('MAP')

UNION   SELECT DISTINCT
    'TRUE' as RESULT
FROM
    BIHEADER
WHERE
        BIH_DATETIME >= sysdate-1/24
    AND BIH_SRCTYPE in ('SMSC','SMSN')
    AND BIH_ESID In ('RDY','ERR')
    AND BIH_DATEFC > trunc(sysdate,'MONTH')
);


--
-- MMS_CC_MAPPING  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.MMS_CC_MAPPING
(CC, CODE, CODE_OTHER, CCID, CCID_OTHER, 
 RZID, RZID_OTHER, DZID, DZID_OTHER, CON_COUNT)
BEQUEATH DEFINER
AS 
SELECT
    SUBSTR(CON_CODE,1,3)
    ,   MIN(CON_CODE)
    ,   MAX(CON_CODE)
    ,   NULL MIN_CON_MMSCCID
    ,   NULL MAX_CON_MMSCCID
    ,   NULL MIN_CON_MMSRZID
    ,   NULL MAX_CON_MMSRZID
    ,   NULL MIN_CON_MMSDZID
    ,   NULL MAX_CON_MMSDZID
    ,   COUNT(*)
FROM   CONTRACT
WHERE    CON_ETID = 'TOC'
AND CON_CODE Is Not NULL
AND CON_ESID In ('A','I')
AND (CON_DATEEND IS NULL
OR CON_DATEEND > SYSDATE)
GROUP BY   SUBSTR(CON_CODE,1,3);


--
-- MMS_CDR_HEADER  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.MMS_CDR_HEADER
(BIH_ID, BIH_FILESEQ, BIH_DATETIME, BIH_FILENAME, BIH_FILEDATE, 
 BIH_RECCOUNT, BIH_DATEFC, BIH_DATELC, BIH_START, BIH_END, 
 BIH_ESID, BIH_DATEIDX, BIH_EXE, BIH_VERSION, BIH_JOB, 
 BIH_HOST, BIH_HIHID, BIH_REVASID, BIH_DATEANALYZED, BIH_WHSYNCSID, 
 BIH_WHSYNCDATE)
BEQUEATH DEFINER
AS 
SELECT
	BIH_ID,
	BIH_FILESEQ,
	BIH_DATETIME,
	BIH_FILENAME,
	BIH_FILEDATE,
	BIH_RECCOUNT,
	BIH_DATEFC,
	BIH_DATELC,
	BIH_START,
	BIH_END,
	UPPER(BIH_ESID),
	BIH_DATEIDX,
	BIH_EXE,
	BIH_VERSION,
	BIH_JOB,
	BIH_HOST,
	BIH_HIHID,
	BIH_REVASID,
	BIH_DATEANALYZED,
	BIH_WHSYNCSID,
	BIH_WHSYNCDATE
FROM
	BIHEADER
WHERE	BIH_DEMO = 0
	AND BIH_MAPID = 'MEC'
	AND	BIH_SRCTYPE = 'MMSC'
	AND BIH_ESID IN ('RDY','IDX','IDE','idx','ide');


--
-- MMS_OPER_MAPPING  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.MMS_OPER_MAPPING
(CODE, CCID, CCID_OTHER, RZID, RZID_OTHER, 
 DZID, DZID_OTHER, CON_COUNT)
BEQUEATH DEFINER
AS 
SELECT
    CON_CODE CODE
    ,   NULL CCID
    ,   NULL CCID_OTHER
    ,   NULL RZID
    ,   NULL RZID_OTHER
    ,   NULL DZID
    ,   NULL DZID_OTHER
    ,   COUNT(*)  CON_COUNT
FROM   CONTRACT
WHERE    CON_ETID = 'TOC'
AND CON_CODE Is Not NULL
AND CON_ESID In ('A','I')
AND (CON_DATEEND Is NULL
OR CON_DATEEND > SYSDATE)
GROUP BY   CON_CODE;


--
-- PRICE_MODEL_OVERVIEW  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.PRICE_MODEL_OVERVIEW
(PM_SRCTYPE, PM_ID, PM_NAME, PMV_COUNT, CON_COUNT)
BEQUEATH DEFINER
AS 
SELECT
  PM_SRCTYPE,
  PM_ID,
  PM_NAME,
  COUNT(PMV_PMID),
  0
FROM
  PRMODEL,
  PRMODELVER
WHERE
    PM_ID = PMV_PMID(+)
AND (PMV_END > sysdate OR PMV_END IS NULL)
AND PM_PMSID = 'A'
AND PMV_ESID = 'A'
GROUP BY
  PM_SRCTYPE,
  PM_ID,
  PM_NAME
UNION
SELECT
  PM_SRCTYPE,
  PM_ID,
  PM_NAME,
  0,
  COUNT(CON_ID)
FROM
  PRMODEL,
  CONTRACT
WHERE
    PM_ID = CON_PMID(+)
AND PM_PMSID = 'A'
AND (CON_ESID IN ('E','T','A') OR (CON_ESID IS NULL) OR (CON_ESID='I' AND NVL(CON_DATEEND,SYSDATE) >= SYSDATE))
GROUP BY
  PM_SRCTYPE,
  PM_ID,
  PM_NAME;


--
-- RAM_D_CDR_STATISTICS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.RAM_D_CDR_STATISTICS
(CDR_DATE, SRCTYPE, CDR_COUNT_IN, REVASM_ETID, REVASM_DESC, 
 REVAH_PACID, CDR_COUNT_OUT, REVASM_ORDER)
BEQUEATH DEFINER
AS 
select
    REVAC_DATE CDR_DATE,
    REVAH_SRCTYPE SRCTYPE,
    sum(revac_in) cdr_count_in,
    revasm_etid,
    revasm_desc,
    revah_pacid,
    sum(revac_out) cdr_count_out,
    revasm_order
from reva_header, reva_sigmask, reva_counter
where revah_id = revasm_revahid
and revasm_id = revac_revasmid
and revac_date >= trunc(sysdate) -4
and revac_date < trunc(sysdate)
group by
revac_date, REVAH_SRCTYPE, revasm_etid, revasm_desc, revah_pacid,revasm_order
order by 1, 2, 6, 8;


--
-- RAM_D_REVAC_CQ_BASE  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.RAM_D_REVAC_CQ_BASE
(REVASM_REVAHID, REVAC_DATE, REVAC_WEEKDAY, REVAC_IN, REVAC_OUT, 
 REVAC_OUT_PCT)
BEQUEATH DEFINER
AS 
SELECT
        REVASM_REVAHID,
        REVAC_DATE,
        TO_CHAR(REVAC_DATE,'DY') REVAC_WEEKDAY,
        SUM(REVAC_IN) REVAC_IN,
--        SUM(DECODE(REVASM_ETID,'BILLED',REVAC_OUT,0)) REVAC_OUT,
--        SUM(DECODE(REVASM_ETID,'BILLED',REVAC_OUT,0))/(SUM(REVAC_IN) + 0.0001) REVAC_OUT_PCT
        SUM(REVAC_OUT) REVAC_OUT,
        SUM(REVAC_OUT)/(SUM(REVAC_IN) + 0.0001) REVAC_OUT_PCT
FROM
        REVA_SIGMASK,
        REVA_COUNTER
WHERE
                REVA_SIGMASK.REVASM_ID = REVA_COUNTER.REVAC_REVASMID
        AND     REVASM_ESID IN ('A')
GROUP BY
        REVASM_REVAHID,
        REVAC_DATE,
        to_char(REVAC_DATE,'DY')
ORDER BY
        REVASM_REVAHID,
        REVAC_DATE,
        to_char(REVAC_DATE,'DY');


--
-- RAM_D_REVAC_CQ_BASE_W  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.RAM_D_REVAC_CQ_BASE_W
(REVASM_REVAHID, REVAC_DATE, REVAC_WEEKDAY, REVAC_IN, REVAC_OUT, 
 REVAC_OUT_PCT, REVAC_OUT_HIST_PCT)
BEQUEATH DEFINER
AS 
SELECT
        B1.REVASM_REVAHID,
        B1.REVAC_DATE,
        B1.REVAC_WEEKDAY,
        B1.REVAC_IN,
        B1.REVAC_OUT,
        B1.REVAC_OUT_PCT,
        (SELECT AVG(B2.REVAC_OUT/(B2.REVAC_IN + 0.0001))
                FROM RAM_D_REVAC_CQ_BASE B2
                WHERE B2.REVASM_REVAHID = B1.REVASM_REVAHID
                AND   B2.REVAC_WEEKDAY = B1.REVAC_WEEKDAY
                AND   B2.REVAC_DATE < B1.REVAC_DATE
                AND   B2.REVAC_DATE >= B1.REVAC_DATE-35
                AND   B2.REVAC_DATE NOT IN (SELECT REVASD_DAY FROM REVA_SPECIAL_DAYS)
        ) REVAC_OUT_HIST_PCT
FROM
        RAM_D_REVAC_CQ_BASE B1
WHERE B1.REVAC_DATE >= trunc(sysdate) - 90
AND   B1.revac_date < trunc(sysdate);


--
-- RAM_D_REVAC_CQ_DETAILS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.RAM_D_REVAC_CQ_DETAILS
(DAY, "MBB_BEPPI_CH[CDRs]", "MBB_BEPPI_CH[billedCDRs]", "MBB_BEPPI_CH[billed%]", "MBB_BEPPI_CH[billed%w]", 
 "MBB_BEPPI_FL[CDRs]", "MBB_BEPPI_FL[billedCDRs]", "MBB_BEPPI_FL[billed%]", "MBB_BEPPI_FL[billed%w]", "MB_BEPPI_CH[CDRs]", 
 "MB_BEPPI_CH[billedCDRs]", "MB_BEPPI_CH[billed%]", "MB_BEPPI_CH[billed%w]", "MB_BEPPI_FL[CDRs]", "MB_BEPPI_FL[billedCDRs]", 
 "MB_BEPPI_FL[billed%]", "MB_BEPPI_FL[billed%w]", "MB_PPB[CDRs]", "MB_PPB[billedCDRs]", "MB_PPB[billed%]", 
 "MB_PPB[billed%w]", "MB_RAP[CDRs]", "MB_RAP[billedCDRs]", "MB_RAP[billed%]", "MB_RAP[billed%w]", 
 "MMSC_BEPPI_CH[CDRs]", "MMSC_BEPPI_CH[billedCDRs]", "MMSC_BEPPI_CH[billed%]", "MMSC_BEPPI_CH[billed%w]", "MMSC_BEPPI_FL[CDRs]", 
 "MMSC_BEPPI_FL[billedCDRs]", "MMSC_BEPPI_FL[billed%]", "MMSC_BEPPI_FL[billed%w]", "MPS_BEPPI_CH[CDRs]", "MPS_BEPPI_CH[billedCDRs]", 
 "MPS_BEPPI_CH[billed%]", "MPS_BEPPI_CH[billed%w]", "MSC_BEPPI_CH[CDRs]", "MSC_BEPPI_CH[billedCDRs]", "MSC_BEPPI_CH[billed%]", 
 "MSC_BEPPI_CH[billed%w]", "MSC_BEPPI_FL[CDRs]", "MSC_BEPPI_FL[billedCDRs]", "MSC_BEPPI_FL[billed%]", "MSC_BEPPI_FL[billed%w]", 
 "OTA_BEPPI_CH[CDRs]", "OTA_BEPPI_CH[billedCDRs]", "OTA_BEPPI_CH[billed%]", "OTA_BEPPI_CH[billed%w]", "OTA_BEPPI_FL[CDRs]", 
 "OTA_BEPPI_FL[billedCDRs]", "OTA_BEPPI_FL[billed%]", "OTA_BEPPI_FL[billed%w]", "OTA_PPB[CDRs]", "OTA_PPB[billedCDRs]", 
 "OTA_PPB[billed%]", "OTA_PPB[billed%w]", "SMSC_BEPPI_CH[CDRs]", "SMSC_BEPPI_CH[billedCDRs]", "SMSC_BEPPI_CH[billed%]", 
 "SMSC_BEPPI_CH[billed%w]", "SMSC_BEPPI_FL[CDRs]", "SMSC_BEPPI_FL[billedCDRs]", "SMSC_BEPPI_FL[billed%]", "SMSC_BEPPI_FL[billed%w]", 
 "SMSC_PPB[CDRs]", "SMSC_PPB[billedCDRs]", "SMSC_PPB[billed%]", "SMSC_PPB[billed%w]", "SMSC_RAP[CDRs]", 
 "SMSC_RAP[billedCDRs]", "SMSC_RAP[billed%]", "SMSC_RAP[billed%w]", "meta_DeliveryDate")
BEQUEATH DEFINER
AS 
select
REVAC_DATE,
SUM(DECODE(REVASM_REVAHID,'MMSB-CH',REVAC_IN,0)),        SUM(DECODE(REVASM_REVAHID,'MMSB-CH',REVAC_OUT,0)),      SUM(DECODE(REVASM_REVAHID,'MMSB-CH',REVAC_OUT_PCT,0)),  SUM(DECODE(REVASM_REVAHID,'MMSB-CH',100*REVAC_OUT_PCT/(REVAC_OUT_HIST_PCT + 0.00001)-100,0)),
SUM(DECODE(REVASM_REVAHID,'MMSB-FL',REVAC_IN,0)),        SUM(DECODE(REVASM_REVAHID,'MMSB-FL',REVAC_OUT,0)),      SUM(DECODE(REVASM_REVAHID,'MMSB-FL',REVAC_OUT_PCT,0)), SUM(DECODE(REVASM_REVAHID,'MMSB-FL',100*REVAC_OUT_PCT/(REVAC_OUT_HIST_PCT + 0.00001)-100,0)),
SUM(DECODE(REVASM_REVAHID,'ISRV-CH',REVAC_IN,0)),        SUM(DECODE(REVASM_REVAHID,'ISRV-CH',REVAC_OUT,0)),      SUM(DECODE(REVASM_REVAHID,'ISRV-CH',REVAC_OUT_PCT,0)), SUM(DECODE(REVASM_REVAHID,'ISRV-CH',100*REVAC_OUT_PCT/(REVAC_OUT_HIST_PCT + 0.00001)-100,0)),
SUM(DECODE(REVASM_REVAHID,'ISRV-FL',REVAC_IN,0)),        SUM(DECODE(REVASM_REVAHID,'ISRV-FL',REVAC_OUT,0)),      SUM(DECODE(REVASM_REVAHID,'ISRV-FL',REVAC_OUT_PCT,0)), SUM(DECODE(REVASM_REVAHID,'ISRV-FL',100*REVAC_OUT_PCT/(REVAC_OUT_HIST_PCT + 0.00001)-100,0)),
SUM(DECODE(REVASM_REVAHID,'ISRV-PPB',REVAC_IN,0)),  SUM(DECODE(REVASM_REVAHID,'ISRV-PPB',REVAC_OUT,0)), SUM(DECODE(REVASM_REVAHID,'ISRV-PPB',REVAC_OUT_PCT,0)), SUM(DECODE(REVASM_REVAHID,'ISRV-PPB',100*REVAC_OUT_PCT/(REVAC_OUT_HIST_PCT + 0.00001)-100,0)),
SUM(DECODE(REVASM_REVAHID,'ISRV-RAP',REVAC_IN,0)),  SUM(DECODE(REVASM_REVAHID,'ISRV-RAP',REVAC_OUT,0)), SUM(DECODE(REVASM_REVAHID,'ISRV-RAP',REVAC_OUT_PCT,0)), SUM(DECODE(REVASM_REVAHID,'ISRV-RAP',100*REVAC_OUT_PCT/(REVAC_OUT_HIST_PCT + 0.00001)-100,0)),
SUM(DECODE(REVASM_REVAHID,'MMSC-CH',REVAC_IN,0)),        SUM(DECODE(REVASM_REVAHID,'MMSC-CH',REVAC_OUT,0)),      SUM(DECODE(REVASM_REVAHID,'MMSC-CH',REVAC_OUT_PCT,0)), SUM(DECODE(REVASM_REVAHID,'MMSC-CH',100*REVAC_OUT_PCT/(REVAC_OUT_HIST_PCT + 0.00001)-100,0)),
SUM(DECODE(REVASM_REVAHID,'MMSC-FL',REVAC_IN,0)),        SUM(DECODE(REVASM_REVAHID,'MMSC-FL',REVAC_OUT,0)),      SUM(DECODE(REVASM_REVAHID,'MMSC-FL',REVAC_OUT_PCT,0)), SUM(DECODE(REVASM_REVAHID,'MMSC-FL',100*REVAC_OUT_PCT/(REVAC_OUT_HIST_PCT + 0.00001)-100,0)),
SUM(DECODE(REVASM_REVAHID,'POS-CH',REVAC_IN,0)),         SUM(DECODE(REVASM_REVAHID,'POS-CH',REVAC_OUT,0)),       SUM(DECODE(REVASM_REVAHID,'POS-CH',REVAC_OUT_PCT,0)),  SUM(DECODE(REVASM_REVAHID,'POS-CH',100*REVAC_OUT_PCT/(REVAC_OUT_HIST_PCT + 0.00001)-100,0)),
SUM(DECODE(REVASM_REVAHID,'MSC-CH',REVAC_IN,0)),         SUM(DECODE(REVASM_REVAHID,'MSC-CH',REVAC_OUT,0)),       SUM(DECODE(REVASM_REVAHID,'MSC-CH',REVAC_OUT_PCT,0)),  SUM(DECODE(REVASM_REVAHID,'MSC-CH',100*REVAC_OUT_PCT/(REVAC_OUT_HIST_PCT + 0.00001)-100,0)),
SUM(DECODE(REVASM_REVAHID,'MSC-FL',REVAC_IN,0)),         SUM(DECODE(REVASM_REVAHID,'MSC-FL',REVAC_OUT,0)),       SUM(DECODE(REVASM_REVAHID,'MSC-FL',REVAC_OUT_PCT,0)),  SUM(DECODE(REVASM_REVAHID,'MSC-FL',100*REVAC_OUT_PCT/(REVAC_OUT_HIST_PCT + 0.00001)-100,0)),
SUM(DECODE(REVASM_REVAHID,'OTA-CH',REVAC_IN,0)),         SUM(DECODE(REVASM_REVAHID,'OTA-CH',REVAC_OUT,0)),       SUM(DECODE(REVASM_REVAHID,'OTA-CH',REVAC_OUT_PCT,0)),  SUM(DECODE(REVASM_REVAHID,'OTA-CH',100*REVAC_OUT_PCT/(REVAC_OUT_HIST_PCT + 0.00001)-100,0)),
SUM(DECODE(REVASM_REVAHID,'OTA-FL',REVAC_IN,0)),         SUM(DECODE(REVASM_REVAHID,'OTA-FL',REVAC_OUT,0)),       SUM(DECODE(REVASM_REVAHID,'OTA-FL',REVAC_OUT_PCT,0)),  SUM(DECODE(REVASM_REVAHID,'OTA-FL',100*REVAC_OUT_PCT/(REVAC_OUT_HIST_PCT + 0.00001)-100,0)),
SUM(DECODE(REVASM_REVAHID,'OTA-PPB',REVAC_IN,0)),   SUM(DECODE(REVASM_REVAHID,'OTA-PPB',REVAC_OUT,0)),  SUM(DECODE(REVASM_REVAHID,'OTA-PPB',REVAC_OUT_PCT,0)), SUM(DECODE(REVASM_REVAHID,'OTA-PPB',100*REVAC_OUT_PCT/(REVAC_OUT_HIST_PCT + 0.00001)-100,0)),
SUM(DECODE(REVASM_REVAHID,'SMSC-CH',REVAC_IN,0)),        SUM(DECODE(REVASM_REVAHID,'SMSC-CH',REVAC_OUT,0)),      SUM(DECODE(REVASM_REVAHID,'SMSC-CH',REVAC_OUT_PCT,0)), SUM(DECODE(REVASM_REVAHID,'SMSC-CH',100*REVAC_OUT_PCT/(REVAC_OUT_HIST_PCT + 0.00001)-100,0)),
SUM(DECODE(REVASM_REVAHID,'SMSC-FL',REVAC_IN,0)),        SUM(DECODE(REVASM_REVAHID,'SMSC-FL',REVAC_OUT,0)),      SUM(DECODE(REVASM_REVAHID,'SMSC-FL',REVAC_OUT_PCT,0)), SUM(DECODE(REVASM_REVAHID,'SMSC-FL',100*REVAC_OUT_PCT/(REVAC_OUT_HIST_PCT + 0.00001)-100,0)),
SUM(DECODE(REVASM_REVAHID,'SMSC-PB',REVAC_IN,0)),        SUM(DECODE(REVASM_REVAHID,'SMSC-PB',REVAC_OUT,0)),      SUM(DECODE(REVASM_REVAHID,'SMSC-PB',REVAC_OUT_PCT,0)), SUM(DECODE(REVASM_REVAHID,'SMSC-PB',100*REVAC_OUT_PCT/(REVAC_OUT_HIST_PCT + 0.00001)-100,0)),
SUM(DECODE(REVASM_REVAHID,'SMSC_RAP',REVAC_IN,0)),  SUM(DECODE(REVASM_REVAHID,'SMSC_RAP',REVAC_OUT,0)), SUM(DECODE(REVASM_REVAHID,'SMSC_RAP',REVAC_OUT_PCT,0)), SUM(DECODE(REVASM_REVAHID,'SMSC_RAP',100*REVAC_OUT_PCT/(REVAC_OUT_HIST_PCT + 0.00001)-100,0)),
SYSDATE
from RAM_D_REVAC_CQ_BASE_W
where revac_date >= trunc(sysdate) - 90
and revac_date < trunc(sysdate)
GROUP BY REVAC_DATE
ORDER BY REVAC_DATE DESC;


--
-- RAM_D_SR054A_DETAILS_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.RAM_D_SR054A_DETAILS_1
(REVAC_DATE, REVAH_SRCTYPE, CDR_COUNT_IN, REVASM_ETID, REVASM_DESC, 
 REVAH_PACID, CDR_COUNT_OUT, REVASM_ORDER)
BEQUEATH DEFINER
AS 
select
    revac_date,
    REVAH_SRCTYPE,
    sum(revac_in) cdr_count_in,
    revasm_etid,
    revasm_desc,
    revah_pacid,
    sum(revac_out) cdr_count_out,
    revasm_order
from reva_header, reva_sigmask, reva_counter
where revah_id = revasm_revahid
and revasm_id = revac_revasmid
and revac_date >= sysdate - 35
group by
revac_date,REVAH_SRCTYPE, revasm_etid, revasm_desc, revah_pacid,revasm_order

union

select revac_date, REVAH_SRCTYPE, sum(revac_in), 'All Types', null, revah_pacid, sum(revac_out), 9999.99
from reva_header, reva_sigmask, reva_counter
where revah_id = revasm_revahid
and revasm_id = revac_revasmid
and revac_date >= sysdate -10
group by
revac_date, revah_srctype, revah_pacid
order by 1, 2, 6, 8;


--
-- RAM_D_SR054A_DETAILS_2_BASE  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.RAM_D_SR054A_DETAILS_2_BASE
(REVAH_SRCTYPE, REVAC_DATE, REVAH_DESC, CDR_INCOUNT, REVAH_PACID)
BEQUEATH DEFINER
AS 
select      
    REVAH_SRCTYPE,      
    revac_date,      
    SRCT_LANG01 revah_desc,      
    sum(revac_in) cdr_count,   
    revah_pacid  
from reva_header, reva_sigmask, reva_counter, srctype  
where revah_id = revasm_revahid  
and revasm_id = revac_revasmid  
and srct_id = REVAH_SRCTYPE  
and revac_date >= sysdate-35  
group by     
REVAH_SRCTYPE, revah_pacid, SRCT_LANG01, revac_date;


--
-- SI021A_DETAILS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SI021A_DETAILS
(ROC_FROMDATE, ROC_TODATE, ROC_SEPID, CON_ID, CON_CODE, 
 TYP, COUNTER)
BEQUEATH DEFINER
AS 
SELECT
 ROC_FROMDATE,
 ROC_TODATE,
 ROC_SEPID,
 CTO.CON_ID,
 CTO.CON_CODE,
 'FRAUD' Typ,
 SUM(ROC_COUNT)
FROM
 ROCONSOLIDATION,
 CONTRACT CLA,
 CONTRACT CTO,
 TARIFF
WHERE
  ROCONSOLIDATION.ROC_CONID = CLA.CON_ID
 AND ROCONSOLIDATION.ROC_TOCID = CTO.CON_ID
 AND CLA.CON_TARID = TARIFF.TAR_ID
 AND ROC_ESID IN ('R')
 AND ROC_ETID NOT IN ('SMS-HR','SMS-EXT','PAGER-EXT')
 AND ROC_STATUS = '0'
 AND ROC_IW = '1'
 AND CLA.CON_TARID IN ('P','Q','R','S','T','U','V','W','X','Y','Z')
   
GROUP BY
 ROC_FROMDATE,
 ROC_TODATE,
 ROC_SEPID,
 CTO.CON_ID,
 CTO.CON_CODE

UNION
SELECT
 ROC_FROMDATE,
 ROC_TODATE,
 ROC_SEPID,
 CTO.CON_ID,
 CTO.CON_CODE,
 'LAC',
 SUM(ROC_COUNT)
FROM
 ROCONSOLIDATION,
 CONTRACT CLA,
 CONTRACT CTO,
 TARIFF
WHERE
  ROCONSOLIDATION.ROC_CONID = CLA.CON_ID
 AND ROCONSOLIDATION.ROC_TOCID = CTO.CON_ID
 AND CLA.CON_TARID = TARIFF.TAR_ID
 AND ROC_ESID IN ('R')
 AND ROC_ETID NOT IN ('SMS-HR','SMS-EXT','PAGER-EXT')
 AND ROC_STATUS = '0'
 AND ROC_IW = '1'
 and CLA.CON_TARID NOT IN ('P','Q','R','S','T','U','V','W','X','Y','Z')
GROUP BY
 ROC_FROMDATE,
 ROC_TODATE,
 ROC_SEPID,
 CTO.CON_ID,
 CTO.CON_CODE

UNION
SELECT
 ROC_FROMDATE,
 ROC_TODATE,
 ROC_SEPID,
 CTO.CON_ID,
 CTO.CON_CODE,
 ' MSG ',
 SUM(ROC_COUNT)
FROM
 ROCONSOLIDATION,
 CONTRACT CTO
WHERE ROCONSOLIDATION.ROC_TOCID = CTO.CON_ID
 AND ROC_ESID IN ('R')
 AND ROC_ETID NOT IN ('SMS-HR','SMS-EXT','PAGER-EXT')
 AND ROC_STATUS = '0'
 AND ROC_IW = '1'
 AND ROC_CONID IS NULL
 AND ROC_CONSOLIDATION IS NULL
GROUP BY
 ROC_FROMDATE,
 ROC_TODATE,
 ROC_SEPID,
 CTO.CON_ID,
 CTO.CON_CODE
ORDER BY 1,2,3;


--
-- SL021A_DETAILS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SL021A_DETAILS
(ROC_SEPID, CON_ID, CON_CODE, TYP, COUNTER)
BEQUEATH DEFINER
AS 
SELECT
 ROC_SEPID,
 cto.con_id,
 CTO.CON_CODE,
 'FRAUD' Typ,
 SUM(ROC_COUNT) COUNTER
FROM
 ROCONSOLIDATION,
 CONTRACT CLA,
 CONTRACT CTO,
 TARIFF
WHERE
  ROCONSOLIDATION.ROC_CONID = CLA.CON_ID
 AND ROCONSOLIDATION.ROC_TOCID = CTO.CON_ID
 AND CLA.CON_TARID = TARIFF.TAR_ID
 AND ROC_SEPID = TO_CHAR(ADD_MONTHS(SYSDATE,-1),'YYYYMM')
 AND ROC_ESID IN ('R')
 AND ROC_ETID NOT IN ('SMS-HR','SMS-EXT','PAGER-EXT')
 AND ROC_STATUS = '0'
 AND ROC_IW = '1'
 AND CLA.CON_TARID IN ('P','Q','R','S','T','U','V','W','X','Y','Z')
 AND CTO.CON_DATESTART < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
 AND (CTO.CON_DATEEND > ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1) OR CTO.CON_DATEEND IS NULL)
 AND CTO.CON_ESID IN ('A')

GROUP BY
 ROC_SEPID,
  cto.con_id,
 CTO.CON_CODE

UNION ALL
SELECT
 ROC_SEPID,
  cto.con_id,
 CTO.CON_CODE,
 'LAC',
 SUM(ROC_COUNT)
FROM
 ROCONSOLIDATION,
 CONTRACT CLA,
 CONTRACT CTO,
 TARIFF
WHERE
  ROCONSOLIDATION.ROC_CONID = CLA.CON_ID
 AND ROCONSOLIDATION.ROC_TOCID = CTO.CON_ID
 AND CLA.CON_TARID = TARIFF.TAR_ID
 AND ROC_SEPID = TO_CHAR(ADD_MONTHS(SYSDATE,-1),'YYYYMM')
 AND ROC_ESID IN ('R')
 AND ROC_ETID NOT IN ('SMS-HR','SMS-EXT','PAGER-EXT')
 AND ROC_STATUS = '0'
 AND ROC_IW = '1'
 and CLA.CON_TARID NOT IN ('P','Q','R','S','T','U','V','W','X','Y','Z')
 AND CTO.CON_DATESTART < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
 AND (CTO.CON_DATEEND > ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1) OR CTO.CON_DATEEND IS NULL)
 AND CTO.CON_ESID IN ('A')
GROUP BY
 ROC_SEPID,
  cto.con_id,
 CTO.CON_CODE

UNION ALL
SELECT
 ROC_SEPID,
  cto.con_id,
 CTO.CON_CODE,
 ' MSG ',
 SUM(ROC_COUNT)
FROM
 ROCONSOLIDATION,
 CONTRACT CTO
WHERE ROCONSOLIDATION.ROC_TOCID = CTO.CON_ID
 AND ROC_SEPID = TO_CHAR(ADD_MONTHS(SYSDATE,-1),'YYYYMM')
 AND ROC_ESID IN ('R')
 AND ROC_ETID NOT IN ('SMS-HR','SMS-EXT','PAGER-EXT')
 AND ROC_STATUS = '0'
 AND ROC_IW = '1'
 AND ROC_CONID IS NULL
 AND ROC_CONSOLIDATION IS NULL
 AND CTO.CON_DATESTART < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
 AND (CTO.CON_DATEEND > ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1) OR CTO.CON_DATEEND IS NULL)
 AND CTO.CON_ESID IN ('A')
GROUP BY
 ROC_SEPID,
  cto.con_id,
 CTO.CON_CODE
ORDER BY 1,2,3;


--
-- SL058A_BASE_1A_CORR  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SL058A_BASE_1A_CORR
(ACID, NAME, CONID, SHORTID, SERVICE, 
 BILLRATE, PRICE, ITEMTYPE, TRC_ETID, TRC_TRCLASS, 
 TRC_TRDID, BILLTEXT, CDR_COUNT, AMOUNTCU, RETSHAREMO, 
 RETSHAREPV, TRCOUNT, TRCOST)
BEQUEATH DEFINER
AS 
SELECT
 AC_ID,
 AC_NAME,
 CON_ID,
 ISC_SHORTID,
 ISC_SERVICE,
 ISC_BILLRATE,
 ISC_PRICE,
 ISC_TRANSPORTMEDIUM || ' Content',
 NULL,
 NULL,
 NULL,
 ISC_BILLTEXT,
 ISC_COUNT,
 ISC_AMOUNTCU,
 ISC_RETSHAREMO,
 ISC_RETSHAREPV,
 DECODE(ISC_TRANSPORTMEDIUM,'MMS',ISC_COUNT,0),
 DECODE(ISC_TRANSPORTMEDIUM,'MMS',ISC_COUNT*0.30,0.00)
FROM
 ISCONSOL,
 CONTRACT,
 ACCOUNT
WHERE
  ISCONSOL.ISC_CONID = CONTRACT.CON_ID
 AND ACCOUNT.AC_ID = CONTRACT.CON_ACID
 AND CON_ESTID IN ('BN')
 AND ISC_ESID = 'R'
 AND ISC_PRICE IS NOT NULL
 AND ISC_CDRTID = 'CTB-CO'
 AND ISC_SEPID = to_char(ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1),'YYYYMM');


--
-- SL058A_BASE_1B  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SL058A_BASE_1B
(ACID, NAME, CONID, SHORTID, SERVICE, 
 BILLRATE, PRICE, ITEMTYPE, TRC_ETID, TRC_TRCLASS, 
 TRC_TRDID, BILLTEXT, CDR_COUNT, AMOUNTCU, RETSHAREMO, 
 RETSHAREPV, TRCOUNT, TRCOST)
BEQUEATH DEFINER
AS 
SELECT
 AC_ID,
 AC_NAME,
 CON_ID,
 TRC_SHORTID,
 TRC_SERVICE,
 NULL,
 NULL,
 TRC_ETID || ' Transport',
 TRC_ETID,
 TRC_TRCLASS,
 TRC_TRDID,
 TRC_ETID || ' ' || TRC_TRDID,
 0,
 0.00,
 0.00,
 0.00,
 TRC_COUNT,
 TRC_AMOUNT
FROM
 TRCONSOL,
 CONTRACT,
 ACCOUNT
WHERE
  TRCONSOL.TRC_CONID = CONTRACT.CON_ID
 AND ACCOUNT.AC_ID = CONTRACT.CON_ACID
 AND CON_ESTID IN ('BN','MVP')
 AND TRC_ESID = 'R'
 AND CON_SRCTYPE <> 'ISRV'
 AND TRC_SEPID = to_char(ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1),'YYYYMM');


--
-- SL058A_BASE_1B_CORR  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SL058A_BASE_1B_CORR
(ACID, NAME, CONID, SHORTID, SERVICE, 
 BILLRATE, PRICE, ITEMTYPE, TRC_ETID, TRC_TRCLASS, 
 TRC_TRDID, BILLTEXT, CDR_COUNT, AMOUNTCU, RETSHAREMO, 
 RETSHAREPV, TRCOUNT, TRCOST)
BEQUEATH DEFINER
AS 
SELECT
 AC_ID,
 AC_NAME,
 CON_ID,
 TRC_SHORTID,
 TRC_SERVICE,
 NULL,
 NULL,
 TRC_ETID || ' Transport',
 TRC_ETID,
 TRC_TRCLASS,
 TRC_TRDID,
 TRC_ETID || ' ' || TRC_TRCLASS || ' ' || TRC_TRDID,
 0,
 0.00,
 0.00,
 0.00,
 TRC_COUNT,
 TRC_AMOUNT
FROM
 TRCONSOL,
 CONTRACT,
 ACCOUNT
WHERE
  TRCONSOL.TRC_CONID = CONTRACT.CON_ID
 AND ACCOUNT.AC_ID = CONTRACT.CON_ACID
 AND CON_ESTID IN ('BN')
 AND TRC_ESID = 'R'
 AND (TRC_ETID='SMS' OR TRC_TRDID ='MO')
 AND TRC_SEPID = to_char(ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1),'YYYYMM');


--
-- SL058A_BASE_1_CORR  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SL058A_BASE_1_CORR
(ACID, NAME, CONID, SHORTID, SERVICE, 
 BILLRATE, PRICE, ITEMTYPE, TRC_ETID, TRC_TRCLASS, 
 TRC_TRDID, BILLTEXT, CDR_COUNT, AMOUNTCU, RETSHAREMO, 
 RETSHAREPV, TRCOUNT, TRCOST)
BEQUEATH DEFINER
AS 
SELECT
 ACID,
 NAME,
 CONID,
 SHORTID,
 SERVICE,
 BILLRATE,
 PRICE,
 ITEMTYPE,
 TRC_ETID,
 TRC_TRCLASS,
 TRC_TRDID,
 BILLTEXT,
 CDR_COUNT,
 AMOUNTCU,
 RETSHAREMO,
 RETSHAREPV,
 TRCOUNT,
 TRCOST
FROM SL058A_BASE_1A_CORR
UNION ALL
SELECT
 ACID,
 NAME,
 CONID,
 SHORTID,
 SERVICE,
 BILLRATE,
 PRICE,
 ITEMTYPE,
 TRC_ETID,
 TRC_TRCLASS,
 TRC_TRDID,
 BILLTEXT,
 CDR_COUNT,
 AMOUNTCU,
 RETSHAREMO,
 RETSHAREPV,
 TRCOUNT,
 TRCOST
FROM SL058A_BASE_1B_CORR;


--
-- SL058A_DETAILS_1_CORR  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SL058A_DETAILS_1_CORR
(SHORTID, ITEMTYPE, SERVICE, BILLRATE, PRICE, 
 BILLTEXT, CDR_COUNT, AMOUNTCU, RETSHAREMO, RETSHAREPV, 
 TRCOUNT, TRCOST, AMOUNTPAID, SHAREMOBILE, ACID, 
 CONID, TRC_ETID, TRC_TRCLASS, TRC_TRDID)
BEQUEATH DEFINER
AS 
SELECT
 SHORTID,
 ITEMTYPE,
 SERVICE,
 BILLRATE,
 PRICE,
 BILLTEXT,
 SUM(CDR_COUNT),
 SUM(AMOUNTCU),
 SUM(RETSHAREMO),
 SUM(RETSHAREPV),
 SUM(TRCOUNT),
 SUM(TRCOST),
 SUM(RETSHAREPV-TRCOST),
 SUM(RETSHAREMO+TRCOST),
 ACID,
 CONID,
 TRC_ETID,
 TRC_TRCLASS,
 TRC_TRDID
FROM SL058A_BASE_1_CORR
GROUP BY
 SHORTID,
 ITEMTYPE,
 SERVICE,
 BILLRATE,
 PRICE,
 BILLTEXT,
 ACID,
 CONID,
 TRC_ETID,
 TRC_TRCLASS,
 TRC_TRDID
ORDER BY
	to_number(SHORTID),
	ITEMTYPE,
	SERVICE,
	BILLRATE,
	PRICE,
	TRC_TRDID,
	TRC_TRCLASS,
	BILLTEXT;


--
-- SL094A_FOOTER  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SL094A_FOOTER
(CON_CODE, RECORD_COUNT)
BEQUEATH DEFINER
AS 
SELECT
    CON_CODE, SUM(ROC_COUNT)
From
  ROCONSOLIDATION,
  CONTRACT
Where
  ROC_TOCID = CON_ID
  AND ROC_SEPID = TO_CHAR(ADD_MONTHS(SYSDATE,-1),'YYYYMM')
  AND ROC_ESID = 'R'
  AND ROC_ETID NOT IN ('SMS-HR','SMS-EXT','PAGER-EXT')
  AND ROC_STATUS = '0'
  AND ROC_IW = '1'
  AND CON_DATESTART < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
  AND (CON_DATEEND > ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1) OR CON_DATEEND IS NULL)
  AND CON_ESID IN ('A')
GROUP By
  CON_CODE;


--
-- SL094A_HEADER  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SL094A_HEADER
(CON_CODE, START_TIME, END_TIME, UTC_OFF, FILE_TIME)
BEQUEATH DEFINER
AS 
SELECT
    CON_CODE,
    MIN(ROC_FROMDATE),
    MAX(ROC_TODATE),
    SUBSTR(REPLACE(to_char(tz_offset(DBTIMEZONE)),':',''),1,5),
    SYSDATE
From
  ROCONSOLIDATION,
  CONTRACT
Where
  ROC_TOCID = CON_ID
  AND ROC_SEPID = TO_CHAR(ADD_MONTHS(SYSDATE,-1),'YYYYMM')
  AND ROC_ESID = 'R'
  AND ROC_ETID NOT IN ('SMS-HR','SMS-EXT','PAGER-EXT')
  AND ROC_STATUS = '0'
  AND ROC_IW = '1'
  AND CON_DATESTART < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
  AND (CON_DATEEND > ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1) OR CON_DATEEND IS NULL)
  AND CON_ESID IN ('A')
GROUP By
  CON_CODE;


--
-- SMSC_RAW_DETAILED_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SMSC_RAW_DETAILED_1
(SEP_DATE1, SEP_DATE2, SEP_LANG02, ISLA, BDC_CONSOLIDATION, 
 BDC_NPI_A, BDC_PID_A, BDC_NPI_B, BDC_PID_B, BDC_TARID, 
 BDC_COUNT)
BEQUEATH DEFINER
AS 
SELECT
  SEP_DATE1,
  SEP_DATE2,
  SEP_LANG02,
  DECODE(BDC_CONSOLIDATION,NULL,0,1),
  BDC_CONSOLIDATION,
  BDC_NPI_A,
  BDC_PID_A,
  BDC_NPI_B,
  BDC_PID_B,
  BDC_TARID,
  SUM(BDC_COUNT)
FROM 
  BDCONSOLIDATION,
  SETPERIOD
WHERE
    BDCONSOLIDATION.BDC_SEPID = SETPERIOD.SEP_ID
  AND BDC_ESID IN ('R')
  AND BDC_ETID IN ('SMSC-RAW')
  AND SEP_DATE1 = TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
GROUP BY
  SEP_DATE1,
  SEP_DATE2,
  SEP_LANG02,
  DECODE(BDC_CONSOLIDATION,NULL,0,1),
  BDC_CONSOLIDATION,
  BDC_NPI_A,
  BDC_PID_A,
  BDC_NPI_B,
  BDC_PID_B,
  BDC_TARID;


--
-- SMSC_RAW_DRILLDOWN_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SMSC_RAW_DRILLDOWN_1
(CLASSCODE, BDC_NPI_A, BDC_PID_A, BDC_NPI_B, BDC_PID_B, 
 BDC_CONSOLIDATION, BDC_TARID, MOTOTAL, DIRMTVOICE, DIRMTUCPUNKNOWN, 
 DIRMTUCPTEL, DIRMTUCPISDN, DIRMTMENUNKNOWN, DIRMTMENTEL, LAMTPROD, 
 LAMTINTERN, LAMTTEST, COUNTTOTAL)
BEQUEATH DEFINER
AS 
SELECT
  DECODE(ISLA,0,'DIR ','LA ') ||
  DECODE(BDC_NPI_A || BDC_PID_A, '10', 'MO ' || DECODE(BDC_NPI_B,'0','UNKNOWN ','1','TEL ','3','DATA ','4','ISDN ','5','TCP/IP ','') || DECODE(BDC_PID_B,'22','FAX ','24','VT ','25','PID25 ','31','X400 ','38','MEN ','39','UCP ','3A','TAP ','3E','VOI ',''), '') ||
  DECODE(BDC_NPI_B || BDC_PID_B, '10', 'MT ' || DECODE(BDC_NPI_A,'0','UNKNOWN ','1','TEL ','3','DATA ','4','ISDN ','5','TCP/IP ','') || DECODE(BDC_PID_A,'22','FAX ','24','VT ','25','PID25 ','31','X400 ','38','MEN ','39','UCP ','3A','TAP ','3E','VOI ',''), ''),
  BDC_NPI_A,
  BDC_PID_A,
  BDC_NPI_B,
  BDC_PID_B,
  BDC_CONSOLIDATION,
  BDC_TARID,
  SUM(DECODE(BDC_NPI_A || BDC_PID_A, '10',BDC_COUNT,0)) MOTOTAL,
  SUM(DECODE(BDC_NPI_B || BDC_PID_B || BDC_PID_A, '103E',DECODE(ISLA,0,BDC_COUNT,0),0)) DIRMTVOICE,
  SUM(DECODE(BDC_NPI_B || BDC_PID_B || BDC_NPI_A || BDC_PID_A, '10039',DECODE(ISLA,0,BDC_COUNT,0),0)) DIRMTUCPUNKNOWN,
  SUM(DECODE(BDC_NPI_B || BDC_PID_B || BDC_NPI_A || BDC_PID_A, '10139',DECODE(ISLA,0,BDC_COUNT,0),0)) DIRMTUCPTEL,
  SUM(DECODE(BDC_NPI_B || BDC_PID_B || BDC_NPI_A || BDC_PID_A, '10439',DECODE(ISLA,0,BDC_COUNT,0),0)) DIRMTUCPISDN,
  SUM(DECODE(BDC_NPI_B || BDC_PID_B || BDC_NPI_A || BDC_PID_A, '10038',DECODE(ISLA,0,BDC_COUNT,0),0)) DIRMTMENUNKNOWN,
  SUM(DECODE(BDC_NPI_B || BDC_PID_B || BDC_NPI_A || BDC_PID_A, '10138',DECODE(ISLA,0,BDC_COUNT,0),0)) DIRMTMENTEL,
  SUM(DECODE(BDC_NPI_B || BDC_PID_B,'10',DECODE(ISLA,0,0,DECODE(BDC_TARID,'Z',0,'X',0,NULL,0,BDC_COUNT)),0)) LAMTPROD,
  SUM(DECODE(BDC_NPI_B || BDC_PID_B,'10',DECODE(ISLA,0,0,DECODE(BDC_TARID,'X',BDC_COUNT,0)),0)) LAMTINTERN,
  SUM(DECODE(BDC_NPI_B || BDC_PID_B,'10',DECODE(ISLA,0,0,DECODE(BDC_TARID,'Z',BDC_COUNT,0)),0)) LAMTTEST,
  SUM(BDC_COUNT) COUNTTOTAL
FROM
  SMSC_RAW_DETAILED_1
GROUP BY
  DECODE(ISLA,0,'DIR ','LA ') ||
    DECODE(BDC_NPI_A || BDC_PID_A, '10', 'MO ' || DECODE(BDC_NPI_B,'0','UNKNOWN ','1','TEL ','3','DATA ','4','ISDN ','5','TCP/IP ','') || DECODE(BDC_PID_B,'22','FAX ','24','VT ','25','PID25 ','31','X400 ','38','MEN ','39','UCP ','3A','TAP ','3E','VOI ',''), '') ||
  DECODE(BDC_NPI_B || BDC_PID_B, '10', 'MT ' || DECODE(BDC_NPI_A,'0','UNKNOWN ','1','TEL ','3','DATA ','4','ISDN ','5','TCP/IP ','') || DECODE(BDC_PID_A,'22','FAX ','24','VT ','25','PID25 ','31','X400 ','38','MEN ','39','UCP ','3A','TAP ','3E','VOI ',''), ''),
  BDC_NPI_A,
  BDC_PID_A,
  BDC_NPI_B,
  BDC_PID_B,
  BDC_CONSOLIDATION,
  BDC_TARID;


--
-- SMSC_RAW_PER_CLASS_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SMSC_RAW_PER_CLASS_1
(SEP_DATE1, SEP_DATE2, SEP_LANG02, ISLA, BDC_NPI_A, 
 BDC_PID_A, BDC_NPI_B, BDC_PID_B, BDC_TARID, BDC_COUNT)
BEQUEATH DEFINER
AS 
SELECT
  SEP_DATE1,
  SEP_DATE2,
  SEP_LANG02,
  DECODE(BDC_CONSOLIDATION,NULL,0,1),
  BDC_NPI_A,
  BDC_PID_A,
  BDC_NPI_B,
  BDC_PID_B,
  BDC_TARID,
  SUM(BDC_COUNT)
FROM
  BDCONSOLIDATION,
  SETPERIOD
WHERE
    BDCONSOLIDATION.BDC_SEPID = SETPERIOD.SEP_ID
  AND BDC_ESID IN ('R')
  AND BDC_ETID IN ('SMSC-RAW')
  AND SEP_DATE1 = TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
GROUP BY
  SEP_DATE1,
  SEP_DATE2,
  SEP_LANG02,
  DECODE(BDC_CONSOLIDATION,NULL,0,1),
  BDC_NPI_A,
  BDC_PID_A,
  BDC_NPI_B,
  BDC_PID_B,
  BDC_TARID;


--
-- SMSC_RAW_SUMMARY_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SMSC_RAW_SUMMARY_1
(SEP_DATE1, SEP_DATE2, SEP_LANG02, CLASSCODE, BDC_NPI_A, 
 BDC_PID_A, BDC_NPI_B, BDC_PID_B, MOTOTAL, DIRMTVOICE, 
 DIRMTUCPUNKNOWN, DIRMTUCPTEL, DIRMTUCPISDN, DIRMTMENUNKNOWN, DIRMTMENTEL, 
 LAMTPROD, LAMTTARIFP, LAMTTARIFS, LAMTINTERN, LAMTTEST, 
 COUNTTOTAL)
BEQUEATH DEFINER
AS 
SELECT
     SEP_DATE1
,    SEP_DATE2
,    SEP_LANG02
,    DECODE(ISLA,0,'DIR ','LA ')
    || DECODE(BDC_NPI_A || BDC_PID_A, '10', 'MO '
    || DECODE(BDC_NPI_B,'0','UNKNOWN ','1','TEL ','3','DATA ','4','ISDN ','5','TCP/IP ','')
    || DECODE(BDC_PID_B,'22','FAX ','24','VT ','25','PID25 ','31','X400 ','38','MEN ','39','UCP ','3A','TAP ','3E','VOI ',''), '')
    || DECODE(BDC_NPI_B || BDC_PID_B, '10', 'MT '
    || DECODE(BDC_NPI_A,'0','UNKNOWN ','1','TEL ','3','DATA ','4','ISDN ','5','TCP/IP ','')
    || DECODE(BDC_PID_A,'22','FAX ','24','VT ','25','PID25 ','31','X400 ','38','MEN ','39','UCP ','3A','TAP ','3E','VOI ',''), '')
,    BDC_NPI_A
,    BDC_PID_A
,    BDC_NPI_B
,    BDC_PID_B
,    SUM(DECODE(BDC_NPI_A || BDC_PID_A, '10',BDC_COUNT,0)) MOTOTAL
,    SUM(DECODE(BDC_NPI_B || BDC_PID_B || BDC_PID_A, '103E',DECODE(ISLA,0,BDC_COUNT,0),0)) DIRMTVOICE
,    SUM(DECODE(BDC_NPI_B || BDC_PID_B || BDC_NPI_A || BDC_PID_A, '10039',DECODE(ISLA,0,BDC_COUNT,0),0)) DIRMTUCPUNKNOWN
,    SUM(DECODE(BDC_NPI_B || BDC_PID_B || BDC_NPI_A || BDC_PID_A, '10139',DECODE(ISLA,0,BDC_COUNT,0),0)) DIRMTUCPTEL
,    SUM(DECODE(BDC_NPI_B || BDC_PID_B || BDC_NPI_A || BDC_PID_A, '10439',DECODE(ISLA,0,BDC_COUNT,0),0)) DIRMTUCPISDN
,    SUM(DECODE(BDC_NPI_B || BDC_PID_B || BDC_NPI_A || BDC_PID_A, '10038',DECODE(ISLA,0,BDC_COUNT,0),0)) DIRMTMENUNKNOWN
,    SUM(DECODE(BDC_NPI_B || BDC_PID_B || BDC_NPI_A || BDC_PID_A, '10138',DECODE(ISLA,0,BDC_COUNT,0),0)) DIRMTMENTEL
,    SUM(DECODE(BDC_NPI_B || BDC_PID_B,'10',DECODE(ISLA,0,0,DECODE(BDC_TARID,'P',0,'Q',0,'R',0,'S',0,'T',0,'U',0,'V',0,'W',0,'X',0,'Y',0,'Z',0,NULL,0,BDC_COUNT)),0)) LAMTPROD
,    SUM(DECODE(BDC_NPI_B || BDC_PID_B,'10',DECODE(ISLA,0,0,DECODE(BDC_TARID,'P',BDC_COUNT,0)),0)) LAMTTARIFP
,    SUM(DECODE(BDC_NPI_B || BDC_PID_B,'10',DECODE(ISLA,0,0,DECODE(BDC_TARID,'S',BDC_COUNT,0)),0)) LAMTTARIFS
,    SUM(DECODE(BDC_NPI_B || BDC_PID_B,'10',DECODE(ISLA,0,0,DECODE(BDC_TARID,'Q',BDC_COUNT,'R',BDC_COUNT,'T',BDC_COUNT,'U',BDC_COUNT,'V',BDC_COUNT,'W',BDC_COUNT,'X',BDC_COUNT,'Y',BDC_COUNT,0)),0)) LAMTINTERN
,    SUM(DECODE(BDC_NPI_B || BDC_PID_B,'10',DECODE(ISLA,0,0,DECODE(BDC_TARID,'Z',BDC_COUNT,0)),0)) LAMTTEST
,    SUM(BDC_COUNT) COUNTTOTAL
FROM    SMSC_RAW_PER_CLASS_1
GROUP BY
     SEP_DATE1
,    SEP_DATE2
,    SEP_LANG02
,    DECODE(ISLA,0,'DIR ','LA ')
    || DECODE(BDC_NPI_A || BDC_PID_A, '10', 'MO '
    || DECODE(BDC_NPI_B,'0','UNKNOWN ','1','TEL ','3','DATA ','4','ISDN ','5','TCP/IP ','')
    || DECODE(BDC_PID_B,'22','FAX ','24','VT ','25','PID25 ','31','X400 ','38','MEN ','39','UCP ','3A','TAP ','3E','VOI ',''), '')
    || DECODE(BDC_NPI_B || BDC_PID_B, '10', 'MT '
    || DECODE(BDC_NPI_A,'0','UNKNOWN ','1','TEL ','3','DATA ','4','ISDN ','5','TCP/IP ','')
    || DECODE(BDC_PID_A,'22','FAX ','24','VT ','25','PID25 ','31','X400 ','38','MEN ','39','UCP ','3A','TAP ','3E','VOI ',''), '')
,    BDC_NPI_A
,    BDC_PID_A
,    BDC_NPI_B
,    BDC_PID_B;


--
-- SR001A_BASE  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR001A_BASE
(SEP_DATE1, SEP_DATE2, SEP_LANG02, ISLA, BDC_NPI_A, 
 BDC_PID_A, BDC_NPI_B, BDC_PID_B, BDC_TARID, BDC_COUNT)
BEQUEATH DEFINER
AS 
SELECT
  SEP_DATE1,
  SEP_DATE2,
  SEP_LANG02,
  DECODE(BDC_CONSOLIDATION,NULL,0,1),
  BDC_NPI_A,
  BDC_PID_A,
  BDC_NPI_B,
  BDC_PID_B,
  BDC_TARID,
  SUM(BDC_COUNT)
FROM
  BDCONSOLIDATION,
  SETPERIOD
WHERE
    BDCONSOLIDATION.BDC_SEPID = SETPERIOD.SEP_ID
  AND BDC_ESID IN ('R')
  AND BDC_ETID IN ('SMSC-RAW')
  AND SEP_DATE1 = TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
GROUP BY
  SEP_DATE1,
  SEP_DATE2,
  SEP_LANG02,
  DECODE(BDC_CONSOLIDATION,NULL,0,1),
  BDC_NPI_A,
  BDC_PID_A,
  BDC_NPI_B,
  BDC_PID_B,
  BDC_TARID;


--
-- SR001A_DETAILS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR001A_DETAILS
(SEP_DATE1, SEP_DATE2, SEP_LANG02, CLASSCODE, BDC_NPI_A, 
 BDC_PID_A, BDC_NPI_B, BDC_PID_B, MOTOTAL, DIRMTVOICE, 
 DIRMTUCPUNKNOWN, DIRMTUCPTEL, DIRMTUCPISDN, DIRMTMENUNKNOWN, DIRMTMENTEL, 
 LAMTPROD, LAMTTARIFP, LAMTTARIFS, LAMTINTERN, LAMTTEST, 
 COUNTTOTAL)
BEQUEATH DEFINER
AS 
SELECT
  SEP_DATE1,
  SEP_DATE2,
  SEP_LANG02,
  DECODE(ISLA,0,'DIR ','LA ') || 
  DECODE(BDC_NPI_A || BDC_PID_A, '10', 'MO ' || DECODE(BDC_NPI_B,'0','UNKNOWN ','1','TEL ','3','DATA ','4','ISDN ','5','TCP/IP ','') || DECODE(BDC_PID_B,'22','FAX ','24','VT ','25','PID25 ','31','X400 ','38','MEN ','39','UCP ','3A','TAP ','3E','VOI ',''), '') ||
  DECODE(BDC_NPI_B || BDC_PID_B, '10', 'MT ' || DECODE(BDC_NPI_A,'0','UNKNOWN ','1','TEL ','3','DATA ','4','ISDN ','5','TCP/IP ','') || DECODE(BDC_PID_A,'22','FAX ','24','VT ','25','PID25 ','31','X400 ','38','MEN ','39','UCP ','3A','TAP ','3E','VOI ',''), ''),
  BDC_NPI_A,
  BDC_PID_A,
  BDC_NPI_B,
  BDC_PID_B,
  SUM(DECODE(BDC_NPI_A || BDC_PID_A, '10',BDC_COUNT,0)) MOTOTAL,
  SUM(DECODE(BDC_NPI_B || BDC_PID_B || BDC_PID_A, '103E',DECODE(ISLA,0,BDC_COUNT,0),0)) DIRMTVOICE,
  SUM(DECODE(BDC_NPI_B || BDC_PID_B || BDC_NPI_A || BDC_PID_A, '10039',DECODE(ISLA,0,BDC_COUNT,0),0)) DIRMTUCPUNKNOWN,
  SUM(DECODE(BDC_NPI_B || BDC_PID_B || BDC_NPI_A || BDC_PID_A, '10139',DECODE(ISLA,0,BDC_COUNT,0),0)) DIRMTUCPTEL,
  SUM(DECODE(BDC_NPI_B || BDC_PID_B || BDC_NPI_A || BDC_PID_A, '10539',DECODE(ISLA,0,BDC_COUNT,0),0)) DIRMTUCPISDN,
  SUM(DECODE(BDC_NPI_B || BDC_PID_B || BDC_NPI_A || BDC_PID_A, '10038',DECODE(ISLA,0,BDC_COUNT,0),0)) DIRMTMENUNKNOWN,
  SUM(DECODE(BDC_NPI_B || BDC_PID_B || BDC_NPI_A || BDC_PID_A, '10138',DECODE(ISLA,0,BDC_COUNT,0),0)) DIRMTMENTEL,
  SUM(DECODE(BDC_NPI_B || BDC_PID_B,'10',DECODE(ISLA,0,0,DECODE(BDC_TARID,'P',0,'Q',0,'R',0,'S',0,'T',0,'U',0,'V',0,'W',0,'X',0,'Y',0,'Z',0,NULL,0,BDC_COUNT)),0)) LAMTPROD,
  SUM(DECODE(BDC_NPI_B || BDC_PID_B,'10',DECODE(ISLA,0,0,DECODE(BDC_TARID,'P',BDC_COUNT,0)),0)) LAMTTARIFP,
  SUM(DECODE(BDC_NPI_B || BDC_PID_B,'10',DECODE(ISLA,0,0,DECODE(BDC_TARID,'S',BDC_COUNT,0)),0)) LAMTTARIFS,
  SUM(DECODE(BDC_NPI_B || BDC_PID_B,'10',DECODE(ISLA,0,0,DECODE(BDC_TARID,'Q',BDC_COUNT,'R',BDC_COUNT,'T',BDC_COUNT,'U',BDC_COUNT,'V',BDC_COUNT,'W',BDC_COUNT,'X',BDC_COUNT,'Y',BDC_COUNT,0)),0)) LAMTINTERN,
  SUM(DECODE(BDC_NPI_B || BDC_PID_B,'10',DECODE(ISLA,0,0,DECODE(BDC_TARID,'Z',BDC_COUNT,0)),0)) LAMTTEST,
  SUM(BDC_COUNT) COUNTTOTAL
FROM
  SR001A_BASE
GROUP BY
  SEP_DATE1,
  SEP_DATE2,
  SEP_LANG02,
  DECODE(ISLA,0,'DIR ','LA ') || 
    DECODE(BDC_NPI_A || BDC_PID_A, '10', 'MO ' || DECODE(BDC_NPI_B,'0','UNKNOWN ','1','TEL ','3','DATA ','4','ISDN ','5','TCP/IP ','') || DECODE(BDC_PID_B,'22','FAX ','24','VT ','25','PID25 ','31','X400 ','38','MEN ','39','UCP ','3A','TAP ','3E','VOI ',''), '') ||
  DECODE(BDC_NPI_B || BDC_PID_B, '10', 'MT ' || DECODE(BDC_NPI_A,'0','UNKNOWN ','1','TEL ','3','DATA ','4','ISDN ','5','TCP/IP ','') || DECODE(BDC_PID_A,'22','FAX ','24','VT ','25','PID25 ','31','X400 ','38','MEN ','39','UCP ','3A','TAP ','3E','VOI ',''), ''),
  BDC_NPI_A,
  BDC_PID_A,
  BDC_NPI_B,
  BDC_PID_B
ORDER BY
  1,
  2,
  3,
  4,
  5,
  6,
  7,
  8;


--
-- SR019A_DETAILS_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR019A_DETAILS_1
(AC_NAME, TPMC_TPID, TPMC_SERVICE, TPMC_BILLTEXT, MSISDN_COUNT, 
 TPMC_PULLCOUNT, TPMC_PUSHCOUNT, PUSHPULL, AMOUNT_SUM)
BEQUEATH DEFINER
AS 
SELECT
    AC_NAME,
    TPMC_TPID,
    TPMC_SERVICE,
    DECODE(TPMC_BILLTEXT_AGR,0,TPMC_BILLTEXT,'not resolved'),
    COUNT(DISTINCT TPMC_MSISDN),
    SUM(TPMC_PULLCOUNT),
    SUM(TPMC_PUSHCOUNT),
    SUM(TPMC_PULLCOUNT+TPMC_PUSHCOUNT),
    SUM(TPMC_AMOUNTCU)
FROM
    TPMCONSOL,
    ACCOUNT
WHERE
    TPMCONSOL.TPMC_TPID = ACCOUNT.AC_TPID
    AND ACCOUNT.AC_ESID = 'A'
    AND TPMC_CONSUB IN ('BN','MVP')
GROUP BY
    AC_NAME,
    TPMC_TPID,
    TPMC_SERVICE,
    DECODE(TPMC_BILLTEXT_AGR,0,TPMC_BILLTEXT,'not resolved')
UNION
SELECT
    'undefined Third Party',
    TPMC_TPID,
    TPMC_SERVICE,
    DECODE(TPMC_BILLTEXT_AGR,0,TPMC_BILLTEXT,'not resolved'),
    COUNT(DISTINCT TPMC_MSISDN),
    SUM(TPMC_PULLCOUNT),
    SUM(TPMC_PUSHCOUNT),
    SUM(TPMC_PULLCOUNT+TPMC_PUSHCOUNT),
    SUM(TPMC_AMOUNTCU)
FROM
    TPMCONSOL
WHERE   TPMC_CONSUB IN ('BN','MVP')
    AND NOT EXISTS (
        SELECT AC_ID FROM ACCOUNT WHERE AC_TPID = TPMC_TPID
        )
GROUP BY
    TPMC_TPID,
    TPMC_SERVICE,
    DECODE(TPMC_BILLTEXT_AGR,0,TPMC_BILLTEXT,'not resolved')
ORDER BY 1,2,3,4;


--
-- SR019A_DETAILS_2  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR019A_DETAILS_2
(AC_NAME, TPMC_TPID, TPMC_SERVICE, MSISDN_COUNT, TPMC_PULLCOUNT, 
 TPMC_PUSHCOUNT, PUSHPULL, AMOUNT_SUM)
BEQUEATH DEFINER
AS 
SELECT
    AC_NAME,
    TPMC_TPID,
    TPMC_SERVICE,
    COUNT(DISTINCT TPMC_MSISDN),
    SUM(TPMC_PULLCOUNT),
    SUM(TPMC_PUSHCOUNT),
    SUM(TPMC_PULLCOUNT+TPMC_PUSHCOUNT),
    SUM(TPMC_AMOUNTCU)
FROM
    TPMCONSOL,
    ACCOUNT
WHERE
    TPMCONSOL.TPMC_TPID = ACCOUNT.AC_TPID
    AND TPMC_CONSUB IN ('BN','MVP')
    AND ACCOUNT.AC_ESID = 'A'
GROUP BY
    AC_NAME,
    TPMC_TPID,
    TPMC_SERVICE
UNION
SELECT
    'undefined Third Party',
    TPMC_TPID,
    TPMC_SERVICE,
    COUNT(DISTINCT TPMC_MSISDN),
    SUM(TPMC_PULLCOUNT),
    SUM(TPMC_PUSHCOUNT),
    SUM(TPMC_PULLCOUNT+TPMC_PUSHCOUNT),
    SUM(TPMC_AMOUNTCU)
FROM
    TPMCONSOL
WHERE   TPMC_CONSUB IN ('BN','MVP')
    AND NOT EXISTS (
        SELECT AC_ID FROM ACCOUNT WHERE AC_TPID = TPMC_TPID
        )
GROUP BY
    TPMC_TPID,
    TPMC_SERVICE
ORDER BY 1,2,3;


--
-- SR019A_DETAILS_3  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR019A_DETAILS_3
(AC_NAME, TPMC_TPID, MSISDN_COUNT, TPMC_PULLCOUNT, TPMC_PUSHCOUNT, 
 PUSHPULL, AMOUNT_SUM)
BEQUEATH DEFINER
AS 
SELECT
    AC_NAME,
    TPMC_TPID,
    COUNT(DISTINCT TPMC_MSISDN),
    SUM(TPMC_PULLCOUNT),
    SUM(TPMC_PUSHCOUNT),
    SUM(TPMC_PULLCOUNT+TPMC_PUSHCOUNT),
    SUM(TPMC_AMOUNTCU)
FROM
    TPMCONSOL,
    ACCOUNT
WHERE
    TPMCONSOL.TPMC_TPID = ACCOUNT.AC_TPID
    AND TPMC_CONSUB IN ('BN','MVP')
    AND ACCOUNT.AC_ESID = 'A'
GROUP BY
    AC_NAME,
    TPMC_TPID
UNION
SELECT
    'undefined Third Party',
    TPMC_TPID,
    COUNT(DISTINCT TPMC_MSISDN),
    SUM(TPMC_PULLCOUNT),
    SUM(TPMC_PUSHCOUNT),
    SUM(TPMC_PULLCOUNT+TPMC_PUSHCOUNT),
    SUM(TPMC_AMOUNTCU)
FROM
    TPMCONSOL
WHERE   TPMC_CONSUB IN ('BN','MVP')
    AND NOT EXISTS (
        SELECT AC_ID FROM ACCOUNT WHERE AC_TPID = TPMC_TPID
        )
GROUP BY
    TPMC_TPID
ORDER BY 1,2;


--
-- SR020A_DETAILS_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR020A_DETAILS_1
(AC_NAME, AC_ID, TPMC_BILLTEXT, MSISDN_COUNT, PUSHPULL)
BEQUEATH DEFINER
AS 
SELECT
    AC_NAME,
    TPMC_TPID,
    DECODE(TPMC_BILLTEXT_AGR,0,TPMC_BILLTEXT,'not resolved'),
    COUNT(DISTINCT TPMC_MSISDN),
    SUM(TPMC_PULLCOUNT+TPMC_PUSHCOUNT)
FROM
    TPMCONSOL,
    ACCOUNT
WHERE
    TPMCONSOL.TPMC_TPID = ACCOUNT.AC_TPID
    AND TPMC_CONSUB = 'WCB'
    AND ACCOUNT.AC_ESID = 'A'
GROUP BY
    AC_NAME,
    TPMC_TPID,
    TPMC_SERVICE,
    DECODE(TPMC_BILLTEXT_AGR,0,TPMC_BILLTEXT,'not resolved')
UNION
SELECT
    'undefined Third Party',
    TPMC_TPID,
    DECODE(TPMC_BILLTEXT_AGR,0,TPMC_BILLTEXT,'not resolved'),
    COUNT(DISTINCT TPMC_MSISDN),
    SUM(TPMC_PULLCOUNT+TPMC_PUSHCOUNT)
FROM
    TPMCONSOL
WHERE   TPMC_CONSUB = 'WCB'
    AND NOT EXISTS (
        SELECT AC_ID FROM ACCOUNT WHERE AC_TPID = TPMC_TPID
        )
GROUP BY
    TPMC_TPID,
    TPMC_SERVICE,
    DECODE(TPMC_BILLTEXT_AGR,0,TPMC_BILLTEXT,'not resolved')
ORDER BY 1,2,3,4;


--
-- SR020A_DETAILS_2  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR020A_DETAILS_2
(AC_NAME, AC_ID, MSISDN_COUNT, PUSHPULL)
BEQUEATH DEFINER
AS 
SELECT
    AC_NAME,
    TPMC_TPID,
    COUNT(DISTINCT TPMC_MSISDN),
    SUM(TPMC_PULLCOUNT+TPMC_PUSHCOUNT)
FROM
    TPMCONSOL,
    ACCOUNT
WHERE
    TPMCONSOL.TPMC_TPID = ACCOUNT.AC_TPID
    AND TPMC_CONSUB = 'WCB'
    AND ACCOUNT.AC_ESID = 'A'
GROUP BY
    AC_NAME,
    TPMC_TPID
UNION
SELECT
    'undefined Third Party',
    TPMC_TPID,
    COUNT(DISTINCT TPMC_MSISDN),
    SUM(TPMC_PULLCOUNT+TPMC_PUSHCOUNT)
FROM
    TPMCONSOL
WHERE   TPMC_CONSUB = 'WCB'
    AND NOT EXISTS (
        SELECT AC_ID FROM ACCOUNT WHERE AC_TPID = TPMC_TPID
        )
GROUP BY
    TPMC_TPID
ORDER BY 1,2;


--
-- SR021A_DETAILS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR021A_DETAILS
(ROC_SEPID, CON_CODE, TYP, COUNTER)
BEQUEATH DEFINER
AS 
SELECT
 ROC_SEPID,
 CTO.CON_CODE,
 'LA internal' Typ,
 SUM(ROC_COUNT) COUNTER
FROM
 ROCONSOLIDATION,
 CONTRACT CLA,
 CONTRACT CTO,
 TARIFF
WHERE
  ROCONSOLIDATION.ROC_CONID = CLA.CON_ID
 AND ROCONSOLIDATION.ROC_TOCID = CTO.CON_ID
 AND CLA.CON_TARID = TARIFF.TAR_ID
 AND ROC_SEPID = TO_CHAR(ADD_MONTHS(SYSDATE,-1),'YYYYMM')
 AND ROC_ESID IN ('R')
 AND ROC_ETID NOT IN ('SMS-HR','SMS-EXT','PAGER-EXT')
 AND ROC_STATUS = '0'
 AND ROC_IW = '1'
 AND CLA.CON_TARID IN ('P','Q','R','S','T','U','V','W','X','Y','Z')
 AND CTO.CON_DATESTART < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
 AND (CTO.CON_DATEEND > ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1) OR CTO.CON_DATEEND IS NULL)
 AND CTO.CON_ESID IN ('A')
 AND CTO.CON_ID <> 'FIXNETTOC'
 AND NVL(CTO.CON_VIRTUAL,0) = 0
GROUP BY
 ROC_SEPID,
 CTO.CON_CODE

UNION ALL
SELECT
 ROC_SEPID,
 CTO.CON_CODE,
 'LA charged',
 SUM(ROC_COUNT)
FROM
 ROCONSOLIDATION,
 CONTRACT CLA,
 CONTRACT CTO,
 TARIFF
WHERE
  ROCONSOLIDATION.ROC_CONID = CLA.CON_ID
 AND ROCONSOLIDATION.ROC_TOCID = CTO.CON_ID
 AND CLA.CON_TARID = TARIFF.TAR_ID
 AND ROC_SEPID = TO_CHAR(ADD_MONTHS(SYSDATE,-1),'YYYYMM')
 AND ROC_ESID IN ('R')
 AND ROC_ETID NOT IN ('SMS-HRON','SMS-HR','SMS-EXT','PAGER-EXT','SMS-GEN')
 AND ROC_STATUS = '0'
 AND ROC_IW = '1'
 AND CLA.CON_TARID NOT IN ('P','Q','R','S','T','U','V','W','X','Y','Z')
 AND CTO.CON_DATESTART < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
 AND (CTO.CON_DATEEND > ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1) OR CTO.CON_DATEEND IS NULL)
 AND CTO.CON_ESID IN ('A')
 AND CTO.CON_ID <> 'FIXNETTOC'
 AND NVL(CTO.CON_VIRTUAL,0) = 0
GROUP BY
 ROC_SEPID,
 CTO.CON_CODE

UNION ALL
SELECT
 ROC_SEPID,
 CTO.CON_CODE,
 ' MO MSG ',
 SUM(ROC_COUNT)
FROM
 ROCONSOLIDATION,
 CONTRACT CTO
WHERE ROCONSOLIDATION.ROC_TOCID = CTO.CON_ID
 AND ROC_SEPID = TO_CHAR(ADD_MONTHS(SYSDATE,-1),'YYYYMM')
 AND ROC_ESID IN ('R')
 AND ROC_ETID NOT IN ('SMS-HRON','SMS-HR','SMS-EXT','PAGER-EXT','SMS-GEN')
 AND ROC_STATUS = '0'
 AND ROC_IW = '1'
 AND ROC_CONID IS NULL
 AND ROC_CONSOLIDATION IS NULL
 AND CTO.CON_DATESTART < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
 AND (CTO.CON_DATEEND > ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1) OR CTO.CON_DATEEND IS NULL)
 AND CTO.CON_ESID IN ('A')
 AND CTO.CON_ID <> 'FIXNETTOC'
 AND NVL(CTO.CON_VIRTUAL,0) = 0
GROUP BY
 ROC_SEPID,
 CTO.CON_CODE
ORDER BY 1,2,3;


--
-- SR039A_DETAILS_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR039A_DETAILS_1
(ADR_COUNTRY, AC_NAME, CON_OPKEY, ROC_COUNT)
BEQUEATH DEFINER
AS 
SELECT
  ADR_COUNTRY,
  ATO.AC_NAME,
  CTO.CON_OPKEY,
  SUM(ROC_COUNT)
FROM
  ROCONSOLIDATION,
  CONTRACT CTO,
  ACCOUNT ATO,
  ADDRESS
WHERE
    ROCONSOLIDATION.ROC_TOCID = CTO.CON_ID
  AND ATO.AC_ID = CTO.CON_ACID
  AND ADDRESS.ADR_ID = ATO.AC_ADRID_MAIN
  AND ROC_SEPID = TO_CHAR(ADD_MONTHS(SYSDATE,-1),'YYYYMM')
  AND ROC_ESID = 'R'
  AND ROC_STATUS = '0'
  AND ROC_IW = '1'
  AND ROC_ETID NOT IN ('SMS-HR','SMS-EXT','PAGER-EXT')
  AND ROC_TOCID Is Not NULL
  AND ROC_CONSOLIDATION Is NULL
 GROUP BY
  ADR_COUNTRY,
  ATO.AC_NAME,
  CTO.CON_OPKEY
ORDER BY
  ADR_COUNTRY,
  ATO.AC_NAME,
  CTO.CON_OPKEY;


--
-- SR039A_DETAILS_2  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR039A_DETAILS_2
(ADR_COUNTRY, AC_NAME, CON_OPKEY, ROC_COUNT, ROC_IOT, 
 ROC_IOT_INTERNAL)
BEQUEATH DEFINER
AS 
SELECT
  ADR_COUNTRY,
  ATO.AC_NAME,
  CTO.CON_OPKEY,
  SUM(ROC_COUNT),
  CASE
    WHEN (SUM(ROC_IOT) IS NULL) THEN NULL
    WHEN (SUM(ROC_IOT) = 0.0)  THEN NULL
    ELSE  SUM(ROC_IOT)
  END,
  CASE
    WHEN (SUM(ROC_IOT_INTERNAL) is NULL) and (SUM(ROC_IOT) is NULL)  THEN NULL
    WHEN (SUM(ROC_IOT_INTERNAL) = 0.0) and (SUM(ROC_IOT) = 0.0)  THEN NULL 
    ELSE  NVL(SUM(ROC_IOT_INTERNAL),0.0) - NVL(SUM(ROC_IOT),0.0)
  END
FROM
  ROCONSOLIDATION,
  CONTRACT CTO,
  ACCOUNT ATO,
  ADDRESS
WHERE
    ROCONSOLIDATION.ROC_TOCID = CTO.CON_ID
  AND ATO.AC_ID = CTO.CON_ACID
  AND ADDRESS.ADR_ID = ATO.AC_ADRID_MAIN
  AND ROC_SEPID = TO_CHAR(ADD_MONTHS(SYSDATE,-1),'YYYYMM')
  AND ROC_ESID = 'R'
  AND ROC_STATUS = '0'
  AND ROC_IW = '1'
  AND ROC_ETID NOT IN ('SMS-HR','SMS-EXT','PAGER-EXT')
  AND ROC_TOCID Is Not NULL
  AND ROC_CONSOLIDATION Is Not NULL
GROUP BY
  ADR_COUNTRY,
  ATO.AC_NAME,
  CTO.CON_OPKEY
ORDER BY
  ADR_COUNTRY,
  ATO.AC_NAME,
  CTO.CON_OPKEY;


--
-- SR039A_DETAILS_3  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR039A_DETAILS_3
(AC_NAME, ROC_CONSOLIDATION, CON_PSCALL, ADR_COUNTRY, AC_NAMETO, 
 CON_OPKEY, ROC_COUNT, ROC_IOT, ROC_IOT_INTERNAL)
BEQUEATH DEFINER
AS 
SELECT
  ALA.AC_NAME,
  ROC_CONSOLIDATION,
  CLA.CON_PSCALL,
  ADR_COUNTRY,
  ATO.AC_NAME,
  CTO.CON_OPKEY,
  SUM(ROC_COUNT),
  CASE
    WHEN (SUM(ROC_IOT) IS NULL) THEN NULL
    WHEN (SUM(ROC_IOT) = 0.0)  THEN NULL
    ELSE  SUM(ROC_IOT)
  END,
  CASE 
    WHEN (SUM(ROC_IOT_INTERNAL) is NULL) and (SUM(ROC_IOT) is NULL)  THEN NULL
    WHEN (SUM(ROC_IOT_INTERNAL) = 0.0) and (SUM(ROC_IOT) = 0.0)  THEN NULL 
    ELSE  NVL(SUM(ROC_IOT_INTERNAL),0.0) - NVL(SUM(ROC_IOT),0.0)
  END
FROM
  ROCONSOLIDATION,
  CONTRACT CLA,
  CONTRACT CTO,
  ACCOUNT ALA,
  ACCOUNT ATO,
  ADDRESS
WHERE
    ROCONSOLIDATION.ROC_CONID = CLA.CON_ID
  AND ROCONSOLIDATION.ROC_TOCID = CTO.CON_ID
  AND ALA.AC_ID = CLA.CON_ACID
  AND ATO.AC_ID = CTO.CON_ACID
  AND ADDRESS.ADR_ID = ATO.AC_ADRID_MAIN
  AND ROC_SEPID = TO_CHAR(ADD_MONTHS(SYSDATE,-1),'YYYYMM')
  AND ROC_ESID = 'R'
  AND ROC_STATUS = '0'
  AND ROC_IW = '1'
  AND ROC_ETID NOT IN ('SMS-HR','SMS-EXT','PAGER-EXT')
  AND ROC_TOCID Is Not NULL
  AND ROC_CONSOLIDATION Is Not NULL
GROUP BY
  ALA.AC_NAME,
  ROC_CONSOLIDATION,
  CLA.CON_PSCALL,
  ADR_COUNTRY,
  ATO.AC_NAME,
  CTO.CON_OPKEY
ORDER BY
  ALA.AC_NAME,
  to_number(ROC_CONSOLIDATION),
  CLA.CON_PSCALL,
  ADR_COUNTRY,
  ATO.AC_NAME,
  CTO.CON_OPKEY;


--
-- SR045A_DETAILS_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR045A_DETAILS_1
(AC_NAME, CON_NAME, ISC_SERVICE, CDRS_POST, CDRS_PRE, 
 CDRS_TOTAL, AMOUNTCU_POST, AMOUNTCU_PRE, AMOUNTCU_TOTAL, SHAREPV_POST, 
 SHAREPV_PRE, SHAREPV_TOTAL, SHAREMO_POST, SHAREMO_PRE, SHAREMO_TOTAL)
BEQUEATH DEFINER
AS 
SELECT
 AC_NAME,
 CON_NAME,
 ISC_SERVICE,
 SUM(DECODE(ISC_PREPAID,'N',ISC_COUNT,0)) CDRs_Post,
 SUM(DECODE(ISC_PREPAID,'Y',ISC_COUNT,0)) CDRs_Pre,
 SUM(ISC_COUNT) CDRs_Total,

 SUM(DECODE(ISC_PREPAID,'N',ISC_AMOUNTCU,0)) AmountCu_Post,
 SUM(DECODE(ISC_PREPAID,'Y',ISC_AMOUNTCU,0)) AmountCu_Pre,
 SUM(ISC_AMOUNTCU) AmountCu_Total,

 SUM(DECODE(ISC_PREPAID,'N',ISC_RETSHAREPV,0)) SharePv_Post,
 SUM(DECODE(ISC_PREPAID,'Y',ISC_RETSHAREPV,0)) SharePv_Pre,
 SUM(ISC_RETSHAREPV) SharePv_Total,

 SUM(DECODE(ISC_PREPAID,'N',ISC_RETSHAREMO,0)) ShareMo_Post,
 SUM(DECODE(ISC_PREPAID,'Y',ISC_RETSHAREMO,0)) ShareMo_Pre,
 SUM(ISC_RETSHAREMO) ShareMo_Total

FROM
 ISCONSOL,
 CONTRACT,
 ACCOUNT
WHERE
  ISCONSOL.ISC_CONID = CONTRACT.CON_ID
 AND ACCOUNT.AC_ID = CONTRACT.CON_ACID
 AND CON_ESTID IN ('BN','MVP')
 AND ISC_ESID = 'R'
 AND ISC_PRICE IS NOT NULL
 AND ISC_CDRTID = 'CTB-CO'
 AND ISC_SEPID = to_char(ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1),'YYYYMM')
GROUP BY
 ISC_SRCTYPE,
 AC_NAME,
 CON_NAME,
 ISC_SERVICE
ORDER BY
 ISC_SRCTYPE,
 AC_NAME,
 CON_NAME,
 ISC_SERVICE;


--
-- SR045A_DETAILS_2  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR045A_DETAILS_2
(PMV_NAME, AC_NAME, ISC_SERVICE, ISC_SHORTID, ISC_BILLTEXT, 
 ABOTYPE, AMOUNTCU)
BEQUEATH DEFINER
AS 
SELECT
 PMV_NAME,
 AC_NAME,
 ISC_SERVICE,
 ISC_SHORTID,
 DECODE(ISC_BILLTEXT_AGR, 0, ISC_BILLTEXT,'not resolved'),
 ST_LANG02 abotype,
 SUM(ISC_AMOUNTCU)
FROM
 ISCONSOL,
 CONTRACT,
 ACCOUNT,
 PRMODELVER,
 STYPE
WHERE
  ISCONSOL.ISC_CONID = CONTRACT.CON_ID
 AND ISCONSOL.ISC_PMVID = PRMODELVER.PMV_ID
 AND ISCONSOL.ISC_STYPE = STYPE.ST_ID
 AND ACCOUNT.AC_ID = CONTRACT.CON_ACID
 AND CON_ESTID IN ('BN','MVP')
 AND ISC_ESID = 'R'
 AND ISC_PRICE IS NOT NULL
 AND ISC_CDRTID = 'CTB-CO'
 AND ISC_SEPID = to_char(ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1),'YYYYMM')
GROUP BY
 PMV_NAME,
 AC_NAME,
 ISC_SERVICE,
 ISC_SHORTID,
 DECODE(ISC_BILLTEXT_AGR, 0, ISC_BILLTEXT,'not resolved'),
 ST_LANG02
ORDER BY
 PMV_NAME,
 AC_NAME,
 ISC_SERVICE,
 ISC_SHORTID,
 DECODE(ISC_BILLTEXT_AGR, 0, ISC_BILLTEXT,'not resolved'),
 ST_LANG02;


--
-- SR045A_DETAILS_3  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR045A_DETAILS_3
(AC_NAME, CON_NAME, ISC_SERVICE, ISC_BILLRATE, ISC_PRICE, 
 ISC_BILLTEXT, PAYMENT, CDRS, AMOUNTCU, SHAREPV, 
 SHAREMO)
BEQUEATH DEFINER
AS 
SELECT
 AC_NAME,
 CON_NAME,
 ISC_SERVICE,
 ISC_BILLRATE,
 ISC_PRICE + 0.0,
 DECODE(ISC_BILLTEXT_AGR, 0, ISC_BILLTEXT,'not resolved'),
 DECODE(ISC_PREPAID,'Y','Prepaid','N','Postpaid') Payment,
 SUM(ISC_COUNT) CDRs,
 SUM(ISC_AMOUNTCU) AmountCU,
 SUM(ISC_RETSHAREPV) SharePV,
 SUM(ISC_RETSHAREMO) ShareMO
FROM
 ISCONSOL,
 CONTRACT,
 ACCOUNT
WHERE
  ISCONSOL.ISC_CONID = CONTRACT.CON_ID
 AND ACCOUNT.AC_ID = CONTRACT.CON_ACID
 AND CON_ESTID IN ('BN','MVP')
 AND ISC_ESID = 'R'
 AND ISC_PRICE IS NOT NULL
 AND ISC_CDRTID = 'CTB-CO'
 AND ISC_SEPID = to_char(ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1),'YYYYMM')
GROUP BY
 AC_NAME,
 CON_NAME,
 ISC_SERVICE,
 ISC_BILLRATE,
 ISC_PRICE,
 DECODE(ISC_BILLTEXT_AGR, 0, ISC_BILLTEXT,'not resolved'),
 DECODE(ISC_PREPAID,'Y','Prepaid','N','Postpaid')
ORDER BY
 AC_NAME,
 CON_NAME,
 ISC_SERVICE,
 ISC_BILLRATE,
 ISC_PRICE,
 DECODE(ISC_BILLTEXT_AGR, 0, ISC_BILLTEXT,'not resolved'),
 DECODE(ISC_PREPAID,'Y','Prepaid','N','Postpaid');


--
-- SR045A_DETAILS_4  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR045A_DETAILS_4
(AC_NAME, SHORTID_SERVICE, TRSHARE, TRC_PRICE, CDRS, 
 AMOUNTTP)
BEQUEATH DEFINER
AS 
SELECT
  AC_NAME,
  NVL(TRC_SHORTID,TRC_SERVICE) shortid_service,
  TRC_ETID ||' ' || TRC_TRCLASS ||' ' || TRC_TRDID,
  TRC_PRICE + 0.0,
  SUM(TRC_COUNT) CDRs,
  SUM(TRC_AMOUNT) AmountTP
 FROM
  TRCONSOL, 
  CONTRACT, 
  ACCOUNT
 WHERE TRC_CONID = CON_ID
 AND CON_ACID = AC_ID
 AND CON_ESTID IN ('BN','MVP')
 AND TRC_ESID = 'R'
 AND TRC_SEPID = to_char(ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1),'YYYYMM') 
 GROUP BY
  AC_NAME,
  NVL(TRC_SHORTID,TRC_SERVICE),
  TRC_ETID,
  TRC_TRCLASS,
  TRC_TRDID,
  TRC_PRICE
ORDER BY
  AC_NAME,
  NVL(TRC_SHORTID,TRC_SERVICE),
  TRC_ETID DESC,
  TRC_TRCLASS,
  TRC_TRDID,
  TRC_PRICE;


--
-- SR045A_DETAILS_5_BASE  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR045A_DETAILS_5_BASE
(AC_NAME, SHORTID, AMT_CONTENT, AMT_TRAFFIC, AMT_TOTAL)
BEQUEATH DEFINER
AS 
SELECT
      AC_NAME,      
      NVL(TRC_SHORTID,TRC_SERVICE),      
      0.0,      
      0.0 - TRC_AMOUNT,      
      0.0 - TRC_AMOUNT  
FROM      
      TRCONSOL,      
      CONTRACT,      
      ACCOUNT  
WHERE          
      TRCONSOL.TRC_CONID = CONTRACT.CON_ID      
AND   ACCOUNT.AC_ID = CONTRACT.CON_ACID      
AND   CON_ESTID IN ('BN','MVP')
AND   TRC_ESID = 'R'      
AND   TRC_SEPID =  to_char(ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1),'YYYYMM')  

UNION ALL SELECT   
      AC_NAME,   
      NVL(ISC_SHORTID,ISC_SERVICE),   
      ISC_RETSHAREPV,   
      0.0,   
      ISC_RETSHAREPV   
FROM   
      ISCONSOL,   
      CONTRACT,   
      ACCOUNT  
WHERE    
      ISCONSOL.ISC_CONID = CONTRACT.CON_ID   
AND   ACCOUNT.AC_ID = CONTRACT.CON_ACID   
AND   CON_ESTID IN ('BN','MVP')
AND   ISC_ESID = 'R'   
AND   ISC_PRICE IS NOT NULL
AND ISC_CDRTID = 'CTB-CO'
AND   ISC_SEPID = to_char(ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1),'YYYYMM');


--
-- SR048A_DETAILS_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR048A_DETAILS_1
(MMSC_SHORTID, MESSAGE_TYPE, MESSAGE_CLASS, MMSC_CDRRECTYPE, EVENTDISP_TYPE, 
 MMSC_TRCLASS, PAYMENT, MMSC_LEGACYINDICATOR, MMSC_COUNT, MMSC_NUMNOTIFICATION, 
 MMSC_NUMHOMERECIP, MMSC_NUMNONHOMERECIP, MMSC_NUMINTLRECIP, MMSC_NUMEMAILRECIP, MMSC_NUMSCODERECIP, 
 TOTAL_RECIP)
BEQUEATH DEFINER
AS 
SELECT
	MMSC_SHORTID MMSC_SHORTID,
	MMSCMT_LANG01 MESSAGE_TYPE,
	MMSCMC_LANG01 MESSAGE_CLASS,
	MMSC_CDRRECTYPE MMSC_CDRRECTYPE,
	NVL(MMSCET_LANG01,'Event Disposition ' || MMSCONSOLIDATION.MMSC_EVENTDISP) EVENTDISP_TYPE,
	MMSC_TRCLASS,
	DECODE(MMSC_PREPAID,'Y','PREPAID','N','POSTPAID') PAYMENT,
	MMSC_LEGACYINDICATOR MMSC_LEGACYINDICATOR,
	SUM(MMSC_COUNT) MMSC_COUNT,
	SUM(MMSC_NUMNOTIFICATION) MMSC_NUMNOTIFICATION,
	SUM(MMSC_NUMHOMERECIP) MMSC_NUMHOMERECIP,
	SUM(MMSC_NUMNONHOMERECIP) MMSC_NUMNONHOMERECIP,
	SUM(MMSC_NUMINTLRECIP) MMSC_NUMINTLRECIP,
	SUM(MMSC_NUMEMAILRECIP) MMSC_NUMEMAILRECIP,
	SUM(MMSC_NUMSCODERECIP) MMSC_NUMSCODERECIP,
	SUM(MMSC_NUMHOMERECIP + MMSC_NUMNONHOMERECIP + MMSC_NUMINTLRECIP + MMSC_NUMEMAILRECIP + MMSC_NUMSCODERECIP) TOTAL_RECIP
FROM
	MMSCONSOLIDATION,
	MMSC_EVENTDISPTYPE,
	MMSC_MSGCLASS,
	MMSC_MSGTYPE,
	CONTRACT
WHERE
		to_char(MMSCONSOLIDATION.MMSC_EVENTDISP) = MMSC_EVENTDISPTYPE.MMSCET_ID
	AND	to_char(MMSCONSOLIDATION.MMSC_MSGCLASS) = MMSC_MSGCLASS.MMSCMC_ID
	AND	to_char(MMSCONSOLIDATION.MMSC_MSGTYPE) = MMSC_MSGTYPE.MMSCMT_ID
	AND	MMSCONSOLIDATION.MMSC_CONID = CONTRACT.CON_ID
	AND	MMSC_ETID IN ('MMSC-RAW')
	AND	MMSC_ESID IN ('R')
	AND	MMSC_SEPID = TO_CHAR(ADD_MONTHS(SYSDATE,-1),'YYYYMM')
	AND	MMSC_CONID IS NOT NULL
GROUP BY
	CON_NAME,
	MMSC_SHORTID,
	MMSCMT_LANG01,
	MMSCMC_LANG01,
	MMSC_CDRRECTYPE,
	NVL(MMSCET_LANG01,'Event Disposition ' || MMSCONSOLIDATION.MMSC_EVENTDISP),
	MMSC_TRCLASS,
	DECODE(MMSC_PREPAID,'Y','PREPAID','N','POSTPAID'),
	MMSC_LEGACYINDICATOR;


--
-- SR048A_DETAILS_2  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR048A_DETAILS_2
(MESSAGE_TYPE, MESSAGE_CLASS, MMSC_CDRRECTYPE, EVENTDISP_TYPE, MMSC_TRCLASS, 
 PAYMENT, MMSC_LEGACYINDICATOR, MMSC_COUNT, MMSC_NUMNOTIFICATION, MMSC_NUMHOMERECIP, 
 MMSC_NUMNONHOMERECIP, MMSC_NUMINTLRECIP, MMSC_NUMEMAILRECIP, MMSC_NUMSCODERECIP, TOTAL_RECIP)
BEQUEATH DEFINER
AS 
SELECT
	MMSCMT_LANG01 MESSAGE_TYPE,
	MMSCMC_LANG01 MESSAGE_CLASS,
	MMSC_CDRRECTYPE MMSC_CDRRECTYPE,
	NVL(MMSCET_LANG01,'Event Disposition ' || MMSCONSOLIDATION.MMSC_EVENTDISP) EVENTDISP_TYPE,
	MMSC_TRCLASS,
	DECODE(MMSC_PREPAID,'Y','PREPAID','N','POSTPAID') PAYMENT,
	MMSC_LEGACYINDICATOR MMSC_LEGACYINDICATOR,
	SUM(MMSC_COUNT) MMSC_COUNT,
	SUM(MMSC_NUMNOTIFICATION) MMSC_NUMNOTIFICATION,
	SUM(MMSC_NUMHOMERECIP) MMSC_NUMHOMERECIP,
	SUM(MMSC_NUMNONHOMERECIP) MMSC_NUMNONHOMERECIP,
	SUM(MMSC_NUMINTLRECIP) MMSC_NUMINTLRECIP,
	SUM(MMSC_NUMEMAILRECIP) MMSC_NUMEMAILRECIP,
	SUM(MMSC_NUMSCODERECIP) MMSC_NUMSCODERECIP,
	SUM(MMSC_NUMHOMERECIP + MMSC_NUMNONHOMERECIP + MMSC_NUMINTLRECIP + MMSC_NUMEMAILRECIP + MMSC_NUMSCODERECIP) TOTAL_RECIP
FROM
	MMSCONSOLIDATION,
	MMSC_EVENTDISPTYPE,
	MMSC_MSGCLASS,
	MMSC_MSGTYPE
WHERE
		to_char(MMSCONSOLIDATION.MMSC_EVENTDISP) = MMSC_EVENTDISPTYPE.MMSCET_ID
	AND	to_char(MMSCONSOLIDATION.MMSC_MSGCLASS) = MMSC_MSGCLASS.MMSCMC_ID
	AND	to_char(MMSCONSOLIDATION.MMSC_MSGTYPE) = MMSC_MSGTYPE.MMSCMT_ID
	AND	MMSC_ETID IN ('MMSC-RAW')
	AND	MMSC_ESID IN ('R')
	AND	MMSC_SEPID = TO_CHAR(ADD_MONTHS(SYSDATE,-1),'YYYYMM')
	AND	MMSC_CONID IS NULL
GROUP BY
	MMSCMT_LANG01,
	MMSCMC_LANG01,
	MMSC_CDRRECTYPE,
	NVL(MMSCET_LANG01,'Event Disposition ' || MMSCONSOLIDATION.MMSC_EVENTDISP),
	MMSC_TRCLASS,
	DECODE(MMSC_PREPAID,'Y','PREPAID','N','POSTPAID'),
	MMSC_LEGACYINDICATOR;


--
-- SR054A_DETAILS_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR054A_DETAILS_1
(REVAH_SRCTYPE, CDR_COUNT_IN, REVASM_ETID, REVASM_DESC, REVAH_PACID, 
 CDR_COUNT_OUT, REVASM_ORDER)
BEQUEATH DEFINER
AS 
select
    REVAH_SRCTYPE,
    sum(revac_in) cdr_count_in,
    revasm_etid,
    revasm_desc,
    revah_pacid,
    sum(revac_out) cdr_count_out,
    revasm_order
from reva_header, reva_sigmask, reva_counter
where revah_id = revasm_revahid
and revasm_id = revac_revasmid
and revah_esid ='A'
and revasm_esid ='A'
and revac_date >= trunc(add_months(sysdate,-1),'MONTH')
and revac_date < trunc(sysdate,'MONTH')
group by
REVAH_SRCTYPE, revasm_etid, revasm_desc, revah_pacid,revasm_order

union

select REVAH_SRCTYPE, sum(revac_in), 'All Types', null, revah_pacid, sum(revac_out), 9999.99
from reva_header, reva_sigmask, reva_counter
where revah_id = revasm_revahid
and revasm_id = revac_revasmid
and revah_esid ='A'
and revasm_esid ='A'
and revac_date >= trunc(add_months(sysdate,-1),'MONTH')
and revac_date < trunc(sysdate,'MONTH')
group by
revah_srctype, revah_pacid

order by 1, 5, 7, 2 DESC;


--
-- SR054A_DETAILS_1_ROLL  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR054A_DETAILS_1_ROLL
(REVAH_SRCTYPE, CDR_COUNT_IN, REVASM_ETID, REVASM_DESC, REVAH_PACID, 
 CDR_COUNT_OUT, REVASM_ORDER)
BEQUEATH DEFINER
AS 
select
    REVAH_SRCTYPE,
    sum(revac_in) cdr_count_in,
    revasm_etid,
    revasm_desc,
    revah_pacid,
    sum(revac_out) cdr_count_out,
    revasm_order
from reva_header, reva_sigmask, reva_counter
where revah_id = revasm_revahid
and revasm_id = revac_revasmid
and revah_esid ='A'
and revasm_esid ='A'
and revac_date >= trunc(sysdate)-30
and revac_date < trunc(sysdate)
group by
REVAH_SRCTYPE, revasm_etid, revasm_desc, revah_pacid,revasm_order

union

select REVAH_SRCTYPE, sum(revac_in), 'All Types', null, revah_pacid, sum(revac_out), 9999.99
from reva_header, reva_sigmask, reva_counter
where revah_id = revasm_revahid
and revasm_id = revac_revasmid
and revah_esid ='A'
and revasm_esid ='A'
and revac_date >= trunc(sysdate)-30
and revac_date < trunc(sysdate)
group by
revah_srctype, revah_pacid

order by 1, 5, 7, 2 DESC;


--
-- SR054A_DETAILS_2_BASE  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR054A_DETAILS_2_BASE
(REVAH_SRCTYPE, REVAC_DATE, REVAH_DESC, CDR_INCOUNT, REVAH_PACID)
BEQUEATH DEFINER
AS 
select
    REVAH_SRCTYPE,
    revac_date,
    SRCT_LANG01 revah_desc,
    sum(revac_in) cdr_count,
	revah_pacid
from reva_header, reva_sigmask, reva_counter, srctype
where revah_id = revasm_revahid
and revasm_id = revac_revasmid
and srct_id = REVAH_SRCTYPE
and revah_esid ='A'
and revasm_esid ='A'
and revac_date >= trunc(add_months(sysdate,-1),'MONTH')
and revac_date < trunc(sysdate,'MONTH')
group by
REVAH_SRCTYPE, revah_pacid, SRCT_LANG01, revac_date;


--
-- SR054A_DETAILS_2_BASE_ROLL  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR054A_DETAILS_2_BASE_ROLL
(REVAH_SRCTYPE, REVAC_DATE, REVAH_DESC, CDR_INCOUNT, REVAH_PACID)
BEQUEATH DEFINER
AS 
select
    REVAH_SRCTYPE,
    revac_date,
    SRCT_LANG01 revah_desc,
    sum(revac_in) cdr_count,
	revah_pacid
from reva_header, reva_sigmask, reva_counter, srctype
where revah_id = revasm_revahid
and revasm_id = revac_revasmid
and srct_id = REVAH_SRCTYPE
and revah_esid ='A'
and revasm_esid ='A'
and revac_date >= trunc(sysdate)-30
and revac_date < trunc(sysdate)
group by
REVAH_SRCTYPE, revah_pacid, SRCT_LANG01, revac_date;


--
-- SR054A_DETAILS_2_ROLL  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR054A_DETAILS_2_ROLL
(REVAH_SRCTYPE, REVAC_DATE, REVAH_DESC, CDR_COUNT)
BEQUEATH DEFINER
AS 
select
    REVAH_SRCTYPE,
    revac_date,
    revah_desc,
    max(CDR_INCOUNT) cdr_count
from 		SR054A_DETAILS_2_base_roll
group by	REVAH_SRCTYPE, revac_date, revah_desc

order by 1,2;


--
-- SR059A_BASE_B  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR059A_BASE_B
(GART, NAME, CONID, PREPAID, SHORTID, 
 CDR_COUNT, AMOUNTCU, RETSHAREMO, RETSHAREPV, TC_MMS_MT, 
 TC_MMS_MO, TC_SMS_MT, TC_SMS_MO, MMS_CONTENT_COUNT, MMS_MT_COUNT, 
 MMS_MO_COUNT, SMS_CONTENT_COUNT, SMS_MT_COUNT, SMS_MO_COUNT)
BEQUEATH DEFINER
AS 
SELECT
 TRC_GART,
 AC_NAME,
 CON_ID,
 TRC_PREPAID,
 TRC_SHORTID,
 0,
 0.00,
 0.00,
 0.00,
 TRC_AMOUNT,
 0.00,
 0.00,
 0.00,
 0,
 TRC_COUNT,
 0,
 0,
 0,
 0
FROM
 TRCONSOL,
 CONTRACT,
 ACCOUNT
WHERE
  TRCONSOL.TRC_CONID = CONTRACT.CON_ID
 AND ACCOUNT.AC_ID = CONTRACT.CON_ACID
 AND CON_ESTID IN ('BN')
 AND TRC_ESID = 'R'
 AND TRC_ETID = 'MMS'
 AND TRC_TRDID = 'MT'
 AND TRC_SEPID = to_char(ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1),'YYYYMM');


--
-- SR059A_BASE_B_MVP  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR059A_BASE_B_MVP
(GART, NAME, CONID, SHOW, CAMPAIGN, 
 PREPAID, SHORTID, CDR_COUNT, AMOUNTCU, RETSHAREMO, 
 RETSHAREPV, TC_MMS_MT, TC_MMS_MO, TC_SMS_MT, TC_SMS_MO, 
 MMS_CONTENT_COUNT, MMS_MT_COUNT, MMS_MO_COUNT, SMS_CONTENT_COUNT, SMS_MT_COUNT, 
 SMS_MO_COUNT)
BEQUEATH DEFINER
AS 
SELECT
 TRC_GART,
 AC_NAME,
 CON_ID,
 TRC_SHOW,
 TRC_CAMPAIGN,
 TRC_PREPAID,
 TRC_SHORTID,
 0,
 0.00,
 0.00,
 0.00,
 TRC_AMOUNT,
 0.00,
 0.00,
 0.00,
 0,
 TRC_COUNT,
 0,
 0,
 0,
 0
FROM
 TRCONSOL,
 CONTRACT,
 ACCOUNT
WHERE
  TRCONSOL.TRC_CONID = CONTRACT.CON_ID
 AND ACCOUNT.AC_ID = CONTRACT.CON_ACID
 AND CON_ESTID IN ('MVP')
 AND TRC_ESID = 'R'
 AND TRC_ETID = 'MMS'
 AND TRC_TRDID = 'MT'
 AND TRC_SEPID = to_char(ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1),'YYYYMM');


--
-- SR059A_BASE_C  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR059A_BASE_C
(GART, NAME, CONID, PREPAID, SHORTID, 
 CDR_COUNT, AMOUNTCU, RETSHAREMO, RETSHAREPV, TC_MMS_MT, 
 TC_MMS_MO, TC_SMS_MT, TC_SMS_MO, MMS_CONTENT_COUNT, MMS_MT_COUNT, 
 MMS_MO_COUNT, SMS_CONTENT_COUNT, SMS_MT_COUNT, SMS_MO_COUNT)
BEQUEATH DEFINER
AS 
SELECT
 TRC_GART,
 AC_NAME,
 CON_ID,
 TRC_PREPAID,
 TRC_SHORTID,
 0,
 0.00,
 0.00,
 0.00,
 0.00,
 0.00,
 TRC_AMOUNT,
 0.00,
 0,
 0,
 0,
 0,
 TRC_COUNT,
 0
FROM
 TRCONSOL,
 CONTRACT,
 ACCOUNT
WHERE
  TRCONSOL.TRC_CONID = CONTRACT.CON_ID
 AND ACCOUNT.AC_ID = CONTRACT.CON_ACID
 AND CON_ESTID IN ('BN')
 AND TRC_ESID = 'R'
 AND TRC_ETID = 'SMS'
 AND TRC_TRDID = 'MT'
 AND TRC_SEPID = to_char(ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1),'YYYYMM');


--
-- SR059A_BASE_C_MVP  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR059A_BASE_C_MVP
(GART, NAME, CONID, SHOW, CAMPAIGN, 
 PREPAID, SHORTID, CDR_COUNT, AMOUNTCU, RETSHAREMO, 
 RETSHAREPV, TC_MMS_MT, TC_MMS_MO, TC_SMS_MT, TC_SMS_MO, 
 MMS_CONTENT_COUNT, MMS_MT_COUNT, MMS_MO_COUNT, SMS_CONTENT_COUNT, SMS_MT_COUNT, 
 SMS_MO_COUNT)
BEQUEATH DEFINER
AS 
SELECT
 TRC_GART,
 AC_NAME,
 CON_ID,
 TRC_SHOW,
 TRC_CAMPAIGN,
 TRC_PREPAID,
 TRC_SHORTID,
 0,
 0.00,
 0.00,
 0.00,
 0.00,
 0.00,
 TRC_AMOUNT,
 0.00,
 0,
 0,
 0,
 0,
 TRC_COUNT,
 0
FROM
 TRCONSOL,
 CONTRACT,
 ACCOUNT
WHERE
  TRCONSOL.TRC_CONID = CONTRACT.CON_ID
 AND ACCOUNT.AC_ID = CONTRACT.CON_ACID
 AND CON_ESTID IN ('MVP')
 AND TRC_ESID = 'R'
 AND TRC_ETID = 'SMS'
 AND TRC_TRDID = 'MT'
 AND TRC_SEPID = to_char(ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1),'YYYYMM');


--
-- SR059A_BASE_D  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR059A_BASE_D
(GART, NAME, CONID, PREPAID, SHORTID, 
 CDR_COUNT, AMOUNTCU, RETSHAREMO, RETSHAREPV, TC_MMS_MT, 
 TC_MMS_MO, TC_SMS_MT, TC_SMS_MO, MMS_CONTENT_COUNT, MMS_MT_COUNT, 
 MMS_MO_COUNT, SMS_CONTENT_COUNT, SMS_MT_COUNT, SMS_MO_COUNT)
BEQUEATH DEFINER
AS 
SELECT
 TRC_GART,
 AC_NAME,
 CON_ID,
 TRC_PREPAID,
 TRC_SHORTID,
 0,
 0.00,
 0.00,
 0.00,
 0.00,
 0.00,
 0.00, 
 TRC_AMOUNT,
 0,
 0,
 0,
 0,
 0,
 TRC_COUNT
FROM
 TRCONSOL,
 CONTRACT,
 ACCOUNT
WHERE
  TRCONSOL.TRC_CONID = CONTRACT.CON_ID
 AND ACCOUNT.AC_ID = CONTRACT.CON_ACID
 AND CON_ESTID IN ('BN')
 AND TRC_ESID = 'R'
 AND TRC_ETID = 'SMS'
 AND TRC_TRDID = 'MO'
 AND TRC_SEPID = to_char(ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1),'YYYYMM');


--
-- SR059A_BASE_D_MVP  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR059A_BASE_D_MVP
(GART, NAME, CONID, SHOW, CAMPAIGN, 
 PREPAID, SHORTID, CDR_COUNT, AMOUNTCU, RETSHAREMO, 
 RETSHAREPV, TC_MMS_MT, TC_MMS_MO, TC_SMS_MT, TC_SMS_MO, 
 MMS_CONTENT_COUNT, MMS_MT_COUNT, MMS_MO_COUNT, SMS_CONTENT_COUNT, SMS_MT_COUNT, 
 SMS_MO_COUNT)
BEQUEATH DEFINER
AS 
SELECT
 TRC_GART,
 AC_NAME,
 CON_ID,
 TRC_SHOW,
 TRC_CAMPAIGN,
 TRC_PREPAID,
 TRC_SHORTID,
 0,
 0.00,
 0.00,
 0.00,
 0.00,
 0.00,
 0.00, 
 TRC_AMOUNT,
 0,
 0,
 0,
 0,
 0,
 TRC_COUNT
FROM
 TRCONSOL,
 CONTRACT,
 ACCOUNT
WHERE
  TRCONSOL.TRC_CONID = CONTRACT.CON_ID
 AND ACCOUNT.AC_ID = CONTRACT.CON_ACID
 AND CON_ESTID IN ('MVP')
 AND TRC_ESID = 'R'
 AND TRC_ETID = 'SMS'
 AND TRC_TRDID = 'MO'
 AND TRC_SEPID = to_char(ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1),'YYYYMM');


--
-- SR059A_BASE_E  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR059A_BASE_E
(GART, NAME, CONID, PREPAID, SHORTID, 
 CDR_COUNT, AMOUNTCU, RETSHAREMO, RETSHAREPV, TC_MMS_MT, 
 TC_MMS_MO, TC_SMS_MT, TC_SMS_MO, MMS_CONTENT_COUNT, MMS_MT_COUNT, 
 MMS_MO_COUNT, SMS_CONTENT_COUNT, SMS_MT_COUNT, SMS_MO_COUNT)
BEQUEATH DEFINER
AS 
SELECT
 TRC_GART,
 AC_NAME,
 CON_ID,
 TRC_PREPAID,
 TRC_SHORTID,
 0,
 0.00,
 0.00,
 0.00,
 0.00,
 TRC_AMOUNT,
 0.00,
 0.00,
 0,
 0,
 TRC_COUNT,
 0,
 0,
 0
FROM
 TRCONSOL,
 CONTRACT,
 ACCOUNT
WHERE
  TRCONSOL.TRC_CONID = CONTRACT.CON_ID
 AND ACCOUNT.AC_ID = CONTRACT.CON_ACID
 AND CON_ESTID IN ('BN')
 AND TRC_ESID = 'R'
 AND TRC_ETID = 'MMS'
 AND TRC_TRDID = 'MO'
 AND TRC_SEPID = to_char(ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1),'YYYYMM');


--
-- SR059A_BASE_E_MVP  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR059A_BASE_E_MVP
(GART, NAME, CONID, SHOW, CAMPAIGN, 
 PREPAID, SHORTID, CDR_COUNT, AMOUNTCU, RETSHAREMO, 
 RETSHAREPV, TC_MMS_MT, TC_MMS_MO, TC_SMS_MT, TC_SMS_MO, 
 MMS_CONTENT_COUNT, MMS_MT_COUNT, MMS_MO_COUNT, SMS_CONTENT_COUNT, SMS_MT_COUNT, 
 SMS_MO_COUNT)
BEQUEATH DEFINER
AS 
SELECT
 TRC_GART,
 AC_NAME,
 CON_ID,
 TRC_SHOW,
 TRC_CAMPAIGN,
 TRC_PREPAID,
 TRC_SHORTID,
 0,
 0.00,
 0.00,
 0.00,
 0.00,
 TRC_AMOUNT,
 0.00,
 0.00,
 0,
 0,
 TRC_COUNT,
 0,
 0,
 0
FROM
 TRCONSOL,
 CONTRACT,
 ACCOUNT
WHERE
  TRCONSOL.TRC_CONID = CONTRACT.CON_ID
 AND ACCOUNT.AC_ID = CONTRACT.CON_ACID
 AND CON_ESTID IN ('MVP')
 AND TRC_ESID = 'R'
 AND TRC_ETID = 'MMS'
 AND TRC_TRDID = 'MO'
 AND TRC_SEPID = to_char(ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1),'YYYYMM');


--
-- SR060A_DETAILS_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR060A_DETAILS_1
(AC_NAME, AC_TPID, MMSC_SHORTID, MMSC_CDRRECTYPE, MMSC_PREPAID, 
 MMSC_COUNT, MMSC_RETSHAREMO)
BEQUEATH DEFINER
AS 
SELECT
	AC_NAME,
	AC_TPID,
	MMSC_SHORTID,
	DECODE(MMSC_CDRRECTYPE,'MMSRrecord','MT','MO'),
	DECODE(MMSC_PREPAID,'Y','PrePaid','N','PostPaid'),
	SUM(MMSC_COUNT),
	SUM(MMSC_RETSHAREMO)
FROM
	MMSCONSOLIDATION,
	CONTRACT,
	ACCOUNT
WHERE
		MMSCONSOLIDATION.MMSC_CONID = CONTRACT.CON_ID
	AND	ACCOUNT.AC_ID = CONTRACT.CON_ACID
	AND	MMSC_RETSHAREMO <> 0.0000
	AND	MMSC_ESID IN ('R')
	AND	MMSC_ETID IN ('MMSC-RAW')
	AND	MMSC_SEPID = to_char(ADD_MONTHS(sysdate,-1),'YYYYMM')
	AND	MMSC_PREPAID = 'N'
GROUP BY
	AC_NAME,
	AC_TPID,
	MMSC_SHORTID,
	MMSC_CDRRECTYPE,
	MMSC_PREPAID;


--
-- SR061A_DETAILS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR061A_DETAILS
(CON_SHORTCODE1, CON_SNAME, AC_NAME, CON_NAME, CON_CODE, 
 CON_ACID, CON_ID)
BEQUEATH DEFINER
AS 
SELECT
 CON_SHORTID,
 NULL CON_SERVICE,
 AC_NAME,
 CON_NAME,
 CON_ESTID,
 CON_ACID,
 CON_ID
FROM
 CONTRACT,
 ACCOUNT
WHERE
  CONTRACT.CON_ACID = ACCOUNT.AC_ID
 AND CON_SRCTYPE IN ('ISRV')
 AND CON_ESID IN ('A')
 AND CON_ETID IN ('IPC')
 AND CON_SHORTID <> '0'
ORDER BY
 to_number(CON_SHORTID),
 AC_NAME,
 CON_NAME,
 CON_ESTID;


--
-- SR071A_DETAILS_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR071A_DETAILS_1
(AC_NAME, CON_NAME, ISC_SERVICE, CDRS_POST, CDRS_PRE, 
 CDRS_TOTAL, AMOUNTCU_POST, AMOUNTCU_PRE, AMOUNTCU_TOTAL, SHAREPV_POST, 
 SHAREPV_PRE, SHAREPV_TOTAL, SHAREMO_POST, SHAREMO_PRE, SHAREMO_TOTAL)
BEQUEATH DEFINER
AS 
SELECT
 AC_NAME,
 CON_NAME,
 ISC_SERVICE,
 SUM(DECODE(ISC_PREPAID,'N',ISC_COUNT,0)) CDRs_Post,
 SUM(DECODE(ISC_PREPAID,'Y',ISC_COUNT,0)) CDRs_Pre,
 SUM(ISC_COUNT) CDRs_Total,

 SUM(DECODE(ISC_PREPAID,'N',ISC_AMOUNTCU,0)) AmountCu_Post,
 SUM(DECODE(ISC_PREPAID,'Y',ISC_AMOUNTCU,0)) AmountCu_Pre,
 SUM(ISC_AMOUNTCU) AmountCu_Total,

 SUM(DECODE(ISC_PREPAID,'N',ISC_RETSHAREPV,0)) SharePv_Post,
 SUM(DECODE(ISC_PREPAID,'Y',ISC_RETSHAREPV,0)) SharePv_Pre,
 SUM(ISC_RETSHAREPV) SharePv_Total,

 SUM(DECODE(ISC_PREPAID,'N',ISC_RETSHAREMO,0)) ShareMo_Post,
 SUM(DECODE(ISC_PREPAID,'Y',ISC_RETSHAREMO,0)) ShareMo_Pre,
 SUM(ISC_RETSHAREMO) ShareMo_Total

FROM
 ISCONSOL,
 CONTRACT,
 ACCOUNT
WHERE
  ISCONSOL.ISC_CONID = CONTRACT.CON_ID
 AND ACCOUNT.AC_ID = CONTRACT.CON_ACID
 AND CON_ESTID IN ('PTS')
 AND ISC_ESID = 'R'
 AND ISC_PRICE IS NOT NULL
 AND ISC_CDRTID = 'CTB-CO'
 AND ISC_SEPID = to_char(ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1),'YYYYMM')
GROUP BY
 ISC_SRCTYPE,
 AC_NAME,
 CON_NAME,
 ISC_SERVICE
ORDER BY
 ISC_SRCTYPE,
 AC_NAME,
 CON_NAME,
 ISC_SERVICE;


--
-- SR071A_DETAILS_2  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR071A_DETAILS_2
(AC_NAME, CON_NAME, ISC_SERVICE, ISC_BILLRATE, ISC_PRICE, 
 ISC_BILLTEXT, PAYMENT, CDRS, AMOUNTCU, SHAREPV, 
 SHAREMO)
BEQUEATH DEFINER
AS 
SELECT
 AC_NAME,
 CON_NAME,
 ISC_SERVICE,
 ISC_BILLRATE,
 ISC_PRICE,
 DECODE(ISC_BILLTEXT_AGR, 0, ISC_BILLTEXT,'not resolved'),
 DECODE(ISC_PREPAID,'Y','Prepaid','N','Postpaid') Payment,
 SUM(ISC_COUNT) CDRs,
 SUM(ISC_AMOUNTCU) AmountCU,
 SUM(ISC_RETSHAREPV) SharePV,
 SUM(ISC_RETSHAREMO) ShareMO
FROM
 ISCONSOL,
 CONTRACT,
 ACCOUNT
WHERE
  ISCONSOL.ISC_CONID = CONTRACT.CON_ID
 AND ACCOUNT.AC_ID = CONTRACT.CON_ACID
 AND CON_ESTID IN ( 'PTS')
 AND ISC_ESID = 'R'
 AND ISC_PRICE IS NOT NULL
 AND ISC_CDRTID = 'CTB-CO'
 AND ISC_SEPID = to_char(ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1),'YYYYMM')
GROUP BY
 AC_NAME,
 CON_NAME,
 ISC_SERVICE,
 ISC_BILLRATE,
 ISC_PRICE,
 DECODE(ISC_BILLTEXT_AGR, 0, ISC_BILLTEXT,'not resolved'),
 DECODE(ISC_PREPAID,'Y','Prepaid','N','Postpaid')
ORDER BY
 AC_NAME,
 CON_NAME,
 ISC_SERVICE,
 ISC_BILLRATE,
 ISC_PRICE,
 DECODE(ISC_BILLTEXT_AGR, 0, ISC_BILLTEXT,'not resolved'),
 DECODE(ISC_PREPAID,'Y','Prepaid','N','Postpaid');


--
-- SR073A_BASE  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR073A_BASE
(AC_NAME, ISC_SHORTID, ISC_BILLRATE, ISC_KEYWORD, ISC_COUNT_MO, 
 ISC_COUNT_CO, PME_RATEDESC, PME_COMMENT, PME_KW_CHECK, PME_KW_REVIEW, 
 ISC_CONID, ISC_PMVID, ISC_BILLINGDOMAIN, ISC_CONSTYPE)
BEQUEATH DEFINER
AS 
SELECT
	AC_NAME,
	ISC_SHORTID,
	ISC_BILLRATE,
	NVL(UPPER(ISC_KEYWORD),'<empty>') ISC_KEYWORD,
	DECODE(ISC_CDRTID,'CTB-MO',ISC_COUNT,0) ISC_COUNT_MO,
	DECODE(ISC_CDRTID,'CTB-CO',ISC_COUNT,0) ISC_COUNT_CO,
	PME_RATEDESC,
	PME_COMMENT,
	PME_KW_CHECK,
	PME_KW_REVIEW,
	ISC_CONID,
	ISC_PMVID,
	ISC_BILLINGDOMAIN,
	ISC_CONSTYPE
FROM
	ISCONSOL,
	CONTRACT,
	ACCOUNT,
	PRMODELENTRY
WHERE
		ISCONSOL.ISC_CONID = CONTRACT.CON_ID
	AND	ACCOUNT.AC_ID = CONTRACT.CON_ACID
	AND	ISCONSOL.ISC_PMVID = PRMODELENTRY.PME_PMVID
	AND	ISCONSOL.ISC_BILLRATE = PRMODELENTRY.PME_BILLRATE
	AND	ISC_SEPID = TO_CHAR(ADD_MONTHS(sysdate,-1),'YYYYMM')
	AND	ISC_ESID = 'R'
	AND	ISC_PMVID IS NOT NULL
	AND	ISC_BILLRATE IS NOT NULL
UNION ALL
SELECT
	AC_NAME,
	ISC_SHORTID,
	ISC_BILLRATE,
	NVL(UPPER(ISC_KEYWORD),'<empty>'),
	DECODE(ISC_CDRTID,'CTB-MO',ISC_COUNT,0) ISC_COUNT_MO,
	DECODE(ISC_CDRTID,'CTB-CO',ISC_COUNT,0) ISC_COUNT_CO,
	NULL,
	NULL,
	NULL,
	NULL,
	ISC_CONID,
	ISC_PMVID,
	ISC_BILLINGDOMAIN,
	ISC_CONSTYPE
FROM
	ISCONSOL,
	CONTRACT,
	ACCOUNT
WHERE
		ISCONSOL.ISC_CONID = CONTRACT.CON_ID
	AND	ACCOUNT.AC_ID = CONTRACT.CON_ACID
	AND	ISC_SEPID = TO_CHAR(ADD_MONTHS(sysdate,-1),'YYYYMM')
	AND	ISC_ESID = 'R'
	AND	(ISC_PMVID IS NULL OR ISC_BILLRATE IS NULL);


--
-- SR073A_DETAILS_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR073A_DETAILS_1
(AC_NAME, ISC_SHORTID, ISC_BILLRATE, ISC_KEYWORD, COUNT_MO, 
 COUNT_MT, PME_RATEDESC, PME_COMMENT, PME_KW_CHECK, PME_KW_REVIEW, 
 ISC_CONID, ISC_PMVID, ISC_BILLINGDOMAIN, ISC_CONSTYPE)
BEQUEATH DEFINER
AS 
SELECT
	AC_NAME,
	ISC_SHORTID,
	ISC_BILLRATE,
	ISC_KEYWORD,
	SUM(ISC_COUNT_MO) COUNT_MO,
	SUM(ISC_COUNT_CO) COUNT_MT,
	PME_RATEDESC,
	PME_COMMENT,
	PME_KW_CHECK,
	PME_KW_REVIEW,
	ISC_CONID,
	ISC_PMVID,
	ISC_BILLINGDOMAIN,
	ISC_CONSTYPE
FROM
	SR073A_BASE
WHERE
	ISC_CONSTYPE IN ('BN','MVP')
GROUP BY
	AC_NAME,
	ISC_SHORTID,
	ISC_BILLRATE,
	ISC_KEYWORD,
	PME_RATEDESC,
	PME_COMMENT,
	PME_KW_CHECK,
	PME_KW_REVIEW,
	ISC_CONID,
	ISC_PMVID,
	ISC_BILLINGDOMAIN,
	ISC_CONSTYPE
ORDER BY
	AC_NAME,
	ISC_SHORTID,
	ISC_BILLRATE,
	ISC_KEYWORD,
	PME_RATEDESC,
	PME_COMMENT,
	PME_KW_CHECK,
	PME_KW_REVIEW,
	ISC_CONID,
	ISC_PMVID,
	ISC_BILLINGDOMAIN,
	ISC_CONSTYPE;


--
-- SR073A_DETAILS_2  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR073A_DETAILS_2
(AC_NAME, ISC_SHORTID, ISC_BILLRATE, ISC_KEYWORD, COUNT_MO, 
 COUNT_MT, PME_RATEDESC, PME_COMMENT, PME_KW_CHECK, PME_KW_REVIEW, 
 ISC_CONID, ISC_PMVID, ISC_BILLINGDOMAIN, ISC_CONSTYPE)
BEQUEATH DEFINER
AS 
SELECT
	AC_NAME,
	ISC_SHORTID,
	ISC_BILLRATE,
	ISC_KEYWORD,
	SUM(ISC_COUNT_MO) COUNT_MO,
	SUM(ISC_COUNT_CO) COUNT_MT,
	PME_RATEDESC,
	PME_COMMENT,
	PME_KW_CHECK,
	PME_KW_REVIEW,
	ISC_CONID,
	ISC_PMVID,
	ISC_BILLINGDOMAIN,
	ISC_CONSTYPE
FROM
	SR073A_BASE
WHERE
	ISC_CONSTYPE = 'PTS'
GROUP BY
	AC_NAME,
	ISC_SHORTID,
	ISC_BILLRATE,
	ISC_KEYWORD,
	PME_RATEDESC,
	PME_COMMENT,
	PME_KW_CHECK,
	PME_KW_REVIEW,
	ISC_CONID,
	ISC_PMVID,
	ISC_BILLINGDOMAIN,
	ISC_CONSTYPE
ORDER BY
	AC_NAME,
	ISC_SHORTID,
	ISC_BILLRATE,
	ISC_KEYWORD,
	PME_RATEDESC,
	PME_COMMENT,
	PME_KW_CHECK,
	PME_KW_REVIEW,
	ISC_CONID,
	ISC_PMVID,
	ISC_BILLINGDOMAIN,
	ISC_CONSTYPE;


--
-- SR074A_DETAILS_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR074A_DETAILS_1
(ADR_COUNTRY, AC_NAME, CON_OPKEY, MMS_COUNT)
BEQUEATH DEFINER
AS 
SELECT
  ADR_COUNTRY,
  ATO.AC_NAME,
  CTO.CON_OPKEY,
  SUM(MMSC_COUNT)
FROM
  MMSCONSOLIDATION,
  CONTRACT CTO,
  ACCOUNT ATO,
  ADDRESS
WHERE
    MMSCONSOLIDATION.MMSC_TOCID = CTO.CON_ID
  AND ATO.AC_ID = CTO.CON_ACID
  AND ADDRESS.ADR_ID = ATO.AC_ADRID_MAIN
  AND MMSC_SEPID = TO_CHAR(ADD_MONTHS(SYSDATE,-1),'YYYYMM')
  AND MMSC_ESID = 'R'
  AND MMSC_CDRRECTYPE = 'MM4Rrecord'
  AND MMSC_EVENTDISP = 1
  AND MMSC_MSGTYPE = 0
  AND MMSC_IW = '1'
  AND MMSC_ETID IN ('MMSC-RAW')
  AND MMSC_TOCID Is Not NULL
  AND MMSC_SHORTID Is NULL
GROUP BY
  ADR_COUNTRY,
  ATO.AC_NAME,
  CTO.CON_OPKEY
ORDER BY
  ADR_COUNTRY,
  ATO.AC_NAME,
  CTO.CON_OPKEY;


--
-- SR074A_DETAILS_2  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR074A_DETAILS_2
(ADR_COUNTRY, AC_NAME, CON_OPKEY, MMS_COUNT, MMS_IOT, 
 MMS_IOT_INTERNAL)
BEQUEATH DEFINER
AS 
SELECT
  ADR_COUNTRY,
  ATO.AC_NAME,
  CTO.CON_OPKEY,
  SUM(MMSC_COUNT),
  SUM(MMSC_IOT),
  CASE 
    WHEN (SUM(MMSC_IOT_INTERNAL) is NULL) and (SUM(MMSC_IOT) is NULL)  THEN NULL
    ELSE  NVL(SUM(MMSC_IOT_INTERNAL),0.0) - NVL(SUM(MMSC_IOT),0.0)
  END
FROM
  MMSCONSOLIDATION,
  CONTRACT CTO,
  ACCOUNT ATO,
  ADDRESS
WHERE
    MMSCONSOLIDATION.MMSC_TOCID = CTO.CON_ID
  AND ATO.AC_ID = CTO.CON_ACID
  AND ADDRESS.ADR_ID = ATO.AC_ADRID_MAIN
  AND MMSC_SEPID = TO_CHAR(ADD_MONTHS(SYSDATE,-1),'YYYYMM')
  AND MMSC_ESID = 'R'
  AND MMSC_CDRRECTYPE = 'MM4Rrecord'
  AND MMSC_EVENTDISP = 1
  AND MMSC_MSGTYPE = 0
  AND MMSC_IW = '1'
  AND MMSC_ETID IN ('MMSC-RAW')
  AND MMSC_TOCID Is Not NULL
  AND MMSC_SHORTID Is Not NULL
GROUP BY
  ADR_COUNTRY,
  ATO.AC_NAME,
  CTO.CON_OPKEY
ORDER BY
  ADR_COUNTRY,
  ATO.AC_NAME,
  CTO.CON_OPKEY;


--
-- SR074A_DETAILS_3  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR074A_DETAILS_3
(AC_NAME, ROC_CONSOLIDATION, CON_PSCALL, ADR_COUNTRY, AC_NAMETO, 
 CON_OPKEY, MMS_COUNT, MMS_IOT, MMS_IOT_INTERNAL)
BEQUEATH DEFINER
AS 
SELECT
  ALA.AC_NAME,
  MMSC_SHORTID,
  CLA.CON_PSCALL,
  ADR_COUNTRY,
  ATO.AC_NAME,
  CTO.CON_OPKEY,
  SUM(MMSC_COUNT),
  SUM(MMSC_IOT),
  CASE 
    WHEN (SUM(MMSC_IOT_INTERNAL) is NULL) and (SUM(MMSC_IOT) is NULL)  THEN NULL
    ELSE  NVL(SUM(MMSC_IOT_INTERNAL),0.0) - NVL(SUM(MMSC_IOT),0.0)
  END
FROM
  MMSCONSOLIDATION,
  CONTRACT CLA,
  CONTRACT CTO,
  ACCOUNT ALA,
  ACCOUNT ATO,
  ADDRESS
WHERE
    MMSCONSOLIDATION.MMSC_CONID = CLA.CON_ID
  AND MMSCONSOLIDATION.MMSC_TOCID = CTO.CON_ID
  AND ALA.AC_ID = CLA.CON_ACID
  AND ATO.AC_ID = CTO.CON_ACID
  AND ADDRESS.ADR_ID = ATO.AC_ADRID_MAIN
  AND MMSC_SEPID = TO_CHAR(ADD_MONTHS(SYSDATE,-1),'YYYYMM')
  AND MMSC_ESID = 'R'
  AND MMSC_CDRRECTYPE = 'MM4Rrecord'
  AND MMSC_EVENTDISP = 1
  AND MMSC_MSGTYPE = 0
  AND MMSC_IW = '1'
  AND MMSC_ETID IN ('MMSC-RAW')
  AND MMSC_TOCID Is Not NULL
  AND MMSC_SHORTID Is Not NULL
GROUP BY
  ALA.AC_NAME,
  MMSC_SHORTID,
  CLA.CON_PSCALL,
  ADR_COUNTRY,
  ATO.AC_NAME,
  CTO.CON_OPKEY
ORDER BY
  ALA.AC_NAME,
  to_number(MMSC_SHORTID),
  CLA.CON_PSCALL,
  ADR_COUNTRY,
  ATO.AC_NAME,
  CTO.CON_OPKEY;


--
-- SR089A_BASE_SCO  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR089A_BASE_SCO
(ROC_SEPID, CAR_COUNTRY, CAR_OPNAME, CON_OPKEY, CON_CODE, 
 ROC_COUNT_SCO, ROC_COUNT_SCT)
BEQUEATH DEFINER
AS 
SELECT
    ROC_SEPID,
    CAR_COUNTRY,
    CAR_OPNAME,
    CON_OPKEY,
    CON_CODE,
    ROC_COUNT,
    0
FROM
    ROCONSOLIDATION,
    CONTRACT,
    CARRIER
WHERE
    ROCONSOLIDATION.ROC_TOCID = CONTRACT.CON_ID
AND CONTRACT.CON_OPKEY = CARRIER.CAR_ID
AND ROC_SEPID = to_char(ADD_MONTHS(sysdate,-1),'YYYYMM')
AND ROC_ETID NOT IN ('SMS-HR','SMS-EXT','PAGER-EXT')
AND ROC_ESID = 'R'
AND ROC_STATUS = 0
AND ROC_IW = 1;


--
-- SR097A_USERS_ALL  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR097A_USERS_ALL
(ADDRESSTYPE, LANGUAGE, AC_ID, NAME, COMPANY, 
 STREET1, STREET2, STREET3, ZIP, TOWN, 
 COUNTRY, EMAIL)
BEQUEATH DEFINER
AS 
SELECT
    ACT_LANG01,
    AC_LANGID,
    AC_ID,
    AC_NAME,
    ADR_COMPANY,
    ADR_STREET1,
    ADR_STREET2,
    ADR_STREET3,
    ADR_ZIP,
    ADR_TOWN,
    ADR_COUNTRY,
    ADR_EMAIL
FROM    ACCOUNT,ACTYPE,ADDRESS
WHERE   ACCOUNT.AC_ETID = ACTYPE.ACT_ID
AND ACCOUNT.AC_ADRID_MAIN = ADDRESS.ADR_ID
AND AC_ETID Not In ('LA','IP','SYSTEM','TOP')
AND AC_ESID = 'A'
ORDER BY 1,2,4;


--
-- SR111A_BASE_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR111A_BASE_1
(ENUM_ID, DATE_PERIOD, DATE_DAYS, COUNT_LAC, COUNT_MLC, 
 COUNT_IPC, COUNT_TOC, COUNT_ALL)
BEQUEATH DEFINER
AS 
select
    ENUM_ID
    ,
    DATE_PERIOD
    ,
    DATE_DAYS
    ,
    SUM(DECODE(CON_ETID,'LAC',1,0))
    ,
    SUM(DECODE(CON_ETID,'MLC',1,0))
    ,
    SUM(DECODE(CON_ETID,'IPC',1,0))
    ,
    SUM(DECODE(CON_ETID,'TOC',1,0))
    ,
    SUM(1)
from CONTRACT,SR111A_PERIOD
where CON_ESID NOT in ('D','R')
and NVL ( CON_DATESTART , DATE_FROM ) <= DATE_UNTIL
and NVL ( CON_DATEEND , DATE_UNTIL ) >= DATE_FROM
group by ENUM_ID, DATE_PERIOD, DATE_DAYS, CON_ETID;


--
-- SR111A_BASE_12  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR111A_BASE_12
(ENUM_ID, DATE_PERIOD, DATE_DAYS, IH_TYPES, IH_MAPPINGS, 
 IC1_TYPES, IC1_MAPPINGS, IC2_TYPES, IC2_MAPPINGS)
BEQUEATH DEFINER
AS 
select
    ENUM_ID
    ,
    DATE_PERIOD
    ,
    DATE_DAYS
    ,
    COUNT(DISTINCT HIH_SRCTYPE), COUNT(DISTINCT HIH_MAPID)
    ,
    0,0
    ,
    0,0
from    SBS0_ADMIN.HIHEADER, SR111A_PERIOD
where   HIH_DATETIME >= DATE_FROM
and     HIH_DATETIME  < DATE_UNTIL
and     HIH_ESID in ('RDY','ERR')
group by ENUM_ID, DATE_PERIOD, DATE_DAYS

UNION ALL

select
    ENUM_ID
    ,
    DATE_PERIOD
    ,
    DATE_DAYS
    ,
    0,0
    ,
    COUNT(DISTINCT BIH_SRCTYPE), COUNT(DISTINCT BIH_MAPID)
    ,
    0,0
from    BIHEADER, SR111A_PERIOD
where   BIH_DATETIME >= DATE_FROM
and     BIH_DATETIME  < DATE_UNTIL
and     BIH_ESID in ('RDY','ERR')
group by ENUM_ID, DATE_PERIOD, DATE_DAYS

UNION ALL

select
    ENUM_ID
    ,
    DATE_PERIOD
    ,
    DATE_DAYS
    ,
    0,0
    ,
    0,0
    ,
    COUNT(DISTINCT BIH_SRCTYPE), COUNT(DISTINCT BIH_MAPID)
from    SBS2_ADMIN.BIHEADER, SR111A_PERIOD
where   BIH_DATETIME >= DATE_FROM
and     BIH_DATETIME  < DATE_UNTIL
and     BIH_ESID in ('RDY','ERR')
group by ENUM_ID, DATE_PERIOD, DATE_DAYS;


--
-- SR111A_BASE_2  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR111A_BASE_2
(ENUM_ID, DATE_PERIOD, AC_ID, CON_TYPE, PAID)
BEQUEATH DEFINER
AS 
select
    ENUM_ID
    ,
    DATE_PERIOD
    ,
    CON_ACID
    ,
    'LAC'
    ,
    'REV'
from CONTRACT,SR111A_PERIOD
where CON_ESID NOT in ('D','R')
and CON_ETID IN ('LAC')
and CON_TARID NOT IN ('S','P','X','V')
and NVL ( CON_DATESTART , DATE_FROM ) <= DATE_UNTIL
and NVL ( CON_DATEEND , DATE_UNTIL ) >= DATE_FROM

UNION ALL

select
    ENUM_ID
    ,
    DATE_PERIOD
    ,
    CON_ACID
    ,
    'LAC'
    ,
    'NOR'
from CONTRACT,SR111A_PERIOD
where CON_ESID NOT in ('D','R')
and CON_ETID IN ('LAC')
and CON_TARID IN ('S','P','X','V')
and NVL ( CON_DATESTART , DATE_FROM ) <= DATE_UNTIL
and NVL ( CON_DATEEND , DATE_UNTIL ) >= DATE_FROM

UNION ALL

select
    ENUM_ID
    ,
    DATE_PERIOD
    ,
    CON_ACID
    ,
    'MLC'
    ,
    'REV'
from CONTRACT,SR111A_PERIOD
where CON_ESID NOT in ('D','R')
and CON_ETID IN ('MLC')
and CON_TARID >= '1' and CON_TARID <= '9'
and NVL ( CON_DATESTART , DATE_FROM ) <= DATE_UNTIL
and NVL ( CON_DATEEND , DATE_UNTIL ) >= DATE_FROM

UNION ALL

select
    ENUM_ID
    ,
    DATE_PERIOD
    ,
    CON_ACID
    ,
    'MLC'
    ,
    'NOR'
from CONTRACT,SR111A_PERIOD
where CON_ESID NOT in ('D','R')
and CON_ETID IN ('MLC')
and (CON_TARID < '1' or CON_TARID > '9')
and NVL ( CON_DATESTART , DATE_FROM ) <= DATE_UNTIL
and NVL ( CON_DATEEND , DATE_UNTIL ) >= DATE_FROM

UNION ALL

select
    ENUM_ID
    ,
    DATE_PERIOD
    ,
    CON_ACID
    ,
    'IPC'
    ,
    'REV'
from CONTRACT,SR111A_PERIOD
where CON_ESID NOT in ('D','R')
and CON_ETID IN ('IPC')
and CON_PMID not in('0608833662','0746027557')
and NVL ( CON_DATESTART , DATE_FROM ) <= DATE_UNTIL
and NVL ( CON_DATEEND , DATE_UNTIL ) >= DATE_FROM

UNION ALL

select
    ENUM_ID
    ,
    DATE_PERIOD
    ,
    CON_ACID
    ,
    'IPC'
    ,
    'NOR'
from CONTRACT,SR111A_PERIOD
where CON_ESID NOT in ('D','R')
and CON_ETID IN ('IPC')
and CON_PMID in('0608833662','0746027557')
and NVL ( CON_DATESTART , DATE_FROM ) <= DATE_UNTIL
and NVL ( CON_DATEEND , DATE_UNTIL ) >= DATE_FROM;


--
-- SR111A_BASE_2_  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR111A_BASE_2_
(ENUM_ID, DATE_PERIOD, COUNT_LA_REV, COUNT_LA_NOR, COUNT_MLA_REV, 
 COUNT_MLA_NOR, COUNT_IP_REV, COUNT_IP_NOR, COUNT_TPAC_REV, COUNT_TPAC_NOR)
BEQUEATH DEFINER
AS 
select
    ENUM_ID
    ,
    DATE_PERIOD
    ,
    COUNT(DISTINCT AC_ID)   as COUNT_LA_REV
    ,
    0
    ,
    0
    ,
    0
    ,
    0
    ,
    0
    ,
    0
    ,
    0

from SR111A_BASE_2
where CON_TYPE = 'LAC'
and PAID = 'REV'
group by ENUM_ID, DATE_PERIOD

UNION ALL

select
    ENUM_ID
    ,
    DATE_PERIOD
    ,
    0
    ,
    COUNT(DISTINCT AC_ID)   as COUNT_LA_NOR
    ,
    0
    ,
    0
    ,
    0
    ,
    0
    ,
    0
    ,
    0

from SR111A_BASE_2
where CON_TYPE = 'LAC'
and PAID = 'NOR'
group by ENUM_ID, DATE_PERIOD

UNION ALL

select
    ENUM_ID
    ,
    DATE_PERIOD
    ,
    0
    ,
    0
    ,
    COUNT(DISTINCT AC_ID)   as COUNT_MLA_REV
    ,
    0
    ,
    0
    ,
    0
    ,
    0
    ,
    0

from SR111A_BASE_2
where CON_TYPE = 'MLC'
and PAID = 'REV'
group by ENUM_ID, DATE_PERIOD

UNION ALL

select
    ENUM_ID
    ,
    DATE_PERIOD
    ,
    0
    ,
    0
    ,
    0
    ,
    COUNT(DISTINCT AC_ID)   as COUNT_MLA_NOR
    ,
    0
    ,
    0
    ,
    0
    ,
    0

from SR111A_BASE_2
where CON_TYPE = 'MLC'
and PAID = 'NOR'
group by ENUM_ID, DATE_PERIOD

UNION ALL

select
    ENUM_ID
    ,
    DATE_PERIOD
    ,
    0
    ,
    0
    ,
    0
    ,
    0
    ,
    COUNT(DISTINCT AC_ID)   as COUNT_IP_REV
    ,
    0
    ,
    0
    ,
    0

from SR111A_BASE_2
where CON_TYPE = 'IPC'
and PAID = 'REV'
group by ENUM_ID, DATE_PERIOD

UNION ALL

select
    ENUM_ID
    ,
    DATE_PERIOD
    ,
    0
    ,
    0
    ,
    0
    ,
    0
    ,
    0
    ,
    COUNT(DISTINCT AC_ID)   as COUNT_IP_NOR
    ,
    0
    ,
    0

from SR111A_BASE_2
where CON_TYPE = 'IPC'
and PAID = 'NOR'
group by ENUM_ID, DATE_PERIOD

UNION ALL

select
    ENUM_ID
    ,
    DATE_PERIOD
    ,
    0
    ,
    0
    ,
    0
    ,
    0
    ,
    0
    ,
    0
    ,
    COUNT(DISTINCT AC_ID)   as COUNT_TPAC_REV
    ,
    0

from SR111A_BASE_2
where PAID = 'REV'
group by ENUM_ID, DATE_PERIOD

UNION ALL

select
    ENUM_ID
    ,
    DATE_PERIOD
    ,
    0
    ,
    0
    ,
    0
    ,
    0
    ,
    0
    ,
    0
    ,
    0
    ,
    COUNT(DISTINCT AC_ID)   as COUNT_TPAC_NOR

from SR111A_BASE_2
where PAID = 'NOR'
group by ENUM_ID, DATE_PERIOD;


--
-- SR111A_BASE_3  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR111A_BASE_3
(ENUM_ID, DATE_PERIOD, DATE_DAYS, COUNT_A2P, COUNT_P2A, 
 COUNT_P2P)
BEQUEATH DEFINER
AS 
select
    ENUM_ID
    ,
    DATE_PERIOD
    ,
    DATE_DAYS
    ,
    DECODE(ROC_CONID,NULL,0,ROC_COUNT)
    ,
    0
    ,
    DECODE(ROC_CONID,NULL,ROC_COUNT,0)
from ROCONSOLIDATION,SR111A_PERIOD
where   ROC_SEPID = to_char(DATE_FROM,'YYYYMM')
and     ROC_STATUS = '0'
and     ROC_ESID = 'R'

UNION ALL

select
    ENUM_ID
    ,
    DATE_PERIOD
    ,
    DATE_DAYS
    ,
    0
    ,
    BDC_COUNT
    ,
    0
from BDCONSOLIDATION,SR111A_PERIOD
where   BDC_SEPID = to_char(DATE_FROM,'YYYYMM')
and     BDC_NPI_A = '1'
and     BDC_PID_A = '0'
and     BDC_NPI_B <> '1'
and     BDC_ESID = 'R'
and     BDC_CONID is not null;


--
-- SR111A_BASE_4  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR111A_BASE_4
(ENUM_ID, DATE_PERIOD, DATE_DAYS, COUNT_A2P, COUNT_P2A, 
 COUNT_P2P)
BEQUEATH DEFINER
AS 
select
    ENUM_ID
    ,
    DATE_PERIOD
    ,
    DATE_DAYS
    ,
    case
        when MMSC_CONID IS NULL then 0
        when MMSC_CDRRECTYPE = 'MM4Rrecord' then MMSC_COUNT
        when MMSC_CDRRECTYPE = 'MMSRrecord' then MMSC_COUNT
        when MMSC_CDRRECTYPE = 'MM3Rrecord' then MMSC_COUNT
        else 0
    end
    ,
    case
        when MMSC_CONID IS NULL then 0
        when MMSC_CDRRECTYPE = 'MM7Rrecord' then MMSC_COUNT
        else 0
    end
    ,
    case
        when MMSC_CONID IS NOT NULL then 0
        when MMSC_CDRRECTYPE = 'MM4Rrecord' then MMSC_COUNT
        when MMSC_CDRRECTYPE = 'MMSRrecord' then MMSC_COUNT
        when MMSC_CDRRECTYPE = 'MM3Rrecord' then MMSC_COUNT
        else 0
    end
from    MMSCONSOLIDATION, SR111A_PERIOD
where   MMSC_SEPID = to_char(DATE_FROM,'YYYYMM')
and     MMSC_MSGTYPE = 0
and     MMSC_ESID = 'R'
and     MMSC_EVENTDISP = 1
and     MMSC_CDRRECTYPE like 'MM_Rrecord';


--
-- SR111A_BASE_7  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR111A_BASE_7
(DATE_DAY, COUNT_CON)
BEQUEATH DEFINER
AS 
SELECT DATE_DAY, COUNT(*)
FROM
( select
    TRUNC(CON_DATECRE) as DATE_DAY
    ,
    CON_ID
from    CONTRACT 
where   CON_DATECRE >= ADD_MONTHS(TRUNC(SYSDATE ,'MONTH'),-13)
and     CON_DATECRE < TRUNC(SYSDATE ,'MONTH')
and     CON_ETID IN ('IPC','LAC','MLC')

UNION

select
    TRUNC(CON_DATEMOD)  as DATE_DAY
    ,
    CON_ID
from    CONTRACT
where   CON_DATEMOD >= ADD_MONTHS(TRUNC(SYSDATE ,'MONTH'),-13)
and     CON_DATEMOD < TRUNC(SYSDATE ,'MONTH')
and     CON_ETID IN ('IPC','LAC','MLC')
)
group by DATE_DAY;


--
-- SR111A_DETAILS_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR111A_DETAILS_1
(ENUM_ID, DATE_PERIOD, DATE_DAYS, COUNT_LAC, COUNT_MLC, 
 COUNT_IPC, COUNT_TOC, COUNT_ALL)
BEQUEATH DEFINER
AS 
select
    ENUM_ID
    ,
    DATE_PERIOD
    ,
    DATE_DAYS
    ,
      SUM ( COUNT_LAC ) as COUNT_LAC
    ,
      SUM ( COUNT_MLC ) as COUNT_MLC
    ,
      SUM ( COUNT_IPC ) as COUNT_IPC
    ,
      SUM ( COUNT_TOC ) as COUNT_TOC
    ,
      SUM ( COUNT_ALL ) as COUNT_ALL
  from SR111A_BASE_1
  group by ENUM_ID, DATE_PERIOD, DATE_DAYS
  order by 1 asc;


--
-- SR111A_DETAILS_12  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR111A_DETAILS_12
(ENUM_ID, DATE_PERIOD, DATE_DAYS, IH_TYPES, IH_MAPPINGS, 
 IC1_TYPES, IC1_MAPPINGS, IC2_TYPES, IC2_MAPPINGS)
BEQUEATH DEFINER
AS 
select
    ENUM_ID, DATE_PERIOD, DATE_DAYS,
    SUM(IH_TYPES)
    ,
    SUM(IH_MAPPINGS)
    ,
    SUM(IC1_TYPES)
    ,
    SUM(IC1_MAPPINGS)
    ,
    SUM(IC2_TYPES)
    ,
    SUM(IC2_MAPPINGS)
    
from   SR111A_BASE_12
group by ENUM_ID, DATE_PERIOD, DATE_DAYS

order by 1;


--
-- SR111A_DETAILS_2  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR111A_DETAILS_2
(ENUM_ID, DATE_PERIOD, COUNT_LA_REV, COUNT_LA_NOR, COUNT_MLA_REV, 
 COUNT_MLA_NOR, COUNT_IP_REV, COUNT_IP_NOR, COUNT_TPAC_REV, COUNT_TPAC_NOR)
BEQUEATH DEFINER
AS 
select
      ENUM_ID
    , DATE_PERIOD
    , SUM(COUNT_LA_REV)
    , SUM(COUNT_LA_NOR)
    , SUM(COUNT_MLA_REV)
    , SUM(COUNT_MLA_NOR)
    , SUM(COUNT_IP_REV)
    , SUM(COUNT_IP_NOR)
    , SUM(COUNT_TPAC_REV)
    , SUM(COUNT_TPAC_NOR)

from SR111A_BASE_2_
group by ENUM_ID, DATE_PERIOD
order by 1;


--
-- SR111A_DETAILS_3  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR111A_DETAILS_3
(ENUM_ID, DATE_PERIOD, DATE_DAYS, COUNT_A2P, COUNT_P2A, 
 COUNT_P2P, COUNT_ALL)
BEQUEATH DEFINER
AS 
select
    ENUM_ID
    ,
    DATE_PERIOD
    ,
    DATE_DAYS
    ,
    30 * SUM(COUNT_A2P) / DATE_DAYS
    ,
    30 * SUM(COUNT_P2A) / DATE_DAYS
    ,
    30 * SUM(COUNT_P2P) / DATE_DAYS
    ,
    30 * (SUM(COUNT_A2P)+ SUM(COUNT_P2A) + SUM(COUNT_P2P)) / DATE_DAYS

from SR111A_BASE_3
group by ENUM_ID, DATE_PERIOD, DATE_DAYS
order by 1;


--
-- SR111A_DETAILS_4  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR111A_DETAILS_4
(ENUM_ID, DATE_PERIOD, DATE_DAYS, COUNT_A2P, COUNT_P2A, 
 COUNT_P2P, COUNT_ALL)
BEQUEATH DEFINER
AS 
select
    ENUM_ID
    ,
    DATE_PERIOD
    ,
    DATE_DAYS
    ,
    30 * SUM(COUNT_A2P) / DATE_DAYS
    ,
    30 * SUM(COUNT_P2A) / DATE_DAYS
    ,
    30 * SUM(COUNT_P2P) / DATE_DAYS
    ,
    30 * (SUM(COUNT_A2P)+ SUM(COUNT_P2A) + SUM(COUNT_P2P)) / DATE_DAYS

from SR111A_BASE_4
group by ENUM_ID, DATE_PERIOD, DATE_DAYS
order by 1;


--
-- SR111A_DETAILS_7  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR111A_DETAILS_7
(ENUM_ID, DATE_PERIOD, DATE_DAYS, COUNT_MONTH, COUNT_DAY, 
 COUNT_MIN, COUNT_MAX)
BEQUEATH DEFINER
AS 
select
    ENUM_ID
    ,
    DATE_PERIOD
    ,
    DATE_DAYS
    ,
    SUM(COUNT_CON)
    ,
    SUM(COUNT_CON) / DATE_DAYS
    ,
    0
    ,
    MAX(COUNT_CON)

from    SR111A_BASE_7, SR111A_PERIOD
where   DATE_DAY >= DATE_FROM
and     DATE_DAY < DATE_UNTIL
group by ENUM_ID, DATE_PERIOD, DATE_DAYS
order by 1;


--
-- SR112A_DETAILS_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR112A_DETAILS_1
(THIRD_PARTY_NAME, SHORT_ID, MSG_TOTAL, MSG_BPARTY, MSG_APARTY, 
 MSG_PCT, CHF_TOTAL, CHF_BPARTY, CHF_APARTY, CHF_PCT)
BEQUEATH DEFINER
AS 
SELECT
      AC_NAME                                                                   -- THIRD_PARTY_NAME
    , ISC_SHORTID                                                               -- SHORT_ID
    , SUM(ISC_COUNT)                                                            -- MSG_TOTAL
    , SUM(DECODE(ISC_REQTYPE,'7',0,'105',0, ISC_COUNT))                         -- MSG_BPARTY
    , SUM(DECODE(ISC_REQTYPE,'7',ISC_COUNT,'105',ISC_COUNT, 0))                 -- MSG_APARTY
    , 0.00                                                                      -- MSG_PCT
    , SUM(ISC_AMOUNTCU)                                                         -- CHF_TOTAL
    , SUM(DECODE(ISC_REQTYPE,'7',0,'105',0, ISC_AMOUNTCU))                      -- CHF_BPARTY
    , SUM(DECODE(ISC_REQTYPE,'7',ISC_AMOUNTCU,'105',ISC_AMOUNTCU, 0))           -- CHF_APARTY
    , 0.00                                                                      -- CHF_PCT
FROM
 ISCONSOL,
 CONTRACT,
 ACCOUNT
WHERE
  ISCONSOL.ISC_CONID = CONTRACT.CON_ID
 AND ACCOUNT.AC_ID = CONTRACT.CON_ACID
 AND CON_ESTID = 'BN'
 AND ISC_ESID = 'R'
 AND ISC_PRICE IS NOT NULL
 AND ISC_CDRTID = 'CTB-CO'
 AND ISC_SEPID = to_char(ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1),'YYYYMM')
GROUP BY AC_NAME, ISC_SHORTID
ORDER BY AC_NAME, ISC_SHORTID;


--
-- SR112A_DETAILS_2  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR112A_DETAILS_2
(THIRD_PARTY_NAME, SHORT_ID, MSG_TOTAL, MSG_BPARTY, MSG_APARTY, 
 MSG_PCT, CHF_TOTAL, CHF_BPARTY, CHF_APARTY, CHF_PCT)
BEQUEATH DEFINER
AS 
SELECT
      AC_NAME                                                                   -- THIRD_PARTY_NAME
    , ISC_SHORTID                                                               -- SHORT_ID
    , SUM(ISC_COUNT)                                                            -- MSG_TOTAL
    , SUM(DECODE(ISC_REQTYPE,'7',0,'105',0, ISC_COUNT))                         -- MSG_BPARTY
    , SUM(DECODE(ISC_REQTYPE,'7',ISC_COUNT,'105',ISC_COUNT, 0))                 -- MSG_APARTY
    , 0.00                                                                      -- MSG_PCT
    , SUM(ISC_AMOUNTCU)                                                         -- CHF_TOTAL
    , SUM(DECODE(ISC_REQTYPE,'7',0,'105',0, ISC_AMOUNTCU))                      -- CHF_BPARTY
    , SUM(DECODE(ISC_REQTYPE,'7',ISC_AMOUNTCU,'105',ISC_AMOUNTCU, 0))           -- CHF_APARTY
    , 0.00                                                                      -- CHF_PCT
FROM
 ISCONSOL,
 CONTRACT,
 ACCOUNT
WHERE
  ISCONSOL.ISC_CONID = CONTRACT.CON_ID
 AND ACCOUNT.AC_ID = CONTRACT.CON_ACID
 AND CON_ESTID = 'PTS'
 AND ISC_ESID = 'R'
 AND ISC_PRICE IS NOT NULL
 AND ISC_CDRTID = 'CTB-CO'
 AND ISC_SEPID = to_char(ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1),'YYYYMM')
GROUP BY AC_NAME, ISC_SHORTID
ORDER BY AC_NAME, ISC_SHORTID;


--
-- SR116A_BASE  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR116A_BASE
(ROC_SEPID, LAC_SHORTID, LAC_TARID, LAC_ACID, LAC_CONID, 
 TOC_ACID, TOC_CONID, ROC_FROMDATE, ROC_TODATE, ROC_COUNT, 
 ROC_IOT_INTERNAL, ROC_IOT)
BEQUEATH DEFINER
AS 
select
    ROC_SEPID
    ,
    ROC_CONSOLIDATION LAC_SHORTID
    ,
    LAC.CON_TARID LAC_TARID
    ,
    LAC.CON_ACID LAC_ACID
    ,
    ROC_CONID LAC_CONID
    ,
    TOC.CON_ACID TOC_ACID
    ,
    ROC_TOCID TOC_CONID
    ,
    ROC_FROMDATE
    ,
    ROC_TODATE
    ,
    ROC_COUNT
    ,
    ROC_IOT_INTERNAL
    ,
    ROC_IOT
  from
    ROCONSOLIDATION
    ,
    CONTRACT LAC
    ,
    CONTRACT TOC
  where
    LAC.CON_ID = ROC_CONID 
    and
    TOC.CON_ID = ROC_TOCID 
    and
    ROC_IW = '1' 
    and
    ROC_ESID = 'R' 
    and
    ROC_SEPID = to_char(add_months(sysdate,-1),'YYYYMM') 
    and
        NVL(ROC_IOT,0) 
      <>
        NVL(ROC_IOT_INTERNAL,0);


--
-- SR116A_DETAILS_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR116A_DETAILS_1
(LAC_NAME, LAC_TARID, ROC_FROMDATE, ROC_TODATE, ROC_COUNT, 
 ROC_IOT_INTERNAL, ROC_IOT, ROC_IOT_DIFF)
BEQUEATH DEFINER
AS 
select
    LAC.AC_NAME LAC_NAME
    ,
    LAC_TARID
    ,
      MIN(ROC_FROMDATE ) ROC_FROMDATE
    ,
      MAX(ROC_TODATE ) ROC_TODATE 
    ,
      SUM(ROC_COUNT ) ROC_COUNT 
    ,
      SUM(ROC_IOT_INTERNAL ) ROC_IOT_INTERNAL 
    ,
      SUM(ROC_IOT ) ROC_IOT
    ,
      SUM
        (
            ROC_IOT 
            - 
            ROC_IOT_INTERNAL
        ) ROC_IOT_DIFF
  from
    SR116A_BASE
    ,
    ACCOUNT LAC
  where LAC.AC_ID = LAC_ACID
  and LAC_TARID <> 'i'
  group by
    LAC_TARID
    ,
    LAC.AC_NAME
  order by 1,2,3;


--
-- SR116A_DETAILS_2  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR116A_DETAILS_2
(LAC_NAME, LAC_SHORTID, LAC_TARID, ROC_FROMDATE, ROC_TODATE, 
 ROC_COUNT, ROC_IOT_INTERNAL, ROC_IOT, ROC_IOT_DIFF)
BEQUEATH DEFINER
AS 
select
    LAC.AC_NAME LAC_NAME
    ,
    LAC_SHORTID
    ,
    LAC_TARID
    ,
      MIN(ROC_FROMDATE ) ROC_FROMDATE 
    ,
      MAX(ROC_TODATE ) ROC_TODATE 
    ,
      SUM(ROC_COUNT ) ROC_COUNT 
    ,
      SUM(ROC_IOT_INTERNAL ) ROC_IOT_INTERNAL 
    ,
      SUM(ROC_IOT ) ROC_IOT
    ,
      SUM
        (
            ROC_IOT 
            - 
            ROC_IOT_INTERNAL
        ) ROC_IOT_DIFF
  from
    SR116A_BASE
    ,
    ACCOUNT LAC
  where LAC.AC_ID = LAC_ACID
  and LAC_TARID <> 'i'
  group by
    LAC_SHORTID
    ,
    LAC_TARID
    ,
    LAC.AC_NAME
  order by 1,2,3;


--
-- SR116A_DETAILS_3  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR116A_DETAILS_3
(LAC_NAME, LAC_SHORTID, LAC_TARID, TOC_NAME, ROC_FROMDATE, 
 ROC_TODATE, ROC_COUNT, ROC_IOT_INTERNAL, ROC_IOT, ROC_IOT_DIFF)
BEQUEATH DEFINER
AS 
select
    LAC.AC_NAME LAC_NAME
    ,
    LAC_SHORTID
    ,
    LAC_TARID
    ,
    TOC.AC_NAME TOC_NAME
    ,
      MIN(ROC_FROMDATE ) ROC_FROMDATE 
    ,
      MAX(ROC_TODATE ) ROC_TODATE 
    ,
      SUM(ROC_COUNT ) ROC_COUNT 
    ,
      SUM(ROC_IOT_INTERNAL ) ROC_IOT_INTERNAL 
    ,
      SUM(ROC_IOT ) ROC_IOT
    ,
      SUM
        (
            ROC_IOT 
            - 
            ROC_IOT_INTERNAL
        ) ROC_IOT_DIFF
  from
    SR116A_BASE
    ,
    ACCOUNT LAC
    ,
    ACCOUNT TOC
  where LAC.AC_ID = LAC_ACID
  and TOC.AC_ID = TOC_ACID
  and LAC_TARID <> 'i'
  group by
    LAC_SHORTID
    ,
    LAC_TARID
    ,
    LAC.AC_NAME
    ,
    TOC.AC_NAME
    order by 1,2,3,4;


--
-- SR119A_DETAILS_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR119A_DETAILS_1
(AC_NAME, CON_SHORTID, CON_NAME, CONST_LANG01, CON_DATESTART, 
 CON_DATEEND, PM_NAME, PMV_START, PMV_END)
BEQUEATH DEFINER
AS 
select
    AC_NAME
    ,
    CON_SHORTID
    ,
    CON_NAME
    ,
    CONST_LANG01
    ,
    CON_DATESTART
    ,
    CON_DATEEND
    ,
    PM_NAME
    ,
    PMV_START
    ,
      DECODE
        (
          PMV_END
          ,
            TO_DATE('01.01.2100','DD.MM.YYYY') 
          ,
          NULL
          ,
          PMV_END
        ) PMV_END
  from
    contract
    ,
    account
    ,
    CONSUBTYPE
    ,
    PRMODEL
    ,
    PRMODELVER
  where
    ac_id = con_acid 
    and
    CONST_ID = CON_ESTID 
    and
    PM_ID = CON_PMID 
    and
    PMV_PMID = PM_ID 
    and
    CON_ESID = 'A' 
    and
    CON_ETID = 'IPC' 
    and
    PMV_ESID = 'A' 
    and
    PMV_END > sysdate 
  order by
    1 asc
    ,
      to_number(CON_SHORTID ) asc 
    ,
    3 asc
    ,
    4 asc;


--
-- STA_CHECKBT_BDCONSOLIDATION  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.STA_CHECKBT_BDCONSOLIDATION
(MINDATE, MAXDATE)
BEQUEATH DEFINER
AS 
select min(minDate) minDate, max(maxDate) maxDate
from (
  select min(bdc_fromdate) minDate, to_date(null) maxDate
  from bdconsolidation
  where bdc_esid='R'
  union
  select to_date(null) minDate, max(bdc_todate) maxDate
  from bdconsolidation
  where bdc_esid='R'
);


--
-- STA_CHECKBT_SETTLING  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.STA_CHECKBT_SETTLING
(MINDATE, MAXDATE)
BEQUEATH DEFINER
AS 
select min(minDate) minDate, max(maxDate) maxDate
from (
  select trunc(to_date(set_sepid, 'YYYYMM')) minDate, to_date(null) maxDate
  from settling
  where set_esid='V'
  union
  select to_date(null) minDate, trunc(add_months(to_date(set_sepid, 'YYYYMM'),1))-1 maxDate
  from settling
  where set_esid='V'
);


--
-- TORA_D_REVAC_CQ_IN  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.TORA_D_REVAC_CQ_IN
(AC_ID, AC_DATE, AC_VALUE)
BEQUEATH DEFINER
AS 
SELECT
        REVASM_REVAHID || '_IN'   AC_ID,
        REVAC_DATE              AC_DATE,
        SUM(REVAC_IN)                           AC_VALUE
FROM
        REVA_SIGMASK,
        REVA_COUNTER
WHERE
                REVA_SIGMASK.REVASM_ID = REVA_COUNTER.REVAC_REVASMID
        AND     REVASM_ESID IN ('A')
        AND     REVAC_DATE >= trunc(sysdate) - 30
GROUP BY
        REVASM_REVAHID,
        REVAC_DATE;


--
-- TORA_D_REVAC_CQ_OUT  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.TORA_D_REVAC_CQ_OUT
(AC_ID, AC_DATE, AC_VALUE)
BEQUEATH DEFINER
AS 
SELECT
        REVASM_REVAHID || '_OUT'   AC_ID,
        REVAC_DATE                  AC_DATE,
        SUM(REVAC_OUT)                           AC_VALUE
FROM
        REVA_SIGMASK,
        REVA_COUNTER
WHERE
                REVA_SIGMASK.REVASM_ID = REVA_COUNTER.REVAC_REVASMID
        AND     REVASM_ESID IN ('A')
        AND     REVAC_DATE >= trunc(sysdate) - 30
GROUP BY
        REVASM_REVAHID,
        REVAC_DATE;


--
-- TORA_D_0067_LATEST  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.TORA_D_0067_LATEST
(A_ID, HDR, AC_ID, PROC_DATE, PERIOD_TYPE, 
 PERIOD, RESULT, TXT)
BEQUEATH DEFINER
AS 
SELECT  'RA_0067', 'BOD', "AC_ID", sysdate, 'D', "AC_DATE", "AC_VALUE", ''
  FROM TORA_D_REVAC_CQ_IN
UNION ALL
SELECT  'RA_0067', 'BOD', "AC_ID", sysdate, 'D', "AC_DATE", "AC_VALUE", ''
  FROM TORA_D_REVAC_CQ_OUT
-- ORDER BY 6 desc, 3
;


--
-- WARNINGS_FOR_AAA_INPUT  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.WARNINGS_FOR_AAA_INPUT
(H_ID, W_ID, MESSAGE)
BEQUEATH DEFINER
AS 
Select
  BIH_ID,
  W_ID, 
  RPAD(NVL(AAAI_MSISDN,' '),17) || RPAD(NVL(AAAI_REQUESTOR,' '),11) || RPAD(NVL(AAAI_REQDATE,' '),20) || W_MESSAGE MESSAGE
From
  WARNING,
  BIHEADER,
  AAAIMPORT
Where WARNING.W_BIHID = BIHEADER.BIH_ID
And   BIHEADER.BIH_ID = AAAIMPORT.AAAI_BIHID
And   WARNING.W_BDID = AAAIMPORT.AAAI_ID (+)
And   W_ERRORTIME > SysDate - 10

Union

Select
  BIH_ID,
  W_ID,
  RPAD(' ',17) || RPAD(' ',11) || RPAD(' ',20) || W_MESSAGE MESSAGE
From
  BIHEADER,
  WARNING
Where BIHEADER.BIH_ID = WARNING.W_BIHID
And   WARNING.W_BDID Is Null
And   W_ERRORTIME > SysDate - 10
Order By 1,2;


--
-- BDETAIL7  (Table) 
--
CREATE TABLE SBS1_ADMIN.BDETAIL7
(
  BD_ID                VARCHAR2(10 BYTE),
  BD_SRCTYPE           VARCHAR2(10 BYTE)        NOT NULL,
  BD_DEMO              NUMBER(1)                NOT NULL,
  BD_BIHID             VARCHAR2(10 BYTE)        NOT NULL,
  BD_MAPSID            VARCHAR2(1 BYTE)         NOT NULL,
  BD_BIRECNO           NUMBER(8)                NOT NULL,
  BD_BOHID1            VARCHAR2(10 BYTE),
  BD_PACSID1           VARCHAR2(1 BYTE),
  BD_BORECNO1          NUMBER(8),
  BD_BOHID2            VARCHAR2(10 BYTE),
  BD_PACSID2           VARCHAR2(1 BYTE),
  BD_BORECNO2          NUMBER(8),
  BD_BOHID3            VARCHAR2(10 BYTE),
  BD_PACSID3           VARCHAR2(1 BYTE),
  BD_BORECNO3          NUMBER(8),
  BD_MESSAGEREFERENCE  VARCHAR2(20 BYTE),
  BD_DATESUBMIT        DATE,
  BD_DATETIME          DATE                     NOT NULL,
  BD_MSISDN_A          VARCHAR2(254 BYTE),
  BD_ORIGINATORIMSI    VARCHAR2(20 BYTE),
  BD_OGTI              VARCHAR2(20 BYTE),
  BD_SOURCETYPE        VARCHAR2(10 BYTE),
  BD_SOURCENAME        VARCHAR2(254 BYTE),
  BD_MSISDN_B          VARCHAR2(254 BYTE),
  BD_IMSI              VARCHAR2(20 BYTE),
  BD_DGTI              VARCHAR2(20 BYTE),
  BD_SINKTYPE          VARCHAR2(10 BYTE),
  BD_SINKNAME          VARCHAR2(254 BYTE),
  BD_MSGTYPE           VARCHAR2(10 BYTE),
  BD_ATTEMPTS          NUMBER(8),
  BD_RECEIPTREQ        VARCHAR2(10 BYTE),
  BD_STATUS            VARCHAR2(20 BYTE),
  BD_ERRORPARAM        VARCHAR2(10 BYTE),
  BD_CDRTID            VARCHAR2(10 BYTE),
  BD_LENGTH            NUMBER(8),
  BD_SHORTID           VARCHAR2(6 BYTE),
  BD_CONID             VARCHAR2(10 BYTE),
  BD_TARID             VARCHAR2(10 BYTE),
  BD_TOCID             VARCHAR2(10 BYTE),
  BD_INT               VARCHAR2(1 BYTE),
  BD_IW                VARCHAR2(1 BYTE),
  BD_IOT               NUMBER(9,4),
  BD_IOT_INTERNAL      NUMBER(9,4),
  BD_ERRID             VARCHAR2(10 BYTE),
  BD_OGTI_OPKEY        VARCHAR2(10 BYTE),
  BD_DELIVER_OPKEY     VARCHAR2(10 BYTE),
  BD_DGTI_OPKEY        VARCHAR2(10 BYTE),
  BD_SCA_OPKEY         VARCHAR2(10 BYTE),
  BD_IW_AMOUNT         NUMBER(10,4),
  BD_IW_APMN           VARCHAR2(10 BYTE),
  BD_IW_CURID          VARCHAR2(3 BYTE),
  BD_IW_DIR            VARCHAR2(1 BYTE),
  BD_IW_SCENARIO       VARCHAR2(1 BYTE),
  BD_IW_CONSTATE       VARCHAR2(1 BYTE),
  BD_DELIVER_MAP_GTI   VARCHAR2(20 BYTE)
)
NOCOMPRESS 
TABLESPACE SBS1_SMSD_DATA_NC
PCTUSED    0
PCTFREE    30
INITRANS   1
MAXTRANS   255
STORAGE    (
            BUFFER_POOL      DEFAULT
           )
PARTITION BY RANGE (BD_DATETIME)
(  
  PARTITION SMSD201808 VALUES LESS THAN (TO_DATE(' 2018-09-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201809 VALUES LESS THAN (TO_DATE(' 2018-10-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201810 VALUES LESS THAN (TO_DATE(' 2018-11-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                INITIAL          8M
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201811 VALUES LESS THAN (TO_DATE(' 2018-12-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                INITIAL          8M
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201812 VALUES LESS THAN (TO_DATE(' 2019-01-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                INITIAL          8M
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201901 VALUES LESS THAN (TO_DATE(' 2019-02-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                INITIAL          8M
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201902 VALUES LESS THAN (TO_DATE(' 2019-03-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_DATA_UC
    PCTFREE    30
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               )
);

COMMENT ON TABLE SBS1_ADMIN.BDETAIL7 IS 'Billing Detail Information M2M';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL7.BD_ID IS 'detail record id';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL7.BD_SRCTYPE IS 'source type';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL7.BD_BIHID IS 'input header id';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL7.BD_MAPSID IS 'mapping state id';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL7.BD_BIRECNO IS 'input record number';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL7.BD_DATESUBMIT IS 'submit time';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL7.BD_DATETIME IS 'datetime';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL7.BD_MSISDN_A IS 'address of sender of mms';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL7.BD_ORIGINATORIMSI IS 'destination imsi';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL7.BD_OGTI IS 'roaming info';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL7.BD_MSISDN_B IS 'destination (address of recipient)';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL7.BD_IMSI IS 'sender imsi';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL7.BD_MSGTYPE IS 'message type';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL7.BD_ATTEMPTS IS 'numbers of notifications (sent to recipient)';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL7.BD_RECEIPTREQ IS 'delivery readreport request indicator';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL7.BD_CDRTID IS 'cdr type id';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL7.BD_LENGTH IS 'message length';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL7.BD_SHORTID IS 'short id';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL7.BD_CONID IS 'contract id';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL7.BD_TARID IS 'mms tariff id';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL7.BD_TOCID IS 'telecom operator contract id';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL7.BD_INT IS 'international flag';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL7.BD_IW IS 'interworking flag';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL7.BD_ERRID IS 'error id';


--
-- CONIOT  (Table) 
--
CREATE TABLE SBS1_ADMIN.CONIOT
(
  CIOT_ID       VARCHAR2(10 BYTE)               NOT NULL,
  CIOT_CONID    VARCHAR2(10 BYTE)               NOT NULL,
  CIOT_CURID    VARCHAR2(10 BYTE),
  CIOT_IWDID    VARCHAR2(10 BYTE),
  CIOT_TRCTID   VARCHAR2(10 BYTE),
  CIOT_CHNGCNT  NUMBER(5),
  CIOT_DATECRE  DATE,
  CIOT_ACIDCRE  VARCHAR2(10 BYTE),
  CIOT_DATEMOD  DATE,
  CIOT_ACIDMOD  VARCHAR2(10 BYTE)
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.CONIOT IS 'Contract IOT Settings';


--
-- CONIOTE  (Table) 
--
CREATE TABLE SBS1_ADMIN.CONIOTE
(
  CIOTE_ID           VARCHAR2(10 BYTE)          NOT NULL,
  CIOTE_CIOTID       VARCHAR2(10 BYTE)          NOT NULL,
  CIOTE_MSGSIZE_MIN  NUMBER(10,3),
  CIOTE_MSGSIZE_MAX  NUMBER(10,3),
  CIOTE_PRICE        NUMBER(10,4),
  CIOTE_CHNGCNT      NUMBER(5),
  CIOTE_DATECRE      DATE,
  CIOTE_ACIDCRE      VARCHAR2(10 BYTE),
  CIOTE_DATEMOD      DATE,
  CIOTE_ACIDMOD      VARCHAR2(10 BYTE)
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.CONIOTE IS 'Contract IOT values per message size';


--
-- CONTENTSERVICE  (Table) 
--
CREATE TABLE SBS1_ADMIN.CONTENTSERVICE
(
  CS_ID              VARCHAR2(10 BYTE)          NOT NULL,
  CS_CONID           VARCHAR2(10 BYTE)          NOT NULL,
  CS_ETID            VARCHAR2(10 BYTE)          NOT NULL,
  CS_SRCTYPE         VARCHAR2(10 BYTE)          NOT NULL,
  CS_SERVICE         VARCHAR2(20 BYTE),
  CS_NAME            VARCHAR2(100 BYTE),
  CS_GART            NUMBER(3),
  CS_IGNORE_DUOBILL  NUMBER(1),
  CS_ESID            VARCHAR2(10 BYTE)          NOT NULL,
  CS_FREETEXT        VARCHAR2(1000 BYTE),
  CS_DATECRE         DATE,
  CS_ACIDCRE         VARCHAR2(10 BYTE),
  CS_DATEMOD         DATE,
  CS_ACIDMOD         VARCHAR2(10 BYTE),
  CS_CHNGCNT         NUMBER(5),
  CS_ENPLASCTID      VARCHAR2(10 BYTE)
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.CONTENTSERVICE IS 'Content Service, belonging to an IPC (InfoProvider Contract)
Today, only used for Message Broker Services';

COMMENT ON COLUMN SBS1_ADMIN.CONTENTSERVICE.CS_ID IS 'id';

COMMENT ON COLUMN SBS1_ADMIN.CONTENTSERVICE.CS_CONID IS 'contract id';

COMMENT ON COLUMN SBS1_ADMIN.CONTENTSERVICE.CS_ETID IS 'type id (entity type)';

COMMENT ON COLUMN SBS1_ADMIN.CONTENTSERVICE.CS_SRCTYPE IS 'source type';

COMMENT ON COLUMN SBS1_ADMIN.CONTENTSERVICE.CS_SERVICE IS 'Matching code (Service ID) used to identify an IP Service on the billing interface from iServer/MBS/WCB/OTA to SBS.
The Message Broker will not use this field but a longer version in table MBSERVICE';

COMMENT ON COLUMN SBS1_ADMIN.CONTENTSERVICE.CS_NAME IS 'name';

COMMENT ON COLUMN SBS1_ADMIN.CONTENTSERVICE.CS_GART IS 'gart';

COMMENT ON COLUMN SBS1_ADMIN.CONTENTSERVICE.CS_IGNORE_DUOBILL IS 'ignore duobill';

COMMENT ON COLUMN SBS1_ADMIN.CONTENTSERVICE.CS_ESID IS 'contract state id';

COMMENT ON COLUMN SBS1_ADMIN.CONTENTSERVICE.CS_FREETEXT IS 'free text';

COMMENT ON COLUMN SBS1_ADMIN.CONTENTSERVICE.CS_DATECRE IS 'creation date';

COMMENT ON COLUMN SBS1_ADMIN.CONTENTSERVICE.CS_ACIDCRE IS 'creator account id';

COMMENT ON COLUMN SBS1_ADMIN.CONTENTSERVICE.CS_DATEMOD IS 'modification date';

COMMENT ON COLUMN SBS1_ADMIN.CONTENTSERVICE.CS_ACIDMOD IS 'modificator accout id';

COMMENT ON COLUMN SBS1_ADMIN.CONTENTSERVICE.CS_CHNGCNT IS 'change counter';


--
-- SETDETAIL  (Table) 
--
CREATE TABLE SBS1_ADMIN.SETDETAIL
(
  SED_ID           VARCHAR2(10 BYTE)            NOT NULL,
  SED_SETID        VARCHAR2(10 BYTE)            NOT NULL,
  SED_DATECRE      DATE,
  SED_DATETIME     DATE,
  SED_POS          NUMBER(4)                    NOT NULL,
  SED_ETID         VARCHAR2(10 BYTE)            NOT NULL,
  SED_VISIBLE      NUMBER(1)                    NOT NULL,
  SED_DESC         VARCHAR2(50 BYTE),
  SED_ORDER        VARCHAR2(50 BYTE),
  SED_PMVID        VARCHAR2(10 BYTE),
  SED_TARID        VARCHAR2(1 BYTE),
  SED_PRICE        NUMBER(12,4),
  SED_QUANTITY     NUMBER(12,4)                 NOT NULL,
  SED_DISCOUNT     NUMBER(3)                    NOT NULL,
  SED_NET          NUMBER(12,4)                 NOT NULL,
  SED_VATID        VARCHAR2(10 BYTE)            NOT NULL,
  SED_VATRATE      NUMBER(12,4)                 NOT NULL,
  SED_VAT          NUMBER(12,4)                 NOT NULL,
  SED_TOTAL        NUMBER(12,4)                 NOT NULL,
  SED_COUNT1       NUMBER(8),
  SED_COUNT2       NUMBER(8),
  SED_CHARGE       VARCHAR2(20 BYTE),
  SED_BOHID        VARCHAR2(10 BYTE),
  SED_GOHID        VARCHAR2(10 BYTE),
  SED_DATE         DATE,
  SED_ESID         VARCHAR2(1 BYTE),
  SED_COMMENT      VARCHAR2(2000 BYTE),
  SED_INT          VARCHAR2(1 BYTE),
  SED_AMOUNTCU     NUMBER(12,4),
  SED_RETSHAREPV   NUMBER(12,4),
  SED_RETSHAREMO   NUMBER(12,4),
  SED_PREPAID      VARCHAR2(1 BYTE),
  SED_LONGID       NUMBER(11),
  SED_UFIH_STREAM  VARCHAR2(10 BYTE),
  SED_UFIH_OUT     VARCHAR2(400 BYTE),
  SED_UFIH_BOSID   VARCHAR2(1 BYTE),
  SED_UFIH_BOHID   VARCHAR2(10 BYTE),
  SED_LONGID2      NUMBER(11),
  SED_LONGID_CNT   NUMBER(10)
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.SETDETAIL IS 'Settlement details';


--
-- IDX_BD_BIHID7  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_BIHID7 ON SBS1_ADMIN.BDETAIL7
(BD_BIHID)
  TABLESPACE SBS1_SMSD_INDEX_UC
  PCTFREE    10
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION SMSD201808
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201809
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201810
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201811
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201812
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201901
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201902
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               )
);

--
-- IDX_BD_BOHID17  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_BOHID17 ON SBS1_ADMIN.BDETAIL7
(BD_BOHID1)
  TABLESPACE SBS1_SMSD_INDEX_UC
  PCTFREE    10
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION SMSD201808
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201809
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201810
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201811
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201812
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201901
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201902
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               )
);

--
-- IDX_BD_BOHID27  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_BOHID27 ON SBS1_ADMIN.BDETAIL7
(BD_BOHID2)
  TABLESPACE SBS1_SMSD_INDEX_UC
  PCTFREE    10
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION SMSD201808
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201809
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201810
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201811
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201812
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201901
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201902
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               )
);

--
-- IDX_BD_BOHID37  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_BOHID37 ON SBS1_ADMIN.BDETAIL7
(BD_BOHID3)
  TABLESPACE SBS1_SMSD_INDEX_UC
  PCTFREE    10
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION SMSD201808
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201809
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201810
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201811
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201812
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201901
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201902
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               )
);

--
-- IDX_BD_DATETIME7  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_DATETIME7 ON SBS1_ADMIN.BDETAIL7
(BD_DATETIME)
  TABLESPACE SBS1_SMSD_INDEX_UC
  PCTFREE    10
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION SMSD201808
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201809
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201810
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201811
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201812
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201901
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201902
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               )
);

--
-- IDX_BD_ID7  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_ID7 ON SBS1_ADMIN.BDETAIL7
(BD_ID)
  TABLESPACE SBS1_SMSD_INDEX_UC
  PCTFREE    10
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION SMSD201808
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201809
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201810
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201811
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201812
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201901
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201902
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               )
);

--
-- IDX_BD_PACSID17  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_PACSID17 ON SBS1_ADMIN.BDETAIL7
(BD_PACSID1)
  TABLESPACE SBS1_SMSD_INDEX_UC
  PCTFREE    10
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION SMSD201808
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201809
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201810
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201811
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201812
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201901
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201902
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               )
);

--
-- IDX_BD_PACSID27  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_PACSID27 ON SBS1_ADMIN.BDETAIL7
(BD_PACSID2)
  TABLESPACE SBS1_SMSD_INDEX_UC
  PCTFREE    10
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION SMSD201808
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201809
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201810
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201811
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201812
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201901
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201902
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               )
);

--
-- IDX_BD_PACSID37  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_PACSID37 ON SBS1_ADMIN.BDETAIL7
(BD_PACSID3)
  TABLESPACE SBS1_SMSD_INDEX_UC
  PCTFREE    10
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION SMSD201808
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201809
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201810
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201811
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201812
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201901
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201902
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               )
);

--
-- IDX_CIOT_CONID  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_CIOT_CONID ON SBS1_ADMIN.CONIOT
(CIOT_CONID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_CIOTE_CIOTID  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_CIOTE_CIOTID ON SBS1_ADMIN.CONIOTE
(CIOTE_CIOTID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_CS_CONID  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_CS_CONID ON SBS1_ADMIN.CONTENTSERVICE
(CS_CONID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_SED_ESID  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_SED_ESID ON SBS1_ADMIN.SETDETAIL
(SED_ESID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_SED_ORDER  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_SED_ORDER ON SBS1_ADMIN.SETDETAIL
(SED_ORDER, SED_CHARGE)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_SED_SETID  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_SED_SETID ON SBS1_ADMIN.SETDETAIL
(SED_SETID, SED_POS)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDX_SED_UFIH_BOSID  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_SED_UFIH_BOSID ON SBS1_ADMIN.SETDETAIL
(SED_UFIH_BOSID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- IDXU_CS_SERVICE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDXU_CS_SERVICE ON SBS1_ADMIN.CONTENTSERVICE
(CS_SERVICE, CS_CONID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_CONIOT  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_CONIOT ON SBS1_ADMIN.CONIOT
(CIOT_ID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_CONIOTE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_CONIOTE ON SBS1_ADMIN.CONIOTE
(CIOTE_ID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_CONTENTSERVICE  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_CONTENTSERVICE ON SBS1_ADMIN.CONTENTSERVICE
(CS_ID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- PK_SETDETAIL  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_SETDETAIL ON SBS1_ADMIN.SETDETAIL
(SED_ID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

--
-- GPSH_TOAC_CON_PUT  (Procedure) 
--
CREATE OR REPLACE PROCEDURE SBS1_ADMIN.GPSH_TOAC_CON_PUT( P_CON_ID IN VARCHAR2, P_CON_JSON IN VARCHAR2 )
-- MODIFICATION HISTORY
-- ---------    ------      -------------------------------------------
-- Person       Date        Comments
-- SS           21.07.2016    Created
-- SS           22.07.2016    Added Name, Opkey, json into contract
-- 001SO        11.11.2016    Re-Implement table difference with set operations
-- 002SS        11.11.2016    Fixed bad condition fir MMS prices
-- 003S0        26.05.2017    Fill in / fix minimum message sizes for MMS transport Prices
-- 004SO        07.08.2016    Added CON_DATECRE, CON_DATEMOD attributes
-- 005SS        11.10.2017    changed the VATO and VATT number precision
-- 006SO        15.11.2018    Remove CON_DEMO and CON_COMMENT

IS
    ACID      VARCHAR2(20);
    OPKEY     VARCHAR2(20);
    NAME      VARCHAR2(50);
    CODE      VARCHAR2(19);
    ESID      VARCHAR(1);
    DATEEND   VARCHAR2(25);
    DATESTART VARCHAR2(25);
    HUB       VARCHAR2(10);
    UNLRPL    VARCHAR2(100);
    UNLRP     VARCHAR2(100);
    VATO      NUMBER(10, 4);  --005SS
    VATT      NUMBER(10, 4);  --005SS
    VIRTUAL   VARCHAR2(6);
    SMSCURO   VARCHAR2(5);
    SMSIOTO   NUMBER(10, 4);
    SMSCURT   VARCHAR2(5);
    SMSIOTT   NUMBER(10, 4);
    MMSCURO   VARCHAR2(5);
    MMSIOTO   VARCHAR2(400);
    L_AC_ID   VARCHAR2(10);

    CURRENT_SMSCURO_ID VARCHAR2(10);
    CURRENT_SMSCURT_ID VARCHAR2(10);
    CURRENT_MMSCURO_ID VARCHAR2(10);
    MMSCURO_COUNT   NUMBER;

    CURSOR CACC (CON_ACID_IN IN VARCHAR2)
        IS SELECT AC_ID
            FROM   ACCOUNT
            WHERE  AC_ID = CON_ACID_IN;

    CURSOR MMSIOTO_CUR (MMSCURO_IN IN VARCHAR2)
        IS SELECT J.IOT, J.SIZ
            FROM JSON_TABLE(MMSCURO_IN, '$[*]'
                COLUMNS(IOT PATH '$.IOT', SIZ PATH '$.SIZE')) AS J;

BEGIN
  SELECT CON_ACID,
         CON_NAME,
         CON_OPKEY,
         CON_CODE,
         CON_ESID,
         CON_DATEEND,
         CON_DATESTART,
         CON_HUB,
         CON_UNLRP,
         CON_VATO,
         CON_VATT,
         CON_VIRTUAL,
         CON_SMSCURO,
         CON_SMSIOTO,
         CON_SMSCURT,
         CON_SMSIOTT,
         CON_MMSCURO,
         CON_MMSIOTO
  INTO   ACID,
         NAME,
         OPKEY,
         CODE,
         ESID,
         DATEEND,
         DATESTART,
         HUB,
         UNLRPL,
         VATO,
         VATT,
         VIRTUAL,
         SMSCURO,
         SMSIOTO,
         SMSCURT,
         SMSIOTT,
         MMSCURO ,
         MMSIOTO
  FROM JSON_TABLE(P_CON_JSON, '$' COLUMNS(
        CON_ACID PATH '$.CON_ACID',
        CON_NAME PATH '$.CON_NAME',
        CON_OPKEY PATH '$.CON_OPKEY',
        CON_CODE PATH '$.CODE',
        CON_ESID PATH '$.CONSTATE.fk[1]',
        CON_DATEEND PATH '$.DATEEND',
        CON_DATESTART PATH '$.DATESTART',
        CON_HUB PATH '$.HUB.fk[1]',
        CON_UNLRP VARCHAR2(100) FORMAT JSON WITH WRAPPER PATH '$.UNLRP.fks[*][1]',
        CON_VATO NUMBER PATH '$.VATO',  --005SS
        CON_VATT NUMBER PATH '$.VATT',  --005SS
        CON_VIRTUAL PATH '$.VIRTUAL',
        CON_SMSCURO PATH '$.SMSCURO.fk[1]',
        CON_SMSIOTO NUMBER PATH '$.SMSIOTO',
        CON_SMSCURT PATH '$.SMSCURT.fk[1]',
        CON_SMSIOTT NUMBER PATH '$.SMSIOTT',
        CON_MMSCURO PATH '$.MMSCURO.fk[1]',
        CON_MMSIOTO VARCHAR2(400) FORMAT JSON PATH '$.MMSIOTO' ) );

  UNLRP := TRIM('"' FROM REPLACE(REPLACE(TRIM(TRAILING ']' FROM TRIM(LEADING '[' FROM UNLRPL)), 'null'), '","', ';'));

  OPEN CACC(ACID);
  FETCH CACC
  INTO  L_AC_ID;

  IF CACC%NOTFOUND THEN
  INSERT INTO ACCOUNT
              (
                 AC_ID,
                 AC_ETID,
                 AC_DEMO,
                 AC_SHORT,
                 AC_NAME,
                 AC_LOGRET,
                 AC_LANGID,
                 AC_VAT,
                 AC_CURRENCY,
                 AC_ESID,
                 AC_ADRID_MAIN,
                 AC_ADRID_MAINCONTACT,
                 AC_DATECRE,
                 AC_CHNGCNT
              )
  SELECT ACID,
         'TOP',
         0,
         ACID,
         NAME,
         0,
         'de',
         0,
         'CHF',
         'A',
         gpsh_tpac_new_adr_id(NULL),
         gpsh_tpac_new_adr_id(NULL),
         SYSDATE,
         0
  FROM   DUAL;

END IF;
CLOSE CACC;

UPDATE CONTRACT
SET    CON_ACID = ACID,
       CON_NAME = NAME,
       CON_OPKEY = OPKEY,
       CON_DATEEND = From_json_date(DATEEND),
       CON_DATESTART = From_json_date(DATESTART),
       CON_ESID = ESID,
       CON_CODE = CODE,
       CON_HUB = HUB,
       CON_VIRTUAL = Decode(VIRTUAL, 'true', 1, 'false', 0),
       CON_ULNRP = UNLRP,
       CON_VATO = VATO,
       CON_VATT = VATT,
       CON_JSON = P_CON_JSON,
       CON_DATEMOD = SYSDATE
WHERE  CON_ID = P_CON_ID; -- 004SO

IF (SQL%ROWCOUNT = 0) THEN
INSERT INTO CONTRACT
            (
                        CON_ID,
                        CON_ACID,
                        CON_NAME,
                        CON_OPKEY,
                        CON_DATEEND,
                        CON_DATESTART,
                        CON_ESID,
                        CON_ETID,
                        CON_CODE,
                        CON_HUB,
                        CON_VIRTUAL,
                        CON_ULNRP,
                        CON_VATO,
                        CON_VATT,
                        CON_SRCTYPE,
                        CON_JSON,
                        CON_DATECRE
            )
            VALUES
            (
                        P_CON_ID,
                        ACID,
                        NAME,
                        OPKEY,
                        FROM_JSON_DATE(DATEEND),
                        FROM_JSON_DATE(DATESTART),
                        ESID,
                        'TOC',
                        CODE,
                        HUB,
                        DECODE(VIRTUAL, 'true', 1, 'false', 0),
                        UNLRP,
                        VATO,
                        VATT,
                        'OPER',
                        P_CON_JSON,
                        SYSDATE
            );  -- 006SO -- 004SO

END IF;

    SELECT CIOT_ID INTO CURRENT_SMSCURO_ID FROM CONIOT RIGHT JOIN DUAL ON CIOT_IWDID = 'ORIG' AND CIOT_CONID = P_CON_ID and CIOT_TRCTID = 'SMS';
    IF CURRENT_SMSCURO_ID IS NULL then
        CURRENT_SMSCURO_ID := GENERATEUNIQUEKEY('G');
        INSERT INTO CONIOT (CIOT_ID, CIOT_CONID, CIOT_IWDID, CIOT_TRCTID, CIOT_CURID, CIOT_DATECRE)
            VALUES (CURRENT_SMSCURO_ID, P_CON_ID, 'ORIG', 'SMS', SMSCURO, SYSDATE);
        INSERT INTO CONIOTE (CIOTE_ID, CIOTE_CIOTID, CIOTE_PRICE, CIOTE_DATECRE)
            VALUES (GENERATEUNIQUEKEY('G'), CURRENT_SMSCURO_ID, SMSIOTO, SYSDATE);
    ELSE
        UPDATE CONIOT SET
            CIOT_CURID = SMSCURO,
            CIOT_DATEMOD = SYSDATE
            WHERE CIOT_ID = CURRENT_SMSCURO_ID;
        UPDATE CONIOTE SET
            CIOTE_PRICE = SMSIOTO,
            CIOTE_DATEMOD = SYSDATE
            Where CIOTE_CIOTID = CURRENT_SMSCURO_ID;
    END IF;

    SELECT CIOT_ID INTO CURRENT_SMSCURT_ID FROM CONIOT RIGHT JOIN DUAL ON CIOT_IWDID = 'TERM' AND CIOT_CONID = P_CON_ID and CIOT_TRCTID = 'SMS';
    IF CURRENT_SMSCURT_ID IS NULL then
        CURRENT_SMSCURT_ID := GENERATEUNIQUEKEY('G');
        INSERT INTO CONIOT (CIOT_ID, CIOT_CONID, CIOT_IWDID, CIOT_TRCTID, CIOT_CURID, CIOT_DATECRE)
            VALUES (CURRENT_SMSCURT_ID, P_CON_ID, 'TERM', 'SMS', SMSCURT, SYSDATE);
        INSERT INTO CONIOTE (CIOTE_ID, CIOTE_CIOTID, CIOTE_PRICE, CIOTE_DATECRE)
            VALUES (GENERATEUNIQUEKEY('G'), CURRENT_SMSCURT_ID, SMSIOTT, SYSDATE);
    ELSE
        UPDATE CONIOT SET
            CIOT_CURID = SMSCURT,
            CIOT_DATEMOD = SYSDATE
            WHERE CIOT_ID = CURRENT_SMSCURT_ID;
        UPDATE CONIOTE SET
            CIOTE_PRICE = SMSIOTT,
            CIOTE_DATEMOD = SYSDATE
            Where CIOTE_CIOTID = CURRENT_SMSCURT_ID;
    END IF;

    SELECT CIOT_ID INTO CURRENT_MMSCURO_ID FROM CONIOT RIGHT JOIN DUAL ON CIOT_IWDID = 'ORIG' AND CIOT_CONID = P_CON_ID and CIOT_TRCTID = 'MMS';
    IF CURRENT_MMSCURO_ID IS NULL then
        CURRENT_MMSCURO_ID := GENERATEUNIQUEKEY('G');
        INSERT INTO CONIOT (CIOT_ID, CIOT_CONID, CIOT_IWDID, CIOT_TRCTID, CIOT_CURID, CIOT_DATECRE)
            VALUES (CURRENT_MMSCURO_ID, P_CON_ID, 'ORIG', 'MMS', MMSCURO, SYSDATE);
        FOR CUR IN MMSIOTO_CUR(MMSIOTO)
        LOOP
            INSERT INTO CONIOTE (CIOTE_ID, CIOTE_CIOTID, CIOTE_MSGSIZE_MAX, CIOTE_PRICE, CIOTE_DATECRE)
            VALUES (GENERATEUNIQUEKEY('G'), CURRENT_MMSCURO_ID, CUR.SIZ, CUR.IOT, SYSDATE);
        END LOOP;
    ELSE
        UPDATE CONIOT SET
            CIOT_CURID = MMSCURO,
            CIOT_DATEMOD = SYSDATE
            WHERE CIOT_ID = CURRENT_MMSCURO_ID;

        SELECT COUNT(*) INTO MMSCURO_COUNT FROM (
            (SELECT PRICE, SIZ FROM JSON_TABLE(MMSIOTO, '$[*]' COLUMNS (PRICE NUMBER PATH '$.IOT', SIZ NUMBER PATH '$.SIZE'))
            MINUS
            SELECT CIOTE_PRICE, CIOTE_MSGSIZE_MAX FROM CONIOTE WHERE CIOTE_CIOTID = CURRENT_MMSCURO_ID
            ) UNION ALL (
            SELECT CIOTE_PRICE, CIOTE_MSGSIZE_MAX FROM CONIOTE WHERE CIOTE_CIOTID = CURRENT_MMSCURO_ID
            minus
            SELECT PRICE, SIZ FROM JSON_TABLE(MMSIOTO, '$[*]' COLUMNS (PRICE NUMBER PATH '$.IOT', SIZ NUMBER PATH '$.SIZE'))
        ));                                                                     -- 001SO  Table Diff

        IF MMSCURO_COUNT <> 0 THEN                                              -- 002SS
            DELETE FROM CONIOTE WHERE CIOTE_CIOTID = CURRENT_MMSCURO_ID;
            FOR CUR IN MMSIOTO_CUR(MMSIOTO)
            LOOP
                INSERT INTO CONIOTE (CIOTE_ID, CIOTE_CIOTID, CIOTE_MSGSIZE_MAX, CIOTE_PRICE, CIOTE_DATECRE)
                VALUES (GENERATEUNIQUEKEY('G'), CURRENT_MMSCURO_ID, CUR.SIZ, CUR.IOT, SYSDATE);
            END LOOP;
        END IF;

    END IF;

    UPDATE CONIOTE M SET
        M.CIOTE_MSGSIZE_MIN = (
            SELECT NVL(MAX(L.CIOTE_MSGSIZE_MAX),0)
            FROM CONIOTE L
            WHERE L.CIOTE_CIOTID = CURRENT_MMSCURO_ID
            AND (L.CIOTE_MSGSIZE_MAX < M.CIOTE_MSGSIZE_MAX or M.CIOTE_MSGSIZE_MAX = 9999999.999)
        )
    WHERE M.CIOTE_CIOTID = CURRENT_MMSCURO_ID;                                  -- 003S0

END;
/


--
-- GPSH_TPAC_CS_DEL  (Procedure) 
--
CREATE OR REPLACE PROCEDURE SBS1_ADMIN.gpsh_tpac_cs_del(
      P_CS_ID  IN VARCHAR2
)
   IS
-- MODIFICATION HISTORY
-- ---------    ------      -------------------------------------------
-- Person       Date        Comments
-- SS           28.08.2016  Created

BEGIN
    DELETE FROM CONTENTSERVICE WHERE CS_ID = P_CS_ID;
END; -- Procedure
/


--
-- GPSH_TPAC_CS_PUT  (Procedure) 
--
CREATE OR REPLACE PROCEDURE SBS1_ADMIN.GPSH_TPAC_CS_PUT(
    P_CON_ID   IN VARCHAR2,
    P_CS_ID    IN VARCHAR2,
    P_CON_JSON IN VARCHAR2
)

-- MODIFICATION HISTORY
-- ---------    ------      -------------------------------------------
-- Person       Date        Comments
-- SS           28.08.16    Created
-- SS           20.03.17    added ESID Check for update

IS
    ETID        VARCHAR2(10);
    NAME        VARCHAR2(50);
    SERVICE     VARCHAR2(50);
    GART        VARCHAR2(10);
    ESID        VARCHAR2(10);
    DUOBILL     VARCHAR2(5);
    T_CS_ID     VARCHAR(20);
BEGIN
    SELECT CS_ETID, CS_NAME, CS_SERVICE, CS_GART, CS_DUOBILL, CS_ESID
    INTO ETID, NAME, SERVICE, GART, DUOBILL, ESID
    FROM JSON_TABLE(P_CON_JSON, '$' COLUMNS(
        CS_ETID PATH '$.CST.fk[1]',
        CS_NAME PATH '$.NAME',
        CS_SERVICE PATH '$.CODE',
        CS_GART PATH '$.GART.fk[1]',
        CS_DUOBILL PATH '$.IGNORE_DUOBILL',
        CS_ESID PATH '$.CSSTATE.fk[1]'));

    SELECT CS_ID INTO T_CS_ID FROM CONTENTSERVICE RIGHT JOIN DUAL ON CS_ID = P_CS_ID;

    IF T_CS_ID IS NULL THEN
        INSERT INTO CONTENTSERVICE (CS_ID, CS_CONID, CS_ETID, CS_SRCTYPE, CS_SERVICE, CS_NAME, CS_GART, CS_IGNORE_DUOBILL, CS_ESID, CS_DATECRE)
            VALUES (P_CS_ID, P_CON_ID, ETID, 'ISRV', SERVICE, NAME, GART, from_json_boolean(DUOBILL), ESID, SYSDATE);
    ELSE

        SELECT CS_ID INTO T_CS_ID
        FROM CONTENTSERVICE
        RIGHT JOIN DUAL
        ON CS_ID = P_CS_ID
        AND CS_CONID = P_CON_ID
        AND CS_ETID = ETID
        AND CS_NAME = NAME
        AND CS_ESID = ESID -- added ESID Check for update
        AND CS_SRCTYPE = 'ISRV'
        AND CS_SERVICE = SERVICE
        AND CS_GART = GART
        AND CS_IGNORE_DUOBILL = from_json_boolean(DUOBILL);

        IF T_CS_ID IS NULL THEN
            UPDATE CONTENTSERVICE SET
                CS_ETID = ETID,
                CS_NAME = NAME,
                CS_CONID = P_CON_ID,
                CS_SRCTYPE = 'ISRV',
                CS_SERVICE = SERVICE,
                CS_GART = GART,
                CS_IGNORE_DUOBILL = from_json_boolean(DUOBILL),
                CS_ESID = ESID,
                CS_DATEMOD = SYSDATE
            WHERE CS_ID = P_CS_ID;
        END IF;
    END IF;
END;
/


--
-- CONTRACT_IOT  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.CONTRACT_IOT (
    p_CON_ID        IN VARCHAR2,
    p_IWDID         IN CONIOT.CIOT_IWDID%TYPE,
    p_TRCTID        IN CONIOT.CIOT_TRCTID%TYPE,
    p_MSGSIZE       IN CONIOTE.CIOTE_MSGSIZE_MAX%TYPE DEFAULT 0
) RETURN  CONIOTE.CIOTE_PRICE%TYPE IS
--
-- Purpose: Return IOT for a given
--          Telecom Operator Contract
--          direction ('ORIG','TERM')
--          transport medium ('SMS','MMS')
--          message size

-- Return   IOT in currency as defined or NULL if not found
--
-- MODIFICATION HISTORY
-- Person   Date        Comments
-- ------   ----------  -------------------------------------------
-- 001SO    04.10.2007  Created
-- 002SO    12.11.2016  Do not depend on CIOTE_MSGSIZE_MIN any more

    CURSOR cSmsPrice IS
        SELECT  CIOTE_PRICE
        FROM    CONIOT, CONIOTE
        WHERE   CONIOT.CIOT_ID = CONIOTE.CIOTE_CIOTID
        AND     CIOT_TRCTID = p_TRCTID
        AND     CIOT_IWDID = p_IWDID
        AND     CIOT_CONID = p_CON_ID
        ;                                                                       -- 002SO

    CURSOR cMmsPrice IS
        SELECT  CIOTE_PRICE
        FROM    CONIOT, CONIOTE
        WHERE   CONIOT.CIOT_ID = CONIOTE.CIOTE_CIOTID
        AND     CIOT_TRCTID = p_TRCTID
        AND     CIOT_IWDID = p_IWDID
        AND     CIOT_CONID = p_CON_ID
        AND     p_MSGSIZE/1024 < CIOTE_MSGSIZE_MAX
        ORDER BY CIOTE_MSGSIZE_MAX
        ;                                                                       -- 002SO

    l_price     NUMBER(10,4);

BEGIN

    l_price := NULL;

    if p_TRCTID = 'SMS' then
        for cRow in cSmsPrice loop
            l_price := cRow.CIOTE_PRICE;
        end loop;
    else
        for cRow in cMmsPrice loop
            l_price := cRow.CIOTE_PRICE;
            EXIT;                                                               -- 002SO first price
        end loop;
    end if;

    RETURN l_price;

END;
/


--
-- CONTRACT_IOT_CHF  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.CONTRACT_IOT_CHF (
    p_CON_ID        IN VARCHAR2,
    p_IWDID         IN CONIOT.CIOT_IWDID%TYPE,
    p_TRCTID        IN CONIOT.CIOT_TRCTID%TYPE,
    p_DATE          IN DATE DEFAULT NULL,
    p_MSGSIZE       IN CONIOTE.CIOTE_MSGSIZE_MAX%TYPE DEFAULT 0
) RETURN  CONIOTE.CIOTE_PRICE%TYPE IS
--
-- Purpose: Return IOT for a given
--          Telecom Operator Contract
--          direction ('ORIG','TERM')
--          transport medium ('SMS','MMS')
--          message size

-- Return   IOT in currency as defined or NULL if not found
--
-- MODIFICATION HISTORY
-- Person   Date        Comments
-- ------   ----------  -------------------------------------------
-- 001SO    04.10.2007  Created
-- 002SO    12.11.2016  Do not depend on CIOTE_MSGSIZE_MIN any more

    CURSOR cSmsPrice IS
        SELECT
            CIOTE_PRICE * EXR_VALUE / CUR_HEADVAL   Price
        FROM    CONIOT, CONIOTE, CURRENCY, EXCHANGERATE
        WHERE   CONIOT.CIOT_ID = CONIOTE.CIOTE_CIOTID
        AND     CIOT_TRCTID = p_TRCTID
        AND     CIOT_IWDID = p_IWDID
        AND     CIOT_CONID = p_CON_ID
        AND     CUR_ID = NVL(CIOT_CURID,'CHF')
        AND     EXR_CURID = CUR_ID
        AND     EXR_START <= NVL(p_DATE,SYSDATE)
        AND     EXR_END > NVL(p_DATE,SYSDATE)
        ;                                                                       -- 002SO

    CURSOR cMmsPrice IS
        SELECT
            CIOTE_PRICE * EXR_VALUE / CUR_HEADVAL   Price
        FROM    CONIOT, CONIOTE, CURRENCY, EXCHANGERATE
        WHERE   CONIOT.CIOT_ID = CONIOTE.CIOTE_CIOTID
        AND     CIOT_TRCTID = p_TRCTID
        AND     CIOT_IWDID = p_IWDID
        AND     CIOT_CONID = p_CON_ID
        AND     p_MSGSIZE/1024 < CIOTE_MSGSIZE_MAX
        AND     CUR_ID = NVL(CIOT_CURID,'CHF')
        AND     EXR_CURID = CUR_ID
        AND     EXR_START <= NVL(p_DATE,SYSDATE)
        AND     EXR_END > NVL(p_DATE,SYSDATE)
        ORDER BY CIOTE_MSGSIZE_MAX
        ;                                                                       -- 002SO

    l_price     NUMBER(10,4);

BEGIN

    l_price := NULL;

    if p_TRCTID = 'SMS' then
        for cRow in cSmsPrice loop
            l_price := cRow.Price;
        end loop;
    else
        for cRow in cMmsPrice loop
            l_price := cRow.Price;
            EXIT;                                                               -- 002SO first price
        end loop;
    end if;

    RETURN l_price;

END;
/


--
-- CS_IS_ACTIVE  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.CS_IS_ACTIVE (
    p_CS_ID IN VARCHAR2
) RETURN  NUMBER IS
--
-- Purpose: Return activity status of a content service, also depending on contract entity state,
-- start- and end date
--
-- MODIFICATION HISTORY
-- Person   Date        Comments
-- ------   ----------  -------------------------------------------
-- 001SO    31.04.2007  Created

-- ATTENTION: LOGIC IS DUPLICATED IN TRIGGERS               -- 002SO
--              ENPLA_ACCOUNT
--              ENPLA_CONTRACT

    l_esid          CONTRACT.con_esid%type;
    l_csesid        CONTENTSERVICE.cs_esid%type;
    l_date_start    DATE;
    l_date_end      DATE;
    l_date_block    DATE;
    l_date_now      DATE;
    
BEGIN
    l_date_now := SYSDATE;
    
    SELECT  CS_ESID, CON_ESID, CON_DATESTART, CON_DATEEND, CON_DATEBLOCK
    INTO    l_csesid, l_esid, l_date_start, l_date_end, l_date_block
    FROM    CONTENTSERVICE, CONTRACT
    WHERE   CON_ID = CS_CONID
    AND     CS_ID = p_CS_ID
    ;
    if l_csesid <> 'A' then
        l_esid := l_csesid;     -- state of content service counts
    end if;
    if l_esid <> 'A' then
        RETURN 0;
    elsif l_date_block <= l_date_now then
        RETURN 0;
    else
        if (l_date_start is NULL OR l_date_start <= l_date_now)
            AND (l_date_end is NULL OR l_date_end > l_date_now) then
            return 1;
        else
            return 0;
        end if;
    end if;
END;
 
/


--
-- CS_IS_ACTIVE_OR_TEST  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.CS_IS_ACTIVE_OR_TEST (
    p_CS_ID IN VARCHAR2
) RETURN  NUMBER IS
--
-- Purpose: Return activity status of a content service, also depending on contract entity state,
-- start- and end date
--
-- MODIFICATION HISTORY
-- Person   Date        Comments
-- ------   ----------  -------------------------------------------
-- 001SO    31.04.2007  Created
-- 002SO    18.04.2010  REMOVE S B S 0 schema reference

-- ATTENTION: LOGIC IS DUPLICATED IN TRIGGERS               -- 002SO
--              ENPLA_ACCOUNT
--              ENPLA_CONTRACT

    l_esid          CONTRACT.con_esid%type;
    l_csesid        CONTENTSERVICE.cs_esid%type;
    l_date_start    DATE;
    l_date_end      DATE;
    l_date_block    DATE;
    l_date_now      DATE;
    
BEGIN
    l_date_now := SYSDATE;
    
    SELECT  CS_ESID, CON_ESID, CON_DATESTART, CON_DATEEND, CON_DATEBLOCK
    INTO    l_csesid, l_esid, l_date_start, l_date_end, l_date_block
    FROM    CONTENTSERVICE, CONTRACT
    WHERE   CON_ID = CS_CONID
    AND     CS_ID = p_CS_ID
    ;
    if l_csesid <> 'A' then
        l_esid := l_csesid;     -- state of content service counts
    end if;
    if l_esid not in ('A','T') then
        RETURN 0;
    elsif l_date_block <= l_date_now then
        RETURN 0;
    else
        if (l_date_end is NULL OR l_date_end > l_date_now) then
            return 1;
        else
            return 0;
        end if;
    end if;
END;
/


--
-- CS_STATE  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.CS_STATE (
    p_CS_ID IN VARCHAR2
) RETURN  NUMBER IS
--
-- Purpose: Return activity status of contract, depending on entity state,
-- start- and end date
-- Returns 0 if contract is inactive, out of time frame or suspended
-- Returns 1 if contract is active (state A and in time frame)
-- Returne 2 if contract is test or we are before start (considered as test mode)
-- This mapping corresponds to the SBS instances as defined by MB (1_prod 2=test)
--
-- MODIFICATION HISTORY
-- Person   Date        Comments
-- ------   ----------  -------------------------------------------
-- 001SO    30.04.2007  Created

-- ATTENTION: LOGIC IS DUPLICATED IN TRIGGERS
--              ENPLA_ACCOUNT
--              ENPLA_CONTRACT

    l_esid          CONTRACT.con_esid%type;
    l_csesid        CONTENTSERVICE.cs_esid%type;
    l_date_start    DATE;
    l_date_end      DATE;
    l_date_block    DATE;
    l_date_now      DATE;
    
BEGIN
    l_date_now := SYSDATE;
    
    SELECT  CS_ESID, CON_ESID, CON_DATESTART, CON_DATEEND, CON_DATEBLOCK
    INTO    l_csesid, l_esid, l_date_start, l_date_end, l_date_block
    FROM    CONTENTSERVICE, CONTRACT
    WHERE   CON_ID = CS_CONID
    AND     CS_ID = p_CS_ID
    ;
    if l_csesid <> 'A' then
        l_esid := l_csesid;     -- state of content service counts
    end if;
    if l_esid not in ('A','T') then
        RETURN 0;
    elsif l_date_block <= l_date_now then
        RETURN 0;
    elsif (l_date_start is NULL OR l_date_start <= l_date_now)
            AND (l_date_end is NULL OR l_date_end > l_date_now) then
        if l_esid = 'A' then
            RETURN 1;
        else
            RETURN 2;
        end if;
    elsif (l_date_end is NULL OR l_date_end > l_date_now) then
        RETURN 2;
    else
        RETURN 0;
    end if;
END;
 
/


--
-- GPULL_CONTENT_SERVICE_JSON  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.gpull_content_service_json
  (P_CS_ID  IN VARCHAR2
  ) RETURN  VARCHAR2 IS

-- Purpose: To generate contentservice JSON value (sbsgui like) for the corresponding to contract id and cs id 
--
-- MODIFICATION HISTORY
-- Person      Date    Comments
-- ---------   ------  -------------------------------------------
-- SS          14.10.16 Created

    ETID        VARCHAR2(10);
    NAME        VARCHAR2(50);
    SERVICE     VARCHAR2(50);
    GART        VARCHAR2(10);
    ESID        VARCHAR2(10);
    DUOBILL     VARCHAR2(5);
    RETURN_VAL  VARCHAR2(5000);
    
BEGIN
    SELECT CS_ETID, CS_NAME, CS_SERVICE, CS_GART, CS_IGNORE_DUOBILL, CS_ESID
    INTO ETID, NAME, SERVICE, GART, DUOBILL, ESID
    FROM CONTENTSERVICE
    RIGHT JOIN DUAL ON CS_ID =  P_CS_ID;

    IF ETID IS NULL THEN
        RETURN 'null';
    ELSE
        RETURN_VAL := '{' || '"CODE":'                     || json_string(SERVICE) || ','
                          || '"CSSTATE":{"fk":["csstate",' || json_string(ESID) || ']},'
                          || '"CST":{"fk":["cst",'         || json_string(ETID) || ']},'
                          || '"GART":{"fk":["gart",'       || json_string(GART) || ']},'
                          || '"IGNORE_DUOBILL":'           || json_boolean(DUOBILL) || ','
                          || '"NAME":'                     || json_string(NAME)
                          || '}';
        RETURN RETURN_VAL;

    END IF;
END;
/


--
-- GPULL_TOCON_JSON  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.GPULL_TOCON_JSON(
    P_CON_ID IN VARCHAR2
)   RETURN  VARCHAR2

-- MODIFICATION HISTORY
-- Person   Date        Comments
-- -------- ----------  -------------------------------------------
-- 001SO    15.11.2018  Remove reference to CON_COMMENT

IS

    RETURN_VAL VARCHAR2(5000);
    MMSCURO VARCHAR2(5);
    MMSIOTO VARCHAR2(400);
    SMSCURO VARCHAR2(5);
    SMSCURT VARCHAR2(5);
    SMSIOTO NUMBER(10, 4);
    SMSIOTT NUMBER(10, 4);
    UNLRP VARCHAR2(100);
    UNLRPT VARCHAR2(100);

    CURSOR MMSIOTO_CUR (CON_ID_IN IN VARCHAR2)
        IS SELECT DISTINCT CIOT_CURID, to_char(CIOTE_PRICE,9990.9999) PRICE, CIOTE_MSGSIZE_MAX
            FROM CONIOT INNER JOIN CONIOTE
            ON CIOT_ID = CIOTE_CIOTID
            AND CIOT_CONID = CON_ID_IN
            AND CIOT_TRCTID = 'MMS'
            AND CIOT_IWDID = 'ORIG'
            ORDER BY CIOTE_MSGSIZE_MAX;

BEGIN

    SELECT CON_ULNRP INTO UNLRPT FROM CONTRACT WHERE CON_ID = P_CON_ID;

    IF UNLRPT IS NULL THEN
        UNLRP := '{"fks":[["toac", null]]}';
    ELSE
        UNLRP := '{"fks":[["toac","' || replace(UNLRPT, ';', '"],["toac","') || '"]]}';
    END IF;

    SELECT CIOT_CURID, CIOTE_PRICE INTO SMSCURO, SMSIOTO
    FROM CONIOT INNER JOIN CONIOTE
    ON CIOT_ID = CIOTE_CIOTID
    AND CIOT_CONID = P_CON_ID
    AND CIOT_TRCTID = 'SMS'
    AND CIOT_IWDID = 'ORIG';

    SELECT CIOT_CURID, CIOTE_PRICE INTO SMSCURT, SMSIOTT
    FROM CONIOT INNER JOIN CONIOTE
    ON CIOT_ID = CIOTE_CIOTID
    AND CIOT_CONID = P_CON_ID
    AND CIOT_TRCTID = 'SMS'
    AND CIOT_IWDID = 'TERM';

    MMSIOTO := '';
    FOR CUR IN MMSIOTO_CUR(P_CON_ID)
    LOOP
        MMSCURO := CUR.CIOT_CURID;
        IF CUR.PRICE IS NULL THEN
            MMSIOTO := MMSIOTO || '{"IOT":' || 'null' ||',"SIZE":' || json_number(NVL(CUR.CIOTE_MSGSIZE_MAX, 0)) || '},';
        ELSE
            MMSIOTO := MMSIOTO || '{"IOT":' || json_number(TRIM(CUR.PRICE)) ||',"SIZE":' || json_number(NVL(CUR.CIOTE_MSGSIZE_MAX, 0)) || '},';
        END IF;
    END LOOP;

    SELECT '{'
            || '"CODE":' || json_string(con_code) || ','
            || '"CONSTATE": {"fk":["constate",' || JSON_STRING(CON_ESID) || ']},'
            || '"CON_ACID":' || json_string(CON_ACID) || ','
            || '"CON_NAME":' || json_string(CON_NAME) || ','
            || '"CON_OPKEY":' || json_string(CON_OPKEY) || ','
            || '"DATEEND":' || JSON_DATE(CON_DATEEND) || ','
            || '"DATESTART":' || JSON_DATE(CON_DATESTART) || ','
            || '"HUB": {"fk":["smshub",' || json_string(con_hub) || ']},'
            || '"MMSCURO": {"fk":["cur",' || json_string(MMSCURO) || ']},'
            || '"MMSIOTO":[' || TRIM(TRAILING ',' FROM MMSIOTO) || '],'
            || '"SMSCURO": {"fk":["cur",' || json_string(SMSCURO) || ']},'
            || '"SMSCURT": {"fk":["cur",' || json_string(SMSCURT) || ']},'
            || '"SMSIOTO":' || NVL(json_number(SMSIOTO), 'null') || ','
            || '"SMSIOTT":' || NVL(json_number(SMSIOTT), 'null') || ','
            || '"UNLRP":' || UNLRP || ','
            || '"VATO":' || json_number(NVL(CON_VATO,  '0')) || ','
            || '"VATT":' || json_number(NVL(CON_VATT,  '0')) || ','
            || '"VIRTUAL":' || DECODE(NVL(CON_VIRTUAL, 0), 0, 'false', 1, 'true')
            || '}'
    INTO RETURN_VAL
    FROM CONTRACT
    WHERE CON_ID = P_CON_ID;

    RETURN RETURN_VAL;

END;
/


--
-- BD_RECENT_BDETAIL7  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.BD_RECENT_BDETAIL7
(BD_ID, BD_SRCTYPE, BD_DEMO, BD_BIHID, BD_MAPSID, 
 BD_BIRECNO, BD_BOHID1, BD_PACSID1, BD_BORECNO1, BD_BOHID2, 
 BD_PACSID2, BD_BORECNO2, BD_BOHID3, BD_PACSID3, BD_BORECNO3, 
 BD_MESSAGEREFERENCE, BD_DATESUBMIT, BD_DATETIME, BD_MSISDN_A, BD_ORIGINATORIMSI, 
 BD_OGTI, BD_SOURCETYPE, BD_SOURCENAME, BD_MSISDN_B, BD_IMSI, 
 BD_DGTI, BD_SINKTYPE, BD_SINKNAME, BD_MSGTYPE, BD_ATTEMPTS, 
 BD_RECEIPTREQ, BD_STATUS, BD_ERRORPARAM, BD_CDRTID, BD_LENGTH, 
 BD_SHORTID, BD_CONID, BD_TARID, BD_TOCID, BD_INT, 
 BD_IW, BD_IOT, BD_IOT_INTERNAL, BD_ERRID, BD_OGTI_OPKEY, 
 BD_DGTI_OPKEY, BD_SCA_OPKEY, BD_DELIVER_OPKEY, BD_IW_AMOUNT, BD_IW_APMN, 
 BD_IW_CURID, BD_IW_DIR, BD_IW_SCENARIO, BD_IW_CONSTATE)
BEQUEATH DEFINER
AS 
select
BD_ID, BD_SRCTYPE, BD_DEMO, BD_BIHID, BD_MAPSID, BD_BIRECNO, BD_BOHID1,
BD_PACSID1, BD_BORECNO1, BD_BOHID2, BD_PACSID2, BD_BORECNO2, BD_BOHID3,
BD_PACSID3, BD_BORECNO3, BD_MESSAGEREFERENCE, BD_DATESUBMIT, BD_DATETIME,
BD_MSISDN_A, BD_ORIGINATORIMSI, BD_OGTI, BD_SOURCETYPE, BD_SOURCENAME,
BD_MSISDN_B, BD_IMSI, BD_DGTI, BD_SINKTYPE, BD_SINKNAME, BD_MSGTYPE, BD_ATTEMPTS,
BD_RECEIPTREQ, BD_STATUS, BD_ERRORPARAM, BD_CDRTID, BD_LENGTH, BD_SHORTID,
BD_CONID, BD_TARID, BD_TOCID, BD_INT, BD_IW, BD_IOT, BD_IOT_INTERNAL, BD_ERRID,
BD_OGTI_OPKEY, BD_DGTI_OPKEY, BD_SCA_OPKEY, BD_DELIVER_OPKEY, BD_IW_AMOUNT,
BD_IW_APMN, BD_IW_CURID, BD_IW_DIR, BD_IW_SCENARIO, BD_IW_CONSTATE
FROM
    BDETAIL7
WHERE
    BD_BIHID IN  (
        SELECT   BIH_ID
        FROM   BIHEADER
        WHERE    BIH_DATETIME >= sysdate - 1/24
        AND BIH_SRCTYPE = 'M2M'
        AND BIH_RECCOUNT <> 0
    )
AND BD_DATETIME >= sysdate - 15
AND BD_DATETIME < sysdate;


--
-- CONIOT_DIFF  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.CONIOT_DIFF
(CIOT_ID, CIOT_CONID, CIOT_CURID, CIOT_IWDID, CIOT_TRCTID, 
 CIOT_CHNGCNT, CIOT_DATECRE, CIOT_ACIDCRE, CIOT_DATEMOD, CIOT_ACIDMOD)
BEQUEATH DEFINER
AS 
SELECT "CIOT_ID","CIOT_CONID","CIOT_CURID","CIOT_IWDID","CIOT_TRCTID","CIOT_CHNGCNT","CIOT_DATECRE","CIOT_ACIDCRE","CIOT_DATEMOD","CIOT_ACIDMOD" FROM CONIOT@SBS0SBS1  MINUS  SELECT "CIOT_ID","CIOT_CONID","CIOT_CURID","CIOT_IWDID","CIOT_TRCTID","CIOT_CHNGCNT","CIOT_DATECRE","CIOT_ACIDCRE","CIOT_DATEMOD","CIOT_ACIDMOD" FROM SBS1_ADMIN.CONIOT;


--
-- CONIOTE_DIFF  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.CONIOTE_DIFF
(CIOTE_ID, CIOTE_CIOTID, CIOTE_MSGSIZE_MIN, CIOTE_MSGSIZE_MAX, CIOTE_PRICE, 
 CIOTE_CHNGCNT, CIOTE_DATECRE, CIOTE_ACIDCRE, CIOTE_DATEMOD, CIOTE_ACIDMOD)
BEQUEATH DEFINER
AS 
SELECT "CIOTE_ID","CIOTE_CIOTID","CIOTE_MSGSIZE_MIN","CIOTE_MSGSIZE_MAX","CIOTE_PRICE","CIOTE_CHNGCNT","CIOTE_DATECRE","CIOTE_ACIDCRE","CIOTE_DATEMOD","CIOTE_ACIDMOD" FROM CONIOTE@SBS0SBS1  MINUS  SELECT "CIOTE_ID","CIOTE_CIOTID","CIOTE_MSGSIZE_MIN","CIOTE_MSGSIZE_MAX","CIOTE_PRICE","CIOTE_CHNGCNT","CIOTE_DATECRE","CIOTE_ACIDCRE","CIOTE_DATEMOD","CIOTE_ACIDMOD" FROM SBS1_ADMIN.CONIOTE;


--
-- DUPLICATE_CHECK_IPC  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.DUPLICATE_CHECK_IPC
(WTYPE, CONTRACT_ID_1, CONTRACT_ID_2, WARNING, AC_NAME_1, 
 AC_NAME_2)
BEQUEATH DEFINER
AS 
SELECT
 'E',
 C1.CON_ID,
 C2.CON_ID,
 'A Contract of ''<AC_NAME_1>'' conflicts with another one of ''<AC_NAME_2>'': Validity periods may be overlapping or we have duplicate Service Codes.',
 A1.AC_NAME,
 A2.AC_NAME
FROM
 CONTRACT C1,
 CONTRACT C2,
 ACCOUNT A1,
 ACCOUNT A2
WHERE
  C1.CON_ACID = A1.AC_ID
 AND C2.CON_ACID = A2.AC_ID
 AND C2.CON_ID > C1.CON_ID
 AND C1.CON_ESID in ('A','T')
 AND C1.CON_ETID = 'IPC'
 AND C1.CON_SRCTYPE <> 'OTA'
 AND C2.CON_ESID in ('A','T')
 AND C2.CON_ETID = 'IPC'
 AND C2.CON_SRCTYPE <> 'OTA'
 AND C2.CON_SHORTID = C1.CON_SHORTID
 AND (((NVL(C2.CON_DATEEND,to_date('2200','YYYY')) > NVL(C1.CON_DATESTART,to_date('1900','YYYY'))) AND (NVL(C2.CON_DATEEND,to_date('2200','YYYY')) <= NVL(C1.CON_DATEEND,to_date('2200','YYYY')))) OR ((NVL(C2.CON_DATESTART,to_date('1900','YYYY')) >= NVL(C1.CON_DATESTART,to_date('1900','YYYY'))) AND (NVL(C2.CON_DATESTART,to_date('1900','YYYY')) < NVL(C1.CON_DATEEND,to_date('2200','YYYY')))))

UNION

SELECT
 'W',
 C1.CON_ID,
 NULL,
 'The Televote Contract of ''<AC_NAME_1>'' needs an SMS-SUB Service (active or test)',
 A1.AC_NAME,
 NULL
FROM
 CONTRACT C1,
 ACCOUNT A1
WHERE
  C1.CON_ACID = A1.AC_ID
 AND C1.CON_ESID in ('A','T')
 AND C1.CON_ETID = 'IPC'
 AND C1.CON_ESTID = 'MVP'
 AND C1.CON_SRCTYPE = 'ISRV'
 AND NOT EXISTS (SELECT * FROM CONTENTSERVICE CS WHERE CS.CS_CONID = C1.CON_ID AND CS.CS_ESID IN ('A','T') AND CS.CS_ETID = 'MB-SMS-SUB')

UNION

SELECT
 'W',
 C1.CON_ID,
 NULL,
 'The Content Service with Service Code ' || CS.CS_SERVICE  || ' of ''<AC_NAME_1>'' has a non-standard GART field.',
 A1.AC_NAME,
 NULL
FROM
 CONTRACT C1,
 ACCOUNT A1,
 CONTENTSERVICE CS
WHERE
  C1.CON_ACID = A1.AC_ID
 AND CS.CS_CONID = C1.con_id
 AND C1.CON_ESID in ('A','T')
 AND C1.CON_ETID = 'IPC'
 AND (CS.CS_GART IS NULL OR NOT
     (
        (C1.CON_ESTID in ('BN','MLA') AND SUBSTR(CS.CS_ETID,4,1) IN ('M','B') AND CS.CS_GART IN (141))
     OR (C1.CON_ESTID in ('MLA') AND SUBSTR(CS.CS_ETID,4,1) IN ('M','B') AND CS.CS_GART IN (141,69,71))
     OR (C1.CON_ESTID in ('BN','MLA') AND SUBSTR(CS.CS_ETID,4,1) IN ('S') AND CS.CS_GART IN (41))
     OR (C1.CON_ESTID in ('PTS') AND SUBSTR(CS.CS_ETID,4,1) IN ('M','B') AND CS.CS_GART IN (30))
     OR (C1.CON_ESTID in ('MVP') AND SUBSTR(CS.CS_ETID,4,1) IN ('S') AND CS.CS_GART IN (84))
     OR (C1.CON_ESTID in ('PTS') AND SUBSTR(CS.CS_ETID,4,1) IN ('S') AND CS.CS_GART IN (32,160,83))
     ))
 AND CS.CS_ESID in ('A','T')

/*
UNION

SELECT
 'W',
 C1.CON_ID,
 NULL,
 'No VAS Statistics Product Channel could be evaluated for a contract of ''<AC_NAME_1>''',
 A1.AC_NAME,
 NULL
FROM
 CONTRACT C1,
 ACCOUNT A1
WHERE
  C1.CON_ACID = A1.AC_ID
 AND C1.CON_ESID in ('A','T')
 AND C1.CON_ETID = 'IPC'
 AND C1.CON_VSPRCID = 'ERR'

*/

UNION

SELECT
 'E',
 NULL,
 NULL,
 'Third Party ''' || A1.AC_NAME || ''' conflicts with another one ''' || A2.AC_NAME || ''': Duplicate Third Party ID ' || A1.AC_TPID,
 A1.AC_NAME,
 A2.AC_NAME
FROM
 ACCOUNT A1,
 ACCOUNT A2
WHERE   A2.AC_ID > A1.AC_ID
    AND A1.AC_ETID IN ('IP','LA')
    AND A2.AC_ETID IN ('IP','LA')
    AND A1.AC_ESID = 'A'
    AND A2.AC_ESID = 'A'
    AND A2.AC_TPID = A1.AC_TPID

UNION

SELECT distinct
 'W' wtype,
  C1.CON_ID,
  NULL,
  'An MMS Large Account Contract of type ' || CST.CONST_LANG01 || ' must be created for ' || A1.AC_NAME || ' with Short ID ' || C1.CON_SHORTID  warning,
  A1.AC_NAME,
  null
FROM
    CONTRACT C1,
    ACCOUNT A1,
    CONSUBTYPE CST,
    CONTENTSERVICE CS
WHERE
        C1.CON_ACID = A1.AC_ID
    AND C1.CON_ESID IN ('A','T')
    AND C1.CON_ETID = 'IPC'
    AND C1.CON_ESTID IN ('BN','PTS','MLA')
    AND CS.CS_CONID = C1.CON_ID
    AND CS.CS_ESID = 'A'
    AND CS.CS_ETID IN ('MB-MMS-SUB', 'MB-MMS-BLK')
    AND CST.CONST_ID = DECODE(C1.CON_ESTID,'BN','MMSBN','PTS','MMSPS','MLA','MMSLA')
    AND NOT EXISTS (
        SELECT C2.CON_ID
    FROM CONTRACT C2 WHERE C2.CON_CONSOL = C1.CON_SHORTID
    AND C2.CON_ETID = 'MLC'
    AND C2.CON_ESTID = CST.CONST_ID
    AND C2.CON_ESID IN ('A',C1.CON_ESID)
    )

UNION

SELECT
 'E' wtype,
  C1.CON_ID,
  NULL,
  'Invalid Short ID (' || C1.CON_SHORTID || ') found for ' || A1.AC_NAME  warning,
  A1.AC_NAME,
  null
FROM
    CONTRACT C1,
    ACCOUNT A1
WHERE
        C1.CON_ACID = A1.AC_ID
    AND C1.CON_ESID IN ('A','T','E')
    AND C1.CON_ETID = 'IPC'
    AND is_integer(C1.CON_SHORTID,100,99999) = 0

ORDER BY 1, 2;


--
-- GPSH_CONTENT_SERVICE_KEYLIST  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.GPSH_CONTENT_SERVICE_KEYLIST
(CS_KEY, CS_ID)
BEQUEATH DEFINER
AS 
select '["' || CS_CONID || '","' || CS_ID || '"]' cs_key, cs_id from contentservice 
order by NLSSORT(CS_CONID,'NLS_SORT=BINARY') asc, NLSSORT(CS_ID, 'NLS_SORT=BINARY') asc;


--
-- GPSH_TOAC_CON_JSON  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.GPSH_TOAC_CON_JSON
(CKEY, CVALUE)
BEQUEATH DEFINER
AS 
select
    CON_ID as ckey
    ,
      GPULL_TOCON_JSON(CON_ID) as cvalue
  from
    CONTRACT
  where
    CON_ESID in('A','I') 
    and
    CON_ETID = 'TOC' 
    and
      not
      CON_JSON is null 
    and
    CON_ID > '-1' 
  order by
      NLSSORT(CON_ID,'NLS_SORT=BINARY' ) asc;


--
-- IP_SETTLING_DOCUMENTS_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.IP_SETTLING_DOCUMENTS_1
(SEP_LANG00, SET_CURRENCY, SET_NET, SET_VAT, SET_TOTAL, 
 SED_POS, SED_VISIBLE, SED_DESC, SED_ORDER, SED_VATRATE, 
 SED_TOTAL, AC_VAT, AC_VATIDENT, AC_ACCNUMBER, AC_ACCNAME, 
 AC_ACCADDRESS, AC_ACCCLEARNO, AC_ACCPAYNO, AM_ADR_COMPANY, AM_ADR_NAME, 
 AM_ADR_FNAME, AM_ADR_STREET1, AM_ADR_STREET2, AM_ADR_STREET3, AM_ADR_STREET4, 
 AM_ADR_STREET5, AM_ADR_ZIP, AM_ADR_TOWN, AM_ADR_COUNTRY, AI_ADR_COMPANY, 
 AI_ADR_NAME, AI_ADR_FNAME, AI_ADR_STREET1, AI_ADR_STREET2, AI_ADR_STREET3, 
 AI_ADR_STREET4, AI_ADR_STREET5, AI_ADR_ZIP, AI_ADR_TOWN, AI_ADR_COUNTRY, 
 CON_NUMBER, SYS_TAX, SYS_TAXNUMBER, SYS_COSTTYPE, SYS_COMPANY, 
 SYS_STREET1, SYS_STREET2, SYS_STREET3, SYS_STREET4, SYS_STREET5, 
 SYS_COUNTRY, SYS_ZIP, SYS_TOWN, SERVICE_TEXT1, SERVICE_TEXT2, 
 CON_ID, SEP_ID)
BEQUEATH DEFINER
AS 
SELECT
  SEP_LANG02,
  SET_CURRENCY,
  SET_NET,
  SET_VAT,
  SET_TOTAL,
  SED_POS,
  SED_VISIBLE,
  SED_DESC,
  SED_ORDER,
  SED_VATRATE,
  SED_TOTAL,
  AC_VAT,
  AC_VATIDENT,
  AC_ACCNUMBER,
  AC_ACCNAME,
  AC_ACCADDRESS,
  AC_ACCCLEARNO,
  AC_ACCPAYNO,
  AM.ADR_COMPANY,
  AM.ADR_NAME,
  AM.ADR_FNAME,
  AM.ADR_STREET1,
  AM.ADR_STREET2,
  AM.ADR_STREET3,
  AM.ADR_STREET4,
  AM.ADR_STREET5,
  AM.ADR_ZIP,
  AM.ADR_TOWN,
  AM.ADR_COUNTRY,
  AI.ADR_COMPANY,
  AI.ADR_NAME,
  AI.ADR_FNAME,
  AI.ADR_STREET1,
  AI.ADR_STREET2,
  AI.ADR_STREET3,
  AI.ADR_STREET4,
  AI.ADR_STREET5,
  AI.ADR_ZIP,
  AI.ADR_TOWN,
  AI.ADR_COUNTRY,
  NULL CON_NUMBER,
  SYS_TAX,
  SYS_TAXNUMBER,
  SYS_COSTTYPE,
  SYS_COMPANY,
  SYS_STREET1,
  SYS_STREET2,
  SYS_STREET3,
  SYS_STREET4,
  SYS_STREET5,
  SYS_COUNTRY,
  SYS_ZIP,
  SYS_TOWN,
  SRCT_TEXT1LANG02,
  SRCT_TEXT2LANG02,
  CON_ID,
  SEP_ID
FROM
  SETPERIOD,
  SETTLING,
  SETDETAIL,
  CONTRACT,
  ACCOUNT,
  ADDRESS AM,
  ADDRESS AI,
  SYSPARAMETERS,
  SRCTYPE
WHERE
    SETPERIOD.SEP_ID = SETTLING.SET_SEPID
  AND SRCTYPE.SRCT_ID = CONTRACT.CON_SRCTYPE
  AND SETTLING.SET_ID = SETDETAIL.SED_SETID
  AND SETTLING.SET_CONID = CONTRACT.CON_ID
  AND ACCOUNT.AC_ID = CONTRACT.CON_ACID
  AND ACCOUNT.AC_ADRID_MAIN = AM.ADR_ID
  AND ACCOUNT.AC_ADRID_INVOICE = AI.ADR_ID(+)
  AND SEP_ID = TO_CHAR(TRUNC(ADD_MONTHS(sysdate,-1),'MONTH'),'YYYYMM')  
  AND SET_ETID = 'SIS'
  AND SET_ESID = 'V'
  AND SET_DEMO = 0
  AND SED_ESID = 'V';


--
-- LA_SETTLING_ACCUMULATED  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.LA_SETTLING_ACCUMULATED
(SEP_ID, SEP_DATE1, SEP_DATE2, SED_CHARGE, SED_COUNT1, 
 SED_COUNT2, SED_TOTAL, SED_AMOUNTCU, SED_RETSHAREPV, SET_ETID)
BEQUEATH DEFINER
AS 
SELECT
  SEP_ID,
  SEP_DATE1,
  SEP_DATE2,
  SED_CHARGE,
  SUM(SED_COUNT1),
  SUM(SED_COUNT2),
  SUM(SED_TOTAL),
  SUM(SED_AMOUNTCU),
  SUM(SED_RETSHAREPV),
  SET_ETID
FROM
  SETDETAIL,
  SETTLING,
  SETPERIOD
WHERE
    SETDETAIL.SED_SETID = SETTLING.SET_ID
  AND SETTLING.SET_SEPID = SETPERIOD.SEP_ID
  AND SED_ETID IN ('CDR','SMS-MV','SMS-MVN','SMS-MVR','MCC','MOFN','MOIWST')
  AND SET_ETID IN ('SLA','MLA')
  AND SET_ESID = 'A'
  AND SEP_DATE1 = TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
  AND SED_ORDER > TO_CHAR(TRUNC(ADD_MONTHS(sysdate,-1),'MONTH'),'YYYY-MM')
  AND SED_ORDER < TO_CHAR(TRUNC(sysdate,'MONTH'),'YYYY-MM')
GROUP BY
  SEP_ID,
  SEP_DATE1,
  SEP_DATE2,
  SED_CHARGE,
  SET_ETID;


--
-- LA_SETTLING_POSITIONS_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.LA_SETTLING_POSITIONS_1
(SEP_ID, SEP_DATE1, SEP_DATE2, SEP_LANG01, SEP_LANG02, 
 CON_ACNAME, CON_NAME, CON_MBUID, CON_ESID, CON_PSCALL, 
 CON_CONSOL, CON_PRICE, CON_NOTFLAG, SED_CHARGE, SED_TARID, 
 SED_COUNT1, SED_COUNT2, SED_COUNT_ALL, SED_TOTAL_CDRS, SED_TOTAL, 
 SED_POS, SED_ETID, SED_VISIBLE, SED_DESC, SED_ORDER)
BEQUEATH DEFINER
AS 
SELECT
  SEP_ID,
  to_char(SEP_DATE1,'dd.mm.yyyy'),
  to_char(SEP_DATE2-1,'dd.mm.yyyy'),
  SEP_LANG01,
  SEP_LANG02,
  AC_NAME,
  NVL(CON_NAME,AC_NAME),
  CON_MBUID,
  DECODE(CON_ESID,'A','A','I'),
  CON_PSCALL,
  CON_CONSOL,
  CON_PRICE,
  NULL CON_NOTFLAG,
  SED_CHARGE,
  SED_TARID,
  SED_COUNT1,
  SED_COUNT2,
  SED_COUNT1 + SED_COUNT2,
  DECODE(SED_ETID,'MCC',0.0,SED_TOTAL),
  SED_TOTAL,
  SED_POS,
  SED_ETID,
  SED_VISIBLE,
  SED_DESC,
  SED_ORDER
FROM
  SETPERIOD,
  SETTLING,
  SETDETAIL,
  CONTRACT,
  ACCOUNT
WHERE
    SETPERIOD.SEP_ID = SETTLING.SET_SEPID
  AND CON_ACID = AC_ID
  AND SETDETAIL.SED_SETID = SETTLING.SET_ID
  AND CONTRACT.CON_ID = SETTLING.SET_CONID
  AND CON_ETID = 'LAC'
  AND SED_ETID IN ('CDR','SMS-MV','SMS-MVN','SMS-MVR','MCC')
  AND SED_ORDER > TO_CHAR(TRUNC(ADD_MONTHS(sysdate,-1),'MONTH'),'YYYY-MM')
  AND SED_ORDER < TO_CHAR(TRUNC(sysdate,'MONTH'),'YYYY-MM')  
  AND SEP_DATE1 = TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
UNION
SELECT
  SEP_ID,
  to_char(SEP_DATE1,'dd.mm.yyyy'),
  to_char(SEP_DATE2-1,'dd.mm.yyyy'),
  SEP_LANG01,
  SEP_LANG02,
  AC_NAME,
  NVL(CON_NAME,AC_NAME),
  CON_MBUID,
  DECODE(CON_ESID,'A','A','I'),
  CON_PSCALL,
  NVL(BDC_CONSOLIDATION, CON_CONSOL),
  CON_PRICE,
  NULL CON_NOTFLAG,
  CON_PSCALL,
  NVL(BDC_TARID,CON_TARID),
  DECODE(BDC_NPI_B || BDC_PID_B, '10',BDC_COUNT,0),
  DECODE(BDC_NPI_A || BDC_PID_A, '10',BDC_COUNT,0),
  DECODE(BDC_NPI_B || BDC_PID_B, '10',BDC_COUNT,0) + DECODE(BDC_NPI_A || BDC_PID_A, '10',BDC_COUNT,0),
  0.0,
  0.0,
  0,
  'NA',
  0,
  'NA',
  'NA'
FROM
  SETPERIOD, CONTRACT, ACCOUNT, BDCONSOLIDATION
WHERE   CON_ETID = 'LAC'
  AND CON_ACID = AC_ID
  AND SEP_DATE1 = TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
  AND CON_NAME <> 'generated empty'
  AND BDC_SEPID = SEP_ID
  AND BDC_CONID = CON_ID
  AND BDC_ETID = 'SMSC-RAW'
  AND BDC_ESID = 'R'
  AND NOT EXISTS ( 
    SELECT SET_ID FROM SETTLING, SETDETAIL, SETPERIOD
    WHERE SET_ID = SED_SETID
    AND SEP_ID = SET_SEPID
    AND SET_CONID = CON_ID
    AND SED_ETID IN ('CDR','SMS-MV','SMS-MVN','SMS-MVR','MCC')
    AND SEP_DATE1 = TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
    );


--
-- LA_SETTLING_SUMMARY_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.LA_SETTLING_SUMMARY_1
(SEP_ID, SEP_DATE1, SEP_DATE2, SEP_LANG01, SEP_LANG02, 
 CON_ACNAME, CON_NAME, CON_MBUID, CON_ESID, CON_PSCALL, 
 CON_CONSOL, CON_PRICE, CON_NOTFLAG, SED_CHARGE, SED_TARID, 
 SED_COUNT1, SED_COUNT2, SED_COUNT_ALL, SED_TOTAL_CDRS, SED_TOTAL, 
 ADR_COUNTRY)
BEQUEATH DEFINER
AS 
SELECT
  SEP_ID,
  to_char(SEP_DATE1,'dd.mm.yyyy'),
  to_char(SEP_DATE2-1,'dd.mm.yyyy'),
  SEP_LANG01,
  SEP_LANG02,
  AC_NAME,
  NVL(CON_NAME,AC_NAME),
  CON_MBUID,
  DECODE(CON_ESID,'A','A','I'),
  CON_PSCALL,
  CON_CONSOL,
  CON_PRICE,
  NULL CON_NOTFLAG,
  SED_CHARGE,
  SED_TARID,
  SUM(SED_COUNT1),
  SUM(SED_COUNT2),
  SUM(SED_COUNT1 + SED_COUNT2),
  SUM(DECODE(SED_ETID,'MCC',0.00,SED_TOTAL)),
  SUM(SED_TOTAL),
  ADR_COUNTRY
FROM
  SETPERIOD,
  SETTLING,
  SETDETAIL,
  CONTRACT,
  ACCOUNT,
  ADDRESS
WHERE
    SETPERIOD.SEP_ID = SETTLING.SET_SEPID
  AND ADR_ID = AC_ADRID_MAIN
  AND CON_ACID = AC_ID
  AND SETDETAIL.SED_SETID = SETTLING.SET_ID
  AND CONTRACT.CON_ID = SETTLING.SET_CONID
  AND CON_ETID = 'LAC'
  AND SED_ETID IN ('CDR','SMS-MV','SMS-MVN','SMS-MVR','MCC')
  AND SED_ORDER > TO_CHAR(TRUNC(ADD_MONTHS(sysdate,-1),'MONTH'),'YYYY-MM')
  AND SED_ORDER < TO_CHAR(TRUNC(sysdate,'MONTH'),'YYYY-MM')  
  AND SEP_DATE1 = TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
GROUP BY
  SEP_ID,
  SEP_DATE1,
  SEP_DATE2,
  SEP_LANG01,
  SEP_LANG02,
  AC_NAME,
  ADR_COUNTRY,
  NVL(CON_NAME,AC_NAME),
  CON_MBUID,
  DECODE(CON_ESID,'A','A','I'),
  CON_PSCALL,
  CON_CONSOL,
  CON_PRICE,
  SED_CHARGE,
  SED_TARID 
UNION
SELECT
  SEP_ID,
  to_char(SEP_DATE1,'dd.mm.yyyy'),
  to_char(SEP_DATE2-1,'dd.mm.yyyy'),
  SEP_LANG01,
  SEP_LANG02,
  AC_NAME,
  NVL(CON_NAME,AC_NAME),
  CON_MBUID,
  DECODE(CON_ESID,'A','A','I'),
  CON_PSCALL,
  NVL(BDC_CONSOLIDATION, CON_CONSOL),
  CON_PRICE,
  NULL CON_NOTFLAG,
  CON_PSCALL,
  NVL(BDC_TARID,CON_TARID),
  SUM(DECODE(BDC_NPI_B || BDC_PID_B, '10',BDC_COUNT,0)),
  SUM(DECODE(BDC_NPI_A || BDC_PID_A, '10',BDC_COUNT,0)),
  SUM(DECODE(BDC_NPI_B || BDC_PID_B, '10',BDC_COUNT,0) + DECODE(BDC_NPI_A || BDC_PID_A, '10',BDC_COUNT,0)),
  0.0,
  0.0,
  ADR_COUNTRY
FROM
  SETPERIOD, CONTRACT, ACCOUNT, BDCONSOLIDATION, ADDRESS
WHERE   CON_ETID = 'LAC'
  AND CON_ACID = AC_ID
  AND ADR_ID = AC_ADRID_MAIN
  AND SEP_DATE1 = TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
  AND BDC_SEPID = SEP_ID
  AND BDC_CONID = CON_ID
  AND BDC_ETID = 'SMSC-RAW'
  AND BDC_ESID = 'R'
  AND NOT EXISTS ( 
    SELECT SET_ID FROM SETTLING, SETDETAIL, SETPERIOD
    WHERE SET_ID = SED_SETID
    AND SEP_ID = SET_SEPID
    AND SET_CONID = CON_ID
    AND SED_ETID IN ('CDR','SMS-MV','SMS-MVN','SMS-MVR','MCC')
    AND SEP_DATE1 = TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
    )
GROUP BY
  SEP_ID,
  SEP_DATE1,
  SEP_DATE2,
  SEP_LANG01,
  SEP_LANG02,
  AC_NAME,
  ADR_COUNTRY,
  NVL(CON_NAME,AC_NAME),
  CON_MBUID,
  DECODE(CON_ESID,'A','A','I'),
  CON_PSCALL,
  NVL(BDC_CONSOLIDATION, CON_CONSOL),
  CON_PRICE,
  CON_PSCALL,
  NVL(BDC_TARID,CON_TARID)
UNION
SELECT
  SEP_ID,
  to_char(SEP_DATE1,'dd.mm.yyyy'),
  to_char(SEP_DATE2-1,'dd.mm.yyyy'),
  SEP_LANG01,
  SEP_LANG02,
  AC_NAME,
  NVL(CON_NAME,AC_NAME),
  CON_MBUID,
  DECODE(CON_ESID,'A','A','I'),
  CON_PSCALL,
  CON_CONSOL,
  CON_PRICE,
  NULL CON_NOTFLAG,
  CON_PSCALL,
  CON_TARID,
  0,
  0,
  0,
  0.0,
  0.0,
  ADR_COUNTRY
FROM
  SETPERIOD, CONTRACT, ACCOUNT, ADDRESS
WHERE   CON_ETID = 'LAC'
  AND ADR_ID = AC_ADRID_MAIN
  AND CON_ACID = AC_ID
  AND SEP_DATE1 = TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
  AND CON_NAME <> 'generated empty'
  AND CON_ESID = 'A'
  AND NOT EXISTS ( 
    SELECT SET_ID FROM SETTLING, SETDETAIL, SETPERIOD
    WHERE SET_ID = SED_SETID
    AND SEP_ID = SET_SEPID
    AND SET_CONID = CON_ID
    AND SED_ETID IN ('CDR','SMS-MV','SMS-MVN','SMS-MVR','MCC')
    AND SEP_DATE1 = TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
    )
  AND NOT EXISTS ( 
    SELECT BDC_ID FROM BDCONSOLIDATION
    WHERE  BDC_SEPID = SEP_ID
    AND BDC_CONID = CON_ID
    AND BDC_ETID = 'SMSC-RAW'
    AND BDC_ESID = 'R'
    )   
GROUP BY
  SEP_ID,
  SEP_DATE1,
  SEP_DATE2,
  SEP_LANG01,
  SEP_LANG02,
  AC_NAME,
  ADR_COUNTRY,
  NVL(CON_NAME,AC_NAME),
  CON_MBUID,
  DECODE(CON_ESID,'A','A','I'),
  CON_PSCALL,
  CON_CONSOL,
  CON_PRICE,
  CON_PSCALL,
  CON_TARID;


--
-- LA_SETTLING_SUMMARY_1B  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.LA_SETTLING_SUMMARY_1B
(SEP_ID, SEP_DATE1, SEP_DATE2, SEP_LANG01, SEP_LANG02, 
 CON_ACNAME, CON_NAME, CON_MBUID, CON_ESID, CON_HDGROUP, 
 CON_MULA, CON_PSCALL, CON_CONSOL, CON_CUSTNUMBER, CON_PRICE, 
 CON_NOTFLAG, SED_CHARGE, SED_TARID, SED_COUNT1, SED_COUNT2, 
 SED_COUNT_ALL, SED_TOTAL_CDRS, SED_TOTAL, ADR_COUNTRY, SED_COUNT1FN)
BEQUEATH DEFINER
AS 
SELECT
  SEP_ID,
  to_char(SEP_DATE1,'dd.mm.yyyy'),
  to_char(SEP_DATE2-1,'dd.mm.yyyy'),
  SEP_LANG01,
  SEP_LANG02,
  AC_NAME,
  NVL(CON_NAME,AC_NAME),
  CON_MBUID,
  DECODE(CON_ESID,'A','A','I'),
  DECODE(CON_HDGROUP,1,'HG',2,'mVa',3,'mVs'),
  NULL ,
  CON_PSCALL,
  CON_CONSOL,
  NULL CON_CUSTNUMBER,
  CON_PRICE,
  NULL CON_NOTFLAG,
  SED_CHARGE,
  SED_TARID,
  SUM(DECODE(NVL(SED_INT,'0'),'0',SED_COUNT1,0)),
  SUM(SED_COUNT2),
  SUM(SED_COUNT1 + SED_COUNT2),
  SUM(DECODE(SED_ETID,'MCC',0.00,SED_TOTAL)),
  SUM(SED_TOTAL),
  ADR_COUNTRY,
  SUM(DECODE(NVL(SED_INT,'0'),'1',SED_COUNT1,0))
FROM
  SETPERIOD,
  SETTLING,
  SETDETAIL,
  CONTRACT,
  ACCOUNT,
  ADDRESS
WHERE
    SETPERIOD.SEP_ID = SETTLING.SET_SEPID
  AND ADR_ID = AC_ADRID_MAIN
  AND CON_ACID = AC_ID
  AND SETDETAIL.SED_SETID = SETTLING.SET_ID
  AND CONTRACT.CON_ID = SETTLING.SET_CONID
  AND CON_ETID = 'LAC'
  AND SED_ETID IN ('CDR','SMS-MV','SMS-MVN','SMS-MVR','MCC')
  AND SED_ORDER > TO_CHAR(TRUNC(ADD_MONTHS(sysdate,-1),'MONTH'),'YYYY-MM')
  AND SED_ORDER < TO_CHAR(TRUNC(sysdate,'MONTH'),'YYYY-MM')
  AND SEP_DATE1 = TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
GROUP BY
  SEP_ID,
  SEP_DATE1,
  SEP_DATE2,
  SEP_LANG01,
  SEP_LANG02,
  AC_NAME,
  ADR_COUNTRY,
  NVL(CON_NAME,AC_NAME),
  CON_MBUID,
  DECODE(CON_ESID,'A','A','I'),
  DECODE(CON_HDGROUP,1,'HG',2,'mVa',3,'mVs'),
  CON_PSCALL,
  CON_CONSOL,
  CON_PRICE,
  SED_CHARGE,
  SED_TARID
UNION
SELECT
  SEP_ID,
  to_char(SEP_DATE1,'dd.mm.yyyy'),
  to_char(SEP_DATE2-1,'dd.mm.yyyy'),
  SEP_LANG01,
  SEP_LANG02,
  AC_NAME,
  NVL(CON_NAME,AC_NAME),
  CON_MBUID,
  DECODE(CON_ESID,'A','A','I'),
  DECODE(CON_HDGROUP,1,'HG',2,'mVa',3,'mVs'),
  NULL,
  CON_PSCALL,
  NVL(BDC_CONSOLIDATION, CON_CONSOL),
  NULL CON_CUSTNUMBER,
  CON_PRICE,
  NULL CON_NOTFLAG,
  CON_PSCALL,
  NVL(BDC_TARID,CON_TARID),
  SUM(DECODE(BDC_NPI_B || BDC_PID_B || NVL(BDC_INT,'0'), '100',BDC_COUNT,0)),
  SUM(DECODE(BDC_NPI_A || BDC_PID_A, '10',BDC_COUNT,0)),
  SUM(DECODE(BDC_NPI_B || BDC_PID_B, '10',BDC_COUNT,0) + DECODE(BDC_NPI_A || BDC_PID_A, '10',BDC_COUNT,0)),
  0.0,
  0.0,
  ADR_COUNTRY,
  SUM(DECODE(BDC_NPI_B || BDC_PID_B || NVL(BDC_INT,'0'), '101',BDC_COUNT,0))
FROM
  SETPERIOD, CONTRACT, ACCOUNT, BDCONSOLIDATION, ADDRESS
WHERE   CON_ETID = 'LAC'
  AND CON_ACID = AC_ID
  AND ADR_ID = AC_ADRID_MAIN
  AND SEP_DATE1 = TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
  AND BDC_SEPID = SEP_ID
  AND BDC_CONID = CON_ID
  AND BDC_ETID = 'SMSC-RAW'
  AND BDC_ESID = 'R'
  AND NOT EXISTS (
    SELECT SET_ID FROM SETTLING, SETDETAIL, SETPERIOD
    WHERE SET_ID = SED_SETID
    AND SEP_ID = SET_SEPID
    AND SET_CONID = CON_ID
    AND SED_ETID IN ('CDR','SMS-MV','SMS-MVN','SMS-MVR','MCC')
    AND SEP_DATE1 = TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
    )
GROUP BY
  SEP_ID,
  SEP_DATE1,
  SEP_DATE2,
  SEP_LANG01,
  SEP_LANG02,
  AC_NAME,
  ADR_COUNTRY,
  NVL(CON_NAME,AC_NAME),
  CON_MBUID,
  DECODE(CON_ESID,'A','A','I'),
  DECODE(CON_HDGROUP,1,'HG',2,'mVa',3,'mVs'),
  CON_PSCALL,
  NVL(BDC_CONSOLIDATION, CON_CONSOL),
  CON_PRICE,
  CON_PSCALL,
  NVL(BDC_TARID,CON_TARID)
UNION
SELECT
  SEP_ID,
  to_char(SEP_DATE1,'dd.mm.yyyy'),
  to_char(SEP_DATE2-1,'dd.mm.yyyy'),
  SEP_LANG01,
  SEP_LANG02,
  AC_NAME,
  NVL(CON_NAME,AC_NAME),
  CON_MBUID,
  DECODE(CON_ESID,'A','A','I'),
  DECODE(CON_HDGROUP,1,'HG',2,'mVa',3,'mVs'),
  NULL,
  CON_PSCALL,
  CON_CONSOL,
  NULL CON_CUSTNUMBER,
  CON_PRICE,
  NULL CON_NOTFLAG,
  CON_PSCALL,
  CON_TARID,
  0,
  0,
  0,
  0.0,
  0.0,
  ADR_COUNTRY,
  0
FROM
  SETPERIOD, CONTRACT, ACCOUNT, ADDRESS
WHERE   CON_ETID = 'LAC'
  AND ADR_ID = AC_ADRID_MAIN
  AND CON_ACID = AC_ID
  AND SEP_DATE1 = TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
  AND CON_NAME <> 'generated empty'
  AND CON_ESID = 'A'
  AND NOT EXISTS (
    SELECT SET_ID FROM SETTLING, SETDETAIL, SETPERIOD
    WHERE SET_ID = SED_SETID
    AND SEP_ID = SET_SEPID
    AND SET_CONID = CON_ID
    AND SED_ETID IN ('CDR','SMS-MV','SMS-MVN','SMS-MVR','MCC')
    AND SEP_DATE1 = TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
    )
  AND NOT EXISTS (
    SELECT BDC_ID FROM BDCONSOLIDATION
    WHERE  BDC_SEPID = SEP_ID
    AND BDC_CONID = CON_ID
    AND BDC_ETID = 'SMSC-RAW'
    AND BDC_ESID = 'R'
    )
GROUP BY
  SEP_ID,
  SEP_DATE1,
  SEP_DATE2,
  SEP_LANG01,
  SEP_LANG02,
  AC_NAME,
  ADR_COUNTRY,
  NVL(CON_NAME,AC_NAME),
  CON_MBUID,
  DECODE(CON_ESID,'A','A','I'),
  DECODE(CON_HDGROUP,1,'HG',2,'mVa',3,'mVs'),
  CON_PSCALL,
  CON_CONSOL,
  CON_PRICE,
  CON_PSCALL,
  CON_TARID;


--
-- RAM_D_SR054A_DETAILS_2  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.RAM_D_SR054A_DETAILS_2
(REVAH_SRCTYPE, REVAC_DATE, REVAH_DESC, CDR_COUNT)
BEQUEATH DEFINER
AS 
select      
    REVAH_SRCTYPE,      
    revac_date,      
    revah_desc,      
    max(CDR_INCOUNT) cdr_count  
from   RAM_D_SR054A_DETAILS_2_base  
group by REVAH_SRCTYPE, revac_date, revah_desc    
order by 1,2;


--
-- SAMPLES_ICB_M2M_ERR_O  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SAMPLES_ICB_M2M_ERR_O
(TS, DIRECTION, SCENARIO, CALLING_NUMBER, ORIG_SMSC, 
 CALLED_NUMBER, TERMIN_MSC, CALLED_IMSI, APMN, AMOUNT, 
 CURRENCY, OPKEY, SWITCH_ID, CON_STATE, CALL_ID)
BEQUEATH DEFINER
AS 
SELECT /*+ NO_INDEX (BDETAIL7) */
     to_char(BD_DATETIME,'YYYYMMDDhh24miss') as TS
    ,'O' as DIRECTION
    ,NULL as SCENARIO
    ,case
     when length(BD_MSISDN_A) < 6 then 'SC' || BD_MSISDN_A
     else DECODE(IS_NUMERIC(BD_MSISDN_A), 0, '41794992115' , BD_MSISDN_A)
     end  as CALLING_NUMBER
    ,'41794992115' as ORIG_SMSC
    ,BD_MSISDN_B as CALLED_NUMBER
    ,BD_DGTI as TERMIN_MSC
    ,BD_IMSI as CALLED_IMSI
    ,NULL as APMN
    ,NULL as AMOUNT
    ,NULL as CURRENCY
    ,NULL as OPKEY
    ,'M2M'as SWITCH_ID
    ,'E' as CON_STATE
    ,BD_MESSAGEREFERENCE as CALL_ID
FROM
  BDETAIL7
WHERE BD_DATETIME >= ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1)
  AND BD_DATETIME < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
  AND BD_SINKNAME = 'MT_Swisscom'
  AND BD_TOCID IS NULL
  AND BD_MAPSID = 'R'
  AND BD_MSGTYPE = 'M'
  AND BD_IMSI not like '22801%'
  AND BD_STATUS = 0
  AND ROWNUM <= 50


ORDER BY 1;


--
-- SAMPLES_ICB_M2M_INACT_O  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SAMPLES_ICB_M2M_INACT_O
(TS, DIRECTION, SCENARIO, CALLING_NUMBER, ORIG_SMSC, 
 CALLED_NUMBER, TERMIN_MSC, CALLED_IMSI, APMN, AMOUNT, 
 CURRENCY, OPKEY, SWITCH_ID, CON_STATE, CALL_ID)
BEQUEATH DEFINER
AS 
SELECT /*+ NO_INDEX (BDETAIL7) */
     to_char(BD_DATETIME,'YYYYMMDDhh24miss') as TS
    ,'O' as DIRECTION
    ,'1' as SCENARIO
    ,case
     when length(BD_MSISDN_A) < 6 then 'SC' || BD_MSISDN_A
     else DECODE(IS_NUMERIC(BD_MSISDN_A), 0, '41794992115' , BD_MSISDN_A)
     end  as CALLING_NUMBER
    ,'41794992115' as ORIG_SMSC
    ,BD_MSISDN_B as CALLED_NUMBER
    ,BD_DGTI as TERMIN_MSC
    ,BD_IMSI as CALLED_IMSI
    ,CON_CODE as APMN
    ,0.00 as AMOUNT
    ,NULL as CURRENCY
    ,CON_OPKEY as OPKEY
    ,'M2M'as SWITCH_ID
    ,CON_ESID as CON_STATE
    ,BD_MESSAGEREFERENCE as CALL_ID
FROM
  CONTRACT,
  BDETAIL7
WHERE
  CONTRACT.CON_ESID = 'I'
  AND (CON_DATESTART <= BD_DATETIME OR CON_DATESTART IS NULL)
  AND (CON_DATEEND > BD_DATETIME OR CON_DATEEND IS NULL)
  AND BD_DATETIME >= ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1)
  AND BD_DATETIME < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
  AND BD_TOCID = CON_ID
  AND BD_MAPSID = 'R'
  AND BD_MSGTYPE = 'M'
  AND BD_IW = '1'
  AND BD_STATUS = 0
  AND ROWNUM <= 50


ORDER BY 1;


--
-- SAMPLES_ICB_M2M_IW_O  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SAMPLES_ICB_M2M_IW_O
(TS, DIRECTION, SCENARIO, CALLING_NUMBER, ORIG_SMSC, 
 CALLED_NUMBER, TERMIN_MSC, CALLED_IMSI, APMN, AMOUNT, 
 CURRENCY, OPKEY, SWITCH_ID, CON_STATE, CALL_ID)
BEQUEATH DEFINER
AS 
SELECT /*+ NO_INDEX (BDETAIL7) */
     to_char(BD_DATETIME,'YYYYMMDDhh24miss') as TS
    ,'O' as DIRECTION
    ,'1' as SCENARIO
    ,case
     when length(BD_MSISDN_A) < 6 then 'SC' || BD_MSISDN_A
     else DECODE(IS_NUMERIC(BD_MSISDN_A), 0, '41794992115' , BD_MSISDN_A)
     end  as CALLING_NUMBER
    ,'41794992115' as ORIG_SMSC
    ,BD_MSISDN_B as CALLED_NUMBER
    ,BD_DGTI as TERMIN_MSC
    ,BD_IMSI as CALLED_IMSI
    ,CON_CODE as APMN
    ,ROUND(NVL(CIOTE_PRICE,0.00)* dbms_random.value() * 2,4) as AMOUNT
    ,CIOT_CURID as CURRENCY
    ,CON_OPKEY as OPKEY
    ,'M2M'as SWITCH_ID
    ,CON_ESID as CON_STATE
    ,BD_MESSAGEREFERENCE as CALL_ID
FROM
  CONTRACT,
  CONIOT,
  CONIOTE,
  BDETAIL7
WHERE
  CONTRACT.CON_ESID = 'A'
  AND (CON_DATESTART <= BD_DATETIME OR CON_DATESTART IS NULL)
  AND (CON_DATEEND > BD_DATETIME OR CON_DATEEND IS NULL)
  AND CIOT_ID = CIOTE_CIOTID
  AND CIOT_CONID = CON_ID
  AND CIOT_TRCTID IN ('SMS')
  AND CIOT_IWDID IN ('ORIG')
  AND BD_DATETIME >= ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1)
  AND BD_DATETIME < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
  AND BD_TOCID = CON_ID
  AND BD_MAPSID = 'R'
  AND BD_MSGTYPE = 'M'
  AND BD_IW = '1'
  AND BD_STATUS = 0
  AND ROWNUM <= 50


ORDER BY 1;


--
-- SAMPLES_ICB_M2M_ROAM_O  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SAMPLES_ICB_M2M_ROAM_O
(TS, DIRECTION, SCENARIO, CALLING_NUMBER, ORIG_SMSC, 
 CALLED_NUMBER, TERMIN_MSC, CALLED_IMSI, APMN, AMOUNT, 
 CURRENCY, OPKEY, SWITCH_ID, CON_STATE, CALL_ID)
BEQUEATH DEFINER
AS 
SELECT /*+ NO_INDEX (BDETAIL7) */
     to_char(BD_DATETIME,'YYYYMMDDhh24miss') as TS
    ,'O' as DIRECTION
    ,'5' as SCENARIO
    ,case
     when length(BD_MSISDN_A) < 6 then 'SC' || BD_MSISDN_A
     else DECODE(IS_NUMERIC(BD_MSISDN_A), 0, '41794992115' , BD_MSISDN_A)
     end  as CALLING_NUMBER
    ,'41794992115' as ORIG_SMSC
    ,BD_MSISDN_B as CALLED_NUMBER
    ,BD_DGTI as TERMIN_MSC
    ,BD_IMSI as CALLED_IMSI
    ,CON_CODE as APMN
    ,0.00 as AMOUNT
    ,NULL as CURRENCY
    ,CON_OPKEY as OPKEY
    ,'M2M'as SWITCH_ID
    ,CON_ESID as CON_STATE
    ,BD_MESSAGEREFERENCE as CALL_ID
FROM
  CONTRACT,
  BDETAIL7
WHERE
  CONTRACT.CON_ESID in ('A','I')
  AND (CON_DATESTART <= BD_DATETIME OR CON_DATESTART IS NULL)
  AND (CON_DATEEND > BD_DATETIME OR CON_DATEEND IS NULL)
  AND BD_DATETIME >= ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1)
  AND BD_DATETIME < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
  AND BD_TOCID = CON_ID
  AND BD_MAPSID = 'R'
  AND BD_MSGTYPE = 'M'
  AND BD_IW = '0'
  AND BD_STATUS = 0
  AND ROWNUM <= 50


ORDER BY 1;


--
-- SI003A_DETAILS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SI003A_DETAILS
(SED_ORDER, AC_ID, CON_ACNAME, CON_NAME, ADR_COUNTRY, 
 CON_MBUID, CON_ESID, SED_CHARGE, CON_CONSOL, CON_CUSTNUMBER, 
 CON_HDGROUP, CON_MULA, SED_TARID, CON_PRICE, SED_COUNT1, 
 SED_COUNT1FN, SED_COUNT2, SED_COUNT_ALL, SED_TOTAL_CDRS, SED_TOTAL)
BEQUEATH DEFINER
AS 
SELECT
  SED_ORDER,
  AC_ID,
  AC_NAME,
  NVL(CON_NAME,AC_NAME),
  ADR_COUNTRY,
  CON_MBUID,
  DECODE(CON_ESID,'A','A','I'),
  SED_CHARGE,
  CON_CONSOL,
  NULL CON_CUSTNUMBER,
  DECODE(CON_HDGROUP,1,'HG',2,'mVa',3,'mVs'),
  NULL,
  SED_TARID,
  CON_PRICE,
  SUM(DECODE(NVL(SED_INT,'0'),'0',SED_COUNT1,0)),
  SUM(DECODE(NVL(SED_INT,'0'),'1',SED_COUNT1,0)),
  SUM(SED_COUNT2),
  SUM(SED_COUNT1 + SED_COUNT2),
  SUM(DECODE(SED_ETID,'MCC',0.00,SED_TOTAL)),
  SUM(SED_TOTAL)
FROM
  SETTLING,
  SETDETAIL,
  CONTRACT,
  ACCOUNT,
  ADDRESS
WHERE
  ADR_ID = AC_ADRID_MAIN
  AND CON_ACID = AC_ID
  AND SETDETAIL.SED_SETID = SETTLING.SET_ID
  AND CONTRACT.CON_ID = SETTLING.SET_CONID
  AND CON_ETID = 'LAC'
  AND SED_ETID IN ('CDR','SMS-MV','SMS-MVN','SMS-MVR','MCC')
GROUP BY
  SED_ORDER,
  AC_ID,
  AC_NAME,
  ADR_COUNTRY,
  NVL(CON_NAME,AC_NAME),
  CON_MBUID,
  DECODE(CON_ESID,'A','A','I'),
  DECODE(CON_HDGROUP,1,'HG',2,'mVa',3,'mVs'),
  CON_PSCALL,
  CON_CONSOL,
  CON_PRICE,
  SED_CHARGE,
  SED_TARID;


--
-- SI011A_DETAILS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SI011A_DETAILS
(DATE1, DATE2, CON_ID, COUNTMO, COUNTMT, 
 TOTAL)
BEQUEATH DEFINER
AS 
SELECT
    SUBSTR(SED_ORDER,1,10)DATE1,
    SUBSTR(SED_ORDER,1,10) DATE2,
    CON_ID,
    SUM(SED_COUNT2) COUNTMO,
    SUM(SED_COUNT1) COUNTMT,
    SUM(SED_COUNT1 + SED_COUNT2) TOTAL
FROM
    SETDETAIL,
    SETTLING,
    CONTRACT
WHERE
        SETDETAIL.SED_SETID = SETTLING.SET_ID
    AND CONTRACT.CON_ID = SETTLING.SET_CONID
    AND SED_ETID IN ('CDR','SMS-MV','SMS-MVN','SMS-MVR')
    AND SED_ESID IN ('A')
GROUP BY SUBSTR(SED_ORDER,1,10), CON_ID
ORDER BY 1;


--
-- SL058A_BASE_1A  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SL058A_BASE_1A
(ACID, NAME, CONID, SHORTID, SERVICE, 
 BILLRATE, PRICE, ITEMTYPE, TRC_ETID, TRC_TRCLASS, 
 TRC_TRDID, BILLTEXT, CDR_COUNT, AMOUNTCU, RETSHAREMO, 
 RETSHAREPV, TRCOUNT, TRCOST)
BEQUEATH DEFINER
AS 
SELECT
 AC_ID,
 AC_NAME,
 CON_ID,
 ISC_SHORTID,
 ISC_SERVICE,
 ISC_BILLRATE,
 ISC_PRICE,
 ISC_TRANSPORTMEDIUM || DECODE(CON_SRCTYPE || ISC_CDRTID,'ISRVCTB-CO',' Content/Transport', 'ISRVCTB-MO',' MO/Transport',' Content'),
 NULL,
 NULL,
 NULL,
 DECODE(ISC_CDRTID,'CTB-MO','(MO Message)',ISC_BILLTEXT),
 DECODE(ISC_CDRTID,'CTB-MO', 0, ISC_COUNT),
 NVL(ISC_AMOUNTCU,0.00),
 NVL(ISC_RETSHAREMO,0.00),
 NVL(ISC_RETSHAREPV,0.00),
 DECODE(CON_SRCTYPE,'ISRV',ISC_COUNTTR, 0),
 DECODE(CON_SRCTYPE,'ISRV',ISC_AMOUNTTR, 0)
FROM
 ISCONSOL,
 CONTRACT,
 ACCOUNT
WHERE
  ISCONSOL.ISC_CONID = CONTRACT.CON_ID
 AND ACCOUNT.AC_ID = CONTRACT.CON_ACID
 AND CON_ESTID IN ('BN','MVP')
 AND ISC_ESID = 'R'
 AND ISC_CDRTID IN ('CTB-CO','CTB-MO')
 AND ISC_SEPID = to_char(ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1),'YYYYMM')
 
UNION ALL

SELECT
 AC_ID,
 AC_NAME,
 CON_ID,
 CON_SHORTID,
 CS_SERVICE,
 NULL as BILLRATE,
 0.00 as PRICE,
 SUBSTR(CS_SERVICE,1,3) || DECODE(substr(cs_etid,-3,3),'SUB',' Content/Transport',' MO/Transport') as ITEMTYPE,
 NULL as TRC_ETID,
 NULL as TRC_TRCLASS,
 NULL as TRC_TRDID,
 'NoTraffic' as BILLTEXT,
 0 as CDR_COUNT,
 0.00 as AMOUNTCU,
 0.00 as RETSHAREMO,
 0.00 as RETSHAREPV,
 0 as TRCOUNT,
 0 as TRCOST
FROM ACCOUNT, CONTRACT, CONTENTSERVICE
WHERE AC_ID = CON_ACID
AND CON_ID = CS_CONID
AND CON_ESID = 'A'
AND CON_ESTID IN ('BN','MVP')
AND CON_DATESTART < TRUNC(sysdate,'MONTH')
AND (CON_DATEEND > ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1) or CON_DATEEND IS NULL)
AND CS_ESID = 'A'
AND NOT EXISTS (
    SELECT 1
    FROM ISCONSOL
    WHERE ISCONSOL.ISC_CONID = CONTRACT.CON_ID
    AND ISC_ESID = 'R'
    AND ISC_CDRTID IN ('CTB-CO','CTB-MO')
    AND ISC_SEPID = to_char(ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1),'YYYYMM')
    );


--
-- SL087A_DETAILS_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SL087A_DETAILS_1
(SED_CHARGE, CON_CONSOL, SED_DATE_CHAR, SEDT_VALUE1_NAME, SED_DESC, 
 SED_TARID, RETRY_NAME, RETRY_PRICE, PRICE, CON_ESID, 
 SED_LONGID, SED_COUNT2_MO, SED_COUNT2_MO_INT, SED_COUNT2_MO_IW, SED_COUNT1_NAT, 
 SED_COUNT1_INT, SED_COUNT1_IW, SED_TOTAL, AC_ID, AC_NAME, 
 CON_NAME, ADR_EMAIL, CON_ID, SEDT_VALUE2_ORDER, SED_DATE)
BEQUEATH DEFINER
AS 
SELECT
  SED_CHARGE,
  to_number(NVL(CON_CONSOL,'0')),
  to_char(SED_DATE,'dd.mm.yyyy'),
  SEDT_VALUE1,
  SED_DESC,
  SED_TARID,
  DECODE(SED_ETID || SED_INT,'CDR0',RS_LANG03,'CDR1',RS_LANG03,NULL),
  DECODE(SED_ETID || SED_INT,'CDR0',DECODE(RS_PRICE,0,NULL,RS_PRICE),'CDR1',DECODE(RS_PRICEINT,0,NULL,RS_PRICEINT),NULL),
  DECODE(SUM(SED_COUNT1+SED_COUNT2),1,SUM(SED_TOTAL),0,NULL,SUM(SED_TOTAL)/SUM(SED_COUNT1+SED_COUNT2)),
  DECODE(CON_ESID,'A','A','I'),
  LONGID_RANGE(SED_LONGID,SED_LONGID2),
  SUM(DECODE(SED_ETID,'CDR',SED_COUNT2,'PAG',SED_COUNT2,0)),
  SUM(DECODE(SED_ETID,'MOFNA',SED_COUNT2,0)),
  SUM(DECODE(SED_ETID,'MOIWSA',SED_COUNT2,0)),
  SUM(DECODE(SED_ETID || SED_INT,'CDR0',SED_COUNT1,'PAG0',SED_COUNT1,0)),
  SUM(DECODE(SED_ETID || SED_INT,'CDR1',SED_COUNT1,'PAG1',SED_COUNT1,0)),
  SUM(DECODE(SED_ETID,'IOTLACT',SED_COUNT1,0)),
  SUM(SED_TOTAL),
  AC_ID,
  AC_NAME,
  NVL(CON_NAME,AC_NAME),
  NULL ADR_EMAIL,
  CON_ID,
  SEDT_VALUE2,
  SED_DATE
FROM
  SEDTYPE,
  SETTLING,
  SETDETAIL,
  CONTRACT,
  ACCOUNT,
  RETSCHEMA
WHERE   CONTRACT.CON_ACID = ACCOUNT.AC_ID
  AND RETSCHEMA.RS_ID = CON_RSID
  AND SETDETAIL.SED_SETID = SETTLING.SET_ID
  AND SETDETAIL.SED_ETID = SEDT_ID
  AND CONTRACT.CON_ID = SETTLING.SET_CONID
  AND CON_ETID = 'LAC'
  AND SED_TARID NOT IN ('S','P')
  AND SED_ETID IN ('CDR','PAG','MCC','IOTLACT','MFGR','MFLIDA','MOFNA','MOIWSA')
  AND (SED_ETID <> 'MOIWSA' OR SED_TOTAL <> 0.00)
  AND SED_ORDER > TO_CHAR(TRUNC(ADD_MONTHS(sysdate,-1),'MONTH'),'YYYY-MM')
  AND SED_ORDER < TO_CHAR(TRUNC(sysdate,'MONTH'),'YYYY-MM')
  AND (SED_COUNT1 <> 0 OR SED_COUNT2 <> 0 OR SED_TOTAL <> 0.00)
GROUP BY
  AC_ID,
  AC_NAME,
  SED_CHARGE,
  NVL(CON_NAME,AC_NAME),
  to_number(NVL(CON_CONSOL,'0')),
  SED_DATE,
  SEDT_VALUE2,
  SEDT_VALUE1,
  SED_DESC,
  SED_TARID,
  DECODE(SED_ETID || SED_INT,'CDR0',RS_LANG03,'CDR1',RS_LANG03,NULL),
  DECODE(SED_ETID || SED_INT,'CDR0',DECODE(RS_PRICE,0,NULL,RS_PRICE),'CDR1',DECODE(RS_PRICEINT,0,NULL,RS_PRICEINT),NULL),
  DECODE(CON_ESID,'A','A','I'),
  LONGID_RANGE(SED_LONGID,SED_LONGID2),
  CON_ID

UNION ALL

SELECT
  CON_PSCALL,
  to_number(NVL(CON_CONSOL,'0')),
  to_char(trunc(sysdate,'MONTH')-1,'dd.mm.yyyy'),
  'NoTraffic',
  NULL,
  CON_TARID,
  NULL,
  NULL,
  0,
  'A',
  NULL,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  AC_ID,
  AC_NAME,
  NVL(CON_NAME,AC_NAME),
  NULL ADR_EMAIL,
  CON_ID,
  '00100',
  trunc(sysdate,'MONTH')-1
FROM
  CONTRACT,
  ACCOUNT
WHERE   CONTRACT.CON_ACID = ACCOUNT.AC_ID
  AND CON_ETID = 'LAC'
  AND CON_ESID = 'A'
  AND CON_TARID NOT IN ('S','P')
  AND (CON_DATESTART IS NULL OR CON_DATESTART < TRUNC(sysdate,'MONTH'))
  AND (CON_DATEEND IS NULL OR CON_DATEEND >= TRUNC(sysdate,'MONTH'))
AND NOT EXISTS(
  SELECT SET_ID
  FROM   SEDTYPE, SETTLING, SETDETAIL
  WHERE CONTRACT.CON_ID = SETTLING.SET_CONID
  AND SETDETAIL.SED_SETID = SETTLING.SET_ID
  AND SETDETAIL.SED_ETID = SEDTYPE.SEDT_ID
  AND SED_TARID NOT IN ('S','P')
  AND SED_ETID IN ('CDR','PAG','MCC','IOTLACT','MFGR','MFLIDA','MOFNA','MOIWSA')
  AND (SED_ETID <> 'MOIWSA' OR SED_TOTAL <> 0.00)
  AND SED_ORDER > TO_CHAR(TRUNC(ADD_MONTHS(sysdate,-1),'MONTH'),'YYYY-MM')
  AND SED_ORDER < TO_CHAR(TRUNC(sysdate,'MONTH'),'YYYY-MM')
  AND (SED_COUNT1 <> 0 OR SED_COUNT2 <> 0 OR SED_TOTAL <> 0.00)
)
GROUP BY
  AC_ID,
  AC_NAME,
  CON_PSCALL,
  NVL(CON_NAME,AC_NAME),
  to_number(NVL(CON_CONSOL,'0')),
  CON_TARID,
  CON_ID

ORDER BY
  20,
  19,
  1,
  21,
  2,
  25,
  24,
  4,
  5,
  6,
  10,
  11,
  23;


--
-- SL091A_DETAILS_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SL091A_DETAILS_1
(SED_CHARGE, CON_CONSOL, SED_DATE_CHAR, SEDT_VALUE1_NAME, SED_DESC, 
 SED_TARID, CON_HDGROUP, PRICE, CON_ESID, SED_LONGID, 
 SED_COUNT2_MO, SED_COUNT2_MO_INT, SED_COUNT2_MO_IW, SED_COUNT1_NAT, SED_COUNT1_INT, 
 SED_COUNT1_IW, SED_TOTAL, AC_ID, AC_NAME, CON_NAME, 
 ADR_EMAIL, CON_ID, SEDT_VALUE2_ORDER, SED_DATE)
BEQUEATH DEFINER
AS 
SELECT
  SED_CHARGE,
  to_number(NVL(CON_CONSOL,'0')),
  to_char(SED_DATE,'dd.mm.yyyy'),
  SEDT_VALUE3,
  SED_DESC,
  SED_TARID,
  DECODE(CON_HDGROUP,0,'',1,'HG',to_char(CON_HDGROUP)),
  DECODE(SUM(SED_COUNT1+SED_COUNT2),1,SUM(SED_TOTAL),0,NULL,SUM(SED_TOTAL)/SUM(SED_COUNT1+SED_COUNT2)),
  DECODE(CON_ESID,'A','A','I'),
  SED_LONGID,
  SUM(DECODE(SED_ETID,'CDR',SED_COUNT2,0)),
  SUM(DECODE(SED_ETID,'MOFNA',SED_COUNT2,0)),
  SUM(DECODE(SED_ETID,'MOIWSA',SED_COUNT2,0)),
  SUM(DECODE(SED_ETID || SED_INT,'CDR0',SED_COUNT1,0)),
  SUM(DECODE(SED_ETID || SED_INT,'CDR1',SED_COUNT1,0)),
  SUM(DECODE(SED_ETID,'IOTLACT',SED_COUNT1,0)),
  SUM(SED_TOTAL),
  AC_ID,
  AC_NAME,
  NVL(CON_NAME,AC_NAME),
  NULL ADR_EMAIL,
  CON_ID,
  SEDT_VALUE4,
  SED_DATE
FROM
  SEDTYPE,
  SETTLING,
  SETDETAIL,
  CONTRACT,
  ACCOUNT
WHERE   CONTRACT.CON_ACID = ACCOUNT.AC_ID
  AND SETDETAIL.SED_SETID = SETTLING.SET_ID
  AND SETDETAIL.SED_ETID = SEDT_ID
  AND CONTRACT.CON_ID = SETTLING.SET_CONID
  AND CON_ETID = 'MLC'
  AND SED_TARID NOT IN ('S','P')
  AND SED_ETID IN ('SMS-MV','SMS-MVN','SMS-MVR','CDR','MCC','IOTLACT','MFGR','MFLIDA','MOFNA','MOIWSA')
  AND (SED_ETID <> 'MOIWSA' OR SED_TOTAL <> 0.00)
  AND SED_ORDER > TO_CHAR(TRUNC(ADD_MONTHS(sysdate,-1),'MONTH'),'YYYY-MM')
  AND SED_ORDER < TO_CHAR(TRUNC(sysdate,'MONTH'),'YYYY-MM')
  AND (SED_COUNT1 <> 0 OR SED_COUNT2 <> 0 OR SED_TOTAL <> 0.00)
GROUP BY
  AC_ID,
  AC_NAME,
  SED_CHARGE,
  NVL(CON_NAME,AC_NAME),
  to_number(NVL(CON_CONSOL,'0')),
  SED_DATE,
  SEDT_VALUE4,
  SEDT_VALUE3,
  SED_DESC,
  SED_TARID,
  DECODE(CON_HDGROUP,0,'',1,'HG',to_char(CON_HDGROUP)),
  DECODE(CON_ESID,'A','A','I'),
  SED_LONGID,
  CON_ID

UNION ALL

SELECT
  CON_PSCALL,
  to_number(NVL(CON_CONSOL,'0')),
  to_char(trunc(sysdate,'MONTH')-1,'dd.mm.yyyy'),
  'NoTraffic',
  NULL,
  CON_TARID,
  DECODE(CON_HDGROUP,0,'',1,'HG',to_char(CON_HDGROUP)),
  0,
  'A',
  NULL,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  AC_ID,
  AC_NAME,
  NVL(CON_NAME,AC_NAME),
  NULL ADR_EMAIL,
  CON_ID,
  '00100',
  trunc(sysdate,'MONTH')-1
FROM
  CONTRACT,
  ACCOUNT
WHERE   CONTRACT.CON_ACID = ACCOUNT.AC_ID
  AND CON_ETID = 'MLC'
  AND CON_ESID = 'A'
  AND CON_TARID NOT in ('S','P')
  AND (CON_DATESTART IS NULL OR CON_DATESTART < TRUNC(sysdate,'MONTH'))
  AND (CON_DATEEND IS NULL OR CON_DATEEND >= TRUNC(sysdate,'MONTH'))
AND NOT EXISTS(
  SELECT SET_ID
  FROM   SEDTYPE, SETTLING, SETDETAIL
  WHERE CONTRACT.CON_ID = SETTLING.SET_CONID
  AND SETDETAIL.SED_SETID = SETTLING.SET_ID
  AND SETDETAIL.SED_ETID = SEDTYPE.SEDT_ID
  AND SED_TARID NOT IN ('S','P')
  AND SED_ETID IN ('SMS-MV','SMS-MVN','SMS-MVR','CDR','MCC','IOTLACT','MFGR','MFLIDA','MOFNA','MOIWSA')
  AND (SED_ETID <> 'MOIWSA' OR SED_TOTAL <> 0.00)
  AND SED_ORDER > TO_CHAR(TRUNC(ADD_MONTHS(sysdate,-1),'MONTH'),'YYYY-MM')
  AND SED_ORDER < TO_CHAR(TRUNC(sysdate,'MONTH'),'YYYY-MM')
  AND (SED_COUNT1 <> 0 OR SED_COUNT2 <> 0 OR SED_TOTAL <> 0.00)
)
GROUP BY
  AC_ID,
  AC_NAME,
  CON_PSCALL,
  NVL(CON_NAME,AC_NAME),
  to_number(NVL(CON_CONSOL,'0')),
  CON_TARID,
  DECODE(CON_HDGROUP,0,'',1,'HG',to_char(CON_HDGROUP)),
  CON_ID

ORDER BY
  19,
  18,
  1,
  20,
  2,
  24,
  23,
  4,
  5,
  6,
  7,
  9,
  10,
  22;


--
-- SMSC_LA_SETTLING_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SMSC_LA_SETTLING_1
(SEP_ID, SEP_DATE1, SEP_DATE2, SEP_LANG01, SEP_LANG02, 
 SEP_LANG03, SEP_LANG04, SET_ID, SET_CONID, SET_DEMO, 
 SET_ESID, CON_MBUID, CON_ACNAME, CON_NAME, CON_PSCALL, 
 CON_ESID, CON_CONSOL, CON_TARID, CON_MINCHARGE, CON_PRICE, 
 SED_ORDER, SED_TOTALCDR, SED_TOTAL, SED_COUNT1, SED_COUNT2, 
 SED_CHARGE, SED_ETID)
BEQUEATH DEFINER
AS 
SELECT
  SEP_ID,
  SEP_DATE1,
  SEP_DATE2-1,
  SEP_LANG01,
  SEP_LANG02,
  SEP_LANG03,
  SEP_LANG04,
  SET_ID,
  SET_CONID,
  SET_DEMO,
  SET_ESID,
  CON_MBUID,
  AC_NAME,
  NVL(CON_NAME,AC_NAME),
  CON_PSCALL,
  CON_ESID,
  CON_CONSOL,
  CON_TARID,
  CON_MINCHARGE,
  CON_PRICE,
  SED_ORDER,
  DECODE(SED_ETID,'MCC',0.0,SED_TOTAL),
  SED_TOTAL,
  SED_COUNT1,
  SED_COUNT2,
  SED_CHARGE,
  SED_ETID
FROM
  SETPERIOD, SETTLING, SETDETAIL, CONTRACT, ACCOUNT
WHERE
    SETPERIOD.SEP_ID = SETTLING.SET_SEPID
  AND CON_ACID = AC_ID
  AND SETDETAIL.SED_SETID = SETTLING.SET_ID
  AND CONTRACT.CON_ID = SETTLING.SET_CONID
  AND SEP_DATE1 = TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
  AND SET_ETID = 'SLA'
  AND SED_ETID IN ('CDR','SMS-MV','SMS-MVN','SMS-MVR','MCC')
  AND SED_ORDER > TO_CHAR(TRUNC(ADD_MONTHS(sysdate,-1),'MONTH'),'YYYY-MM')
  AND SED_ORDER < TO_CHAR(TRUNC(sysdate,'MONTH'),'YYYY-MM')  
  AND SET_DEMO = 0;


--
-- SR002A_DETAILS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR002A_DETAILS
(SEP_ID, SEP_DATE1, SEP_DATE2, SEP_LANG01, SEP_LANG02, 
 CON_ACNAME, CON_NAME, CON_MBUID, CON_ESID, CON_HDGROUP, 
 CON_MULA, CON_PSCALL, CON_CONSOL, CON_CUSTNUMBER, CON_PRICE, 
 CON_NOTFLAG, SED_CHARGE, SED_TARID, SED_COUNT1, SED_COUNT1_FN, 
 SED_COUNT2, SED_COUNT2_FN, SED_COUNT2_IW, SED_TOTAL_MOIWSA, SED_TOTAL_CDRS, 
 SED_TOTAL_MCC, SED_TOTAL_MF, SED_TOTAL, ADR_COUNTRY, AC_ID, 
 CON_ID)
BEQUEATH DEFINER
AS 
SELECT
  SEP_ID,
  to_char(SEP_DATE1,'dd.mm.yyyy'),
  to_char(SEP_DATE2-1,'dd.mm.yyyy'),
  SEP_LANG01,
  SEP_LANG02,
  AC_NAME,
  NVL(CON_NAME,AC_NAME),
  CON_MBUID,
  DECODE(CON_ESID,'A','A','I'),
  DECODE(CON_HDGROUP,0,'',1,'HG',to_char(CON_HDGROUP)),
  DECODE(SED_ETID,'PAG','PAGER','SMS'),
  CON_PSCALL,
  CON_CONSOL,
  NULL con_custnumber,
  CON_PRICE,
  NULL CON_NOTFLAG,
  SED_CHARGE,
  SED_TARID,
  SUM(DECODE(NVL(SED_INT,'0'),'0',SED_COUNT1,0)),
  SUM(DECODE(NVL(SED_INT,'0'),'0',0,SED_COUNT1)),
  SUM(DECODE(SED_ETID,'CDR',SED_COUNT2,'PAG',SED_COUNT2,0)),
  SUM(DECODE(SED_ETID,'MOFN',SED_COUNT2,0)),
  SUM(DECODE(SED_ETID,'MOIWSA',SED_COUNT2,0)),
  SUM(DECODE(SED_ETID,'MOIWSA',SED_TOTAL,0.0)),
  SUM(DECODE(SED_ETID,'MCC',0.0,'MOIWSA',0.0,'MFGR',0.0,'MFLID',0.0,SED_TOTAL)),
  SUM(DECODE(SED_ETID,'MCC',SED_TOTAL,0.0)),
  SUM(DECODE(SED_ETID,'MFGR',SED_TOTAL,'MFLID',SED_TOTAL,0.0)),
  SUM(SED_TOTAL),
  ADR_COUNTRY,
  AC_ID,
  CON_ID
FROM
  SETPERIOD,
  SETTLING,
  SETDETAIL,
  CONTRACT,
  ACCOUNT,
  ADDRESS
WHERE
    SETPERIOD.SEP_ID = SETTLING.SET_SEPID
  AND ADR_ID = AC_ADRID_MAIN
  AND CON_ACID = AC_ID
  AND SETDETAIL.SED_SETID = SETTLING.SET_ID
  AND CONTRACT.CON_ID = SETTLING.SET_CONID
  AND CON_ETID = 'LAC'
  AND SED_ETID IN ('CDR','PAG','MCC','MFGR','MFLID','MOIWSA','MOFN')
  AND SED_ORDER > TO_CHAR(TRUNC(ADD_MONTHS(sysdate,-1),'MONTH'),'YYYY-MM')
  AND SED_ORDER < TO_CHAR(TRUNC(sysdate,'MONTH'),'YYYY-MM')
  AND SED_ESID IN ('A','V')
GROUP BY
  SEP_ID,
  SEP_DATE1,
  SEP_DATE2,
  SEP_LANG01,
  SEP_LANG02,
  AC_NAME,
  ADR_COUNTRY,
  NVL(CON_NAME,AC_NAME),
  CON_MBUID,
  DECODE(CON_ESID,'A','A','I'),
  DECODE(CON_HDGROUP,0,'',1,'HG',to_char(CON_HDGROUP)),
  DECODE(SED_ETID,'PAG','PAGER','SMS'),
  CON_PSCALL,
  CON_ID,
  CON_CONSOL,
  CON_PRICE,
  SED_CHARGE,
  SED_TARID,
  AC_ID
UNION
SELECT
  SEP_ID,
  to_char(SEP_DATE1,'dd.mm.yyyy'),
  to_char(SEP_DATE2-1,'dd.mm.yyyy'),
  SEP_LANG01,
  SEP_LANG02,
  AC_NAME,
  NVL(CON_NAME,AC_NAME),
  CON_MBUID,
  DECODE(CON_ESID,'A','A','I'),
  DECODE(CON_HDGROUP,0,'',1,'HG',to_char(CON_HDGROUP)),
  'SMS',
  CON_PSCALL,
  NVL(BDC_CONSOLIDATION, CON_CONSOL),
  NULL con_custnumber,
  CON_PRICE,
  NULL CON_NOTFLAG,
  CON_PSCALL,
  NVL(BDC_TARID,CON_TARID),
  SUM(DECODE(BDC_NPI_B || BDC_PID_B || NVL(BDC_INT,'0'), '100',BDC_COUNT,0)),
  SUM(DECODE(BDC_NPI_B || BDC_PID_B || NVL(BDC_INT,'0'), '101',BDC_COUNT,0)),
  SUM(DECODE(BDC_NPI_A || BDC_PID_A, '10',BDC_COUNT,0)),
  0,
  0,
  0.0,
  0.0,
  0.0,
  0.0,
  0.0,
  ADR_COUNTRY,
  AC_ID,
  CON_ID
FROM
  SETPERIOD, CONTRACT, ACCOUNT, BDCONSOLIDATION, ADDRESS
WHERE   CON_ETID = 'LAC'
  AND CON_ACID = AC_ID
  AND ADR_ID = AC_ADRID_MAIN
  AND SEP_DATE1 = TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
  AND BDC_SEPID = SEP_ID
  AND BDC_CONID = CON_ID
  AND BDC_ETID = 'SMSC-RAW'
  AND BDC_ESID = 'R'
  AND NOT EXISTS (
    SELECT SET_ID FROM SETTLING, SETDETAIL, SETPERIOD
    WHERE SET_ID = SED_SETID
    AND SEP_ID = SET_SEPID
    AND SET_CONID = CON_ID
    AND SED_ETID IN ('CDR','PAG','MCC','MFGR','MFLID','MOFN')
    AND SEP_DATE1 = TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
    AND SED_ESID IN ('A','V')
  )
GROUP BY
  SEP_ID,
  SEP_DATE1,
  SEP_DATE2,
  SEP_LANG01,
  SEP_LANG02,
  AC_NAME,
  ADR_COUNTRY,
  NVL(CON_NAME,AC_NAME),
  CON_MBUID,
  DECODE(CON_ESID,'A','A','I'),
  DECODE(CON_HDGROUP,0,'',1,'HG',to_char(CON_HDGROUP)),
  CON_PSCALL,
  CON_ID,
  NVL(BDC_CONSOLIDATION, CON_CONSOL),
  CON_PRICE,
  CON_PSCALL,
  NVL(BDC_TARID,CON_TARID),
  AC_ID
UNION
SELECT
  SEP_ID,
  to_char(SEP_DATE1,'dd.mm.yyyy'),
  to_char(SEP_DATE2-1,'dd.mm.yyyy'),
  SEP_LANG01,
  SEP_LANG02,
  AC_NAME,
  NVL(CON_NAME,AC_NAME),
  CON_MBUID,
  DECODE(CON_ESID,'A','A','I'),
  DECODE(CON_HDGROUP,0,'',1,'HG',to_char(CON_HDGROUP)),
  NULL,
  CON_PSCALL,
  CON_CONSOL,
  NULL con_custnumber,
  CON_PRICE,
  NULL CON_NOTFLAG,
  CON_PSCALL,
  CON_TARID,
  0,
  0,
  0,
  0,
  0,
  0.0,
  0.0,
  0.0,
  0.0,
  0.0,
  ADR_COUNTRY,
  AC_ID,
  CON_ID
FROM
  SETPERIOD, CONTRACT, ACCOUNT, ADDRESS
WHERE   CON_ETID = 'LAC'
  AND ADR_ID = AC_ADRID_MAIN
  AND CON_ACID = AC_ID
  AND SEP_DATE1 = TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
  AND NVL(CON_NAME,'*') <> 'generated empty'
  AND CON_ESID = 'A'
  AND NOT EXISTS (
    SELECT SET_ID FROM SETTLING, SETDETAIL, SETPERIOD
    WHERE SET_ID = SED_SETID
    AND SEP_ID = SET_SEPID
    AND SET_CONID = CON_ID
    AND SED_ETID IN ('CDR','PAG','MCC','MFGR','MFLID','MOFN')
    AND SEP_DATE1 = TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
    AND SED_ESID IN ('A','V')
  )
  AND NOT EXISTS (
    SELECT BDC_ID FROM BDCONSOLIDATION
    WHERE  BDC_SEPID = SEP_ID
    AND BDC_CONID = CON_ID
    AND BDC_ETID = 'SMSC-RAW'
    AND BDC_ESID = 'R'
  )
GROUP BY
  SEP_ID,
  SEP_DATE1,
  SEP_DATE2,
  SEP_LANG01,
  SEP_LANG02,
  AC_NAME,
  ADR_COUNTRY,
  NVL(CON_NAME,AC_NAME),
  CON_MBUID,
  DECODE(CON_ESID,'A','A','I'),
  DECODE(CON_HDGROUP,0,'',1,'HG',to_char(CON_HDGROUP)),
  CON_PSCALL,
  CON_CONSOL,
  CON_ID,
  CON_PRICE,
  CON_PSCALL,
  CON_TARID,
  AC_ID
ORDER BY
  1,
  6,
  7,
  8,
  9,
  10,
  11,
  12,
  13,
  14;


--
-- SR003A_DETAILS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR003A_DETAILS
(SEP_ID, SEP_DATE1, SEP_DATE2, SEP_LANG01, SEP_LANG02, 
 CON_ACNAME, CON_NAME, CON_MBUID, CON_ESID, CON_HDGROUP, 
 CON_MULA, CON_PSCALL, CON_CONSOL, CON_CUSTNUMBER, CON_PRICE, 
 CON_NOTFLAG, SED_CHARGE, SED_TARID, SED_COUNT1, SED_COUNT1_FN, 
 SED_COUNT2, SED_COUNT2_FN, SED_COUNT2_IW, SED_TOTAL_MOIWSA, SED_TOTAL_CDRS, 
 SED_TOTAL_MCC, SED_TOTAL_MF, SED_TOTAL, ADR_COUNTRY, AC_ID, 
 CON_ID)
BEQUEATH DEFINER
AS 
SELECT
  SEP_ID,
  to_char(SEP_DATE1,'dd.mm.yyyy'),
  to_char(SEP_DATE2-1,'dd.mm.yyyy'),
  SEP_LANG01,
  SEP_LANG02,
  AC_NAME,
  NVL(CON_NAME,AC_NAME),
  CON_MBUID,
  DECODE(CON_ESID,'A','A','I'),
  DECODE(CON_HDGROUP,0,'',1,'HG',to_char(CON_HDGROUP)),
  DECODE(SED_ETID,'PAG','PAGER','SMS'),
  CON_PSCALL,
  CON_CONSOL,
  NULL con_custnumber,
  CON_PRICE+0.0,
  NULL CON_NOTFLAG,
  SED_CHARGE,
  SED_TARID,
  SUM(DECODE(NVL(SED_INT,'0'),'0',SED_COUNT1,0)),
  SUM(DECODE(NVL(SED_INT,'0'),'0',0,SED_COUNT1)),
  SUM(DECODE(SED_ETID,'CDR',SED_COUNT2,'PAG',SED_COUNT2,0)),
  SUM(DECODE(SED_ETID,'MOFN',SED_COUNT2,0)),
  SUM(DECODE(SED_ETID,'MOIWSA',SED_COUNT2,0)),
  SUM(DECODE(SED_ETID,'MOIWSA',SED_TOTAL,0.0)),
  SUM(DECODE(SED_ETID,'MCC',0.0,'MOIWSA',0.0,'MFGR',0.0,'MFLID',0.0,SED_TOTAL)),
  SUM(DECODE(SED_ETID,'MCC',SED_TOTAL,0.0)),
  SUM(DECODE(SED_ETID,'MFGR',SED_TOTAL,'MFLID',SED_TOTAL,0.0)),
  SUM(SED_TOTAL),
  ADR_COUNTRY,
  AC_ID,
  CON_ID
FROM
  SETPERIOD,
  SETTLING,
  SETDETAIL,
  CONTRACT,
  ACCOUNT,
  ADDRESS
WHERE
    SETPERIOD.SEP_ID = SETTLING.SET_SEPID
  AND ADR_ID = AC_ADRID_MAIN
  AND CON_ACID = AC_ID
  AND SETDETAIL.SED_SETID = SETTLING.SET_ID
  AND CONTRACT.CON_ID = SETTLING.SET_CONID
  AND CON_ETID = 'LAC'
  AND SED_ETID IN ('CDR','PAG','MCC','MFGR','MFLID','MOIWSA','MOFN')
  AND SED_ORDER > TO_CHAR(TRUNC(ADD_MONTHS(sysdate,-1),'MONTH'),'YYYY-MM')
  AND SED_ORDER < TO_CHAR(TRUNC(sysdate,'MONTH'),'YYYY-MM')
  AND SED_ESID IN ('A','V')
GROUP BY
  SEP_ID,
  SEP_DATE1,
  SEP_DATE2,
  SEP_LANG01,
  SEP_LANG02,
  AC_NAME,
  ADR_COUNTRY,
  NVL(CON_NAME,AC_NAME),
  CON_MBUID,
  DECODE(CON_ESID,'A','A','I'),
  DECODE(CON_HDGROUP,0,'',1,'HG',to_char(CON_HDGROUP)),
  DECODE(SED_ETID,'PAG','PAGER','SMS'),
  CON_PSCALL,
  CON_ID,
  CON_CONSOL,
  CON_PRICE+0.0,
  SED_CHARGE,
  SED_TARID,
  AC_ID
UNION
SELECT
  SEP_ID,
  to_char(SEP_DATE1,'dd.mm.yyyy'),
  to_char(SEP_DATE2-1,'dd.mm.yyyy'),
  SEP_LANG01,
  SEP_LANG02,
  AC_NAME,
  NVL(CON_NAME,AC_NAME),
  CON_MBUID,
  DECODE(CON_ESID,'A','A','I'),
  DECODE(CON_HDGROUP,0,'',1,'HG',to_char(CON_HDGROUP)),
  'SMS',
  CON_PSCALL,
  NVL(BDC_CONSOLIDATION, CON_CONSOL),
  NULL con_custnumber,
  CON_PRICE+0.0,
  NULL CON_NOTFLAG,
  CON_PSCALL,
  NVL(BDC_TARID,CON_TARID),
  SUM(DECODE(BDC_NPI_B || BDC_PID_B || NVL(BDC_INT,'0'), '100',BDC_COUNT,0)),
  SUM(DECODE(BDC_NPI_B || BDC_PID_B || NVL(BDC_INT,'0'), '101',BDC_COUNT,0)),
  SUM(DECODE(BDC_NPI_A || BDC_PID_A, '10',BDC_COUNT,0)),
  0,
  0,
  0.0,
  0.0,
  0.0,
  0.0,
  0.0,
  ADR_COUNTRY,
  AC_ID,
  CON_ID
FROM
  SETPERIOD, CONTRACT, ACCOUNT, BDCONSOLIDATION, ADDRESS
WHERE   CON_ETID = 'LAC'
  AND CON_ACID = AC_ID
  AND ADR_ID = AC_ADRID_MAIN
  AND SEP_DATE1 = TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
  AND BDC_SEPID = SEP_ID
  AND BDC_CONID = CON_ID
  AND BDC_ETID = 'SMSC-RAW'
  AND BDC_ESID = 'R'
  AND NOT EXISTS (
    SELECT SET_ID FROM SETTLING, SETDETAIL, SETPERIOD
    WHERE SET_ID = SED_SETID
    AND SEP_ID = SET_SEPID
    AND SET_CONID = CON_ID
    AND SED_ETID IN ('CDR','PAG','MCC','MFGR','MFLID','MOFN')
    AND SEP_DATE1 = TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
    AND SED_ESID IN ('A','V')
  )
GROUP BY
  SEP_ID,
  SEP_DATE1,
  SEP_DATE2,
  SEP_LANG01,
  SEP_LANG02,
  AC_NAME,
  ADR_COUNTRY,
  NVL(CON_NAME,AC_NAME),
  CON_MBUID,
  DECODE(CON_ESID,'A','A','I'),
  DECODE(CON_HDGROUP,0,'',1,'HG',to_char(CON_HDGROUP)),
  CON_PSCALL,
  CON_ID,
  NVL(BDC_CONSOLIDATION, CON_CONSOL),
  CON_PRICE+0.0,
  CON_PSCALL,
  NVL(BDC_TARID,CON_TARID),
  AC_ID
UNION
SELECT
  SEP_ID,
  to_char(SEP_DATE1,'dd.mm.yyyy'),
  to_char(SEP_DATE2-1,'dd.mm.yyyy'),
  SEP_LANG01,
  SEP_LANG02,
  AC_NAME,
  NVL(CON_NAME,AC_NAME),
  CON_MBUID,
  DECODE(CON_ESID,'A','A','I'),
  DECODE(CON_HDGROUP,0,'',1,'HG',to_char(CON_HDGROUP)),
  NULL,
  CON_PSCALL,
  CON_CONSOL,
  NULL con_custnumber,
  CON_PRICE+0.0,
  NULL CON_NOTFLAG,
  CON_PSCALL,
  CON_TARID,
  0,
  0,
  0,
  0,
  0,
  0.0,
  0.0,
  0.0,
  0.0,
  0.0,
  ADR_COUNTRY,
  AC_ID,
  CON_ID
FROM
  SETPERIOD, CONTRACT, ACCOUNT, ADDRESS
WHERE   CON_ETID = 'LAC'
  AND ADR_ID = AC_ADRID_MAIN
  AND CON_ACID = AC_ID
  AND SEP_DATE1 = TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
  AND NVL(CON_NAME,'*') <> 'generated empty'
  AND CON_ESID = 'A'
  AND NOT EXISTS (
    SELECT SET_ID FROM SETTLING, SETDETAIL, SETPERIOD
    WHERE SET_ID = SED_SETID
    AND SEP_ID = SET_SEPID
    AND SET_CONID = CON_ID
    AND SED_ETID IN ('CDR','PAG','MCC','MFGR','MFLID','MOFN')
    AND SEP_DATE1 = TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
    AND SED_ESID IN ('A','V')
  )
  AND NOT EXISTS (
    SELECT BDC_ID FROM BDCONSOLIDATION
    WHERE  BDC_SEPID = SEP_ID
    AND BDC_CONID = CON_ID
    AND BDC_ETID = 'SMSC-RAW'
    AND BDC_ESID = 'R'
  )
GROUP BY
  SEP_ID,
  SEP_DATE1,
  SEP_DATE2,
  SEP_LANG01,
  SEP_LANG02,
  AC_NAME,
  ADR_COUNTRY,
  NVL(CON_NAME,AC_NAME),
  CON_MBUID,
  DECODE(CON_ESID,'A','A','I'),
  DECODE(CON_HDGROUP,0,'',1,'HG',to_char(CON_HDGROUP)),
  CON_PSCALL,
  CON_ID,
  CON_CONSOL,
  CON_PRICE+0.0,
  CON_PSCALL,
  CON_TARID,
  AC_ID
ORDER BY
    6,
    8,
    9,
    10,
    11,
    12,
    13,
    14,
    15,
    16,
    17,
    18;


--
-- SR011A_DETAILS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR011A_DETAILS
(DATE1, DATE2, COUNTMO, COUNTMT, TOTAL)
BEQUEATH DEFINER
AS 
SELECT
    SUBSTR(SED_ORDER,1,10)DATE1,
    SUBSTR(SED_ORDER,1,10) DATE2,
    SUM(SED_COUNT2) COUNTMO,
    SUM(SED_COUNT1) COUNTMT,
    SUM(SED_COUNT1 + SED_COUNT2) TOTAL
FROM
    SETDETAIL,
    SETTLING,
    CONTRACT
WHERE
        SETDETAIL.SED_SETID = SETTLING.SET_ID
    AND CONTRACT.CON_ID = SETTLING.SET_CONID
    AND SED_ETID IN ('CDR','SMS-MV','SMS-MVN','SMS-MVR')
    AND SED_ORDER > TO_CHAR(TRUNC(ADD_MONTHS(sysdate,-1),'MONTH'),'YYYY-MM')
    AND SED_ORDER < TO_CHAR(TRUNC(sysdate,'MONTH'),'YYYY-MM')
    AND SED_ESID IN ('A')
GROUP BY SUBSTR(SED_ORDER,1,10)
ORDER BY 1;


--
-- SR022A_DETAILS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR022A_DETAILS
(ROC_SEPID, HPMN, SMSCOUNT, CON_IOTORIG, AMOUNT, 
 CON_IOTCURORIG)
BEQUEATH DEFINER
AS 
Select
    ROC_SEPID,
    CON_CODE Hpmn,
    Sum(ROC_COUNT) SMSCOUNT,
    CIOTE_PRICE + 0.0,
    Sum(ROC_COUNT)* NVL(CIOTE_PRICE,0.00) Amount,
    CIOT_CURID
From
  ROCONSOLIDATION,
  CONTRACT,
  CONIOT,
  CONIOTE
Where
  ROC_TOCID = CON_ID
  AND ROC_SEPID = TO_CHAR(ADD_MONTHS(SYSDATE,-1),'YYYYMM')
  AND ROC_ESID = 'R'
  AND ROC_ETID NOT IN ('SMS-HR','SMS-EXT','PAGER-EXT')
  AND ROC_STATUS = '0'
  AND ROC_IW = '1'
  AND CON_ESID IN ('A')
  AND CON_ID <> 'FIXNETTOC'
  AND NVL(CON_VIRTUAL,0) = 0
  AND CIOT_ID = CIOTE_CIOTID
  AND CIOT_CONID = CON_ID
  AND CIOT_TRCTID IN ('SMS')
  AND CIOT_IWDID IN ('ORIG')
GROUP By
  ROC_SEPID,
  CON_CODE,
  CIOTE_PRICE,
  CIOT_CURID
UNION ALL
Select
    TO_CHAR(ADD_MONTHS(SYSDATE,-1),'YYYYMM') ROC_SEPID,
    CON_CODE Hpmn,
    0 SMSCOUNT,
    CIOTE_PRICE + 0.0,
    0 Amount,
    CIOT_CURID
From
  CONTRACT,
  CONIOT,
  CONIOTE
Where CON_ESID IN ('A')
  AND CON_DATESTART < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
  AND (CON_DATEEND > ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1) OR CON_DATEEND IS NULL)
  AND CON_ID <> 'FIXNETTOC'
  AND NVL(CON_VIRTUAL,0) = 0
  AND CIOT_ID = CIOTE_CIOTID
  AND CIOT_CONID = CON_ID
  AND CIOT_TRCTID IN ('SMS')
  AND CIOT_IWDID IN ('ORIG')
  AND NOT Exists (
  SELECT ROWID FROM  ROCONSOLIDATION
  WHERE ROC_TOCID = CON_ID
  AND ROC_SEPID = TO_CHAR(ADD_MONTHS(SYSDATE,-1),'YYYYMM')
  AND ROC_ESID = 'R'
  AND ROC_ETID NOT IN ('SMS-HR','SMS-EXT','PAGER-EXT')
  AND ROC_STATUS = '0'
  AND ROC_IW = '1'
  )
GROUP By
  CON_CODE,
  CIOTE_PRICE,
  CIOT_CURID
ORDER By
  1,
  2,
  4,
  6;


--
-- SR022A_DETAILS_OLD  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR022A_DETAILS_OLD
(ROC_SEPID, HPMN, SMSCOUNT, CON_IOTORIG, AMOUNT, 
 CON_IOTCURORIG)
BEQUEATH DEFINER
AS 
Select
    ROC_SEPID,
    CON_CODE Hpmn,
    Sum(ROC_COUNT) SMSCOUNT,
    CIOTE_PRICE + 0.0,
    Sum(ROC_COUNT)* NVL(CIOTE_PRICE,0.00) Amount,
    CIOT_CURID
From
  ROCONSOLIDATION,
  CONTRACT,
  CONIOT,
  CONIOTE
Where
  ROC_TOCID = CON_ID
  AND ROC_SEPID = TO_CHAR(ADD_MONTHS(SYSDATE,-1),'YYYYMM')
  AND ROC_ESID = 'R'
  AND ROC_ETID = 'SMSC-ROAM'
  AND ROC_STATUS = '0'
  AND ROC_IW = '1'
  AND CON_DATESTART < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
  AND (CON_DATEEND > ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1) OR CON_DATEEND IS NULL)
  AND CON_ESID IN ('A')
  AND CON_ID <> 'FIXNETTOC'
  AND NVL(CON_VIRTUAL,0) = 0
  AND CIOT_ID = CIOTE_CIOTID
  AND CIOT_CONID = CON_ID
  AND CIOT_TRCTID IN ('SMS')
  AND CIOT_IWDID IN ('ORIG')
GROUP By
  ROC_SEPID,
  CON_CODE,
  CIOTE_PRICE,
  CIOT_CURID
ORDER By
  ROC_SEPID,
  CON_CODE,
  CIOTE_PRICE,
  CIOT_CURID;


--
-- SR036A_DETAILS_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR036A_DETAILS_1
(LAC_NAME, ROC_CONSOLIDATION, CON_PSCALL, ADR_COUNTRY, TOC_NAME, 
 CON_OPKEY, NBRMIN, NBRMAX, ROC_COUNT, AMOUNTCU, 
 CON_PRICE)
BEQUEATH DEFINER
AS 
SELECT
  ALA.AC_NAME LAC_NAME,
  ROC_CONSOLIDATION,
  CLA.CON_PSCALL CON_PSCALL,
  ADR_COUNTRY,
  ATO.AC_NAME TOC_NAME,
  CTO.CON_OPKEY CON_OPKEY,
  MIN(ROC_NBRMIN) NBRMIN,
  MAX(ROC_NBRMAX) NBRMAX,
  SUM(ROC_COUNT) ROC_COUNT,
  SUM(ROC_COUNT * (NVL(CIOTE_PRICE, 0.0) * EXR_VALUE / CUR_HEADVAL)) AMOUNTCU,
  (NVL(CIOTE_PRICE, 0.0) * EXR_VALUE / CUR_HEADVAL) CON_PRICE
FROM
  ROCONSOLIDATION,
  CONTRACT CLA,
  CONTRACT CTO,
  ACCOUNT ALA,
  ACCOUNT ATO,
  ADDRESS,
  EXCHANGERATE,
  CURRENCY,
  CONIOT,
  CONIOTE
WHERE
    ROCONSOLIDATION.ROC_CONID = CLA.CON_ID
  AND ROCONSOLIDATION.ROC_TOCID = CTO.CON_ID
  AND CUR_ID = NVL(CIOT_CURID, 'CHF')
  AND EXR_CURID = CUR_ID
  AND EXR_START <= TRUNC(SYSDATE,'MONTH')-1
  AND EXR_END > TRUNC(SYSDATE,'MONTH')-1
  AND ALA.AC_ID = CLA.CON_ACID
  AND ATO.AC_ID = CTO.CON_ACID
  AND CTO.CON_DATESTART < TRUNC(SYSDATE,'MONTH')
  AND (CTO.CON_DATEEND > ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1) OR CTO.CON_DATEEND IS NULL)
  AND CTO.CON_ESID = 'A'
  AND ADDRESS.ADR_ID = ATO.AC_ADRID_MAIN
  AND ROC_SEPID = TO_CHAR(ADD_MONTHS(SYSDATE,-1),'YYYYMM')
  AND ROC_ESID = 'R'
  AND ROC_STATUS = '0'
  AND ROC_IW = '1'
  AND ROC_ETID NOT IN ('SMS-HR','SMS-EXT','PAGER-EXT')
  AND ROC_TOCID Is Not NULL
  AND ROC_CONSOLIDATION = '30275'
  AND CIOT_ID = CIOTE_CIOTID
  AND CIOT_CONID = CTO.CON_ID
  AND CIOT_TRCTID IN ('SMS')
  AND CIOT_IWDID IN ('ORIG')
GROUP BY
  ALA.AC_NAME,
  ROC_CONSOLIDATION,
  CLA.CON_PSCALL,
  ADR_COUNTRY,
  ATO.AC_NAME,
  CTO.CON_OPKEY,
  (NVL(CIOTE_PRICE, 0.0) * EXR_VALUE / CUR_HEADVAL)
ORDER BY
  ALA.AC_NAME,
  to_number(ROC_CONSOLIDATION),
  ADR_COUNTRY,
  ATO.AC_NAME;


--
-- SR045A_DETAILS_5  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR045A_DETAILS_5
(AC_NAME, SHORTID, AMT_CONTENT, AMT_TRAFFIC, AMT_TOTAL)
BEQUEATH DEFINER
AS 
SELECT
    AC_NAME,
    SHORTID,
    SUM(AMT_CONTENT),
    SUM(AMT_TRAFFIC),
    SUM(AMT_TOTAL)
FROM sr045a_details_5_base
GROUP BY
    AC_NAME,
    SHORTID
ORDER BY
    AC_NAME,
    SHORTID;


--
-- SR054A_DETAILS_2  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR054A_DETAILS_2
(REVAH_SRCTYPE, REVAC_DATE, REVAH_DESC, CDR_COUNT)
BEQUEATH DEFINER
AS 
select
    REVAH_SRCTYPE,
    revac_date,
    revah_desc,
    max(CDR_INCOUNT) cdr_count
from 		SR054A_DETAILS_2_base
group by	REVAH_SRCTYPE, revac_date, revah_desc

order by 1,2;


--
-- SR059A_BASE_A  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR059A_BASE_A
(GART, NAME, CONID, PREPAID, SHORTID, 
 CDR_COUNT, AMOUNTCU, RETSHAREMO, RETSHAREPV, TC_MMS_MT, 
 TC_MMS_MO, TC_SMS_MT, TC_SMS_MO, MMS_CONTENT_COUNT, MMS_MT_COUNT, 
 MMS_MO_COUNT, SMS_CONTENT_COUNT, SMS_MT_COUNT, SMS_MO_COUNT)
BEQUEATH DEFINER
AS 
SELECT
 ISC_GART,
 AC_NAME,
 CON_ID,
 ISC_PREPAID,
 ISC_SHORTID,
 ISC_COUNT,
 ISC_AMOUNTCU,
 ISC_RETSHAREMO,
 ISC_RETSHAREPV,
 0.00,
 0.00,
 0.00,
 0.00,
 ISC_COUNT,
 0,
 0,
 0,
 0,
 0
FROM
 ISCONSOL,
 CONTRACT,
 ACCOUNT
WHERE
  ISCONSOL.ISC_CONID = CONTRACT.CON_ID
 AND ACCOUNT.AC_ID = CONTRACT.CON_ACID
 AND CON_ESTID = 'BN'
 AND ISC_TRANSPORTMEDIUM = 'MMS'
 AND ISC_ESID = 'R'
 AND ISC_PRICE IS NOT NULL
 AND ISC_CDRTID = 'CTB-CO'
 AND ISC_SEPID = to_char(ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1),'YYYYMM')
 
UNION ALL

SELECT
 ISC_GART,
 AC_NAME,
 CON_ID,
 ISC_PREPAID,
 ISC_SHORTID,
 ISC_COUNT,
 ISC_AMOUNTCU,
 ISC_RETSHAREMO,
 ISC_RETSHAREPV,
 0.00,
 0.00,
 0.00,
 0.00,
 0,
 0,
 0,
 ISC_COUNT,
 0,
 0
FROM
 ISCONSOL,
 CONTRACT,
 ACCOUNT
WHERE
  ISCONSOL.ISC_CONID = CONTRACT.CON_ID
 AND ACCOUNT.AC_ID = CONTRACT.CON_ACID
 AND CON_ESTID = 'BN'
 AND ISC_TRANSPORTMEDIUM = 'SMS'
 AND ISC_ESID = 'R'
 AND ISC_PRICE IS NOT NULL
 AND ISC_CDRTID = 'CTB-CO'
 AND ISC_SEPID = to_char(ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1),'YYYYMM')
 
UNION ALL
 
SELECT
 trim(to_char(CS_GART)),
 AC_NAME,
 CON_ID,
 'NoTraffic',
 CON_SHORTID,
 0,
 0.00,
 0.00,
 0.00,
 0.00,
 0.00,
 0.00,
 0.00,
 0,
 0,
 0,
 0,
 0,
 0
FROM ACCOUNT, CONTRACT, CONTENTSERVICE
WHERE AC_ID = CON_ACID
AND CON_ID = CS_CONID
AND CON_ESID = 'A'
AND CON_ESTID IN ('BN','MVP')
AND CON_DATESTART < TRUNC(sysdate,'MONTH')
AND (CON_DATEEND > ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1) or CON_DATEEND IS NULL)
AND CS_ESID = 'A'
AND NOT EXISTS (
    SELECT 1
    FROM ISCONSOL
    WHERE ISCONSOL.ISC_CONID = CONTRACT.CON_ID
    AND ISC_ESID = 'R'
    AND ISC_CDRTID IN ('CTB-CO','CTB-MO')
    AND ISC_SEPID = to_char(ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1),'YYYYMM')
    );


--
-- SR059A_BASE_A_MVP  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR059A_BASE_A_MVP
(GART, NAME, CONID, SHOW, CAMPAIGN, 
 PREPAID, SHORTID, CDR_COUNT, AMOUNTCU, RETSHAREMO, 
 RETSHAREPV, TC_MMS_MT, TC_MMS_MO, TC_SMS_MT, TC_SMS_MO, 
 MMS_CONTENT_COUNT, MMS_MT_COUNT, MMS_MO_COUNT, SMS_CONTENT_COUNT, SMS_MT_COUNT, 
 SMS_MO_COUNT)
BEQUEATH DEFINER
AS 
SELECT
 ISC_GART,
 AC_NAME,
 CON_ID,
 ISC_SHOW,
 ISC_CAMPAIGN,
 ISC_PREPAID,
 ISC_SHORTID,
 ISC_COUNT,
 ISC_AMOUNTCU,
 ISC_RETSHAREMO,
 ISC_RETSHAREPV,
 0.00,
 0.00,
 0.00,
 0.00,
 ISC_COUNT,
 0,
 0,
 0,
 0,
 0
FROM
 ISCONSOL,
 CONTRACT,
 ACCOUNT
WHERE
  ISCONSOL.ISC_CONID = CONTRACT.CON_ID
 AND ACCOUNT.AC_ID = CONTRACT.CON_ACID
 AND CON_ESTID = 'MVP'
 AND ISC_TRANSPORTMEDIUM = 'MMS'
 AND ISC_ESID = 'R'
 AND ISC_PRICE IS NOT NULL
 AND ISC_CDRTID = 'CTB-CO'
 AND ISC_SEPID = to_char(ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1),'YYYYMM')

UNION ALL

SELECT
 ISC_GART,
 AC_NAME,
 CON_ID,
 ISC_SHOW,
 ISC_CAMPAIGN,
 ISC_PREPAID,
 ISC_SHORTID,
 ISC_COUNT,
 ISC_AMOUNTCU,
 ISC_RETSHAREMO,
 ISC_RETSHAREPV,
 0.00,
 0.00,
 0.00,
 0.00,
 0,
 0,
 0,
 ISC_COUNT,
 0,
 0
FROM
 ISCONSOL,
 CONTRACT,
 ACCOUNT
WHERE
  ISCONSOL.ISC_CONID = CONTRACT.CON_ID
 AND ACCOUNT.AC_ID = CONTRACT.CON_ACID
 AND CON_ESTID = 'MVP'
 AND ISC_TRANSPORTMEDIUM = 'SMS'
 AND ISC_ESID = 'R'
 AND ISC_PRICE IS NOT NULL
 AND ISC_CDRTID = 'CTB-CO'
 AND ISC_SEPID = to_char(ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1),'YYYYMM')
 
 UNION ALL

SELECT
 trim(to_char(CS_GART)),
 AC_NAME,
 CON_ID,
 'NoTraffic',
 'NoTraffic',
 'NoTraffic',
 CON_SHORTID,
 0,
 0.00,
 0.00,
 0.00,
 0.00,
 0.00,
 0.00,
 0.00,
 0,
 0,
 0,
 0,
 0,
 0
FROM ACCOUNT, CONTRACT, CONTENTSERVICE
WHERE AC_ID = CON_ACID
AND CON_ID = CS_CONID
AND CON_ESID = 'A'
AND CON_ESTID = 'MVP'
AND CON_DATESTART < TRUNC(sysdate,'MONTH')
AND (CON_DATEEND > ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1) or CON_DATEEND IS NULL)
AND CS_ESID = 'A'
AND NOT EXISTS (
    SELECT 1
    FROM ISCONSOL
    WHERE ISCONSOL.ISC_CONID = CONTRACT.CON_ID
    AND ISC_ESID = 'R'
    AND ISC_CDRTID IN ('CTB-CO','CTB-MO')
    AND ISC_SEPID = to_char(ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1),'YYYYMM')
    );


--
-- SR059A_BASE_MVP  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR059A_BASE_MVP
(GART, NAME, CONID, SHOW, CAMPAIGN, 
 PREPAID, SHORTID, CDR_COUNT, AMOUNTCU, RETSHAREMO, 
 RETSHAREPV, TC_MMS_MT, TC_MMS_MO, TC_SMS_MT, TC_SMS_MO, 
 MMS_CONTENT_COUNT, MMS_MT_COUNT, MMS_MO_COUNT, SMS_CONTENT_COUNT, SMS_MT_COUNT, 
 SMS_MO_COUNT)
BEQUEATH DEFINER
AS 
SELECT
 GART,
 NAME,
 CONID,
 SHOW,
 CAMPAIGN,
 PREPAID,
 SHORTID,
 CDR_COUNT,
 AMOUNTCU,
 RETSHAREMO,
 RETSHAREPV,
 TC_MMS_MT,
 TC_MMS_MO,
 TC_SMS_MT,
 TC_SMS_MO,
 MMS_CONTENT_COUNT,
 MMS_MT_COUNT,
 MMS_MO_COUNT,
 SMS_CONTENT_COUNT,
 SMS_MT_COUNT,
 SMS_MO_COUNT
FROM
 SR059A_BASE_A_MVP
UNION ALL
SELECT
 GART,
 NAME,
 CONID,
 SHOW,
 CAMPAIGN,
 PREPAID,
 SHORTID,
 CDR_COUNT,
 AMOUNTCU,
 RETSHAREMO,
 RETSHAREPV,
 TC_MMS_MT,
 TC_MMS_MO,
 TC_SMS_MT,
 TC_SMS_MO,
 MMS_CONTENT_COUNT,
 MMS_MT_COUNT,
 MMS_MO_COUNT,
 SMS_CONTENT_COUNT,
 SMS_MT_COUNT,
 SMS_MO_COUNT
FROM
 SR059A_BASE_B_MVP
UNION ALL
SELECT
 GART,
 NAME,
 CONID,
 SHOW,
 CAMPAIGN,
 PREPAID,
 SHORTID,
 CDR_COUNT,
 AMOUNTCU,
 RETSHAREMO,
 RETSHAREPV,
 TC_MMS_MT,
 TC_MMS_MO,
 TC_SMS_MT,
 TC_SMS_MO,
 MMS_CONTENT_COUNT,
 MMS_MT_COUNT,
 MMS_MO_COUNT,
 SMS_CONTENT_COUNT,
 SMS_MT_COUNT,
 SMS_MO_COUNT
FROM
 SR059A_BASE_C_MVP
UNION ALL
SELECT
 GART,
 NAME,
 CONID,
 SHOW,
 CAMPAIGN,
 PREPAID,
 SHORTID,
 CDR_COUNT,
 AMOUNTCU,
 RETSHAREMO,
 RETSHAREPV,
 TC_MMS_MT,
 TC_MMS_MO,
 TC_SMS_MT,
 TC_SMS_MO,
 MMS_CONTENT_COUNT,
 MMS_MT_COUNT,
 MMS_MO_COUNT,
 SMS_CONTENT_COUNT,
 SMS_MT_COUNT,
 SMS_MO_COUNT
FROM
 SR059A_BASE_D_MVP
UNION ALL
SELECT
 GART,
 NAME,
 CONID,
 SHOW,
 CAMPAIGN,
 PREPAID,
 SHORTID,
 CDR_COUNT,
 AMOUNTCU,
 RETSHAREMO,
 RETSHAREPV,
 TC_MMS_MT,
 TC_MMS_MO,
 TC_SMS_MT,
 TC_SMS_MO,
 MMS_CONTENT_COUNT,
 MMS_MT_COUNT,
 MMS_MO_COUNT,
 SMS_CONTENT_COUNT,
 SMS_MT_COUNT,
 SMS_MO_COUNT
FROM
 SR059A_BASE_E_MVP;


--
-- SR059A_DETAILS_5  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR059A_DETAILS_5
(NAME, SHOW, CAMPAIGN, PREPAID, SHORTID, 
 CDR_COUNT, AMOUNTCU, RETSHAREMO, RETSHAREPV, TC_MMS_MT, 
 TC_MMS_MO, TC_SMS_MT, TC_SMS_MO, AMOUNTPAID, SHAREMOBILE)
BEQUEATH DEFINER
AS 
SELECT
 NAME,
 SHOW,
 CAMPAIGN,
 DECODE(PREPAID,'Y','Prepaid','N','Postpaid','U','Unknown',PREPAID),
 SHORTID,
 SUM(CDR_COUNT),
 SUM(AMOUNTCU),
 SUM(RETSHAREMO),
 SUM(RETSHAREPV),
 SUM(TC_MMS_MT),
 SUM(TC_MMS_MO),
 SUM(TC_SMS_MT),
 SUM(TC_SMS_MO),
 SUM(RETSHAREPV)-SUM(TC_MMS_MT)-SUM(TC_MMS_MO)-SUM(TC_SMS_MT)-SUM(TC_SMS_MO),
 SUM(RETSHAREMO)+SUM(TC_MMS_MT)+SUM(TC_MMS_MO)+SUM(TC_SMS_MT)+SUM(TC_SMS_MO)
FROM SR059A_BASE_MVP
GROUP BY
 NAME,
 SHOW,
 CAMPAIGN,
 PREPAID,
 SHORTID
ORDER BY
 NAME,
 SHOW,
 CAMPAIGN,
 PREPAID,
 to_number(SHORTID);


--
-- SR059A_DETAILS_6  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR059A_DETAILS_6
(NAME, SHOW, CAMPAIGN, PREPAID, CDR_COUNT, 
 AMOUNTCU, RETSHAREMO, RETSHAREPV, TC_MMS_MT, TC_MMS_MO, 
 TC_SMS_MT, TC_SMS_MO, AMOUNTPAID, SHAREMOBILE)
BEQUEATH DEFINER
AS 
SELECT
 NAME,
 SHOW,
 CAMPAIGN,
 DECODE(PREPAID,'Y','Prepaid','N','Postpaid','U','Unknown',PREPAID),
 SUM(CDR_COUNT),
 SUM(AMOUNTCU),
 SUM(RETSHAREMO),
 SUM(RETSHAREPV),
 SUM(TC_MMS_MT),
 SUM(TC_MMS_MO),
 SUM(TC_SMS_MT),
 SUM(TC_SMS_MO),
 SUM(RETSHAREPV)-SUM(TC_MMS_MT)-SUM(TC_MMS_MO)-SUM(TC_SMS_MT)-SUM(TC_SMS_MO),
 SUM(RETSHAREMO)+SUM(TC_MMS_MT)+SUM(TC_MMS_MO)+SUM(TC_SMS_MT)+SUM(TC_SMS_MO)
FROM SR059A_BASE_MVP
GROUP BY
 NAME,
 SHOW,
 CAMPAIGN,
 PREPAID
ORDER BY
 NAME,
 SHOW,
 CAMPAIGN,
 PREPAID;


--
-- SR077A_DETAILS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR077A_DETAILS
(SEP_ID, SEP_DATE1, SEP_DATE2, SEP_LANG01, SEP_LANG02, 
 CON_ACNAME, CON_NAME, CON_MBUID, CON_ESID, CON_HDGROUP, 
 CON_MULA, CON_PSCALL, CON_CONSOL, CON_CUSTNUMBER, CON_PRICE, 
 CON_NOTFLAG, SED_CHARGE, SED_TARID, SED_COUNT1, SED_COUNT2, 
 SED_COUNT_ALL, SED_TOTAL_CDRS, SED_TOTAL, ADR_COUNTRY, SED_COUNT1FN, 
 AC_ID)
BEQUEATH DEFINER
AS 
SELECT
  SEP_ID,
  to_char(SEP_DATE1,'dd.mm.yyyy'),
  to_char(SEP_DATE2-1,'dd.mm.yyyy'),
  SEP_LANG01,
  SEP_LANG02,
  AC_NAME,
  NVL(CON_NAME,AC_NAME),
  CON_MBUID,
  DECODE(CON_ESID,'A','A','I'),
  DECODE(CON_HDGROUP,1,'HG',2,'mVa',3,'mVs','N/A'),
  NULL ,
  CON_PSCALL,
  CON_CONSOL,
  NULL con_custnumber,
  CON_PRICE,
  NULL CON_NOTFLAG,
  SED_CHARGE,
  SED_TARID,
  SUM(DECODE(NVL(SED_INT,'0'),'0',SED_COUNT1,0)),
  SUM(SED_COUNT2),
  SUM(SED_COUNT1 + SED_COUNT2),
  SUM(DECODE(SED_ETID,'MCC',0.0,SED_TOTAL)),
  SUM(SED_TOTAL),
  ADR_COUNTRY,
  SUM(DECODE(NVL(SED_INT,'0'),'1',SED_COUNT1,0)),
  AC_ID
FROM
  SETPERIOD,
  SETTLING,
  SETDETAIL,
  CONTRACT,
  ACCOUNT,
  ADDRESS
WHERE
    SETPERIOD.SEP_ID = SETTLING.SET_SEPID
  AND ADR_ID = AC_ADRID_MAIN
  AND CON_ACID = AC_ID
  AND SETDETAIL.SED_SETID = SETTLING.SET_ID
  AND CONTRACT.CON_ID = SETTLING.SET_CONID
  AND CON_ETID = 'MLC'
  AND SED_ETID IN ('CDR','MCC')
  AND SED_TARID NOT IN ('S','P','T')
  AND SED_ORDER > TO_CHAR(TRUNC(ADD_MONTHS(sysdate,-1),'MONTH'),'YYYY-MM')
  AND SED_ORDER < TO_CHAR(TRUNC(sysdate,'MONTH'),'YYYY-MM')
GROUP BY
  SEP_ID,
  SEP_DATE1,
  SEP_DATE2,
  SEP_LANG01,
  SEP_LANG02,
  AC_NAME,
  ADR_COUNTRY,
  NVL(CON_NAME,AC_NAME),
  CON_MBUID,
  DECODE(CON_ESID,'A','A','I'),
  DECODE(CON_HDGROUP,1,'HG',2,'mVa',3,'mVs','N/A'),
  CON_PSCALL,
  CON_CONSOL,
  CON_PRICE,
  SED_CHARGE,
  SED_TARID,
  AC_ID
ORDER BY
  6,
  7,
  8,
  9,
  10,11,12,13,14,15,16;


--
-- SR089A_CONTRACT  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR089A_CONTRACT
(CON_OPKEY, CON_CODE, CURID_ORIG, PRICE_ORIG, CURID_TERM, 
 PRICE_TERM, CON_VIRTUAL)
BEQUEATH DEFINER
AS 
SELECT
	CON_OPKEY,
	CON_CODE,
	IOT_ORIG.CIOT_CURID        CURID_ORIG,
	IOTE_ORIG.CIOTE_PRICE      PRICE_ORIG,
	IOT_TERM.CIOT_CURID        CURID_TERM,
	IOTE_TERM.CIOTE_PRICE      PRICE_TERM,
	CON_VIRTUAL
FROM
	CONTRACT,
	CONIOT IOT_TERM,
	CONIOT IOT_ORIG,
	CONIOTE IOTE_TERM,
	CONIOTE IOTE_ORIG
WHERE
		CONTRACT.CON_ID = IOT_TERM.CIOT_CONID
	AND	IOT_TERM.CIOT_ID = IOTE_TERM.CIOTE_CIOTID
	AND	CONTRACT.CON_ID = IOT_ORIG.CIOT_CONID
	AND	IOT_ORIG.CIOT_ID = IOTE_ORIG.CIOTE_CIOTID
	AND	CON_ETID = 'TOC'
	AND	CON_ESID IN ('A')
	AND	(CON_DATEEND >= ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-0)
	OR	CON_DATEEND IS NULL)
	AND	CON_DATESTART < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-0)
	AND	IOT_TERM.CIOT_TRCTID IN ('SMS')
	AND	IOT_TERM.CIOT_IWDID IN ('TERM')
	AND	IOT_ORIG.CIOT_TRCTID IN ('SMS')
	AND	IOT_ORIG.CIOT_IWDID IN ('ORIG');


--
-- SR111A_BASE_10  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR111A_BASE_10
(ENUM_ID, DATE_PERIOD, DATE_DAYS, AMOUNTCU, RETSHAREPV, 
 RETSHAREMO, AMOUNTTR, LACDR, LAIOT, LAMOFN, 
 LAIWRS)
BEQUEATH DEFINER
AS 
select
    ENUM_ID
    ,
    DATE_PERIOD
    ,
    DATE_DAYS
    ,
    SUM(ISC_AMOUNTCU)
    ,
    SUM(ISC_RETSHAREPV)
    ,
    SUM(ISC_RETSHAREMO)
    ,
    SUM(ISC_AMOUNTTR)
    ,
    0
    ,
    0
    ,
    0
    ,
    0

from    ISCONSOL, SR111A_PERIOD
where   ISC_SEPID = to_char(DATE_FROM,'YYYYMM')
group by ENUM_ID, DATE_PERIOD, DATE_DAYS

UNION ALL

select
    ENUM_ID
    ,
    DATE_PERIOD
    ,
    DATE_DAYS
    ,
    0
    ,
    0
    ,
    0
    ,
    0
    ,
    SUM(DECODE(SED_ETID,'CDR',SED_TOTAL,'MCC',SED_TOTAL,0.0))
    ,
    SUM(DECODE(SED_ETID,'IOTLACT',SED_TOTAL,0.0))
    ,
    SUM(DECODE(SED_ETID,'MOFN',SED_TOTAL,'MFGR',SED_TOTAL,'MFLID',SED_TOTAL, 0.0))
    ,
    SUM(DECODE(SED_ETID,'MOIWST',0.00-SED_TOTAL,0.0))

from    SETDETAIL, SR111A_PERIOD
where   SED_ORDER like DATE_PERIOD || '%'
group by ENUM_ID, DATE_PERIOD, DATE_DAYS

order by 1;


--
-- SR111A_DETAILS_10  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR111A_DETAILS_10
(ENUM_ID, DATE_PERIOD, DATE_DAYS, AMOUNTCU, RETSHAREPV, 
 RETSHAREMO, AMOUNTTR, LACDR, LAIOT, LAMOFN, 
 LAIWRS)
BEQUEATH DEFINER
AS 
select
ENUM_ID, DATE_PERIOD, DATE_DAYS,
    SUM(AMOUNTCU)*30/DATE_DAYS,
    SUM(RETSHAREPV)*30/DATE_DAYS,
    SUM(RETSHAREMO)*30/DATE_DAYS,
    SUM(AMOUNTTR)*30/DATE_DAYS,
    SUM(LACDR)*30/DATE_DAYS,
    SUM(LAIOT)*30/DATE_DAYS,
    SUM(LAMOFN)*30/DATE_DAYS,
    SUM(LAIWRS)*30/DATE_DAYS

from   SR111A_BASE_10
group by ENUM_ID, DATE_PERIOD, DATE_DAYS

order by 1;


--
-- SR116A_DETAILS_4  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR116A_DETAILS_4
(LAC_NAME, LAC_SHORTID, LAC_TARID, ROC_FROMDATE, ROC_TODATE, 
 ROC_COUNT, ROC_IOT_INTERNAL, ROC_TURNOVER, ROC_IOT_PRC)
BEQUEATH DEFINER
AS 
select
    LAC_NAME
    ,
    LAC_SHORTID
    ,
    LAC_TARID
    ,
    ROC_FROMDATE
    ,
    ROC_TODATE
    ,
    ROC_COUNT
    ,
    ROC_IOT_INTERNAL
    ,
    ROC_TURNOVER
    ,
    case WHEN ROC_TURNOVER = 0.0 THEN NULL
    else
        ROC_IOT_INTERNAL / ROC_TURNOVER
    end
from
(
select
    LAC.AC_NAME LAC_NAME
    ,
    LAC_SHORTID
    ,
    LAC_TARID
    ,
      MIN(ROC_FROMDATE ) ROC_FROMDATE
    ,
      MAX(ROC_TODATE ) ROC_TODATE
    ,
      SUM(ROC_COUNT ) ROC_COUNT
    ,
      SUM(ROC_IOT_INTERNAL ) ROC_IOT_INTERNAL
    , ( select SUM(SED_TOTAL)
        from SETDETAIL
        where SED_ETID in ('CDR', 'MCC')
        and SED_DESC like 'ID' || LAC_SHORTID || '/%'
        and SED_ESID = 'A'
        and SED_UFIH_BOSID = 'O'
        and SED_ORDER like to_char(add_months(sysdate,-1),'YYYY-MM') || '%'
      ) ROC_TURNOVER
  from
    SR116A_BASE
    ,
    ACCOUNT LAC
  where LAC.AC_ID = LAC_ACID
  and LAC_TARID = 'i'
  group by
    LAC_SHORTID
    ,
    LAC_TARID
    ,
    LAC.AC_NAME
)
order by 1,2,3;


--
-- GPSH_CONTENT_SERVICE_JSON  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.GPSH_CONTENT_SERVICE_JSON
(CKEY, CVALUE)
BEQUEATH DEFINER
AS 
select
    cs_key as ckey,
      gpull_content_service_json(cs_id) as cvalue
  from
    gpsh_content_service_keylist;


--
-- SAMPLES_ICB_M2M  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SAMPLES_ICB_M2M
(TS, DIRECTION, SCENARIO, CALLING_NUMBER, ORIG_SMSC, 
 CALLED_NUMBER, TERMIN_MSC, CALLED_IMSI, APMN, AMOUNT, 
 CURRENCY, OPKEY, SWITCH_ID, CON_STATE, CALL_ID)
BEQUEATH DEFINER
AS 
SELECT TS, DIRECTION, SCENARIO, CALLING_NUMBER, ORIG_SMSC, CALLED_NUMBER, TERMIN_MSC,
CALLED_IMSI, APMN, AMOUNT, CURRENCY, OPKEY, SWITCH_ID, CON_STATE, CALL_ID
FROM SAMPLES_ICB_M2M_IW_O

UNION ALL

SELECT TS, DIRECTION, SCENARIO, CALLING_NUMBER, ORIG_SMSC, CALLED_NUMBER, TERMIN_MSC,
CALLED_IMSI, APMN, AMOUNT, CURRENCY, OPKEY, SWITCH_ID, CON_STATE, CALL_ID
FROM SAMPLES_ICB_M2M_INACT_O

UNION ALL

SELECT TS, DIRECTION, SCENARIO, CALLING_NUMBER, ORIG_SMSC, CALLED_NUMBER, TERMIN_MSC,
CALLED_IMSI, APMN, AMOUNT, CURRENCY, OPKEY, SWITCH_ID, CON_STATE, CALL_ID
FROM SAMPLES_ICB_M2M_ERR_O

UNION ALL

SELECT TS, DIRECTION, SCENARIO, CALLING_NUMBER, ORIG_SMSC, CALLED_NUMBER, TERMIN_MSC,
CALLED_IMSI, APMN, AMOUNT, CURRENCY, OPKEY, SWITCH_ID, CON_STATE, CALL_ID
FROM SAMPLES_ICB_M2M_ROAM_O;


--
-- SL058A_BASE_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SL058A_BASE_1
(ACID, NAME, CONID, SHORTID, SERVICE, 
 BILLRATE, PRICE, ITEMTYPE, TRC_ETID, TRC_TRCLASS, 
 TRC_TRDID, BILLTEXT, CDR_COUNT, AMOUNTCU, RETSHAREMO, 
 RETSHAREPV, TRCOUNT, TRCOST)
BEQUEATH DEFINER
AS 
SELECT
 ACID,
 NAME,
 CONID,
 SHORTID,
 SERVICE,
 BILLRATE,
 PRICE,
 ITEMTYPE,
 TRC_ETID,
 TRC_TRCLASS,
 TRC_TRDID,
 BILLTEXT,
 CDR_COUNT,
 AMOUNTCU,
 RETSHAREMO,
 RETSHAREPV,
 TRCOUNT,
 TRCOST
FROM SL058A_BASE_1A
UNION ALL
SELECT
 ACID,
 NAME,
 CONID,
 SHORTID,
 SERVICE,
 BILLRATE,
 PRICE,
 ITEMTYPE,
 TRC_ETID,
 TRC_TRCLASS,
 TRC_TRDID,
 BILLTEXT,
 CDR_COUNT,
 AMOUNTCU,
 RETSHAREMO,
 RETSHAREPV,
 TRCOUNT,
 TRCOST
FROM SL058A_BASE_1B;


--
-- SL058A_DETAILS_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SL058A_DETAILS_1
(SHORTID, ITEMTYPE, SERVICE, BILLRATE, PRICE, 
 BILLTEXT, CDR_COUNT, AMOUNTCU, RETSHAREMO, RETSHAREPV, 
 TRCOUNT, TRCOST, AMOUNTPAID, SHAREMOBILE, ACID, 
 CONID, TRC_ETID, TRC_TRCLASS, TRC_TRDID)
BEQUEATH DEFINER
AS 
SELECT
 SHORTID,
 ITEMTYPE,
 SERVICE,
 BILLRATE,
 PRICE,
 BILLTEXT,
 SUM(CDR_COUNT),
 SUM(AMOUNTCU),
 SUM(RETSHAREMO),
 SUM(RETSHAREPV),
 SUM(TRCOUNT),
 SUM(TRCOST),
 SUM(RETSHAREPV-TRCOST),
 SUM(RETSHAREMO+TRCOST),
 ACID,
 CONID,
 TRC_ETID,
 TRC_TRCLASS,
 TRC_TRDID
FROM SL058A_BASE_1
GROUP BY
 SHORTID,
 ITEMTYPE,
 SERVICE,
 BILLRATE,
 PRICE,
 BILLTEXT,
 ACID,
 CONID,
 TRC_ETID,
 TRC_TRCLASS,
 TRC_TRDID
ORDER BY
	to_number(SHORTID),
	ITEMTYPE,
	SERVICE,
	BILLRATE,
	PRICE,
	TRC_TRDID,
	TRC_TRCLASS,
	BILLTEXT;


--
-- SR059A_BASE  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR059A_BASE
(GART, NAME, CONID, PREPAID, SHORTID, 
 CDR_COUNT, AMOUNTCU, RETSHAREMO, RETSHAREPV, TC_MMS_MT, 
 TC_MMS_MO, TC_SMS_MT, TC_SMS_MO, MMS_CONTENT_COUNT, MMS_MT_COUNT, 
 MMS_MO_COUNT, SMS_CONTENT_COUNT, SMS_MT_COUNT, SMS_MO_COUNT)
BEQUEATH DEFINER
AS 
SELECT
 GART,
 NAME,
 CONID,
 PREPAID,
 SHORTID,
 CDR_COUNT,
 AMOUNTCU,
 RETSHAREMO,
 RETSHAREPV,
 TC_MMS_MT,
 TC_MMS_MO,
 TC_SMS_MT,
 TC_SMS_MO,
 MMS_CONTENT_COUNT,
 MMS_MT_COUNT,
 MMS_MO_COUNT,
 SMS_CONTENT_COUNT,
 SMS_MT_COUNT,
 SMS_MO_COUNT
FROM
 SR059A_BASE_A
UNION ALL
SELECT
 GART,
 NAME,
 CONID,
 PREPAID,
 SHORTID,
 CDR_COUNT,
 AMOUNTCU,
 RETSHAREMO,
 RETSHAREPV,
 TC_MMS_MT,
 TC_MMS_MO,
 TC_SMS_MT,
 TC_SMS_MO,
 MMS_CONTENT_COUNT,
 MMS_MT_COUNT,
 MMS_MO_COUNT,
 SMS_CONTENT_COUNT,
 SMS_MT_COUNT,
 SMS_MO_COUNT
FROM
 SR059A_BASE_B
UNION ALL
SELECT
 GART,
 NAME,
 CONID,
 PREPAID,
 SHORTID,
 CDR_COUNT,
 AMOUNTCU,
 RETSHAREMO,
 RETSHAREPV,
 TC_MMS_MT,
 TC_MMS_MO,
 TC_SMS_MT,
 TC_SMS_MO,
 MMS_CONTENT_COUNT,
 MMS_MT_COUNT,
 MMS_MO_COUNT,
 SMS_CONTENT_COUNT,
 SMS_MT_COUNT,
 SMS_MO_COUNT
FROM
 SR059A_BASE_C
UNION ALL
SELECT
 GART,
 NAME,
 CONID,
 PREPAID,
 SHORTID,
 CDR_COUNT,
 AMOUNTCU,
 RETSHAREMO,
 RETSHAREPV,
 TC_MMS_MT,
 TC_MMS_MO,
 TC_SMS_MT,
 TC_SMS_MO,
 MMS_CONTENT_COUNT,
 MMS_MT_COUNT,
 MMS_MO_COUNT,
 SMS_CONTENT_COUNT,
 SMS_MT_COUNT,
 SMS_MO_COUNT
FROM
 SR059A_BASE_D
UNION ALL
SELECT
 GART,
 NAME,
 CONID,
 PREPAID,
 SHORTID,
 CDR_COUNT,
 AMOUNTCU,
 RETSHAREMO,
 RETSHAREPV,
 TC_MMS_MT,
 TC_MMS_MO,
 TC_SMS_MT,
 TC_SMS_MO,
 MMS_CONTENT_COUNT,
 MMS_MT_COUNT,
 MMS_MO_COUNT,
 SMS_CONTENT_COUNT,
 SMS_MT_COUNT,
 SMS_MO_COUNT
FROM
 SR059A_BASE_E;


--
-- SR059A_DETAILS_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR059A_DETAILS_1
(NAME, PREPAID, SHORTID, CDR_COUNT, AMOUNTCU, 
 RETSHAREMO, RETSHAREPV, TC_MMS_MT, TC_MMS_MO, TC_SMS_MT, 
 TC_SMS_MO, AMOUNTPAID, SHAREMOBILE)
BEQUEATH DEFINER
AS 
SELECT
 NAME,
 DECODE(PREPAID,'Y','Prepaid','N','Postpaid','U','Unknown',PREPAID),
 SHORTID,
 SUM(CDR_COUNT),
 SUM(AMOUNTCU),
 SUM(RETSHAREMO),
 SUM(RETSHAREPV),
 SUM(TC_MMS_MT),
 SUM(TC_MMS_MO),
 SUM(TC_SMS_MT),
 SUM(TC_SMS_MO),
 SUM(RETSHAREPV)-SUM(TC_MMS_MT)-SUM(TC_MMS_MO)-SUM(TC_SMS_MT)-SUM(TC_SMS_MO),
 SUM(RETSHAREMO)+SUM(TC_MMS_MT)+SUM(TC_MMS_MO)+SUM(TC_SMS_MT)+SUM(TC_SMS_MO)
FROM SR059A_BASE
WHERE (GART is NULL OR GART <> '82')
GROUP BY
 NAME,
 PREPAID,
 SHORTID
ORDER BY
 NAME,
 PREPAID,
 to_number(SHORTID);


--
-- SR059A_DETAILS_2  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR059A_DETAILS_2
(NAME, PREPAID, CDR_COUNT, AMOUNTCU, RETSHAREMO, 
 RETSHAREPV, TC_MMS_MT, TC_MMS_MO, TC_SMS_MT, TC_SMS_MO, 
 AMOUNTPAID, SHAREMOBILE)
BEQUEATH DEFINER
AS 
SELECT
 NAME,
 DECODE(PREPAID,'Y','Prepaid','N','Postpaid','U','Unknown',PREPAID),
 SUM(CDR_COUNT),
 SUM(AMOUNTCU),
 SUM(RETSHAREMO),
 SUM(RETSHAREPV),
 SUM(TC_MMS_MT),
 SUM(TC_MMS_MO),
 SUM(TC_SMS_MT),
 SUM(TC_SMS_MO),
 SUM(RETSHAREPV)-SUM(TC_MMS_MT)-SUM(TC_MMS_MO)-SUM(TC_SMS_MT)-SUM(TC_SMS_MO),
 SUM(RETSHAREMO)+SUM(TC_MMS_MT)+SUM(TC_MMS_MO)+SUM(TC_SMS_MT)+SUM(TC_SMS_MO)
FROM SR059A_BASE
WHERE (GART is NULL OR GART <> '82')
GROUP BY
 NAME,
 PREPAID
ORDER BY
 NAME,
 PREPAID;


--
-- SR059A_DETAILS_3  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR059A_DETAILS_3
(NAME, PREPAID, SHORTID, CDR_COUNT, AMOUNTCU, 
 RETSHAREMO, RETSHAREPV, TC_MMS_MT, TC_MMS_MO, TC_SMS_MT, 
 TC_SMS_MO, AMOUNTPAID, SHAREMOBILE)
BEQUEATH DEFINER
AS 
SELECT
 NAME,
 DECODE(PREPAID,'Y','Prepaid','N','Postpaid','U','Unknown',PREPAID),
 SHORTID,
 SUM(CDR_COUNT),
 SUM(AMOUNTCU),
 SUM(RETSHAREMO),
 SUM(RETSHAREPV),
 SUM(TC_MMS_MT),
 SUM(TC_MMS_MO),
 SUM(TC_SMS_MT),
 SUM(TC_SMS_MO),
 SUM(RETSHAREPV)-SUM(TC_MMS_MT)-SUM(TC_MMS_MO)-SUM(TC_SMS_MT)-SUM(TC_SMS_MO),
 SUM(RETSHAREMO)+SUM(TC_MMS_MT)+SUM(TC_MMS_MO)+SUM(TC_SMS_MT)+SUM(TC_SMS_MO)
FROM SR059A_BASE
WHERE GART = '82'
GROUP BY
 NAME,
 PREPAID,
 SHORTID
ORDER BY
 NAME,
 PREPAID,
 to_number(SHORTID);


--
-- SR059A_DETAILS_4  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR059A_DETAILS_4
(NAME, PREPAID, CDR_COUNT, AMOUNTCU, RETSHAREMO, 
 RETSHAREPV, TC_MMS_MT, TC_MMS_MO, TC_SMS_MT, TC_SMS_MO, 
 AMOUNTPAID, SHAREMOBILE)
BEQUEATH DEFINER
AS 
SELECT
 NAME,
 DECODE(PREPAID,'Y','Prepaid','N','Postpaid','U','Unknown',PREPAID),
 SUM(CDR_COUNT),
 SUM(AMOUNTCU),
 SUM(RETSHAREMO),
 SUM(RETSHAREPV),
 SUM(TC_MMS_MT),
 SUM(TC_MMS_MO),
 SUM(TC_SMS_MT),
 SUM(TC_SMS_MO),
 SUM(RETSHAREPV)-SUM(TC_MMS_MT)-SUM(TC_MMS_MO)-SUM(TC_SMS_MT)-SUM(TC_SMS_MO),
 SUM(RETSHAREMO)+SUM(TC_MMS_MT)+SUM(TC_MMS_MO)+SUM(TC_SMS_MT)+SUM(TC_SMS_MO)
FROM SR059A_BASE
WHERE GART = '82'
GROUP BY
 NAME,
 PREPAID
ORDER BY
 NAME,
 PREPAID;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- BDETAIL  (Table) 
--
CREATE TABLE SBS1_ADMIN.BDETAIL
(
  BD_ID               VARCHAR2(10 BYTE),
  BD_SRCTYPE          VARCHAR2(10 BYTE)         NOT NULL,
  BD_DATETIME         DATE                      NOT NULL,
  BD_DEMO             NUMBER(1)                 NOT NULL,
  BD_BIHID            VARCHAR2(10 BYTE)         NOT NULL,
  BD_MAPSID           VARCHAR2(1 BYTE)          NOT NULL,
  BD_BIRECNO          NUMBER(8)                 NOT NULL,
  BD_BOHID1           VARCHAR2(10 BYTE),
  BD_PACSID1          VARCHAR2(1 BYTE),
  BD_BORECNO1         NUMBER(8),
  BD_BOHID2           VARCHAR2(10 BYTE),
  BD_PACSID2          VARCHAR2(1 BYTE),
  BD_BORECNO2         NUMBER(8),
  BD_BOHID3           VARCHAR2(10 BYTE),
  BD_PACSID3          VARCHAR2(1 BYTE),
  BD_BORECNO3         NUMBER(8),
  BD_CONID            VARCHAR2(10 BYTE),
  BD_PMVID            VARCHAR2(10 BYTE),
  BD_TARID            VARCHAR2(1 BYTE),
  BD_NPI_A            VARCHAR2(2 BYTE),
  BD_TON_A            VARCHAR2(2 BYTE),
  BD_PID_A            VARCHAR2(2 BYTE),
  BD_MSISDN_A         VARCHAR2(20 BYTE)         NOT NULL,
  BD_TON_B            VARCHAR2(2 BYTE),
  BD_NPI_B            VARCHAR2(2 BYTE),
  BD_PID_B            VARCHAR2(2 BYTE),
  BD_MSISDN_B         VARCHAR2(20 BYTE),
  BD_IMSI             VARCHAR2(20 BYTE),
  BD_LENGTH           NUMBER(10),
  BD_PREPAID          VARCHAR2(1 BYTE),
  BD_NODENAME         VARCHAR2(20 BYTE),
  BD_SERVICE          VARCHAR2(20 BYTE),
  BD_SHORTID          VARCHAR2(6 BYTE),
  BD_ITEMNO           NUMBER(4),
  BD_KEYWORD          VARCHAR2(80 BYTE),
  BD_LANGID           VARCHAR2(2 BYTE),
  BD_REQTYPE          NUMBER(4),
  BD_BILLRATE         NUMBER(3),
  BD_AMOUNTCU         NUMBER(9,4),
  BD_RETSHAREPV       NUMBER(9,4),
  BD_RETSHAREMO       NUMBER(9,4),
  BD_VSMSCID          VARCHAR2(20 BYTE),
  BD_CONSOLIDATION    VARCHAR2(6 BYTE),
  BD_STATUS           NUMBER(2),
  BD_TERMDATE         DATE,
  BD_SETTLING         NUMBER(1),
  BD_SETID            VARCHAR2(10 BYTE),
  BD_STORAGE          NUMBER(1),
  BD_DBIDSTORE        VARCHAR2(2 BYTE),
  BD_DATESTORE        DATE,
  BD_ARCHIVE          NUMBER(1),
  BD_DBIDARCH         VARCHAR2(2 BYTE),
  BD_DATEARCH         DATE,
  BD_RECTYPE          NUMBER(2),
  BD_IDENTITY         VARCHAR2(10 BYTE),
  BD_REQSERV          VARCHAR2(3 BYTE),
  BD_SUBSERV          VARCHAR2(3 BYTE),
  BD_OPERATION        VARCHAR2(3 BYTE),
  BD_MULTSM           NUMBER(1),
  BD_SMSEQ            NUMBER(2),
  BD_ANSTYPE          NUMBER(2),
  BD_RETCODE          NUMBER(2),
  BD_RESPMEDIA        NUMBER(1),
  BD_SMSCRESP         NUMBER(1),
  BD_TMINODE          VARCHAR2(10 BYTE),
  BD_REQID            NUMBER(10),
  BD_SERVKEY          VARCHAR2(6 BYTE),
  BD_BILLTEXT         VARCHAR2(80 BYTE),
  BD_LOCATION         VARCHAR2(80 BYTE),
  BD_INFO             VARCHAR2(80 BYTE),
  BD_ZNID             VARCHAR2(10 BYTE),
  BD_NETWORK          VARCHAR2(10 BYTE),
  BD_TPID             VARCHAR2(10 BYTE),
  BD_STYPE            VARCHAR2(10 BYTE),
  BD_BILLTIME         DATE,
  BD_MSGID            VARCHAR2(30 BYTE),
  BD_TRCLASS          NUMBER(10,3),
  BD_AMOUNTTR         NUMBER(9,4),
  BD_TOCID            VARCHAR2(10 BYTE),
  BD_CDRTID           VARCHAR2(10 BYTE),
  BD_INT              VARCHAR2(1 BYTE),
  BD_IW               VARCHAR2(1 BYTE),
  BD_AAATS            VARCHAR2(1 BYTE),
  BD_CONSTID          VARCHAR2(10 BYTE),
  BD_ERRID            VARCHAR2(10 BYTE),
  BD_BILLED           VARCHAR2(1 BYTE),
  BD_RATED            VARCHAR2(1 BYTE),
  BD_PACIDHB          VARCHAR2(10 BYTE),
  BD_OUTPUTHB         VARCHAR2(4000 BYTE),
  BD_BILLINGDOMAIN    VARCHAR2(10 BYTE),
  BD_TRANSPORTMEDIUM  VARCHAR2(10 BYTE),
  BD_CATEGORY         VARCHAR2(20 BYTE),
  BD_TAXRATE          VARCHAR2(10 BYTE),
  BD_TESTMODE         VARCHAR2(10 BYTE),
  BD_REQUESTID        VARCHAR2(20 BYTE),
  BD_COUNTTR          NUMBER(2),
  BD_VSPRCID          VARCHAR2(10 BYTE),
  BD_ORIGSUBMIT       DATE,
  BD_ONLINECHARGE     NUMBER(9,4),
  BD_LTTREQRECCOUNT   NUMBER(8),
  BD_LTTDNRECCOUNT    NUMBER(8),
  BD_LTTDNDATETIME    DATE,
  BD_GART             VARCHAR2(10 BYTE),
  BD_SHOW             VARCHAR2(32 BYTE),
  BD_CAMPAIGN         VARCHAR2(32 BYTE),
  BD_SIGNATURE        VARCHAR2(20 BYTE)
)
NOCOMPRESS 
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            BUFFER_POOL      DEFAULT
           )
PARTITION BY RANGE (BD_DATETIME)
(  
  PARTITION INFO201808 VALUES LESS THAN (TO_DATE(' 2018-09-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    10
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                INITIAL          8M
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201809 VALUES LESS THAN (TO_DATE(' 2018-10-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    10
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                INITIAL          8M
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201810 VALUES LESS THAN (TO_DATE(' 2018-11-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    10
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                INITIAL          8M
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201811 VALUES LESS THAN (TO_DATE(' 2018-12-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    10
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                INITIAL          8M
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201812 VALUES LESS THAN (TO_DATE(' 2019-01-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    10
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                INITIAL          8M
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201901 VALUES LESS THAN (TO_DATE(' 2019-02-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    10
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                INITIAL          8M
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201902 VALUES LESS THAN (TO_DATE(' 2019-03-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    10
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                INITIAL          8M
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               )
);

COMMENT ON TABLE SBS1_ADMIN.BDETAIL IS 'Billing Detail Information';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL.BD_ZNID IS 'detail record id';


/* This object may not be sorted properly in the script due to cirular references. */
--
-- BDETAIL1  (Table) 
--
CREATE TABLE SBS1_ADMIN.BDETAIL1
(
  BD_ID                VARCHAR2(10 BYTE),
  BD_SRCTYPE           VARCHAR2(10 BYTE)        NOT NULL,
  BD_DATETIME          DATE                     NOT NULL,
  BD_DEMO              NUMBER(1)                NOT NULL,
  BD_BIHID             VARCHAR2(10 BYTE)        NOT NULL,
  BD_MAPSID            VARCHAR2(1 BYTE)         NOT NULL,
  BD_BIRECNO           NUMBER(8)                NOT NULL,
  BD_BOHID1            VARCHAR2(10 BYTE),
  BD_PACSID1           VARCHAR2(1 BYTE),
  BD_BORECNO1          NUMBER(8),
  BD_BOHID2            VARCHAR2(10 BYTE),
  BD_PACSID2           VARCHAR2(1 BYTE),
  BD_BORECNO2          NUMBER(8),
  BD_BOHID3            VARCHAR2(10 BYTE),
  BD_PACSID3           VARCHAR2(1 BYTE),
  BD_BORECNO3          NUMBER(8),
  BD_CONID             VARCHAR2(10 BYTE),
  BD_PMVID             VARCHAR2(10 BYTE),
  BD_TARID             VARCHAR2(1 BYTE),
  BD_NPI_A             VARCHAR2(3 BYTE),
  BD_TON_A             VARCHAR2(3 BYTE),
  BD_PID_A             VARCHAR2(3 BYTE),
  BD_MSISDN_A          VARCHAR2(20 BYTE),
  BD_TON_B             VARCHAR2(3 BYTE),
  BD_NPI_B             VARCHAR2(3 BYTE),
  BD_PID_B             VARCHAR2(3 BYTE),
  BD_MSISDN_B          VARCHAR2(20 BYTE),
  BD_IMSI              VARCHAR2(20 BYTE),
  BD_LENGTH            NUMBER(4),
  BD_PREPAID           VARCHAR2(1 BYTE),
  BD_NETWORK           NUMBER(2),
  BD_NODENAME          VARCHAR2(20 BYTE),
  BD_SERVICE           VARCHAR2(10 BYTE),
  BD_SHORTID           VARCHAR2(6 BYTE),
  BD_ITEMNO            NUMBER(4),
  BD_KEYWORD           VARCHAR2(80 BYTE),
  BD_LANGID            VARCHAR2(2 BYTE),
  BD_REQTYPE           NUMBER(4),
  BD_BILLRATE          NUMBER(3),
  BD_AMOUNTCU          NUMBER(9,4),
  BD_RETSHAREPV        NUMBER(9,4),
  BD_RETSHAREMO        NUMBER(9,4),
  BD_VSMSCID           VARCHAR2(20 BYTE),
  BD_CONSOLIDATION     VARCHAR2(6 BYTE),
  BD_STATUS            NUMBER(2),
  BD_TERMDATE          DATE,
  BD_SETTLING          NUMBER(1),
  BD_SETID             VARCHAR2(10 BYTE),
  BD_STORAGE           NUMBER(1),
  BD_DBIDSTORE         VARCHAR2(2 BYTE),
  BD_DATESTORE         DATE,
  BD_ARCHIVE           NUMBER(1),
  BD_DBIDARCH          VARCHAR2(2 BYTE),
  BD_DATEARCH          DATE,
  BD_REQUESTID         NUMBER(10),
  BD_RECTYPE           NUMBER(2),
  BD_IDENTITY          VARCHAR2(10 BYTE),
  BD_REQSERV           VARCHAR2(3 BYTE),
  BD_SUBSERV           VARCHAR2(3 BYTE),
  BD_OPERATION         VARCHAR2(3 BYTE),
  BD_MULTSM            NUMBER(1),
  BD_SMSEQ             NUMBER(2),
  BD_ANSTYPE           NUMBER(2),
  BD_RETCODE           NUMBER(2),
  BD_RESPMEDIA         NUMBER(1),
  BD_SMSCRESP          NUMBER(1),
  BD_TMINODE           VARCHAR2(10 BYTE),
  BD_REQID             NUMBER(10),
  BD_SERVKEY           VARCHAR2(6 BYTE),
  BD_TOCID             VARCHAR2(10 BYTE),
  BD_IOT               NUMBER(9,4),
  BD_INT               VARCHAR2(1 BYTE),
  BD_OGTI              VARCHAR2(20 BYTE),
  BD_ZNID              VARCHAR2(10 BYTE),
  BD_CDRTID            VARCHAR2(10 BYTE),
  BD_IW                VARCHAR2(1 BYTE),
  BD_ERRID             VARCHAR2(10 BYTE),
  BD_BILLED            VARCHAR2(1 BYTE),
  BD_RATED             VARCHAR2(1 BYTE),
  BD_PACIDHB           VARCHAR2(10 BYTE),
  BD_OUTPUTHB          VARCHAR2(4000 BYTE),
  BD_AMOUNTTR          NUMBER(9,4),
  BD_ORIGSUBMIT        DATE,
  BD_BILLID            VARCHAR2(20 BYTE),
  BD_VSPRCID           VARCHAR2(10 BYTE),
  BD_ONLINECHARGE      NUMBER(9,4),
  BD_MESSAGEREFERENCE  VARCHAR2(40 BYTE),
  BD_DGTI              VARCHAR2(20 BYTE),
  BD_SMSCID            VARCHAR2(10 BYTE),
  BD_ORIGINATORIMSI    VARCHAR2(20 BYTE),
  BD_PPPSER            VARCHAR2(40 BYTE),
  BD_DSER              VARCHAR2(40 BYTE),
  BD_ORIGSCA           VARCHAR2(40 BYTE),
  BD_GENERATED         NUMBER(1),
  BD_SUBMIT_US         NUMBER(6),
  BD_SUBMIT_GT         VARCHAR2(20 BYTE),
  BD_SUBMIT_APP        VARCHAR2(20 BYTE),
  BD_ORIG_CHARSET      NUMBER(1),
  BD_ORIG_ESME_ID      VARCHAR2(6 BYTE),
  BD_ORIG_IP           VARCHAR2(50 BYTE),
  BD_DELIVER_ADR       VARCHAR2(20 BYTE),
  BD_DELIVER_TON       VARCHAR2(3 BYTE),
  BD_DELIVER_NPI       VARCHAR2(3 BYTE),
  BD_DELIVER_ESME_ID   VARCHAR2(6 BYTE),
  BD_DELIVER_IP        VARCHAR2(50 BYTE),
  BD_MSGREQTYPE        NUMBER(10),
  BD_MSGSCHEDULETIME   DATE,
  BD_MSGEXPIRYTIME     DATE,
  BD_SEG_ID            NUMBER(3),
  BD_SEG_COUNT         NUMBER(3),
  BD_ERR_TYPE          VARCHAR2(10 BYTE),
  BD_ERR_CODE          VARCHAR2(10 BYTE),
  BD_DIA_RESULT        VARCHAR2(10 BYTE),
  BD_RECIP_IMSI        VARCHAR2(20 BYTE),
  BD_RECIP_ADR         VARCHAR2(254 BYTE),
  BD_RECIP_TON         VARCHAR2(3 BYTE),
  BD_RECIP_NPI         VARCHAR2(3 BYTE),
  BD_OGTI_OPKEY        VARCHAR2(10 BYTE),
  BD_DELIVER_OPKEY     VARCHAR2(10 BYTE),
  BD_SCA_OPKEY         VARCHAR2(10 BYTE),
  BD_ORIG_DCS          NUMBER(3),
  BD_ORIG_MSG_ID       VARCHAR2(64 BYTE),
  BD_ORIG_IMEI         VARCHAR2(20 BYTE),
  BD_PANI_HEADER       VARCHAR2(200 BYTE),
  BD_BIO_CLIENT_ID     VARCHAR2(40 BYTE),
  BD_BIO_ORIG_ESME_ID  VARCHAR2(6 BYTE),
  BD_BIO_MSG_REF       VARCHAR2(40 BYTE),
  BD_RECIP_ESME_ID     VARCHAR2(6 BYTE),
  BD_BIO_REQ_TYPE      NUMBER(3),
  BD_SIGNATURE         VARCHAR2(20 BYTE),
  BD_MO_ROAMING_PROM   NUMBER(1)
)
NOCOMPRESS 
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            BUFFER_POOL      DEFAULT
           )
PARTITION BY RANGE (BD_DATETIME)
(  
  PARTITION SMSC201808 VALUES LESS THAN (TO_DATE(' 2018-09-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_DATA_UC
    PCTFREE    10
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                INITIAL          8M
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201809 VALUES LESS THAN (TO_DATE(' 2018-10-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_DATA_UC
    PCTFREE    10
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                INITIAL          8M
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201810 VALUES LESS THAN (TO_DATE(' 2018-11-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_DATA_UC
    PCTFREE    10
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                INITIAL          8M
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201811 VALUES LESS THAN (TO_DATE(' 2018-12-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_DATA_UC
    PCTFREE    10
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                INITIAL          8M
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201812 VALUES LESS THAN (TO_DATE(' 2019-01-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_DATA_UC
    PCTFREE    10
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                INITIAL          8M
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201901 VALUES LESS THAN (TO_DATE(' 2019-02-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_DATA_UC
    PCTFREE    10
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                INITIAL          8M
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201902 VALUES LESS THAN (TO_DATE(' 2019-03-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_DATA_UC
    PCTFREE    10
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                INITIAL          8M
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               )
);

COMMENT ON TABLE SBS1_ADMIN.BDETAIL1 IS 'Billing Detail Information SMSC';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL1.BD_ZNID IS 'detail record id';


/* This object may not be sorted properly in the script due to cirular references. */
--
-- BDETAIL2  (Table) 
--
CREATE TABLE SBS1_ADMIN.BDETAIL2
(
  BD_ID                   VARCHAR2(10 BYTE),
  BD_SRCTYPE              VARCHAR2(10 BYTE)     NOT NULL,
  BD_DATETIME             DATE                  NOT NULL,
  BD_DATESUBMIT           DATE                  NOT NULL,
  BD_DEMO                 NUMBER(1)             NOT NULL,
  BD_BIHID                VARCHAR2(10 BYTE)     NOT NULL,
  BD_MAPSID               VARCHAR2(1 BYTE)      NOT NULL,
  BD_BIRECNO              NUMBER(8)             NOT NULL,
  BD_BOHID1               VARCHAR2(10 BYTE),
  BD_PACSID1              VARCHAR2(1 BYTE),
  BD_BORECNO1             NUMBER(8),
  BD_BOHID2               VARCHAR2(10 BYTE),
  BD_PACSID2              VARCHAR2(1 BYTE),
  BD_BORECNO2             NUMBER(8),
  BD_BOHID3               VARCHAR2(10 BYTE),
  BD_PACSID3              VARCHAR2(1 BYTE),
  BD_BORECNO3             NUMBER(8),
  BD_CONID                VARCHAR2(10 BYTE),
  BD_PMVID                VARCHAR2(10 BYTE),
  BD_TARID                VARCHAR2(1 BYTE),
  BD_NPI_A                VARCHAR2(3 BYTE),
  BD_TON_A                VARCHAR2(3 BYTE),
  BD_PID_A                VARCHAR2(3 BYTE),
  BD_MSISDN_A             VARCHAR2(20 BYTE),
  BD_TON_B                VARCHAR2(3 BYTE),
  BD_NPI_B                VARCHAR2(3 BYTE),
  BD_PID_B                VARCHAR2(3 BYTE),
  BD_MSISDN_B             VARCHAR2(20 BYTE),
  BD_IMSI                 VARCHAR2(20 BYTE),
  BD_LENGTH               NUMBER(4),
  BD_PREPAID              VARCHAR2(1 BYTE),
  BD_NETWORK              NUMBER(2),
  BD_NODENAME             VARCHAR2(20 BYTE),
  BD_SERVICE              VARCHAR2(10 BYTE),
  BD_SHORTID              VARCHAR2(6 BYTE),
  BD_ITEMNO               NUMBER(4),
  BD_KEYWORD              VARCHAR2(80 BYTE),
  BD_LANGID               VARCHAR2(2 BYTE),
  BD_REQTYPE              NUMBER(4),
  BD_BILLRATE             NUMBER(3),
  BD_AMOUNTCU             NUMBER(9,4),
  BD_RETSHAREPV           NUMBER(9,4),
  BD_RETSHAREMO           NUMBER(9,4),
  BD_VSMSCID              VARCHAR2(20 BYTE),
  BD_CONSOLIDATION        VARCHAR2(6 BYTE),
  BD_STATUS               NUMBER(2),
  BD_TERMDATE             DATE,
  BD_SETTLING             NUMBER(1),
  BD_SETID                VARCHAR2(10 BYTE),
  BD_STORAGE              NUMBER(1),
  BD_DBIDSTORE            VARCHAR2(2 BYTE),
  BD_DATESTORE            DATE,
  BD_ARCHIVE              NUMBER(1),
  BD_DBIDARCH             VARCHAR2(2 BYTE),
  BD_DATEARCH             DATE,
  BD_REQUESTID            NUMBER(10),
  BD_RECTYPE              NUMBER(2),
  BD_IDENTITY             VARCHAR2(10 BYTE),
  BD_REQSERV              VARCHAR2(3 BYTE),
  BD_SUBSERV              VARCHAR2(3 BYTE),
  BD_OPERATION            VARCHAR2(3 BYTE),
  BD_MULTSM               NUMBER(1),
  BD_SMSEQ                NUMBER(2),
  BD_ANSTYPE              NUMBER(2),
  BD_RETCODE              NUMBER(2),
  BD_RESPMEDIA            NUMBER(1),
  BD_SMSCRESP             NUMBER(1),
  BD_TMINODE              VARCHAR2(10 BYTE),
  BD_REQID                NUMBER(10),
  BD_SERVKEY              VARCHAR2(6 BYTE),
  BD_TOCID                VARCHAR2(10 BYTE),
  BD_IOT                  NUMBER(9,4),
  BD_INT                  VARCHAR2(1 BYTE),
  BD_OGTI                 VARCHAR2(20 BYTE),
  BD_ZNID                 VARCHAR2(10 BYTE),
  BD_DGTI                 VARCHAR2(20 BYTE),
  BD_IW                   VARCHAR2(1 BYTE),
  BD_CDRTID               VARCHAR2(10 BYTE),
  BD_ERRID                VARCHAR2(10 BYTE),
  BD_BILLED               VARCHAR2(1 BYTE),
  BD_RATED                VARCHAR2(1 BYTE),
  BD_PACIDHB              VARCHAR2(10 BYTE),
  BD_OUTPUTHB             VARCHAR2(4000 BYTE),
  BD_ORIGSUBMIT           DATE,
  BD_BILLID               VARCHAR2(20 BYTE),
  BD_VSPRCID              VARCHAR2(10 BYTE),
  BD_ONLINECHARGE         NUMBER(9,4),
  BD_MESSAGEREFERENCE     VARCHAR2(40 BYTE),
  BD_SMSCID               VARCHAR2(10 BYTE),
  BD_ORIGINATORIMSI       VARCHAR2(20 BYTE),
  BD_PPPSER               VARCHAR2(40 BYTE),
  BD_IOT_INTERNAL         NUMBER(9,4),
  BD_DSER                 VARCHAR2(40 BYTE),
  BD_ORIGSCA              VARCHAR2(40 BYTE),
  BD_GENERATED            NUMBER(1),
  BD_SUBMIT_US            NUMBER(6),
  BD_SUBMIT_GT            VARCHAR2(20 BYTE),
  BD_SUBMIT_APP           VARCHAR2(20 BYTE),
  BD_ORIG_CHARSET         NUMBER(1),
  BD_ORIG_ESME_ID         VARCHAR2(6 BYTE),
  BD_ORIG_IP              VARCHAR2(50 BYTE),
  BD_DELIVER_ADR          VARCHAR2(20 BYTE),
  BD_DELIVER_TON          VARCHAR2(3 BYTE),
  BD_DELIVER_NPI          VARCHAR2(3 BYTE),
  BD_DELIVER_ESME_ID      VARCHAR2(6 BYTE),
  BD_DELIVER_IP           VARCHAR2(50 BYTE),
  BD_MSGREQTYPE           NUMBER(10),
  BD_MSGSCHEDULETIME      DATE,
  BD_MSGEXPIRYTIME        DATE,
  BD_SEG_ID               NUMBER(3),
  BD_SEG_COUNT            NUMBER(3),
  BD_ERR_TYPE             VARCHAR2(10 BYTE),
  BD_ERR_CODE             VARCHAR2(10 BYTE),
  BD_DIA_RESULT           VARCHAR2(10 BYTE),
  BD_DELIVER_US           NUMBER(6),
  BD_DELIVER_ATT          NUMBER(8),
  BD_RECIP_IMSI           VARCHAR2(20 BYTE),
  BD_RECIP_ADR            VARCHAR2(254 BYTE),
  BD_RECIP_TON            VARCHAR2(3 BYTE),
  BD_RECIP_NPI            VARCHAR2(3 BYTE),
  BD_OGTI_OPKEY           VARCHAR2(10 BYTE),
  BD_DELIVER_OPKEY        VARCHAR2(10 BYTE),
  BD_DGTI_OPKEY           VARCHAR2(10 BYTE),
  BD_SCA_OPKEY            VARCHAR2(10 BYTE),
  BD_IW_AMOUNT            NUMBER(10,4),
  BD_IW_APMN              VARCHAR2(10 BYTE),
  BD_IW_CURID             VARCHAR2(3 BYTE),
  BD_IW_DIR               VARCHAR2(1 BYTE),
  BD_IW_SCENARIO          VARCHAR2(1 BYTE),
  BD_IW_CONSTATE          VARCHAR2(1 BYTE),
  BD_AMOUNTTR             NUMBER(9,4),
  BD_ORIG_DCS             NUMBER(3),
  BD_ORIG_MSG_ID          VARCHAR2(64 BYTE),
  BD_ORIG_IMEI            VARCHAR2(20 BYTE),
  BD_PANI_HEADER          VARCHAR2(200 BYTE),
  BD_DELIVER_IMEI         VARCHAR2(20 BYTE),
  BD_DELIVER_PANI_HEADER  VARCHAR2(200 BYTE),
  BD_DELIVER_MAP_GTI      VARCHAR2(20 BYTE),
  BD_BIO_CLIENT_ID        VARCHAR2(40 BYTE),
  BD_BIO_ORIG_ESME_ID     VARCHAR2(6 BYTE),
  BD_BIO_MSG_REF          VARCHAR2(40 BYTE),
  BD_RECIP_ESME_ID        VARCHAR2(6 BYTE),
  BD_BIO_REQ_TYPE         NUMBER(3),
  BD_SIGNATURE            VARCHAR2(20 BYTE),
  BD_MO_ROAMING_PROM      NUMBER(1)
)
NOCOMPRESS 
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            BUFFER_POOL      DEFAULT
           )
PARTITION BY RANGE (BD_DATETIME)
(  
  PARTITION SMSD201808 VALUES LESS THAN (TO_DATE(' 2018-09-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_DATA_UC
    PCTFREE    10
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                INITIAL          8M
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201809 VALUES LESS THAN (TO_DATE(' 2018-10-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_DATA_UC
    PCTFREE    10
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                INITIAL          8M
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201810 VALUES LESS THAN (TO_DATE(' 2018-11-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_DATA_UC
    PCTFREE    10
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                INITIAL          8M
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201811 VALUES LESS THAN (TO_DATE(' 2018-12-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_DATA_UC
    PCTFREE    10
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                INITIAL          8M
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201812 VALUES LESS THAN (TO_DATE(' 2019-01-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_DATA_UC
    PCTFREE    10
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                INITIAL          8M
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201901 VALUES LESS THAN (TO_DATE(' 2019-02-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_DATA_UC
    PCTFREE    10
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                INITIAL          8M
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201902 VALUES LESS THAN (TO_DATE(' 2019-03-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_DATA_UC
    PCTFREE    10
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                INITIAL          8M
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               )
);

COMMENT ON TABLE SBS1_ADMIN.BDETAIL2 IS 'Billing Detail Information SMSC DEDE';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_ID IS 'detail record id';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_SRCTYPE IS 'source type';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_DATETIME IS 'datetime of delete';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_DATESUBMIT IS 'datetime of submit';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_DEMO IS 'demo flag';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_BIHID IS 'input header id';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_MAPSID IS 'mapping state id';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_BIRECNO IS 'input record number';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_BOHID1 IS 'output header id 1';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_PACSID1 IS 'packing state id (out channel 1)';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_BORECNO1 IS 'output record number 1';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_BOHID2 IS 'output header id 2';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_PACSID2 IS 'packing state id (out channel 2)';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_BORECNO2 IS 'output record number 2';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_BOHID3 IS 'output header id 3';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_PACSID3 IS 'packing state id (out channel 3)';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_BORECNO3 IS 'output record number 3';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_CONID IS 'contract id';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_PMVID IS 'pricing model version id';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_TARID IS 'tariff id';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_NPI_A IS 'originator npi';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_TON_A IS 'originator ton';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_PID_A IS 'originator pid';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_MSISDN_A IS 'originator address';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_TON_B IS 'recipient ton';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_NPI_B IS 'recipient npi';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_PID_B IS 'recipient pid';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_MSISDN_B IS 'recipient address';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_IMSI IS 'international subscriber';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_LENGTH IS 'length of message';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_PREPAID IS 'prepaid originator';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_NETWORK IS 'network';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_NODENAME IS 'node name';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_SERVICE IS 'service';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_SHORTID IS 'short id';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_ITEMNO IS 'item number';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_KEYWORD IS 'keyword';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_LANGID IS 'language id';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_REQTYPE IS 'request type';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_BILLRATE IS 'bill rate';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_AMOUNTCU IS 'amount billed customer';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_RETSHAREPV IS 'return share provider';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_RETSHAREMO IS 'return share mobilecom';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_VSMSCID IS 'vsmscid';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_CONSOLIDATION IS 'consolidation';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_STATUS IS 'status';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_TERMDATE IS 'termination date';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_SETTLING IS 'settling done';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_SETID IS 'settling id';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_STORAGE IS 'storage state';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_DBIDSTORE IS 'storage db id';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_DATESTORE IS 'storage date';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_ARCHIVE IS 'archive state';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_DBIDARCH IS 'archive db id';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_DATEARCH IS 'archive date';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_REQUESTID IS 'billing request id';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_RECTYPE IS 'input record type';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_IDENTITY IS 'question answer identity';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_REQSERV IS 'requested service';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_SUBSERV IS 'requested sub service';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_OPERATION IS 'requested operation';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_MULTSM IS 'multiple sm';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_SMSEQ IS 'sm sequence number';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_ANSTYPE IS 'answer type';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_RETCODE IS 'return code';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_RESPMEDIA IS 'response media';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_SMSCRESP IS 'smsc response';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_TMINODE IS 'tm info node identity';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_REQID IS 'request id';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_SERVKEY IS 'service key';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_TOCID IS 'destination toc id';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_IOT IS 'interworking charge';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_INT IS 'international flag';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_ZNID IS 'detail record id';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_DGTI IS 'dgti field';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL2.BD_IW IS 'interworking flag';


/* This object may not be sorted properly in the script due to cirular references. */
--
-- BDETAIL4  (Table) 
--
CREATE TABLE SBS1_ADMIN.BDETAIL4
(
  BD_ID                VARCHAR2(10 BYTE),
  BD_SRCTYPE           VARCHAR2(10 BYTE)        NOT NULL,
  BD_DEMO              NUMBER(1)                NOT NULL,
  BD_BIHID             VARCHAR2(10 BYTE)        NOT NULL,
  BD_MAPSID            VARCHAR2(1 BYTE)         NOT NULL,
  BD_BIRECNO           NUMBER(8)                NOT NULL,
  BD_BOHID1            VARCHAR2(10 BYTE),
  BD_PACSID1           VARCHAR2(1 BYTE),
  BD_BORECNO1          NUMBER(8),
  BD_BOHID2            VARCHAR2(10 BYTE),
  BD_PACSID2           VARCHAR2(1 BYTE),
  BD_BORECNO2          NUMBER(8),
  BD_BOHID3            VARCHAR2(10 BYTE),
  BD_PACSID3           VARCHAR2(1 BYTE),
  BD_BORECNO3          NUMBER(8),
  BD_DATETIME          DATE                     NOT NULL,
  BD_CDRTID            VARCHAR2(10 BYTE)        NOT NULL,
  BD_MSISDN_A          VARCHAR2(20 BYTE)        NOT NULL,
  BD_MSISDN_B          VARCHAR2(20 BYTE),
  BD_IMSI              VARCHAR2(20 BYTE),
  BD_IMEI              VARCHAR2(20 BYTE),
  BD_EXID              VARCHAR2(20 BYTE),
  BD_MSCID             VARCHAR2(20 BYTE),
  BD_SMSCID            VARCHAR2(10 BYTE),
  BD_ROUTE             VARCHAR2(20 BYTE),
  BD_CELL              VARCHAR2(20 BYTE),
  BD_TSC               VARCHAR2(4 BYTE),
  BD_SCA               VARCHAR2(20 BYTE),
  BD_POWER             VARCHAR2(20 BYTE),
  BD_SUBTYPE           VARCHAR2(4 BYTE),
  BD_PREPAID           VARCHAR2(1 BYTE),
  BD_ZNID              VARCHAR2(10 BYTE),
  BD_TOCID             VARCHAR2(10 BYTE),
  BD_SHORTID           VARCHAR2(6 BYTE),
  BD_AMOUNTCU          NUMBER(9,4),
  BD_RETSHAREMO        NUMBER(9,4),
  BD_RETSHAREPV        NUMBER(9,4),
  BD_CONID             VARCHAR2(10 BYTE),
  BD_ERRID             VARCHAR2(10 BYTE),
  BD_BILLED            VARCHAR2(1 BYTE),
  BD_RATED             VARCHAR2(1 BYTE),
  BD_PACIDHB           VARCHAR2(10 BYTE),
  BD_OUTPUTHB          VARCHAR2(4000 BYTE),
  BD_TARID             VARCHAR2(10 BYTE),
  BD_PMVID             VARCHAR2(10 BYTE),
  BD_ORIGSUBMITTIME    DATE,
  BD_VSPRCID           VARCHAR2(10 BYTE),
  BD_OGTI_OPKEY        VARCHAR2(10 BYTE),
  BD_DELIVER_OPKEY     VARCHAR2(10 BYTE),
  BD_DGTI_OPKEY        VARCHAR2(10 BYTE),
  BD_SCA_OPKEY         VARCHAR2(10 BYTE),
  BD_IW_AMOUNT         NUMBER(10,4),
  BD_IW_APMN           VARCHAR2(10 BYTE),
  BD_IW_CURID          VARCHAR2(3 BYTE),
  BD_IW_DIR            VARCHAR2(1 BYTE),
  BD_IW_SCENARIO       VARCHAR2(1 BYTE),
  BD_IW_CONSTATE       VARCHAR2(1 BYTE),
  BD_MESSAGEREFERENCE  VARCHAR2(40 BYTE),
  BD_SIGNATURE         VARCHAR2(20 BYTE)
)
NOCOMPRESS 
TABLESPACE SBS1_MSCA_DATA_UC
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            BUFFER_POOL      DEFAULT
           )
PARTITION BY RANGE (BD_DATETIME)
(  
  PARTITION MSCA201901 VALUES LESS THAN (TO_DATE(' 2019-02-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_MSCA_DATA_NC
    PCTFREE    10
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                INITIAL          8M
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MSCA201902 VALUES LESS THAN (TO_DATE(' 2019-03-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_MSCA_DATA_NC
    PCTFREE    10
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               )
);

COMMENT ON TABLE SBS1_ADMIN.BDETAIL4 IS 'Billing Detail Information MSC';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL4.BD_ID IS 'detail record id';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL4.BD_SRCTYPE IS 'source type';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL4.BD_DEMO IS 'demo flag';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL4.BD_BIHID IS 'input header id';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL4.BD_MAPSID IS 'mapping state id';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL4.BD_BIRECNO IS 'input record number';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL4.BD_BOHID1 IS 'output header id 1';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL4.BD_PACSID1 IS 'packing state id (out channel 1)';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL4.BD_BORECNO1 IS 'output record number 1';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL4.BD_BOHID2 IS 'output header id 2';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL4.BD_PACSID2 IS 'packing state id (out channel 2)';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL4.BD_BORECNO2 IS 'output record number 2';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL4.BD_BOHID3 IS 'output header id 3';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL4.BD_PACSID3 IS 'packing state id (out channel 3)';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL4.BD_BORECNO3 IS 'output record number 3';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL4.BD_DATETIME IS 'datetime of call event';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL4.BD_CDRTID IS 'cdr type';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL4.BD_MSISDN_A IS 'msisdn a';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL4.BD_MSISDN_B IS 'msisdn b';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL4.BD_IMSI IS 'imsi';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL4.BD_IMEI IS 'imei';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL4.BD_EXID IS 'exchange identity';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL4.BD_SMSCID IS 'smsc id';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL4.BD_ROUTE IS 'route';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL4.BD_CELL IS 'cell identity';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL4.BD_TSC IS 'gsm tele service code';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL4.BD_SCA IS 'service center address';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL4.BD_POWER IS 'rf power class';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL4.BD_SUBTYPE IS 'subscription type';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL4.BD_ZNID IS 'detail record id';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL4.BD_TOCID IS 'toc id';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL4.BD_SHORTID IS 'short id';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL4.BD_AMOUNTCU IS 'amount customer';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL4.BD_RETSHAREMO IS 'revenue share mobile';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL4.BD_RETSHAREPV IS 'revenue share provider';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL4.BD_CONID IS 'vas contract id';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL4.BD_ERRID IS 'error id';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL4.BD_BILLED IS 'cdr Billed';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL4.BD_RATED IS 'cdr Rated';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL4.BD_PACIDHB IS 'hotbilling packing id';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL4.BD_OUTPUTHB IS 'hotbilling output';


/* This object may not be sorted properly in the script due to cirular references. */
--
-- BDETAIL6  (Table) 
--
CREATE TABLE SBS1_ADMIN.BDETAIL6
(
  BD_ID                  VARCHAR2(10 BYTE),
  BD_SRCTYPE             VARCHAR2(10 BYTE)      NOT NULL,
  BD_DEMO                NUMBER(1)              NOT NULL,
  BD_BIHID               VARCHAR2(10 BYTE)      NOT NULL,
  BD_MAPSID              VARCHAR2(1 BYTE)       NOT NULL,
  BD_BIRECNO             NUMBER(8)              NOT NULL,
  BD_BOHID1              VARCHAR2(10 BYTE),
  BD_PACSID1             VARCHAR2(1 BYTE),
  BD_BORECNO1            NUMBER(8),
  BD_BOHID2              VARCHAR2(10 BYTE),
  BD_PACSID2             VARCHAR2(1 BYTE),
  BD_BORECNO2            NUMBER(8),
  BD_BOHID3              VARCHAR2(10 BYTE),
  BD_PACSID3             VARCHAR2(1 BYTE),
  BD_BORECNO3            NUMBER(8),
  BD_DATETIME            DATE                   NOT NULL,
  BD_MSISDN_A            VARCHAR2(254 BYTE),
  BD_MSISDN_B            VARCHAR2(254 BYTE),
  BD_LAYERSPECATTR       NUMBER(8),
  BD_MSGTYPE             NUMBER(8),
  BD_MSGSIZE             NUMBER(8),
  BD_STORAGEDURATION     NUMBER(10),
  BD_DATEDELIVERYFUTURE  DATE,
  BD_DATEDELIVERY        DATE,
  BD_DATESUBMIT          DATE,
  BD_DATEEXPIRE          DATE,
  BD_MSGPRIORITY         NUMBER(8),
  BD_MSGCLASS            NUMBER(8),
  BD_MSGCONTENT          VARCHAR2(254 BYTE),
  BD_UMSGGRPID           VARCHAR2(30 BYTE),
  BD_NUMNOTIFICATION     NUMBER(8),
  BD_MMSIDENTIFIER       VARCHAR2(254 BYTE),
  BD_CDRRECTYPE          VARCHAR2(10 BYTE),
  BD_FWDCOPYIND          NUMBER(8),
  BD_ACCCORRID           VARCHAR2(30 BYTE),
  BD_PREPAID             VARCHAR2(1 BYTE),
  BD_EVENTDISP           NUMBER(8),
  BD_OUTID               VARCHAR2(254 BYTE),
  BD_INID                VARCHAR2(254 BYTE),
  BD_PRICE               NUMBER(12,4),
  BD_REQUESTIND          NUMBER(8),
  BD_PARTYTOCHARGE       VARCHAR2(254 BYTE),
  BD_LEGACYINDICATOR     NUMBER(8),
  BD_NUMHOMERECIP        NUMBER(8),
  BD_NUMNONHOMERECIP     NUMBER(8),
  BD_NUMINTLRECIP        NUMBER(8),
  BD_NUMEMAILRECIP       NUMBER(8),
  BD_NUMSCODERECIP       NUMBER(8),
  BD_NUMCONVERSION       NUMBER(8),
  BD_FREETEXT            VARCHAR2(1000 BYTE),
  BD_IMSI                VARCHAR2(254 BYTE),
  BD_ZNID                VARCHAR2(10 BYTE),
  BD_AMOUNTCU            NUMBER(12,4),
  BD_AMOUNTPV            NUMBER(12,4),
  BD_AMOUNTMO            NUMBER(12,4),
  BD_CDRTID              VARCHAR2(10 BYTE),
  BD_LENGTH              NUMBER(8),
  BD_SHORTID             VARCHAR2(6 BYTE),
  BD_CONID               VARCHAR2(10 BYTE),
  BD_TARID               VARCHAR2(10 BYTE),
  BD_TRCLASS             NUMBER(10,3),
  BD_TRCLASSIW           NUMBER(10,3),
  BD_TOCID               VARCHAR2(10 BYTE),
  BD_INT                 VARCHAR2(1 BYTE),
  BD_IW                  VARCHAR2(1 BYTE),
  BD_ERRID               VARCHAR2(10 BYTE),
  BD_BILLED              VARCHAR2(1 BYTE),
  BD_RATED               VARCHAR2(1 BYTE),
  BD_PACIDHB             VARCHAR2(10 BYTE),
  BD_OUTPUTHB            VARCHAR2(4000 BYTE),
  BD_MM7LINKEDID         VARCHAR2(10 BYTE),
  BD_PREPAIDFREETEXT     VARCHAR2(254 BYTE),
  BD_PROMOTIONPLAN       VARCHAR2(10 BYTE),
  BD_TARIFFCLASS         VARCHAR2(10 BYTE),
  BD_ROAMINGINFO         VARCHAR2(20 BYTE),
  BD_DESTINATIONIMSI     VARCHAR2(254 BYTE),
  BD_AMOUNTTR            NUMBER(12,4),
  BD_COUNTTR             NUMBER(8),
  BD_PMVID               VARCHAR2(10 BYTE),
  BD_RECIPCOUNT          NUMBER(2),
  BD_MMSSZID             VARCHAR2(10 BYTE),
  BD_MMSDZID             VARCHAR2(10 BYTE),
  BD_MMSRCCID            VARCHAR2(10 BYTE),
  BD_MMSDCCID            VARCHAR2(10 BYTE),
  BD_MMSRZID1            VARCHAR2(10 BYTE),
  BD_MMSRZID2            VARCHAR2(10 BYTE),
  BD_RECIPINDEX          NUMBER(3),
  BD_RETSHAREPV          NUMBER(12,4),
  BD_RETSHAREMO          NUMBER(12,4),
  BD_IOT                 NUMBER(9,4),
  BD_VSPRCID             VARCHAR2(10 BYTE),
  BD_IOT_INTERNAL        NUMBER(9,4),
  BD_GENERATED           NUMBER(1),
  BD_SIGNATURE           VARCHAR2(20 BYTE),
  BD_MO_ROAMING_PROM     NUMBER(1),
  BD_MT_ROAMING_PROM     NUMBER(1)
)
NOCOMPRESS 
TABLESPACE SBS1_MMSC_DATA_UC
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            BUFFER_POOL      DEFAULT
           )
PARTITION BY RANGE (BD_DATETIME)
(  
  PARTITION MMSC201808 VALUES LESS THAN (TO_DATE(' 2018-09-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_DATA_NC
    PCTFREE    10
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201809 VALUES LESS THAN (TO_DATE(' 2018-10-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_DATA_NC
    PCTFREE    10
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                INITIAL          8M
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201810 VALUES LESS THAN (TO_DATE(' 2018-11-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_DATA_NC
    PCTFREE    10
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                INITIAL          8M
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201811 VALUES LESS THAN (TO_DATE(' 2018-12-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_DATA_NC
    PCTFREE    10
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                INITIAL          8M
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201812 VALUES LESS THAN (TO_DATE(' 2019-01-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_DATA_NC
    PCTFREE    10
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                INITIAL          8M
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201901 VALUES LESS THAN (TO_DATE(' 2019-02-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_DATA_NC
    PCTFREE    10
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                INITIAL          8M
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201902 VALUES LESS THAN (TO_DATE(' 2019-03-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_DATA_NC
    PCTFREE    10
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               )
);

COMMENT ON TABLE SBS1_ADMIN.BDETAIL6 IS 'Billing Detail Information MMS (Multimedia Messaging System)';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_ID IS 'detail record id';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_SRCTYPE IS 'source type';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_DEMO IS 'demo flag';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_BIHID IS 'input header id';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_MAPSID IS 'mapping state id';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_BIRECNO IS 'input record number';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_BOHID1 IS 'output header id 1';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_PACSID1 IS 'packing state id (out channel 1)';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_BORECNO1 IS 'output record number 1';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_BOHID2 IS 'output header id 2';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_PACSID2 IS 'packing state id (out channel 2)';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_BORECNO2 IS 'output record number 2';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_BOHID3 IS 'output header id 3';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_PACSID3 IS 'packing state id (out channel 3)';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_BORECNO3 IS 'output record number 3';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_DATETIME IS 'datetime';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_MSISDN_A IS 'originator of mm';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_MSISDN_B IS 'destination (address of recipient)';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_LAYERSPECATTR IS 'layer specific attribute';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_MSGTYPE IS 'message type';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_MSGSIZE IS 'message size';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_STORAGEDURATION IS 'duration of storage';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_DATEDELIVERYFUTURE IS 'future delivery date';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_DATEDELIVERY IS 'successful delivery time';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_DATESUBMIT IS 'submit time';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_DATEEXPIRE IS 'expiration time';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_MSGPRIORITY IS 'message priority';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_MSGCLASS IS 'message class';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_MSGCONTENT IS 'message content';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_UMSGGRPID IS 'unique id of originator';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_NUMNOTIFICATION IS 'numbers of notifications (sent to recipient)';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_MMSIDENTIFIER IS 'mms system name identifier';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_CDRRECTYPE IS 'cdr record type';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_FWDCOPYIND IS 'origin method of message';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_ACCCORRID IS 'access correlation id';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_PREPAID IS 'payment method';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_EVENTDISP IS 'event disposition';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_OUTID IS 'outgoing interface id';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_INID IS 'incoming interface id';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_PRICE IS 'price of message';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_REQUESTIND IS 'delivery readreport request indicator';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_PARTYTOCHARGE IS 'party to charge';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_LEGACYINDICATOR IS 'legacy indicator';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_NUMHOMERECIP IS 'number of home recipients';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_NUMNONHOMERECIP IS 'number of non home in country recipients';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_NUMINTLRECIP IS 'number of international recipients';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_NUMEMAILRECIP IS 'number of email recipients';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_NUMSCODERECIP IS 'number of short code recipients';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_NUMCONVERSION IS 'number of conversions';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_FREETEXT IS 'free text (description field)';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_IMSI IS 'imsi';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_ZNID IS 'zone identifier';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_AMOUNTCU IS 'amount customer';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_AMOUNTPV IS 'provider share';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL6.BD_AMOUNTMO IS 'operator share';


/* This object may not be sorted properly in the script due to cirular references. */
--
-- BDETAIL9  (Table) 
--
CREATE TABLE SBS1_ADMIN.BDETAIL9
(
  BD_ID          VARCHAR2(10 BYTE),
  BD_SRCTYPE     VARCHAR2(4 BYTE)               NOT NULL,
  BD_DEMO        NUMBER(1)                      NOT NULL,
  BD_BIHID       VARCHAR2(10 BYTE)              NOT NULL,
  BD_MAPSID      VARCHAR2(1 BYTE)               NOT NULL,
  BD_BIRECNO     NUMBER(8)                      NOT NULL,
  BD_BOHID1      VARCHAR2(10 BYTE),
  BD_PACSID1     VARCHAR2(1 BYTE),
  BD_BORECNO1    NUMBER(8),
  BD_BOHID2      VARCHAR2(10 BYTE),
  BD_PACSID2     VARCHAR2(1 BYTE),
  BD_BORECNO2    NUMBER(8),
  BD_BOHID3      VARCHAR2(10 BYTE),
  BD_PACSID3     VARCHAR2(1 BYTE),
  BD_BORECNO3    NUMBER(8),
  BD_DATETIME    DATE                           NOT NULL,
  BD_OFFSET      VARCHAR2(5 BYTE),
  BD_NUMMSG      NUMBER(3),
  BD_CALLTYPE    NUMBER(2)                      NOT NULL,
  BD_MSISDN      VARCHAR2(25 BYTE)              NOT NULL,
  BD_CGI         VARCHAR2(25 BYTE),
  BD_GSMPI       NUMBER(3)                      NOT NULL,
  BD_REMARK      VARCHAR2(160 BYTE),
  BD_RATEDUNITS  NUMBER(15),
  BD_UTXPARAMS   VARCHAR2(8 BYTE),
  BD_PREPAID     VARCHAR2(1 BYTE),
  BD_AMOUNTCU    NUMBER(12,4),
  BD_CDRTID      VARCHAR2(10 BYTE),
  BD_INT         VARCHAR2(1 BYTE),
  BD_IW          VARCHAR2(1 BYTE),
  BD_AAATS       VARCHAR2(1 BYTE),
  BD_CONSTID     VARCHAR2(10 BYTE),
  BD_ERRID       VARCHAR2(10 BYTE),
  BD_BILLED      VARCHAR2(1 BYTE),
  BD_RATED       VARCHAR2(1 BYTE),
  BD_PACIDHB     VARCHAR2(10 BYTE),
  BD_OUTPUTHB    VARCHAR2(4000 BYTE),
  BD_VSPRCID     VARCHAR2(10 BYTE)
)
NOCOMPRESS 
TABLESPACE SBS1_INFO_DATA_UC
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            BUFFER_POOL      DEFAULT
           )
PARTITION BY RANGE (BD_DATETIME)
(  
  PARTITION INFO201808 VALUES LESS THAN (TO_DATE(' 2018-09-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    10
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                INITIAL          8M
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201809 VALUES LESS THAN (TO_DATE(' 2018-10-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    10
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                INITIAL          8M
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201810 VALUES LESS THAN (TO_DATE(' 2018-11-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    10
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                INITIAL          8M
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201811 VALUES LESS THAN (TO_DATE(' 2018-12-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    10
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                INITIAL          8M
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201812 VALUES LESS THAN (TO_DATE(' 2019-01-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    10
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                INITIAL          8M
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201901 VALUES LESS THAN (TO_DATE(' 2019-02-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    10
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                INITIAL          8M
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201902 VALUES LESS THAN (TO_DATE(' 2019-03-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_DATA_UC
    PCTFREE    10
    INITRANS   1
    MAXTRANS   255
    STORAGE    (
                INITIAL          8M
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               )
);

COMMENT ON TABLE SBS1_ADMIN.BDETAIL9 IS 'Billing Detail Information AAA Ufih';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL9.BD_ID IS 'detail record id';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL9.BD_SRCTYPE IS 'source type';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL9.BD_DEMO IS 'demo flag';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL9.BD_BIHID IS 'input header id';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL9.BD_MAPSID IS 'mapping state id';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL9.BD_BIRECNO IS 'input record number';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL9.BD_BOHID1 IS 'output header id 1';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL9.BD_PACSID1 IS 'packing state id (out channel 1)';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL9.BD_BORECNO1 IS 'output record number 1';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL9.BD_BOHID2 IS 'output header id 2';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL9.BD_PACSID2 IS 'packing state id (out channel 2)';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL9.BD_BORECNO2 IS 'output record number 2';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL9.BD_BOHID3 IS 'output header id 3';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL9.BD_PACSID3 IS 'packing state id (out channel 3)';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL9.BD_BORECNO3 IS 'output record number 3';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL9.BD_DATETIME IS 'datetime of cdr';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL9.BD_OFFSET IS 'time offset';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL9.BD_NUMMSG IS 'number of messages';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL9.BD_CALLTYPE IS 'call type';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL9.BD_MSISDN IS 'served party msisdn';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL9.BD_CGI IS 'served party cell global indentifier';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL9.BD_GSMPI IS 'gart value';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL9.BD_REMARK IS 'remarks upto 80 chars';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL9.BD_RATEDUNITS IS 'no of units for pre rated records';

COMMENT ON COLUMN SBS1_ADMIN.BDETAIL9.BD_UTXPARAMS IS 'utx parameters';


/* This object may not be sorted properly in the script due to cirular references. */
--
-- BOHEADER  (Table) 
--
CREATE TABLE SBS1_ADMIN.BOHEADER
(
  BOH_ID        VARCHAR2(10 BYTE)               NOT NULL,
  BOH_DEMO      NUMBER(1)                       NOT NULL,
  BOH_IDENT     VARCHAR2(6 BYTE),
  BOH_FILESEQ   NUMBER(8)                       NOT NULL,
  BOH_FILEFORM  NUMBER(2),
  BOH_DATETIME  DATE                            NOT NULL,
  BOH_FILENAME  VARCHAR2(100 BYTE)              NOT NULL,
  BOH_FILEDATE  DATE                            NOT NULL,
  BOH_RECCOUNT  NUMBER(8),
  BOH_DATEFC    DATE,
  BOH_DATELC    DATE,
  BOH_PACKID    VARCHAR2(10 BYTE)               NOT NULL,
  BOH_START     DATE,
  BOH_END       DATE,
  BOH_ESID      VARCHAR2(3 BYTE),
  BOH_EXE       VARCHAR2(100 BYTE),
  BOH_VERSION   VARCHAR2(10 BYTE),
  BOH_JOB       NUMBER(2),
  BOH_HOST      VARCHAR2(100 BYTE),
  BOH_THREAD    VARCHAR2(100 BYTE),
  BOH_ERRCOUNT  NUMBER(8)
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    30
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          104K
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.BOHEADER IS 'Billing output header';


/* This object may not be sorted properly in the script due to cirular references. */
--
-- IWTCOUNTER  (Table) 
--
CREATE TABLE SBS1_ADMIN.IWTCOUNTER
(
  IWTC_DATE       DATE                          NOT NULL,
  IWTC_SMSCID     VARCHAR2(10 BYTE)             NOT NULL,
  IWTC_COUNT      NUMBER(8)                     NOT NULL,
  IWTC_ESID       VARCHAR2(10 BYTE)             NOT NULL,
  IWTC_BOHID1     VARCHAR2(10 BYTE),
  IWTC_HRR_COUNT  NUMBER(8)
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON COLUMN SBS1_ADMIN.IWTCOUNTER.IWTC_BOHID1 IS 'output header id of the iwt counters';


/* This object may not be sorted properly in the script due to cirular references. */
--
-- MAPPACDEP  (Table) 
--
CREATE TABLE SBS1_ADMIN.MAPPACDEP
(
  MAPPAC_MAPID1  VARCHAR2(10 BYTE)              NOT NULL,
  MAPPAC_PACID2  VARCHAR2(10 BYTE)              NOT NULL
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.MAPPACDEP IS 'Packing dependency on Mappings';


/* This object may not be sorted properly in the script due to cirular references. */
--
-- PACKING  (Table) 
--
CREATE TABLE SBS1_ADMIN.PACKING
(
  PAC_ID                VARCHAR2(10 BYTE)       NOT NULL,
  PAC_NAME              VARCHAR2(100 BYTE)      NOT NULL,
  PAC_CHANNEL           NUMBER(1)               NOT NULL,
  PAC_FILESEQMAX        NUMBER(10)              NOT NULL,
  PAC_NEXTSEQ           NUMBER(10)              NOT NULL,
  PAC_ETID              VARCHAR2(10 BYTE)       NOT NULL,
  PAC_ESID              VARCHAR2(10 BYTE)       NOT NULL,
  PAC_LTID              VARCHAR2(10 BYTE)       NOT NULL,
  PAC_PERIODID          VARCHAR2(10 BYTE),
  PAC_SHORT             VARCHAR2(10 BYTE),
  PAC_TITLE             VARCHAR2(200 BYTE),
  PAC_SUBTITLE          VARCHAR2(100 BYTE),
  PAC_INFO              VARCHAR2(1000 BYTE),
  PAC_ACIDCRE           VARCHAR2(10 BYTE),
  PAC_DATECRE           DATE,
  PAC_ACIDMOD           VARCHAR2(10 BYTE),
  PAC_DATEMOD           DATE,
  PAC_CHNGCNT           NUMBER(5),
  PAC_FILEMASK          VARCHAR2(100 BYTE),
  PAC_TEMPLATE          VARCHAR2(100 BYTE),
  PAC_ITID              VARCHAR2(10 BYTE),
  PAC_STARTDAY          NUMBER(3),
  PAC_STARTHOUR         NUMBER(2),
  PAC_STARTMINUTE       NUMBER(2),
  PAC_DATETRY           DATE,
  PAC_DATEDONE          DATE,
  PAC_NOTIFICATION      NUMBER(1),
  PAC_NOTID             VARCHAR2(10 BYTE),
  PAC_MODLA             NUMBER(1),
  PAC_MODIS             NUMBER(1),
  PAC_MODSYS            NUMBER(1),
  PAC_MODIW             NUMBER(1),
  PAC_OUTPUTDIR         VARCHAR2(1000 BYTE),
  PAC_DATESTA           DATE,
  PAC_FILESAVEDURATION  NUMBER(3),
  PAC_XPROCID           VARCHAR2(50 BYTE),
  PAC_CONDITIONALEXEC   VARCHAR2(4000 BYTE),
  PAC_PDFMASK           VARCHAR2(100 BYTE),
  PAC_MODCUC            NUMBER(1),
  PAC_ARCHIVESTATISTIC  NUMBER(1),
  PAC_ARCHIVEDIR        VARCHAR2(100 BYTE),
  PAC_DIRECTORYID       VARCHAR2(10 BYTE),
  PAC_EXECDELAY         NUMBER(4),
  PAC_EXECUTE           NUMBER(1)               NOT NULL,
  PAC_DEBUG             NUMBER(1),
  PAC_COMPRESS          NUMBER(1),
  PAC_FIELDSEP          VARCHAR2(5 BYTE),
  PAC_LINESEP           VARCHAR2(5 BYTE),
  PAC_ENDCLEARANCE      NUMBER(8),
  PAC_ENCODINGTYPE      VARCHAR2(20 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.PACKING IS 'Packing';

COMMENT ON COLUMN SBS1_ADMIN.PACKING.PAC_LTID IS 'packing loop id';

COMMENT ON COLUMN SBS1_ADMIN.PACKING.PAC_PERIODID IS 'packing periodicity id';

COMMENT ON COLUMN SBS1_ADMIN.PACKING.PAC_SHORT IS 'packing short id';

COMMENT ON COLUMN SBS1_ADMIN.PACKING.PAC_TITLE IS 'packing title';

COMMENT ON COLUMN SBS1_ADMIN.PACKING.PAC_SUBTITLE IS 'packing subtitle';

COMMENT ON COLUMN SBS1_ADMIN.PACKING.PAC_INFO IS 'packing info';

COMMENT ON COLUMN SBS1_ADMIN.PACKING.PAC_ACIDCRE IS 'packing acid creation';

COMMENT ON COLUMN SBS1_ADMIN.PACKING.PAC_DATECRE IS 'packing creation date';

COMMENT ON COLUMN SBS1_ADMIN.PACKING.PAC_ACIDMOD IS 'packing acid modification';

COMMENT ON COLUMN SBS1_ADMIN.PACKING.PAC_DATEMOD IS 'packing modification date';

COMMENT ON COLUMN SBS1_ADMIN.PACKING.PAC_CHNGCNT IS 'packing change count';

COMMENT ON COLUMN SBS1_ADMIN.PACKING.PAC_FILEMASK IS 'packing filemask';

COMMENT ON COLUMN SBS1_ADMIN.PACKING.PAC_TEMPLATE IS 'packing template';

COMMENT ON COLUMN SBS1_ADMIN.PACKING.PAC_ITID IS 'packing loop condition';

COMMENT ON COLUMN SBS1_ADMIN.PACKING.PAC_STARTDAY IS 'packing start day';

COMMENT ON COLUMN SBS1_ADMIN.PACKING.PAC_STARTHOUR IS 'packing start hour';

COMMENT ON COLUMN SBS1_ADMIN.PACKING.PAC_STARTMINUTE IS 'packing start minute';

COMMENT ON COLUMN SBS1_ADMIN.PACKING.PAC_DATETRY IS 'packing last try';

COMMENT ON COLUMN SBS1_ADMIN.PACKING.PAC_DATEDONE IS 'packing done';

COMMENT ON COLUMN SBS1_ADMIN.PACKING.PAC_NOTIFICATION IS 'packing notification yes or no';

COMMENT ON COLUMN SBS1_ADMIN.PACKING.PAC_NOTID IS 'packing notification id';

COMMENT ON COLUMN SBS1_ADMIN.PACKING.PAC_MODLA IS 'packing module large account';

COMMENT ON COLUMN SBS1_ADMIN.PACKING.PAC_MODIS IS 'packing module is';

COMMENT ON COLUMN SBS1_ADMIN.PACKING.PAC_MODSYS IS 'packing module system';

COMMENT ON COLUMN SBS1_ADMIN.PACKING.PAC_MODIW IS 'packing module interworking';

COMMENT ON COLUMN SBS1_ADMIN.PACKING.PAC_OUTPUTDIR IS 'packing output dir';

COMMENT ON COLUMN SBS1_ADMIN.PACKING.PAC_DATESTA IS 'state change date';

COMMENT ON COLUMN SBS1_ADMIN.PACKING.PAC_FILESAVEDURATION IS 'File save duration in months';

COMMENT ON COLUMN SBS1_ADMIN.PACKING.PAC_CONDITIONALEXEC IS 'Conditional Execution';


/* This object may not be sorted properly in the script due to cirular references. */
--
-- PACPACDEP  (Table) 
--
CREATE TABLE SBS1_ADMIN.PACPACDEP
(
  PACPAC_PACID1  VARCHAR2(10 BYTE)              NOT NULL,
  PACPAC_PACID2  VARCHAR2(10 BYTE)              NOT NULL
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.PACPACDEP IS 'Packing dependency';

COMMENT ON COLUMN SBS1_ADMIN.PACPACDEP.PACPAC_PACID1 IS 'packing id 1 (first)';

COMMENT ON COLUMN SBS1_ADMIN.PACPACDEP.PACPAC_PACID2 IS 'packing id 2 (next)';


/* This object may not be sorted properly in the script due to cirular references. */
--
-- STA_DIRECTORY  (Table) 
--
CREATE TABLE SBS1_ADMIN.STA_DIRECTORY
(
  STAD_ID       VARCHAR2(10 BYTE)               NOT NULL,
  STAD_PATH     VARCHAR2(100 BYTE)              NOT NULL,
  STAD_ESID     VARCHAR2(10 BYTE)               NOT NULL,
  STAD_PACID    VARCHAR2(10 BYTE),
  STAD_ACIDCRE  VARCHAR2(10 BYTE),
  STAD_DATECRE  DATE,
  STAD_ACIDMOD  VARCHAR2(10 BYTE),
  STAD_DATEMOD  DATE,
  STAD_CHNGCNT  NUMBER(5),
  STAD_MOVER    VARCHAR2(100 BYTE)
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.STA_DIRECTORY IS 'Possible output directories for users';


/* This object may not be sorted properly in the script due to cirular references. */
--
-- STA_JOB  (Table) 
--
CREATE TABLE SBS1_ADMIN.STA_JOB
(
  STAJ_ID               VARCHAR2(10 BYTE)       NOT NULL,
  STAJ_PACID            VARCHAR2(10 BYTE)       NOT NULL,
  STAJ_PARENTID         VARCHAR2(10 BYTE)       NOT NULL,
  STAJ_ESID             VARCHAR2(10 BYTE)       NOT NULL,
  STAJ_ETID             VARCHAR2(10 BYTE),
  STAJ_INFO             VARCHAR2(2000 BYTE),
  STAJ_DATEEXE          DATE,
  STAJ_DATESTA          DATE,
  STAJ_DATECRE          DATE,
  STAJ_ACIDCRE          VARCHAR2(10 BYTE),
  STAJ_DATEMOD          DATE,
  STAJ_ACIDMOD          VARCHAR2(10 BYTE),
  STAJ_CHNGCNT          NUMBER(5),
  STAJ_BOHIDSCHED       VARCHAR2(10 BYTE),
  STAJ_BOHIDEXEC        VARCHAR2(10 BYTE),
  STAJ_DATETRY          DATE,
  STAJ_NOOFTRIALS       NUMBER(8),
  STAJ_SYSINFO          VARCHAR2(4000 BYTE),
  STAJ_LTVALUE          VARCHAR2(10 BYTE),
  STAJ_PERIODID         VARCHAR2(10 BYTE),
  STAJ_DIRECTORYID      VARCHAR2(10 BYTE),
  STAJ_NOTIFICATION     NUMBER(1),
  STAJ_NOTID            VARCHAR2(10 BYTE),
  STAJ_NOTEMAILSUCCESS  VARCHAR2(500 BYTE),
  STAJ_NOTEMAILFAILURE  VARCHAR2(500 BYTE),
  STAJ_NOTSENDATT       NUMBER(1)
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.STA_JOB IS 'STA_JOB';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOB.STAJ_ID IS 'unique id';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOB.STAJ_PACID IS 'packing id';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOB.STAJ_PARENTID IS 'parent id';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOB.STAJ_ESID IS 'job state';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOB.STAJ_ETID IS 'job type';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOB.STAJ_INFO IS 'ino';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOB.STAJ_DATEEXE IS 'execution date';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOB.STAJ_DATESTA IS 'job state changed on';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOB.STAJ_DATECRE IS 'creation date';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOB.STAJ_ACIDCRE IS 'user id';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOB.STAJ_DATEMOD IS 'last mod date';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOB.STAJ_ACIDMOD IS 'last modification';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOB.STAJ_CHNGCNT IS 'Change Counter';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOB.STAJ_BOHIDSCHED IS 'Header ID SCHEDULER';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOB.STAJ_BOHIDEXEC IS 'Header ID EXECUTER';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOB.STAJ_DATETRY IS 'Last trial on';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOB.STAJ_NOOFTRIALS IS 'Number of trials';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOB.STAJ_SYSINFO IS 'System information';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOB.STAJ_LTVALUE IS 'Looptype value';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOB.STAJ_PERIODID IS 'job periodid';


/* This object may not be sorted properly in the script due to cirular references. */
--
-- STA_JOBOUTPUT  (Table) 
--
CREATE TABLE SBS1_ADMIN.STA_JOBOUTPUT
(
  STAJO_ID         VARCHAR2(10 BYTE)            NOT NULL,
  STAJO_JOBID      VARCHAR2(10 BYTE)            NOT NULL,
  STAJO_DATECRE    DATE,
  STAJO_OUTPUTDIR  VARCHAR2(1000 BYTE),
  STAJO_FILENAME   VARCHAR2(1000 BYTE)          NOT NULL,
  STAJO_ETID       VARCHAR2(10 BYTE)            NOT NULL
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.STA_JOBOUTPUT IS 'STA_JOBOUTPUT';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOBOUTPUT.STAJO_ID IS 'unique id';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOBOUTPUT.STAJO_JOBID IS 'sta job id';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOBOUTPUT.STAJO_DATECRE IS 'creation date';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOBOUTPUT.STAJO_OUTPUTDIR IS 'file output directory';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOBOUTPUT.STAJO_FILENAME IS 'file name';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOBOUTPUT.STAJO_ETID IS 'file type';


/* This object may not be sorted properly in the script due to cirular references. */
--
-- STA_JOBPARAM  (Table) 
--
CREATE TABLE SBS1_ADMIN.STA_JOBPARAM
(
  STAJP_ID     VARCHAR2(10 BYTE)                NOT NULL,
  STAJP_JOBID  VARCHAR2(10 BYTE)                NOT NULL,
  STAJP_NAME   VARCHAR2(100 BYTE)               NOT NULL,
  STAJP_VALUE  VARCHAR2(4000 BYTE)
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.STA_JOBPARAM IS 'STA_JOBPARAM';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOBPARAM.STAJP_ID IS 'unique id';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOBPARAM.STAJP_JOBID IS 'sta job id';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOBPARAM.STAJP_NAME IS 'parameter name';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOBPARAM.STAJP_VALUE IS 'parameter value';


/* This object may not be sorted properly in the script due to cirular references. */
--
-- STA_JOBSQL  (Table) 
--
CREATE TABLE SBS1_ADMIN.STA_JOBSQL
(
  STAJQ_JOBID      VARCHAR2(10 BYTE)            NOT NULL,
  STAJQ_STAQID     VARCHAR2(10 BYTE),
  STAJQ_QUERYNAME  VARCHAR2(100 BYTE)           NOT NULL,
  STAJQ_SQL        VARCHAR2(4000 BYTE)
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.STA_JOBSQL IS 'STA_JOBSQL';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOBSQL.STAJQ_JOBID IS 'Foreign Key packing';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOBSQL.STAJQ_STAQID IS 'Parent SQL Definition';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOBSQL.STAJQ_QUERYNAME IS 'Token for Web and XLS';

COMMENT ON COLUMN SBS1_ADMIN.STA_JOBSQL.STAJQ_SQL IS 'SQL statement';


/* This object may not be sorted properly in the script due to cirular references. */
--
-- STA_PACPARAM  (Table) 
--
CREATE TABLE SBS1_ADMIN.STA_PACPARAM
(
  STAP_ID            VARCHAR2(10 BYTE)          NOT NULL,
  STAP_PACID         VARCHAR2(10 BYTE)          NOT NULL,
  STAP_NAME          VARCHAR2(100 BYTE)         NOT NULL,
  STAP_VALUE         VARCHAR2(2000 BYTE),
  STAP_WEB           NUMBER(1)                  NOT NULL,
  STAP_DROP          NUMBER(1)                  NOT NULL,
  STAP_DROPPERIODID  VARCHAR2(10 BYTE),
  STAP_ABS           NUMBER(1)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.STA_PACPARAM IS 'STA_PACPARAM';

COMMENT ON COLUMN SBS1_ADMIN.STA_PACPARAM.STAP_ID IS 'Unique ID';

COMMENT ON COLUMN SBS1_ADMIN.STA_PACPARAM.STAP_PACID IS 'Packing id';

COMMENT ON COLUMN SBS1_ADMIN.STA_PACPARAM.STAP_NAME IS 'Parameter tag';

COMMENT ON COLUMN SBS1_ADMIN.STA_PACPARAM.STAP_VALUE IS 'Parameter value';

COMMENT ON COLUMN SBS1_ADMIN.STA_PACPARAM.STAP_WEB IS 'Show on Web';

COMMENT ON COLUMN SBS1_ADMIN.STA_PACPARAM.STAP_DROP IS 'Getting droped';

COMMENT ON COLUMN SBS1_ADMIN.STA_PACPARAM.STAP_DROPPERIODID IS 'Droping periodid';

COMMENT ON COLUMN SBS1_ADMIN.STA_PACPARAM.STAP_ABS IS 'Absolute value';


/* This object may not be sorted properly in the script due to cirular references. */
--
-- STA_SQLDEF  (Table) 
--
CREATE TABLE SBS1_ADMIN.STA_SQLDEF
(
  STAQ_ID         VARCHAR2(10 BYTE)             NOT NULL,
  STAQ_PACID      VARCHAR2(10 BYTE)             NOT NULL,
  STAQ_QUERYNAME  VARCHAR2(100 BYTE)            NOT NULL,
  STAQ_VERSION    VARCHAR2(100 BYTE),
  STAQ_SQL        VARCHAR2(4000 BYTE)
)
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.STA_SQLDEF IS 'STA_SQLDEF';

COMMENT ON COLUMN SBS1_ADMIN.STA_SQLDEF.STAQ_ID IS 'Unique Id';

COMMENT ON COLUMN SBS1_ADMIN.STA_SQLDEF.STAQ_PACID IS 'Foreign Key packing';

COMMENT ON COLUMN SBS1_ADMIN.STA_SQLDEF.STAQ_QUERYNAME IS 'Token for Web and XLS';

COMMENT ON COLUMN SBS1_ADMIN.STA_SQLDEF.STAQ_VERSION IS 'Version of statement';

COMMENT ON COLUMN SBS1_ADMIN.STA_SQLDEF.STAQ_SQL IS 'SQL statement';


/* This object may not be sorted properly in the script due to cirular references. */
--
-- STA_SUBSCRIPTION  (Table) 
--
CREATE TABLE SBS1_ADMIN.STA_SUBSCRIPTION
(
  STAU_ID        VARCHAR2(10 BYTE)              NOT NULL,
  STAU_PACID     VARCHAR2(10 BYTE)              NOT NULL,
  STAU_OBJECT    VARCHAR2(100 BYTE)             NOT NULL,
  STAU_VALUE     VARCHAR2(2000 BYTE)            NOT NULL,
  STAU_DATEFROM  DATE,
  STAU_DATETO    DATE,
  STAU_ACIDCRE   VARCHAR2(10 BYTE),
  STAU_DATECRE   DATE,
  STAU_ACIDMOD   VARCHAR2(10 BYTE),
  STAU_DATEMOD   DATE,
  STAU_CHNGCNT   NUMBER(5)
)
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCOMPRESS ;

COMMENT ON TABLE SBS1_ADMIN.STA_SUBSCRIPTION IS 'STA_SUBSCRIPTION';

COMMENT ON COLUMN SBS1_ADMIN.STA_SUBSCRIPTION.STAU_ID IS 'unique id';

COMMENT ON COLUMN SBS1_ADMIN.STA_SUBSCRIPTION.STAU_PACID IS 'Pac id';

COMMENT ON COLUMN SBS1_ADMIN.STA_SUBSCRIPTION.STAU_OBJECT IS 'Foreign key object';

COMMENT ON COLUMN SBS1_ADMIN.STA_SUBSCRIPTION.STAU_VALUE IS 'Foreign key value';

COMMENT ON COLUMN SBS1_ADMIN.STA_SUBSCRIPTION.STAU_DATEFROM IS 'Subscription start from';

COMMENT ON COLUMN SBS1_ADMIN.STA_SUBSCRIPTION.STAU_DATETO IS 'Subscription date to';

COMMENT ON COLUMN SBS1_ADMIN.STA_SUBSCRIPTION.STAU_ACIDCRE IS 'Acid creation';

COMMENT ON COLUMN SBS1_ADMIN.STA_SUBSCRIPTION.STAU_DATECRE IS 'Date of creation';

COMMENT ON COLUMN SBS1_ADMIN.STA_SUBSCRIPTION.STAU_ACIDMOD IS 'Acid modification';

COMMENT ON COLUMN SBS1_ADMIN.STA_SUBSCRIPTION.STAU_DATEMOD IS 'Date of modification';

COMMENT ON COLUMN SBS1_ADMIN.STA_SUBSCRIPTION.STAU_CHNGCNT IS 'Web change count';


/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_BIHID  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_BIHID ON SBS1_ADMIN.BDETAIL
(BD_BIHID)
  TABLESPACE SBS1_INFO_INDEX_UC
  PCTFREE    2
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION INFO201808
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201809
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201810
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201811
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201812
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201901
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201902
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_BIHID1  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_BIHID1 ON SBS1_ADMIN.BDETAIL1
(BD_BIHID)
  TABLESPACE SBS1_SMSC_INDEX_UC
  PCTFREE    2
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION SMSC201808
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201809
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201810
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201811
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201812
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201901
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201902
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_BIHID2  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_BIHID2 ON SBS1_ADMIN.BDETAIL2
(BD_BIHID)
  TABLESPACE SBS1_SMSD_INDEX_UC
  PCTFREE    2
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION SMSD201808
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201809
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201810
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201811
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201812
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201901
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201902
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_BIHID4  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_BIHID4 ON SBS1_ADMIN.BDETAIL4
(BD_BIHID)
  TABLESPACE SBS1_MSCA_INDEX_NC
  PCTFREE    2
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION MSCA201901
    NOCOMPRESS 
    TABLESPACE SBS1_MSCA_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MSCA201902
    NOCOMPRESS 
    TABLESPACE SBS1_MSCA_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_BIHID6  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_BIHID6 ON SBS1_ADMIN.BDETAIL6
(BD_BIHID)
  TABLESPACE SBS1_MMSC_INDEX_NC
  PCTFREE    2
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION MMSC201808
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201809
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201810
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201811
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201812
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201901
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201902
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_BIHID9  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_BIHID9 ON SBS1_ADMIN.BDETAIL9
(BD_BIHID)
  TABLESPACE SBS1_INFO_INDEX_UC
  PCTFREE    10
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION INFO201808
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201809
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201810
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201811
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201812
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201901
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201902
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_BILLID1  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_BILLID1 ON SBS1_ADMIN.BDETAIL1
(BD_BILLID)
  TABLESPACE SBS1_SMSC_INDEX_UC
  PCTFREE    2
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION SMSC201808
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201809
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201810
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201811
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201812
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201901
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201902
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_BILLID2  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_BILLID2 ON SBS1_ADMIN.BDETAIL2
(BD_BILLID)
  TABLESPACE SBS1_SMSD_INDEX_UC
  PCTFREE    2
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION SMSD201808
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201809
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201810
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201811
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201812
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201901
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201902
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_BOHID1  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_BOHID1 ON SBS1_ADMIN.BDETAIL
(BD_BOHID1)
  TABLESPACE SBS1_INFO_INDEX_UC
  PCTFREE    2
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION INFO201808
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201809
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201810
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201811
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201812
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201901
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201902
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_BOHID11  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_BOHID11 ON SBS1_ADMIN.BDETAIL1
(BD_BOHID1)
  TABLESPACE SBS1_SMSC_INDEX_UC
  PCTFREE    2
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION SMSC201808
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201809
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201810
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201811
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201812
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201901
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201902
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_BOHID12  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_BOHID12 ON SBS1_ADMIN.BDETAIL2
(BD_BOHID1)
  TABLESPACE SBS1_SMSD_INDEX_UC
  PCTFREE    2
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION SMSD201808
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201809
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201810
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201811
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201812
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201901
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201902
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_BOHID14  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_BOHID14 ON SBS1_ADMIN.BDETAIL4
(BD_BOHID1)
  TABLESPACE SBS1_MSCA_INDEX_NC
  PCTFREE    2
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION MSCA201901
    NOCOMPRESS 
    TABLESPACE SBS1_MSCA_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MSCA201902
    NOCOMPRESS 
    TABLESPACE SBS1_MSCA_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_BOHID16  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_BOHID16 ON SBS1_ADMIN.BDETAIL6
(BD_BOHID1)
  TABLESPACE SBS1_MMSC_INDEX_NC
  PCTFREE    2
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION MMSC201808
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201809
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201810
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201811
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201812
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201901
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201902
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_BOHID19  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_BOHID19 ON SBS1_ADMIN.BDETAIL9
(BD_BOHID1)
  TABLESPACE SBS1_INFO_INDEX_UC
  PCTFREE    10
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION INFO201808
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201809
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201810
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201811
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201812
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201901
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201902
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_BOHID2  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_BOHID2 ON SBS1_ADMIN.BDETAIL
(BD_BOHID2)
  TABLESPACE SBS1_INFO_INDEX_UC
  PCTFREE    2
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION INFO201808
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201809
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201810
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201811
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201812
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201901
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201902
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_BOHID21  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_BOHID21 ON SBS1_ADMIN.BDETAIL1
(BD_BOHID2)
  TABLESPACE SBS1_SMSC_INDEX_UC
  PCTFREE    2
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION SMSC201808
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201809
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201810
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201811
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201812
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201901
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201902
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_BOHID22  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_BOHID22 ON SBS1_ADMIN.BDETAIL2
(BD_BOHID2)
  TABLESPACE SBS1_SMSD_INDEX_UC
  PCTFREE    2
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION SMSD201808
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201809
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201810
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201811
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201812
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201901
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201902
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_BOHID24  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_BOHID24 ON SBS1_ADMIN.BDETAIL4
(BD_BOHID2)
  TABLESPACE SBS1_MSCA_INDEX_NC
  PCTFREE    2
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION MSCA201901
    NOCOMPRESS 
    TABLESPACE SBS1_MSCA_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MSCA201902
    NOCOMPRESS 
    TABLESPACE SBS1_MSCA_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_BOHID26  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_BOHID26 ON SBS1_ADMIN.BDETAIL6
(BD_BOHID2)
  TABLESPACE SBS1_MMSC_INDEX_NC
  PCTFREE    2
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION MMSC201808
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201809
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201810
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201811
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201812
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201901
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201902
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_BOHID29  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_BOHID29 ON SBS1_ADMIN.BDETAIL9
(BD_BOHID2)
  TABLESPACE SBS1_INFO_INDEX_UC
  PCTFREE    10
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION INFO201808
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201809
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201810
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201811
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201812
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201901
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201902
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_BOHID3  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_BOHID3 ON SBS1_ADMIN.BDETAIL
(BD_BOHID3)
  TABLESPACE SBS1_INFO_INDEX_UC
  PCTFREE    2
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION INFO201808
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201809
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201810
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201811
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201812
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201901
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201902
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_BOHID31  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_BOHID31 ON SBS1_ADMIN.BDETAIL1
(BD_BOHID3)
  TABLESPACE SBS1_SMSC_INDEX_UC
  PCTFREE    2
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION SMSC201808
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201809
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201810
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201811
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201812
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201901
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201902
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_BOHID32  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_BOHID32 ON SBS1_ADMIN.BDETAIL2
(BD_BOHID3)
  TABLESPACE SBS1_SMSD_INDEX_UC
  PCTFREE    2
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION SMSD201808
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201809
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201810
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201811
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201812
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201901
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201902
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_BOHID34  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_BOHID34 ON SBS1_ADMIN.BDETAIL4
(BD_BOHID3)
  TABLESPACE SBS1_MSCA_INDEX_NC
  PCTFREE    2
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION MSCA201901
    NOCOMPRESS 
    TABLESPACE SBS1_MSCA_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MSCA201902
    NOCOMPRESS 
    TABLESPACE SBS1_MSCA_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_BOHID36  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_BOHID36 ON SBS1_ADMIN.BDETAIL6
(BD_BOHID3)
  TABLESPACE SBS1_MMSC_INDEX_NC
  PCTFREE    2
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION MMSC201808
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201809
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201810
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201811
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201812
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201901
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201902
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_BOHID39  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_BOHID39 ON SBS1_ADMIN.BDETAIL9
(BD_BOHID3)
  TABLESPACE SBS1_INFO_INDEX_UC
  PCTFREE    10
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION INFO201808
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201809
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201810
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201811
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201812
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201901
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201902
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_DATETIME  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_DATETIME ON SBS1_ADMIN.BDETAIL
(BD_DATETIME)
  TABLESPACE SBS1_INFO_INDEX_UC
  PCTFREE    2
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION INFO201808
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201809
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201810
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201811
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201812
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201901
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201902
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_DATETIME1  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_DATETIME1 ON SBS1_ADMIN.BDETAIL1
(BD_DATETIME)
  TABLESPACE SBS1_SMSC_INDEX_UC
  PCTFREE    2
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION SMSC201808
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201809
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201810
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201811
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201812
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201901
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201902
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_DATETIME2  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_DATETIME2 ON SBS1_ADMIN.BDETAIL2
(BD_DATESUBMIT)
  TABLESPACE SBS1_SMSD_INDEX_UC
  PCTFREE    2
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION SMSD201808
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201809
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201810
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201811
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201812
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201901
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201902
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_DATETIME6  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_DATETIME6 ON SBS1_ADMIN.BDETAIL6
(BD_DATETIME)
  TABLESPACE SBS1_MMSC_INDEX_NC
  PCTFREE    2
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION MMSC201808
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201809
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201810
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201811
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201812
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201901
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201902
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_ID  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_ID ON SBS1_ADMIN.BDETAIL
(BD_ID)
  TABLESPACE SBS1_INFO_INDEX_UC
  PCTFREE    2
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION INFO201808
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201809
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201810
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201811
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201812
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201901
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201902
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_ID1  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_ID1 ON SBS1_ADMIN.BDETAIL1
(BD_ID)
  TABLESPACE SBS1_SMSC_INDEX_UC
  PCTFREE    2
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION SMSC201808
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201809
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201810
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201811
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201812
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201901
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201902
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_ID2  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_ID2 ON SBS1_ADMIN.BDETAIL2
(BD_ID)
  TABLESPACE SBS1_SMSD_INDEX_UC
  PCTFREE    2
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION SMSD201808
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201809
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201810
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201811
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201812
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201901
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201902
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_ID4  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_ID4 ON SBS1_ADMIN.BDETAIL4
(BD_ID)
  TABLESPACE SBS1_MSCA_INDEX_NC
  PCTFREE    2
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION MSCA201901
    NOCOMPRESS 
    TABLESPACE SBS1_MSCA_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MSCA201902
    NOCOMPRESS 
    TABLESPACE SBS1_MSCA_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_ID6  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_ID6 ON SBS1_ADMIN.BDETAIL6
(BD_ID)
  TABLESPACE SBS1_MMSC_INDEX_NC
  PCTFREE    2
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION MMSC201808
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201809
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201810
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201811
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201812
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201901
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201902
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_ID9  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_ID9 ON SBS1_ADMIN.BDETAIL9
(BD_ID)
  TABLESPACE SBS1_INFO_INDEX_UC
  PCTFREE    10
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION INFO201808
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201809
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201810
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201811
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201812
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201901
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201902
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_MSGID  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_MSGID ON SBS1_ADMIN.BDETAIL
(BD_MSGID, BD_MSISDN_A)
  TABLESPACE SBS1_INFO_INDEX_UC
  PCTFREE    2
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION INFO201808
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201809
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201810
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201811
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201812
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201901
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201902
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_PACSID1  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_PACSID1 ON SBS1_ADMIN.BDETAIL
(BD_PACSID1)
  TABLESPACE SBS1_INFO_INDEX_UC
  PCTFREE    2
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION INFO201808
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201809
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201810
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201811
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201812
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201901
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201902
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_PACSID11  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_PACSID11 ON SBS1_ADMIN.BDETAIL1
(BD_PACSID1)
  TABLESPACE SBS1_SMSC_INDEX_UC
  PCTFREE    2
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION SMSC201808
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201809
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201810
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201811
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201812
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201901
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201902
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_PACSID12  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_PACSID12 ON SBS1_ADMIN.BDETAIL2
(BD_PACSID1)
  TABLESPACE SBS1_SMSD_INDEX_UC
  PCTFREE    2
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION SMSD201808
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201809
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201810
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201811
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201812
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201901
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201902
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_PACSID14  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_PACSID14 ON SBS1_ADMIN.BDETAIL4
(BD_PACSID1)
  TABLESPACE SBS1_MSCA_INDEX_NC
  PCTFREE    2
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION MSCA201901
    NOCOMPRESS 
    TABLESPACE SBS1_MSCA_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MSCA201902
    NOCOMPRESS 
    TABLESPACE SBS1_MSCA_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_PACSID16  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_PACSID16 ON SBS1_ADMIN.BDETAIL6
(BD_PACSID1)
  TABLESPACE SBS1_MMSC_INDEX_NC
  PCTFREE    2
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION MMSC201808
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201809
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201810
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201811
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201812
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201901
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201902
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_PACSID19  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_PACSID19 ON SBS1_ADMIN.BDETAIL9
(BD_PACSID1)
  TABLESPACE SBS1_INFO_INDEX_UC
  PCTFREE    10
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION INFO201808
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201809
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201810
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201811
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201812
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201901
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201902
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_PACSID2  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_PACSID2 ON SBS1_ADMIN.BDETAIL
(BD_PACSID2)
  TABLESPACE SBS1_INFO_INDEX_UC
  PCTFREE    2
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION INFO201808
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201809
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201810
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201811
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201812
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201901
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201902
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_PACSID21  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_PACSID21 ON SBS1_ADMIN.BDETAIL1
(BD_PACSID2)
  TABLESPACE SBS1_SMSC_INDEX_UC
  PCTFREE    2
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION SMSC201808
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201809
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201810
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201811
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201812
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201901
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201902
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_PACSID22  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_PACSID22 ON SBS1_ADMIN.BDETAIL2
(BD_PACSID2)
  TABLESPACE SBS1_SMSD_INDEX_UC
  PCTFREE    2
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION SMSD201808
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201809
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201810
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201811
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201812
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201901
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201902
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_PACSID24  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_PACSID24 ON SBS1_ADMIN.BDETAIL4
(BD_PACSID2)
  TABLESPACE SBS1_MSCA_INDEX_NC
  PCTFREE    2
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION MSCA201901
    NOCOMPRESS 
    TABLESPACE SBS1_MSCA_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MSCA201902
    NOCOMPRESS 
    TABLESPACE SBS1_MSCA_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_PACSID26  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_PACSID26 ON SBS1_ADMIN.BDETAIL6
(BD_PACSID2)
  TABLESPACE SBS1_MMSC_INDEX_NC
  PCTFREE    2
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION MMSC201808
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201809
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201810
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201811
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201812
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201901
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201902
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_PACSID29  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_PACSID29 ON SBS1_ADMIN.BDETAIL9
(BD_PACSID2)
  TABLESPACE SBS1_INFO_INDEX_UC
  PCTFREE    10
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION INFO201808
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201809
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201810
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201811
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201812
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201901
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201902
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_PACSID3  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_PACSID3 ON SBS1_ADMIN.BDETAIL
(BD_PACSID3)
  TABLESPACE SBS1_INFO_INDEX_UC
  PCTFREE    2
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION INFO201808
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201809
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201810
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201811
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201812
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201901
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201902
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_PACSID31  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_PACSID31 ON SBS1_ADMIN.BDETAIL1
(BD_PACSID3)
  TABLESPACE SBS1_SMSC_INDEX_UC
  PCTFREE    2
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION SMSC201808
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201809
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201810
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201811
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201812
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201901
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSC201902
    NOCOMPRESS 
    TABLESPACE SBS1_SMSC_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_PACSID32  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_PACSID32 ON SBS1_ADMIN.BDETAIL2
(BD_PACSID3)
  TABLESPACE SBS1_SMSD_INDEX_UC
  PCTFREE    2
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION SMSD201808
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201809
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201810
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201811
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201812
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201901
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION SMSD201902
    NOCOMPRESS 
    TABLESPACE SBS1_SMSD_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_PACSID34  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_PACSID34 ON SBS1_ADMIN.BDETAIL4
(BD_PACSID3)
  TABLESPACE SBS1_MSCA_INDEX_NC
  PCTFREE    2
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION MSCA201901
    NOCOMPRESS 
    TABLESPACE SBS1_MSCA_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MSCA201902
    NOCOMPRESS 
    TABLESPACE SBS1_MSCA_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_PACSID36  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_PACSID36 ON SBS1_ADMIN.BDETAIL6
(BD_PACSID3)
  TABLESPACE SBS1_MMSC_INDEX_NC
  PCTFREE    2
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION MMSC201808
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201809
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201810
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201811
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201812
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201901
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201902
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_PACSID39  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_PACSID39 ON SBS1_ADMIN.BDETAIL9
(BD_PACSID3)
  TABLESPACE SBS1_INFO_INDEX_UC
  PCTFREE    10
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION INFO201808
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201809
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201810
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201811
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201812
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201901
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201902
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_REQUESTID  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_REQUESTID ON SBS1_ADMIN.BDETAIL
(BD_REQUESTID, BD_MSISDN_A)
  TABLESPACE SBS1_INFO_INDEX_UC
  PCTFREE    2
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION INFO201808
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201809
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201810
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201811
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201812
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201901
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION INFO201902
    NOCOMPRESS 
    TABLESPACE SBS1_INFO_INDEX_UC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BD_UMSGGRPID  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BD_UMSGGRPID ON SBS1_ADMIN.BDETAIL6
(BD_UMSGGRPID, BD_MSISDN_B)
  TABLESPACE SBS1_MMSC_INDEX_NC
  PCTFREE    2
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
             )
LOCAL (  
  PARTITION MMSC201808
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201809
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201810
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201811
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201812
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201901
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                BUFFER_POOL      DEFAULT
               ),  
  PARTITION MMSC201902
    NOCOMPRESS 
    TABLESPACE SBS1_MMSC_INDEX_NC
    PCTFREE    2
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                BUFFER_POOL      DEFAULT
               )
);

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_BOH_DATETIME  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_BOH_DATETIME ON SBS1_ADMIN.BOHEADER
(BOH_DATETIME)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_IWTC_BOHID1  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_IWTC_BOHID1 ON SBS1_ADMIN.IWTCOUNTER
(IWTC_BOHID1)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_IWTC_DATE_SMSCID  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_IWTC_DATE_SMSCID ON SBS1_ADMIN.IWTCOUNTER
(IWTC_DATE, IWTC_SMSCID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_OBJECT_VALUE  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_OBJECT_VALUE ON SBS1_ADMIN.STA_SUBSCRIPTION
(STAU_VALUE)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_PAC_ID  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_PAC_ID ON SBS1_ADMIN.STA_SUBSCRIPTION
(STAU_PACID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_STAJOB_ESID  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_STAJOB_ESID ON SBS1_ADMIN.STA_JOB
(STAJ_ESID, STAJ_PACID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_STAJOB_PARENTID  (Index) 
--
CREATE INDEX SBS1_ADMIN.IDX_STAJOB_PARENTID ON SBS1_ADMIN.STA_JOB
(STAJ_PARENTID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_U_JOBIDNAME  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDX_U_JOBIDNAME ON SBS1_ADMIN.STA_JOBPARAM
(STAJP_JOBID, STAJP_NAME)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_U_JOBIDQUERYNAME  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDX_U_JOBIDQUERYNAME ON SBS1_ADMIN.STA_JOBSQL
(STAJQ_JOBID, STAJQ_QUERYNAME)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_U_PACIDPARAMNAME  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDX_U_PACIDPARAMNAME ON SBS1_ADMIN.STA_PACPARAM
(STAP_PACID, STAP_NAME)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

/* This object may not be sorted properly in the script due to cirular references. */
--
-- IDX_U_PACIDQUERYNAME  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.IDX_U_PACIDQUERYNAME ON SBS1_ADMIN.STA_SQLDEF
(STAQ_PACID, STAQ_QUERYNAME)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

/* This object may not be sorted properly in the script due to cirular references. */
--
-- PK_BOHEADER  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_BOHEADER ON SBS1_ADMIN.BOHEADER
(BOH_ID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

/* This object may not be sorted properly in the script due to cirular references. */
--
-- PK_PACKING  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_PACKING ON SBS1_ADMIN.PACKING
(PAC_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

/* This object may not be sorted properly in the script due to cirular references. */
--
-- PK_STA_DIRECTORY  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_STA_DIRECTORY ON SBS1_ADMIN.STA_DIRECTORY
(STAD_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

/* This object may not be sorted properly in the script due to cirular references. */
--
-- PK_STAJOB  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_STAJOB ON SBS1_ADMIN.STA_JOB
(STAJ_ID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

/* This object may not be sorted properly in the script due to cirular references. */
--
-- PK_STAJOBOUTPUT  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_STAJOBOUTPUT ON SBS1_ADMIN.STA_JOBOUTPUT
(STAJO_ID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

/* This object may not be sorted properly in the script due to cirular references. */
--
-- PK_STAJOBPARAM  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_STAJOBPARAM ON SBS1_ADMIN.STA_JOBPARAM
(STAJP_ID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

/* This object may not be sorted properly in the script due to cirular references. */
--
-- PK_STAPACPARAM  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_STAPACPARAM ON SBS1_ADMIN.STA_PACPARAM
(STAP_ID, STAP_PACID, STAP_NAME)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

/* This object may not be sorted properly in the script due to cirular references. */
--
-- PK_STA_SQLDEF  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_STA_SQLDEF ON SBS1_ADMIN.STA_SQLDEF
(STAQ_ID)
TABLESPACE SBS1_BASE_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          1M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

/* This object may not be sorted properly in the script due to cirular references. */
--
-- PK_STASUBSCRIPTION  (Index) 
--
CREATE UNIQUE INDEX SBS1_ADMIN.PK_STASUBSCRIPTION ON SBS1_ADMIN.STA_SUBSCRIPTION
(STAU_ID)
TABLESPACE SBS1_APPLICATION_INDEX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          10M
            NEXT             10M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

/* This object may not be sorted properly in the script due to cirular references. */
--
-- PKG_ADMIN_COMMON  (Package) 
--
CREATE OR REPLACE PACKAGE SBS1_ADMIN.PKG_ADMIN_COMMON
  IS
--  Purpose: Common routines for SBS input and output converters
--
--  MODIFICATION HISTORY (for details see VSS repository)
--  Person      Date        Comments
--  Moved to Package Body (press Alt-F11 in SQL*Navigator 4.3)
--  ---------   ----------  ----------------------------------------------

--  017SO       14.12.2011  Remove schema qualifier "S B S 0 ."

    function getErrorDesc(lvErrCode in varchar2) return errdef.errd_lang01%type;

    procedure INSERT_WARNING                         --002AH
    (  p_W_APPLIC      IN varchar2,
     p_W_PROCEDURE   IN varchar2,
     p_W_TOPIC       IN varchar2,
     p_W_MESSAGE     IN varchar2,
     p_W_USERERRCODE IN varchar2 DEFAULT NULL,
     p_W_BIHID       IN varchar2 DEFAULT NULL,
     p_W_BOHID       IN varchar2 DEFAULT NULL,
     p_W_BDID        IN varchar2 DEFAULT NULL,
     p_W_SHORTID     IN varchar2 DEFAULT NULL);

    Procedure SP_VALIDATE_EXCHANGE_RATES
    (
        p_CUR_ID        In              Varchar2,
        ErrorCode       Out             Number,
        ErrorMsg        Out             Varchar2,
        ReturnStatus    In Out          Number
    );

    Procedure SP_VALIDATE_PM_VERSION_DATES
    (
        p_PM_ID         In              Varchar2,
        ErrorCode       Out             Number,
        ErrorMsg        Out             Varchar2,
        ReturnStatus    In Out          Number
    );

    Procedure SP_INSERT_PMVTRANS
    (
        p_Dummy         In              Varchar2,
        ErrorCode       Out             Number,
        ErrorMsg        Out             Varchar2,
        ReturnStatus    In Out          Number
    );

    Procedure SP_INSERT_ISSUE
    (
        p_IS_ETID       In      Varchar,
        p_IS_ESID       In      Varchar,
        p_IS_DESCRIPTION In     Varchar,
        p_IS_VISUM      In      Varchar,
        p_IS_CONID      In      Varchar,
        p_IS_ACIDRESP   In      Varchar,
        p_IS_ACIDCRE    In      Varchar,
        ErrorCode       Out     Number,
        ErrorMsg        Out     Varchar2,
        ReturnStatus    In Out  Number
    );

    --009AA overloaded with additional AC_ID parameter
    Procedure SP_INSERT_ISSUE
    (
        p_IS_ETID       In      Varchar,
        p_IS_ESID       In      Varchar,
        p_IS_DESCRIPTION In     Varchar,
        p_IS_VISUM      In      Varchar,
        p_IS_CONID      In      Varchar,
        p_IS_ACID       In      Varchar,
        p_IS_ACIDRESP   In      Varchar,
        p_IS_ACIDCRE    In      Varchar,
        ErrorCode       Out     Number,
        ErrorMsg        Out     Varchar2,
        ReturnStatus    In Out  Number
    );

    --------------------------------------------------------------------------------
    -- Name:          SP_DB_SLEEP
    -- Purpose:       Calls the Sleep procedure to make the connection sleep for
    --                given number of seconds (used in concurrency testing)
    -- ReturnStatus:  0/1 For success/failure
    -- Author:        A. Ahmed
    -- LastUpdate:    28.08.2003 /GW (adapted from WBP-Database)
    --------------------------------------------------------------------------------
    Procedure SP_DB_SLEEP
    (   p_PACT_ID        IN varchar2,
        p_BOH_ID         IN OUT varchar2,

        RecordsAffected  OUT number,
        ErrorCode        OUT number,
        ErrorMsg         OUT varchar2,
        ReturnStatus     IN OUT varchar2
    );

    Procedure SP_INSERT_AAALOG (
        p_Msisdn          In      AAAIMPORT.AAAI_MSISDN%Type,
        p_ChngCnt         In      AAATRACKING.AAAT_CHNGCNT%Type,
        p_TopScm_Old      In      AAATRACKING.AAAT_TOPSCM%Type,
        p_TopScm_New      In      AAAIMPORT.AAAI_TOPSCM%Type,
        p_BarScm_Old      In      AAATRACKING.AAAT_BARSCM%Type,
        p_BarScm_New      In      AAAIMPORT.AAAI_BARSCM%Type,
        p_TopCu_Old       In      AAATRACKING.AAAT_TOPCU%Type,
        p_TopCu_New       In      AAAIMPORT.AAAI_TOPCU%Type,
        p_BarCu_Old       In      AAATRACKING.AAAT_BARCU%Type,
        p_BarCu_New       In      AAAIMPORT.AAAI_BARCU%Type,
        p_ReqType         In      AAAIMPORT.AAAI_REQUESTTYPE%Type,
        p_AcId            In      AAATRACKING.AAAT_ACIDMOD%Type,
        p_Comment         In      AAALOG.AAAL_COMMENT%Type,
        p_ErrNumber       In Out  Number,
        p_ErrDesc         In Out  Varchar2,
        p_ReturnStatus    In Out  Number
    );

  Procedure SP_INSERT_AAALOG (
        p_Msisdn          In      AAAIMPORT.AAAI_MSISDN%Type,
        p_ChngCnt         In      AAATRACKING.AAAT_CHNGCNT%Type,
        p_TopScm_Old      In      AAATRACKING.AAAT_TOPSCM%Type,
        p_TopScm_New      In      AAAIMPORT.AAAI_TOPSCM%Type,
        p_BarScm_Old      In      AAATRACKING.AAAT_BARSCM%Type,
        p_BarScm_New      In      AAAIMPORT.AAAI_BARSCM%Type,
        p_TopCu_Old       In      AAATRACKING.AAAT_TOPCU%Type,
        p_TopCu_New       In      AAAIMPORT.AAAI_TOPCU%Type,
        p_BarCu_Old       In      AAATRACKING.AAAT_BARCU%Type,
        p_BarCu_New       In      AAAIMPORT.AAAI_BARCU%Type,
        p_Sc_Old          IN      AAATRACKING.AAAT_SC%Type,                   --  015SO
        p_Sc_New          IN      AAATRACKING.AAAT_SC%Type,                   --  015SO
        p_ReqType         In      AAAIMPORT.AAAI_REQUESTTYPE%Type,
        p_AcId            In      AAATRACKING.AAAT_ACIDMOD%Type,
        p_Comment         In      AAALOG.AAAL_COMMENT%Type,
        p_ErrNumber       In Out  Number,
        p_ErrDesc         In Out  Varchar2,
        p_ReturnStatus    In Out  Number
    );

    Procedure SP_RESET_AAATRACKING (
        p_MSISDN            In      Varchar2,
        p_BIHID             In      Varchar2,
        p_BOHID             In      Varchar2,
        ErrorCode           Out     Number,
        ErrorMsg            Out     Varchar2,
        ReturnStatus        In Out  Number
    );

    Procedure SP_SMSC_ASSIGNMENT_EXECUTE (
        p_PACT_ID           In      Varchar2,
        p_BOH_ID            In      Varchar2,
        p_AC_ID             In      Varchar2,
        RecordsAffected     Out     Number,
        ErrorCode           Out     Number,
        ErrorMsg            Out     Varchar2,
        ReturnStatus        In Out  Number
    );

/* --  016SO
    procedure generateTestData(
        pJobId              IN      varchar2 DEFAULT '0',
        RecordsAffected     OUT     number,
        ErrorCode           OUT     number,
        ErrorMsg            OUT     varchar2,
        ReturnStatus        IN OUT  number
    );
*/

    Procedure SP_NEW_STA_JOB (
        p_StajParentId      In      STA_JOB.STAJ_PARENTID%Type,
        p_StajPacId         In      STA_JOB.STAJ_PACID%Type,
        p_StajInfo          In      STA_JOB.STAJ_INFO%Type,
        p_StajLtValue       In      STA_JOB.STAJ_LTVALUE%Type,
        p_StajPeriodId      In      STA_JOB.STAJ_PERIODID%Type,
        p_AcIdCre           In      ACCOUNT.AC_ID%Type,
        p_StajId            Out     STA_JOB.STAJ_ID%Type,
        p_RecordsAffected   Out     Number,
        p_ErrNumber         In Out  Number,
        p_ErrDesc           In Out  Varchar2,
        p_ReturnStatus      In Out  Number
    );

    -- 008AA
    Procedure SP_NEW_STA_JOB (
        p_StajParentId      In      STA_JOB.STAJ_PARENTID%Type,
        p_StajPacId         In      STA_JOB.STAJ_PACID%Type,
        p_StajInfo          In      STA_JOB.STAJ_INFO%Type,
        p_StajLtValue       In      STA_JOB.STAJ_LTVALUE%Type,
        p_StajPeriodId      In      STA_JOB.STAJ_PERIODID%Type,
        p_AcIdCre           In      ACCOUNT.AC_ID%Type,
        p_StajId            Out     STA_JOB.STAJ_ID%Type,
        p_StajNotification  In      STA_JOB.STAJ_NOTIFICATION%Type,             -- 008AA
        p_StajNotId         In      STA_JOB.STAJ_NOTID%Type,                    -- 008AA
        p_StajNotEmailSuccess   In  STA_JOB.STAJ_NOTEMAILSUCCESS%Type,          -- 008AA
        p_StajNotEmailFailure   In  STA_JOB.STAJ_NOTEMAILFAILURE%Type,          -- 008AA
        p_StajNotSendAttachment In  STA_JOB.STAJ_NOTSENDATT%Type,               -- 008AA
        p_RecordsAffected   Out     Number,
        p_ErrNumber         In Out  Number,
        p_ErrDesc           In Out  Varchar2,
        p_ReturnStatus      In Out  Number
    );

    Procedure SP_NEW_STA_JOBPARAM (
        p_StajId            In      STA_JOB.STAJ_ID%Type,
        p_StajpName         In      STA_JOBPARAM.STAJP_NAME%Type,
        p_StajpValue        In      STA_JOBPARAM.STAJP_VALUE%Type,
        p_RecordsAffected   Out     Number,
        p_ErrNumber         In Out  Number,
        p_ErrDesc           In Out  Varchar2,
        p_ReturnStatus      In Out  Number
    );

    Procedure SP_NEW_STA_JOBSQLS (
        p_StajId            In      STA_JOB.STAJ_ID%Type,
        p_RecordsAffected   Out     Number,
        p_ErrNumber         In Out  Number,
        p_ErrDesc           In Out  Varchar2,
        p_ReturnStatus      In Out  Number
    );

    Procedure SP_REPLACE_PARAMS (
        p_StajId            In      Varchar2,
        p_PacId             In      Varchar2,
        p_PacLtId           In      Varchar2,
        p_StaqSql           In      Varchar2,
        p_StaqSqlNew        Out     Varchar2,
        p_RecordsAffected   Out     Number,
        p_ErrNumber         In Out  Number,
        p_ErrDesc           In Out  Varchar2,
        p_ReturnStatus      In Out  Number
    );

    Procedure checkBaseTableData (
        inPacId          In     Varchar2,

        outDateFrom      Out    Date,
        outDateTo        Out    Date,
        outDrop          Out    Number,
        outDropPeriod    Out    Varchar2,

        outDateFromRaw   Out    Date,
        outDateToRaw     Out    Date,

        RecordsAffected  Out    Number,
        ErrorCode        Out    Number,
        ErrorMsg         Out    Varchar2,
        ReturnStatus     In Out Number
    );

    PROCEDURE checkDependenciesWeb (
        inPacId          In      Varchar2,
        inDateFrom       In      Date,
        inDateTo         In      Date,

        oDepend          In Out  Number,
        oDepPacId        In Out  Varchar2,
        oDepPacName      In Out  Varchar2,
        oDepPacExec      In Out  Date,

        RecordsAffected  Out     Number,
        ErrorCode        Out     Number,
        ErrorMsg         Out     Varchar2,
        ReturnStatus     In Out  Number
    );

  Procedure SP_LONGID_MAP_ADD
    (
        p_AC_ID         In      Varchar2,                                       --  014SO
        p_LONGM_LONGID1 In      LONGID.LONG_ID%type,
        p_LONGM_LONGID2 In      LONGID.LONG_ID%type,
        p_COMMENT       IN      Varchar2,
        ErrorCode       Out     Number,
        ErrorMsg        Out     Varchar2,
        ReturnStatus    In Out  Number
    );  --  012SO

  Procedure SP_LONGID_MAP_REFRESH
  ;     --  012SO

  Procedure SP_LONGID_MAP_UPDATE
    (
        p_AC_ID             In      Varchar2,                                   --  014SO
        p_LONGM_LONGID1     In      LONGIDMAP.LONGM_LONGID1%type,
        p_LONGM_LONGID2     In      LONGIDMAP.LONGM_LONGID2%type,
        p_LONGM_ESID        IN      LONGIDMAP.LONGM_ESID%type,
        p_LONGM_DATESTART   IN      Varchar2,
        p_LONGM_DATEEND     IN      Varchar2,
        p_LONGM_SHORTID     IN      LONGIDMAP.LONGM_SHORTID%type,
        p_LONGM_PRICE       IN      Varchar2,
        p_FORCE             IN      Number,
        p_COMMENT           IN      Varchar2,
        ErrorCode           Out     Number,
        ErrorMsg            Out     Varchar2,
        ReturnStatus        In Out  Number
    );  --  012SO

  Procedure SP_HIDE_JOB_OUTPUT (
      p_AcId              In      ACCOUNT.AC_ID%Type,
      p_JobOutputId       In      STA_JOBOUTPUT.STAJO_ID%Type,
      p_ErrNumber         In Out  Number,
      p_ErrDesc           In Out  Varchar2
  );

  Procedure SP_ADD_REPORT(
        STR_ACID              IN  Varchar2
      , STR_PAC_ID            IN  Varchar2
      , DAT_FROM              IN  Date
      , DAT_TO                IN  Date
      , STR_OPT_PARAM         IN  Varchar2
      , STR_COMMENT           IN  Varchar2
      , STR_SYSTEM_INFO       IN  Varchar2
      , STR_PARAMETER_INFO    IN  Varchar2
      , INT_PAC_MODIS         IN  NUMBER
      , INT_PAC_MODLA         IN  NUMBER
      , INT_PAC_MODIW         IN  NUMBER
      , INT_PAC_MODSYS        IN  NUMBER
      , INT_PAC_MODCUC        IN  NUMBER
      , INT_ErrNumber         OUT  NUMBER
      , STR_ErrDesc           OUT  VARCHAR2
  ) ;

END; -- Package spec
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- PKG_BDETAIL_COMMON  (Package) 
--
CREATE OR REPLACE PACKAGE SBS1_ADMIN.PKG_BDETAIL_COMMON
  IS
--
--  Purpose: Common routines for SBS input and output converters
--
--  MODIFICATION HISTORY (see also Package Body)
--  Person  Date        Comments
--011SO     09.10.2006  Add Types for MBBulk processing
--012SO     13.09.2007  Add Types for STAN (St.Anton) processing
--013DA     25.11.2009  tSrcType enumeration extended with 8 new source types for MEC_IC CSV parser
--  ---------   ----------  ----------------------------------------------

-- Source Type
Type tSrcType Is Record (
    CCNDC             SrcType.Srct_Id%Type  := 'CCNDC',                         --013DA
    ISRV              SrcType.Srct_Id%Type  := 'ISRV',
    MCA_MM1           SrcType.Srct_Id%Type  := 'MCA_MM1',                       --013DA
    MCA_MM3           SrcType.Srct_Id%Type  := 'MCA_MM3',                       --013DA
    MCA_STI           SrcType.Srct_Id%Type  := 'MCA_STI',                       --013DA
    MCA_IMG           SrcType.Srct_Id%Type  := 'MCA_IMG',                       --013DA
    MCA_VID           SrcType.Srct_Id%Type  := 'MCA_VID',                       --013DA
    MCA_AUD           SrcType.Srct_Id%Type  := 'MCA_AUD',                       --013DA
    MCCMNC            SrcType.Srct_Id%Type  := 'MCCMNC',                        --013DA
    MMSC              SrcType.Srct_Id%Type  := 'MMSC',
    MSC               SrcType.Srct_Id%Type  := 'MSC',
    OPER              SrcType.Srct_Id%Type  := 'OPER',                          --013DA: OPER may be removed if checked
    POS               SrcType.Srct_Id%Type  := 'POS',
    SMSC              SrcType.Srct_Id%Type  := 'SMSC',
    STAN              SrcType.Srct_Id%Type  := 'STAN',                          --012SO
    VASP              SrcType.Srct_Id%Type  := 'VASP'
);

-- Mapping States
Type tMapEsId Is Record (
  Mapping           MapState.Maps_Id%Type := 'M',
  MapNoSet          MapState.Maps_Id%Type := 'm',
  Ignore            MapState.Maps_Id%Type := 'I',
  Error             MapState.Maps_Id%Type := 'E',
  Ready             MapState.Maps_Id%Type := 'R'
);

-- (Billing/Handler) Input Header States
Type tIhEsId Is Record (
  Mapping           bihstate.bihs_id%Type := 'MAP',
  ErrorInRec        bihstate.bihs_id%Type := 'ERR',
  ErrorInFile       bihstate.bihs_id%Type := 'ERF',
  Ready             bihstate.bihs_id%Type := 'RDY',
  Indexed           bihstate.bihs_id%Type := 'IDX'
);


Procedure SP_UPDATE_DLS_DATES
(
  p_PACT_ID       In      Varchar2,
  p_BOH_ID        In      Varchar2,
  RecordsAffected Out     Number,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  ReturnStatus    In Out  Number
);

procedure FETCH_NEW_BOHEADER
    ( p_Type in char DEFAULT 'G',
        p_BOH_ID in out varchar2,
        p_Filename in varchar2,
        p_Pacid in varchar2,
    ReturnStatus    IN OUT number);

procedure INSERT_WARNING                         --002AH
  (  p_W_APPLIC      IN varchar2,
     p_W_PROCEDURE   IN varchar2,
     p_W_TOPIC       IN varchar2,
     p_W_MESSAGE     IN varchar2,
     p_W_USERERRCODE IN varchar2 DEFAULT NULL,
     p_W_BIHID       IN varchar2 DEFAULT NULL,
     p_W_BOHID       IN varchar2 DEFAULT NULL,
     p_W_BDID        IN varchar2 DEFAULT NULL,
     p_W_SHORTID     IN varchar2 DEFAULT NULL);

procedure SP_INSERT_WARNING
(  p_W_APPLIC      IN varchar2,
   p_W_PROCEDURE   IN varchar2,
   p_W_TOPIC       IN varchar2,
   p_W_MESSAGE     IN varchar2,
   p_W_BIHID       IN varchar2,
   p_W_BOHID       IN varchar2,
   p_W_BDID        IN varchar2,
   p_W_SHORTID     IN varchar2);

procedure SP_INSERT_WARNING
(  p_W_APPLIC      IN varchar2,
   p_W_PROCEDURE   IN varchar2,
   p_W_TOPIC       IN varchar2,
   p_W_MESSAGE     IN varchar2,
   p_W_BIHID       IN varchar2,
   p_W_BOHID       IN varchar2,
   p_W_BDID        IN varchar2,
   p_W_SHORTID     IN varchar2,
   ErrorCode       OUT number,
   ErrorMsg        OUT varchar2,
   ReturnStatus    IN OUT number);

Procedure SP_INSERT_BIHEADER_MEC (
    p_BIH_ID            In Out  Varchar2,
    p_BIH_DEMO          In      Number,
    p_BIH_FILESEQ       In      Number,
    p_BIH_FILENAME      In      Varchar2,
    p_BIH_FILEDATE      In      Varchar2,
    p_BIH_MAPID         In      Varchar2,
    p_AppName           In      Varchar2,
    p_AppVer            In      Varchar2,
    p_Thread            IN      Varchar2,                                       --025SO
    p_JobId             In      Number,
    p_HostName          In      Varchar2,
    P_Status            In      Varchar,
    ErrorCode           Out     Number,
    ErrorMsg            Out     Varchar2,
    ReturnStatus        Out     Number              --026SO
);  --030SO

PROCEDURE SP_UPDATE_BIH_FOR_EMPTY_DETAIL
( p_BIHID         In      Varchar2,
  p_MaxAge        In      Number,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  ReturnStatus    In Out  Number);


Procedure SP_INSERT_BOHEADER_MEC (
    p_BOH_ID            In Out  Varchar2,
    p_BOH_DEMO          In      Number,
    p_BOH_FILESEQ       In      Number,
    p_BOH_FILENAME      In      Varchar2,
    p_BOH_PACKID        In      Varchar2,
    p_AppName           In      Varchar2,
    p_AppVer            In      Varchar2,
    p_Thread            IN      Varchar2,                                       --025SO
    p_JobId             In      Number,
    p_HostName          In      Varchar2,
    ErrorCode           Out     Number,
    ErrorMsg            Out     Varchar2,
    ReturnStatus        Out     Number          --026SO
);  --030SO

procedure SP_UPDATE_BOHEADER_NODATA_0
( p_bohid         In      Varchar2,
  p_status        In      Varchar2,
  p_count         In      Number,
  p_MaxAge        In      Number,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  ReturnStatus    In Out  Number);

procedure SP_UPDATE_BOHEADER_EXCEL_0
( p_bohid         In      Varchar2,
  p_status        In      Varchar2,
  p_count         In      Number,
  p_MaxAge        In      Number,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  ReturnStatus    In Out  Number);

procedure SP_DELETE_ALL_RECORDS_EXCEL
( p_FileId        IN varchar2,
  p_JobType       IN char,
  p_packid        IN varchar2,
  p_MaxAge        In      Number,
  ErrorCode       OUT number,
  ErrorMsg        OUT varchar2,
  ReturnStatus    IN OUT number);

procedure SP_DELETE_ALL_RECORDS_NODTATA
( p_FileId        IN varchar2,
  p_JobType       IN char,
  p_packid        IN varchar2,
  p_MaxAge        In      Number,
  ErrorCode       OUT number,
  ErrorMsg        OUT varchar2,
  ReturnStatus    IN OUT number);

procedure SP_ANALYZE_TABLES
(
   p_PACT_ID        IN varchar2,
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT number );

Function SP_IS_NUMERIC (
  p_InputValue    In              Varchar2
)
Return Number;

Procedure SP_GET_NEXT_PAC_SEQ(
    p_PACID                     In      Varchar2,
    p_NextSequence              Out     Varchar2,
    p_ErrorCode                 Out     Number,
    p_ErrorMsg                  Out     Varchar2,
    p_ReturnStatus              In Out  Number
);

Procedure SP_DB_SLEEP(
   p_PACT_ID        IN varchar2,
   p_BOH_ID         IN OUT varchar2,

   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT varchar2
);

procedure SP_UPDATE_BOHEADER(
  p_bohid         In      Varchar2,
  p_status        In      Varchar2,
  p_count         In      Number,
  p_DateFc        In      Date,
  p_DateLc        In      Date,
  p_MaxAge        In      Number
);  --014SO

procedure SP_UPDATE_BOHEADER(
  p_bohid         In      Varchar2,
  p_status        In      Varchar2,
  p_count         In      Number,
  p_DateFc        In      Date,
  p_DateLc        In      Date,
  p_MaxAge        In      Number,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  ReturnStatus    In Out  Number
); --014SO

Function isTimeForMapping
(
    p_BIH_MAPID   IN varchar2
)
Return integer;

Function isTimeForPacking
(
    p_BIH_PACID   IN varchar2
)
Return integer;

  Function getTypeForMapping
(
    p_BIH_MAPID   IN varchar2
)
Return VARCHAR2;
  Function getTypeForPacking
(
    p_BIH_PACID   IN varchar2
)
Return VARCHAR2;
  Function getSrcTypeForMapping
(
    p_BIH_MAPID   IN varchar2
)
Return VARCHAR2;
  Function getSrcTypeForBiHeader
(
    p_BIH_ID   IN varchar2
)
Return VARCHAR2;

procedure SP_INSERT_BIHEADER(
    p_BIH_ID    IN varchar2,
    p_BIH_SRCTYPE   IN varchar2,
    p_BIH_DEMO    IN number,
    p_BIH_FILESEQ IN number,
    p_BIH_FILENAME  IN varchar2,
    p_BIH_FILEDATE  IN varchar2,
    p_BIH_MAPID   IN varchar2,
    P_Status    IN varchar,
    ErrorCode     OUT number,
    ErrorMsg      OUT varchar2,
    ReturnStatus      IN OUT number
); --031SO

Procedure SP_INSERT_BIHEADER (
    p_BIH_ID            In      Varchar2,
    p_BIH_SRCTYPE       In      Varchar2,
    p_BIH_DEMO          In      Number,
    p_BIH_FILESEQ       In      Number,
    p_BIH_FILENAME      In      Varchar2,
    p_BIH_FILEDATE      In      Varchar2,
    p_BIH_MAPID         In      Varchar2,
    p_AppName           In      Varchar2,
    p_AppVer            In      Varchar2,
    p_JobId             In      Number,
    p_HostName          In      Varchar2,
    P_Status            In      Varchar,
    ErrorCode           Out     Number,
    ErrorMsg            Out     Varchar2,
    ReturnStatus        In Out  Number
);  --031SO

procedure SP_INSERT_BOHEADER (
    p_BOH_ID    IN varchar2,
    p_BOH_DEMO    IN number,
    p_BOH_FILESEQ IN number,
    p_BOH_FILENAME  IN varchar2,
    p_BOH_PACKID    IN varchar2,
    ErrorCode     OUT number,
    ErrorMsg      OUT varchar2,
    ReturnStatus      IN OUT number
);  --031SO

Procedure SP_INSERT_BOHEADER (
    p_BOH_ID            In      Varchar2,
    p_BOH_DEMO          In      Number,
    p_BOH_FILESEQ       In      Number,
    p_BOH_FILENAME      In      Varchar2,
    p_BOH_PACKID        In      Varchar2,
    p_AppName           In      Varchar2,
    p_AppVer            In      Varchar2,
    p_JobId             In      Number,
    p_HostName          In      Varchar2,
    ErrorCode           Out     Number,
    ErrorMsg            Out     Varchar2,
    ReturnStatus        In Out  Number
);  --031SO

END; -- Package Specification PKG_BDETAIL_COMMON
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- PKG_BDETAIL_INFO  (Package) 
--
CREATE OR REPLACE PACKAGE SBS1_ADMIN.PKG_BDETAIL_INFO as

--
--  Purpose: Routines for info service CDR input and output converters
--
--  MODIFICATION HISTORY (for details see VSS repository)
--  Person      Date        Comments
--  SO          06.06.2001  Created from earlier versions (SBS phase 4)

--  ---------   ----------  ----------------------------------------------

-- Data types common across INFO and SMSC
--  type ARRSRCTYPE is table of VARCHAR2(10)  index by BINARY_INTEGER;
--  type ARRDEMO is table of NUMBER(1)  index by BINARY_INTEGER;
--  type ARRBIHID is table of VARCHAR2(10)  index by BINARY_INTEGER;
  type ARRESCODE is table of VARCHAR2(2)  index by BINARY_INTEGER;
  type ARRBIRECNO is table of NUMBER(8)  index by BINARY_INTEGER;
  type ARRMSISDNA is table of VARCHAR2(20)  index by BINARY_INTEGER;
  type ARRDATETIME is table of VARCHAR2(20)  index by BINARY_INTEGER;
  type ARRSTATUS is table of VARCHAR2(2)  index by BINARY_INTEGER;
  type ARRNPIA is table of VARCHAR2(2)  index by BINARY_INTEGER;
  type ARRTONA is table of VARCHAR2(2)  index by BINARY_INTEGER;
  type ARRBDID is table of VARCHAR2(10)  index by BINARY_INTEGER;
  type ARRPREPAID is table of VARCHAR2(1)  index by BINARY_INTEGER;

  --Data types specific to INFO

  type ARRSERVICE is table of VARCHAR2(32)  index by BINARY_INTEGER;
  type ARRKEYWORD is table of VARCHAR2(80)  index by BINARY_INTEGER;
  type ARRBILLTEXT is table of VARCHAR2(80)  index by BINARY_INTEGER;
  type ARRLANGID is table of VARCHAR2(10)  index by BINARY_INTEGER;
  type ARRNODENAME is table of VARCHAR2(64)  index by BINARY_INTEGER;
  type ARRREQTYPE is table of NUMBER(4)  index by BINARY_INTEGER;
  type ARRBILLRATE is table of NUMBER(3)  index by BINARY_INTEGER;
  type ARRNETWORK is table of NUMBER(2)  index by BINARY_INTEGER;
  type ARRITEMNO is table of NUMBER(4)  index by BINARY_INTEGER;
  type ARRREQUESTID is table of NUMBER(10)  index by BINARY_INTEGER;
  type ARRCONID is table of VARCHAR2(10)  index by BINARY_INTEGER;
  type ARRSHORTID is table of VARCHAR2(6)  index by BINARY_INTEGER;
  type ARRPMID is table of VARCHAR2(10)  index by BINARY_INTEGER;
  type ARRAMOUNT is table of VARCHAR2(10)  index by BINARY_INTEGER;

  type ARRIMSI is table of VARCHAR2(20)  index by BINARY_INTEGER;               --  017SO

  procedure SP_CONS_IS
(
   p_PAC_ID         IN varchar2,        -- 'IS'
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT number );
  procedure SP_CONS_ISMSISDN
(
   p_PAC_ID         IN varchar2,    -- 'ISMSISDN'   ISMSISDN Consolidation
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT number );
  procedure SP_CONS_PURGEIPC
(
   p_PAC_ID         IN varchar2,        -- 'PURGEIPC'  Purge IS Contracts (de-activate)
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT number );
  PROCEDURE SP_CONS_TR
(
   p_PACT_ID        In      Varchar2,
   p_BOH_ID         In      Varchar2,
   RecordsAffected  Out     Number,
   ErrorCode        Out     Number,
   ErrorMsg         Out     Varchar2,
   ReturnStatus     In Out  Number
);
end Pkg_BDetail_info;
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- PKG_BDETAIL_MMSC  (Package) 
--
CREATE OR REPLACE PACKAGE SBS1_ADMIN.PKG_BDETAIL_MMSC
Is

-- 019SO

procedure SP_UPDATE_BOHEADER_MMSC_2
(  p_bohid         IN              varchar2,
   p_status        IN              varchar2,
   p_count         IN              number,
   p_MaxAge        In      Number,
   ErrorCode       OUT             number,
   ErrorMsg        OUT             varchar2,
   ReturnStatus    IN OUT  number
);  -- 015SO


procedure SP_UPDATE_BOHEADER_MMSC_3
(  p_bohid         IN              varchar2,
   p_status        IN              varchar2,
   p_count         IN              number,
   p_MaxAge        In      Number,
   ErrorCode       OUT             number,
   ErrorMsg        OUT             varchar2,
   ReturnStatus    IN OUT  number
);  -- 014SO

  procedure SP_CONS_LAT_MMS(
  p_PAC_ID         IN       varchar2,       -- 'LAT_MMS'    MMS-LA daily UFIH Ticket
  p_BOH_ID         IN       varchar2,
  RecordsAffected  OUT      number,
  ErrorCode        OUT      number,
  ErrorMsg         OUT      varchar2,
  ReturnStatus     OUT      number
);
  procedure SP_CONS_LAM_MMS
(
   p_PAC_ID         IN varchar2,        -- 'LATMCC_MMS'     MMS-LA MCC UFIH Ticket        
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     OUT number );
  procedure SP_CONS_LAPMCC_MMS
(
   p_PACT_ID        IN varchar2,        -- 'LAPMCC_MMS' MMS-LA MCC Preparation
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     OUT number );
  procedure SP_CONS_PURGEMLC
(
   p_PACT_ID        IN varchar2,        -- 'PURGEMLC'   Purge MMS-LA Contracts
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     OUT number );                                               -- 033SO
  procedure SP_CONS_MMSC
(
   p_PACT_ID        IN varchar2,        -- 'MMSC'   MMSC Consolidation
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     OUT number );                                               -- 033SO           
  procedure SP_TRY_LAA_MMSC
(
  p_PAC_ID         IN       varchar2,       -- 'LAA_MMSC'   MMS-LA Accumulation (MMSC)
  p_BOH_ID         IN OUT   varchar2,
  RecordsAffected  OUT      number,
  ErrorCode        OUT      number,
  ErrorMsg         OUT      varchar2,
  ReturnStatus     OUT      number
);
  procedure SP_TRY_LIA_MMSC
(
  p_PAC_ID         IN       varchar2,       -- 'LIA_MMSC'   MMS-LA IW Accumulation (MMSC)
  p_BOH_ID         IN OUT   varchar2,
  RecordsAffected  OUT      number,
  ErrorCode        OUT      number,
  ErrorMsg         OUT      varchar2,
  ReturnStatus     OUT      number
);
  procedure SP_CONS_LIT_MMS(
  p_PAC_ID         IN       varchar2,       -- 'LIT_MMS'    MMS-LA daily UFIH Ticket
  p_BOH_ID         IN       varchar2,
  RecordsAffected  OUT      number,
  ErrorCode        OUT      number,
  ErrorMsg         OUT      varchar2,
  ReturnStatus     OUT      number
);
End; -- Package Specification PKG_BDETAIL_MMSC
 
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- PKG_BDETAIL_MSC  (Package) 
--
CREATE OR REPLACE PACKAGE SBS1_ADMIN.PKG_BDETAIL_MSC 
  Is

-- Common Data types
--   Type ArrSRCTYPE               Is Table Of Varchar2(10)  Index By Binary_Integer;
--   Type ArrDEMO                  Is Table Of Number(1)     Index By Binary_Integer;
--   Type ArrBIHID                 Is Table Of Varchar2(10)  Index By Binary_Integer;
  Type ArrMapState              Is Table Of Varchar2(1)   Index By Binary_Integer;
  Type ArrBiRecNo               Is Table Of Number(8)     Index By Binary_Integer;
  Type ArrCdrType               Is Table Of Varchar2(10)  Index By Binary_Integer;
  Type ArrMsisdnA               Is Table Of Varchar2(20)  Index By Binary_Integer;
  Type ArrMsisdnB               Is Table Of Varchar2(20)  Index By Binary_Integer;
  Type ArrDateTime              Is Table Of Varchar2(20)  Index By Binary_Integer;
  Type ArrImsi                  Is Table Of Varchar2(20)  Index By Binary_Integer;
  Type ArrImei                  Is Table Of Varchar2(20)  Index By Binary_Integer;
  Type ArrExId                  Is Table Of Varchar2(20)  Index By Binary_Integer;
  Type ArrMscId                 Is Table Of Varchar2(20)  Index By Binary_Integer;
  Type ArrRoute                 Is Table Of Varchar2(20)  Index By Binary_Integer;
  Type ArrCellidFor1stCell      Is Table Of Varchar2(20)  Index By Binary_Integer;
  Type ArrTeleServiceCode       Is Table Of Varchar2(2)   Index By Binary_Integer;
  Type ArrServiceCenterAddress  Is Table Of Varchar2(20)  Index By Binary_Integer;
  Type ArrPowerClass            Is Table Of Varchar2(20)  Index By Binary_Integer;
  Type ArrSubscriptionType      Is Table Of Varchar2(2)   Index By Binary_Integer;
  Type ArrPrepaid               Is Table Of Varchar2(1)   Index By Binary_Integer;
  Type ArrBdId                  Is Table Of Varchar2(10)  Index By Binary_Integer;
  Type ArrSmscId                Is Table Of Varchar2(10)  Index By Binary_Integer;
  Type ArrBoRecNo               Is Table Of Number(8)     Index By Binary_Integer;
  Type ArrBdRowId               Is Table Of Varchar2(18)  Index By Binary_Integer;


--  006SO

Function GET_SMSC_ID
( p_BD_SCA        In      Varchar2,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  ReturnStatus    In Out  Number
) Return Varchar2;

Function ADD_SMSC_CODE_TO_UNKNOWN_TOC
( p_SMSC_CODE     In      Varchar2,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  ReturnStatus    In Out  Number
) Return Varchar2;


  procedure SP_TRY_MSCCU
(
  p_PAC_ID         IN       varchar2,   -- 'MSCCU'
  p_BOH_ID         IN OUT   varchar2,
  RecordsAffected  OUT      number,
  ErrorCode        OUT      number,
  ErrorMsg         OUT      varchar2,
  ReturnStatus     OUT      number
);
End; -- Package Specification PKG_BDETAIL_MSC
 
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- PKG_BDETAIL_SETTLEMENT  (Package) 
--
CREATE OR REPLACE PACKAGE SBS1_ADMIN.PKG_BDETAIL_SETTLEMENT
  IS
--
-- To modify this template, edit file PKGSPEC.TXT in TEMPLATE
-- directory of SQL Navigator
--
-- Purpose: Briefly explain the functionality of the package
--
-- MODIFICATION HISTORY
-- Person      Date    Comments
-- ---------   ------  ------------------------------------------
   -- Enter package declarations as shown below

procedure SP_INSERT_SETTLING
(
   p_SET_ETID       IN varchar2,
   p_SET_CONID      IN varchar2,
   p_SET_DEMO       IN number,
   p_SET_SEPID      IN varchar2,
   p_SET_SETIDOLD   IN varchar2,
   p_SET_CURRENCY   IN varchar2,
   p_SET_COMMENT    IN varchar2,
   p_SET_ID         OUT varchar2,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT number );

procedure SP_INSERT_SETDETAIL
(
   p_SED_SETID      IN varchar2,
   p_SED_ETID       IN varchar2,
   p_SED_PRICE      IN float,
   p_SED_QUANTITY   IN float,
   p_SED_DISCOUNT   IN float,
   p_SED_VATID      IN varchar2,
   p_SED_VATRATE    IN float,
   p_SED_DESC       IN varchar2,
   p_SED_ORDER      IN varchar2,
   p_SED_VISIBLE    IN number,
   p_SED_COMMENT    IN varchar2,
   p_SED_COUNT1     IN number,
   p_SED_COUNT2     IN number,
   p_SED_CHARGE     IN varchar2,
   p_SED_BOHID      IN varchar2,
   p_SED_PMVID      IN varchar2,
   p_SED_TARID      IN varchar2,
   p_SED_ESID       IN varchar2,
   p_SED_INT        IN varchar2,
   p_SED_DATE       IN varchar2,
   p_SED_PREPAID    IN varchar2,        --001SO
   p_SED_AMOUNTCU   IN float,           --001SO
   p_SED_RETSHAREPV IN float,           --001SO
   p_SED_RETSHAREMO IN float,           --001SO
   p_SED_LONGID_1   IN varchar2,        --036SO --003SO
   p_SED_LONGID_2   IN varchar2,        --036SO
   p_SED_ID         OUT varchar2,
   p_SED_POS        OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT number );

procedure SP_ADD_SETDETAIL_BY_DATE
(
   p_Date           IN varchar2,
   p_SET_CONID      IN varchar2,
   p_SET_ETID       IN varchar2,
   p_SET_DEMO       IN number,
   p_SET_CURRENCY   IN varchar2,
   p_SET_COMMENT    IN varchar2,
   p_SED_ETID       IN varchar2,
   p_SED_PRICE      IN float,
   p_SED_QUANTITY   IN float,
   p_SED_DISCOUNT   IN float,
   p_SED_VATID      IN varchar2,
   p_SED_VATRATE    IN float,
   p_SED_DESC       IN varchar2,
   p_SED_ORDER      IN varchar2,
   p_SED_VISIBLE    IN number,
   p_SED_COMMENT    IN varchar2,
   p_SED_COUNT1     IN number,
   p_SED_COUNT2     IN number,
   p_SED_CHARGE     IN varchar2,
   p_SED_BOHID      IN varchar2,
   p_SED_PMVID      IN varchar2,
   p_SED_TARID      IN varchar2,
   p_SED_ESID       IN varchar2,
   p_SED_INT        IN varchar2,
   p_SED_PREPAID    IN varchar2,        --001SO
   p_SED_AMOUNTCU   IN float,           --001SO
   p_SED_RETSHAREPV IN float,           --001SO
   p_SED_RETSHAREMO IN float,           --001SO
   p_SED_LONGID_1   IN varchar2,        --036SO --003SO
   p_SED_LONGID_2   IN varchar2,        --036SO
   p_SEP_ID         OUT varchar2,
   p_SET_ID         OUT varchar2,
   p_SED_ID         OUT varchar2,
   p_SED_POS        OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT number );

procedure SP_UPDATE_SETDETAIL
(
   p_SED_ID         IN varchar2,
   p_SED_PRICE      IN float,
   p_SED_QUANTITY   IN float,
   p_SED_DISCOUNT   IN float,
   p_SED_COUNT1     IN number,
   p_SED_COUNT2     IN number,
   p_SED_AMOUNTCU   IN float,           --001SO
   p_SED_RETSHAREPV IN float,           --001SO
   p_SED_RETSHAREMO IN float,           --001SO
   p_SED_POS        OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT number );



function NextAvailableOrder(
    p_SED_CHARGE    in  VARCHAR2,
    p_SED_DATE      in  DATE
    )
Return VARCHAR2;

  Procedure SP_UPDATE_BOHEADER_IOTLACT_0
(
  p_bohid         In      Varchar2,
  p_status        In      Varchar2,
  p_count         In      Number,
  p_MaxAge        In      Number,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  ReturnStatus    In Out  Number
);
  procedure SP_UPDATE_BOHEADER_MOLAT_0
( p_bohid         In      Varchar2,
  p_status        In      Varchar2,
  p_count         In      Number,
  p_MaxAge        In      Number,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  ReturnStatus    In Out  Number
);
  procedure SP_UPDATE_BOHEADER_MOIWST_0
( p_bohid         In      Varchar2,
  p_status        In      Varchar2,
  p_count         In      Number,
  p_MaxAge        In      Number,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  ReturnStatus    In Out  Number
);
  procedure SP_ADD_SETDETAIL
(
   p_SET_ETID       IN varchar2,
   p_SED_ETID       IN varchar2,
   p_SED_CHARGE     IN varchar2,
   p_SED_BOHID      IN varchar2,
   p_Date           IN DATE,
   p_SET_CONID      IN varchar2,
   p_SED_TARID      IN varchar2,
   p_SED_INT        IN varchar2,
   p_SED_PREPAID    IN varchar2,
   p_SED_PRICE      IN float,
   p_SED_AMOUNTCU   IN float,
   p_SED_RETSHAREPV IN float,
   p_SED_RETSHAREMO IN float,
   p_SED_LONGID     IN varchar2,
   p_SED_COUNT1     IN number,
   p_SED_COUNT2     IN number,
   p_SED_DESC       IN varchar2,
   p_GART           IN number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT number );

  FUNCTION nextAvailableTimestamp (
    p_SED_CHARGE    IN  VARCHAR2,
    p_SED_DATE      IN  DATE
) RETURN    NUMBER;      -- seconds after midnight

  procedure SP_LAM_MCC
(
   p_PAC_ID         IN varchar2,
   p_BOH_ID         IN varchar2,
   p_SET_ETID       IN varchar2,    -- SLA or MLA
   p_Gart           In Number,      --016SO
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     OUT number );
  procedure SP_LAPMCC
(
   p_PAC_ID         IN varchar2,    -- 'LAPMCC_SMS' or 'LAPMCC_MMS'    MCC Preparation (Minimum Charge Calculation)
   p_BOH_ID         IN varchar2,
   p_SET_ETID       IN varchar2,    -- SLA or MLA
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     OUT number );
  Procedure SP_LAT_CDR
(
  p_BD_BOHID      In      Varchar2,
  p_SET_ETID      IN      varchar2,     -- 'SLA'  or 'MLA'
  p_Gart          In      Number,
  p_MinAge        In      Number,
  p_MaxAge        In      Number,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  RecordsAffected Out     Number
);
  Procedure SP_LIT_CDR
(
  p_BD_BOHID      In      Varchar2,
  p_SET_ETID      IN      varchar2,     -- 'SLA'  or 'MLA'
  p_Gart          In      Number,
  p_MinAge        In      Number,
  p_MaxAge        In      Number,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  RecordsAffected Out     Number
);
  PROCEDURE SP_CONS_INSERT_PERIOD(
   p_PAC_ID         IN varchar2,
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     OUT number
);
  PROCEDURE insertPeriod(
    p_CODE      IN varchar2
);
END; -- Package Specification PKG_BDETAIL_SETTLEMENT
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- PKG_BDETAIL_SMSC  (Package) 
--
CREATE OR REPLACE PACKAGE SBS1_ADMIN.PKG_BDETAIL_SMSC as

  --Data types common across INFO and SMSC
--  type ARRSRCTYPE is table of VARCHAR2(10)  index by BINARY_INTEGER;
--  type ARRDEMO is table of NUMBER(1)  index by BINARY_INTEGER;
--  type ARRBIHID is table of VARCHAR2(10)  index by BINARY_INTEGER;
  type ARRESCODE is table of VARCHAR2(2)  index by BINARY_INTEGER;
  type ARRBIRECNO is table of NUMBER(8)  index by BINARY_INTEGER;
  type ARRMSISDNA is table of VARCHAR2(20)  index by BINARY_INTEGER;
  type ARRDATETIME is table of VARCHAR2(20)  index by BINARY_INTEGER;
  type ARRSTATUS is table of VARCHAR2(2)  index by BINARY_INTEGER;
  type ARRNPIA is table of VARCHAR2(2)  index by BINARY_INTEGER;
  type ARRTONA is table of VARCHAR2(2)  index by BINARY_INTEGER;
  type ARRBDID is table of VARCHAR2(10)  index by BINARY_INTEGER;
  type ARRPREPAID is table of VARCHAR2(1)  index by BINARY_INTEGER;
  type ARROGTI is table of VARCHAR2(20)  index by BINARY_INTEGER;
  type ARRDGTI is table of VARCHAR2(20)  index by BINARY_INTEGER;

  --Data types specific to SMSC and CUCA

  type ARRMSISDNB is table of VARCHAR2(20)  index by BINARY_INTEGER;
  type ARRNPIB is table of VARCHAR2(2)  index by BINARY_INTEGER;
  type ARRTONB is table of VARCHAR2(2)  index by BINARY_INTEGER;
  type ARRCONSOL is table of VARCHAR2(5)  index by BINARY_INTEGER;
  type ARRVSMSCID is table of VARCHAR2(20)  index by BINARY_INTEGER;
  type ARRERROR is table of VARCHAR2(6)  index by BINARY_INTEGER;

  type ARRPIDA is table of VARCHAR2(2)  index by BINARY_INTEGER;
  type ARRPIDB is table of VARCHAR2(2)  index by BINARY_INTEGER;
  type ARRLENGTH is table of NUMBER(4)  index by BINARY_INTEGER;
  type ARRIMSI is table of VARCHAR2(20)  index by BINARY_INTEGER;


--  009SO

procedure SP_UPDATE_BOHEADER_SMSC_0
(  p_bohid         IN              varchar2,
   p_status        IN              varchar2,
   p_count         IN              number,
  p_MaxAge        In      Number,
   ErrorCode       OUT             number,
   ErrorMsg        OUT             varchar2,
   ReturnStatus    IN OUT  number);

procedure SP_UPDATE_BOHEADER_IOTLACA_2
(  p_bohid         IN              varchar2,
   p_status        IN              varchar2,
   p_count         IN              number,
   p_MaxAge        In               Number,
   ErrorCode       OUT             number,
   ErrorMsg        OUT             varchar2,
   ReturnStatus    IN OUT  number);

procedure SP_UPDATE_BOHEADER_SMSC_3
(  p_bohid         IN              varchar2,
   p_status        IN              varchar2,
   p_count         IN              number,
  p_MaxAge        In      Number,
   ErrorCode       OUT             number,
   ErrorMsg        OUT             varchar2,
   ReturnStatus    IN OUT  number);


  Procedure SP_UPDATE_BOHEADER_SMSC_1
(
  p_bohid         In      Varchar2,
  p_status        In      Varchar2,
  p_count         In      Number,
  p_MaxAge        In      Number,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  ReturnStatus    In Out  Number
); --  011SO

  Procedure SP_UPDATE_BOHEADER_SMSC_2
(
  p_bohid         In      Varchar2,
  p_status        In      Varchar2,
  p_count         In      Number,
  p_MaxAge        In      Number,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  ReturnStatus    In Out  Number
);
  procedure SP_UPDATE_BOHEADER_MOIWSA_3
( p_bohid         In      Varchar2,
  p_status        In      Varchar2,
  p_count         In      Number,
  p_MaxAge        In      Number,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  ReturnStatus    In Out  Number
);
  Procedure SP_UPDATE_BOHEADER_IOTTOCA_2
(
  p_bohid         In      Varchar2,
  p_status        In      Varchar2,
  p_count         In      Number,
  p_MaxAge        In      Number,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  ReturnStatus    In Out  Number
);

  procedure SP_TRY_SMSCCU(
  p_PAC_ID         IN       varchar2,       -- 'SMSCCU'	    SMSC COUNTER UPDATE
  p_BOH_ID         IN OUT   varchar2,
  RecordsAffected  OUT      number,
  ErrorCode        OUT      number,
  ErrorMsg         OUT      varchar2,
  ReturnStatus     OUT      number
);
  procedure SP_CONS_DGTI
(  
   p_PAC_ID         IN varchar2,        -- 'DGTI'	  DGTI consolidation
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     OUT number );                                               --  039SO
  procedure SP_CONS_IWT
(  
   p_PACT_ID        IN varchar2,        -- 'IWT'	IW Consolidation SC Outgoing
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     OUT number );                                               --  039SO
  procedure SP_CONS_LAA_MFGR
(  
   p_PACT_ID        IN varchar2,        -- 'LAT_MFGR'	SMS-LA monthly UFIH Tickets GlobalReply
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     OUT number );                                               --  039SO
  procedure SP_CONS_LAM_SMS
(
   p_PAC_ID         IN varchar2,        -- 'LATMCC_SMS'	    SMS-LA MCC UFIH Ticket
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     OUT number );
  procedure SP_CONS_LAPMCC_SMS
(
   p_PACT_ID        IN varchar2,    -- 'LAPMCC_SMS'	    SMS-LA MCC Preparation
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     OUT number );                                               --  039SO
  procedure SP_CONS_LAT_MFGR
(
  p_PAC_ID         IN       varchar2,       -- 'LAT_MFGR'	SMS-LA monthly UFIH Tickets GlobalReply
  p_BOH_ID         IN       varchar2,
  RecordsAffected  OUT      number,
  ErrorCode        OUT      number,
  ErrorMsg         OUT      varchar2,
  ReturnStatus     OUT      number
);
  procedure SP_CONS_LAT_SMS
(
  p_PAC_ID         IN       varchar2,       -- 'LAT_SMS'    SMS-LA daily UFIH Ticket
  p_BOH_ID         IN       varchar2,
  RecordsAffected  OUT      number,
  ErrorCode        OUT      number,
  ErrorMsg         OUT      varchar2,
  ReturnStatus     OUT      number
);
  procedure SP_CONS_OGTI
(  
   p_PACT_ID        IN varchar2,        -- 'OGTI'	OGTI consolidation
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     OUT number );                                               --  039SO
  procedure SP_CONS_PURGELAC
(  
   p_PACT_ID        IN varchar2,        -- 'PURGELAC'	Purge LA Contract (de-activate)
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     OUT number );                                               --  039SO
  procedure SP_CONS_SMSC
(  
   p_PACT_ID        IN varchar2,        -- 'SMSC'	SMSC Consolidation
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     OUT number );                                               --  039SO
  procedure SP_TRY_LAA_SMS
(
  p_PAC_ID         IN       varchar2,       -- 'LAA_SMS'	SMS-LA Accumulation
  p_BOH_ID         IN OUT   varchar2,
  RecordsAffected  OUT      number,
  ErrorCode        OUT      number,
  ErrorMsg         OUT      varchar2,
  ReturnStatus     OUT      number
);
  procedure SP_TRY_LIA_SMS
(
  p_PAC_ID         IN       varchar2,       -- 'LIA_SMS'	SMS-LA IW Accumulation
  p_BOH_ID         IN OUT   varchar2,
  RecordsAffected  OUT      number,
  ErrorCode        OUT      number,
  ErrorMsg         OUT      varchar2,
  ReturnStatus     OUT      number
);
  procedure SP_CONS_LIT_SMS
(
  p_PAC_ID         IN       varchar2,       -- 'LIT_SMS'    SMS-LA daily UFIH Ticket
  p_BOH_ID         IN       varchar2,
  RecordsAffected  OUT      number,
  ErrorCode        OUT      number,
  ErrorMsg         OUT      varchar2,
  ReturnStatus     OUT      number
);
  procedure SP_TRY_LIA_RSGR
(
  p_PAC_ID         IN       varchar2,       -- 'LIA_SMS'	SMS-LA IW Accumulation
  p_BOH_ID         IN OUT   varchar2,
  RecordsAffected  OUT      number,
  ErrorCode        OUT      number,
  ErrorMsg         OUT      varchar2,
  ReturnStatus     OUT      number
);
end Pkg_BDetail_smsc;
 
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- PKG_COMMON_PACKING  (Package) 
--
CREATE OR REPLACE PACKAGE SBS1_ADMIN.PKG_COMMON_PACKING
  IS
--
--  Purpose: Common routines for SBS output converters (associated with control table BOHEADER)
--
--  MODIFICATION HISTORY (see Package Body)

-- (Billing/Handler) Output Header States

Type tBoHeaderEsId Is Record (
  Packing           BOHSTATE.BOHS_ID%Type := 'PAC',
  Error             BOHSTATE.BOHS_ID%Type := 'PAE',
  Ok                BOHSTATE.BOHS_ID%Type := 'OK'
);

Type tPackingStateId Is Record (
  Active            PACKINGSTATE.PACKS_ID%Type := 'A',
  Deleted           PACKINGSTATE.PACKS_ID%Type := 'D',
  Scheduled         PACKINGSTATE.PACKS_ID%Type := 'S',
  Locked            PACKINGSTATE.PACKS_ID%Type := 'L',
  Draft             PACKINGSTATE.PACKS_ID%Type := 'R',
  Inactive          PACKINGSTATE.PACKS_ID%Type := 'I'
);

Type tPackingTypeId Is Record (
  Consol                PACTYPE.PACT_ID%Type := 'CONSOL',
  Statistic             PACTYPE.PACT_ID%Type := 'STAT',
  StatisticIndividual   PACTYPE.PACT_ID%Type := 'STATIND',
  StatisticScheduler    PACTYPE.PACT_ID%Type := 'STATSCHED'
);


    EXCP_WORKFLOW_ABORT             Exception;                                  --012SO              
    ENO_WORKFLOW_ABORT              Number := 1006;         
    EDESC_WORKFLOW_ABORT            Varchar2(255) := 'Inconsistent workflow state. Statistics generation may need a reset or a clearing';
  
    EXCP_STATISTICS_FAILURE         Exception;                                  --012SO              
    ENO_STATISTICS_FAILURE          Number := 1007;         
    EDESC_STATISTICS_FAILURE        Varchar2(255) := 'Too many failures (retries) in statistics generation';

    EXCP_MISSING_PACKING_PAR        Exception;                                                
    ENO_MISSING_PACKING_PAR         Number := 1008;         
    EDESC_MISSING_PACKING_PAR       Varchar2(255) := 'Missing packing parameter entry in table STA_PACPARAM';

Function getNextPackingSequence
(
    p_PACID             In      Varchar2
)
Return Varchar2;

Procedure SP_GET_NEXT_PAC_SEQ(
    p_PACID                     In      Varchar2,
    p_NextSequence              Out     Varchar2,
    p_ErrorCode                 Out     Number,
    p_ErrorMsg                  Out     Varchar2,
    p_ReturnStatus              In Out  Number
);

Function getTypeForPacking 
(
    p_BIH_PACID   IN varchar2
)
Return VARCHAR2;

Procedure INSERT_BOHEADER (
    p_PackingType       In      Varchar2,
    p_PackingId         In OUT  Varchar2,
    p_HeaderId          In OUT  Varchar2,
    p_JobId             OUT     Varchar2,
    p_FileName          Out     Varchar2,       --003SO
    p_AppName           In      Varchar2,
    p_AppVer            In      Varchar2,
    p_Thread            In      Varchar2,                                                           
    p_TaskId            In      Number,
    p_HostName          In      Varchar2
);

procedure UPDATE_BOHEADER(
    p_HeaderId          In      Varchar2,
    p_JobId             In      Varchar2,
    p_FileName          In Out  Varchar2,
    p_FileDate          In      Varchar2,
    p_MaxAge            In      Number,
    p_DataHeader        In      VarChar2,       
    p_RecCount          In      Number,
    p_ErrCount          In      Number,
    p_DateFc            In      Varchar2,
    p_DateLc            In      Varchar2
);

Function getPackingCandidateForType (
    p_PackingType       IN varchar2,
    p_Thread            IN  varchar2
)
Return VARCHAR2;

  Function isTimeForPacking 
(
    p_PAC_ID   IN varchar2
)
Return integer;


--011DA
Function setStringTagsToLowerCase 
(
  p_String In VarChar2
)
Return VarChar2;


  Procedure Lock_Packing(
    p_PackingId                In      Varchar2
);

procedure MODIFY_BOHEADER (
    p_HeaderId          in      varchar2,
    p_AppName           in      varchar2,
    p_AppVer            in      varchar2,
    p_Thread            in      varchar2,                                                           
    p_TaskId            in      number,
    p_HostName          in      varchar2,
    p_FileName          out     varchar2
);  --020SO
    
procedure INSERT_BOHEADER_SPTRY (
    p_PackingId         in      varchar2,
    p_HeaderId          in out  varchar2
);  --021SO
    
function getPackingParameter( 
    p_PAC_ID    in  varchar2,
    p_Name      in  STA_PACPARAM.STAP_NAME%Type
)
return STA_PACPARAM.STAP_VALUE%Type;

  function getJobCandidateForType 
(
    p_PackingType       in varchar2,
    p_Thread            in  varchar2
)
return varchar2;

Procedure SP_INSERT_HEADER (
    p_PackingType       In      Varchar2,
    p_PackingId         In OUT  Varchar2,
    p_HeaderId          OUT     Varchar2,
    p_JobId             OUT     Varchar2,
    p_FileName          Out     Varchar2,       
    p_AppName           In      Varchar2,
    p_AppVer            In      Varchar2,
    p_Thread            In      Varchar2,                                                           
    p_TaskId            In      Number,
    p_HostName          In      Varchar2,
    p_ErrorCode         Out     Number,
    p_ErrorDesc         Out     Varchar2,
    p_ReturnStatus      Out     Number 
);  --039SO

END; -- Package Specification PKG_COMMON_PACKING
 
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- PKG_COMMON_STATS  (Package) 
--
CREATE OR REPLACE PACKAGE SBS1_ADMIN.PKG_COMMON_STATS
  IS
--------------------------------------------------------------------
-- Project:     Statistical Module
-- Purpose:     ..
-- LastUpdate:  06.03.2010
--------------------------------------------------------------------

-- GLOBALS
/*
FUNCTION getConfig return sta_config%rowtype;
FUNCTION getXproc(vXprocName xproc.xpr_id%type) return xproc%rowtype;
procedure updateJobOnError(pacid packing.pac_id%type, jobid sta_job.staj_id%type, p_BOH_ID varchar2, reason varchar2);


-- Check if its worth to get a BOHEADER ID; with other words: do we have to work?
PROCEDURE anythingToDo
(  p_PACT_ID        IN varchar2,
   p_BOH_ID         IN OUT varchar2,

   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT varchar2
);
-- Trigger: watchPackageStateChanges
Procedure watchPackageStateChanges
(  vPacId in packing.pac_id%type,
   vOldPacEsid in packing.pac_esid%type,
   vNewPacEsid in packing.pac_esid%type,
   vOldPacLtid in packing.pac_ltid%type,
   vNewPacLtid in packing.pac_ltid%type

);

--For administration (WEB-GUI): clean Jobs and files after certain time
--PKG_COMMON_STATS.doAdminCleanJobs('getJobs'): get all jobs and files for deleting
--PKG_COMMON_STATS.doAdminCleanJobs('setJobs'): deleting of files is done, update jobs?

type tJob    is table of varchar2(2000) index by binary_integer;

Procedure doAdminCleanJobs
(
    p_toDo      in varchar2,

    p_JobId     in out tJob,
    p_JobDir    in out tJob,
    p_JobFile   in out tJob,

    RecordsAffected  OUT number,
    ErrorCode        OUT number,
    ErrorMsg         OUT varchar2,
    ReturnStatus     IN OUT number
);

----------------------------------------------------------------------
-- SCHEDULER
-- Called by XPIOC and/or WebGUI
-- Procedures and functions for SCHEDULER  ---------------------------

PROCEDURE scheduleStats
(  p_PACT_ID        IN varchar2,
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT varchar2
);

FUNCTION getNextExecDate (inCaller IN varchar2, inPacId IN varchar2, inRefDate date) return date;

type rDepInfo IS record
(   depPacId    varchar2(10),
    depPacName  varchar2(100),
    depPacExec  date
);
type tDepInfo IS VARRAY(100) OF rDepInfo;


PROCEDURE checkDependencies
(  inPacId          IN varchar2,
   inDateFrom       IN date,
   inDateTo         IN date,

   oDepend          IN OUT boolean,
   oDepInfo         IN OUT tDepInfo,

   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT varchar2

);


----------------------------------------------------------------------
-- EXECUTER
-- Called by XPIOC
-- Procedures and functions for EXECUTER   ---------------------------

-- Associative Array, some sort of:-)
--  1:
--  2:

type tNote   is table of varchar2(4000) index by binary_integer;                -- 009AA also used by the procedure getJobNotifData
type tKey   is table of varchar2(4000) index by binary_integer;
type tValue is table of varchar2(4000) index by binary_integer;

PROCEDURE getNextJob
(  p_PACT_ID        IN varchar2 DEFAULT NULL,
   p_BOH_ID         IN varchar2 DEFAULT NULL,

   arrKey           OUT tKey,
   arrValue         OUT tValue,
   arrNote          OUT tNote,
   
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT varchar2
);

--009AA
PROCEDURE getJobNotifData
(  p_PACT_ID        IN varchar2 DEFAULT NULL,
   p_BOH_ID         IN varchar2 DEFAULT NULL,
   p_STAJ_ID        IN varchar2,

   arrJobNotif      OUT tNote,

   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT varchar2
);

-- Clean already scheduled jobs, which are not executed within allowed time frame
FUNCTION cleanJobs
(hrsToExec in sta_config.stac_execsched%type) RETURN number;


-- Write JobResult back to Database
PROCEDURE setJobResult
(
   p_PACT_ID        IN varchar2 DEFAULT NULL,
   p_BOH_ID         IN varchar2,

   arrKey           IN tKey,
   arrVal           IN tValue,

   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT varchar2
 );

-- SYSTEM STUFF
PROCEDURE writeSysLog
(   pMethod varchar2, pSqlCode number, pSqlErrM varchar2,pParameter varchar2, pLoggedOn date);

--WEB STUFF
  Procedure checkBaseTableData (
    inPacId          In     Varchar2,
    
    outDateFrom      Out    Date,
    outDateTo        Out    Date,
    outDrop          Out    Number,
    outDropPeriod    Out    Varchar2,
    
    outDateFromRaw   Out    Date,
    outDateToRaw     Out    Date,
    
    RecordsAffected  Out    Number,
    ErrorCode        Out    Number,
    ErrorMsg         Out    Varchar2,
    ReturnStatus     In Out Number
  );
  
  Procedure SP_NEW_STA_JOB (
    p_StajParentId      In      STA_JOB.STAJ_PARENTID%Type,
    p_StajPacId         In      STA_JOB.STAJ_PACID%Type,
    p_StajInfo          In      STA_JOB.STAJ_INFO%Type,
    p_StajLtValue       In      STA_JOB.STAJ_LTVALUE%Type,
    p_StajPeriodId      In      STA_JOB.STAJ_PERIODID%Type,
    p_AcIdCre           In      ACCOUNT.AC_ID%Type,
    p_StajId            Out     STA_JOB.STAJ_ID%Type,
    p_StajNotification  In      STA_JOB.STAJ_NOTIFICATION%Type,                 -- 010AA
    p_StajNotId         In      STA_JOB.STAJ_NOTID%Type,                        -- 010AA
    p_StajNotEmailSuccess   In  STA_JOB.STAJ_NOTEMAILSUCCESS%Type,              -- 010AA
    p_StajNotEmailFailure   In  STA_JOB.STAJ_NOTEMAILFAILURE%Type,              -- 010AA
    p_StajNotSendAttachment In  STA_JOB.STAJ_NOTSENDATT%Type,                   -- 010AA
    p_RecordsAffected   Out     Number,
    p_ErrNumber         In Out  Number,
    p_ErrDesc           In Out  Varchar2,
    p_ReturnStatus      In Out  Number
  );

  Procedure SP_NEW_STA_JOBPARAM (
    p_StajId            In      STA_JOB.STAJ_ID%Type,
    p_StajpName         In      STA_JOBPARAM.STAJP_NAME%Type,
    p_StajpValue        In      STA_JOBPARAM.STAJP_VALUE%Type,
    p_RecordsAffected   Out     Number,
    p_ErrNumber         In Out  Number,
    p_ErrDesc           In Out  Varchar2,
    p_ReturnStatus      In Out  Number
  );

  Procedure SP_NEW_STA_JOBSQLS (
    p_StajId            In      STA_JOB.STAJ_ID%Type,
    p_RecordsAffected   Out     Number,
    p_ErrNumber         In Out  Number,
    p_ErrDesc           In Out  Varchar2,
    p_ReturnStatus      In Out  Number
  );
  
  Procedure SP_REPLACE_PARAMS (
      p_StajId            In      Varchar2,
      p_PacId             In      Varchar2,
      p_PacLtId           In      Varchar2,
      p_StaqSql           In      Varchar2,
      p_StaqSqlNew        Out     Varchar2,
      p_RecordsAffected   Out     Number,
      p_ErrNumber         In Out  Number,
      p_ErrDesc           In Out  Varchar2,
      p_ReturnStatus      In Out  Number
  );
    
  Procedure SP_NEW_STA_JOBSQLS_X (
    p_StajId            In      STA_JOB.STAJ_ID%Type,
    p_RecordsAffected   Out     Number,
    p_ErrNumber         In Out  Number,
    p_ErrDesc           In Out  Varchar2,
    p_ReturnStatus      In Out  Number
  );
*/
  Procedure NEW_STA_JOB_WORKING (
    p_StajParentId      In      STA_JOB.STAJ_PARENTID%Type,
    p_StajPacId         In      STA_JOB.STAJ_PACID%Type,
    p_StajLtValue       In      STA_JOB.STAJ_LTVALUE%Type,
    p_StajPeriodId      In      STA_JOB.STAJ_PERIODID%Type,
    p_BoHeaderId        In      BOHEADER.BOH_ID%Type,
    p_StajId            Out     STA_JOB.STAJ_ID%Type
--    p_StajNotification  In      STA_JOB.STAJ_NOTIFICATION%Type,                 
--    p_StajNotId         In      STA_JOB.STAJ_NOTID%Type,                        
--    p_StajNotEmailSuccess   In  STA_JOB.STAJ_NOTEMAILSUCCESS%Type,              
--    p_StajNotEmailFailure   In  STA_JOB.STAJ_NOTEMAILFAILURE%Type,              
--    p_StajNotSendAttachment In  STA_JOB.STAJ_NOTSENDATT%Type                   
  );
  Procedure UPDATE_STA_JOB_FAILURE(
    p_StajId            In      STA_JOB.STAJ_ID%Type
  );
  Procedure UPDATE_STA_JOB_SUCCESS(
    p_StajId            In      STA_JOB.STAJ_ID%Type
  );
  Procedure NEW_STA_JOBS_LOOPERS (
    p_StajParentId      In      STA_JOB.STAJ_PARENTID%Type,
    p_StajPacId         In      STA_JOB.STAJ_PACID%Type,
    p_StajPeriodId      In      STA_JOB.STAJ_PERIODID%Type,
    p_BoHeaderId        In      BOHEADER.BOH_ID%Type,
    p_CreatedJobCount   OUT     NUMBER
  );
  Procedure GET_STA_JOB_WORKING (
    p_StajPacId         In      STA_JOB.STAJ_PACID%Type,
    p_StajPeriodId      In      STA_JOB.STAJ_PERIODID%Type,
    p_BoHeaderId        In      BOHEADER.BOH_ID%Type,
    p_StajId            Out     STA_JOB.STAJ_ID%Type
  );
  Function GET_STA_JOB_SCHEDULED_COUNT (
    p_StajPacId         In      STA_JOB.STAJ_PACID%Type,
    p_StajPeriodId      In      STA_JOB.STAJ_PERIODID%Type
  )
return integer;
  Function GET_STA_JOB_ERROR_COUNT (
    p_StajPacId         In      STA_JOB.STAJ_PACID%Type,
    p_StajPeriodId      In      STA_JOB.STAJ_PERIODID%Type
  )
return integer;
  Procedure UPDATE_STA_JOB_WORKING(
    p_StajId            In      STA_JOB.STAJ_ID%Type,
    p_BoHeaderId        In      BOHEADER.BOH_ID%Type    
  );
  Procedure watchPackageStateChanges
(  vPacId in packing.pac_id%type,
   vOldPacEsid in packing.pac_esid%type,
   vNewPacEsid in packing.pac_esid%type,
   vOldPacLtid in packing.pac_ltid%type,
   vNewPacLtid in packing.pac_ltid%type
 );
END; -- Package Specification PKG_COMMON_STATS
 
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- PKG_INTERWORKING  (Package) 
--
CREATE OR REPLACE PACKAGE SBS1_ADMIN.PKG_INTERWORKING
Is

Type arrNBR           Is Table Of Varchar2(20)  Index By BINARY_INTEGER;        -- 002AA
Type arrCOUNTRY       Is Table Of Varchar2(100) Index By BINARY_INTEGER;
Type arrOPNAME        Is Table Of Varchar2(100) Index By BINARY_INTEGER;
Type arrOPKEY         Is Table Of Varchar2(20)  Index By BINARY_INTEGER;        -- 002AA
Type arrBDID          Is Table Of Varchar2(10)  Index By BINARY_INTEGER;

Type arrMcc           Is Table Of Varchar2(10)   Index By BINARY_INTEGER;
Type arrMnc           Is Table Of Varchar2(10)   Index By BINARY_INTEGER;
Type arrCountryName   Is Table Of Varchar2(100) Index By BINARY_INTEGER;
Type arrOperatorName  Is Table Of Varchar2(100) Index By BINARY_INTEGER;
Type arrOperatorKey   Is Table Of Varchar2(10)  Index By BINARY_INTEGER;
Type arrStartDate     Is Table Of Varchar2(20)  Index By BINARY_INTEGER;
Type arrCeaseDate     Is Table Of Varchar2(20)  Index By BINARY_INTEGER;

PROCEDURE SP_INSERT_OPER
(
  BatchSize       In      Integer,
  p_BD_SRCTYPE    In      Varchar2,
  p_BD_DEMO       In      Number,
  p_BD_BIHID      In      Varchar2,
  p_NBR           In      arrNBR,
  p_COUNTRY       In      arrCOUNTRY,
  p_OPNAME        In      arrOPNAME,
  p_OPKEY         In      arrOPKEY,
  p_BDID          In Out  arrBDID,
  p_ErrNumber     In Out  Number,
  p_ErrDesc       In Out  Varchar2
);

Procedure SP_UPDATE_BOHEADER_IWMTSET_1
(
  p_bohid         In      Varchar2,
  p_status        In      Varchar2,
  p_count         In      Number,
  p_MaxAge        In      Number,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  ReturnStatus    In Out  Number
);

Procedure SP_SMSC_ASSIGNMENT_EXECUTE
(
  p_PAC_ID        In      Varchar2,  -- 009SO
  p_BOH_ID        In      Varchar2,
  p_AC_ID         In      Varchar2,
  RecordsAffected Out     Number,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  ReturnStatus    In Out  Number
);

-- MCC, MNC Import Stored Procedures
Procedure SP_INSERT_MCCMNC
(
  BatchSize       In      Integer,
  p_BD_SRCTYPE    In      Varchar2,
  p_BD_DEMO       In      Number,
  p_BD_BIHID      In      Varchar2,
  p_MCC           In      arrMcc,
  p_MNC           In      arrMnc,
  p_COUNTRY       In      arrCountry,
  p_OPNAME        In      arrOpName,
  p_OPKEY         In      arrOpKey,
  p_STARTDATE     In      arrStartDate,
  p_CEASEDATE     In      arrCeaseDate,
  p_BDID          In Out  arrBDID,
  p_ErrNumber     In Out  Number,
  p_ErrDesc       In Out  Varchar2
);

  Procedure SP_CONS_NBR_MERGE
(
  p_PAC_ID        In      Varchar2,     -- 'NBR_MERGE'            -- 009SO
  p_BOH_ID        In      Varchar2,
  RecordsAffected Out     Number,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  ReturnStatus    In Out  Number
);
  Procedure SP_CONS_NBR_PREP
(
  p_PAC_ID        In      Varchar2,  -- 'NBR_PREP' -- 009SO
  p_BIOH_ID       In      Varchar2,
  RecordsAffected Out     Number,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  ReturnStatus    In Out  Number
);
  Procedure SP_CONS_SMSC_PROPOSE
(
  p_PAC_ID        In      Varchar2,  -- 'SMSC_PRPS1' or 'SMSC_PRPS2'            -- 009SO
  p_BOH_ID        In      Varchar2,
  RecordsAffected Out     Number,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  ReturnStatus    In Out  Number
);
  procedure SP_CONS_UPDSR038
(
  p_PAC_ID        In      Varchar2,  -- 'UPDSR038'    -- 009SO
  p_BOH_ID        In      Varchar2,
  RecordsAffected Out     Number,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  ReturnStatus    In Out  Number
); -- 003AH

End; -- Package Specification PKG_INTERWORKING
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- PKG_KPI_BD  (Package) 
--
CREATE OR REPLACE PACKAGE SBS1_ADMIN.pkg_kpi_bd
Is

  procedure SP_TRY_KPI
  (
      SQLT_STR_PACID        IN      varchar2,       -- 'KPI000' ... 'KPI999'
      SQLT_STR_BOHID        IN OUT  varchar2,
      SQLT_INT_RECORDS      OUT     number,
      SQLT_INT_ERROR        OUT     number,
      SQLT_STR_ERRORMSG     OUT     varchar2,
      SQLT_INT_RETSTATUS    OUT     number
  );

  procedure DO_WORK (
        SQLT_STR_PACID IN varchar2
      , SQLT_STR_BIHID IN varchar2
      , SQLT_DAT_DATETIME IN DATE
      , SQLT_STR_CONTEXT IN varchar2
  );

End; -- Package Specification pkg_kpi_bd
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- PKG_KPI_BD1  (Package) 
--
CREATE OR REPLACE PACKAGE SBS1_ADMIN.pkg_kpi_bd1
Is

  procedure SP_TRY_KPI
  (
      SQLT_STR_PACID        IN      varchar2,       -- 'KPI000' ... 'KPI999'
      SQLT_STR_BOHID        IN OUT  varchar2,
      SQLT_INT_RECORDS      OUT     number,
      SQLT_INT_ERROR        OUT     number,
      SQLT_STR_ERRORMSG     OUT     varchar2,
      SQLT_INT_RETSTATUS    OUT     number
  );

  procedure DO_WORK (
        SQLT_STR_PACID IN varchar2
      , SQLT_STR_BIHID IN varchar2
      , SQLT_DAT_DATETIME IN DATE
      , SQLT_STR_CONTEXT IN varchar2
  );

End; -- Package Specification pkg_kpi_bd1
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- PKG_KPI_BD2  (Package) 
--
CREATE OR REPLACE PACKAGE SBS1_ADMIN.pkg_kpi_bd2
Is

  procedure SP_TRY_KPI
  (
      SQLT_STR_PACID        IN      varchar2,       -- 'KPI000' ... 'KPI999'
      SQLT_STR_BOHID        IN OUT  varchar2,
      SQLT_INT_RECORDS      OUT     number,
      SQLT_INT_ERROR        OUT     number,
      SQLT_STR_ERRORMSG     OUT     varchar2,
      SQLT_INT_RETSTATUS    OUT     number
  );

  procedure DO_WORK (
        SQLT_STR_PACID IN varchar2
      , SQLT_STR_BIHID IN varchar2
      , SQLT_DAT_DATETIME IN DATE
      , SQLT_STR_CONTEXT IN varchar2
  );

End; -- Package Specification pkg_kpi_bd2
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- PKG_MEC_HB  (Package) 
--
CREATE OR REPLACE PACKAGE SBS1_ADMIN.PKG_MEC_HB
  IS
--  MODIFICATION HISTORY
--  See Package Body

-- START OF SECTION TO BE COPIED FROM PACKAGE SPEC PKG_MEC_HB@SBS0 TO PACKAGE SPEC PKG_MEC_HB@SBS1

    cAscii0VersionMsc_01_00_04      Varchar2(8) := '01.00.04';                  -- 182SO
    cAscii0VersionMsc_Current       Varchar2(8) := cAscii0VersionMsc_01_00_04;

    cAscii0VersionMmsc_01_00_05     Varchar2(8) := '01.00.05';                  -- 497SO
    cAscii0VersionMmsc_Current      Varchar2(8) := cAscii0VersionMmsc_01_00_05;

    cAscii0VersionIsrv_01_01_04     Varchar2(8) := '01.01.04';                  -- 418SO -- 416SO
    cAscii0VersionIsrv_Current      Varchar2(8) := cAscii0VersionIsrv_01_01_04;

    cAscii0VersionSmsc_01_00_06     Varchar2(8) := '01.00.06';                  -- 508SO
    cAscii0VersionSmsc_Current      Varchar2(8) := cAscii0VersionSmsc_01_00_06;

    cAscii0VersionSmsn_01_00_01     Varchar2(8) := '01.00.01';                  -- 513SO
    cAscii0VersionSmsn_Current      Varchar2(8) := cAscii0VersionSmsn_01_00_01;

    cAscii0VersionUfih_01_00_01     Varchar2(8) := '01.00.01';                  -- 233SO -- 130AA
    cAscii0VersionUfih_Current      Varchar2(8) := cAscii0VersionUfih_01_00_01;

    cAscii0VersionM2m_01_00_01      Varchar2(8) := '01.00.01';                  -- 474SO
    cAscii0VersionM2m_01_00_02      Varchar2(8) := '01.00.02';                  -- 508SO
    cAscii0VersionM2m_Current       Varchar2(8) := cAscii0VersionM2m_01_00_02;


    Type tBillingTables Is Record (                                             -- 009AA billing tables
        BDetailIsrv     Varchar2(10) := 'BDETAIL',
        BDetailSmsc     Varchar2(10) := 'BDETAIL1',                             -- and BDETAIL2
        BDetailMsc      Varchar2(10) := 'BDETAIL4',
        BDetailMmsc     Varchar2(10) := 'BDETAIL6',
        BDetailM2m      Varchar2(10) := 'BDETAIL7',                             -- 474SO
        BDetailUfih     Varchar2(10) := 'BDETAIL9'                              -- 233SO
    );

    Type tPackingIdTemplates Is Record (                                        -- packing ids (templates)
        Ascii0                  PACKING.PAC_ID%Type := 'INTSBS',

        PostpaidSms1Ch          PACKING.PAC_ID%Type := 'MOSMSCH',
        PostpaidSms1ChDel       PACKING.PAC_ID%Type := 'mosmsch',               -- 322SO Delayed delivery from cache
        PostpaidSms1Fl          PACKING.PAC_ID%Type := 'MOSMSFL',
        PostpaidSms1FlDel       PACKING.PAC_ID%Type := 'mosmsfl',               -- 322SO Delayed delivery from cache

        PostpaidSms3Ch          PACKING.PAC_ID%Type := 'MOSMS3CH',              -- 574SO
        PostpaidSms3ChDel       PACKING.PAC_ID%Type := 'mosms3ch',              -- 574SO
        PostpaidSms3Fl          PACKING.PAC_ID%Type := 'MOSMS3FL',              -- 574SO
        PostpaidSms3FlDel       PACKING.PAC_ID%Type := 'mosms3fl',              -- 574SO

        PostpaidSms4Ch          PACKING.PAC_ID%Type := 'MOSMS4CH',              -- 593SO
        PostpaidSms4ChDel       PACKING.PAC_ID%Type := 'mosms4ch',              -- 593SO
        PostpaidSms4Fl          PACKING.PAC_ID%Type := 'MOSMS4FL',              -- 593SO
        PostpaidSms4FlDel       PACKING.PAC_ID%Type := 'mosms4fl',              -- 593SO

        PostpaidSmsOr           PACKING.PAC_ID%Type := 'MOSMSOR',               -- 432SO Outbound Roaming
        PostpaidSmsOrDel        PACKING.PAC_ID%Type := 'mosmsor',               -- 433SO Delayed delivery from cache

        PostpaidMms1Ch          PACKING.PAC_ID%Type := 'MOMMSCH',               -- 108SO
        PostpaidMms1ChDel       PACKING.PAC_ID%Type := 'mommsch',               -- 322SO Delayed delivery from cache
        PostpaidMms1Fl          PACKING.PAC_ID%Type := 'MOMMSFL',               -- 108SO
        PostpaidMms1FlDel       PACKING.PAC_ID%Type := 'mommsfl',               -- 322SO Delayed delivery from cache

        PostpaidContentCh       PACKING.PAC_ID%Type := 'MOCONTCH',
        PostpaidContentChDel    PACKING.PAC_ID%Type := 'mocontch',              -- 322SO Delayed delivery from cache
        PostpaidContentFl       PACKING.PAC_ID%Type := 'MOCONTFL',
        PostpaidContentFlDel    PACKING.PAC_ID%Type := 'mocontfl',              -- 322SO Delayed delivery from cache

        PrepaidIsrvRap          PACKING.PAC_ID%Type := 'RAPISRV',               -- 318SO
        PrepaidSmscRap          PACKING.PAC_ID%Type := 'RAPSMSC',               -- 330SO

        IcbInterworking         PACKING.PAC_ID%Type := 'ICB<MAPID>'             -- 528SO
    );

    Type tDlsInfo Is Record (                                                   -- 011SO Daylight saving info
        UtcOffset         NUMBER(3),                                            -- 524SO -- + 1 h for SBS
        DlsStart          DATE,                                                 -- 524SO
        DlsEnd            DATE,                                                 -- 524SO
        DlsOffset         NUMBER(3)                                             -- 524SO -- + 1 h for SBS
    );

    Type ArrAccessCorrelationId     Is Table Of Varchar2(30)    Index By Binary_Integer;
    Type ArrAddress                 Is Table Of Varchar2(254)   Index By Binary_Integer;
    Type ArrAmountCustomer          Is Table Of Varchar2(15)    Index By Binary_Integer;
    Type ArrBillRate                Is Table Of Varchar2(3)     Index By Binary_Integer;
    Type ArrBillText                Is Table Of Varchar2(254)   Index By Binary_Integer;    -- 383SO -- for Isrv
    Type ArrBillingTime             Is Table Of Varchar2(30)    Index By Binary_Integer;
    Type ArrCDRRecordType           Is Table Of Varchar2(12)    Index By Binary_Integer;
    Type ArrCallType                Is Table Of Varchar2(10)    Index By Binary_Integer;
    Type ArrCategory                Is Table Of Varchar2(20)    Index By Binary_Integer;    -- 193SO
    Type ArrCdrTypeId               Is Table Of Varchar2(10)    Index By Binary_Integer;
    Type ArrCell                    Is Table Of Varchar2(20)    Index By Binary_Integer;
    Type ArrDeliverGti              Is Table Of Varchar2(20)    Index By Binary_Integer;
    Type ArrDeliverTime             Is Table Of Varchar2(30)    Index By Binary_Integer;
    Type ArrDeliveryReadRepReqInd   Is Table Of Number(8)       Index By Binary_Integer;
    Type ArrErrorId                 Is Table Of Varchar2(10)    Index By Binary_Integer;
    Type ArrEventDisposition        Is Table Of Varchar2(10)    Index By Binary_Integer;
    Type ArrExchangeIdentity        Is Table Of Varchar2(20)    Index By Binary_Integer;
    Type ArrFreeText                Is Table Of Varchar2(1000)  Index By Binary_Integer;
    Type ArrFwdCopyCopyInd          Is Table Of Number(8)       Index By Binary_Integer;
    Type ArrGsmPi                   Is Table Of Varchar2(3)     Index By Binary_Integer;
    Type ArrImei                    Is Table Of Varchar2(20)    Index By Binary_Integer;
    Type ArrInfo                    Is Table Of Varchar2(254)   Index By Binary_Integer;
    Type ArrInterfaceId             Is Table Of Varchar2(254)   Index By Binary_Integer;
    Type ArrItemNo                  Is Table Of Varchar2(20)    Index By Binary_Integer;
    Type ArrKeyword                 Is Table Of Varchar2(200)   Index By Binary_Integer;    -- 383SO
    Type ArrLanguage                Is Table Of Varchar2(2)     Index By Binary_Integer;
    Type ArrLayerSpecificAttr       Is Table Of Number(8)       Index By Binary_Integer;
    Type ArrLegacyTermIndicator     Is Table Of Varchar2(10)    Index By Binary_Integer;
    Type ArrLength                  Is Table Of Varchar2(10)    Index By Binary_Integer;
    Type ArrLocation                Is Table Of Varchar2(80)    Index By Binary_Integer;
    Type ArrMM7LinkedID             Is Table Of Varchar2(20)    Index By Binary_Integer;    -- 105SO
    Type ArrMappingStateId          Is Table Of Varchar2(1)     Index By Binary_Integer;    -- common
    Type ArrMessageClass            Is Table Of Number(8)       Index By Binary_Integer;
    Type ArrMessageContent          Is Table Of Varchar2(254)   Index By Binary_Integer;
    Type ArrMessageId               Is Table Of Varchar2(40)    Index By Binary_Integer;    -- 306SO
    Type ArrMessagePriority         Is Table Of Number(8)       Index By Binary_Integer;
    Type ArrMessageType             Is Table Of Varchar2(10)    Index By Binary_Integer;
    Type ArrMimeTypeSize            Is Table Of Varchar2(2000)  Index By Binary_Integer;
    Type ArrMmsIdentifier           Is Table Of Varchar2(254)   Index By Binary_Integer;
    Type ArrMscIdentificationId     Is Table Of Varchar2(20)    Index By Binary_Integer;
    Type ArrMsgExpiryTime           Is Table Of Varchar2(30)    Index By Binary_Integer;
    Type ArrMsgReference            Is Table Of Varchar2(40)    Index By Binary_Integer;    -- 330SO
    Type ArrMsgScheduleTime         Is Table Of Varchar2(30)    Index By Binary_Integer;
    Type ArrMsgStatus               Is Table Of Varchar2(20)    Index By Binary_Integer;
    Type ArrNetwork                 Is Table Of Varchar2(10)    Index By Binary_Integer;
    Type ArrNodeName                Is Table Of Varchar2(64)    Index By Binary_Integer;
    Type ArrNumEmailRecip           Is Table Of Number(8)       Index By Binary_Integer;
    Type ArrNumHomeRecip            Is Table Of Number(8)       Index By Binary_Integer;
    Type ArrNumIntlRecip            Is Table Of Number(8)       Index By Binary_Integer;
    Type ArrNumMsgs                 Is Table Of Varchar2(20)    Index By Binary_Integer;
    Type ArrNumNonHomeRecip         Is Table Of Number(8)       Index By Binary_Integer;
    Type ArrNumOfConversion         Is Table Of Number(8)       Index By Binary_Integer;
    Type ArrNumOfNotification       Is Table Of Number(8)       Index By Binary_Integer;
    Type ArrNumShortCodeRecip       Is Table Of Number(8)       Index By Binary_Integer;
    Type ArrNumberingPlanIdentifier Is Table Of Varchar2(3)     Index By Binary_Integer;
    Type ArrOnlineCharge            Is Table Of Varchar2(15)    Index By Binary_Integer;    -- 316AT
    Type ArrOrigGti                 Is Table Of Varchar2(20)    Index By Binary_Integer;
    Type ArrOutput                  Is Table Of Varchar2(4000)  Index By Binary_Integer;
    Type ArrPackingId               Is Table Of Varchar2(10)    Index By Binary_Integer;
    Type ArrPowerClass              Is Table Of Varchar2(20)    Index By Binary_Integer;
    Type ArrPpPser                  Is Table Of Varchar2(40)    Index By Binary_Integer;    -- 347SO
    Type ArrPrepaid                 Is Table Of Varchar2(2)     Index By Binary_Integer;    -- 330SO allow for 2 Value Input (orig / recip) for SMSC (YN, YY, YU, UY, NN)
    Type ArrPrepaidFreeText         Is Table Of Varchar2(1000)  Index By Binary_Integer;
    Type ArrPrice                   Is Table Of Varchar2(15)    Index By Binary_Integer;
    Type ArrPromotionPlan           Is Table Of Varchar2(20)    Index By Binary_Integer;    -- 105SO
    Type ArrProtocolIdentifier      Is Table Of Varchar2(3)     Index By Binary_Integer;
    Type ArrRatedUnits              Is Table Of Varchar2(15)    Index By Binary_Integer;
    Type ArrRecipCount              Is Table Of Number(8)       Index By Binary_Integer;    -- 076AA
    Type ArrRecipIndex              Is TAble Of Number(4)       Index By Binary_Integer;    -- 094SO
    Type ArrRemark                  Is Table Of Varchar2(100)   Index By Binary_Integer;
    Type ArrRequestId               Is Table Of Varchar2(20)    Index By Binary_Integer;    -- 188SO
    Type ArrRequestTime             Is Table Of Varchar2(30)    Index By Binary_Integer;
    Type ArrRequestType             Is Table Of Varchar2(10)    Index By Binary_Integer;
    Type ArrRoamingInfo             Is Table Of Varchar2(32)    Index By Binary_Integer;    -- 307SO -- 105SO
    Type ArrRoute                   Is Table Of Varchar2(20)    Index By Binary_Integer;
    Type ArrServedPartyCgi          Is Table Of Varchar2(25)    Index By Binary_Integer;
    Type ArrService                 Is Table Of Varchar2(32)    Index By Binary_Integer;
    Type ArrServiceCenterAddress    Is Table Of Varchar2(20)    Index By Binary_Integer;
    Type ArrShortId                 Is Table Of Varchar2(6)     Index By Binary_Integer;    -- 004AA
    Type ArrStorageDuration         Is Table Of Varchar2(20)    Index By Binary_Integer;
    Type ArrSubscriptionType        Is Table Of Varchar2(10)    Index By Binary_Integer;
    Type ArrTariffClass             Is Table Of Varchar2(20)    Index By Binary_Integer;    -- 105SO
    Type ArrTaxRate                 Is Table Of Varchar2(10)    Index By Binary_Integer;    -- 193SO
    Type ArrTeleServiceCode         Is Table Of Varchar2(2)     Index By Binary_Integer;
    Type ArrTestMode                Is Table Of Varchar2(10)    Index By Binary_Integer;    -- 193SO
    Type ArrThirdPartyId            Is Table Of Varchar2(10)    Index By Binary_Integer;
    Type ArrTimeOffset              Is Table Of Varchar2(5)     Index By Binary_Integer;    -- 130AA pos
    Type ArrTransportCount          Is Table Of Varchar2(5)     Index By Binary_Integer;    -- 275SO -- 237SO
    Type ArrTypeOfNumber            Is Table Of Varchar2(3)     Index By Binary_Integer;
    Type ArrUtxParams               Is Table Of Varchar2(15)    Index By Binary_Integer;
    Type ArrVsmscId                 Is Table Of Varchar2(4)     Index By Binary_Integer;

    -- common billing fields used in most CDR types
    Type tCdrInfo Is Record (
        AaaTopStopUpdated       Varchar2(1),
        AmountCustomer          Number(12,4),                                   -- 031AA    -- Number(12,4)
        Ascii0                  Varchar2(4000),
        Attempts                Number(10),                                     -- 475SO
        BillRate                Varchar2(10),                                   -- Number(3)
        BillText                Varchar2(254),                                  -- isrv billtext
        BillingDetailId         Varchar2(10),
        BillingDomain           Varchar2(10),                                   -- 144AA
        BillingTime             Varchar2(30),                                   -- isrv
        -- DiaResponse             Varchar2(4000),                                 -- 514SO
        DiaResult               Varchar2(10),                                   -- 514SO
        -- CallbackNumber          Varchar2(20),                                   -- 514SO
        -- CallbackAddress         Varchar2(254),                                  -- 514SO
        -- CallbackPresence        Varchar2(20),                                   -- 514SO
        Campaign                Varchar2(32),                                   -- 418SO
        Category                Varchar2(254),                                  -- 193SO
        CdrBilled               Varchar2(2),                                    -- 465SO -- 110SO
        CdrRated                Number(1),                                      -- 110SO
        CdrTypeId               Varchar2(10),
        Cell                    Varchar2(20),
        ContractSubType         Varchar2(10),
        DateTime                Varchar2(30),                                   -- 085AA
        DeliverAddress          Varchar2(254),                                  -- 514SO
        DeliverAddressNpi       Varchar2(3),                                    -- 514SO
        DeliverAddressTon       Varchar2(3),                                    -- 514SO
        DeliverAttempt          Number(8),                                      -- 514SO
        DeliverEsmeId           Varchar2(6),                                    -- 514SO
        DeliverGti              Varchar2(20),
        DeliverGtiOpKey         Varchar2(10),                                   -- 117SO
        DeliverImsi             Varchar2(20),
        DeliverIp               Varchar2(50),                                   -- 573SO -- 514SO
        DeliverMicros           Varchar2(20),                                   -- 514SO
        DeliverOpKey            Varchar2(10),                                   -- 523SO -- 117SO
        DeliverPid              Varchar2(3),
        DeliverTime             Varchar2(30),
        DeliverType             Number(2),
        Dser                    Varchar2(40),                                   -- 493SO
        ErrorCode               Varchar2(20),                                   -- 514SO
        ErrorId                 Varchar2(10),
        ErrorParameter          Varchar2(20),                                   -- 175SO
        ErrorType               Varchar2(20),                                   -- 514SO
        EventDisposition        Varchar2(10),                                   -- Number(8)
        ForeignRecipient        Varchar2(1),
        Gart                    Varchar2(10),                                   -- 416SO
        Imei                    Varchar2(20),                                   -- 017SO
        Imsi                    Varchar2(20),
        IncomingInterfaceId     Varchar2(254),                                  -- 136SO
        Info                    Varchar2(254),
        InterworkingAmount      Number(12,4),                                   -- 528SO
        InterworkingApmn        Varchar2(10),                                   -- 528SO
        InterworkingCase        Varchar2(1),                                    -- NULL/0=notChargeable/1=Chargeable
        InterworkingContractId  Varchar2(10),
        InterworkingCurrency    Varchar2(3),                                    -- 528SO
        InterworkingDirection   Varchar2(1),                                    -- 528SO
        InterworkingScenario    Varchar2(1),                                    -- 528SO
        InterworkingState       Varchar2(1),                                    -- 135SO temp variable (A=active I=Inactive)
        IsGenerated             Number(1),                                      -- 342SO
        IsHomeRouted            boolean,                                        -- 342SO
        IsHomeRoutedOnNet       boolean,                                        -- 563SO
        Lang                    Varchar2(10),
        LegacyTermIndicator     Number(8),                                      -- 153SO
        Location                Varchar2(80),                                   -- 425SO
        MappingStateId          Varchar2(1),
        MessageId               Varchar2(40),
        MessageType             Varchar2(10),
        MmsDestinationZoneId    Varchar2(10),                                   -- 076AA mmsc
        MmsRoamingContractId    Varchar2(10),   -- no input / output MEC local variable only
        MmsRoamingZoneId1       Varchar2(10),                                   -- 107SO -- 076AA mmsc
        MmsSizeZoneId           Varchar2(10),                                   -- 076AA mmsc
        MoRoamingPromotion      Number(1),                                      -- 156SO
        MscIdentificationId     Varchar2(20),
        MsgPid                  Varchar2(3),                                    -- 514SO
        MsgReference            Varchar2(40),                                   -- 330SO
        MsgStatus               Varchar2(20),
        MsgReqType              Varchar2(20),                                   -- 514SO
        MsgScheduleTime         Varchar2(30),                                   -- 514SO
        MsgExpiryTime           Varchar2(30),                                   -- 514SO
        MtRoamingPromotion      Number(1),                                      -- 156SO
        Network                 Varchar2(10),
        NodeName                Varchar2(64),                                   -- 422SO
        OnlineCharge            Number(12,4),                                   -- 316AT
        OrigAddress             Varchar2(254),
        OrigAddressTon          Varchar2(3),                                    -- 514SO
        OrigAddressNpi          Varchar2(3),
        OrigBillingId           Varchar2(20),                                   -- 514SO
        OrigCharset             Varchar2(20),                                   -- 514SO
        OrigDcs                 Number(3),                                      -- 558SO
        OrigEsmeId              Varchar2(6),                                    -- 514SO
        OrigGti                 Varchar2(20),
        OrigGtiOpKey            Varchar2(10),                                   -- 117SO
        OrigImsi                Varchar2(20),                                   -- 347SO
        OrigIp                  Varchar2(50),                                   -- 573SO -- 514SO
        OrigMessageId           Varchar2(64),                                   -- 559SO
        OrigSca                 Varchar2(40),                                   -- 494SO
        OrigSubmitTime          Varchar2(30),                                   -- 182SO
        Output1                 Varchar2(4000),
        Output2                 Varchar2(4000),
        OutputHb                Varchar2(4000),
        PackingId1              Varchar2(10),
        PackingId2              Varchar2(10),
        PackingIdHb             Varchar2(10),
        PartyToCharge           Varchar2(254),
        PaymentMethod           NUMBER(2),                                      -- 162SO
        PpPser                  Varchar2(40),                                   -- 347SO
        Prepaid                 Varchar2(1),
        RarrShortIdP2P          Varchar2(10),                                   -- 174SO
        RatedUnits              Varchar2(15),                                   -- Number(15) -- 017SO
        RatingZoneId            Varchar2(10),
        RecipAddress            Varchar2(254),
        RecipAddressNpi         Varchar2(3),
        RecipAddressTon         Varchar2(3),                                    -- 514SO
        RecipCount              Number(8),                                      -- 076AA
        RecipImsi               Varchar2(20),                                   -- 520SO
        RecipIndex              Number(4),                                      -- 094SO
        RequestId               Varchar2(20),                                   -- 188SO
        RequestItem             Varchar2(20),                                   -- isrv itemno
        RequestItemText         Varchar2(254),                                  -- isrv keyword
        RequestTime             Varchar2(30),
        RequestType             Varchar2(10),                                   -- Number(4)
        RevenueShareMobile      Number(12,4),                                   -- 031AA    -- Number(12,4)
        RevenueShareProvider    Number(12,4),                                   -- 031AA    -- Number(12,4)
        ReverseCharge           Number(1),                                      -- 109SO
        RoamingCgi              Varchar2(10),   -- 432SO use for SMS too -- no input / output MEC local variable only
        RoamingInfo             Varchar2(32),                                   -- 307SO
        ScaOpKey                Varchar2(10),                                   -- 509SO
        Schedule1               Varchar2(1),
        Schedule2               Varchar2(1),
        Schedule3               Varchar2(1),
        SegId                   Number(10),                                     -- 514SO
        SegCount                Number(10),                                     -- 514SO
        SegLength               Number(10),                                     -- 038AA    -- Varchar2(10)
        Service                 Varchar2(32),
        ServiceCenterAddress    Varchar2(20),
        ShortId                 Varchar2(10),                                   -- 004AA
        Show                    Varchar2(32),                                   -- 418SO
        SinkName                Varchar2(254),                                  -- 475SO
        SinkType                Varchar2(10),                                   -- 475SO
        SrcName                 Varchar2(254),                                  -- 475SO
        SrcType                 Varchar2(10),                                   -- 475SO
        SubscriptionType        Varchar2(10),                                   -- Varchar2(2) for MSC(bdetail4)
        SubmitTime              Varchar2(30),                                   -- 514SO
        SubmitMicros            Varchar2(20),                                   -- 514SO
        SubmitGti               Varchar2(20),                                   -- 514SO
        SubmitApp               Varchar2(20),                                   -- 514SO
        TariffId                Varchar2(10),                                   -- 224SO
        TaxRate                 Varchar2(10),                                   -- 193SO
        TestMode                Varchar2(10),                                   -- 193SO
        ThirdPartyId            Varchar2(10),
        TransportClass          Varchar2(15),                                   -- Number(12,4)
        TransportClassIW        Varchar2(15),                                   -- Number(12,4)
        TransportCost           Number(12,4),                                   -- 117SO  was Varchar2(15)
        TransportCount          NUMBER(2),                                      -- 237SO -- 016SO
        TransportMedium         Varchar2(10),                                   -- 144AA
        VasContractId           Varchar2(10),
        VasPriceModelVersionId  Varchar2(10),
        VsmscId                 Varchar2(20),                                   -- 346SO
        OrigImei                Varchar2(20),                                   -- 591SO
        DeliverImei             Varchar2(20),                                   -- 591SO
        OrigPaniHeader          Varchar2(200),                                  -- 591SO
        DeliverPaniHeader       Varchar2(200),                                  -- 608SO
        DeliverMapGti           Varchar2(20),                                   -- 609SO
        BioClientId             Varchar2(40),                                   -- 629SO -- 623SO
        BioOrigEsmeId           Varchar2(6),                                    -- 629SO -- 623SO
        BioMsgReference         Varchar2(40),                                   -- 629SO -- 623SO
        RecipEsmeId             Varchar2(6),                                    -- 629SO -- 625SO
        BioRequestType          Number(3)                                       -- 629SO -- 623SO
    );  -- 607SO


-- END OF SECTION TO BE COPIED FROM PACKAGE SPEC PKG_MEC_HB@SBS0 TO PACKAGE SPEC PKG_MEC_HB@SBS1


    -- MMSC billing fields (not going into MEC engine)                          --  002SO
    Type tCdrInfoMmsc Is Record (
        Price                         Varchar2(10),
        StorageDuration               Varchar2(10),
        LayerSpecificAttr             Varchar2(10),
        DeliveryReadRepReqInd         VArchar2(10),
        NumOfNotification             Varchar2(10),
        NumHomeRecipients             Varchar2(10),
        NumNonHomeInCountryRecipients Varchar2(10),
        NumInternationalRecipients    Varchar2(10),
        NumEmailRecipients            Varchar2(10),
        NumShortCodeRecipients        Varchar2(10),
        MessageSize                   Varchar2(10),
        DurationOfStorage             Varchar2(10),
        MessagePriority               Varchar2(254),
        MessageClass                  Varchar2(254),
        MessageContent                Varchar2(254),
        NumOfNotifications            Varchar2(10),
        NumOfConversions              Varchar2(10),
        MMSIdentifier                 Varchar2(254),
        FwdcopyCopyInd                Varchar2(10),
        ContentRequestId              Varchar2(254),
        OutgoingInterfaceID           Varchar2(254),
        DeliveryReadReportReqInd      Varchar2(10),
        FreeText                      Varchar2(1000),
        MM7LinkedID                   Varchar2(254),
        PrepaidFreeText               Varchar2(254),
        UserAgent                     Varchar2(254),
        TranscodingId                 Varchar2(254),
        CDRRecordType                 Varchar2(254),
        PromotionPlan                 Varchar2(254),
        TariffClass                   Varchar2(254)
    );

END; -- Package spec
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- PKG_MEC_IC_ASCII0  (Package) 
--
CREATE OR REPLACE PACKAGE SBS1_ADMIN.PKG_MEC_IC_ASCII0
Is
-- Change History
-- See Package Body

    Type ArrBdReqNo                 Is Table Of Number(8)       Index By Binary_Integer;
    Type ArrRecNr                   Is Table Of Number(8)       Index By Binary_Integer;    
    Type ArrRecData                 Is Table Of Varchar2(4000)  Index By Binary_Integer;    

Procedure SP_INSERT_HEADER (
    p_BIH_ID            In Out  Varchar2,
    p_BIH_DEMO          In      Number,
    p_BIH_FILESEQ       In      Number,
    p_BIH_FILENAME      In      Varchar2,
    p_BIH_FILEDATE      In      Varchar2,
    p_BIH_MAPID         In      Varchar2,
    p_AppName           In      Varchar2,
    p_AppVer            In      Varchar2,
    p_Thread            IN      Varchar2,                                                           
    p_JobId             In      Number,
    p_HostName          In      Varchar2,
    p_Status            In      Varchar,
    p_ErrorCode         Out     Number,
    p_ErrorDesc         Out     Varchar2,
    p_ReturnStatus      Out     Number 
); 

    
Procedure SP_INSERT_CSV (
    p_BiHId                     In      VarChar2,
    p_BatchSize                 In      Integer,
    p_MaxAge                    In      Number,
    p_DataHeader                In      VarChar2,
    
    p_RecordNr                  In      ArrRecNr,
    p_RecordData                In      ArrRecData,
    
    p_RecCount                  In Out  Number,
    p_PreParseErrCount          In Out  Number,
    p_ErrCount                  In Out  Number,
    p_DateFc                    In Out  Varchar2,
    p_DateLc                    In Out  Varchar2,
    p_ErrorCode         Out     Number,
    p_ErrorDesc         Out     Varchar2,
    p_ReturnStatus      Out     Number 
);

    
Procedure SP_UPDATE_HEADER (
    p_BiHId             In      Varchar2,
    p_MaxAge            In      Number,
    p_DataHeader        In      VarChar2,       -- 012SO
    p_RecCount          In      Number,
    p_PreParseErrCount  In      Number,
    p_ErrCount          In      Number,
    p_DateFc            In      Varchar2,
    p_DateLc            In      Varchar2,
    p_ErrorCode         Out     Number,
    p_ErrorDesc         Out     Varchar2,
    p_ReturnStatus      Out     Number 
);

End; -- PKG_MEC_IC_ASCII0
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- PKG_MEC_OC  (Package) 
--
CREATE OR REPLACE PACKAGE SBS1_ADMIN.PKG_MEC_OC
Is
-- Change History
-- See Package Body

    Type ArrBdReqNo                 Is Table Of Number(8)       Index By Binary_Integer;
    Type ArrRecNr                   Is Table Of Number(8)       Index By Binary_Integer;    
    Type ArrRecData                 Is Table Of Varchar2(4000)  Index By Binary_Integer;    


Procedure SP_INSERT_HEADER (
    p_PackingType       In      Varchar2,
    p_PackingId         In OUT  Varchar2,
    p_HeaderId          OUT     Varchar2,
    p_JobId             OUT     Varchar2,
    p_FileName          Out     Varchar2,       -- 002SO
    p_AppName           In      Varchar2,
    p_AppVer            In      Varchar2,
    p_Thread            In      Varchar2,                                                           
    p_TaskId            In      Number,
    p_HostName          In      Varchar2,
    p_ErrorCode         Out     Number,
    p_ErrorDesc         Out     Varchar2,
    p_ReturnStatus      Out     Number 
);

Procedure SP_UPDATE_HEADER (
    p_HeaderId          In      Varchar2,
    p_JobId             In      Varchar2,
    p_FileName          In Out  Varchar2,
    p_FileDate          In      Varchar2,
    p_MaxAge            In      Number,
    p_DataHeader        In      VarChar2,       
    p_RecCount          In      Number,
    p_ErrCount          In      Number,
    p_DateFc            In      Varchar2,
    p_DateLc            In      Varchar2,
    p_ErrorCode         Out     Number,
    p_ErrorDesc         Out     Varchar2,
    p_ReturnStatus      Out     Number
);

Procedure SP_GET_JOB_DETAILS (                                                -- 003SO
    p_PackingId         In      Varchar2,
    p_JobId             In      Varchar2,                                       -- 003SO
    p_RefCursor         OUT     SYS_REFCURSOR,
    p_ErrorCode         Out     Number,
    p_ErrorDesc         Out     Varchar2,
    p_ReturnStatus      Out     Number 
);
  
Procedure SP_GET_JOB_QUERIES (                                                  
    p_PackingId         In      Varchar2,
    p_JobId             In      Varchar2,
    p_RefCursor         OUT     SYS_REFCURSOR,
    p_ErrorCode         Out     Number,
    p_ErrorDesc         Out     Varchar2,
    p_ReturnStatus      Out     Number 
    );  -- 004SO

Procedure SP_REGISTER_OUTPUT (                                                 
    p_PackingId         In      Varchar2,
    p_JobId             In      Varchar2,                                       
    p_FilePath          IN      Varchar2,   -- absolute path without file name
    p_FileName          IN      Varchar2,   -- name only
    p_FileSize          IN      Number,     -- 006SO
    p_OutputType        IN      Varchar2,   -- XLS / PDF / CSV for now
    p_OutputId          OUT     Varchar2,
    p_ErrorCode         Out     Number,
    p_ErrorDesc         Out     Varchar2,
    p_ReturnStatus      Out     Number 
);  -- 005SO
  
-- 007DA
Procedure SP_GET_PACKING_ID (
      p_PackingType   In      Varchar2,
      p_PackingId     In Out  Varchar2,
      p_Thread        In      Varchar2,
      p_ErrorCode     Out     Number,
      p_ErrorDesc     Out     Varchar2,
      p_ReturnStatus  Out     Number
);

Procedure SP_MODIFY_HEADER (
    p_HeaderId          in      varchar2,
    p_AppName           in      varchar2,
    p_AppVer            in      varchar2,
    p_Thread            in      varchar2,                                                           
    p_TaskId            in      number,
    p_HostName          in      varchar2,
    p_FileName          out     varchar2,
    p_ErrorCode         Out     Number,
    p_ErrorDesc         Out     Varchar2,
    p_ReturnStatus      Out     Number
);  -- 015SO

End; -- PKG_MEC_OC
 
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- PKG_REVA  (Package) 
--
CREATE OR REPLACE PACKAGE SBS1_ADMIN.PKG_REVA
  IS
--
-- MODIFICATION HISTORY (see also Package Body)
-- Person       Date    	Comments
-- ---------    ------  	------------------------------------------
-- AH		    2004-08-11	Creation
-- 012SO        2004-10-25  Add Input parameter p_DESC to call SP_REVA_RECENT (for BOH_FILENAME)
-- 014SO        2004-10-25  Add Input parameter p_SqlStmSrcType to call SP_REVA_RECENT (for BOH_FILENAME)
-- 016SO        2004-10-25  Create separate stub for REVA-SMSC
-- 017SO        2004-10-25  Make SP_REVA_RECENT a private procedure and rename to REVA_RECENT


-- Global functions
Function getConfig return reva_config%rowtype;

-- Stubs for different XPIOCs
Procedure SP_TRY_REVA_RECENT_MSC (
    p_PAC_ID          In      Varchar2,    -- 023SO
    p_BOH_ID          In Out  Varchar2,
    RecordsAffected   Out     Number,
    ErrorCode         Out     Number,
    ErrorMsg          Out     Varchar2,
    ReturnStatus      In Out  Number

);
Procedure SP_TRY_REVA_RECENT_SMSC (
    p_PAC_ID          In      Varchar2,    -- 023SO
    p_BOH_ID          In Out  Varchar2,
    RecordsAffected   Out     Number,
    ErrorCode         Out     Number,
    ErrorMsg          Out     Varchar2,
    ReturnStatus      In Out  Number

);
Procedure SP_TRY_REVA_RECENT_OTHERS (
    p_PAC_ID          In      Varchar2,    -- 023SO
    p_BOH_ID          In Out  Varchar2,
    RecordsAffected   Out     Number,
    ErrorCode         Out     Number,
    ErrorMsg          Out     Varchar2,
    ReturnStatus      In Out  Number

);

END; -- Package spec
 
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- PKG_REVI  (Package) 
--
CREATE OR REPLACE PACKAGE SBS1_ADMIN.PKG_REVI
  IS
--
-- Cross-Indexing of Content CDRs and Transport CDRs for Revenue Assurance
-- checking of Message Broker content services
--


-- Global functions
Function getConfig return revi_config%rowtype;

-- Stubs for different XPIOCs


procedure REVI_INDEX_MMS_FILE (
    p_BIH_ID          In   Varchar2,
    p_BOH_ID          In   Varchar2
);  -- 016SO

procedure REVI_INDEX_SMS_FILE (
    p_BIH_ID          In   Varchar2,
    p_BOH_ID          In   Varchar2
);  -- 016SO

procedure REVI_INDEX_CONTENT_FILE (
    p_BIH_ID          In   Varchar2,
    p_BOH_ID          In   Varchar2
);  -- 016SO

procedure REVI_INDEX_FILE (
    p_BIH_ID          In   Varchar2,
    p_BOH_ID          In   Varchar2
);  -- 016SO

 
  procedure SP_CONS_REVICD (
    p_PAC_ID          In      Varchar2,     -- 'REVICD'
    p_BOH_ID          In      Varchar2,
    RecordsAffected   Out     Number,
    ErrorCode         Out     Number,
    ErrorMsg          Out     Varchar2,
    ReturnStatus      In Out  Number
) -- find and index SMS and MMS transport delivery CDRs for chargeable content CDRs for last period
;
  procedure SP_CONS_REVICS (
    p_PAC_ID          In      Varchar2,     -- 'REVICS'
    p_BOH_ID          In      Varchar2,
    RecordsAffected   Out     Number,
    ErrorCode         Out     Number,
    ErrorMsg          Out     Varchar2,
    ReturnStatus      In Out  Number
) -- find and index SMS and MMS transport submits for chargeable content CDRs for last period
;
  procedure SP_CONS_REVIM (
    p_PAC_ID          In      Varchar2,     -- 'REVIM'
    p_BOH_ID          In      Varchar2,
    RecordsAffected   Out     Number,
    ErrorCode         Out     Number,
    ErrorMsg          Out     Varchar2,
    ReturnStatus      In Out  Number
);
  procedure SP_CONS_REVIPRE
(
    p_PAC_ID          In      Varchar2,     -- 'REVIPRE'
    p_BOH_ID          In      Varchar2,
    RecordsAffected   Out     Number,
    ErrorCode         Out     Number,
    ErrorMsg          Out     Varchar2,
    ReturnStatus      In Out  Number
) -- 020SO -- find and index prepaid charges on DSS for chargeable content CDRs for last period
;
  procedure SP_CONS_REVIPRM
(
    p_PAC_ID          In      Varchar2,     -- 'REVIPRM'
    p_BOH_ID          In      Varchar2,
    RecordsAffected   Out     Number,
    ErrorCode         Out     Number,
    ErrorMsg          Out     Varchar2,
    ReturnStatus      In Out  Number
) -- 020SO -- find and index content CDRs for MMS prepaid charges on DSS for last period
;
  procedure SP_CONS_REVIPRS
(
    p_PAC_ID          In      Varchar2, -- 'REVIPRS'
    p_BOH_ID          In      Varchar2,
    RecordsAffected   Out     Number,
    ErrorCode         Out     Number,
    ErrorMsg          Out     Varchar2,
    ReturnStatus      In Out  Number
) -- 020SO -- find and index content CDRs for SMS prepaid charges on DSS for last period
;
  procedure SP_CONS_REVIS
(
    p_PAC_ID          In      Varchar2,     -- 'REVIS'
    p_BOH_ID          In Out  Varchar2,
    RecordsAffected   Out     Number,
    ErrorCode         Out     Number,
    ErrorMsg          Out     Varchar2,
    ReturnStatus      In Out  Number
);

END; -- Package spec
 
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- PKG_STATS  (Package) 
--
CREATE OR REPLACE PACKAGE SBS1_ADMIN.PKG_STATS
  IS
--------------------------------------------------------------------
-- Project: Statistical Module
-- SBS-07.04-02
-- Author: Anita Haupenthal
--
-- Procedures for WEB, GENERATOR and SENDER (see XPIOC)
-- LastUpdate: 21.07.2003
--------------------------------------------------------------------

-- GLOBALS
FUNCTION getConfig return sta_config%rowtype;
FUNCTION getXproc(vXprocName xproc.xpr_id%type) return xproc%rowtype;
procedure updateJobOnError(pacid packing.pac_id%type, jobid sta_job.staj_id%type, p_BOH_ID varchar2, reason varchar2);


-- Check if its worth to get a BOHEADER ID; with other words: do we have to work?
PROCEDURE anythingToDo
(  p_PACT_ID        IN varchar2,
   p_BOH_ID         IN OUT varchar2,

   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT varchar2
);
-- Trigger: watchPackageStateChanges
Procedure watchPackageStateChanges
(  vPacId in packing.pac_id%type,
   vOldPacEsid in packing.pac_esid%type,
   vNewPacEsid in packing.pac_esid%type,
   vOldPacLtid in packing.pac_ltid%type,
   vNewPacLtid in packing.pac_ltid%type

);

--For administration (WEB-GUI): clean Jobs and files after certain time
--pkg_stats.doAdminCleanJobs('getJobs'): get all jobs and files for deleting
--pkg_stats.doAdminCleanJobs('setJobs'): deleting of files is done, update jobs

type tJob    is table of varchar2(2000) index by binary_integer;

Procedure doAdminCleanJobs
(
    p_toDo      in varchar2,

    p_JobId     in out tJob,
    p_JobDir    in out tJob,
    p_JobFile   in out tJob,

    RecordsAffected  OUT number,
    ErrorCode        OUT number,
    ErrorMsg         OUT varchar2,
    ReturnStatus     IN OUT number
);

----------------------------------------------------------------------
-- SCHEDULER
-- Called by XPIOC and/or WebGUI
-- Procedures and functions for SCHEDULER  ---------------------------

PROCEDURE scheduleStats
(  p_PACT_ID        IN varchar2,
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT varchar2
);

FUNCTION getNextExecDate (inCaller IN varchar2, inPacId IN varchar2, inRefDate date) return date;

type rDepInfo IS record
(   depPacId    varchar2(10),
    depPacName  varchar2(100),
    depPacExec  date
);
type tDepInfo IS VARRAY(100) OF rDepInfo;


PROCEDURE checkDependencies
(  inPacId          IN varchar2,
   inDateFrom       IN date,
   inDateTo         IN date,

   oDepend          IN OUT boolean,
   oDepInfo         IN OUT tDepInfo,

   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT varchar2

);


----------------------------------------------------------------------
-- EXECUTER
-- Called by XPIOC
-- Procedures and functions for EXECUTER   ---------------------------

-- Associative Array, some sort of:-)
--  1:
--  2:

type tNote   is table of varchar2(4000) index by binary_integer;                -- 009AA also used by the procedure getJobNotifData
type tKey   is table of varchar2(4000) index by binary_integer;
type tValue is table of varchar2(4000) index by binary_integer;

PROCEDURE getNextJob
(  p_PACT_ID        IN varchar2 DEFAULT NULL,
   p_BOH_ID         IN varchar2 DEFAULT NULL,

   arrKey           OUT tKey,
   arrValue         OUT tValue,
   arrNote          OUT tNote,

   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT varchar2
);

--009AA
PROCEDURE getJobNotifData
(  p_PACT_ID        IN varchar2 DEFAULT NULL,
   p_BOH_ID         IN varchar2 DEFAULT NULL,
   p_STAJ_ID        IN varchar2,

   arrJobNotif      OUT tNote,

   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT varchar2
);

-- Clean already scheduled jobs, which are not executed within allowed time frame
FUNCTION cleanJobs
(hrsToExec in sta_config.stac_execsched%type) RETURN number;


-- Write JobResult back to Database
PROCEDURE setJobResult
(
   p_PACT_ID        IN varchar2 DEFAULT NULL,
   p_BOH_ID         IN varchar2,

   arrKey           IN tKey,
   arrVal           IN tValue,

   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT varchar2
 );

-- SYSTEM STUFF
PROCEDURE writeSysLog
(   pMethod varchar2, pSqlCode number, pSqlErrM varchar2,pParameter varchar2, pLoggedOn date);

--WEB STUFF
  Procedure checkBaseTableData (
    inPacId          In     Varchar2,

    outDateFrom      Out    Date,
    outDateTo        Out    Date,
    outDrop          Out    Number,
    outDropPeriod    Out    Varchar2,

    outDateFromRaw   Out    Date,
    outDateToRaw     Out    Date,

    RecordsAffected  Out    Number,
    ErrorCode        Out    Number,
    ErrorMsg         Out    Varchar2,
    ReturnStatus     In Out Number
  );

  Procedure SP_NEW_STA_JOB (
    p_StajParentId      In      STA_JOB.STAJ_PARENTID%Type,
    p_StajPacId         In      STA_JOB.STAJ_PACID%Type,
    p_StajInfo          In      STA_JOB.STAJ_INFO%Type,
    p_StajLtValue       In      STA_JOB.STAJ_LTVALUE%Type,
    p_StajPeriodId      In      STA_JOB.STAJ_PERIODID%Type,
    p_AcIdCre           In      ACCOUNT.AC_ID%Type,
    p_StajId            Out     STA_JOB.STAJ_ID%Type,
    p_StajNotification  In      STA_JOB.STAJ_NOTIFICATION%Type,                 -- 010AA
    p_StajNotId         In      STA_JOB.STAJ_NOTID%Type,                        -- 010AA
    p_StajNotEmailSuccess   In  STA_JOB.STAJ_NOTEMAILSUCCESS%Type,              -- 010AA
    p_StajNotEmailFailure   In  STA_JOB.STAJ_NOTEMAILFAILURE%Type,              -- 010AA
    p_StajNotSendAttachment In  STA_JOB.STAJ_NOTSENDATT%Type,                   -- 010AA
    p_RecordsAffected   Out     Number,
    p_ErrNumber         In Out  Number,
    p_ErrDesc           In Out  Varchar2,
    p_ReturnStatus      In Out  Number
  );

  Procedure SP_NEW_STA_JOBPARAM (
    p_StajId            In      STA_JOB.STAJ_ID%Type,
    p_StajpName         In      STA_JOBPARAM.STAJP_NAME%Type,
    p_StajpValue        In      STA_JOBPARAM.STAJP_VALUE%Type,
    p_RecordsAffected   Out     Number,
    p_ErrNumber         In Out  Number,
    p_ErrDesc           In Out  Varchar2,
    p_ReturnStatus      In Out  Number
  );

  Procedure SP_NEW_STA_JOBSQLS (
    p_StajId            In      STA_JOB.STAJ_ID%Type,
    p_RecordsAffected   Out     Number,
    p_ErrNumber         In Out  Number,
    p_ErrDesc           In Out  Varchar2,
    p_ReturnStatus      In Out  Number
  );

  Procedure SP_REPLACE_PARAMS (
      p_StajId            In      Varchar2,
      p_PacId             In      Varchar2,
      p_PacLtId           In      Varchar2,
      p_StaqSql           In      Varchar2,
      p_StaqSqlNew        Out     Varchar2,
      p_RecordsAffected   Out     Number,
      p_ErrNumber         In Out  Number,
      p_ErrDesc           In Out  Varchar2,
      p_ReturnStatus      In Out  Number
  );

  Procedure SP_NEW_STA_JOBSQLS_X (
    p_StajId            In      STA_JOB.STAJ_ID%Type,
    p_RecordsAffected   Out     Number,
    p_ErrNumber         In Out  Number,
    p_ErrDesc           In Out  Varchar2,
    p_ReturnStatus      In Out  Number
  );

END; -- Package Specification PKG_STATS


 
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- USERMNG_SBS  (Package) 
--
CREATE OR REPLACE PACKAGE SBS1_ADMIN.USERMNG_SBS
Is

    -- Constants used to extract user-defined error codes and error descriptions
    -- from the Errdef table
    Err_Get_Unique_Address_Id Varchar2(10) := '1000000051';
    Err_Get_Unique_Account_Id Varchar2(10) := '1000000052';
    Err_Cre_New_Account       Varchar2(10) := '1000000053';
    Err_Cre_New_Address       Varchar2(10) := '1000000054';
    Err_Upd_Account           Varchar2(10) := '1000000055';
    Err_Upd_Address           Varchar2(10) := '1000000056';
    Err_Account_Not_Found     Varchar2(10) := '1000000057';
    Err_Upd_Account_State_Nok Varchar2(10) := '1000000058';
    Err_Cre_Issue_New_User    Varchar2(10) := '1000000059';
    Err_Cre_Issue_Upd_User    Varchar2(10) := '1000000060';
    Err_Cre_Issue_Del_User    Varchar2(10) := '1000000061';
    Err_Cre_Issue_Lck_User    Varchar2(10) := '1000000062';
    Err_Cre_Issue_Ulk_User    Varchar2(10) := '1000000063';
    Err_Cre_Issue_Grp_User    Varchar2(10) := '1000000064';
    Err_Duplicate_User_Id     Varchar2(10) := '1000000065';

    -- Names of any procedure/function new created or updated must be set as constant here
    g_ProcName_User_Create      Varchar2(20) := 'Create_User';
    g_ProcName_User_Alter       Varchar2(20) := 'Alter_User';
    g_ProcName_User_Drop        Varchar2(20) := 'Drop_User';
    g_ProcName_User_Lock        Varchar2(20) := 'Lock_User';
    g_ProcName_User_UnLock      Varchar2(20) := 'UnLock_User';
    g_ProcName_User_UpdateGroup Varchar2(20) := 'Upd_Group_Conn';

    Procedure Create_User (
        p_ac_short      in      varchar2,
        p_ac_name       in      varchar2,
        p_ac_lang       in      varchar2,
        p_ac_comment    in      varchar2,
        p_ac_type       in      varchar2,
        p_ac_dept       in      varchar2,   -- 007SO
        p_adr_phone1    in      varchar2,
        p_adr_phone2    in      varchar2,
        p_adr_mobile    in      varchar2,
        p_adr_fax       in      varchar2,
        p_adr_email     in      varchar2
    );

    Procedure Alter_User (
        p_ac_short      in      varchar2,
        p_ac_name       in      varchar2,
        p_ac_lang       in      varchar2,
        p_ac_comment    in      varchar2,
        p_ac_type       in      varchar2,
        p_ac_dept       in      varchar2,   -- 007SO
        p_adr_phone1    in      varchar2,
        p_adr_phone2    in      varchar2,
        p_adr_mobile    in      varchar2,
        p_adr_fax       in      varchar2,
        p_adr_email     in      varchar2
    );

    Procedure Drop_User (
        p_ac_short      in      varchar2
    );

    Procedure Lock_User (
        p_ac_short      in      varchar2
    );

    Procedure Unlock_User (
        p_ac_short      in      varchar2
    );

    Procedure Upd_Group_Conn (
        p_ac_short      in      varchar2,
        p_ac_type       in      varchar2
    );

    Procedure Insert_Group_Conn (
        p_ac_short      in      varchar2,
        p_ac_type       in      varchar2
    );

End UserMng_Sbs;    -- Package Spec

 
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- PKG_ADMIN_COMMON  (Package Body) 
--
CREATE OR REPLACE PACKAGE BODY SBS1_ADMIN.PKG_ADMIN_COMMON
IS
--  Purpose: Common routines for SBS input and output converters
--
--  MODIFICATION HISTORY (for details see VSS repository)
--  Person      Date        Comments
--  001SO       25.11.2003  Created, code moved from PKG_BDETAIL_COMMON
--  002AA       02.12.2003  Created routing stored procedure calls for all packages SPs accessed from WebModule
--  002AH       31.03.2004  Added new WARNING Writer, without ReturnCode
--  003AH       31.03.2004  Added new ERROR HANDLING, WARNING Writer, without RETURNCODE, and VALUES
--  004AH       07.04.2004  Changed getErrorDesc -> Merge table error with errdef
--  005AA       18.07.2004  Added wrapper procedure 'SP_REPLACE_PARAMS' for 'PKG_STATS.SP_REPLACE_PARAMS'
--  006SO       03.09.2004  Using PKG_AAA_PROV now instead of PKG_AAA
--  007SO       21.12.2004  Desupport for checkDependenciesWeb
--  008AA       30.12.2004  Added overload procedure SP_NEW_STA_JOB with extra job notification parameters (p_StajNotification,p_StajNotId,p_StajNotEmailSuccess,p_StajNotEmailFailure,p_StajNotSendAttachment)
--  009AA       10.01.2005  Added overlaoded procedure SP_INSERT_ISSUE with additional parameter for AC_ID (called by Pkg_Centrum for creating Account/Address related issues (history entries))
--  010SO       08.02.2004  Using PKG_AAA_HB instead of PKG_AAA_PROV
--  011AA       11.02.2004  Add new stored procedure SP_INSERT_AAACUSTBAR to insert a new AAA RBT Barring Rule
--  012SO       08.02.2009  Add Procedures for LongID management
--  013SO       09.02.2009  Implement LongID mapping validation and logging
--  014SO       23.02.2009  Correct naming for parameter p_AC_ID and field LONGH_ACID
--  015SO       08.03.2009  Create overload for SP_INSERT_AAALOG
--  016SO       13.12.2011  Remove CAT test implementation
--  017SO       14.12.2011  Remove schema qualifier "S B S 0 ."
--  018SO       29.02.2012  Use DB Link to SBS0 so that we can grant usage to SBSWEB
--  019SO       18.04.2012  Use synonyms instead of DB-Links to other schemas
--  020SO       06.05.2012  Use local synonyms instead of explicit schemas
--  021SO       13.06.2015  Remove stub for customer barring (ringbacktone)
--  022SO       01.12.2015  Add Procedure to hide Statistics Job output from GUI
--  023SO       14.12.2015  Add Procedure to generate Statistics Job
--  024SO       15.01.2019  Concatenate individual remarks into Job Info 


  function getErrorDesc(lvErrCode in varchar2) return errdef.errd_lang01%type
  IS
  ErrDesc errdef.errd_lang01%type;
  Begin
    ErrDesc:=lvErrCode||': Error Description not available';
    select errd_lang01 into ErrDesc
    from errdef
    where upper(errd_code)=upper(lvErrCode)
        or upper(errd_exception)=upper(lvErrCode);

  return ErrDesc;

  Exception
  When Others then
    --insert_warning('ERRORHANDLING', 'pkg_admin_common.getErrorDesc', 'Error Code', 'Error Code not found in Table ERROR');
      return ErrDesc;
  END;
----------------------------------------------------------------------------------------------------------------------------------------
--Purpose:          Write Warnings and Errors into global WARNING Table
--                  called by TRIGGERS, PACKAGES, XPIOC, XPIOC
--
--author:           AHaupenthal 003AH
--lastupdate:       31-03-2004
----------------------------------------------------------------------------------------------------------------------------------------

  procedure INSERT_WARNING
  (  p_W_APPLIC      IN varchar2,
     p_W_PROCEDURE   IN varchar2,
     p_W_TOPIC       IN varchar2,
     p_W_MESSAGE     IN varchar2,
     p_W_USERERRCODE IN varchar2 DEFAULT NULL,
     p_W_BIHID       IN varchar2 DEFAULT NULL,
     p_W_BOHID       IN varchar2 DEFAULT NULL,
     p_W_BDID        IN varchar2 DEFAULT NULL,
     p_W_SHORTID     IN varchar2 DEFAULT NULL)


  IS

  PRAGMA AUTONOMOUS_TRANSACTION;

  Begin
  Insert into Warning
  (  W_ID, W_DATETIME,W_APPLIC,W_TOPIC,W_PROCEDURE,W_MESSAGE,W_ERRORTIME,W_BIHID,W_BOHID, W_BDID, W_SHORTID,
  W_ERRORCODE )
  Values
  (  GenerateUniqueKey('G'), SYSDATE, p_W_APPLIC, p_W_TOPIC, p_W_PROCEDURE, p_W_MESSAGE,SYSDATE,
     p_W_BIHID, p_W_BOHID, p_W_BDID, p_W_SHORTID, p_W_USERERRCODE);

  commit;

  Exception
  When Others then
    null;
  END INSERT_WARNING;
  ------------------------------------------------------------------------------------------------------------------------


    Procedure SP_VALIDATE_EXCHANGE_RATES
    (
        p_CUR_ID        In              Varchar2,
        ErrorCode       Out             Number,
        ErrorMsg        Out             Varchar2,
        ReturnStatus    In Out          Number
    )
    IS
        p_rowcount    number(10);
    Begin

        UPDATE EXCHANGERATE ER1 SET ER1.EXR_END =
            (SELECT NVL(MIN(ER2.EXR_START),to_date('21000101','yyyymmdd')) FROM EXCHANGERATE ER2 WHERE ER2.EXR_CURID = ER1.EXR_CURID AND ER2.EXR_START > ER1.EXR_START)
            WHERE ER1.EXR_CURID = p_CUR_ID;

        Returnstatus := 1;

        Return;
    Exception
    When Others then
        ErrorCode := SQLCODE;
        ErrorMsg  := SQLERRM;
        ReturnStatus := 0;
    END SP_VALIDATE_EXCHANGE_RATES;

    Procedure SP_VALIDATE_PM_VERSION_DATES
    (
        p_PM_ID         In              Varchar2,
        ErrorCode       Out             Number,
        ErrorMsg        Out             Varchar2,
        ReturnStatus    In Out          Number
    )
    IS
        p_rowcount    number(10);
    Begin

        UPDATE PRMODELVER PMV1 SET PMV1.PMV_END =
            (SELECT NVL(MIN(PMV2.PMV_START),to_date('21000101','yyyymmdd')) FROM PRMODELVER PMV2 WHERE PMV2.PMV_PMID = PMV1.PMV_PMID AND PMV2.PMV_START > PMV1.PMV_START AND PMV1.PMV_ESID = 'A' AND PMV2.PMV_ESID = 'A')
            WHERE PMV1.PMV_PMID = p_PM_ID
            AND PMV1.PMV_ESID = 'A';

        Returnstatus := 1;

        Return;
    Exception
    When Others then
        ErrorCode := SQLCODE;
        ErrorMsg  := SQLERRM;
        ReturnStatus := 0;
    END SP_VALIDATE_PM_VERSION_DATES;

    Procedure SP_INSERT_PMVTRANS
    (
        p_Dummy         In              Varchar2,
        ErrorCode       Out             Number,
        ErrorMsg        Out             Varchar2,
        ReturnStatus    In Out          Number
    )
    Is
        p_RowCount      Number(10);
        Idx             Number(2);
        Cursor crsrPRMODELVER Is
            Select * From PRMODELVER;
    Begin

        -- for each price model version add 11 entries (1 sms + 10 mms)
        For recRRMODELVER in crsrPRMODELVER Loop
            -- one 160 entry for SMS type
            Insert Into PRMODELVERTRANS (PMVT_ID, PMVT_PMVID, PMVT_TRCLASS, PMVT_CLASSTYPE, PMVT_CLASSDESC, PMVT_AMOUNTMO, PMVT_AMOUNTMT, PMVT_COMMENT)
                Select GENERATEUNIQUEKEY('G'), recRRMODELVER.PMV_ID, 0.160, 'SMS', '', 0.0000, 0.0000, ''
                From DUAL;

            -- ten 9999999.999 (infinite value) entries for MMS type
            For Idx In 1..10 Loop
                Insert Into PRMODELVERTRANS (PMVT_ID, PMVT_PMVID, PMVT_TRCLASS, PMVT_CLASSTYPE, PMVT_CLASSDESC, PMVT_AMOUNTMO, PMVT_AMOUNTMT, PMVT_COMMENT)
                    Select GENERATEUNIQUEKEY('G'), recRRMODELVER.PMV_ID, 9999999.999, 'MMS', '', 0.0000, 0.0000, ''
                    From DUAL;
            End Loop;

        End Loop;
        Commit;
        Returnstatus := 1;
        Return;
    Exception
        When Others then
        ErrorCode := SqlCode;
        ErrorMsg  := SqlErrm;
        ReturnStatus := 0;
    End SP_INSERT_PMVTRANS;

    Procedure SP_INSERT_ISSUE
    (
        p_IS_ETID       In      Varchar,
        p_IS_ESID       In      Varchar,
        p_IS_DESCRIPTION In     Varchar,
        p_IS_VISUM      In      Varchar,
        p_IS_CONID      In      Varchar,
        p_IS_ACIDRESP   In      Varchar,
        p_IS_ACIDCRE    In      Varchar,
        ErrorCode       Out     Number,
        ErrorMsg        Out     Varchar2,
        ReturnStatus    In Out  Number
    )
    Is

    -- PRAGMA AUTONOMOUS_TRANSACTION;

    Begin

        Insert Into ISSUE (
            IS_ID,
            IS_ETID,
            IS_ESID,
            IS_DESCRIPTION,
            IS_VISUM,
            IS_CONID,
            IS_ACIDRESP,
            IS_ACIDCRE,
            IS_DATECRE,
            IS_ACIDMOD,
            IS_DATEMOD,
            IS_CHNGCNT
        )
        Values (
            GenerateUniqueKey('G'),
            p_IS_ETID,
            p_IS_ESID,
            p_IS_DESCRIPTION,
            p_IS_VISUM,
            p_IS_CONID,
            p_IS_ACIDRESP,
            p_IS_ACIDCRE,
            SysDate,
            Null,
            Null,
            0
        );

        Commit;
        Returnstatus := 1;

    Exception
    When Others then
        ErrorCode := SQLCODE;
        ErrorMsg  := SQLERRM;
        ReturnStatus := 0;

    END SP_INSERT_ISSUE;

    --009AA overloaded with additional AC_ID parameter
    Procedure SP_INSERT_ISSUE (
        p_IS_ETID       In      Varchar,
        p_IS_ESID       In      Varchar,
        p_IS_DESCRIPTION In     Varchar,
        p_IS_VISUM      In      Varchar,
        p_IS_CONID      In      Varchar,
        p_IS_ACID       In      Varchar,
        p_IS_ACIDRESP   In      Varchar,
        p_IS_ACIDCRE    In      Varchar,
        ErrorCode       Out     Number,
        ErrorMsg        Out     Varchar2,
        ReturnStatus    In Out  Number
    )
    Is
    -- PRAGMA AUTONOMOUS_TRANSACTION;
    Begin
        Insert Into ISSUE (
            IS_ID,
            IS_ETID,
            IS_ESID,
            IS_DESCRIPTION,
            IS_VISUM,
            IS_CONID,
            IS_ACID,
            IS_ACIDRESP,
            IS_ACIDCRE,
            IS_DATECRE,
            IS_ACIDMOD,
            IS_DATEMOD,
            IS_CHNGCNT
        )
        Values (
            GenerateUniqueKey('G'),
            p_IS_ETID,
            p_IS_ESID,
            p_IS_DESCRIPTION,
            p_IS_VISUM,
            p_IS_CONID,
            p_IS_ACID,
            p_IS_ACIDRESP,
            p_IS_ACIDCRE,
            SysDate,
            Null,
            Null,
            0
        );
        Commit;
        Returnstatus := 1;
    Exception
    When Others then
        ErrorCode := SQLCODE;
        ErrorMsg  := SQLERRM;
        ReturnStatus := 0;
    END SP_INSERT_ISSUE;

    Procedure SP_DB_SLEEP
    (   p_PACT_ID        IN varchar2,
        p_BOH_ID         IN OUT varchar2,

        RecordsAffected  OUT number,
        ErrorCode        OUT number,
        ErrorMsg         OUT varchar2,
        ReturnStatus     IN OUT varchar2
    )

    Is
    Begin

        Dbms_Lock.Sleep(10);

        RecordsAffected:=0;
        ErrorCode:=0;
        ErrorMsg:=null;
        Returnstatus := 1;

        Return;
    Exception
    When Others then

        RecordsAffected:=0;
        ErrorCode := SqlCode;
        ErrorMsg  := SqlErrm;
        ReturnStatus := 0;

    End; -- SP_DB_SLEEP


    Procedure SP_INSERT_AAALOG (
        p_Msisdn          In      AAAIMPORT.AAAI_MSISDN%Type,
        p_ChngCnt         In      AAATRACKING.AAAT_CHNGCNT%Type,
        p_TopScm_Old      In      AAATRACKING.AAAT_TOPSCM%Type,
        p_TopScm_New      In      AAAIMPORT.AAAI_TOPSCM%Type,
        p_BarScm_Old      In      AAATRACKING.AAAT_BARSCM%Type,
        p_BarScm_New      In      AAAIMPORT.AAAI_BARSCM%Type,
        p_TopCu_Old       In      AAATRACKING.AAAT_TOPCU%Type,
        p_TopCu_New       In      AAAIMPORT.AAAI_TOPCU%Type,
        p_BarCu_Old       In      AAATRACKING.AAAT_BARCU%Type,
        p_BarCu_New       In      AAAIMPORT.AAAI_BARCU%Type,
        p_Sc_Old          IN      AAATRACKING.AAAT_SC%Type,                   --  015SO
        p_Sc_New          IN      AAATRACKING.AAAT_SC%Type,                   --  015SO
        p_ReqType         In      AAAIMPORT.AAAI_REQUESTTYPE%Type,
        p_AcId            In      AAATRACKING.AAAT_ACIDMOD%Type,
        p_Comment         In      AAALOG.AAAL_COMMENT%Type,
        p_ErrNumber       In Out  Number,
        p_ErrDesc         In Out  Varchar2,
        p_ReturnStatus    In Out  Number
    )
    Is
    Begin
        PKG_AAA_HB.SP_INSERT_AAALOG (       --  019SO  --010SO  --006SO
            p_Msisdn,
            p_ChngCnt,
            p_TopScm_Old,
            p_TopScm_New,
            p_BarScm_Old,
            p_BarScm_New,
            p_TopCu_Old,
            p_TopCu_New,
            p_BarCu_Old,
            p_BarCu_New,
            p_Sc_Old,               --  015SO
            p_Sc_New,               --  015SO
            p_ReqType,
            p_AcId,
            p_Comment,
            p_ErrNumber,
            p_ErrDesc,
            p_ReturnStatus
        );  --  018SO
    End;

    Procedure SP_INSERT_AAALOG (
        p_Msisdn          In      AAAIMPORT.AAAI_MSISDN%Type,
        p_ChngCnt         In      AAATRACKING.AAAT_CHNGCNT%Type,
        p_TopScm_Old      In      AAATRACKING.AAAT_TOPSCM%Type,
        p_TopScm_New      In      AAAIMPORT.AAAI_TOPSCM%Type,
        p_BarScm_Old      In      AAATRACKING.AAAT_BARSCM%Type,
        p_BarScm_New      In      AAAIMPORT.AAAI_BARSCM%Type,
        p_TopCu_Old       In      AAATRACKING.AAAT_TOPCU%Type,
        p_TopCu_New       In      AAAIMPORT.AAAI_TOPCU%Type,
        p_BarCu_Old       In      AAATRACKING.AAAT_BARCU%Type,
        p_BarCu_New       In      AAAIMPORT.AAAI_BARCU%Type,
        p_ReqType         In      AAAIMPORT.AAAI_REQUESTTYPE%Type,
        p_AcId            In      AAATRACKING.AAAT_ACIDMOD%Type,
        p_Comment         In      AAALOG.AAAL_COMMENT%Type,
        p_ErrNumber       In Out  Number,
        p_ErrDesc         In Out  Varchar2,
        p_ReturnStatus    In Out  Number
    )
    Is
    Begin
        PKG_AAA_HB.SP_INSERT_AAALOG(    --  020SO--  019SO  --010SO  --006SO
            p_Msisdn,
            p_ChngCnt,
            p_TopScm_Old,
            p_TopScm_New,
            p_BarScm_Old,
            p_BarScm_New,
            p_TopCu_Old,
            p_TopCu_New,
            p_BarCu_Old,
            p_BarCu_New,
            NULL,               --  015SO
            NULL,               --  015SO
            p_ReqType,
            p_AcId,
            p_Comment,
            p_ErrNumber,
            p_ErrDesc,
            p_ReturnStatus
        );  --  018SO
    End;

    Procedure SP_RESET_AAATRACKING (
        p_MSISDN          In      Varchar2,
        p_BIHID           In      Varchar2,
        p_BOHID           In      Varchar2,
        ErrorCode         Out     Number,
        ErrorMsg          Out     Varchar2,
        ReturnStatus      In Out  Number
    )
    Is
    Begin
        PKG_AAA_HB.SP_RESET_AAATRACKING (  --  020SO  --  019SO  --  006SO
            p_MSISDN,
            p_BIHID,
            p_BOHID,
            ErrorCode,
            ErrorMsg,
            ReturnStatus
        );  --  018SO
    End;

    Procedure SP_SMSC_ASSIGNMENT_EXECUTE (
        p_PACT_ID       In      Varchar2,
        p_BOH_ID        In      Varchar2,
        p_AC_ID         In      Varchar2,
        RecordsAffected Out     Number,
        ErrorCode       Out     Number,
        ErrorMsg        Out     Varchar2,
        ReturnStatus    In Out  Number
    )
    Is
    Begin
        Pkg_Interworking.SP_SMSC_ASSIGNMENT_EXECUTE (
            p_PACT_ID,
            p_BOH_ID,
            p_AC_ID,
            RecordsAffected,
            ErrorCode,
            ErrorMsg,
            ReturnStatus
        );
    End;

    procedure generateTestData(
        pJobId           IN varchar2 DEFAULT '0',
        RecordsAffected  OUT number,
        ErrorCode        OUT number,
        ErrorMsg         OUT varchar2,
        ReturnStatus     IN OUT number
    )
    Is
    Begin
    /*  --  016SO
        PKG_CAT.generateTestData(
            pJobId,
            RecordsAffected,
            ErrorCode,
            ErrorMsg,
            ReturnStatus
        );
    */
    NULL;
    End;

    Procedure SP_HIDE_JOB_OUTPUT (
        p_AcId              In      ACCOUNT.AC_ID%Type,
        p_JobOutputId       In      STA_JOBOUTPUT.STAJO_ID%Type,
        p_ErrNumber         In Out  Number,
        p_ErrDesc           In Out  Varchar2
    )
    Is  --  022SO
        l_file_name     Varchar2(100);
        l_staj_id       Varchar2(10);
    Begin
        select STAJO_FILENAME, STAJO_JOBID
        into l_file_name, l_staj_id
        from    STA_JOBOUTPUT
        where STAJO_ID = p_JobOutputId;

        INSERT_WARNING( 'STATS','SP_HIDE_JOB_OUTPUT','JOB DELETED BY ACCOUNT ' || p_AcId, l_file_name);

        UPDATE STA_JOB SET STAJ_ESID = 'D' WHERE STAJ_ID = l_staj_id;
        
        -- DELETE FROM STA_JOBOUTPUT where STAJO_ID = p_JobOutputId;

        p_ErrNumber := 0;
        p_ErrDesc := NULL;
    Exception
    When Others then
        p_ErrNumber := SQLCODE;
        p_ErrDesc  := SQLERRM;
    end;


    Procedure SP_NEW_STA_JOB (
        p_StajParentId      In      STA_JOB.STAJ_PARENTID%Type,
        p_StajPacId         In      STA_JOB.STAJ_PACID%Type,
        p_StajInfo          In      STA_JOB.STAJ_INFO%Type,
        p_StajLtValue       In      STA_JOB.STAJ_LTVALUE%Type,
        p_StajPeriodId      In      STA_JOB.STAJ_PERIODID%Type,
        p_AcIdCre           In      ACCOUNT.AC_ID%Type,
        p_StajId            Out     STA_JOB.STAJ_ID%Type,
        p_RecordsAffected   Out     Number,
        p_ErrNumber         In Out  Number,
        p_ErrDesc           In Out  Varchar2,
        p_ReturnStatus      In Out  Number
    )
    Is
    Begin
        PKG_STATS.SP_NEW_STA_JOB (
            p_StajParentId,
            p_StajPacId,
            p_StajInfo,
            p_StajLtValue,
            p_StajPeriodId,
            p_AcIdCre,
            p_StajId,
            Null,                                                               -- 008AA
            Null,                                                               -- 008AA
            Null,                                                               -- 008AA
            Null,                                                               -- 008AA
            Null,                                                               -- 008AA
            p_RecordsAffected,
            p_ErrNumber,
            p_ErrDesc,
            p_ReturnStatus
        );
    End;

    -- 008AA
    Procedure SP_NEW_STA_JOB (
        p_StajParentId      In      STA_JOB.STAJ_PARENTID%Type,
        p_StajPacId         In      STA_JOB.STAJ_PACID%Type,
        p_StajInfo          In      STA_JOB.STAJ_INFO%Type,
        p_StajLtValue       In      STA_JOB.STAJ_LTVALUE%Type,
        p_StajPeriodId      In      STA_JOB.STAJ_PERIODID%Type,
        p_AcIdCre           In      ACCOUNT.AC_ID%Type,
        p_StajId            Out     STA_JOB.STAJ_ID%Type,
        p_StajNotification  In      STA_JOB.STAJ_NOTIFICATION%Type,             -- 008AA
        p_StajNotId         In      STA_JOB.STAJ_NOTID%Type,                    -- 008AA
        p_StajNotEmailSuccess   In  STA_JOB.STAJ_NOTEMAILSUCCESS%Type,          -- 008AA
        p_StajNotEmailFailure   In  STA_JOB.STAJ_NOTEMAILFAILURE%Type,          -- 008AA
        p_StajNotSendAttachment In  STA_JOB.STAJ_NOTSENDATT%Type,               -- 008AA
        p_RecordsAffected   Out     Number,
        p_ErrNumber         In Out  Number,
        p_ErrDesc           In Out  Varchar2,
        p_ReturnStatus      In Out  Number
    )
    Is
    Begin
        PKG_STATS.SP_NEW_STA_JOB (
            p_StajParentId,
            p_StajPacId,
            p_StajInfo,
            p_StajLtValue,
            p_StajPeriodId,
            p_AcIdCre,
            p_StajId,
            p_StajNotification,                                                 -- 008AA
            p_StajNotId,                                                        -- 008AA
            p_StajNotEmailSuccess,                                              -- 008AA
            p_StajNotEmailFailure,                                              -- 008AA
            p_StajNotSendAttachment,                                            -- 008AA
            p_RecordsAffected,
            p_ErrNumber,
            p_ErrDesc,
            p_ReturnStatus
        );
    End;

    Procedure SP_NEW_STA_JOBPARAM (
        p_StajId            In      STA_JOB.STAJ_ID%Type,
        p_StajpName         In      STA_JOBPARAM.STAJP_NAME%Type,
        p_StajpValue        In      STA_JOBPARAM.STAJP_VALUE%Type,
        p_RecordsAffected   Out     Number,
        p_ErrNumber         In Out  Number,
        p_ErrDesc           In Out  Varchar2,
        p_ReturnStatus      In Out  Number
    )
    Is
    Begin
        PKG_STATS.SP_NEW_STA_JOBPARAM (
            p_StajId,
            p_StajpName,
            p_StajpValue,
            p_RecordsAffected,
            p_ErrNumber,
            p_ErrDesc,
            p_ReturnStatus
        );
    End;

    Procedure SP_NEW_STA_JOBSQLS (
        p_StajId            In      STA_JOB.STAJ_ID%Type,
        p_RecordsAffected   Out     Number,
        p_ErrNumber         In Out  Number,
        p_ErrDesc           In Out  Varchar2,
        p_ReturnStatus      In Out  Number
    )
    Is
    Begin
        PKG_STATS.SP_NEW_STA_JOBSQLS (
            p_StajId,
            p_RecordsAffected,
            p_ErrNumber,
            p_ErrDesc,
            p_ReturnStatus
        );
    End;

    --  005AA
    Procedure SP_REPLACE_PARAMS (
        p_StajId            In      Varchar2,
        p_PacId             In      Varchar2,
        p_PacLtId           In      Varchar2,
        p_StaqSql           In      Varchar2,
        p_StaqSqlNew        Out     Varchar2,
        p_RecordsAffected   Out     Number,
        p_ErrNumber         In Out  Number,
        p_ErrDesc           In Out  Varchar2,
        p_ReturnStatus      In Out  Number
    )
    Is
    Begin
        PKG_STATS.SP_REPLACE_PARAMS (
            p_StajId,
            p_PacId,
            p_PacLtId,
            p_StaqSql,
            p_StaqSqlNew,
            p_RecordsAffected,
            p_ErrNumber,
            p_ErrDesc,
            p_ReturnStatus
        );
    End;

    Procedure checkBaseTableData (
        inPacId          In     Varchar2,

        outDateFrom      Out    Date,
        outDateTo        Out    Date,
        outDrop          Out    Number,
        outDropPeriod    Out    Varchar2,

        outDateFromRaw   Out    Date,
        outDateToRaw     Out    Date,

        RecordsAffected  Out    Number,
        ErrorCode        Out    Number,
        ErrorMsg         Out    Varchar2,
        ReturnStatus     In Out Number
    )
    Is
    Begin
        PKG_STATS.checkBaseTableData (
            inPacId,

            outDateFrom,
            outDateTo,
            outDrop,
            outDropPeriod,

            outDateFromRaw,
            outDateToRaw,

            RecordsAffected,
            ErrorCode,
            ErrorMsg,
            ReturnStatus
        );
    End;

    PROCEDURE checkDependenciesWeb (
        inPacId          In      Varchar2,
        inDateFrom       In      Date,
        inDateTo         In      Date,

        oDepend          In Out  Number,
        oDepPacId        In Out  Varchar2,
        oDepPacName      In Out  Varchar2,
        oDepPacExec      In Out  Date,

        RecordsAffected  Out     Number,
        ErrorCode        Out     Number,
        ErrorMsg         Out     Varchar2,
        ReturnStatus     In Out  Number
    )
    Is
    Begin
        /*
        PKG_STATS.checkDependenciesWeb (
            inPacId,
            inDateFrom,
            inDateTo,
            oDepend,
            oDepPacId,
            oDepPacName,
            oDepPacExec,
            RecordsAffected,
            ErrorCode,
            ErrorMsg,
            ReturnStatus
        );
        */                                                                      --  007SO
        ErrorCode := -1;                                                        --  007SO
        ErrorMsg := 'PKG_STATS,checkDependenciesWeb is not supported any more'; --  007SO
        ReturnStatus := 0;                                                      --  007SO
    End;


    Procedure SP_LONGID_MAP_REFRESH
    --  012SO
    Is

    l_null_date     DATE := to_Date('01.01.1900','dd.mm.yyyy');

    CURSOR  cMappingCandidate(firstLongId LONGID%rowtype) IS
    SELECT LONG_ID FROM LONGID
    WHERE
        LONG_ID > firstLongId.LONG_ID
    AND LONG_ESID = firstLongId.LONG_ESID
    AND NVL(LONG_DATESTART,l_null_date) = NVL(firstLongId.LONG_DATESTART,l_null_date)
    AND NVL(LONG_DATEEND,l_null_date) = NVL(firstLongId.LONG_DATEEND,l_null_date)
    AND NVL(LONG_SHORTID,'-') = NVL(firstLongId.LONG_SHORTID,'-')
    AND NVL(LONG_PRICE,-999.9999) = NVL(firstLongId.LONG_PRICE,-999.9999)
    ORDER BY LONG_ID
    ;
    cMappingCandidateRow cMappingCandidate%rowtype;

    l_first_long_id_row LONGID%rowtype;
    l_last_long_id      LONGID.LONG_ID%type;
    l_candidate_long_id LONGID.LONG_ID%type;
    l_occupied_count    INTEGER;
    l_available_count   INTEGER;

    Begin

        -- Update status after quarantine termination

        UPDATE LONGID SET
            LONG_ESID = 'R'
        WHERE
            LONG_ESID = 'I'
        AND SYSDATE > LONG_DATEEND + 365/2
        ;

        LOCK TABLE LONGIDMAP IN EXCLUSIVE MODE NOWAIT;

        DELETE FROM LONGIDMAP;

        SELECT * into l_first_long_id_row
        FROM LONGID
        WHERE LONG_ID = (SELECT MIN(LONG_ID) FROM LONGID)
        ;

        while not (l_first_long_id_row.long_id IS NULL) loop

            -- another LongIdMapping needs to be generated
            l_last_long_id := l_first_long_id_row.long_id;
            for cMappingCandidateRow in cMappingCandidate(l_first_long_id_row) loop
                if cMappingCandidateRow.long_id - l_last_long_id = 1 then
                    l_last_long_id := cMappingCandidateRow.long_id;
                else
                    exit;
                end if;
            end loop;

            if l_first_long_id_row.LONG_ESID IN ('M','I','D') then
                l_occupied_count := l_last_long_id - l_first_long_id_row.long_id + 1;
                l_available_count := 0;
            else
                l_occupied_count := 0;
                l_available_count := l_last_long_id - l_first_long_id_row.long_id + 1;
            end if;

            INSERT INTO LONGIDMAP (
                LONGM_LONGID1,
                LONGM_LONGID2,
                LONGM_ESID,
                LONGM_DATESTART,
                LONGM_DATEEND,
                LONGM_SHORTID,
                LONGM_PRICE,
                LONGM_OCCUPIED,
                LONGM_AVAILABLE
            ) VALUES (
                l_first_long_id_row.long_id,
                l_last_long_id,
                l_first_long_id_row.LONG_ESID,
                l_first_long_id_row.LONG_DATESTART,
                l_first_long_id_row.LONG_DATEEND,
                l_first_long_id_row.LONG_SHORTID,
                l_first_long_id_row.LONG_PRICE,
                l_occupied_count,
                l_available_count
                );

            SELECT * into l_first_long_id_row
            FROM LONGID
            WHERE LONG_ID = (SELECT MIN(LONG_ID) FROM LONGID WHERE LONG_ID > l_last_long_id)
            ;

        end loop;

    EXCEPTION
        WHEN NO_DATA_FOUND then
            NULL;
    END SP_LONGID_MAP_REFRESH;


    Procedure SP_LONGID_MAP_ADD
    (
        p_AC_ID         In      Varchar2,                                       --  014SO
        p_LONGM_LONGID1 In      LONGID.LONG_ID%type,
        p_LONGM_LONGID2 In      LONGID.LONG_ID%type,
        p_COMMENT       IN      Varchar2,
        ErrorCode       Out     Number,
        ErrorMsg        Out     Varchar2,
        ReturnStatus    In Out  Number
    )   --  012SO
    Is

    l_offset    INTEGER;
    l_history_sequence  NUMBER(10);

    Begin

        -- validate request --  013SO

        if p_LONGM_LONGID2 < p_LONGM_LONGID1 then
            RAISE NO_DATA_FOUND;
        end if;

        -- generate log --  013SO

        SELECT LONGIDHIST_SEQ.NEXTVAL into l_history_sequence from dual;

        insert into LONGIDHIST (LONGH_ID,LONGH_DATETIME,LONGH_ACID,LONGH_FORCE,LONGH_COMMENT)
        values (l_history_sequence,sysdate,p_AC_ID,0,p_COMMENT);                --  014SO

        -- try to do it (may fail for more reasons)
        for l_offset IN 0 .. p_LONGM_LONGID2-p_LONGM_LONGID1 Loop

            INSERT INTO LONGID (
                LONG_ID,
                LONG_ESID,
                LONG_CHANGEID,
                LONG_FORCE
            ) VALUES (
                p_LONGM_LONGID1 + l_offset,
                'F',
                l_history_sequence,
                0
            );

        end loop;

        SP_LONGID_MAP_REFRESH;

        Returnstatus := 1;

    Exception
    When Others then
        ErrorCode := SQLCODE;
        ErrorMsg  := SQLERRM;
        ReturnStatus := 0;
        Rollback;

    END SP_LONGID_MAP_ADD;


    Procedure SP_LONGID_MAP_UPDATE
    (
        p_AC_ID             In      Varchar2,                                   --  014SO
        p_LONGM_LONGID1     In      LONGIDMAP.LONGM_LONGID1%type,
        p_LONGM_LONGID2     In      LONGIDMAP.LONGM_LONGID2%type,
        p_LONGM_ESID        IN      LONGIDMAP.LONGM_ESID%type,
        p_LONGM_DATESTART   IN      Varchar2,
        p_LONGM_DATEEND     IN      Varchar2,
        p_LONGM_SHORTID     IN      LONGIDMAP.LONGM_SHORTID%type,
        p_LONGM_PRICE       IN      Varchar2,
        p_FORCE             IN      Number,
        p_COMMENT           IN      Varchar2,
        ErrorCode           Out     Number,
        ErrorMsg            Out     Varchar2,
        ReturnStatus        In Out  Number
    )   --  012SO
    Is

    l_offset    INTEGER;
    l_history_sequence  NUMBER(10);

    Begin

        -- validate request --  013SO

        if p_LONGM_LONGID2 < p_LONGM_LONGID1 then
            RAISE NO_DATA_FOUND;
        end if;

        if p_LONGM_ESID = 'M' then
            if p_LONGM_DATESTART IS NULL then
                RAISE NO_DATA_FOUND;
            end if;
            if p_LONGM_PRICE IS NULL then
                RAISE NO_DATA_FOUND;
            end if;
            if p_LONGM_SHORTID IS NULL then
                RAISE NO_DATA_FOUND;
            end if;
        end if;

        if p_LONGM_ESID IN ('D','F','R') then
            if not (p_LONGM_DATESTART IS NULL) then
                RAISE NO_DATA_FOUND;
            end if;
            if not (p_LONGM_DATEEND IS NULL) then
                RAISE NO_DATA_FOUND;
            end if;
            if not (p_LONGM_SHORTID IS NULL) then
                RAISE NO_DATA_FOUND;
            end if;
        end if;

        -- generate log --  013SO

        SELECT LONGIDHIST_SEQ.NEXTVAL into l_history_sequence from dual;

        insert into LONGIDHIST (LONGH_ID,LONGH_DATETIME,LONGH_ACID,LONGH_FORCE,LONGH_COMMENT)
        values (l_history_sequence,sysdate,p_AC_ID,p_FORCE,p_COMMENT);          --  014SO

        -- try to do it (may fail for more reasons)

        for l_offset IN 0 .. p_LONGM_LONGID2-p_LONGM_LONGID1 Loop

            UPDATE LONGID SET
                LONG_ESID = p_LONGM_ESID,
                LONG_DATESTART = to_date(p_LONGM_DATESTART,'yyyymmddhh24miss'),
                LONG_DATEEND = to_date(p_LONGM_DATEEND,'yyyymmddhh24miss'),
                LONG_SHORTID = p_LONGM_SHORTID,
                LONG_PRICE = to_number(p_LONGM_PRICE),
                LONG_CHANGEID = l_history_sequence,
                LONG_FORCE = p_FORCE
            WHERE   LONG_ID = p_LONGM_LONGID1 + l_offset
            AND (
                    (LONG_ESID IN ('F','R'))
                OR  (SYSDATE > LONG_DATEEND + 365/2)
                OR  (LONG_SHORTID = p_LONGM_SHORTID)
                OR  (p_FORCE = 1)
                )
            ;
            if SQL%ROWCOUNT = 0 then
                RAISE NO_DATA_FOUND;
            end if;

        end loop;

        -- generate grouped display-version of mappings

        SP_LONGID_MAP_REFRESH;

        Returnstatus := 1;

    Exception
    When Others then
        ErrorCode := SQLCODE;
        ErrorMsg  := SQLERRM;
        ReturnStatus := 0;
        Rollback;

    END SP_LONGID_MAP_UPDATE;


Procedure SP_ADD_REPORT(
      STR_ACID              IN  Varchar2
    , STR_PAC_ID            IN  Varchar2
    , DAT_FROM              IN  Date
    , DAT_TO                IN  Date
    , STR_OPT_PARAM         IN  Varchar2
    , STR_COMMENT           IN  Varchar2
    , STR_SYSTEM_INFO       IN  Varchar2
    , STR_PARAMETER_INFO    IN  Varchar2
    , INT_PAC_MODIS         IN  NUMBER
    , INT_PAC_MODLA         IN  NUMBER
    , INT_PAC_MODIW         IN  NUMBER
    , INT_PAC_MODSYS        IN  NUMBER
    , INT_PAC_MODCUC        IN  NUMBER
    , INT_ErrNumber         OUT  NUMBER
    , STR_ErrDesc           OUT  VARCHAR2
) is  --  023SO

    l_staj_id           varchar2(10);
    l_RecordsAffected   number(8);
    l_ReturnStatus      number;
    l_err_number        number;
    l_err_desc          varchar2(4000);

BEGIN

    l_staj_id := GenerateUniqueKey('G');
    insert into STA_JOB (
         STAJ_ID
        ,STAJ_PACID
        ,STAJ_PARENTID
        ,STAJ_ESID
        ,STAJ_ETID
        ,STAJ_INFO
        ,STAJ_DATESTA
        ,STAJ_DATECRE
        ,STAJ_ACIDCRE
        ,STAJ_CHNGCNT
        ,STAJ_PERIODID
        ,STAJ_NOTIFICATION
        ,STAJ_NOTSENDATT
    ) values (
          l_staj_id
        , STR_PAC_ID
        , '0'
        , 'A'
        , 'XLS'
        , SUBSTR(STR_COMMENT || CHR(10) || STR_SYSTEM_INFO || CHR(10) || STR_PARAMETER_INFO,1,2000) --  024SO
        , sysdate
        , sysdate
        , STR_ACID
        , 0
        , NULL
        , 0
        , 0
    );
    insert into STA_JOBPARAM (
         STAJP_ID
        ,STAJP_JOBID
        ,STAJP_NAME
        ,STAJP_VALUE
    ) values (
          GenerateUniqueKey('G')
        , l_staj_id
        , '[DATEFROM]'
        , to_char(DAT_FROM,'dd.mm.yyyy hh24:mi:ss')
    );
    insert into STA_JOBPARAM (
         STAJP_ID
        ,STAJP_JOBID
        ,STAJP_NAME
        ,STAJP_VALUE
    ) values (
          GenerateUniqueKey('G')
        , l_staj_id
        , '[DATETO]'
        , to_char(DAT_TO,'dd.mm.yyyy hh24:mi:ss')
    );
    insert into STA_JOBPARAM (
         STAJP_ID
        ,STAJP_JOBID
        ,STAJP_NAME
        ,STAJP_VALUE
    ) values (
          GenerateUniqueKey('G')
        , l_staj_id
        , '[OPT_PARAM]'
        , NVL(STR_OPT_PARAM,STR_PARAMETER_INFO)
    );
    PKG_STATS.SP_NEW_STA_JOBSQLS (
        l_staj_id,
        l_RecordsAffected,
        l_err_number,
        l_err_desc,
        l_ReturnStatus
    );

END;

END;
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- PKG_BDETAIL_COMMON  (Package Body) 
--
CREATE OR REPLACE PACKAGE BODY SBS1_ADMIN.PKG_BDETAIL_COMMON
IS
--
--
--  Purpose: Common routines for SBS input and output converters
--
--MODIFICATION HISTORY (for details see VSS repository)
--Person    Date        Comments
--SO        06.06.2001  Created from earlier versions (SBS phase 4)
--001AA     01.12.2003  SP_INSERT_HIHEADER moved to PKG_MEC
--002SO     02.12.2003  SP_IS_NUMERIC: returns 0 now for FALSE
--003SO     02.12.2003  Add SP_GET_NEXT_PAC_SEQ
--004SO     02.12.2003  SP_GET_NEXT_PAC_SEQ returns formatted sequence with leading zeroes now
--005SO     02.12.2003  SP_GET_NEXT_PAC_SEQ improved
--006AA     22.12.2003  Added overloaded prodecures for SP_INSERT_BIHEADER & SP_INSERT_BOHEADER
--007AA     27.01.2004  Check for null values in function SP_IS_NUMERIC
--008AH     12.08.2004  Fetch new BOHEADER ID
--009SO     30.05.2005  Add SP_UPDATE_DLS_DATES
--010SO     19.07.2005  Change sunday day numbering value to 7 (corresponding to european numbering)
--011SO     09.10.2006  Add Types for MBBulk processing
--012SO     13.09.2007  Add Types for STAN (St.Anton) processing
--013SO     25.01.2008  Exclude SIS Access Procedures from SP_COMPILE_ALL
--014SO     08.03.2009  Add procedure SP_UPDATE_BOHEADER
--015SO     19.03.2009  Correct return values in SP_UPDATE_BOHEADER_xxxx
--016SO     23.03.2009  Use autonomous transaction for insert of BIHEADER and BOHEADER
--017SO     23.03.2009  Clip warning messages to 2000 characters
--018SO     24.03.2009  Revoke autonomous transaction
--019DA     29.06.2009  Truncate warning string to 4000 characters
--020SO     27.10.2009  Implement isTimeForMapping, isTimeForPacking
--021SO     27.10.2009  Generate missing Unique Key in InsertBiHeader, InsertBoHeader
--022SO     27.10.2009  Treat spaces as FALSE
--023SO     27.10.2009  Implement getTypeForMapping, getTypeForPacking
--024SO     31.10.2009  Remove SrcType para for new MEC, evaluate from Mapping Table
--025SO     31.10.2009  Add Thread Id parameter for new MEC
--026SO     02.10.2009  Change RetrurnStatus to OUT for Insert Header methods
--027SO     02.10.2009  Implement getSrcTypeForMapping
--028SO     02.10.2009  Implement getSrcTypeForBiHeader
--029SO     05.10.2009  Map SourceType to MappingID for Xpioc Header insert
--030SO     06.10.2009  Name current procedure for Mec 1.2.x to SP_INSERT_BIHEADER_MEC
--031SO     09.10.2009  Use previous implementation in PKG_BDETAIL_COMMON for old signatures
--032SO     14.12.2011  Remove schema qualifier "S B S 0 ."
--033SO     21.07.2016  Remove SP_COMPILE_ALL
--034SO     07.12.2016  Correct bad formula for DLS dates in leap years


Function getSrcTypeForBiHeader
(
    p_BIH_ID   IN varchar2
)
Return VARCHAR2
is  --028SO
    l_result VARCHAR2(10);
BEGIN

    SELECT  BIH_SRCTYPE INTO l_result
    FROM    BIHEADER
    WHERE   BIH_ID = p_BIH_ID
    ;
    Return l_result;

END;


Function getSrcTypeForMapping
(
    p_BIH_MAPID   IN varchar2
)
Return VARCHAR2
is  --027SO
    l_result VARCHAR2(10);
BEGIN

    SELECT  MAP_SRCTID INTO l_result
    FROM    MAPPING
    WHERE   MAP_ID = p_BIH_MAPID
    ;
    Return l_result;

END;

Function getTypeForMapping
(
    p_BIH_MAPID   IN varchar2
)
Return VARCHAR2
is  --023SO
    l_result VARCHAR2(10);
BEGIN

    SELECT  MAP_ETID INTO l_result
    FROM    MAPPING
    WHERE   MAP_ID = p_BIH_MAPID
    ;
    Return l_result;

END;

Function getTypeForPacking
(
    p_BIH_PACID   IN varchar2
)
Return VARCHAR2
is  --023SO
    l_result VARCHAR2(10);
BEGIN

    SELECT  PAC_ETID INTO l_result
    FROM    PACKING
    WHERE   PAC_ID = p_BIH_PACID
    ;
    Return l_result;

END;


Function isTimeForMapping
(
    p_BIH_MAPID   IN varchar2
)
Return integer
is  --020SO

    Cursor cInconvenientTime Is
    SELECT
            MAP_EXECUTE,
            MAP_CONDITIONALEXEC
    FROM    MAPPING
    WHERE   MAP_ID = p_BIH_MAPID
    ;       --020SO
    cInconvenientTimeRow cInconvenientTime%RowType;

    Type tCurDef is ref cursor;
    cvCurVar tCurDef;
    l_sql   VARCHAR2(4000);
    bGo boolean;
    vGo varchar2(4000);

BEGIN
    bGo := false;
    -- Check if this is a convenient time for processing
    For cInconvenientTimeRow in cInconvenientTime loop
        if cInconvenientTimeRow.MAP_EXECUTE = 1 then
            if cInconvenientTimeRow.MAP_CONDITIONALEXEC IS NULL then
                bGO := true; --024SO
            else
                if SUBSTR(UPPER(cInconvenientTimeRow.MAP_CONDITIONALEXEC),1,6) = 'SELECT' then
                    -- must check a condition sql
                    l_sql := cInconvenientTimeRow.MAP_CONDITIONALEXEC;
                else
                    -- condition view or table name given
                    l_sql := 'SELECT  * FROM ' || cInconvenientTimeRow.MAP_CONDITIONALEXEC;
                end if;

                open cvCurVar for l_sql;
                fetch cvCurVar into vGo;    -- ignore result
                bGo := cvCurVar%FOUND;      -- any result is a GO
                if bGO then
                    if UPPER(NVL(TRIM(vGO),'FALSE')) IN ('FALSE','0','NO') then --022SO
                        bGO := false;       -- execpt if it is 0 or false or no
                    end if;
                end if;
                close cvCurVar;
            end if;
        end if;
    end loop;

    if bGo then
        Return 1;
    else
        Return 0;
    end if;
END;


Function isTimeForPacking
(
    p_BIH_PACID   IN varchar2
)
Return integer
is  --020SO

    Cursor cInconvenientTime Is
    SELECT
            PAC_EXECUTE,
            PAC_CONDITIONALEXEC
    FROM    PACKING
    WHERE   PAC_ID = p_BIH_PACID
    ;       --020SO
    cInconvenientTimeRow cInconvenientTime%RowType;

    Type tCurDef is ref cursor;
    cvCurVar tCurDef;
    l_sql   VARCHAR2(4000);
    bGo boolean;
    vGo varchar2(4000);

BEGIN
    bGo := false;
    -- Check if this is a convenient time for processing
    For cInconvenientTimeRow in cInconvenientTime loop
        if cInconvenientTimeRow.PAC_EXECUTE = 1 then
            if cInconvenientTimeRow.PAC_CONDITIONALEXEC IS NULL then
                bGO := true; --024SO
            else
                if SUBSTR(UPPER(cInconvenientTimeRow.PAC_CONDITIONALEXEC),1,6) = 'SELECT' then
                    -- must check a condition sql
                    l_sql := cInconvenientTimeRow.PAC_CONDITIONALEXEC;
                else
                    -- condition view or table name given
                    l_sql := 'SELECT  * FROM ' || cInconvenientTimeRow.PAC_CONDITIONALEXEC;
                end if;

                open cvCurVar for l_sql;
                fetch cvCurVar into vGo;    -- ignore result
                bGo := cvCurVar%FOUND;      -- any result is a GO
                if bGO then
                    if UPPER(NVL(TRIM(vGO),'FALSE')) IN ('FALSE','0','NO') then --022SO
                        bGO := false;       -- execpt if it is 0 or false or no
                    end if;
                end if;
                close cvCurVar;
            end if;
        end if;
    end loop;

    if bGo then
        Return 1;
    else
        Return 0;
    end if;
END;


Procedure SP_UPDATE_DLS_DATES
(
  p_PACT_ID       In      Varchar2,
  p_BOH_ID        In      Varchar2,
  RecordsAffected Out     Number,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  ReturnStatus    In Out  Number
)
Is
--
-- Purpose: Update begin- and end-dates of daylight saving time (summer-time) in
--          table SYSPARAMETERS.
--          These dates are replicated to the instance and used there for
--          calculating UTC offset values and for converting UTC time to local time.
--          Based on Swiss federal Law SR 941.299.1 Art. 2 Beginn und Ende (Sommerzeitverordnung)

-- Modification History
-- Person       Date        Comments
-- ------   --------    -------------------------------------------
--009SO     30.05.2005  Add SP_UPDATE_DLS_DATES
--034SO     07.12.2016  Correct bad formula for DLS dates in leap years

  l_RecordsAffected         Number;
  l_DateStart               Date;
  l_DateEnd                 Date;
  l_SundayWeekdayCode       CHAR(1) := '7';     --010SO

Begin

    l_RecordsAffected := 0;

    SELECT SYS_DLSSTART into l_DateStart
    FROM SYSPARAMETERS
    ;

    -- Switch to summer time on last sunday in March 02:00
    -- New Year + 3 months - 1 day = 31 st of March                             --025SO
    l_DateStart := add_months(trunc(sysdate,'YEAR'),3)  - 1 + 2/24;             --025SO
    while to_char(l_DateStart,'D') <> l_SundayWeekdayCode
    loop
        l_DateStart := l_DateStart -1;
    end loop;

    -- Switch back to winter time on last sunday in october 03:00
    -- New Year + 10 months - 1 day = 31 st of October                          --025SO
    l_DateEnd := add_months(trunc(sysdate,'YEAR'),10) - 1 + 3/24;               --025SO
    while to_char(l_DateEnd,'D') <> l_SundayWeekdayCode
    loop
        l_DateEnd := l_DateEnd -1;
    end loop;

    UPDATE SYSPARAMETERS SET
    SYS_DLSSTART = l_DateStart,
    SYS_DLSEND = l_DateEnd
    ;

    RecordsAffected := 1;
    ReturnStatus := 1;
    Return;

Exception
  When Others Then
    ErrorCode := SqlCode;
    ErrorMsg  := SqlErrM;
    ReturnStatus := 0;
    RecordsAffected := 0;
    Rollback;

End; -- Procedure SP_UPDATE_DLS_DATES


  procedure FETCH_NEW_BOHEADER
    ( p_Type in char DEFAULT 'G',
        p_BOH_ID in out varchar2,
        p_Filename in varchar2,
        p_Pacid in varchar2,
    ReturnStatus IN OUT number)

    is

    ErrorCode number;
    ErrorMsg varchar2(2000);

  ERROR_HEADER_INSERT Exception;

    begin

         ReturnStatus := 1;

     -- Get a unique key here
     p_BOH_ID := GenerateUniqueKey(upper(p_Type));

     -- Create a BO Header entry
     Pkg_Bdetail_Common.Sp_Insert_Boheader(
        p_BOH_ID,
        0,
        0,
        p_Filename,
        p_Pacid,
        ErrorCode,
        ErrorMsg,
        ReturnStatus
     );

     If (ReturnStatus <> 1) Then
        Raise ERROR_HEADER_INSERT;  -- Error inserting into BOHEADER table
     End If;

    exception

        When ERROR_HEADER_INSERT Then
          p_BOH_ID := null;
          ErrorCode := 150;
          ErrorMsg := 'Error trying to insert BOHEADER in '|| p_Filename;
          ReturnStatus := 0;

        When others Then
                p_BOH_ID := null;
          ErrorCode := SQLCODE;
          ErrorMsg := SQLERRM;
          ReturnStatus := 0;

    end; --FETCH_NEW_BOHEADER


    procedure INSERT_WARNING
  (  p_W_APPLIC      IN varchar2,
     p_W_PROCEDURE   IN varchar2,
     p_W_TOPIC       IN varchar2,
     p_W_MESSAGE     IN varchar2,
     p_W_USERERRCODE IN varchar2 DEFAULT NULL,
     p_W_BIHID       IN varchar2 DEFAULT NULL,
     p_W_BOHID       IN varchar2 DEFAULT NULL,
     p_W_BDID        IN varchar2 DEFAULT NULL,
     p_W_SHORTID     IN varchar2 DEFAULT NULL)


  IS

  PRAGMA AUTONOMOUS_TRANSACTION;

  Begin
  Insert into Warning
  (  W_ID, W_DATETIME,W_APPLIC,W_TOPIC,W_PROCEDURE,W_MESSAGE,W_ERRORTIME,W_BIHID,W_BOHID, W_BDID, W_SHORTID,
  W_ERRORCODE )
  Values
  (  GenerateUniqueKey('G'), SYSDATE, p_W_APPLIC, p_W_TOPIC, p_W_PROCEDURE, p_W_MESSAGE,SYSDATE,
     p_W_BIHID, p_W_BOHID, p_W_BDID, p_W_SHORTID, p_W_USERERRCODE);

  commit;

  Exception
  When Others then
    null;
  END INSERT_WARNING;
------------------------------------------------------------------
procedure SP_INSERT_WARNING
(  p_W_APPLIC      IN varchar2,
   p_W_PROCEDURE   IN varchar2,
   p_W_TOPIC       IN varchar2,
   p_W_MESSAGE     IN varchar2,
   p_W_BIHID       IN varchar2,
   p_W_BOHID       IN varchar2,
   p_W_BDID        IN varchar2,
   p_W_SHORTID     IN varchar2,
   ErrorCode       OUT number,
   ErrorMsg        OUT varchar2,
   ReturnStatus    IN OUT number)
IS

PRAGMA AUTONOMOUS_TRANSACTION;

Begin
    Insert into Warning
    (  W_ID,
       W_DATETIME,
       W_APPLIC,
       W_TOPIC,
       W_PROCEDURE,
       W_MESSAGE,
       W_ERRORTIME,
       W_BIHID,
       W_BOHID,
       W_BDID,
       W_SHORTID
    )
    Values
    (  GenerateUniqueKey('G'),
       SYSDATE,
       p_W_APPLIC,
       p_W_TOPIC,
       p_W_PROCEDURE,
       SUBSTR(p_W_MESSAGE,1,4000),      --017SO--019DA
       SYSDATE,
       p_W_BIHID,
       p_W_BOHID,
       p_W_BDID,
       p_W_SHORTID
    );

    commit;

    Returnstatus := 1;

Exception
When Others then
   ErrorCode := SQLCODE;
   ErrorMsg  := SQLERRM;
   ReturnStatus := 0;

END SP_INSERT_WARNING;


procedure SP_INSERT_WARNING
(  p_W_APPLIC      IN varchar2,
   p_W_PROCEDURE   IN varchar2,
   p_W_TOPIC       IN varchar2,
   p_W_MESSAGE     IN varchar2,
   p_W_BIHID       IN varchar2,
   p_W_BOHID       IN varchar2,
   p_W_BDID        IN varchar2,
   p_W_SHORTID     IN varchar2)
IS

PRAGMA AUTONOMOUS_TRANSACTION;

Begin
    Insert into Warning
    (  W_ID,
       W_DATETIME,
       W_APPLIC,
       W_TOPIC,
       W_PROCEDURE,
       W_MESSAGE,
       W_ERRORTIME,
       W_BIHID,
       W_BOHID,
       W_BDID,
       W_SHORTID
    )
    Values
    (  GenerateUniqueKey('G'),
       SYSDATE,
       p_W_APPLIC,
       p_W_TOPIC,
       p_W_PROCEDURE,
       SUBSTR(p_W_MESSAGE,1,4000),      --017SO--019DA
       SYSDATE,
       p_W_BIHID,
       p_W_BOHID,
       p_W_BDID,
       p_W_SHORTID
    );

    commit;

Exception
When Others then
   null;

END SP_INSERT_WARNING;


Procedure SP_INSERT_BIHEADER_MEC (
    p_BIH_ID            In Out  Varchar2,
    p_BIH_DEMO          In      Number,
    p_BIH_FILESEQ       In      Number,
    p_BIH_FILENAME      In      Varchar2,
    p_BIH_FILEDATE      In      Varchar2,
    p_BIH_MAPID         In      Varchar2,
    p_AppName           In      Varchar2,
    p_AppVer            In      Varchar2,
    p_Thread            IN      Varchar2,                                       --025SO
    p_JobId             In      Number,
    p_HostName          In      Varchar2,
    P_Status            In      Varchar,
    ErrorCode           Out     Number,
    ErrorMsg            Out     Varchar2,
    ReturnStatus        Out     Number              --026SO
    )
Is  --030SO
Begin

    if isTimeForMapping(p_BIH_MAPID) = 1 then

        if p_BIH_ID IS NULL then
           p_BIH_ID := GenerateUniqueKey('G');      --021SO
        end if;

        Insert into BIHeader (
            BIH_ID ,
            BIH_SRCTYPE,
            BIH_DEMO,
            BIH_FILESEQ,
            BIH_DATETIME,
            BIH_FILENAME,
            BIH_FILEDATE,
            BIH_MAPID,
            BIH_EXE,
            BIH_VERSION,
            BIH_THREAD,                                                         --025SO
            BIH_JOB,
            BIH_HOST,
            BIH_START,
            BIH_ESID
        )
        ( SELECT
            p_BIH_ID,
            MAP_SRCTID,
            p_BIH_DEMO,
            p_BIH_FILESEQ,
            SYSDATE,
            p_BIH_FILENAME,
            to_date(p_BIH_FILEDATE, 'YYYY-MM-DD HH24:MI:SS'),
            p_BIH_MAPID,
            p_AppName,
            p_AppVer,                                                           --025SO
            p_Thread,
            p_JobId,
            p_HostName,
            SYSDATE,
            'MAP'
          FROM MAPPING WHERE MAP_ID = p_BIH_MAPID
        );
        Returnstatus := 1;
    else
        Returnstatus := 2;
    end if;

    Return;
Exception
    When Others then
        ErrorCode := SQLCODE;
        ErrorMsg  := SQLERRM;
        ReturnStatus := 0;
END SP_INSERT_BIHEADER_MEC;


procedure SP_INSERT_BIHEADER
( p_BIH_ID    IN varchar2,
  p_BIH_SRCTYPE   IN varchar2,
  p_BIH_DEMO    IN number,
  p_BIH_FILESEQ IN number,
  p_BIH_FILENAME  IN varchar2,
  p_BIH_FILEDATE  IN varchar2,
  p_BIH_MAPID   IN varchar2,
  P_Status    IN varchar,
  ErrorCode     OUT number,
  ErrorMsg      OUT varchar2,
  ReturnStatus      IN OUT number)
Is  --031SO
Begin
    Insert into BIHeader (
        BIH_ID ,
        BIH_SRCTYPE,
        BIH_DEMO,
        BIH_FILESEQ,
        BIH_DATETIME,
        BIH_FILENAME,
        BIH_FILEDATE,
        BIH_MAPID,
        BIH_START,
        BIH_ESID
    )
    Values (
        p_BIH_ID,
        p_BIH_SRCTYPE,
        p_BIH_DEMO,
        p_BIH_FILESEQ,
        SYSDATE,
        p_BIH_FILENAME,
        to_date(p_BIH_FILEDATE, 'YYYY-MM-DD HH24:MI:SS'),
        p_BIH_MAPID,
        SYSDATE,
        'MAP'
    );
    -- commit;    -- $$$
    Returnstatus := 1;
Return;
Exception
    When Others then
        ErrorCode := SQLCODE;
        ErrorMsg  := SQLERRM;
        ReturnStatus := 0;
END SP_INSERT_BIHEADER;

--006AA
Procedure SP_INSERT_BIHEADER (
    p_BIH_ID            In      Varchar2,
    p_BIH_SRCTYPE       In      Varchar2,
    p_BIH_DEMO          In      Number,
    p_BIH_FILESEQ       In      Number,
    p_BIH_FILENAME      In      Varchar2,
    p_BIH_FILEDATE      In      Varchar2,
    p_BIH_MAPID         In      Varchar2,
    p_AppName           In      Varchar2,
    p_AppVer            In      Varchar2,
    p_JobId             In      Number,
    p_HostName          In      Varchar2,
    P_Status            In      Varchar,
    ErrorCode           Out     Number,
    ErrorMsg            Out     Varchar2,
    ReturnStatus        In Out  Number
)
Is  --031SO
Begin
    Insert into BIHeader (
        BIH_ID ,
        BIH_SRCTYPE,
        BIH_DEMO,
        BIH_FILESEQ,
        BIH_DATETIME,
        BIH_FILENAME,
        BIH_FILEDATE,
        BIH_MAPID,
        BIH_EXE,
        BIH_VERSION,
        BIH_JOB,
        BIH_HOST,
        BIH_START,
        BIH_ESID
    )
    Values (
        p_BIH_ID,
        p_BIH_SRCTYPE,
        p_BIH_DEMO,
        p_BIH_FILESEQ,
        SYSDATE,
        p_BIH_FILENAME,
        to_date(p_BIH_FILEDATE, 'YYYY-MM-DD HH24:MI:SS'),
        p_BIH_MAPID,
        p_AppName,
        p_AppVer,
        p_JobId,
        p_HostName,
        SYSDATE,
        'MAP'
    );
    -- commit;    -- $$$
    Returnstatus := 1;
Return;
Exception
    When Others then
        ErrorCode := SQLCODE;
        ErrorMsg  := SQLERRM;
        ReturnStatus := 0;
END SP_INSERT_BIHEADER;

PROCEDURE SP_UPDATE_BIH_FOR_EMPTY_DETAIL
( p_BIHID         In      Varchar2,
  p_MaxAge        In      Number,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  ReturnStatus    In Out  Number
)
IS
Begin
  Update BIHeader set
    BIH_DATEFC = NULL,
    BIH_DATELC = NULL,
    BIH_RecCount = 0,
    BIH_END = SYSDATE,
    BIH_ESID = 'RDY'
  where BIH_ID = p_BIHID;
  ReturnStatus := 1;
  Return;

Exception

When Others then
      ErrorCode := SQLCODE;
      ErrorMsg  := SQLERRM;
      ReturnStatus := 0;
END SP_UPDATE_BIH_FOR_EMPTY_DETAIL;

Procedure SP_INSERT_BOHEADER_MEC (
    p_BOH_ID            In Out  Varchar2,
    p_BOH_DEMO          In      Number,
    p_BOH_FILESEQ       In      Number,
    p_BOH_FILENAME      In      Varchar2,
    p_BOH_PACKID        In      Varchar2,
    p_AppName           In      Varchar2,
    p_AppVer            In      Varchar2,
    p_Thread            IN      Varchar2,                                       --025SO
    p_JobId             In      Number,
    p_HostName          In      Varchar2,
    ErrorCode           Out     Number,
    ErrorMsg            Out     Varchar2,
    ReturnStatus        Out     Number          --026SO
    )
Is  --030SO

Begin

    if isTimeForPacking(p_BOH_PACKID) = 1 then

        if p_BOH_ID IS NULL then
           p_BOH_ID := GenerateUniqueKey('G');      --021SO
        end if;

        Insert into BOHEADER (
            BOH_ID ,
            BOH_DEMO,
            BOH_FILESEQ,
            BOH_DATETIME,
            BOH_FILENAME,
            BOH_START,
            BOH_ESID,
            BOH_FILEDATE,
            BOH_PACKID,
            BOH_EXE,
            BOH_VERSION,
            BOH_THREAD,                                                         --025SO
            BOH_JOB,
            BOH_HOST
        )
        Values (
            p_BOH_ID ,
            p_BOH_DEMO,
            p_BOH_FILESEQ,
            SYSDATE,
            p_BOH_FILENAME,
            SYSDATE,
            'PAC',
            SYSDATE,
            p_BOH_PACKID,
            p_AppName,
            p_AppVer,
            p_Thread,                                                           --025SO
            p_JobId,
            p_HostName
        );
        Returnstatus := 1;
    else
        Returnstatus := 2;
    end if;
    Return;
Exception
    When Others then
        ErrorCode := SqlCode;
        ErrorMsg  := SqlErrm;
        ReturnStatus := 0;
End SP_INSERT_BOHEADER_MEC;



--006AA
Procedure SP_INSERT_BOHEADER (
    p_BOH_ID            In      Varchar2,
    p_BOH_DEMO          In      Number,
    p_BOH_FILESEQ       In      Number,
    p_BOH_FILENAME      In      Varchar2,
    p_BOH_PACKID        In      Varchar2,
    p_AppName           In      Varchar2,
    p_AppVer            In      Varchar2,
    p_JobId             In      Number,
    p_HostName          In      Varchar2,
    ErrorCode           Out     Number,
    ErrorMsg            Out     Varchar2,
    ReturnStatus        In Out  Number
)
Is
Begin
    Insert into BOHEADER (
        BOH_ID ,
        BOH_DEMO,
        BOH_FILESEQ,
        BOH_DATETIME,
        BOH_FILENAME,
        BOH_START,
        BOH_ESID,
        BOH_FILEDATE,
        BOH_PACKID,
        BOH_EXE,
        BOH_VERSION,
        BOH_JOB,
        BOH_HOST
    )
    Values (
        p_BOH_ID ,
        p_BOH_DEMO,
        p_BOH_FILESEQ,
        SYSDATE,
        p_BOH_FILENAME,
        SYSDATE,
        'PAC',
        SYSDATE,
        p_BOH_PACKID,
        p_AppName,
        p_AppVer,
        p_JobId,
        p_HostName
    );
    -- commit; -- $$
    Returnstatus := 1;
    Return;
Exception
    When Others then
        ErrorCode := SqlCode;
        ErrorMsg  := SqlErrm;
        ReturnStatus := 0;
End SP_INSERT_BOHEADER;


procedure SP_INSERT_BOHEADER
( p_BOH_ID    IN varchar2,
  p_BOH_DEMO    IN number,
  p_BOH_FILESEQ IN number,
  p_BOH_FILENAME  IN varchar2,
  p_BOH_PACKID    IN varchar2,
  ErrorCode     OUT number,
  ErrorMsg      OUT varchar2,
  ReturnStatus      IN OUT number)
IS  --031SO
Begin
    Insert into BOHeader(
      BOH_ID ,
      BOH_DEMO,
      BOH_FILESEQ,
      BOH_DATETIME,
      BOH_FILENAME,
      BOH_START,
      BOH_ESID,
      BOH_FILEDATE,
      BOH_PACKID
    ) Values (
      p_BOH_ID ,
      p_BOH_DEMO,
      p_BOH_FILESEQ,
      SYSDATE,
      p_BOH_FILENAME,
      SYSDATE,
      'PAC',
      SYSDATE,
      p_BOH_PACKID
    );
      -- commit; -- $$
    Returnstatus := 1;
    Return;
Exception
When Others then
  ErrorCode := SQLCODE;
  ErrorMsg  := SQLERRM;
  ReturnStatus := 0;
END SP_INSERT_BOHEADER;

procedure SP_UPDATE_BOHEADER
( p_bohid         In      Varchar2,
  p_status        In      Varchar2,
  p_count         In      Number,
  p_DateFc        In      Date,
  p_DateLc        In      Date,
  p_MaxAge        In      Number
)   --014SO
IS  --031SO
   x_packid    varchar2(10);
   x_fileseqmax  number;
   x_nextseq   number;
Begin
    If p_status = 'S' then /*--- conversion was successful ---- */
      Begin
           /**** Update Header Fields ********/

           Update Boheader set
              boh_RecCount = p_count,
              BOH_DATEFC = p_DateFc,
              BOH_DATELC = p_DateLc,
              boh_end = sysdate,
              boh_esid = 'OK',
              boh_filename = REPLACE(boh_filename,'Temp-','')
           where boh_id = p_bohid;

      End;
    Else /*---- file error encountered ----*/
      Begin
           Update Boheader set
              boh_end = sysdate,
              boh_esid = 'PAE'
           where boh_id = p_bohid;
      End;
    End if;

    select boh_packid into x_packid
    from boheader where boh_id = p_bohid;

    select pac_fileseqmax, pac_nextseq into x_fileseqmax, x_nextseq
    from packing where pac_id  = x_packid;

    If x_fileseqmax = x_nextseq then /*** need to recycle ***/
       x_nextseq := 1;
    else
       x_nextseq := x_nextseq + 1;
    end if;

    update packing set
      pac_nextseq = x_nextseq
    where pac_id = x_packid;

    Return;

END SP_UPDATE_BOHEADER;


procedure SP_UPDATE_BOHEADER
( p_bohid         In      Varchar2,
  p_status        In      Varchar2,
  p_count         In      Number,
  p_DateFc        In      Date,
  p_DateLc        In      Date,
  p_MaxAge        In      Number,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  ReturnStatus    In Out  Number
)   --014SO
IS
Begin

    SP_UPDATE_BOHEADER(p_bohid,p_status,p_count,p_DateFc,p_DateLc,p_MaxAge);
    --015SO
    ErrorCode := 0;
    ReturnStatus := 1;
    Return;

Exception
When Others then
   ErrorCode := SQLCODE;
   ErrorMsg  := SQLERRM;
   ReturnStatus := 0;
END SP_UPDATE_BOHEADER;


procedure SP_UPDATE_BOHEADER_NODATA_0
( p_bohid         In      Varchar2,
  p_status        In      Varchar2,
  p_count         In      Number,
  p_MaxAge        In      Number,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  ReturnStatus    In Out  Number
)
IS
Begin

    SP_UPDATE_BOHEADER(p_bohid,p_status,p_count,NULL,NULL,p_MaxAge);
    --015SO
    ErrorCode := 0;
    ReturnStatus := 1;
    Return;

Exception
When Others then
   ErrorCode := SQLCODE;
   ErrorMsg  := SQLERRM;
   ReturnStatus := 0;
END SP_UPDATE_BOHEADER_NODATA_0;

procedure SP_UPDATE_BOHEADER_EXCEL_0
( p_bohid         In     Varchar2,
  p_status        In     Varchar2,
  p_count         In     Number,
  p_MaxAge        In     Number,
  ErrorCode       Out    Number,
  ErrorMsg        Out    Varchar2,
  ReturnStatus    In Out Number
)
IS
Begin

    SP_UPDATE_BOHEADER(p_bohid,p_status,p_count,NULL,NULL,p_MaxAge);
    --015SO
    ErrorCode := 0;
    ReturnStatus := 1;
    Return;

Exception
When Others then
   ErrorCode := SQLCODE;
   ErrorMsg  := SQLERRM;
   ReturnStatus := 0;
END SP_UPDATE_BOHEADER_EXCEL_0;

procedure SP_DELETE_ALL_RECORDS_EXCEL
( p_FileId        In      Varchar2,
  p_JobType       In      Char,
  p_packid        In      Varchar2,
  p_MaxAge        In      Number,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  ReturnStatus    In Out  Number
)
IS
   x_channel number(1);
Begin

  -- nothing to do here

  Returnstatus := 1;
  Return;
Exception
When Others then
  ErrorCode := SQLCODE;
  ErrorMsg  := SQLERRM;
  ReturnStatus := 0;

END SP_DELETE_ALL_RECORDS_EXCEL;

procedure SP_DELETE_ALL_RECORDS_NODTATA
( p_FileId        In      Varchar2,
  p_JobType       In      Char,
  p_packid        In      Varchar2,
  p_MaxAge        In      Number,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  ReturnStatus    In Out  Number
)
IS
   x_channel number(1);
Begin

  -- nothing to do here

  Returnstatus := 1;
  Return;
Exception
When Others then
  ErrorCode := SQLCODE;
  ErrorMsg  := SQLERRM;
  ReturnStatus := 0;

END SP_DELETE_ALL_RECORDS_NODTATA;

procedure SP_ANALYZE_TABLES
(
   p_PACT_ID        IN varchar2,
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT number )
IS
  CURSOR unpart_tables IS SELECT TABLE_NAME FROM USER_TABLES WHERE TABLESPACE_NAME Is Not NULL;
  CURSOR unpart_indexes IS SELECT INDEX_NAME FROM USER_INDEXES WHERE TABLESPACE_NAME Is Not NULL;
  v_cursor  INTEGER;
  v_ddl   VARCHAR2(32000);
  v_dummy   INTEGER;
  v_success INTEGER;
  v_retries INTEGER;
BEGIN

  RecordsAffected := 0;
  ErrorCode := 0;
  ReturnStatus := 1;

  v_success := 0;
  v_retries := 3;

  FOR i IN unpart_tables
  LOOP
    v_success := 0;
    v_retries := 3;
    LOOP
      BEGIN
        v_ddl := 'ANALYZE TABLE ' || i.table_name || ' ESTIMATE STATISTICS SAMPLE 5000000 ROWS ';
        v_cursor := dbms_sql.open_cursor;
        dbms_sql.parse(v_cursor,v_ddl,dbms_sql.native);
        v_dummy := dbms_sql.execute(v_cursor);
        dbms_sql.close_cursor(v_cursor);
        v_success := 1;
        RecordsAffected := RecordsAffected + 1;
      EXCEPTION
        WHEN OTHERS THEN
          dbms_sql.close_cursor(v_cursor);
        sys.dbms_lock.sleep(10);
      END;
      EXIT WHEN v_success = 1;
      v_retries := v_retries -1;
      EXIT WHEN v_retries = 0;
    END LOOP;
    IF v_success = 0 then
      ErrorCode := 10012;
      ReturnStatus := 0;
    END IF;
  END LOOP;


  FOR i IN unpart_indexes
  LOOP
    v_success := 0;
    v_retries := 3;
    LOOP
      BEGIN
        v_ddl := 'ANALYZE INDEX ' || i.index_name ||  ' COMPUTE STATISTICS ';
        v_cursor := dbms_sql.open_cursor;
        dbms_sql.parse(v_cursor,v_ddl,dbms_sql.native);
        v_dummy := dbms_sql.execute(v_cursor);
        dbms_sql.close_cursor(v_cursor);
        v_success := 1;
        RecordsAffected := RecordsAffected + 1;
      EXCEPTION
        WHEN OTHERS THEN
          dbms_sql.close_cursor(v_cursor);
        sys.dbms_lock.sleep(10);
      END;
      EXIT WHEN v_success = 1;
      v_retries := v_retries -1;
      EXIT WHEN v_retries = 0;
    END LOOP;
    IF v_success = 0 then
      ErrorCode := 10012;
      ReturnStatus := 0;
    END IF;
  END LOOP;

  Return;

Exception
  When Others then
    ErrorCode := SQLCODE;
    ErrorMsg  := SQLERRM;
    ReturnStatus := 0;

END SP_ANALYZE_TABLES;

    Function SP_IS_NUMERIC (
        p_InputValue    In              Varchar2
    )
    Return Number
    Is
        l_Dummy         Number;
    Begin
        If (p_InputValue Is Not Null) Then
            l_Dummy := To_Number(p_InputValue);     -- will raise an exception if non-numeric
            Return 1;       -- it is a number
        Else
            Return 0;       --007AA return 0 if null value
        End If;
    Exception
    When Others Then
        Return 0;           -- it is not a number  --002SO
    End SP_IS_NUMERIC;

    Procedure SP_GET_NEXT_PAC_SEQ(
        p_PACID                     In      Varchar2,
        p_NextSequence              Out     Varchar2,
        p_ErrorCode                 Out     Number,
        p_ErrorMsg                  Out     Varchar2,
        p_ReturnStatus              In Out  Number
    ) IS

    Cursor cPackingSequence Is
        SELECT
            PAC_ID,
            PAC_FILESEQMAX,
            PAC_NEXTSEQ
        FROM
            PACKING
        WHERE
            PAC_ID = p_PACID
        For Update Of PAC_NEXTSEQ
    ;
    cPackingSequenceRow         cPackingSequence%RowType;

    l_NextSequence      Number;
    l_FormatMask        Number;

    BEGIN

        Open cPackingSequence;
        Fetch cPackingSequence Into cPackingSequenceRow;
        If cPackingSequence%Found Then
            l_NextSequence := cPackingSequenceRow.PAC_NEXTSEQ;
            l_NextSequence := Mod( l_NextSequence, cPackingSequenceRow.PAC_FILESEQMAX + 1);
            p_NextSequence :=  trim(to_char( l_NextSequence ,replace(trim(to_char(cPackingSequenceRow.PAC_FILESEQMAX)),'9','0')));
            l_NextSequence := l_NextSequence + 1;
            if l_NextSequence > cPackingSequenceRow.PAC_FILESEQMAX then
                l_NextSequence := 1;
            end if;
            Update PACKING Set
                PAC_NEXTSEQ = l_NextSequence
            Where Current Of cPackingSequence;

        end if;
        Close cPackingSequence;

        p_ErrorCode := NULL;
        p_ErrorMsg := NULL;
        p_Returnstatus := 1;
        Return;

    Exception
        When Others then
            p_ErrorCode := SQLCODE;
            p_ErrorMsg  := SQLERRM;
            p_ReturnStatus := 0;

    END SP_GET_NEXT_PAC_SEQ;

--------------------------------------------------------------------------------
-- Name:          SP_DB_SLEEP
-- Purpose:       Calls the Sleep procedure to make the connection sleep for
--                given number of seconds (used in concurrency testing)
-- ReturnStatus:  0/1 For success/failure
-- Author:        A. Ahmed
-- LastUpdate:    28.08.2003 /GW (adapted from WBP-Database)
--------------------------------------------------------------------------------
Procedure SP_DB_SLEEP
(  p_PACT_ID        IN varchar2,
   p_BOH_ID         IN OUT varchar2,

   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT varchar2
)

Is
Begin

  Dbms_Lock.Sleep(10);

  RecordsAffected:=0;
  ErrorCode:=0;
  ErrorMsg:=null;
  Returnstatus := 1;

Return;
Exception
When Others then

  RecordsAffected:=0;
  ErrorCode := SqlCode;
  ErrorMsg  := SqlErrm;
  ReturnStatus := 0;

End SP_DB_SLEEP;

END; -- Package Body PKG_BDETAIL_COMMON
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- PKG_BDETAIL_INFO  (Package Body) 
--
CREATE OR REPLACE PACKAGE BODY SBS1_ADMIN.PKG_BDETAIL_INFO as

--
--  Purpose: Routines for info service CDR input and output converters
--
--  MODIFICATION HISTORY (for details see VSS repository)
--  Person      Date        Comments
--  SO          06.06.2001  Created from earlier versions (SBS phase 4)
--  002AA       17.02.2003  Added partition creation for BDITEM table after that of BDETAIL table (in SP_ADD_INFO_PARTITIONS, SP_ADD_INFO_PARTITIONS_MAN)
--  003SO       20.02.2003  Corrected override of error flags in SP_CONS_IS exception handler
--  004AA       26.02.2003  Added BDITEM table in Cursor selection criteria for processing Indexes belonging to BDITEM table along with those of BDETAIL table
--  005AA       26.02.2003  Analyze the BDITEM table after analyzing the BDETAIL table
--  006AA       27.03.2003  Add partition handling for BDETAIL9 (AAA-UFIH) table (also includes indexes updating and table analyzing)
--  007AA       18.06.2003  Add Price Model Version State checking to Price Model lookup criteria
--  008SO       23.09.2003  Use SP_UPDATE_TOPSTOP as centralized update mechanism for all ICs
--  009SO       23-09.2003  Streamline SP_UPDATE_BIHEADER_INFO, reducing BDETAIL scans
--  010SO       31.03.2004  Suppress Output after CutoffDate April 1st
--  011SO       07.06.2004  Replace MMS Traffic consolidation in SP_CONS_TR
--  012SO       21.06.2004  Prioritize SMS over MMS in SP_CONS_TR for SMS La
--  013SO       21.06.2004  Prioritize MMS over SMS in SP_CONS_TR for MMS La
--  014AH       14.07.2004  Hack Red CODE (Billtext Patching for SERVICE = '9733')
--  015SO       03.09.2004  Desupport IC functions and and remove unnecessary references to PKG_AAA
--  016SO       13.06.2005  Synchronize-Funktion f?r DuoBill lookup table
--  017SO       14.06.2005  FlatFile Import Procedure SP_INSERT_ADBC for Duobill Customer MSISDN und IMSI Lookup Table
--  018AA       20.06.2005  Added SP_UPDATE_BIHEADER_ADBC for updating Biheader for Duobill import (ALL_DUO_BILL_CUST)
--  019AA       20.06.2005  Added SP_CLEAR_ADBC for clearing up the ALL_DUO_BILL_CUST table before Duobill import
--  020AA       20.06.2005  Updated SP_INSERT_ADBC stored proc for importing Duobill flat file (ALL_DUO_BILL_CUST)
--  021SO       05.07.2005  Implement DuoBill mapping table transfer in SP_SYNC_DUO_BILL_CUST
--  022SO       06.07.2005  Implement DuoBill config table read
--  023SO       06.07.2005  Change DuoBill checking for numberranges
--  024SO       10.11.2005  Loosen validation for DuoBill DuoCard support (duplicate virtual MSISDN and IMSI allowed)
--  025SO       10.11.2005  Loosen validation for DuoBill DuoCard support (410... dummy MSISDNs allowed)
--  026SO       18.11.2005  Allow for TFL DuoBill Customers in DouBill Lookup Provisioning
--  027SO       18.11.2005  Aggregate content consolidation for contracts using too many billtexts
--  028SO       18.11.2005  Remove Hack 014AH (pure numeric BillTexts for ShortId 9733
--  029SO       18.11.2005  Aggregate content per MSISDN consolidation for contracts using too many billtexts
--  030SO       21.11.2005  Use period id for IS consolidation (simplifies re-consolidating older periods)
--  031SO       21.11.2005  Correct AutoFix Insert statement
--  032SO       21.11.2005  Use period id for Cursor in SP_CONS_IS_MSISDN
--  033SO       22.11.2005  Correct AutoFix aggregation SQL in order to allow multiple  consolidations
--  034SO       05.03.2005  Make warning texts stronger when aborting DuoBill Synchronisation.
--  035SO       08.05.2006  Implement separated Transport cost calculation for prepaid/postpaid
--  036SO       16.08.2006  Add period entry by using PKG_BDETAIL_COMMON.SP_INSERT_PERIOD()
--  037SO       02.10.2006  Replace renamed fields: CON_CODE->CON_ESTID, CON_SHORTCODEx->CON_SHORTID
--  038SO       02.10.2006  Add fields to ISCONSOL
--  039SO       17.10.2006  Include MMS Bulk traffic in transport cost calculation
--  040SO       09.11.2006  Correct data field size for service code from 10 to 20
--  041SO       09.11.2006  Correct sorting for transport cost ip contract mapping
--  042SO       29.04.2007  Consolidate BDETAIL including CDR type ID
--  043SO       23.07.2007  Consolidate for MT content only (ignoring MO CDRs) in SP_CONS_MSISDN
--  044SO       03.10.2007  Do not populate ISC_KEYWORD any more in info service consolidation
--  045SO       17.10.2007  Implement partition rollover for REVI tables
--  046SO       22.01.2008  Consolidate VAS Keywords when BillRate is not NULL
--  047SO       22.01.2007  Add IS consolidation fields for new Transport Cost Calculation
--  048SO       22.01.2007  Use IS consolidation for Message Broker Transport Cost Calculation (ISRV)
--  049SO       12.02.2008  Correct Transport Price for MMS
--  050SO       14.02.2008  Correct Transport Cost Lookup for SMS
--  052SO       07.09.2008  Implement partition ageing for REVIPRE - Index Tables
--  053SO       02.04.2009  Implement new billtext aggregation logic using ISC_BILLTEXT_AGR
--  054SO       31.10.2009  Move Period Insert to standalone Procedure
--  055SO       26.08.2010  Rename procedures according to driving Packing-ID
--  056SO       26.08.2010  Remove partition management code (ADD/ANA)
--  057SO       04.02.2011  New consolidation field BD_GART
--  058SO       20.04.2011  New consolidation fields BD_SHOW, BD_CAMPAIGN
--  059SO       14.12.2011  Remove schema qualifier "S B S 0 ."
--  060SO       19.04.2012  Remove procedure SP_CLEAR_ADBC
--  061SO       19.04.2012  Remove procedure SP_INSERT_ADBC
--  062SO       19.04.2012  Remove procedure SP_UPDATE_BIHEADER_ADBC
--  063SO       19.04.2012  Remove procedure SP_CONS_DUOBILLSYN
--  064SO       19.04.2012  Use PKG_COMMON.INSERT_WARNING
--  065SO       15.11.2018  Remove reference to CON_SERVICE

cstrCutoffDateTime  Varchar2(20) := '2004-04-01 00:00:00';                      --  010SO

cbooNonIsrvSmsTc    Boolean := true;  -- set false for neglecting OTA TCs       --  048SO

cbooNonIsrvMmsTc    Boolean := false;  -- set true for evaluation of non MB MMS TCs   --  048SO



procedure SP_CONS_PURGEIPC
(
   p_PAC_ID         IN varchar2,        -- 'PURGEIPC'  Purge IS Contracts (de-activate)
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT number )
IS

Begin

  UPDATE CONTRACT SET CON_ESID='I'
  WHERE CON_ESID = 'A'
  AND CON_ETID = 'IPC'
  AND CON_DATEEND <= TRUNC(SYSDATE,'MONTH')
  AND CON_DATEEND <= TRUNC(SYSDATE)-10
  AND EXISTS (SELECT BOH_ID FROM BOHEADER
              WHERE BOH_DATETIME > TRUNC(sysdate,'MONTH')
              AND BOH_PACKID IN ('TR')
              AND BOH_ESID = 'OK')
  ;

  RecordsAffected := SQL%ROWCOUNT ;
  ErrorCode := 0;
  ReturnStatus := 1;
  Return;

/*
Exception
When Others then
   ErrorCode := SQLCODE;
   ErrorMsg  := SQLERRM;
   ReturnStatus := 0;
   RecordsAffected := 0;
*/

END SP_CONS_PURGEIPC;

-- **********************************************************************************************************************************

procedure SP_CONS_IS
(
   p_PAC_ID         IN varchar2,        -- 'IS'
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT number )
IS

    -- procedure fills up consolidation table ISCONSOL (Info Service Consolidation) with data from bdetail

    v_sep_id        VARCHAR2(6);        -- YYYYMM
BEGIN

    v_sep_id := to_char(ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1),'YYYYMM');        --  027SO

    -- change states of old records
    UPDATE ISCONSOL SET ISC_ESID = 'D'
    WHERE  ISC_SEPID = v_sep_id
    AND ISC_ESID <> 'D'
    ;                                                       --  027SO

    -- insert records into consolidation table
    INSERT INTO ISCONSOL (
      ISC_ID,
      ISC_DATE,
      ISC_SEPID,
      ISC_ESID,
      ISC_SRCTYPE,
      ISC_CONID,
      ISC_CONSTYPE,
      ISC_SHORTID,
      ISC_SERVICE,
      ISC_KEYWORD,                       --  046SO --  044SO
      ISC_BILLTEXT,
      ISC_COUNT,
      ISC_PRICE,
      ISC_AMOUNTCU,
      ISC_RETSHAREPV,
      ISC_RETSHAREMO,
      ISC_PREPAID,
      ISC_REQTYPE,
      ISC_BILLRATE,
      ISC_STYPE,
      ISC_PMVID,
      ISC_BILLINGDOMAIN,                    --  038SO
      ISC_TRANSPORTMEDIUM,                  --  038SO
      ISC_CATEGORY,                         --  038SO
      ISC_CDRTID,                           --  042SO
      ISC_VSPRCID,                          --  047SO
      ISC_COUNTTR,                          --  047SO
      ISC_AMOUNTTR,                         --  047SO
      ISC_BILLTEXT_AGR,                     --  053SO
      ISC_GART,                             --  057SO
      ISC_SHOW,                             --  058SO
      ISC_CAMPAIGN                          --  058SO

    )
    SELECT  /*+ NO_INDEX(BDETAIL) */
      GENERATEUNIQUEKEY('G')    ISC_ID,
      sysdate                   ISC_DATE,
      SEP_ID                    ISC_SEPID,
      'R'                       ISC_ESID,
      BD_SRCTYPE                ISC_SRCTYPE,
      CON_ID                    ISC_CONID,
      CON_ESTID                 ISC_CONSTYPE,               --  037SO
      BD_SHORTID                ISC_SHORTID,
      BD_SERVICE                ISC_SERVICE,
      DECODE(BD_BILLRATE,NULL,NULL,BD_KEYWORD) ISC_KEYWORD, --  046SO --  044SO
      BD_BILLTEXT               ISC_BILLTEXT,
      COUNT(BDETAIL.ROWID)      ISC_COUNT,
      BD_AMOUNTCU               ISC_PRICE,
      SUM(BD_AMOUNTCU)          ISC_AMOUNTCU,
      SUM(BD_RETSHAREPV)        ISC_RETSHAREPV,
      SUM(BD_RETSHAREMO)        ISC_RETSHAREMO,
      BD_PREPAID                ISC_PREPAID,
      BD_REQTYPE                ISC_REQTYPE,
      BD_BILLRATE               ISC_BILLRATE,
      BD_STYPE                  ISC_STYPE,
      BD_PMVID                  ISC_PMVID,
      BD_BILLINGDOMAIN,                    --  038SO
      BD_TRANSPORTMEDIUM,                  --  038SO
      BD_CATEGORY,                         --  038SO
      NVL(BD_CDRTID,'CTB-CO'),             --  042SO normally CONTENT
      BD_VSPRCID,                          --  047SO
      SUM(BD_COUNTTR),                     --  047SO
      SUM(BD_AMOUNTTR),                    --  047SO
      0,                                   --  053SO
      BD_GART,                             --  057SO
      BD_SHOW,                             --  058SO
      BD_CAMPAIGN                          --  058SO
    FROM
      BDETAIL,
      CONTRACT,
      SETPERIOD
    WHERE BDETAIL.BD_CONID = CONTRACT.CON_ID
      AND BD_DATETIME >= to_date(v_sep_id,'YYYYMM')                 --  030SO
      AND BD_DATETIME < ADD_MONTHS(to_date(v_sep_id,'YYYYMM'),1)    --  030SO
      AND SEP_DATE1 = to_date(v_sep_id,'YYYYMM')                    --  030SO
      AND BD_MAPSID ='R'
    GROUP BY
      SEP_ID,
      BD_SRCTYPE,
      CON_ID,
      CON_ESTID,                           --  037SO
      BD_BILLINGDOMAIN,                    --  038SO
      BD_TRANSPORTMEDIUM,                  --  038SO
      BD_CATEGORY,                         --  038SO
      NVL(BD_CDRTID,'CTB-CO'),             --  042SO
      BD_SHORTID,
      BD_SERVICE,
      DECODE(BD_BILLRATE,NULL,NULL,BD_KEYWORD),  --  046SO --  044SO
      BD_BILLTEXT,
      BD_AMOUNTCU,
      BD_PREPAID,
      BD_REQTYPE,
      BD_BILLRATE,
      BD_STYPE,
      BD_PMVID,
      BD_VSPRCID,                          --  047SO
      BD_GART,                             --  057SO
      BD_SHOW,                             --  058SO
      BD_CAMPAIGN                          --  058SO
    ;

    -- aggregate the entries with too many billtexts   --  027SO whole rest added

    -- clear list of bad contracts. needed if this runs more than once per period
    DELETE FROM ISC_AGGREGATION
    WHERE ISCA_SEPID = v_sep_id;

    -- populate list of bad contracts
    INSERT INTO ISC_AGGREGATION (
        ISCA_ID,
        ISCA_SEPID,
        ISCA_CONID,
        ISCA_SHORTID,
        ISCA_SERVICE,
        ISCA_COUNT
    ) (
    SELECT
        GENERATEUNIQUEKEY('G'),
        v_sep_id,
        ISC_CONID,
        ISC_SHORTID,
        ISC_SERVICE,
        COUNT(*)
    FROM
        ISCONSOL
    WHERE   ISC_SEPID = v_sep_id
        AND ISC_ESID = 'R'
        AND ISC_CDRTID = 'CTB-CO'       --  042SO
    GROUP BY
        ISC_CONID,
        ISC_SHORTID,
        ISC_SERVICE
    HAVING COUNT(*) > 2000
    );

    -- mark offending entries as 'aggregated'
    UPDATE  ISCONSOL SET
        ISC_BILLTEXT_AGR = 1            --  053SO
    WHERE
        ISC_SEPID = v_sep_id
    AND ISC_ESID = 'R'                  --  033SO
    AND ISC_CDRTID = 'CTB-CO'           --  042SO
    AND ISC_CONID IN (
        SELECT ISCA_CONID
        FROM ISC_AGGREGATION
        WHERE ISCA_SEPID = v_sep_id
    );

    RecordsAffected := SQL%ROWCOUNT ;
    ErrorCode := 0;
    ReturnStatus := 1;
    Return;
/*
    Exception
    When Others then
    ErrorCode := SQLCODE;
    ErrorMsg  := SQLERRM;
    ReturnStatus := 0;
    RecordsAffected := 0;

    Return;
*/
END SP_CONS_IS;

-- **********************************************************************************************************************************

procedure SP_CONS_ISMSISDN
(
   p_PAC_ID         IN varchar2,    -- 'ISMSISDN'   ISMSISDN Consolidation
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT number )
IS

-- procedure fills up consolidation table ISMSTAT (Info Service Msisdn) with data from bdetail
-- procedure fills up consolidation table TPMCONSOL (Third Party Msisdn) with data from bdetail
   x_TPID           VARCHAR2(10);
   n_TPID           NUMBER;
   x_SERVICE        VARCHAR2(20);       --  040SO
   x_BILLTEXT       VARCHAR2(80);

   x_MSISDN         VARCHAR2(20);
   n_MSISDN         NUMBER;
   x_SHORTID        VARCHAR2(6);
   n_SHORTID        NUMBER;
   x_KEYWORD        VARCHAR2(80);
   x_CONSUBTYPE     VARCHAR2(10);
   x_REQTYPE        NUMBER;
   n_AMOUNTCU       NUMBER(9,4);
   n_PULLINC        NUMBER;
   n_PUSHINC        NUMBER;

   dummy_ErrorCode     NUMBER;
   dummy_ErrorMsg      VARCHAR2(2000);
   dummy_ReturnStatus  NUMBER;

   v_Temp varchar2(2000);
     n_REDCODE number;
   v_Billtext varchar2(2000);

   CURSOR C1 (period_id VARCHAR2) IS
      SELECT /*+ FULL(BDETAIL) */
        BD_MSISDN_A,
        NVL(CON_ESTID,'-e-'),                       --  037SO
        NVL(BD_SHORTID,'0'),
        NVL(BD_KEYWORD,'-empty-'),
        BD_REQTYPE,
        BD_AMOUNTCU,
        BD_SERVICE,
        NVL(BD_BILLTEXT,'-empty-'),
        NVL(BD_TPID,'0')
      FROM
        BDETAIL,
        CONTRACT
      WHERE
             BDETAIL.BD_CONID = CONTRACT.CON_ID
        AND  BD_DEMO = 0
        AND  BD_MAPSID = 'R'
        AND  BD_CDRTID = 'CTB-CO'                                       --  043SO
        AND  BD_DATETIME >= to_date(period_id,'YYYYMM')                 --  032SO
        AND  BD_DATETIME < ADD_MONTHS(to_date(period_id,'YYYYMM'),1)    --  032SO
      ;

    v_sep_id        VARCHAR2(6);        -- YYYYMM                               --  029SO
BEGIN

    v_sep_id := to_char(ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1),'YYYYMM');        --  029SO

    RecordsAffected := 0;

    execute immediate 'TRUNCATE TABLE ISMSTAT' ;
    execute immediate 'TRUNCATE TABLE TPMCONSOL';
    execute immediate 'TRUNCATE TABLE TPMCONSOL_BAD';                           --  029SO

    OPEN C1(v_sep_id);

    LOOP
        FETCH C1 INTO x_MSISDN, x_CONSUBTYPE, x_SHORTID, x_KEYWORD, x_REQTYPE, n_AMOUNTCU, x_SERVICE, x_BILLTEXT, x_TPID;
        EXIT WHEN (C1%NOTFOUND);
        BEGIN
          n_MSISDN := to_number(SUBSTR(NormalizedMsisdn(x_MSISDN),1,16));  -- internationalize MSISDN
          n_SHORTID := to_number(x_SHORTID);                  -- convert to number
          x_KEYWORD := SUBSTR(x_KEYWORD,1,30);                -- truncate keyword
          x_BILLTEXT := SUBSTR(x_BILLTEXT,1,30);              -- truncate billtext
          n_TPID := to_number(x_TPID);                        -- convert to number
          IF x_REQTYPE IN (0, 501, 603) THEN
              -- considered pull
              n_PULLINC := 1;
              n_PUSHINC := 0;
          ELSE
              -- everything else considered push: check later for MMS
              n_PULLINC := 0;
              n_PUSHINC := 1;
          END IF;

          UPDATE ISMSTAT SET
              ISM_PULLCOUNT = ISM_PULLCOUNT + n_PULLINC,
              ISM_PUSHCOUNT = ISM_PUSHCOUNT + n_PUSHINC,
              ISM_AMOUNTCU = ISM_AMOUNTCU + n_AMOUNTCU
          WHERE
                  ISM_MSISDN = n_MSISDN
              AND ISM_CONSUB = x_CONSUBTYPE
              AND ISM_SHORTID = n_SHORTID
              AND ISM_KEYWORD = x_KEYWORD
          ;

          IF SQL%ROWCOUNT = 0 THEN    -- must insert this row

              INSERT INTO ISMSTAT (
                  ISM_MSISDN,
                  ISM_CONSUB,
                  ISM_SHORTID,
                  ISM_KEYWORD,
                  ISM_PULLCOUNT,
                  ISM_PUSHCOUNT,
                  ISM_AMOUNTCU
                  )
              VALUES (
                  n_MSISDN,
                  x_CONSUBTYPE,
                  n_SHORTID,
                  x_KEYWORD,
                  n_PULLINC,
                  n_PUSHINC,
                  n_AMOUNTCU
                  );
              RecordsAffected := RecordsAffected + 1 ;

          END IF;

          UPDATE TPMCONSOL SET
              TPMC_PULLCOUNT = TPMC_PULLCOUNT + n_PULLINC,
              TPMC_PUSHCOUNT = TPMC_PUSHCOUNT + n_PUSHINC,
              TPMC_AMOUNTCU  = TPMC_AMOUNTCU  + n_AMOUNTCU
          WHERE
                  TPMC_MSISDN = n_MSISDN
              AND TPMC_CONSUB = x_CONSUBTYPE
              AND TPMC_TPID = n_TPID
              AND TPMC_SERVICE = x_SERVICE
              AND TPMC_BILLTEXT = x_BILLTEXT
          ;
          IF SQL%ROWCOUNT = 0 THEN    -- must insert this row

              INSERT INTO TPMCONSOL (
                  TPMC_MSISDN,
                  TPMC_CONSUB,
                  TPMC_TPID,
                  TPMC_SERVICE,
                  TPMC_BILLTEXT,
                  TPMC_PULLCOUNT,
                  TPMC_PUSHCOUNT,
                  TPMC_AMOUNTCU,
                  TPMC_BILLTEXT_AGR         --  053SO
                  )
              VALUES (
                  n_MSISDN,
                  x_CONSUBTYPE,
                  n_TPID,
                  x_SERVICE,
                  x_BILLTEXT,
                  n_PULLINC,
                  n_PUSHINC,
                  n_AMOUNTCU,
                  0                         --  053SO
                  );
              RecordsAffected := RecordsAffected + 1 ;

          END IF;

        Exception
        When Others then
          PKG_COMMON.INSERT_WARNING (
             'PKG_BDETAIL_INFO',
             'SP_INSERT_ISMSTAT',
             'Illegal values',
             'MSISDN=' || x_MSISDN || ' CONSUBTYPE=' || x_CONSUBTYPE || ' TPID=' || x_TPID || ' SERVICE=' || x_SERVICE || ' SHORTID=' || x_SHORTID || ' KEYWORD=' || x_KEYWORD,
             NULL, p_BOH_ID, NULL, x_SHORTID
             ); --  064SO

        END;

   END LOOP;

   CLOSE C1;

    --  053SO --  029SO aggregate entries for short IDs which have too many BillTexts

    -- Mark the 'bad' entries
    UPDATE  TPMCONSOL SET
        TPMC_BILLTEXT_AGR = 1               --  053SO
    WHERE
        TPMC_SERVICE IN (
            SELECT ISCA_SERVICE
            FROM ISC_AGGREGATION
            WHERE ISCA_SEPID = v_sep_id
        );

   ErrorCode := 0;
   ReturnStatus := 1;
   Return;

/*
Exception
When Others then
   ErrorCode := SQLCODE;
   ErrorMsg  := SQLERRM;
   ReturnStatus := 0;
   RecordsAffected := 0;
*/

END SP_CONS_ISMSISDN;

-- **********************************************************************************************************************************

PROCEDURE SP_CONS_TR
(
   p_PACT_ID        In      Varchar2,
   p_BOH_ID         In      Varchar2,
   RecordsAffected  Out     Number,
   ErrorCode        Out     Number,
   ErrorMsg         Out     Varchar2,
   ReturnStatus     In Out  Number
)
Is

  CURSOR cSmsShortIdMapping IS
    SELECT
      LA_CON.CON_ID     LA_CON_ID,
      IP_CON.CON_ID     IP_CON_ID,
      IP_CON.CON_PMID   IP_CON_PMID
    FROM
      CONTRACT LA_CON,
      CONTRACT IP_CON
    WHERE
        la_con.con_etid = 'LAC'
      AND la_con.con_esid IN ('A','I')
      AND ip_con.con_etid = 'IPC'
      AND ip_con.con_esid IN('A','I')
      AND la_con.con_tarid IN ('P','Q','R','S','T','U','V','W','X','Y','Z')
      AND la_con.con_consol = ip_con.con_shortid                                --  037SO
      AND (la_con.CON_DATESTART < trunc(sysdate,'MONTH') OR la_con.CON_DATESTART IS NULL)
      AND (la_con.CON_DATEEND >= add_months(trunc(sysdate,'MONTH'),-1) OR la_con.CON_DATEEND IS NULL)
      AND (CONTRACTPERIODSTART(ip_con.CON_DATESTART) < CONTRACTPERIODEND(la_con.CON_DATEEND))
      AND (CONTRACTPERIODEND(ip_con.CON_DATEEND) >= CONTRACTPERIODEND(la_con.CON_DATEEND))
    ORDER BY
        LA_CON.CON_ID,
        -- IP_CON.CON_SERVICE,     --  065SO --  041SO  SMS will lie AFTER MMS Services and will be effective
        -- DECODE(IP_CON.CON_ESTID,'BN','ZZZ','PTS','ZZZ',IP_CON.CON_ESTID),       --  037SO  --  012SO
        CONTRACTPERIODEND(ip_con.CON_DATEEND) ,
        IP_CON.CON_ID
      ;

    --  011SO
  CURSOR cMmsShortIdMapping IS
    SELECT
      LA_CON.CON_ID     LA_CON_ID,
      IP_CON.CON_ID     IP_CON_ID,
      IP_CON.CON_PMID   IP_CON_PMID
    FROM
      CONTRACT LA_CON,
      CONTRACT IP_CON
    WHERE
        la_con.con_etid = 'MLC'
      AND la_con.con_esid IN ('A','I')
      AND ip_con.con_etid = 'IPC'
      AND ip_con.con_esid IN('A','I')
      AND la_con.con_tarid IS NULL
      AND la_con.con_consol = ip_con.con_shortid                                --  037SO
      AND (la_con.CON_DATESTART < trunc(sysdate,'MONTH') OR la_con.CON_DATESTART IS NULL)
      AND (la_con.CON_DATEEND >= add_months(trunc(sysdate,'MONTH'),-1) OR la_con.CON_DATEEND IS NULL)
      AND (CONTRACTPERIODSTART(ip_con.CON_DATESTART) < CONTRACTPERIODEND(la_con.CON_DATEEND))
      AND (CONTRACTPERIODEND(ip_con.CON_DATEEND) >= CONTRACTPERIODEND(la_con.CON_DATEEND))
    ORDER BY
        LA_CON.CON_ID,
        -- IP_CON.CON_SERVICE DESC,   --  065SO --  041SO  MMS will lie AFTER SMS Services and will be effective
        -- DECODE(IP_CON.CON_ESTID,'MBN','ZZZ','MPS','ZZZ',IP_CON.CON_ESTID),   --  037SO     --  013SO
        CONTRACTPERIODEND(ip_con.CON_DATEEND) ,
        IP_CON.CON_ID
      ;


Begin

    Update TRCONSOL Set TRC_ESID = 'D'
    Where  TRC_SEPID In (Select SEP_ID From SETPERIOD Where SEP_DATE1 = Trunc(Add_Months(Sysdate,-1),'MONTH')
    And TRC_ETID IN ('SMS', 'MMS')
    And TRC_ESID = 'R');

    if cbooNonIsrvSmsTc then
        -- Assignment of Price Model IDs from IP Contract to SMS LA Contracts
        For cSmsShortIdMapping_Rec in cSmsShortIdMapping Loop
            Update CONTRACT Set
                CON_PMID = cSmsShortIdMapping_Rec.IP_CON_PMID,
                CON_IPCONID = cSmsShortIdMapping_Rec.IP_CON_ID
            Where CON_ID = cSmsShortIdMapping_Rec.LA_CON_ID;
        End Loop;
    end if;

    if cbooNonIsrvMmsTc then
        -- Assignment of Price Model IDs from IP Contract to MMS LA Contracts
        For cMmsShortIdMapping_Rec in cMmsShortIdMapping Loop                                                                                    --  011SO
            Update CONTRACT Set
                CON_PMID = cMmsShortIdMapping_Rec.IP_CON_PMID,
                CON_IPCONID = cMmsShortIdMapping_Rec.IP_CON_ID
            Where CON_ID = cMmsShortIdMapping_Rec.LA_CON_ID;
        End Loop;
    end if;

    RecordsAffected := 0 ;

    if cbooNonIsrvSmsTc then
        -- Content Cost Consolidation (SMS)
        -- filled from BDCONSOLIDATION (already filled by PKG_BDETAIL_SMSC.SP_CONS_SMSC)
        -- for SMS MO and MT only for non-ISRV (OTA) contracts
        Insert Into TRCONSOL (
            TRC_ID,
            TRC_DATE,
            TRC_SEPID,
            TRC_ESID,
            TRC_ETID,
            TRC_TRDID,
            TRC_CONID,
            TRC_SHORTID,
            TRC_SERVICE,
            TRC_TRCLASS,
            TRC_PRICE,
            TRC_COUNT,
            TRC_AMOUNT,
            TRC_PREPAID               --  035SO
        )
        Select
            GenerateUniqueKey('G')        TRC_ID,
            SysDate                       TRC_DATE,
            BDC_SEPID                     TRC_SEPID,
            'R'                           TRC_ESID,
            'SMS'                         TRC_ETID,
            'MO'                          TRC_TRDID,
            IPC.CON_ID                    TRC_CONID,        --  050SO
            BDC_CONSOLIDATION             TRC_SHORTID,
            NULL                          TRC_SERVICE,
            NULL                          TRC_TRCLASS,
            PMVT_AMOUNTMO                 TRC_PRICE,
            SUM(BDC_COUNT)                TRC_COUNT,
            PMVT_AMOUNTMO * SUM(BDC_COUNT)  TRC_AMOUNT,
            BDC_PREPAID                   TRC_PREPAID      --  035SO
        From
            BDCONSOLIDATION,
            CONTRACT IPC,                              --  050SO
            CONTRACT LAC,                              --  050SO
            PRMODELVER,
            PRMODELVERTRANS,
            SETPERIOD
        Where   IPC.CON_PMID = PMV_PMID
            AND IPC.CON_SRCTYPE <> 'ISRV'                   --  048SO
            AND SEP_DATE2 = Trunc(SysDate,'MONTH')
            AND SEP_DATE2 - 1 >= PMV_START
            AND SEP_DATE2 - 1 < PMV_END
            And PMV_ID = PMVT_PMVID
            And PMV_ESID = 'A'
            And PMVT_CLASSTYPE = 'SMS'
            -- And PMVT_TRCLASS = 160
            And BDC_CONID = LAC.CON_ID                      --  050SO
            ANd IPC.CON_ID = LAC.CON_IPCONID                --  050SO
            And BDC_SEPID = SEP_ID
            And BDC_ESID = 'R'
            And BDC_NPI_A = '1' And BDC_PID_A = '0'
        Group By
            BDC_SEPID,
            IPC.CON_ID,                                     --  050SO
            LAC.CON_ID,                                     --  050SO
            IPC.CON_PMID,                                   --  050SO
            BDC_CONID,
            BDC_CONSOLIDATION,
            BDC_SERVICE,
            PMVT_TRCLASS,
            PMVT_AMOUNTMO,
            BDC_PREPAID                                     --  035SO

        UNION

        Select
            GenerateUniqueKey('G')        TRC_ID,
            SysDate                       TRC_DATE,
            BDC_SEPID                     TRC_SEPID,
            'R'                           TRC_ESID,
            'SMS'                         TRC_ETID,
            'MT'                          TRC_TRDID,
            IPC.CON_ID                    TRC_CONID,        --  050SO
            BDC_CONSOLIDATION             TRC_SHORTID,
            NULL                          TRC_SERVICE,
            NULL                          TRC_TRCLASS,
            PMVT_AMOUNTMT                 TRC_PRICE,
            SUM(BDC_COUNT)                TRC_COUNT,
            PMVT_AMOUNTMT * SUM(BDC_COUNT)  TRC_AMOUNT,
            BDC_PREPAID                   TRC_PREPAID       --  035SO
        From
            BDCONSOLIDATION,
            CONTRACT IPC,                              --  050SO
            CONTRACT LAC,                              --  050SO
            PRMODELVER,
            PRMODELVERTRANS,
            SETPERIOD
        Where   IPC.CON_PMID = PMV_PMID
            AND IPC.CON_SRCTYPE <> 'ISRV'                   --  050SO    --  048SO
            AND SEP_DATE2 = Trunc(SysDate,'MONTH')
            AND SEP_DATE2 - 1 >= PMV_START
            AND SEP_DATE2 - 1 < PMV_END
            And PMV_ID = PMVT_PMVID
            And PMV_ESID = 'A'
            And PMVT_CLASSTYPE = 'SMS'
            And BDC_CONID = LAC.CON_ID                      --  050SO
            ANd IPC.CON_ID = LAC.CON_IPCONID                --  050SO
            And BDC_SEPID = SEP_ID
            And BDC_ESID = 'R'
            And BDC_NPI_B = '1' And BDC_PID_B = '0'
        Group By
            BDC_SEPID,
            IPC.CON_ID,                                     --  050SO
            LAC.CON_ID,                                     --  050SO
            IPC.CON_PMID,                                   --  050SO
            BDC_CONID,
            BDC_CONSOLIDATION,
            BDC_SERVICE,
            PMVT_TRCLASS,
            PMVT_AMOUNTMT,
            BDC_PREPAID                                     --  035SO
        ;

        RecordsAffected := RecordsAffected + SQL%ROWCOUNT ;
    end if;

    Insert Into TRCONSOL (
        TRC_ID,
        TRC_DATE,
        TRC_SEPID,
        TRC_ESID,
        TRC_ETID,
        TRC_TRDID,
        TRC_CONID,
        TRC_SHORTID,
        TRC_SERVICE,
        TRC_TRCLASS,
        TRC_PRICE,
        TRC_COUNT,
        TRC_AMOUNT,
        TRC_PREPAID,
        TRC_GART,                   --  057SO
        TRC_SHOW,                   --  058SO
        TRC_CAMPAIGN                --  058SO

    )
    Select
        GenerateUniqueKey('G')        TRC_ID,
        SysDate                       TRC_DATE,
        ISC_SEPID                     TRC_SEPID,
        'R'                           TRC_ESID,
        'SMS'                         TRC_ETID,
        'MO'                          TRC_TRDID,
        ISC_CONID                     TRC_CONID,
        ISC_SHORTID                   TRC_SHORTID,
        ISC_SERVICE                   TRC_SERVICE,
        NULL                          TRC_TRCLASS,
        SUM(ISC_AMOUNTTR)/(SUM(ISC_COUNTTR)+ 1.0E-10) TRC_PRICE,
        SUM(ISC_COUNTTR)              TRC_COUNT,
        SUM(ISC_AMOUNTTR)             TRC_AMOUNT,
        ISC_PREPAID                   TRC_PREPAID,
        ISC_GART                      TRC_GART,         --  057SO
        ISC_SHOW                      TRC_SHOW,         --  058SO
        ISC_CAMPAIGN                  TRC_CAMPAIGN      --  058SO
    From
        ISCONSOL,
        CONTRACT,
        SETPERIOD
    Where CON_ID = ISC_CONID          --  050SO
        AND CON_SRCTYPE = 'ISRV'
        AND SEP_DATE2 = Trunc(SysDate,'MONTH')
        AND ISC_SEPID = SEP_ID
        And ISC_ESID = 'R'
        And ISC_CDRTID = 'CTB-MO'
        And ISC_TRANSPORTMEDIUM = 'SMS'
    Group By
        ISC_SEPID,
        ISC_CONID,
        ISC_SHORTID,
        ISC_SERVICE,
        ISC_PREPAID,
        ISC_GART,                   --  057SO
        ISC_SHOW,                   --  058SO
        ISC_CAMPAIGN                --  058SO

    UNION

    Select
        GenerateUniqueKey('G')        TRC_ID,
        SysDate                       TRC_DATE,
        ISC_SEPID                     TRC_SEPID,
        'R'                           TRC_ESID,
        'SMS'                         TRC_ETID,
        'MT'                          TRC_TRDID,
        ISC_CONID                     TRC_CONID,
        ISC_SHORTID                   TRC_SHORTID,
        ISC_SERVICE                   TRC_SERVICE,
        NULL                          TRC_TRCLASS,
        SUM(ISC_AMOUNTTR)/(SUM(ISC_COUNTTR)+ 1.0E-10) TRC_PRICE,
        SUM(ISC_COUNTTR)              TRC_COUNT,
        SUM(ISC_AMOUNTTR)             TRC_AMOUNT,
        ISC_PREPAID                   TRC_PREPAID,
        ISC_GART                      TRC_GART,         --  057SO
        ISC_SHOW                      TRC_SHOW,         --  058SO
        ISC_CAMPAIGN                  TRC_CAMPAIGN      --  058SO
    From
        ISCONSOL,
        CONTRACT,
        SETPERIOD
    Where CON_ID = ISC_CONID                            --  050SO
        AND CON_SRCTYPE = 'ISRV'
        AND SEP_DATE2 = Trunc(SysDate,'MONTH')
        AND ISC_SEPID = SEP_ID
        And ISC_ESID = 'R'
        And ISC_CDRTID = 'CTB-CO'
        And ISC_TRANSPORTMEDIUM = 'SMS'
    Group By
        ISC_SEPID,
        ISC_CONID,
        ISC_SHORTID,
        ISC_SERVICE,
        ISC_PREPAID,
        ISC_GART,                   --  057SO
        ISC_SHOW,                   --  058SO
        ISC_CAMPAIGN                --  058SO
    ;

    RecordsAffected := RecordsAffected + SQL%ROWCOUNT ;


    if cbooNonIsrvMmsTc then
        -- Transport Cost Consolidation (MMS)                                         --  011SO
        -- filled from two unions, one for MO and second for MT
        Insert Into TRCONSOL (
            TRC_ID,
            TRC_DATE,
            TRC_SEPID,
            TRC_ESID,
            TRC_ETID,
            TRC_TRDID,
            TRC_CONID,
            TRC_SHORTID,
            TRC_SERVICE,
            TRC_TRCLASS,
            TRC_PRICE,
            TRC_COUNT,
            TRC_AMOUNT,
            TRC_PREPAID         --  035SO
        )
        Select
            GenerateUniqueKey('G')  TRC_ID,
            SysDate                 TRC_DATE,
            SEP_ID                  TRC_SEPID,
            'R'                     TRC_ESID,
            'MMS'                   TRC_ETID,
            'MO'                    TRC_TRDID,
            IPC.CON_ID              TRC_CONID,              --  050SO
            MMSC_SHORTID            TRC_SHORTID,
            NULL                    TRC_SERVICE,
            MMSC_TRCLASS            TRC_TRCLASS,
            MMSC_AMOUNTTR/MMSC_COUNT           TRC_PRICE,
            SUM(MMSC_COUNT)         TRC_COUNT,
            SUM(MMSC_AMOUNTTR)      TRC_AMOUNT,
            MMSC_PREPAID            TRC_PREPAID             --  035SO
            FROM
            MMSCONSOLIDATION,
            CONTRACT IPC,                              --  050SO
            CONTRACT MLC,                              --  050SO
            SETPERIOD
        WHERE
                SEP_DATE2 = Trunc(SysDate,'MONTH')
            AND MMSC_SEPID = SEP_ID
            AND MMSC_ETID IN ('MMSC-RAW')        --  039SO
            AND MMSC_ESID = 'R'
            AND MMSC_CDRRECTYPE = 'MM7Rrecord'
            AND MMSC_EVENTDISP = 1
            AND MMSC_MSGTYPE = 0
            AND MMSC_CONID = MLC.CON_ID                     --  050SO
            AND IPC.CON_ID = MLC.CON_IPCONID                --  050SO
            AND IPC.CON_SRCTYPE <> 'ISRV'                   --  050SO --  048SO
        Group By
            SEP_ID,
            IPC.CON_ID,                                     --  050SO
            MMSC_SHORTID,
            MMSC_TRCLASS,
            MMSC_AMOUNTTR/MMSC_COUNT,
            MMSC_PREPAID                                    --  035SO

        UNION

        Select
            GenerateUniqueKey('G')  TRC_ID,
            SysDate                 TRC_DATE,
            SEP_ID                  TRC_SEPID,
            'R'                     TRC_ESID,
            'MMS'                   TRC_ETID,
            'MT'                    TRC_TRDID,
            IPC.CON_ID              TRC_CONID,              --  050SO
            MMSC_SHORTID            TRC_SHORTID,
            NULL                    TRC_SERVICE,
            MMSC_TRCLASS            TRC_TRCLASS,
            MMSC_AMOUNTTR/MMSC_COUNT           TRC_PRICE,
            SUM(MMSC_COUNT)         TRC_COUNT,
            SUM(MMSC_AMOUNTTR)      TRC_AMOUNT,
            MMSC_PREPAID            TRC_PREPAID             --  035SO
        FROM
            MMSCONSOLIDATION,
            CONTRACT IPC,                              --  050SO
            CONTRACT MLC,                              --  050SO
            SETPERIOD
        WHERE
                SEP_DATE2 = Trunc(SysDate,'MONTH')
            AND MMSC_SEPID = SEP_ID
            AND MMSC_ETID IN ('MMSC-RAW')       --  039SO
            AND MMSC_ESID = 'R'
            AND MMSC_CDRRECTYPE = 'MM7Orecord'
            AND MMSC_EVENTDISP = 2
            AND MMSC_MSGTYPE = 0
            AND MMSC_CONID = MLC.CON_ID                     --  050SO
            AND IPC.CON_ID = MLC.CON_IPCONID                --  050SO
            AND IPC.CON_SRCTYPE <> 'ISRV'                   --  050SO --  048SO
        Group By
            SEP_ID,
            IPC.CON_ID,                                     --  050SO
            MMSC_SHORTID,
            MMSC_TRCLASS,
            MMSC_AMOUNTTR/MMSC_COUNT,
            MMSC_PREPAID                                    --  035SO
        ;

        RecordsAffected := RecordsAffected + SQL%ROWCOUNT ;
    end if;

    Insert Into TRCONSOL (
        TRC_ID,
        TRC_DATE,
        TRC_SEPID,
        TRC_ESID,
        TRC_ETID,
        TRC_TRDID,
        TRC_CONID,
        TRC_SHORTID,
        TRC_SERVICE,
        TRC_TRCLASS,
        TRC_PRICE,
        TRC_COUNT,
        TRC_AMOUNT,
        TRC_PREPAID,
        TRC_GART,                   --  057SO
        TRC_SHOW,                   --  058SO
        TRC_CAMPAIGN                --  058SO
    )
    Select
        GenerateUniqueKey('G')  TRC_ID,
        SysDate                 TRC_DATE,
        SEP_ID                  TRC_SEPID,
        'R'                     TRC_ESID,
        'MMS'                   TRC_ETID,
        'MO'                    TRC_TRDID,
        ISC_CONID               TRC_CONID,
        ISC_SHORTID             TRC_SHORTID,
        ISC_SERVICE             TRC_SERVICE,
        NULL                    TRC_TRCLASS,
        SUM(ISC_AMOUNTTR)/(SUM(ISC_COUNTTR)+ 1.0E-10) TRC_PRICE,                --  049SO
        SUM(ISC_COUNTTR)        TRC_COUNT,
        SUM(ISC_AMOUNTTR)       TRC_AMOUNT,
        ISC_PREPAID             TRC_PREPAID,
        ISC_GART                TRC_GART,         --  057SO
        ISC_SHOW                TRC_SHOW,         --  058SO
        ISC_CAMPAIGN            TRC_CAMPAIGN      --  058SO
    FROM
        ISCONSOL,
        CONTRACT,
        SETPERIOD
    WHERE
            SEP_DATE2 = Trunc(SysDate,'MONTH')
        AND ISC_SEPID = SEP_ID
        AND ISC_CONID = CON_ID
        AND ISC_ESID = 'R'
        And ISC_CDRTID = 'CTB-MO'
        And ISC_TRANSPORTMEDIUM = 'MMS'
        AND CON_SRCTYPE = 'ISRV'
    Group By
        SEP_ID,
        ISC_CONID,
        ISC_SHORTID,
        ISC_SERVICE,
        ISC_PREPAID,
        ISC_GART,                   --  057SO
        ISC_SHOW,                   --  058SO
        ISC_CAMPAIGN                --  058SO

    UNION

    Select
        GenerateUniqueKey('G')  TRC_ID,
        SysDate                 TRC_DATE,
        SEP_ID                  TRC_SEPID,
        'R'                     TRC_ESID,
        'MMS'                   TRC_ETID,
        'MT'                    TRC_TRDID,
        ISC_CONID               TRC_CONID,
        ISC_SHORTID             TRC_SHORTID,
        ISC_SERVICE             TRC_SERVICE,
        NULL                    TRC_TRCLASS,
        SUM(ISC_AMOUNTTR)/(SUM(ISC_COUNTTR)+ 1.0E-10) TRC_PRICE,                --  049SO
        SUM(ISC_COUNTTR)        TRC_COUNT,
        SUM(ISC_AMOUNTTR)       TRC_AMOUNT,
        ISC_PREPAID             TRC_PREPAID,
        ISC_GART                TRC_GART,         --  057SO
        ISC_SHOW                TRC_SHOW,         --  058SO
        ISC_CAMPAIGN            TRC_CAMPAIGN      --  058SO
    FROM
        ISCONSOL,
        CONTRACT,
        SETPERIOD
    WHERE
            SEP_DATE2 = Trunc(SysDate,'MONTH')
        AND ISC_SEPID = SEP_ID
        AND ISC_CONID = CON_ID
        AND ISC_ESID = 'R'
        And ISC_CDRTID = 'CTB-CO'
        And ISC_TRANSPORTMEDIUM = 'MMS'
        AND CON_SRCTYPE = 'ISRV'
    Group By
        SEP_ID,
        ISC_CONID,
        ISC_SHORTID,
        ISC_SERVICE,
        ISC_PREPAID,
        ISC_GART,                   --  057SO
        ISC_SHOW,                   --  058SO
        ISC_CAMPAIGN                --  058SO
    ; --  048SO

    RecordsAffected := RecordsAffected + SQL%ROWCOUNT ;

    ErrorCode := 0;
    ReturnStatus := 1;
    Return;

/*
Exception
When Others then
   ErrorCode := SQLCODE;
   ErrorMsg  := SQLERRM;
   ReturnStatus := 0;
   RecordsAffected := 0;
*/

END SP_CONS_TR;


End Pkg_BDetail_info;
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- PKG_BDETAIL_MMSC  (Package Body) 
--
CREATE OR REPLACE PACKAGE BODY SBS1_ADMIN.PKG_BDETAIL_MMSC as

-- MODIFICATION HISTORY
-- Person   Date        Comments
-- -------------------  ------------------------------------------
-- 001SO    07.01.2004  Add SP_CONS_MMSC
-- 002GW    22.01.2004  Add Field to Add SP_CONS_MMSC
-- 003SO    07.06.2004  Patch temporarily to consolidate only 2nd half of May
-- 004SO    07.06.2004  Patch removed again
-- 004SO    08.08.2004  Correct NUM-fields by recipient count
-- 005SO    27.09.2004  Schedule Data Warehouse Sync
-- 006SO    05.10.2004  Drop obsolete procedure SP_INSERT_MMSC
-- 007SO    08.07.2005  Add Prices to MMS consolidation for reporting Roaming Promotion amounts
-- 008SO    20.02.2006  Add contract purge for MMS LA contracts
-- 009SO    16.08.2006  Add period entry if needed
-- 010SO    17.10.2006  Include MMS Bulk Table BDETAIL7 in partition management
-- 011SO    17.10.2006  Include MMS Bulk data into MMS consolidation
-- 012SO    11.04.2007  Harmonize Tablespace assignment between manual and automatic partition creation
-- 013SO    06.09.2007  Rename BD_MTARID to BD_TARID
-- 014SO    09.09.2007  Add Procedures SP_UPDATE_BOHEADER_MMSC_3 and SP_UPDATE_BOHEADER_MMSB_3
-- 015SO    09.09.2007  Add Procedures SP_UPDATE_BOHEADER_MMSC_2 and SP_UPDATE_BOHEADER_MMSB_2
-- 016SO    30.09.2007  Add Procedure SP_PREPARE_LA_MCC (clone from PKG_BDETAIL_SMSC)
-- 017SO    30.09.2007  Rename MMSC_MTARID to MMSC_TARID
-- 018SO    30.09.2007  Add MMSC_TOCID, MMSC_INT, MMSC_IW and MMSC_IOT to MMSCONSOLIDATION
-- 019SO    21.01.2008  Remove SP_DELETE_ALL_RECORDS_MMSC, SP_DELETE_ALL_RECORDS_MMSC, SP_DELETE_BDETAIL_MMSC
-- 020SO    31.10.2009  Move Period Insert to standalone Procedure
-- 021SO    24.04.2010  Change to new partition naming MMSB... for MMS Bulk Partition alnalysis
-- 022SO    20.08.2010  Implement SP_MOLAA_MMSC_ACCU
-- 023SO    20.08.2010  Implement SP_MOLAA_MMSC_TRY
-- 024SO    20.08.2010  Remove Partition ageing and partition analysis
-- 025SO    20.08.2010  Implement SP_MOLAA_MMSB_ACCU
-- 026SO    20.08.2010  Implement SP_MOLAA_MMSB_TRY
-- 027SO    23.08.2010  Add GART field when calling LA settlement functions
-- 028SO    23.08.2010  Implement SP_MOLAT_MMS_CONS similar to PKG_BDETAIL_SMSC.SP_MOLAT_SMS_CONS
-- 029SO    24.08.2010  Implement SP_MOLAM_MMS_CONS (MCC Consolidation, UFI creation)   
-- 030SO    26.08.2010  Rename procedures according to driving Packing-ID
-- 031SO    31.08.2010  Implement SP_TRY_LIA_MMSC (MMS-LA IW Accumulation)
-- 032SO    31.08.2010  Implement SP_CONS_LIT_MMS (MMS-LA IW UFIH Generation)
-- 033SO    06.09.2010  Remove IN OUT for Consolidation Return Status
-- 034SO    08.09.2010  Add DateTime condition for commit of marked rows
-- 035SO    18.09.2010  IW Accumulators: Calculate IW Tariff when marking
-- 036SO    18.09.2010  Add MMSC_IOT_INTERNAL to consolidation
-- 037SO    20.09.2010  Tolerate NULL prices when accumulating charges
-- 038SO    11.04.2011  Consider Televote Transport CDRs with tariff T (not used yet)
-- 039SO    14.12.2011  Remove schema qualifier "S B S 0 ."
-- 040SO    14.03.2012  Clean out BDETAIL7 (MMS Bulk)


procedure SP_CONS_MMSC
(
   p_PACT_ID        IN varchar2,        -- 'MMSC'   MMSC Consolidation
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     OUT number )                                                -- 033SO           
IS
    -- 001SO
Begin

  UPDATE MMSCONSOLIDATION SET MMSC_ESID = 'D'
  WHERE  MMSC_SEPID = TO_CHAR(TRUNC(ADD_MONTHS(sysdate,-1),'MONTH'),'YYYYMM')
    AND MMSC_ETID IN ('MMSC-RAW')                                    -- 011SO
    AND MMSC_ESID = 'R';

  RecordsAffected := 0;                                                         -- 011SO

  INSERT INTO MMSCONSOLIDATION (
    MMSC_ID,MMSC_ETID,MMSC_ESID,MMSC_DATE,MMSC_SEPID,
    MMSC_FROMDATE,MMSC_TODATE,
    MMSC_PREPAID,
    MMSC_MSGPRIORITY,
    MMSC_MSGTYPE,                                                               -- 002GW
    MMSC_MSGCLASS,
    MMSC_CDRRECTYPE,
    MMSC_FWDCOPYIND,
    MMSC_EVENTDISP,
    MMSC_LEGACYINDICATOR,
    MMSC_TRCLASS,
    MMSC_SHORTID,
    MMSC_CONID,
    MMSC_TARID,                                                                 -- 017SO
    MMSC_PMVID,
    MMSC_ZNID,
    MMSC_COUNT,
    MMSC_NUMNOTIFICATION,
    MMSC_NUMHOMERECIP,
    MMSC_NUMNONHOMERECIP,
    MMSC_NUMINTLRECIP,
    MMSC_NUMEMAILRECIP,
    MMSC_NUMSCODERECIP,
    MMSC_AMOUNTTR,
    MMSC_AMOUNTCU,              -- 007SO
    MMSC_RETSHAREPV,            -- 007SO Amount to be covered by Third Party (negative for Roaming Promotion events)
    MMSC_RETSHAREMO,            -- 007SO
    MMSC_TOCID,                 -- 018SO
    MMSC_INT,                   -- 018SO
    MMSC_IW,                    -- 018SO
    MMSC_IOT,                   -- 018SO
    MMSC_IOT_INTERNAL           -- 036SO
    )

  SELECT  /*+ NO_INDEX(BDETAIL6) */
    GenerateUniqueKey('G'), 'MMSC-RAW', 'R', SYSDATE, SEP_ID,
    MIN(BD_DATETIME), MAX(BD_DATETIME),
    BD_PREPAID,
    BD_MSGPRIORITY,
    BD_MSGTYPE,                                                                 -- 002GW
    BD_MSGCLASS,
    BD_CDRRECTYPE,
    BD_FWDCOPYIND,
    BD_EVENTDISP,
    BD_LEGACYINDICATOR,
    BD_TRCLASS,
    BD_SHORTID,
    BD_CONID,
    BD_TARID,                                                                   -- 013SO
    BD_PMVID,
    BD_ZNID,
    COUNT(BDETAIL6.ROWID),
    SUM(BD_NUMNOTIFICATION/BD_RECIPCOUNT),                                      -- 004SO
    SUM(BD_NUMHOMERECIP/BD_RECIPCOUNT),                                         -- 004SO
    SUM(BD_NUMNONHOMERECIP/BD_RECIPCOUNT),                                      -- 004SO
    SUM(BD_NUMINTLRECIP/BD_RECIPCOUNT),                                         -- 004SO
    SUM(BD_NUMEMAILRECIP/BD_RECIPCOUNT),                                        -- 004SO
    SUM(BD_NUMSCODERECIP/BD_RECIPCOUNT),                                        -- 004SO
    SUM(BD_AMOUNTTR),
    SUM(BD_AMOUNTCU),              -- 007SO
    SUM(BD_RETSHAREPV),            -- 007SO Amount to be covered by Third Party (negative for Roaming Promotion events)
    SUM(BD_RETSHAREMO),            -- 007SO
    BD_TOCID,                      -- 018SO
    BD_INT,                        -- 018SO
    BD_IW,                         -- 018SO
    SUM(BD_IOT),                   -- 018SO
    SUM(BD_IOT_INTERNAL)           -- 036SO
  FROM BDETAIL6 , SETPERIOD
  WHERE BD_MAPSID = 'R'
    AND BD_DATETIME >= TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')   -- +15           -- 004SO -- 003SO
    AND BD_DATETIME < TRUNC(sysdate,'MONTH')
    AND SEP_DATE1 = TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
  GROUP BY
    SEP_ID,
    BD_PREPAID,
    BD_MSGPRIORITY,
    BD_MSGTYPE,
    BD_MSGCLASS,
    BD_CDRRECTYPE,
    BD_FWDCOPYIND,
    BD_EVENTDISP,
    BD_LEGACYINDICATOR,
    BD_TRCLASS,
    BD_SHORTID,
    BD_CONID,
    BD_TARID,                                                                   -- 013SO
    BD_PMVID,
    BD_ZNID,
    BD_TOCID,                      -- 018SO
    BD_INT,                        -- 018SO
    BD_IW                          -- 018SO
    ;

  RecordsAffected := SQL%ROWCOUNT ;
  
  ErrorCode := 0;
  ReturnStatus := 1;
  Return;
/*
Exception
When Others then
   ErrorCode := SQLCODE;
   ErrorMsg  := SQLERRM;
   ReturnStatus := 0;
   RecordsAffected := 0;
*/
END SP_CONS_MMSC;


procedure SP_CONS_PURGEMLC
(
   p_PACT_ID        IN varchar2,        -- 'PURGEMLC'   Purge MMS-LA Contracts
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     OUT number )                                                -- 033SO
IS -- 008SO

Begin

  UPDATE CONTRACT SET CON_ESID='I'
  WHERE CON_ESID = 'A'
  AND CON_ETID = 'MLC'
  AND CON_DATEEND <= TRUNC(SYSDATE,'MONTH')
  AND EXISTS (SELECT BOH_ID FROM BOHEADER
              WHERE BOH_DATETIME > TRUNC(sysdate,'MONTH')
              AND BOH_PACKID IN ('TR')
              AND BOH_ESID = 'OK')
  AND EXISTS (SELECT BOH_ID FROM BOHEADER
              WHERE BOH_DATETIME > TRUNC(sysdate,'MONTH')
              AND BOH_PACKID IN ('LATMCC_MMS')
              AND BOH_ESID = 'OK')
  ; -- Transport cost calculation and Minimum Charge Correction must be over before we can purge

  RecordsAffected := SQL%ROWCOUNT ;
  ErrorCode := 0;
  ReturnStatus := 1;
  Return;

/*
Exception
When Others then
   ErrorCode := SQLCODE;
   ErrorMsg  := SQLERRM;
   ReturnStatus := 0;
   RecordsAffected := 0;
*/

END SP_CONS_PURGEMLC;


Procedure SP_UPDATE_BOHEADER_MMSC_2
(
  p_bohid         In      Varchar2,
  p_status        In      Varchar2,
  p_count         In      Number,
  p_MaxAge        In      Number,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  ReturnStatus    In Out  Number
)   -- 015SO
IS
   x_datefc        date;
   x_datelc        date;
   x_reccount      number;
   x_packid    varchar2(10);
   x_fileseqmax  number;
   x_nextseq   number;

Begin
   If p_status = 'S' then /*--- conversion was successful ---- */
      Begin
            select /*+ INDEX(BDETAIL6 IDX_BD_BOHID26) */ min(BD_DATETIME) into x_datefc
            from BDETAIL6
            where bd_bohid2 = p_bohid
            and BD_DATETIME > sysdate-p_MaxAge and BD_DATETIME < sysdate + 3/24;

            select /*+ INDEX(BDETAIL6 IDX_BD_BOHID26) */ max(BD_DATETIME) into x_datelc
            from BDETAIL6
            where bd_bohid2 = p_bohid
            and BD_DATETIME > sysdate-p_MaxAge and BD_DATETIME < sysdate + 3/24;

            select /*+ INDEX(BDETAIL6 IDX_BD_BOHID26) */ count(*) into x_reccount
            from BDETAIL6
            where bd_bohid2 = p_bohid
            and BD_PACSID2 = 'D' and BD_DATETIME > sysdate-p_MaxAge and BD_DATETIME < sysdate + 3/24;

            Update Boheader set
              boh_DATEFC = x_datefc,
              boh_DATELC = x_datelc,
              boh_RecCount = x_reccount,
              boh_end = sysdate,
              boh_esid = 'OK',
              boh_filename = REPLACE(boh_filename,'Temp-','')
            where boh_id = p_bohid;

            select boh_packid into x_packid
                      from boheader where boh_id = p_bohid;
            select pac_fileseqmax, pac_nextseq into x_fileseqmax, x_nextseq
                      from packing where pac_id  = x_packid;
            If x_fileseqmax = x_nextseq then /*** need to recycle ***/
                 x_nextseq := 1;
            else
                 x_nextseq := x_nextseq + 1;
            end if;
            update packing set
              pac_nextseq = x_nextseq
            where pac_id = x_packid;
      End;
   Else /*---- file error encountered ----*/
      Begin
        Update Boheader set
          boh_end = sysdate,
          boh_esid = 'PAE'
        where boh_id = p_bohid;

        Update /*+ INDEX(BDETAIL6 IDX_BD_BOHID26) */ BDETAIL6  set
          BD_PACSID2 = 'E',
          bd_borecno2 = Null,
          bd_bohid2 = Null
        where bd_bohid2 = p_bohid
        and BD_DATETIME > sysdate-p_MaxAge and BD_DATETIME < sysdate + 3/24;
      End;
   End if;
   Returnstatus := 1;
   -- Commit;
   Return;
Exception
When Others then
   ErrorCode := SQLCODE;
   ErrorMsg  := SQLERRM;
   ReturnStatus := 0;
END SP_UPDATE_BOHEADER_MMSC_2;

procedure SP_UPDATE_BOHEADER_MMSC_3
( p_bohid         In      Varchar2,
  p_status        In      Varchar2,
  p_count         In      Number,
  p_MaxAge        In      Number,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  ReturnStatus    In Out  Number
)   -- 014SO
IS
   x_datefc        date;
   x_datelc        date;
   x_reccount      number;
   x_packid    varchar2(10);
   x_fileseqmax  number;
   x_nextseq   number;

Begin
   If p_status = 'S' then /*--- conversion was successful ---- */
      Begin
            select /*+ INDEX(BDETAIL6 IDX_BD_BOHID36) */ min(BD_DATETIME) into x_datefc
            from BDETAIL6
            where bd_bohid3 = p_bohid
            and BD_DATETIME > sysdate-p_MaxAge and BD_DATETIME < sysdate + 3/24;

            select /*+ INDEX(BDETAIL6 IDX_BD_BOHID36) */ max(BD_DATETIME) into x_datelc
            from BDETAIL6
            where bd_bohid3 = p_bohid
            and BD_DATETIME > sysdate-p_MaxAge and BD_DATETIME < sysdate + 3/24;

            select /*+ INDEX(BDETAIL6 IDX_BD_BOHID36) */ count(*) into x_reccount
            from BDETAIL6
            where bd_bohid3 = p_bohid
            and BD_PACSID3 = 'D' and BD_DATETIME > sysdate-p_MaxAge and BD_DATETIME < sysdate + 3/24;

            Update Boheader set
              boh_DATEFC = x_datefc,
              boh_DATELC = x_datelc,
              boh_RecCount = x_reccount,
              boh_end = sysdate,
              boh_esid = 'OK',
              boh_filename = REPLACE(boh_filename,'Temp-','')
            where boh_id = p_bohid;

            select boh_packid into x_packid
            from boheader where boh_id = p_bohid;
            select pac_fileseqmax, pac_nextseq into x_fileseqmax, x_nextseq
            from packing where pac_id  = x_packid;
            If x_fileseqmax = x_nextseq then /*** need to recycle ***/
                 x_nextseq := 1;
            else
                 x_nextseq := x_nextseq + 1;
            end if;
            update packing set
              pac_nextseq = x_nextseq
            where pac_id = x_packid;
      End;
   Else /*---- file error encountered ----*/
      Begin
        Update Boheader set
          boh_end = sysdate,
          boh_esid = 'PAE'
        where boh_id = p_bohid;

        Update /*+ INDEX(BDETAIL6 IDX_BD_BOHID36) */ BDETAIL6  set
          BD_PACSID3 = 'E',
          bd_borecno3 = Null,
          bd_bohid3 = Null
        where bd_bohid3 = p_bohid
        and BD_DATETIME > sysdate-p_MaxAge and BD_DATETIME < sysdate + 3/24;
      End;
   End if;
   Returnstatus := 1;
   -- Commit;
   Return;
Exception
When Others then
   ErrorCode := SQLCODE;
   ErrorMsg  := SQLERRM;
   ReturnStatus := 0;
END SP_UPDATE_BOHEADER_MMSC_3;


procedure SP_CONS_LAPMCC_MMS
(
   p_PACT_ID        IN varchar2,        -- 'LAPMCC_MMS' MMS-LA MCC Preparation
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     OUT number )
IS  -- 016SO

-- get a list of MMS LA contracts which can have a minimum charge
-- per pseudo call number, the contracts with the top overall min charge are choosen
-- more than one contract can be returned, if they have equal weighted minimum charge
-- this is taken care of in the processing of the result
Begin

    PKG_BDETAIL_SETTLEMENT.SP_LAPMCC(
       p_PACT_ID,           -- IN varchar2,
       p_BOH_ID,            -- IN varchar2,
       'MLA',               -- IN varchar2,   -- SLA or MLA
       RecordsAffected,     -- OUT number,
       ErrorCode,           -- OUT number,
       ErrorMsg,            -- OUT varchar2,
       ReturnStatus         -- IN OUT number 
    );

END SP_CONS_LAPMCC_MMS;


Procedure SP_LAA_MMSC_ACCU
( BatchSize       In      Integer,
  p_BD_BOHID      In      Varchar2,
  p_MaxAge        In      Number,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  RecordsAffected Out     Number
)
Is  -- 022SO

  Cursor C1 (a_BOH_ID Varchar2, a_MaxAge Number) Is
    SELECT /*+ INDEX(BDETAIL6 IDX_BD_BOHID36) */
        TRUNC(BD_DATETIME)                                                      as PosDATETIME,         
        CON_PSCALL                                                              as PosMSISDN,                                                
        BD_CONID                                                                as PosConId,                                                   
        BD_SHORTID                                                              as PosCONSOLIDATION,                                   
        CON_TARID                                                               as PosTarId,                                                  
        NVL(CON_HDGROUP,0)                                                      as PosHdGroup,                                              
        NVL(BD_INT,'0')                                                         as PosInternational,  
        'CDRA'                                                                  as PosSetDetailType,
        'U'                                                                     as PosPrepaid, 
        NULL                                                                    as PosLongId,
        Count(*)                                                                as CdrCount,          
        SUM(DECODE(BD_CDRTID,'MM7O',0,1))                                       as CdrCountMO, 
        SUM(DECODE(BD_CDRTID,'MM7O',1,0))                                       as CdrCountMT,
        SUM(NVL(BD_AMOUNTTR,0.0 - NVL(BD_RETSHAREPV,0.0)))                      as Price,      -- Transport Charge to LA for these CDRs 
        SUM(NVL(BD_AMOUNTCU,0.0))                                               as AmountCu,      
        SUM(NVL(BD_RETSHAREPV,0.0))                                             as RevenueShareLa, 
        SUM(NVL(BD_RETSHAREMO,0.0))                                             as RevenueShareOp
    FROM BDETAIL6, CONTRACT                            
    WHERE BD_CONID = CON_ID 
    AND BD_BOHID3 = a_BOH_ID 
    AND BD_DATETIME > SYSDATE - a_MaxAge - 3/24   
    AND BD_DATETIME < SYSDATE + 3/24                   
    GROUP BY
        TRUNC(BD_DATETIME),                                                     -- PosDATETIME  --  029SO
        CON_PSCALL,                                                             -- PosMSISDN
        BD_CONID,                                                               -- PosConId
        BD_SHORTID,                                                             -- PosCONSOLIDATION
        CON_TARID,                                                              -- PosTarId
        NVL(CON_HDGROUP,0),                                                     -- PosHdGroup
        NVL(BD_INT,'0')                                                         -- PosInternational  
        -- 'CDRA',                                                              -- PosSetDetailType  
        -- 'U',                                                                 -- PosPrepaid 'U' = unknown/irrelevant
        -- NULL                                                                 -- PosLongId              
    ORDER by 1,2,3,4,5,6,7,8,9,10 
    ;

    l_ReturnStatus      NUMBER(1);

Begin

    RecordsAffected := 0;
    
    For C1_Rec in C1(p_BD_BOHID, p_MaxAge) Loop
        
        PKG_BDETAIL_SETTLEMENT.SP_ADD_SETDETAIL(  
                       'MLA',                                                   -- p_SET_ETID       IN varchar2,   
                       C1_Rec.PosSetDetailType,                                 -- p_SED_ETID       IN varchar2,
                       C1_Rec.PosMSISDN,                                        -- p_SED_CHARGE     IN varchar2,
                       p_BD_BOHID,                                              -- p_SED_BOHID      IN varchar2,
                       C1_Rec.PosDATETIME,                                      -- p_Date           IN DATE,
                       C1_Rec.PosConId,                                         -- p_SET_CONID      IN varchar2,
                       C1_Rec.PosTarId,                                         -- p_SED_TARID      IN varchar2,
                       C1_Rec.PosInternational,                                 -- p_SED_INT        IN varchar2,   
                       C1_Rec.PosPrepaid,                                       -- p_SED_PREPAID    IN varchar2,        
                       C1_Rec.Price - C1_Rec.RevenueShareLa,                    -- p_SED_PRICE      IN float,
                       C1_Rec.AmountCu,                                         -- p_SED_AMOUNTCU   IN float,           
                       C1_Rec.RevenueShareLa,                                   -- p_SED_RETSHAREPV IN float,           
                       C1_Rec.RevenueShareOp,                                   -- p_SED_RETSHAREMO IN float,           
                       C1_Rec.PosLongId,                                        -- p_SED_LONGID     IN varchar2,         
                       C1_Rec.CdrCountMT,                                       -- p_SED_COUNT1     IN number,
                       C1_Rec.CdrCountMO,                                       -- p_SED_COUNT2     IN number,
                       'accumulating',                                          -- p_SED_DESC       IN varchar2,
                       0,               -- C1_Rec.PosGart,                      -- p_GART           IN varchar2,    -- 027SO 
                       ErrorCode,                                               -- ErrorCode        OUT number,
                       ErrorMsg,                                                -- ErrorMsg         OUT varchar2,
                       l_ReturnStatus                                           -- ReturnStatus     IN OUT number
        );

        RecordsAffected :=   RecordsAffected + C1_Rec.CdrCount;
        
    End Loop;
    
    Return;
/*
Exception
  When Others Then
      ErrorCode := SqlCode;
      ErrorMsg  := SqlErrM;
      RecordsAffected := 0;
*/

End SP_LAA_MMSC_ACCU;

procedure SP_TRY_LAA_MMSC
(
  p_PAC_ID         IN       varchar2,       -- 'LAA_MMSC'   MMS-LA Accumulation (MMSC)
  p_BOH_ID         IN OUT   varchar2,
  RecordsAffected  OUT      number,
  ErrorCode        OUT      number,
  ErrorMsg         OUT      varchar2,
  ReturnStatus     OUT      number
)
Is  -- 023SO        Accumulate MMSC-LA submit CDRs as a first step in MMS-LA settlement

    CURSOR cCheckCandidate(max_age INTEGER) IS
    SELECT /*+ INDEX(BDETAIL6 IDX_BD_PACSID36) */ 'dummy'
    FROM BDETAIL6
    WHERE BD_DEMO = 0
    and BD_SRCTYPE='MMSC'
    and BD_PACSID3 = 'S'
    and BD_MAPSID = 'R'
    and BD_DATETIME > SYSDATE - max_age
    and BD_DATETIME < SYSDATE
    and ROWNUM <= 1
    ;

    l_max_age      INTEGER;
    l_batch_count  INTEGER;
    l_marked_count INTEGER;
    l_dummy        VARCHAR2(10);
    
BEGIN

    RecordsAffected := 0;
    ReturnStatus := PKG_COMMON.RETURN_STATUS_OK;        -- assume this for now
    
    l_max_age := to_number(PKG_COMMON_PACKING.getPackingParameter(p_PAC_ID,'MAXAGE'));
    l_batch_count := to_number(PKG_COMMON_PACKING.getPackingParameter(p_PAC_ID,'BATCHCOUNT'));
    
    l_dummy := NULL;
    OPEN cCheckCandidate(l_max_age);
    FETCH cCheckCandidate into l_dummy;
    CLOSE cCheckCandidate;
    
    if l_dummy is not NULL then

        PKG_COMMON_PACKING.INSERT_BOHEADER_SPTRY(p_PAC_ID, p_BOH_ID);            
        
        -- mark rows for processing
        update /*+ INDEX(BDETAIL6 IDX_BD_PACSID36) */ BDETAIL6 set
            BD_BOHID3 = p_BOH_ID,
            BD_PACSID3 = 'P'
        where BD_DEMO = 0
        and BD_SRCTYPE='MMSC'
        and BD_PACSID3 = 'S'
        and BD_MAPSID = 'R'
        and BD_DATETIME > SYSDATE - l_max_age
        and BD_DATETIME < SYSDATE
        and ROWNUM <= l_batch_count
        ;
        l_marked_count := Sql%rowcount;
        
        if l_marked_count > 0 then
        
            SP_LAA_MMSC_ACCU(
              l_marked_count,
              p_BOH_ID,
              l_max_age,
              ErrorCode,
              ErrorMsg,
              RecordsAffected
            );
    
            if RecordsAffected = l_marked_count then
                -- mark rows as processed                                       
                update BDETAIL6 set 
                    BD_PACSID3 = 'D'  
                where   BD_BOHID3=p_BOH_ID
                and     BD_PACSID3 = 'P'
                and     BD_DATETIME > SYSDATE - l_max_age - 1/24                -- 034SO
                ;
                l_marked_count := Sql%rowcount;
                
                UPDATE BOHEADER set (
                    BOH_DATEFC, BOH_DATELC
                ) = (
                    SELECT MIN(BD_DATETIME), MAX(BD_DATETIME) 
                    FROM BDETAIL6 
                    WHERE BD_BOHID3=p_BOH_ID 
                    AND   BD_DATETIME > SYSDATE - l_max_age - 1/24              -- 034SO
                )
                WHERE boh_id = p_BOH_ID;

            else
                ROLLBACK;
                PKG_COMMON.INSERT_WARNING(    
                     'MMSC-LA SETTLEMENT',
                     'PKG_BDETAIL_SETTLEMENT.SP_TRY_LAA_MMSC',
                     'PROCESSING ERROR',
                     'Mismatch in marked/processed SMS CDR counts (' || l_marked_count || '/' || RecordsAffected || ')',
                     NULL,
                     p_BOH_ID
                );
                ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
            end if;         
        end if;
    end if;

exception

    when PKG_COMMON.EXCP_INCONVENIENT_TIME then                                 
        ErrorCode := PKG_COMMON.ENO_INCONVENIENT_TIME;         
        ErrorMsg := PKG_COMMON.EDESC_INCONVENIENT_TIME;  
        ReturnStatus := PKG_COMMON.RETURN_STATUS_SUSPENDED;
        ROLLBACK;
/*        
    when PKG_COMMON_PACKING.EXCP_STATISTICS_FAILURE then
        ErrorCode := PKG_COMMON_PACKING.ENO_STATISTICS_FAILURE;         
        ErrorMsg := PKG_COMMON_PACKING.EDESC_STATISTICS_FAILURE;  
        ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;                     
        ROLLBACK;
    when PKG_COMMON_PACKING.EXCP_WORKFLOW_ABORT then
        ErrorCode := PKG_COMMON_PACKING.ENO_WORKFLOW_ABORT;         
        ErrorMsg := PKG_COMMON_PACKING.EDESC_WORKFLOW_ABORT;  
        ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;                     
        ROLLBACK;
    when Others then
        ErrorCode := SqlCode;
        ErrorMsg  := SqlErrM;
        ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;  
        RecordsAffected := 0;
        ROLLBACK;
*/
 
END SP_TRY_LAA_MMSC;


procedure SP_CONS_LAT_MMS(
  p_PAC_ID         IN       varchar2,       -- 'LAT_MMS'    MMS-LA daily UFIH Ticket
  p_BOH_ID         IN       varchar2,
  RecordsAffected  OUT      number,
  ErrorCode        OUT      number,
  ErrorMsg         OUT      varchar2,
  ReturnStatus     OUT      number
)
Is  --  031SO Consolidate MMS-LA daily UFIH tickets from accumulated settlement details

    l_min_age      INTEGER;
    l_max_age      INTEGER;
    l_gart         INTEGER;
    l_marked_count INTEGER;
    
BEGIN

    ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
    RecordsAffected := 0;
    ReturnStatus := PKG_COMMON.RETURN_STATUS_OK;        -- assume this for now

    l_min_age := to_number(PKG_COMMON_PACKING.getPackingParameter(p_PAC_ID,'MINAGE'));
    l_max_age := to_number(PKG_COMMON_PACKING.getPackingParameter(p_PAC_ID,'MAXAGE'));
    l_gart := to_number(PKG_COMMON_PACKING.getPackingParameter(p_PAC_ID,'GART'));
           
    -- mark rows for processing
    UPDATE SETDETAIL SET
        SED_ESID = 'P',
        SED_GOHID = p_BOH_ID
    Where SED_ESID = 'A' 
    AND SED_ORDER > to_char(sysdate-l_max_age,'YYYY-MM-DD')
    AND SED_ORDER < to_char(sysdate-l_min_age,'YYYY-MM-DD')
    AND SED_ETID IN ('CDRA')                                                    -- 028SO
    AND SED_SETID IN (SELECT SET_ID FROM SETTLING WHERE SET_ETID IN ('MLA'))    -- 028SO
    ; 
    l_marked_count := Sql%rowcount;
    
    if l_marked_count > 0 then
    
        PKG_BDETAIL_SETTLEMENT.SP_LAT_CDR(
            p_BOH_ID,                                                           -- p_BD_BOHID      In      Varchar2,
            'MLA',                                                              -- p_SET_ETID      IN      varchar2, -- 028SO
            l_gart,                                                             -- p_Gart          In      Number,
            l_min_age,                                                          -- p_MinAge        In      Number,
            l_max_age,                                                          -- p_MaxAge        In      Number,
            ErrorCode,                                                          -- ErrorCode       Out     Number,
            ErrorMsg,                                                           -- ErrorMsg        Out     Varchar2,
            RecordsAffected                                                     -- RecordsAffected Out     Number
        );

        if RecordsAffected = l_marked_count then
            -- set marked rows to valid                                       
            update SETDETAIL set 
                SED_ESID = 'V' 
            where SED_ESID = 'P'
            AND SED_GOHID = p_BOH_ID
            AND SED_ORDER > to_char(sysdate-l_max_age,'YYYY-MM-DD')
            AND SED_ORDER < to_char(sysdate-l_min_age,'YYYY-MM-DD')
 
            ;
            l_marked_count := Sql%rowcount;
            
            UPDATE BOHEADER set (
                BOH_DATEFC, BOH_DATELC
            ) = (
                SELECT MIN(to_date(SED_ORDER,'YYYY-MM-DD HH24:MI:SS')), MAX(to_date(SED_ORDER,'YYYY-MM-DD HH24:MI:SS'))
                FROM SETDETAIL
                WHERE SED_ESID = 'V'
                AND SED_GOHID = p_BOH_ID
                AND SED_ORDER > to_char(sysdate-l_max_age,'YYYY-MM-DD')
                AND SED_ORDER < to_char(sysdate-l_min_age,'YYYY-MM-DD')
            )
            WHERE boh_id = p_BOH_ID;                                            -- 028SO

            ReturnStatus := PKG_COMMON.RETURN_STATUS_OK;

        else  -- RecordsAffected <> l_marked_count
            ROLLBACK;
            PKG_COMMON.INSERT_WARNING(    
                 'MMS-LA SETTLEMENT',
                 'PKG_BDETAIL_SETTLEMENT.SP_CONS_LAT_MMS',
                 'PROCESSING ERROR',
                 'Mismatch in marked/processed MMS CDR counts (' || l_marked_count || '/' || RecordsAffected || ')',
                 NULL,
                 p_BOH_ID
            );
        end if;  -- RecordsAffected = l_marked_count        
    end if;  -- l_marked_count > 0

exception

    when PKG_COMMON.EXCP_INCONVENIENT_TIME then                                 
        ErrorCode := PKG_COMMON.ENO_INCONVENIENT_TIME;         
        ErrorMsg := PKG_COMMON.EDESC_INCONVENIENT_TIME;  
        ReturnStatus := PKG_COMMON.RETURN_STATUS_SUSPENDED;
        ROLLBACK;
/*  --  023SO
    when PKG_COMMON_PACKING.EXCP_STATISTICS_FAILURE then
        ErrorCode := PKG_COMMON_PACKING.ENO_STATISTICS_FAILURE;         
        ErrorMsg := PKG_COMMON_PACKING.EDESC_STATISTICS_FAILURE;  
        ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;                     
        ROLLBACK;
    when PKG_COMMON_PACKING.EXCP_WORKFLOW_ABORT then
        ErrorCode := PKG_COMMON_PACKING.ENO_WORKFLOW_ABORT;         
        ErrorMsg := PKG_COMMON_PACKING.EDESC_WORKFLOW_ABORT;  
        ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;                     
        ROLLBACK;
    when Others then
        ErrorCode := SqlCode;
        ErrorMsg  := SqlErrM;
        ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;  
        RecordsAffected := 0;
        ROLLBACK;
*/

END SP_CONS_LAT_MMS;

procedure SP_CONS_LAM_MMS
(
   p_PAC_ID         IN varchar2,        -- 'LATMCC_MMS'     MMS-LA MCC UFIH Ticket        
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     OUT number )
IS  -- 029SO

    l_gart         INTEGER;

Begin

    l_gart := to_number(PKG_COMMON_PACKING.getPackingParameter(p_PAC_ID,'GART'));

    PKG_BDETAIL_SETTLEMENT.SP_LAM_MCC(
        p_PAC_ID,                   -- IN varchar2,
        p_BOH_ID,                   -- IN varchar2,
        'MLA',        --p_SET_ETID  -- IN varchar2,   -- SLA or MLA
        l_gart,       --p_Gart      -- In Number,      --016SO
        RecordsAffected,            -- OUT number,
        ErrorCode,                  -- OUT number,
        ErrorMsg,                   -- OUT varchar2,
        ReturnStatus                -- OUT number 
    );

END SP_CONS_LAM_MMS;



Procedure SP_LIA_MMSC_ACCU
( BatchSize       In      Integer,
  p_BD_BOHID      In      Varchar2,
  p_MaxAge        In      Number,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  RecordsAffected Out     Number
)
Is  -- 031SO

  Cursor C1 (a_BOH_ID Varchar2, a_MaxAge Number) Is
    SELECT /*+ INDEX(BDETAIL6 IDX_BD_PACSID26) */
        TRUNC(BD_DATETIME)                                                      as PosDATETIME,         
        CON_PSCALL                                                              as PosMSISDN,                                                
        BD_CONID                                                                as PosConId,                                                   
        BD_SHORTID                                                              as PosCONSOLIDATION,                                   
        CON_TARID                                                               as PosTarId,                                                  
        -- NULL                                                                    as PosHdGroup,                                              
        -- NULL                                                                    as PosInternational,  
        -- 'IOTLACA'                                                               as PosSetDetailType,
        -- 'U'                                                                     as PosPrepaid, 
        -- NULL                                                                    as PosLongId,
        Count(*)                                                                as CdrCount,          
        0                                                                       as CdrCountMO, 
        SUM(DECODE(BD_IOT_INTERNAL,0.0,0,NULL,0,1))                             as CdrCountMT,  -- 035SO -- count nonzero IOTs
        SUM(NVL(BD_IOT_INTERNAL,0.00))                                          as Price,       -- 037SO -- 035SO -- IOT to LA for these CDRs
        0.0                                                                     as AmountCu,      
        0.0                                                                     as RevenueShareLa, 
        0.0                                                                     as RevenueShareOp
    FROM BDETAIL6, CONTRACT                            
    WHERE BD_CONID = CON_ID 
    AND BD_BOHID2 = a_BOH_ID 
    AND BD_DATETIME > SYSDATE - a_MaxAge - 3/24   
    AND BD_DATETIME < SYSDATE + 3/24                   
    GROUP BY
        TRUNC(BD_DATETIME),                                                     -- PosDATETIME  --  029SO
        CON_PSCALL,                                                             -- PosMSISDN
        BD_CONID,                                                               -- PosConId
        BD_SHORTID,                                                             -- PosCONSOLIDATION
        CON_TARID                                                               -- PosTarId
        -- NVL(CON_HDGROUP,0),                                                  -- PosHdGroup
        -- NVL(BD_INT,'0')                                                      -- PosInternational  
        -- 'CDRA',                                                              -- PosSetDetailType  
        -- 'U',                                                                 -- PosPrepaid 'U' = unknown/irrelevant
        -- NULL                                                                 -- PosLongId              
    ORDER by 1,2,3,4,5 
    ;

    l_ReturnStatus      NUMBER(1);

Begin

    RecordsAffected := 0;
    
    For C1_Rec in C1(p_BD_BOHID, p_MaxAge) Loop

        PKG_BDETAIL_SETTLEMENT.SP_ADD_SETDETAIL(  
                       'MLA',                                                   -- p_SET_ETID       IN varchar2,   
                       'IOTLACA',           -- C1_Rec.PosSetDetailType,         -- p_SED_ETID       IN varchar2,
                       C1_Rec.PosMSISDN,                                        -- p_SED_CHARGE     IN varchar2,
                       p_BD_BOHID,                                              -- p_SED_BOHID      IN varchar2,
                       C1_Rec.PosDATETIME,                                      -- p_Date           IN DATE,
                       C1_Rec.PosConId,                                         -- p_SET_CONID      IN varchar2,
                       C1_Rec.PosTarId,                                         -- p_SED_TARID      IN varchar2,
                       NULL,                -- C1_Rec.PosInternational,         -- p_SED_INT        IN varchar2,   
                       'U',                 -- C1_Rec.PosPrepaid,               -- p_SED_PREPAID    IN varchar2,        
                       C1_Rec.Price,                                            -- p_SED_PRICE      IN float,       -- 035SO
                       C1_Rec.AmountCu,                                         -- p_SED_AMOUNTCU   IN float,           
                       C1_Rec.RevenueShareLa,                                   -- p_SED_RETSHAREPV IN float,           
                       C1_Rec.RevenueShareOp,                                   -- p_SED_RETSHAREMO IN float,           
                       NULL,                -- C1_Rec.PosLongId,                -- p_SED_LONGID     IN varchar2,         
                       C1_Rec.CdrCountMT,                                       -- p_SED_COUNT1     IN number,
                       C1_Rec.CdrCountMO,                                       -- p_SED_COUNT2     IN number,
                       'accumulating',                                          -- p_SED_DESC       IN varchar2,
                       0,               -- C1_Rec.PosGart,                      -- p_GART           IN varchar2,    -- 027SO 
                       ErrorCode,                                               -- ErrorCode        OUT number,
                       ErrorMsg,                                                -- ErrorMsg         OUT varchar2,
                       l_ReturnStatus                                           -- ReturnStatus     IN OUT number
        );

        RecordsAffected :=   RecordsAffected + C1_Rec.CdrCount;
        
    End Loop;
    
    Return;
/*
Exception
  When Others Then
      ErrorCode := SqlCode;
      ErrorMsg  := SqlErrM;
      RecordsAffected := 0;
*/

End SP_LIA_MMSC_ACCU;



procedure SP_TRY_LIA_MMSC
(
  p_PAC_ID         IN       varchar2,       -- 'LIA_MMSC'   MMS-LA IW Accumulation (MMSC)
  p_BOH_ID         IN OUT   varchar2,
  RecordsAffected  OUT      number,
  ErrorCode        OUT      number,
  ErrorMsg         OUT      varchar2,
  ReturnStatus     OUT      number
)
Is  -- 031SO        Accumulate MMSC-LA IW CDRs as a first step in MMS-LA IW settlement

    CURSOR cCheckCandidate(max_age INTEGER) IS
    SELECT /*+ INDEX(BDETAIL6 IDX_BD_PACSID26) */ 'dummy'
    FROM BDETAIL6
    WHERE BD_DEMO = 0
    and BD_SRCTYPE='MMSC'
    and BD_PACSID2 = 'S'
    and BD_MAPSID = 'R'
    and BD_DATETIME > SYSDATE - max_age
    and BD_DATETIME < SYSDATE
    and ROWNUM <= 1
    ;

    l_max_age      INTEGER;
    l_batch_count  INTEGER;
    l_marked_count INTEGER;
    l_dummy        VARCHAR2(10);
    
BEGIN

    RecordsAffected := 0;
    ReturnStatus := PKG_COMMON.RETURN_STATUS_OK;        -- assume this for now
    
    l_max_age := to_number(PKG_COMMON_PACKING.getPackingParameter(p_PAC_ID,'MAXAGE'));
    l_batch_count := to_number(PKG_COMMON_PACKING.getPackingParameter(p_PAC_ID,'BATCHCOUNT'));
    
    l_dummy := NULL;
    OPEN cCheckCandidate(l_max_age);
    FETCH cCheckCandidate into l_dummy;
    CLOSE cCheckCandidate;
    
    if l_dummy is not NULL then

        PKG_COMMON_PACKING.INSERT_BOHEADER_SPTRY(p_PAC_ID, p_BOH_ID);            
        
        -- mark rows for processing
        update /*+ INDEX(BDETAIL6 IDX_BD_PACSID26) */ BDETAIL6 set
            BD_BOHID2 = p_BOH_ID,
            BD_PACSID2 = 'P',
            BD_IOT = DECODE(BD_TARID,'P',0.0,'Q',0.0,'R',0.0,'S',0.0,'T',0.0,'X',0.0,'V',0.0,NVL(CONTRACT_IOT_CHF(BD_TOCID,'ORIG','MMS',BD_DATETIME,BD_MSGSIZE),0.00)),     -- 038SO -- 035SO
            BD_IOT_INTERNAL = NVL(CONTRACT_IOT_CHF(BD_TOCID,'ORIG','MMS',BD_DATETIME,BD_MSGSIZE),0.00)        -- 035SO
        where BD_DEMO = 0
        and BD_SRCTYPE='MMSC'
        and BD_PACSID2 = 'S'
        and BD_MAPSID = 'R'
        and BD_DATETIME > SYSDATE - l_max_age
        and BD_DATETIME < SYSDATE
        and ROWNUM <= l_batch_count
        ;
        l_marked_count := Sql%rowcount;
        
        if l_marked_count > 0 then
        
            SP_LIA_MMSC_ACCU(
              l_marked_count,
              p_BOH_ID,
              l_max_age,
              ErrorCode,
              ErrorMsg,
              RecordsAffected
            );
    
            if RecordsAffected = l_marked_count then
                -- mark rows as processed                                       
                update BDETAIL6 set 
                    BD_PACSID2 = 'D'  
                where   BD_BOHID2=p_BOH_ID
                and     BD_PACSID2 = 'P'
                and     BD_DATETIME > SYSDATE - l_max_age - 1/24                -- 034SO
                ;
                l_marked_count := Sql%rowcount;
                
                UPDATE BOHEADER set (
                    BOH_DATEFC, BOH_DATELC
                ) = (
                    SELECT MIN(BD_DATETIME), MAX(BD_DATETIME) 
                    FROM BDETAIL6 
                    WHERE BD_BOHID2=p_BOH_ID 
                    AND   BD_DATETIME > SYSDATE - l_max_age - 1/24              -- 034SO
                )
                WHERE boh_id = p_BOH_ID;

            else
                ROLLBACK;
                PKG_COMMON.INSERT_WARNING(    
                     'MMSC-LA SETTLEMENT',
                     'PKG_BDETAIL_SETTLEMENT.SP_TRY_LIA_MMSC',
                     'PROCESSING ERROR',
                     'Mismatch in marked/processed SMS CDR counts (' || l_marked_count || '/' || RecordsAffected || ')',
                     NULL,
                     p_BOH_ID
                );
                ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
            end if;         
        end if;
    end if;

exception

    when PKG_COMMON.EXCP_INCONVENIENT_TIME then                                 
        ErrorCode := PKG_COMMON.ENO_INCONVENIENT_TIME;         
        ErrorMsg := PKG_COMMON.EDESC_INCONVENIENT_TIME;  
        ReturnStatus := PKG_COMMON.RETURN_STATUS_SUSPENDED;
        ROLLBACK;
/*        
    when PKG_COMMON_PACKING.EXCP_STATISTICS_FAILURE then
        ErrorCode := PKG_COMMON_PACKING.ENO_STATISTICS_FAILURE;         
        ErrorMsg := PKG_COMMON_PACKING.EDESC_STATISTICS_FAILURE;  
        ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;                     
        ROLLBACK;
    when PKG_COMMON_PACKING.EXCP_WORKFLOW_ABORT then
        ErrorCode := PKG_COMMON_PACKING.ENO_WORKFLOW_ABORT;         
        ErrorMsg := PKG_COMMON_PACKING.EDESC_WORKFLOW_ABORT;  
        ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;                     
        ROLLBACK;
    when Others then
        ErrorCode := SqlCode;
        ErrorMsg  := SqlErrM;
        ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;  
        RecordsAffected := 0;
        ROLLBACK;
*/
 
END SP_TRY_LIA_MMSC;


procedure SP_CONS_LIT_MMS(
  p_PAC_ID         IN       varchar2,       -- 'LIT_MMS'    MMS-LA daily UFIH Ticket
  p_BOH_ID         IN       varchar2,
  RecordsAffected  OUT      number,
  ErrorCode        OUT      number,
  ErrorMsg         OUT      varchar2,
  ReturnStatus     OUT      number
)
Is  -- 032SO Consolidate MMS-LA IW daily UFIH tickets from accumulated settlement details

    l_min_age      INTEGER;
    l_max_age      INTEGER;
    l_gart         INTEGER;
    l_marked_count INTEGER;
    
BEGIN

    ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
    RecordsAffected := 0;
    ReturnStatus := PKG_COMMON.RETURN_STATUS_OK;        -- assume this for now

    l_min_age := to_number(PKG_COMMON_PACKING.getPackingParameter(p_PAC_ID,'MINAGE'));
    l_max_age := to_number(PKG_COMMON_PACKING.getPackingParameter(p_PAC_ID,'MAXAGE'));
    l_gart := to_number(PKG_COMMON_PACKING.getPackingParameter(p_PAC_ID,'GART'));
           
    -- mark rows for processing
    UPDATE SETDETAIL SET
        SED_ESID = 'P',
        SED_GOHID = p_BOH_ID
    Where SED_ESID = 'A' 
    AND SED_ORDER > to_char(sysdate-l_max_age,'YYYY-MM-DD')
    AND SED_ORDER < to_char(sysdate-l_min_age,'YYYY-MM-DD')
    AND SED_ETID IN ('IOTLACA')                                                 -- 028SO
    AND SED_SETID IN (SELECT SET_ID FROM SETTLING WHERE SET_ETID IN ('MLA'))    -- 028SO
    ; 
    l_marked_count := Sql%rowcount;
    
    if l_marked_count > 0 then
    
        PKG_BDETAIL_SETTLEMENT.SP_LIT_CDR(
            p_BOH_ID,                                                           -- p_BD_BOHID      In      Varchar2,
            'MLA',                                                              -- p_SET_ETID      IN      varchar2, -- 028SO
            l_gart,                                                             -- p_Gart          In      Number,
            l_min_age,                                                          -- p_MinAge        In      Number,
            l_max_age,                                                          -- p_MaxAge        In      Number,
            ErrorCode,                                                          -- ErrorCode       Out     Number,
            ErrorMsg,                                                           -- ErrorMsg        Out     Varchar2,
            RecordsAffected                                                     -- RecordsAffected Out     Number
        );

        if RecordsAffected = l_marked_count then
            -- set marked rows to valid                                       
            update SETDETAIL set 
                SED_ESID = 'V' 
            where SED_ESID = 'P'
            AND SED_GOHID = p_BOH_ID
            AND SED_ORDER > to_char(sysdate-l_max_age,'YYYY-MM-DD')
            AND SED_ORDER < to_char(sysdate-l_min_age,'YYYY-MM-DD')
 
            ;
            l_marked_count := Sql%rowcount;
            
            UPDATE BOHEADER set (
                BOH_DATEFC, BOH_DATELC
            ) = (
                SELECT MIN(to_date(SED_ORDER,'YYYY-MM-DD HH24:MI:SS')), MAX(to_date(SED_ORDER,'YYYY-MM-DD HH24:MI:SS'))
                FROM SETDETAIL
                WHERE SED_ESID = 'V'
                AND SED_GOHID = p_BOH_ID
                AND SED_ORDER > to_char(sysdate-l_max_age,'YYYY-MM-DD')
                AND SED_ORDER < to_char(sysdate-l_min_age,'YYYY-MM-DD')
            )
            WHERE boh_id = p_BOH_ID;                                            -- 028SO

            ReturnStatus := PKG_COMMON.RETURN_STATUS_OK;

        else  -- RecordsAffected <> l_marked_count
            ROLLBACK;
            PKG_COMMON.INSERT_WARNING(    
                 'MMS-LA SETTLEMENT',
                 'PKG_BDETAIL_SETTLEMENT.SP_CONS_LIT_MMS',
                 'PROCESSING ERROR',
                 'Mismatch in marked/processed MMS CDR counts (' || l_marked_count || '/' || RecordsAffected || ')',
                 NULL,
                 p_BOH_ID
            );
        end if;  -- RecordsAffected = l_marked_count        
    end if;  -- l_marked_count > 0

exception

    when PKG_COMMON.EXCP_INCONVENIENT_TIME then                                 
        ErrorCode := PKG_COMMON.ENO_INCONVENIENT_TIME;         
        ErrorMsg := PKG_COMMON.EDESC_INCONVENIENT_TIME;  
        ReturnStatus := PKG_COMMON.RETURN_STATUS_SUSPENDED;
        ROLLBACK;
/*  --  023SO
    when PKG_COMMON_PACKING.EXCP_STATISTICS_FAILURE then
        ErrorCode := PKG_COMMON_PACKING.ENO_STATISTICS_FAILURE;         
        ErrorMsg := PKG_COMMON_PACKING.EDESC_STATISTICS_FAILURE;  
        ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;                     
        ROLLBACK;
    when PKG_COMMON_PACKING.EXCP_WORKFLOW_ABORT then
        ErrorCode := PKG_COMMON_PACKING.ENO_WORKFLOW_ABORT;         
        ErrorMsg := PKG_COMMON_PACKING.EDESC_WORKFLOW_ABORT;  
        ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;                     
        ROLLBACK;
    when Others then
        ErrorCode := SqlCode;
        ErrorMsg  := SqlErrM;
        ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;  
        RecordsAffected := 0;
        ROLLBACK;
*/

END SP_CONS_LIT_MMS;

End; -- Package Body PKG_BDETAIL_MMSC
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- PKG_BDETAIL_MSC  (Package Body) 
--
CREATE OR REPLACE PACKAGE BODY SBS1_ADMIN.PKG_BDETAIL_MSC as


--  MODIFICATION HISTORY (for details see VSS repository)
--  Person      Date        Comments
--  001SO       31.03.2004  Suppress Output before CutoffDate April 1st (not wanted at that time)
--  002SO       28.04.2004  Move cutoff back to March 1st for reprocessing March data)
--  003SO       21.10.2004  Rebuild index partitions instead of using default tablespace
--  004SO       21.10.2004  Compile all in error case too
--  005SO       16.08.2006  Add period entry by using PKG_BDETAIL_COMMON.SP_INSERT_PERIOD()
--  006SO       21.01.2008  Remove SP_INSERT_MSC, SP_DELETE_BDETAIL_MSC, SP_DELETE_ALL_RECORDS_MSC
--  007SO       31.10.2009  Move Period Insert to standalone Procedure
--  008SO       31.03.2010  Implement SP_MSCCU_TRY (mark and process MSC counter updates)
--  009SO       15.04.2010  Update the packing state after marked process
--  010SO       26.08.2010  Rename procedures according to driving Packing-ID
--  011SO       14.12.2011  Remove schema qualifier "S B S 0 ."

  cstrCutoffDateTime    Varchar2(20) := '2004-03-01 00:00:00';                  --  002SO --  001SO

Function GET_SMSC_ID
( p_BD_SCA        In      Varchar2,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  ReturnStatus    In Out  Number
) Return Varchar2
Is
  l_SMSC_CODE     Varchar2(20);
  l_SMSC_ID       Varchar2(10);
  Cursor C1(a_SMSC_CODE Varchar2) Is
    Select SMSC_ID
    From SMSC
    Where SMSC_CODE = a_SMSC_CODE;
Begin
  l_SMSC_CODE := p_BD_SCA;
  Open C1(l_SMSC_CODE);
  Fetch C1 Into l_SMSC_ID;
  If C1%Found Then
    -- Smsc Id for given Code found, do nothing, just return the Smsc Id
    Null;
  Else
    -- Smsc Id for given Code not found, do something, add the given Code
    -- to the dummy Operator Contract 'UNKNOWNTOC'. And then returnt the
    -- Smsc Id of the newly added Smsc Code
    l_SMSC_ID := ADD_SMSC_CODE_TO_UNKNOWN_TOC(l_SMSC_CODE, ErrorCode, ErrorMsg, ReturnStatus);
  End If;
  Close C1;
  Returnstatus := 1;
  Return l_SMSC_ID;
  -- Commit; -- $$
Exception
  When Others Then
    ErrorCode := SqlCode;
    ErrorMsg  := substr(SqlErrM,1,50);
    Returnstatus := 0;
    Return '';
  --RollBack;
End GET_SMSC_ID;

Function ADD_SMSC_CODE_TO_UNKNOWN_TOC
( p_SMSC_CODE     In      Varchar2,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  ReturnStatus    In Out  Number
)
Return Varchar2
Is
  l_SMSC_ID       Varchar2(10);
  l_SMSC_CODE     Varchar2(20);
  l_CON_OPKEY_of_UnknownToc     Varchar2(10);

Begin
  
  l_CON_OPKEY_of_UnknownToc := '0';
  
  Select GenerateUniqueKey('G') Into l_SMSC_ID From Dual;
  
  Insert Into SMSC (
    SMSC_ID,
    SMSC_CONOPKEY,
    SMSC_CODE,
    SMSC_DATECRE,
    SMSC_ACIDCRE,
    SMSC_CHNGCNT
  )
  Values (
    l_SMSC_ID,
    l_CON_OPKEY_of_UnknownToc,
    p_SMSC_CODE,
    SYSDATE,
    'ADMIN',
    0
  );
  Returnstatus := 1;
  Return l_SMSC_ID;
  -- Commit; -- $$
Exception
  When Others Then
    ErrorCode := SqlCode;
    ErrorMsg  := substr(SqlErrM,1,50);
    Returnstatus := 0;
    Return '';
  --RollBack;
End ADD_SMSC_CODE_TO_UNKNOWN_TOC;



Procedure SP_MSCCU_UPDATE(
  BatchSize       In      Integer,
  p_BD_SRCTYPE    In      Varchar2,
  p_BD_DEMO       In      Number,
  p_BD_PACSID     In      Varchar2,
  p_BD_BOHID      In      Varchar2,
  p_MaxAge        In      Number,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  RecordsAffected In Out  Number
)
Is
  l_Count         Number;
  l_BD_SMSCID     Varchar2(10);

  Cursor C1 (a_BOH_ID Varchar2, a_MaxAge Number) Is
    Select /*+ INDEX(BDETAIL4 IDX_BD_BOHID14) */
      BDETAIL4.ROWID,
      BD_SMSCID,
      BD_DATETIME
    From BDETAIL4
    Where BD_BOHID1 = a_BOH_ID
    And   BD_DATETIME > SYSDATE - a_MaxAge
    And   BD_DATETIME < SYSDATE + 3/24;

Begin

  RecordsAffected := 0;

  For C1_Rec in C1(p_BD_BOHID, p_MaxAge) Loop
    Begin

      l_BD_SMSCID := C1_Rec.BD_SMSCID;

      -- Increment the counter by 1 when updating the count for an existing SMSC ID
      Update IWTCOUNTER Set
        IWTC_COUNT = IWTC_COUNT + 1
      Where IWTC_SMSCID = l_BD_SMSCID
      AND IWTC_DATE = TRUNC(C1_Rec.BD_DATETIME)
      AND IWTC_ESID = 'A'
      ;
      If Sql%NotFound Then

        -- If the counter does not exist, insert a new one
        -- Initialise the counter with 1 when inserting the count for a new SMSC ID,
        -- set the Counter state to 'A'ccumulating
        Insert Into IWTCOUNTER ( IWTC_DATE, IWTC_SMSCID, IWTC_COUNT, IWTC_ESID)
          Values(TRUNC(C1_Rec.BD_DATETIME), l_BD_SMSCID , 1, 'A');
          RecordsAffected :=   RecordsAffected + 1;

      Else

        -- Counter was updated, ,increment the record count by the rows updated
        RecordsAffected :=   RecordsAffected + Sql%RowCount;

      End If;

    End;
  End Loop;
  -- commit; -- $$
  Return;
Exception
  When Others Then
  ErrorCode := SqlCode;
  ErrorMsg  := SqlErrM;
  RecordsAffected := 0;
End SP_MSCCU_UPDATE;

procedure SP_TRY_MSCCU
(
  p_PAC_ID         IN       varchar2,   -- 'MSCCU'
  p_BOH_ID         IN OUT   varchar2,
  RecordsAffected  OUT      number,
  ErrorCode        OUT      number,
  ErrorMsg         OUT      varchar2,
  ReturnStatus     OUT      number
)
Is  --  008SO

    CURSOR cCheckCandidate(max_age INTEGER) IS
    SELECT /*+ INDEX(BDETAIL4 IDX_BD_PACSID14) */ 'dummy'
    FROM   BDETAIL4
    where  BD_DEMO = 0
    and BD_SRCTYPE = 'MSC'
    and BD_MAPSID = 'R' 
    and ROWNUM <= 1
    and BD_CDRTID = 'MSC-MT' 
    and BD_IMSI like '22801%'
    and BD_PACSID1 = 'S' 
    and BD_DATETIME > SYSDATE - max_age
    and BD_DATETIME < SYSDATE + 3/24
    ;

    l_max_age      INTEGER;
    l_batch_count  INTEGER;
    l_marked_count INTEGER;
    l_dummy        VARCHAR2(10);
    
BEGIN

    RecordsAffected := 0;
    ReturnStatus := PKG_COMMON.RETURN_STATUS_OK;        -- assume this for now
    
    l_max_age := to_number(PKG_COMMON_PACKING.getPackingParameter(p_PAC_ID,'MAXAGE'));
    l_batch_count := to_number(PKG_COMMON_PACKING.getPackingParameter(p_PAC_ID,'BATCHCOUNT'));
    
    l_dummy := NULL;
    OPEN cCheckCandidate(l_max_age);
    FETCH cCheckCandidate into l_dummy;
    CLOSE cCheckCandidate;
    
    if l_dummy is not NULL then

        PKG_COMMON_PACKING.INSERT_BOHEADER_SPTRY(p_PAC_ID, p_BOH_ID);            
        
        -- mark rows for processing
        update /*+ INDEX(BDETAIL4 IDX_BD_PACSID14) */ BDETAIL4 set
            BD_BOHID1 = p_BOH_ID,
            BD_PACSID1 = 'P' 
        where BD_DEMO = 0
        and BD_SRCTYPE = 'MSC'
        and BD_MAPSID = 'R' 
        and ROWNUM <= l_batch_count
        and BD_CDRTID = 'MSC-MT' 
        and BD_IMSI like '22801%'
        and BD_PACSID1 = 'S' 
        and BD_DATETIME > SYSDATE - l_max_age
        and BD_DATETIME < SYSDATE + 3/24
        ;
        l_marked_count := Sql%rowcount;
        
        if l_marked_count > 0 then
        
            SP_MSCCU_UPDATE(
              l_marked_count,
              'MSC',
              0,
              NULL,
              p_BOH_ID,
              l_max_age,
              ErrorCode,
              ErrorMsg,
              RecordsAffected
            );
            
            if RecordsAffected = l_marked_count then
                -- mark rows as processed                                       --  009SO 
                update  /*+ INDEX(BDETAIL4 IDX_BD_BOHID14) */ BDETAIL4 set
                        BD_PACSID1 = 'D' 
                where   BD_BOHID1 = p_BOH_ID
                and     BD_PACSID1 = 'P'
                ;
                l_marked_count := Sql%rowcount;
            else
                ROLLBACK;
                PKG_COMMON.INSERT_WARNING(    
                     'SC TERMINATING SMS IW SETTLEMENT',
                     'PKG_BDETAIL_MSC.SP_MSCCA_TRY',
                     'PROCESSINg ERROR',
                     'Mismatch in marked/processed SMS CDR counts (' || l_marked_count || '/' || RecordsAffected || ')',
                     NULL,
                     p_BOH_ID
                );
                ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
            end if;         
        end if;
    end if;
    
exception

    when PKG_COMMON.EXCP_INCONVENIENT_TIME then                                 
        ErrorCode := PKG_COMMON.ENO_INCONVENIENT_TIME;         
        ErrorMsg := PKG_COMMON.EDESC_INCONVENIENT_TIME;  
        ReturnStatus := PKG_COMMON.RETURN_STATUS_SUSPENDED;
        ROLLBACK;
/*
    when PKG_COMMON_PACKING.EXCP_STATISTICS_FAILURE then
        ErrorCode := PKG_COMMON_PACKING.ENO_STATISTICS_FAILURE;         
        ErrorMsg := PKG_COMMON_PACKING.EDESC_STATISTICS_FAILURE;  
        ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;                     
        ROLLBACK;
    when PKG_COMMON_PACKING.EXCP_WORKFLOW_ABORT then
        ErrorCode := PKG_COMMON_PACKING.ENO_WORKFLOW_ABORT;         
        ErrorMsg := PKG_COMMON_PACKING.EDESC_WORKFLOW_ABORT;  
        ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;                     
        ROLLBACK;
    when Others then
        ErrorCode := SqlCode;
        ErrorMsg  := SqlErrM;
        ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;  
        RecordsAffected := 0;
        ROLLBACK;
*/ 
END SP_TRY_MSCCU;



End; -- Package Body PKG_BDETAIL_MSC
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- PKG_BDETAIL_SETTLEMENT  (Package Body) 
--
CREATE OR REPLACE PACKAGE BODY SBS1_ADMIN.PKG_BDETAIL_SETTLEMENT
IS
--
-- To modify this template, edit file PKGBODY.TXT in TEMPLATE
-- directory of SQL Navigator
--
-- Purpose: Briefly explain the functionality of the package body
--
-- MODIFICATION HISTORY
--Person    Date        Comments
--001SO     18.06.2004  Added settlement parameters for mVoting
--002SO     21.06.2004  Change error handling in SP_ADD_SETDETAIL_BY_DATE, SP_INSERT_SETDETAIL and SP_INSERT_SETTLING
--003SO     22.05.2009  Add LongId to settlement detail insert signatures (for SMS Global Reply)
--                        use VARCHAR2(20) as datatype to make the field nullable
--004SO     27.05.2009  Add function NextAvailableDatetime
--005SO     05.06.2009  Reset LongID to 0 if not in table LONG_ID
--006SO     20.08.2010  Implement SP_ADD_SETDETAIL (simplifying stub for SP_ADD_SETDETAIL_BY_DATE)
--007SO     20.08.2010  Implement SP_MOLAT_CDR_AGR (generate CDRs for aggregated records)
--008SO     20.08.2010  Implement FUNCTION billTextLa (UFIH ticket Remark field content for LA)
--009SO     20.08.2010  Implement FUNCTION nextAvailableTimestamp
--010SO     23.08.2010  Correct typo
--011SO     23.08.2010  Remove exception handlers in new procedure
--012SO     23.08.2010  Add MOLAT Consolidation for MO messages
--013SO     23.08.2010  Implement UFIH rendering in SP_ADD_SETDETAIL
--014SO     24.08.2010  Implement SP_PREPARE_LA_MCC generically for SLA and MLA
--015SO     24.08.2010  Implement SP_MOLAM_CONS (Minimum Charge Consolidation)
--016SO     25.08.2010  Accept GART as input parameter in SP_MOLAM_CONS
--017SO     26.08.2010  Rename procedures according to driving Packing-ID
--018SO     31.08.2010  Implement SP_LIT_CDR (Ticket generation for SMS/MMS IW fees)
--019SO     06.09.2010  Implement SP_CONS_INSERT_PERIOD
--020SO     06.09.2010  Simplify error handling in INSERT_SETDETAIL
--021SO     07.09.2010  Calculate time offset per CDR
--022SO     07.09.2010  Use correct amount variable for MO tickets
--023SO     07.09.2010  Correct error return variables
--024SO     07.09.2010  Use correct settlement detail type 'IOTLACT' for IW tickets
--025SO     08.09.2010  Implement schedule option for UFUH generation (for MOIWST)
--026SO     08.09.2010  Correct numeric Format for UFIH F5
--027SO     18.09.2010  Round Settlement items to 2 digits
--028SO     18.09.2010  Suppress zero (counts=0 and price=0.00) UFIH CDRs of all types now
--029SO     18.09.2010  Patch UFIH-Price to 0.00 for all internal LA
--030SO     11.04.2011  Treat Tariff T (Televote) as Info Service
--031SO     14.12.2011  Remove schema qualifier "S B S 0 ."
--032SO     18.04.2012  Use PKG_COMMON.INSERT_WARNING
--033SO     09.08.2016  Suppress Tariff 'i' interworking costs in UFIH
--034SO     16.10.2016  Removing latest change --033SO and fully trust zero rating for internal LA and Triff i
--035SO     16.10.2016  Remove references to mVoting CDR Tags SMS-MV*
--036SO     12.07.2017  Compress LongId ranges if outside 'official' block 4179807...
--037SO     03.08.2017  Add missing date format
--038SO     04.08.2017  Remove support for Tariff 'M' (M-Voting)
--039SO     01.12.2017  Fix logging typo
--039SO     16.04.2018  Settle pager messages also (PAG)
--040SO     15.11.2018  Remove reference to CON_DEMO

cstrOfficialLongId    Varchar2(20) := '4179807%';                               --036SO

FUNCTION ufihRendered (
    p_SED_DATE          IN varchar2,
    p_SED_CHARGE        IN varchar2,
    p_SED_PRICE         IN float,
    p_SED_DESC          IN varchar2,
    p_GART              IN number,
    p_SED_TARID         IN varchar2
) RETURN    VARCHAR2
IS  --013SO -- Return UFIH string for CDR

    l_result            VARCHAR2(400);

    l_BillTextPrefix    VARCHAR2(80);

    c_STARTSTRING       VARCHAR2(1) := '{';
    c_ENDSTRING         VARCHAR2(1) := '}';
    c_CHARSTART         VARCHAR2(1) := '''';
    c_CHAREND           VARCHAR2(1) := '''';
    c_DATETIMESTART     VARCHAR2(1) := '@';
    c_DATETIMEEND       VARCHAR2(1) := NULL;

    l_fixedPrefix       VARCHAR2(100);
    l_datestring        VARCHAR2(20);
    l_TaxAmountStr      VARCHAR2(20);

BEGIN

    l_datestring := REPLACE(p_SED_DATE,':','');
    l_datestring := REPLACE(l_datestring,'-','');
    l_datestring := REPLACE(l_datestring,' ','');

    l_TaxAmountStr := trim(to_char(p_SED_PRICE,'999990.00'));                   --038SO --026SO

    l_BillTextPrefix := '0' || SUBSTR(p_SED_CHARGE,3) || '                       ';
    l_BillTextPrefix := SUBSTR(l_BillTextPrefix,1,24) || '+00000';

    l_fixedPrefix := 'F3=1,F7=21,F29=3,F32=''00001000''';

    l_result := c_STARTSTRING || l_fixedPrefix;
    l_result := l_result || ',F17=' || c_DATETIMESTART || l_datestring || c_DATETIMEEND;
    l_result := l_result || ',F10=' || p_SED_CHARGE;
    l_result := l_result || ',F5=' || Trim(l_TaxAmountStr);
    l_result := l_result || ',F23=' || Trim(p_GART);
    l_result := l_result || ',F30=' || c_CHARSTART || l_BillTextPrefix || p_SED_DESC || c_CHAREND;
    l_result := l_result || c_ENDSTRING;


    RETURN    l_result;

END;  -- ufihRendered

function nextAvailableOrder(
    p_SED_CHARGE    in  VARCHAR2,
    p_SED_DATE      in  DATE
    )
Return VARCHAR2
IS  --004SO
    CURSOR cExisting is
    SELECT to_date(MIN(SED_ORDER),'yyyy-mm-dd hh24:mi:ss')
    From SETDETAIL
    WHERE SED_CHARGE = p_SED_CHARGE
    AND SED_ORDER >= to_char(trunc(p_SED_DATE) + 0.5,'yyyy-mm-dd hh24:mi:ss')
    AND SED_ORDER < to_char(trunc(p_SED_DATE) + 1,'yyyy-mm-dd hh24:mi:ss')
    ;

    l_existing_order   Date;

BEGIN
    open cExisting;
    fetch cExisting into l_existing_order;
    close cExisting;

    if l_existing_order is null then
        l_existing_order := trunc(p_SED_DATE) + 1.0;
    end if;

    Return to_char(l_existing_order - 1/24/3600,'yyyy-mm-dd hh24:mi:ss');
END;  -- nextAvailableOrder

FUNCTION nextAvailableTimestamp (
    p_SED_CHARGE    IN  VARCHAR2,
    p_SED_DATE      IN  DATE
) RETURN    NUMBER      -- seconds after midnight
IS  --009SO
    -- Return largest possible second offset unused for given
    -- pseudo chargeable number in SEDDETAIL charges
    -- same as nextAvailableOrder but numeric offset outut
    c_LastSecondOfDay   NUMBER := 86399;
    l_last              VARCHAR2(20);
BEGIN

    SELECT MIN(SED_ORDER)
    INTO l_last
    FROM SETDETAIL
    WHERE SED_CHARGE = p_SED_CHARGE                                             --010SO
    AND SED_ORDER >= to_char(p_SED_DATE,'YYYY-MM-DD ') || '12:00:00'
    AND SED_ORDER <= to_char(p_SED_DATE,'YYYY-MM-DD ') || '23:59:59'
    ;
    if l_last is NULL then
        RETURN c_LastSecondOfDay;
    else
        RETURN to_number(SUBSTR(l_last,18,2)) + 60 * to_number(SUBSTR(l_last,15,2)) + 3600 * to_number(SUBSTR(l_last,12,2)) - 1;
    end if;
END;  -- nextAvailableTimestamp


FUNCTION billTextLa (
    p_CONSOLIDATION     IN varchar2,
    p_TarId             IN varchar2,
    p_International     IN varchar2,
    p_SED_ETID          IN varchar2,
    p_SED_PREPAID       IN varchar2,
    p_SED_COUNT1        IN number,
    p_SED_COUNT2        IN number
) RETURN    VARCHAR2
IS  --008SO
    -- Return UFIH BillText (F30) for SMS and MMS LA UFIH tickets

    l_result    varchar2(100);
    l_temp      varchar2(100);
    c_max_length    NUMBER := 24;

BEGIN

    l_result := 'ID' || p_CONSOLIDATION;

    If p_SED_ETID = 'MFGR' Then
        l_temp := '/MFGR';
        If Length(l_result) + Length(l_temp) <= c_max_length Then
            l_result := l_result || l_temp;
        End If;
    ElsIf p_SED_ETID = 'MFLID' Then
        l_temp := '/MFLID';
        If Length(l_result) + Length(l_temp) <= c_max_length Then
            l_result := l_result || l_temp;
        End If;
    Else
        If p_SED_COUNT1 > 0 Then
            l_temp := '/MT' || p_SED_COUNT1;
            If Length(l_result) + Length(l_temp) <= c_max_length Then
                l_result := l_result || l_temp;
            End If;
        End If;
        If p_SED_COUNT2 > 0 Then
            l_temp := '/MO' || p_SED_COUNT2;
            If Length(l_result) + Length(l_temp) <= c_max_length Then
                l_result := l_result || l_temp;
            End If;
        End If;
        If p_International = '0' Then
            l_temp := '/SCM';
            If Length(l_result) + Length(l_temp) <= c_max_length Then
                l_result := l_result || l_temp;
            End If;
        End If;
        If p_International = '1' Then
            l_temp := '/FN';
            If Length(l_result) + Length(l_temp) <= c_max_length Then
                l_result := l_result || l_temp;
            End If;
        End If;
    End If;                                                                     --038SO

    RETURN    l_result;

END;  -- billTextLa


-- pfsBillTextIotLac(strLastConsolidation, lngCumulatedCdrCount, 0, True)

FUNCTION billTextLi (
    p_CONSOLIDATION     IN varchar2,
    p_SED_COUNT1        IN number,
    p_SED_COUNT2        IN number
) RETURN    VARCHAR2
IS  --018SO
    -- Return UFIH BillText (F30) for SMS and MMS LA IW UFIH tickets

    l_result    varchar2(100);
    l_temp      varchar2(100);
    c_max_length    NUMBER := 24;

BEGIN

    l_result := 'ID' || p_CONSOLIDATION;

    If p_SED_COUNT1 > 0 Then
        l_temp := '/IWT' || p_SED_COUNT1;
        If Length(l_result) + Length(l_temp) <= c_max_length Then
            l_result := l_result || l_temp;
        End If;
    End If;
    If p_SED_COUNT2 > 0 Then
        l_temp := '/MO' || p_SED_COUNT2 || '/IW';
        If Length(l_result) + Length(l_temp) <= c_max_length Then
            l_result := l_result || l_temp;
        End If;
    End If;

    RETURN    l_result;

END;  -- billTextLi

FUNCTION billTextMinCharge (
    p_CONSOLIDATION     IN varchar2,
    p_TarId             IN varchar2,
    p_Datetime          IN DATE
) RETURN    VARCHAR2
IS
    -- Return UFIH BillText (F30) for SMS and MMS LA UFIH MinCharge tickets

    l_result    varchar2(100);

BEGIN

    l_result := 'ID' || p_CONSOLIDATION || '/Diff. ' || to_char(p_Datetime,'MM.YYYY') || '/' || p_TarId;

    RETURN    l_result;

END;  -- billTextMinCharge


procedure SP_INSERT_SETTLING
(
   p_SET_ETID       IN varchar2,
   p_SET_CONID      IN varchar2,
   p_SET_DEMO       IN number,
   p_SET_SEPID      IN varchar2,
   p_SET_SETIDOLD   IN varchar2,
   p_SET_CURRENCY   IN varchar2,
   p_SET_COMMENT    IN varchar2,
   p_SET_ID         OUT varchar2,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT number )
IS

  vDummyErrorCode       NUMBER;
  vDummyErrorMsg        VARCHAR2(4000);
  vDummyReturnStatus    NUMBER;

Begin

  SELECT GenerateUniqueKey('G') INTO p_SET_ID FROM DUAL;

  Insert into SETTLING (
    SET_ID,
    SET_ETID,
    SET_CONID,
    SET_DEMO,
    SET_SEPID,
    SET_DATECRE,
    SET_DATEPRN1,
    SET_REPID1,
    SET_DATEPRN2,
    SET_REPID2,
    SET_DATECAN,
    SET_SETIDOLD,
    SET_CURRENCY,
    SET_NET,
    SET_VAT,
    SET_TOTAL,
    SET_ESID,
    SET_DATE1,
    SET_DATE2,
    SET_COMMENT
  )
  Values
  (
    p_SET_ID,
    p_SET_ETID,
    p_SET_CONID,
    p_SET_DEMO,
    p_SET_SEPID,
    SYSDATE,
    NULL,
    NULL,
    NULL,
    NULL,
    NULL,
    p_SET_SETIDOLD,
    p_SET_CURRENCY,
    0.00,
    0.00,
    0.00,
    'A',
    NULL,
    NULL,
    p_SET_COMMENT
  );

Returnstatus := 1;
Return;
Exception
When Others then
   ErrorCode := SQLCODE;
   ErrorMsg  := SQLERRM;
   PKG_COMMON.INSERT_WARNING (
        'PKG_BDETAIL_SETTLEMENT',
        'SP_INSERT_SETTLING',           --039SO
        'Error',
        ErrorMsg); --032SO
   ReturnStatus := 0;
END SP_INSERT_SETTLING;

procedure SP_INSERT_SETDETAIL
(
   p_SED_SETID      IN varchar2,
   p_SED_ETID       IN varchar2,
   p_SED_PRICE      IN float,
   p_SED_QUANTITY   IN float,
   p_SED_DISCOUNT   IN float,
   p_SED_VATID      IN varchar2,
   p_SED_VATRATE    IN float,
   p_SED_DESC       IN varchar2,
   p_SED_ORDER      IN varchar2,
   p_SED_VISIBLE    IN number,
   p_SED_COMMENT    IN varchar2,
   p_SED_COUNT1     IN number,
   p_SED_COUNT2     IN number,
   p_SED_CHARGE     IN varchar2,
   p_SED_BOHID      IN varchar2,
   p_SED_PMVID      IN varchar2,
   p_SED_TARID      IN varchar2,
   p_SED_ESID       IN varchar2,
   p_SED_INT        IN varchar2,
   p_SED_DATE       IN varchar2,
   p_SED_PREPAID    IN varchar2,        --001SO
   p_SED_AMOUNTCU   IN float,           --001SO
   p_SED_RETSHAREPV IN float,           --001SO
   p_SED_RETSHAREMO IN float,           --001SO
   p_SED_LONGID_1   IN varchar2,        --036SO --003SO
   p_SED_LONGID_2   IN varchar2,        --036SO
   p_SED_ID         OUT varchar2,
   p_SED_POS        OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT number )
IS

  v_SED_ORDER       VARCHAR2(19);
  v_timestamp       DATE;

  vDummyErrorCode       NUMBER;
  vDummyErrorMsg        VARCHAR2(4000);
  vDummyReturnStatus    NUMBER;

  CURSOR c1 IS
    SELECT to_date(SED_ORDER,'YYYY-MM-DD HH24:MI:SS')
    From SETDETAIL
    WHERE SED_CHARGE = p_SED_CHARGE
    AND SED_ORDER >= SUBSTR(p_SED_ORDER,1,10)
    AND SED_ORDER < SUBSTR(p_SED_ORDER,1,10) || ' 12:00:00'
    ORDER BY SED_ORDER DESC;


Begin

  SELECT GenerateUniqueKey('G') INTO p_SED_ID FROM DUAL;

  SELECT NVL(max(SED_POS),0) + 1 INTO p_SED_POS FROM SETDETAIL WHERE SED_SETID = p_SED_SETID;

  if SUBSTR(p_SED_ORDER,12,8) = '00:00:00' then
    OPEN c1;
    FETCH c1 INTO v_timestamp;
    if c1%NOTFOUND then
      v_SED_ORDER :=  p_SED_ORDER;
    else
      v_SED_ORDER := to_char( v_timestamp + 1.0/86399,'YYYY-MM-DD HH24:MI:SS');
    end if;
  else
    v_SED_ORDER :=  p_SED_ORDER;
  end if;

  Insert into SETDETAIL (
    SED_ID,
    SED_SETID,
    SED_POS,
    SED_ETID,
    SED_VISIBLE,
    SED_DESC,
    SED_ORDER,
    SED_PRICE,
    SED_QUANTITY,
    SED_DISCOUNT,
    SED_NET,
    SED_VATID,
    SED_VATRATE,
    SED_VAT,
    SED_TOTAL,
    SED_COMMENT,
    SED_COUNT1,
    SED_COUNT2,
    SED_CHARGE,
    SED_BOHID,
    SED_PMVID,
    SED_TARID,
    SED_DATETIME,
    SED_DATECRE,
    SED_ESID,
    SED_INT,
    SED_PREPAID,            --001SO
    SED_AMOUNTCU,           --001SO
    SED_RETSHAREPV,         --001SO
    SED_RETSHAREMO,         --001SO
    SED_DATE,
    SED_LONGID,             --003SO
    SED_LONGID2             --036SO
  )
  Values
  (
    p_SED_ID,
    p_SED_SETID,
    p_SED_POS,
    p_SED_ETID,
    p_SED_VISIBLE,
    p_SED_DESC,
    v_SED_ORDER,
    p_SED_PRICE,
    p_SED_QUANTITY,
    p_SED_DISCOUNT,
    p_SED_PRICE * p_SED_QUANTITY - p_SED_DISCOUNT,
    p_SED_VATID,
    p_SED_VATRATE,
    (p_SED_PRICE * p_SED_QUANTITY - p_SED_DISCOUNT) * p_SED_VATRATE,
    p_SED_PRICE * p_SED_QUANTITY - p_SED_DISCOUNT + (p_SED_PRICE * p_SED_QUANTITY - p_SED_DISCOUNT) * p_SED_VATRATE,
    p_SED_COMMENT,
    p_SED_COUNT1,
    p_SED_COUNT2,
    p_SED_CHARGE,
    p_SED_BOHID,
    p_SED_PMVID,
    p_SED_TARID,
    sysdate,
    sysdate,
    p_SED_ESID,
    p_SED_INT,
    p_SED_PREPAID,          --001SO
    p_SED_AMOUNTCU,         --001SO
    p_SED_RETSHAREPV,       --001SO
    p_SED_RETSHAREMO,       --001SO
    TRUNC(to_date(p_SED_DATE,'yyyy-mm-dd HH24:MI:SS')),
    to_number(p_SED_LONGID_1),   --003SO
    to_number(p_SED_LONGID_2)    --036SO
  );

Returnstatus := 1;
Return;
Exception
When Others then
   ErrorCode := SQLCODE;
   ErrorMsg  := SQLERRM;
   PKG_COMMON.INSERT_WARNING (
        'PKG_BDETAIL_SETTLEMENT',
        'SP_INSERT_SETDETAIL',
        'Error',
        ErrorMsg
        ); --032SO
   ReturnStatus := 0;
END SP_INSERT_SETDETAIL;

procedure SP_ADD_SETDETAIL
(
   p_SET_ETID       IN varchar2,
   p_SED_ETID       IN varchar2,
   p_SED_CHARGE     IN varchar2,
   p_SED_BOHID      IN varchar2,
   p_Date           IN DATE,
   p_SET_CONID      IN varchar2,
   p_SED_TARID      IN varchar2,
   p_SED_INT        IN varchar2,
   p_SED_PREPAID    IN varchar2,
   p_SED_PRICE      IN float,
   p_SED_AMOUNTCU   IN float,
   p_SED_RETSHAREPV IN float,
   p_SED_RETSHAREMO IN float,
   p_SED_LONGID     IN varchar2,
   p_SED_COUNT1     IN number,
   p_SED_COUNT2     IN number,
   p_SED_DESC       IN varchar2,
   p_GART           IN number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT number )

IS   --006SO

    l_order             VARCHAR2(20);
    l_date              VARCHAR2(20);

    l_SEP_ID            varchar2(10);
    l_SET_ID            varchar2(10);
    l_SED_ID            varchar2(10);
    l_SED_POS           number;

    l_AmountTotal       VARCHAR2(20);       --013SO -- Rounded AmountTotal
    l_Ufih              Varchar2(400);      --013SO
    l_UfihStream        Varchar2(10);       --013SO
    l_BillText          Varchar2(100);      --013SO
    l_schedule_zero_ufih Boolean;           --025SO

Begin

    ReturnStatus := 0;      --011SO

    l_date := to_char(p_Date,'yyyy-mm-dd hh24:mi:ss');
    l_order := l_date;

/*
L('SP_ADD_SETDETAIL_BY_DATE');
L('p_SET_ETID',p_SET_ETID);
L('p_SED_ETID',p_SED_ETID);
L('p_SED_CHARGE',p_SED_CHARGE);
L('p_SED_BOHID',p_SED_BOHID);
L('p_Date',p_Date);
L('p_SET_CONID',p_SET_CONID);
L('p_SED_TARID',p_SED_TARID);
L('p_SED_INT',p_SED_INT);
L('p_SED_PREPAID',p_SED_PREPAID);
L('p_SED_PRICE',p_SED_PRICE);
L('p_SED_AMOUNTCU',p_SED_AMOUNTCU);
L('p_SED_RETSHAREPV',p_SED_RETSHAREPV);
L('p_SED_RETSHAREMO',p_SED_RETSHAREMO);
L('p_SED_LONGID',p_SED_LONGID);
L('p_SED_COUNT1',p_SED_COUNT1);
L('p_SED_COUNT2',p_SED_COUNT2);
L('p_SED_DESC',p_SED_DESC);
L('l_date',l_date);
*/

    SP_ADD_SETDETAIL_BY_DATE(
        l_date,                                                             -- p_Date           IN varchar2,
        p_SET_CONID,                                                        -- p_SET_CONID      IN varchar2,
        p_SET_ETID,                                                         -- p_SET_ETID       IN varchar2,
        0,                                                                  -- p_SET_DEMO       IN number,
        'CHF',                                                              -- p_SET_CURRENCY   IN varchar2,
        NULL,                                                               -- p_SET_COMMENT    IN varchar2,
        p_SED_ETID,                                                         -- p_SED_ETID       IN varchar2,
        p_SED_PRICE,                                                        -- p_SED_PRICE      IN float,
        1.0,                                                                -- p_SED_QUANTITY   IN float,
        0.0,                                                                -- p_SED_DISCOUNT   IN float,
        'NA',                                                               -- p_SED_VATID      IN varchar2, --  030SO
        0.0,                                                                -- p_SED_VATRATE    IN float,
        p_SED_DESC,                                                         -- p_SED_DESC       IN varchar2,
        l_order,                                                            -- p_SED_ORDER      IN varchar2,
        1,                                                                  -- p_SED_VISIBLE    IN number,
        NULL,                                                               -- p_SED_COMMENT    IN varchar2,
        p_SED_COUNT1,                                                       -- p_SED_COUNT1     IN number,
        p_SED_COUNT2,                                                       -- p_SED_COUNT2     IN number,
        p_SED_CHARGE,                                                       -- p_SED_CHARGE     IN varchar2,
        p_SED_BOHID,                                                        -- p_SED_BOHID      IN varchar2,
        NULL,                                                               -- p_SED_PMVID      IN varchar2,
        p_SED_TARID,                                                        -- p_SED_TARID      IN varchar2,
        'A',                                                                -- p_SED_ESID       IN varchar2,
        p_SED_INT,                                                          -- p_SED_INT        IN varchar2,
        p_SED_PREPAID,                                                      -- p_SED_PREPAID    IN varchar2,
        p_SED_AMOUNTCU,                                                     -- p_SED_AMOUNTCU   IN float,
        p_SED_RETSHAREPV,                                                   -- p_SED_RETSHAREPV IN float,
        p_SED_RETSHAREMO,                                                   -- p_SED_RETSHAREMO IN float,
        p_SED_LONGID,                                                       -- p_SED_LONGID_1   IN varchar2, --036SO
        NULL,                                                               -- p_SED_LONGID_2   IN varchar2, --036SO
        l_SEP_ID,                                                           -- p_SEP_ID         OUT varchar2,
        l_SET_ID,                                                           -- p_SET_ID         OUT varchar2,
        l_SED_ID,                                                           -- p_SED_ID         OUT varchar2,
        l_SED_POS,                                                          -- p_SED_POS        OUT number,
        ErrorCode,                                                          -- ErrorCode        OUT number,
        ErrorMsg,                                                           -- ErrorMsg         OUT varchar2,
        ReturnStatus                                                        -- ReturnStatus     IN OUT number
    );

    if (ReturnStatus = 1)and (p_SED_DESC <> 'accumulating') then
        -- Render UFIH output CDR and storein SETDETAIL

        l_schedule_zero_ufih := true;                                           --025SO

        if p_SED_ETID IN ('CDR','PAG','MFLID','MFGR') then                      --039SO
            l_UfihStream := 'UN_SBS4';
            l_schedule_zero_ufih := false;                                      --028SO
        elsif p_SED_ETID IN ('MCC') then
            l_UfihStream := 'UN_SBS8';
            l_schedule_zero_ufih := false;                                      --028SO
        elsif p_SED_ETID IN ('IOTLACT','MOFN') then
            l_UfihStream := 'UN_SBS9';
            l_schedule_zero_ufih := false;                                      --028SO
        elsif p_SED_ETID IN ('MOIWST') then
            l_UfihStream := 'UN_SBS9';
            l_schedule_zero_ufih := false;                                      --025SO
        else
            l_UfihStream := NULL;
        end if;

        if l_UfihStream IS NOT NULL then

            l_Ufih := ufihRendered (
                l_date,                                                         -- IN varchar2,
                p_SED_CHARGE,                                                   -- IN varchar2,
                p_SED_PRICE,                                                    -- IN float,
                p_SED_DESC,                                                     -- IN varchar2,
                p_GART,                                                         -- IN varchar2,
                p_SED_TARID                                                     -- IN varchar2
            );                                                                  --034SO

            if l_schedule_zero_ufih or
                (p_SED_COUNT1 <> 0) or
                  (p_SED_COUNT2 <> 0) or
                    (p_SED_PRICE <> 0.00) then
                UPDATE SETDETAIL SET
                    SED_UFIH_STREAM = l_UfihStream,
                    SED_UFIH_OUT = l_Ufih,
                    SED_UFIH_BOSID = 'S'
                WHERE SED_ID = l_SED_ID
                ;   -- schedule the UFIH CDR file output
            else -- l_schedule_zero_ufih or .. = false
                UPDATE SETDETAIL SET
                    SED_UFIH_STREAM = l_UfihStream,
                    SED_UFIH_OUT = l_Ufih
                WHERE SED_ID = l_SED_ID
                ;   -- only store the UFIH CDR file output without scheduling   --025SO
            end if; -- l_schedule_zero_ufih or .. = false
        end if; -- l_UfihStream IS NOT NULL

    end if; -- (ReturnStatus = 1)and (p_SED_DESC <> 'accumulating')

    Return;

/*      --011SO

Exception
When Others then
   ErrorCode := SQLCODE;
   ErrorMsg  := SQLERRM;
   ReturnStatus := 0;
*/

END SP_ADD_SETDETAIL;


procedure SP_ADD_SETDETAIL_BY_DATE
(
   p_Date           IN varchar2,
   p_SET_CONID      IN varchar2,
   p_SET_ETID       IN varchar2,
   p_SET_DEMO       IN number,
   p_SET_CURRENCY   IN varchar2,
   p_SET_COMMENT    IN varchar2,
   p_SED_ETID       IN varchar2,
   p_SED_PRICE      IN float,
   p_SED_QUANTITY   IN float,
   p_SED_DISCOUNT   IN float,
   p_SED_VATID      IN varchar2,
   p_SED_VATRATE    IN float,
   p_SED_DESC       IN varchar2,
   p_SED_ORDER      IN varchar2,
   p_SED_VISIBLE    IN number,
   p_SED_COMMENT    IN varchar2,
   p_SED_COUNT1     IN number,
   p_SED_COUNT2     IN number,
   p_SED_CHARGE     IN varchar2,
   p_SED_BOHID      IN varchar2,
   p_SED_PMVID      IN varchar2,
   p_SED_TARID      IN varchar2,
   p_SED_ESID       IN varchar2,
   p_SED_INT        IN varchar2,
   p_SED_PREPAID    IN varchar2,        --001SO
   p_SED_AMOUNTCU   IN float,           --001SO
   p_SED_RETSHAREPV IN float,           --001SO
   p_SED_RETSHAREMO IN float,           --001SO
   p_SED_LONGID_1   IN varchar2,        --036SO --003SO
   p_SED_LONGID_2   IN varchar2,        --036SO
   p_SEP_ID         OUT varchar2,
   p_SET_ID         OUT varchar2,
   p_SED_ID         OUT varchar2,
   p_SED_POS        OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT number )
IS
    CURSOR c3 IS
    SELECT SET_ID
    from SETTLING
    where p_SET_CONID = SET_CONID
    and p_SEP_ID = SET_SEPID
    and p_SET_DEMO = SET_DEMO
    and p_SET_ETID = SET_ETID
    and SET_ESID = 'A';

    CURSOR c4 (LongId1 NUMBER, LongId2 NUMBER) IS                                --036SO --005SO
    SELECT SED_ID
    FROM SETDETAIL
    WHERE SED_SETID = p_SET_ID
    AND SED_ETID = p_SED_ETID
    AND SED_TARID = p_SED_TARID
    AND SED_CHARGE = p_SED_CHARGE
    AND SED_DATE = TRUNC(to_date(p_date,'yyyy-mm-dd hh24:mi:ss'))
    AND (SED_INT = p_SED_INT OR (p_SED_INT IS NULL AND SED_INT IS NULL))
    AND NVL(SED_PREPAID,'U') = NVL(p_SED_PREPAID,'U')                           --001SO
    AND SED_ESID = 'A'
    AND NVL(SED_LONGID,0) = NVL(LongId1,0)                                      --005SO --003SO
    AND NVL(SED_LONGID2,0) = NVL(LongId2,0)                                     --036SO
    ;

    CURSOR cLongID IS
    SELECT LONG_ID
    FROM LONGID
    WHERE LONG_ID = to_number(p_SED_LONGID_1)
    ;   --005SO


    CURSOR cLongIdRange(LongId NUMBER) IS
    select LONGM_LONGID1,LONGM_LONGID2
    from   LONGIDMAP
    where  LONGM_ESID = 'M'
    and    LONGM_DATESTART <= to_date(p_Date,'yyyy-mm-dd hh24:mi:ss')           --037SO
    and    LONGM_LONGID1 <= LongId
    and    LONGM_LONGID2 >= LongId
    and    (LONGM_DATEEND IS NULL OR LONGM_DATEEND > to_date(p_Date,'yyyy-mm-dd hh24:mi:ss')) --037SO
    ;   --036SO

    l_long_id       LONGID.LONG_ID%Type;                                        --005SO
    l_long_id_1     LONGID.LONG_ID%Type;                                        --036SO
    l_long_id_2     LONGID.LONG_ID%Type;                                        --036SO

Begin

  Returnstatus := 0;                                                            --020SO
  l_long_id := NULL;                                                            --005SO
  l_long_id_1 := NULL;                                                          --036SO
  l_long_id_2 := NULL;                                                          --036SO

  SELECT SEP_ID into p_SEP_ID from SETPERIOD where to_date(p_Date,'YYYY-MM-DD HH24:MI:SS') >= SEP_DATE1 and to_date(p_Date,'YYYY-MM-DD HH24:MI:SS') < SEP_DATE2;

  Returnstatus := 1;                    --002SO moved up here -- May be set to 0 in called procedures upon error condition

  if p_SED_LONGID_1 is not NULL then
    OPEN cLongID;
    FETCH cLongID INTO l_long_id;
    if cLongID%FOUND then
        if p_SED_LONGID_2 is not NULL then
            l_long_id_1 := l_long_id;                                           --036SO
            l_long_id_2 := to_number(p_SED_LONGID_2);                           --036SO
        elsif p_SED_LONGID_1 like cstrOfficialLongId then
            l_long_id_1 := l_long_id;                                           --036SO
        else
            OPEN cLongIdRange(l_long_id);
            FETCH cLongIdRange INTO l_long_id_1,l_long_id_2;
            CLOSE cLongIdRange;
        end if;
    end if;
    CLOSE cLongID;
  end if;

  OPEN c3;
  FETCH c3 INTO p_SET_ID;
  if c3%NOTFOUND then
    SELECT GenerateUniqueKey('G') INTO p_SET_ID FROM DUAL;
    SP_INSERT_SETTLING(p_SET_ETID, p_SET_CONID, p_SET_DEMO, p_SEP_ID, NULL, p_SET_CURRENCY, p_SET_COMMENT, p_SET_ID, ErrorCode, ErrorMsg, ReturnStatus);
    if ReturnStatus = 1 then
      SP_INSERT_SETDETAIL(  p_SET_ID, p_SED_ETID, p_SED_PRICE, p_SED_QUANTITY,
                            p_SED_DISCOUNT, p_SED_VATID, p_SED_VATRATE, p_SED_DESC,
                            p_SED_ORDER, p_SED_VISIBLE, p_SED_COMMENT, p_SED_COUNT1,
                            p_SED_COUNT2, p_SED_CHARGE, p_SED_BOHID, p_SED_PMVID,
                            p_SED_TARID, p_SED_ESID, p_SED_INT, p_Date,
                            NVL(p_SED_PREPAID,'U'), p_SED_AMOUNTCU, p_SED_RETSHAREPV, p_SED_RETSHAREMO,     --001SO
                            to_char(l_long_id_1), to_char(l_long_id_2),                                     --036SO --005SO --003SO
                            p_SED_ID, p_SED_POS, ErrorCode, ErrorMsg, ReturnStatus);
    end if;
  else
    OPEN c4(l_long_id_1, l_long_id_2);                                          --036SO --005SO
    FETCH c4 INTO p_SED_ID;
    if c4%NOTFOUND then
      SP_INSERT_SETDETAIL(  p_SET_ID, p_SED_ETID, p_SED_PRICE, p_SED_QUANTITY,
                            p_SED_DISCOUNT, p_SED_VATID, p_SED_VATRATE, p_SED_DESC,
                            p_SED_ORDER, p_SED_VISIBLE, p_SED_COMMENT, p_SED_COUNT1,
                            p_SED_COUNT2, p_SED_CHARGE, p_SED_BOHID, p_SED_PMVID,
                            p_SED_TARID, p_SED_ESID, p_SED_INT, p_Date,
                            NVL(p_SED_PREPAID,'U'), p_SED_AMOUNTCU, p_SED_RETSHAREPV, p_SED_RETSHAREMO,     --001SO
                            to_char(l_long_id_1), to_char(l_long_id_2),                                     --036SO --005SO --003SO
                            p_SED_ID, p_SED_POS, ErrorCode, ErrorMsg, ReturnStatus);
    else
      if p_SED_DESC = 'accumulating' then
        SP_UPDATE_SETDETAIL(p_SED_ID, p_SED_PRICE, p_SED_QUANTITY,
                            p_SED_DISCOUNT, p_SED_COUNT1, p_SED_COUNT2,
                            p_SED_AMOUNTCU, p_SED_RETSHAREPV, p_SED_RETSHAREMO,     --001SO
                            ErrorCode, p_SED_POS, ErrorMsg, ReturnStatus);
      else
        SP_INSERT_SETDETAIL(p_SET_ID, p_SED_ETID, p_SED_PRICE, p_SED_QUANTITY,
                            p_SED_DISCOUNT, p_SED_VATID, p_SED_VATRATE, p_SED_DESC,
                            p_SED_ORDER, p_SED_VISIBLE, p_SED_COMMENT, p_SED_COUNT1,
                            p_SED_COUNT2, p_SED_CHARGE, p_SED_BOHID, p_SED_PMVID,
                            p_SED_TARID, p_SED_ESID, p_SED_INT, p_Date,
                            NVL(p_SED_PREPAID,'U'), p_SED_AMOUNTCU, p_SED_RETSHAREPV, p_SED_RETSHAREMO,     --001SO
                            to_char(l_long_id_1), to_char(l_long_id_2),                                     --036SO --005SO --003SO
                            p_SED_ID, p_SED_POS, ErrorCode, ErrorMsg, ReturnStatus);
      end if;
    end if;
    CLOSE c4;
  end if;
  CLOSE c3;

Return;
/*          --020SO
Exception
When Others then
   ErrorCode := SQLCODE;
   ErrorMsg  := SQLERRM;
   ReturnStatus := 0;
*/
END SP_ADD_SETDETAIL_BY_DATE;

procedure SP_UPDATE_SETDETAIL
(
   p_SED_ID         IN varchar2,
   p_SED_PRICE      IN float,
   p_SED_QUANTITY   IN float,
   p_SED_DISCOUNT   IN float,
   p_SED_COUNT1     IN number,
   p_SED_COUNT2     IN number,
   p_SED_AMOUNTCU   IN float,           --001SO
   p_SED_RETSHAREPV IN float,           --001SO
   p_SED_RETSHAREMO IN float,           --001SO
   p_SED_POS        OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT number )
IS

  vDummyErrorCode       NUMBER;
  vDummyErrorMsg        VARCHAR2(4000);
  vDummyReturnStatus    NUMBER;

Begin

  Update SETDETAIL SET
    SED_PRICE = DECODE(p_SED_PRICE,SED_PRICE,SED_PRICE,NULL),
    SED_QUANTITY = SED_QUANTITY + p_SED_QUANTITY,
    SED_DISCOUNT = SED_DISCOUNT + p_SED_DISCOUNT,
    SED_NET = SED_NET + p_SED_PRICE * p_SED_QUANTITY - p_SED_DISCOUNT,
    SED_VAT = SED_VAT + (p_SED_PRICE * p_SED_QUANTITY - p_SED_DISCOUNT) * SED_VATRATE,
    SED_TOTAL = SED_TOTAL + p_SED_PRICE * p_SED_QUANTITY - p_SED_DISCOUNT + (p_SED_PRICE * p_SED_QUANTITY - p_SED_DISCOUNT) * SED_VATRATE,
    SED_COUNT1 = SED_COUNT1 + p_SED_COUNT1,
    SED_COUNT2 = SED_COUNT2 + p_SED_COUNT2,
    SED_AMOUNTCU = SED_AMOUNTCU + p_SED_AMOUNTCU,                               --001SO
    SED_RETSHAREPV = SED_RETSHAREPV + p_SED_RETSHAREPV,                         --001SO
    SED_RETSHAREMO = SED_RETSHAREMO + p_SED_RETSHAREMO,                         --001SO
    SED_DATETIME = SYSDATE
  WHERE SED_ID = p_SED_ID ;

  p_SED_POS := 0;     -- not evaluated yet

  Returnstatus := 1;
  Return;
Exception
  When Others then
    ErrorCode := SQLCODE;
    ErrorMsg  := SQLERRM;
   PKG_COMMON.INSERT_WARNING (
        'PKG_BDETAIL_SETTLEMENT',
        'SP_INSERT_SETDETAIL',
        'Error',
        ErrorMsg); --032SO
    ReturnStatus := 0;
END SP_UPDATE_SETDETAIL;


Procedure SP_UPDATE_BOHEADER_IOTLACT_0
(
  p_bohid         In      Varchar2,
  p_status        In      Varchar2,
  p_count         In      Number,
  p_MaxAge        In      Number,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  ReturnStatus    In Out  Number
)
IS
   x_datefc       date;
   x_datelc       date;
   x_reccount     number;
   x_packid       varchar2(10);
   x_fileseqmax   number;
   x_nextseq      number;

Begin
   If p_status = 'S' then /*--- conversion was successful ---- */
      Begin
          select min(to_Date(SED_ORDER,'YYYY-MM-DD HH24:MI:SS')) into x_datefc
                   from SETDETAIL where SED_GOHID = p_bohid;
          select max(to_Date(SED_ORDER,'YYYY-MM-DD HH24:MI:SS')) into x_datelc
                   from SETDETAIL where SED_GOHID = p_bohid;
          select count(*) into x_reccount
                  from SETDETAIL where SED_GOHID = p_bohid
                  and SED_ESID = 'V';
          Update Boheader set
            boh_DATEFC = x_datefc,
            boh_DATELC = x_datelc,
            boh_RecCount = x_reccount,
            boh_end = sysdate,
            boh_esid = 'OK',
            boh_filename = REPLACE(boh_filename,'Temp-','')
          where boh_id = p_bohid;

          select boh_packid into x_packid
            from boheader where boh_id = p_bohid;
          select pac_fileseqmax, pac_nextseq into x_fileseqmax, x_nextseq
            from packing where pac_id  = x_packid;
          If x_fileseqmax = x_nextseq then /*** need to recycle ***/
            x_nextseq := 1;
          else
            x_nextseq := x_nextseq + 1;
          end if;
          update packing set
            pac_nextseq = x_nextseq
          where pac_id = x_packid;
      End;
   Else /*---- file error encountered ----*/
      Begin
        Update Boheader set
          boh_end = sysdate,
          boh_esid = 'PAE'
        where boh_id = p_bohid;
      End;
   End if;
   Returnstatus := 1;
   -- Commit;
   Return;
Exception
When Others then
   ErrorCode := SQLCODE;
   ErrorMsg  := SQLERRM;
   ReturnStatus := 0;
END SP_UPDATE_BOHEADER_IOTLACT_0;


procedure SP_UPDATE_BOHEADER_MOLAT_0
( p_bohid         In      Varchar2,
  p_status        In      Varchar2,
  p_count         In      Number,
  p_MaxAge        In      Number,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  ReturnStatus    In Out  Number
)
IS
   x_datefc       date;
   x_datelc       date;
   x_reccount     number;
   x_packid       varchar2(10);
   x_fileseqmax   number;
   x_nextseq      number;

Begin
   If p_status = 'S' then /*--- conversion was successful ---- */
      Begin
          select min(to_Date(SED_ORDER,'YYYY-MM-DD HH24:MI:SS')) into x_datefc
                   from SETDETAIL where SED_GOHID = p_bohid;
          select max(to_Date(SED_ORDER,'YYYY-MM-DD HH24:MI:SS')) into x_datelc
                   from SETDETAIL where SED_GOHID = p_bohid;
          select count(*) into x_reccount
                  from SETDETAIL where SED_GOHID = p_bohid
                  and SED_ESID = 'V';
          Update Boheader set
            boh_DATEFC = x_datefc,
            boh_DATELC = x_datelc,
            boh_RecCount = x_reccount,
            boh_end = sysdate,
            boh_esid = 'OK',
            boh_filename = REPLACE(boh_filename,'Temp-','')
          where boh_id = p_bohid;

          select boh_packid into x_packid
            from boheader where boh_id = p_bohid;
          select pac_fileseqmax, pac_nextseq into x_fileseqmax, x_nextseq
            from packing where pac_id  = x_packid;
          If x_fileseqmax = x_nextseq then /*** need to recycle ***/
            x_nextseq := 1;
          else
            x_nextseq := x_nextseq + 1;
          end if;
          update packing set
            pac_nextseq = x_nextseq
          where pac_id = x_packid;
      End;
   Else /*---- file error encountered ----*/
      Begin
        Update Boheader set
          boh_end = sysdate,
          boh_esid = 'PAE'
        where boh_id = p_bohid;
      End;
   End if;
   Returnstatus := 1;
   -- Commit;
   Return;
Exception
When Others then
   ErrorCode := SQLCODE;
   ErrorMsg  := SQLERRM;
   ReturnStatus := 0;
END SP_UPDATE_BOHEADER_MOLAT_0;

procedure SP_UPDATE_BOHEADER_MOIWST_0
( p_bohid         In      Varchar2,
  p_status        In      Varchar2,
  p_count         In      Number,
  p_MaxAge        In      Number,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  ReturnStatus    In Out  Number
)
IS
   x_datefc       date;
   x_datelc       date;
   x_reccount     number;
   x_packid       varchar2(10);
   x_fileseqmax   number;
   x_nextseq      number;

Begin
   If p_status = 'S' then /*--- conversion was successful ---- */
      Begin
          select min(to_Date(SED_ORDER,'YYYY-MM-DD HH24:MI:SS')) into x_datefc
                   from SETDETAIL where SED_GOHID = p_bohid;
          select max(to_Date(SED_ORDER,'YYYY-MM-DD HH24:MI:SS')) into x_datelc
                   from SETDETAIL where SED_GOHID = p_bohid;
          select count(*) into x_reccount
                  from SETDETAIL where SED_GOHID = p_bohid
                  and SED_ESID = 'V';
          Update Boheader set
            boh_DATEFC = x_datefc,
            boh_DATELC = x_datelc,
            boh_RecCount = x_reccount,
            boh_end = sysdate,
            boh_esid = 'OK',
            boh_filename = REPLACE(boh_filename,'Temp-','')
          where boh_id = p_bohid;

          select boh_packid into x_packid
            from boheader where boh_id = p_bohid;
          select pac_fileseqmax, pac_nextseq into x_fileseqmax, x_nextseq
            from packing where pac_id  = x_packid;
          If x_fileseqmax = x_nextseq then /*** need to recycle ***/
            x_nextseq := 1;
          else
            x_nextseq := x_nextseq + 1;
          end if;
          update packing set
            pac_nextseq = x_nextseq
          where pac_id = x_packid;
      End;
   Else /*---- file error encountered ----*/
      Begin
        Update Boheader set
          boh_end = sysdate,
          boh_esid = 'PAE'
        where boh_id = p_bohid;
      End;
   End if;
   Returnstatus := 1;
   -- Commit;
   Return;
Exception
When Others then
   ErrorCode := SQLCODE;
   ErrorMsg  := SQLERRM;
   ReturnStatus := 0;
END SP_UPDATE_BOHEADER_MOIWST_0;


Procedure SP_LAT_CDR
(
  p_BD_BOHID      In      Varchar2,
  p_SET_ETID      IN      varchar2,     -- 'SLA'  or 'MLA'
  p_Gart          In      Number,
  p_MinAge        In      Number,
  p_MaxAge        In      Number,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  RecordsAffected Out     Number
)
Is  --007SO

  Cursor C1 Is
    SELECT
        TRUNC(to_date(SED_ORDER,'YYYY-MM-DD HH24:MI:SS'))                       as PosDATETIME,
        SED_CHARGE                                                              as PosMSISDN,
        SET_CONID                                                               as PosConId,
        CON_CONSOL                                                              as PosCONSOLIDATION,
        SED_TARID                                                               as PosTarId,
        NVL(SED_INT,'0')                                                        as PosInternational,
        SUBSTR(SED_ETID,1,LENGTH(SED_ETID)-1)                                   as PosSetDetailType,
        NVL(SED_PREPAID,'U')                                                    as PosPrepaid,
        p_Gart                                                                  as PosGart,
        Count(*)                                                                as CdrCount,
        SUM(SED_COUNT1)                                                         as CdrCountMT,
        SUM(SED_COUNT2)                                                         as CdrCountMO,      -- (including HR)
        ROUND(SUM(SED_TOTAL),2)                                                 as AmountTotal,     --027SO
        SUM(NVL(SED_AMOUNTCU,0.0))                                              as AmountCu,
        SUM(NVL(SED_RETSHAREPV,0.0))                                            as RevenueShareLa,
        SUM(NVL(SED_RETSHAREMO,0.0))                                            as RevenueShareOp
    From SETDETAIL, SETTLING, CONTRACT
    Where SETDETAIL.SED_SETID = SETTLING.SET_ID
    AND SED_ORDER > to_char(sysdate-p_MaxAge,'YYYY-MM-DD')
    AND SED_ORDER < to_char(sysdate-p_MinAge,'YYYY-MM-DD')
    AND CONTRACT.CON_ID = SETTLING.SET_CONID
    AND SED_GOHID = p_BD_BOHID
    GROUP BY
        TRUNC(to_date(SED_ORDER,'YYYY-MM-DD HH24:MI:SS')),                      -- PosDATETIME,
        SED_CHARGE,                                                             -- PosMSISDN,
        SET_CONID,                                                              -- PosConId,
        CON_CONSOL,                                                             -- PosCONSOLIDATION,
        SED_TARID,                                                              -- PosTarId,
        NVL(SED_INT,'0'),                                                       -- PosInternational,
        SUBSTR(SED_ETID,1,LENGTH(SED_ETID)-1),                                  -- PosSetDetailType,
        NVL(SED_PREPAID,'U'),                                                   -- PosPrepaid,
        p_Gart                                                                  -- PosGart,
    ORDER by 1,2,3,4,5,6,7,8,9
    ;

    l_ReturnStatus      NUMBER(1);

    l_TimeOffset        NUMBER;
    l_Amount            Number;
    l_BillText          Varchar2(100);
    l_Ufih              Varchar2(400);

Begin

    RecordsAffected := 0;

    For C1_Rec in C1 Loop

        l_ReturnStatus := 0;

        if C1_Rec.PosSetDetailType <> 'MOFN' then
            -- Aggregate and write MT part of billing
            -- MT only here
            l_TimeOffset := nextAvailableTimestamp(C1_Rec.PosMSISDN,C1_Rec.PosDATETIME);    --021SO
            l_BillText := billTextLa(C1_Rec.PosCONSOLIDATION, C1_Rec.PosTarId, C1_Rec.PosInternational,
                                    C1_Rec.PosSetDetailType, C1_Rec.PosPrepaid,
                                    C1_Rec.CdrCountMT, 0);
            PKG_BDETAIL_SETTLEMENT.SP_ADD_SETDETAIL(
                   p_SET_ETID,                                                  -- p_SET_ETID       IN varchar2,
                   C1_Rec.PosSetDetailType,                                     -- p_SED_ETID       IN varchar2,
                   C1_Rec.PosMSISDN,                                            -- p_SED_CHARGE     IN varchar2,
                   p_BD_BOHID,                                                  -- p_SED_BOHID      IN varchar2,
                   C1_Rec.PosDATETIME + l_TimeOffset/24/3600,                   -- p_Date           IN DATE,
                   C1_Rec.PosConId,                                             -- p_SET_CONID      IN varchar2,
                   C1_Rec.PosTarId,                                             -- p_SED_TARID      IN varchar2,
                   C1_Rec.PosInternational,                                     -- p_SED_INT        IN varchar2,
                   C1_Rec.PosPrepaid,                                           -- p_SED_PREPAID    IN varchar2,
                   C1_Rec.AmountTotal,                                          -- p_SED_PRICE      IN float,
                   C1_Rec.AmountCu,                                             -- p_SED_AMOUNTCU   IN float,
                   C1_Rec.RevenueShareLa,                                       -- p_SED_RETSHAREPV IN float,
                   C1_Rec.RevenueShareOp,                                       -- p_SED_RETSHAREMO IN float,
                   NULL,            --C1_Rec.PosLongId,                         -- p_SED_LONGID     IN varchar2,
                   C1_Rec.CdrCountMT,                                           -- p_SED_COUNT1     IN number,
                   0,               --C1_Rec.CdrCountMO,                        -- p_SED_COUNT2     IN number,
                   l_BillText,                                                  -- p_SED_DESC       IN varchar2,
                   C1_Rec.PosGart,                                              -- p_GART           IN varchar2,
                   ErrorCode,                                                   -- ErrorCode        OUT number,
                   ErrorMsg,                                                    -- ErrorMsg         OUT varchar2,
                   l_ReturnStatus                                               -- ReturnStatus     IN OUT number
            );                                                                  --038SO
        end if;
        If C1_Rec.CdrCountMO > 0 Then                                           --038SO
            -- Aggregate and write MO part of billing
            If C1_Rec.PosSetDetailType <> 'MOFN' Then
                l_Amount := 0.0;                                                -- MO are normally not charged to LA ...
            else
                l_Amount := C1_Rec.AmountTotal;                                 -- ... except for IW
            End If;
            l_TimeOffset := nextAvailableTimestamp(C1_Rec.PosMSISDN,C1_Rec.PosDATETIME);    --021SO
            l_BillText := billTextLa(C1_Rec.PosCONSOLIDATION, C1_Rec.PosTarId, C1_Rec.PosInternational,
                                    C1_Rec.PosSetDetailType, C1_Rec.PosPrepaid,
                                    0,C1_Rec.CdrCountMO);
            PKG_BDETAIL_SETTLEMENT.SP_ADD_SETDETAIL(
                   p_SET_ETID,                                                  -- p_SET_ETID       IN varchar2,
                   C1_Rec.PosSetDetailType,                                     -- p_SED_ETID       IN varchar2,
                   C1_Rec.PosMSISDN,                                            -- p_SED_CHARGE     IN varchar2,
                   p_BD_BOHID,                                                  -- p_SED_BOHID      IN varchar2,
                   C1_Rec.PosDATETIME + l_TimeOffset/24/3600,                   -- p_Date           IN DATE,
                   C1_Rec.PosConId,                                             -- p_SET_CONID      IN varchar2,
                   C1_Rec.PosTarId,                                             -- p_SED_TARID      IN varchar2,
                   C1_Rec.PosInternational,                                     -- p_SED_INT        IN varchar2,
                   C1_Rec.PosPrepaid,                                           -- p_SED_PREPAID    IN varchar2,
                   l_Amount,                                                    -- p_SED_PRICE      IN float,       --022SO
                   C1_Rec.AmountCu,                                             -- p_SED_AMOUNTCU   IN float,
                   C1_Rec.RevenueShareLa,                                       -- p_SED_RETSHAREPV IN float,
                   C1_Rec.RevenueShareOp,                                       -- p_SED_RETSHAREMO IN float,
                   NULL,            --C1_Rec.PosLongId,                         -- p_SED_LONGID     IN varchar2,
                   0,               --C1_Rec.CdrCountMT,                        -- p_SED_COUNT1     IN number,
                   C1_Rec.CdrCountMO,                                           -- p_SED_COUNT2     IN number,
                   l_BillText,                                                  -- p_SED_DESC       IN varchar2,
                   C1_Rec.PosGart,                                              -- p_GART           IN varchar2,
                   ErrorCode,                                                   -- ErrorCode        OUT number,
                   ErrorMsg,                                                    -- ErrorMsg         OUT varchar2,
                   l_ReturnStatus                                               -- ReturnStatus     IN OUT number
            );
        end if;

        if l_ReturnStatus = 1 then
            RecordsAffected :=   RecordsAffected + C1_Rec.CdrCount;
        else
            PKG_COMMON.INSERT_WARNING(
                 'LA SETTLEMENT',
                 'PKG_BDETAIL_SETTLEMENT.SP_LAT_CDR_CONS',
                 'PROCESSING ERROR ' || ErrorCode,
                 ErrorMsg,
                 NULL,
                 p_BD_BOHID
            ); --032SO
            EXIT;  -- C1_Rec
        end if;

    End Loop;  -- C1_Rec

    Return;
/*
Exception
  When Others Then
      ErrorCode := SqlCode;
      ErrorMsg  := SqlErrM;
      RecordsAffected := 0;
*/
End SP_LAT_CDR;

procedure SP_LAPMCC
(
   p_PAC_ID         IN varchar2,    -- 'LAPMCC_SMS' or 'LAPMCC_MMS'    MCC Preparation (Minimum Charge Calculation)
   p_BOH_ID         IN varchar2,
   p_SET_ETID       IN varchar2,    -- SLA or MLA
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     OUT number )
IS  --014SO

-- get a list of SMS or MMS LA contracts which can have a minimum charge
-- per pseudo call number, the contracts with the top overall min charge are choosen
-- more than one contract can be returned, if they have equal weighted minimum charge
-- this is taken care of in the processing of the result

CURSOR cMinChargeableContracts IS
  SELECT
      C1.CON_PSCALL x_pscall,
      C1.CON_ID x_conid
  FROM CONTRACT C1
  WHERE C1.CON_ETID = DECODE(p_SET_ETID,'SLA','LAC','MLA','MLC','invalid')
    AND C1.CON_ESID IN ('A','I')
    AND (( C1.CON_DATESTART < TRUNC(sysdate,'MONTH')) OR  ( C1.CON_DATESTART IS NULL))
    AND (( C1.CON_DATEEND > TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')) OR  ( C1.CON_DATEEND IS NULL))
    AND C1.CON_TARID NOT IN ('P','Q','R','S','T','U','V','W','X','Y','Z')       --038SO
    AND NOT EXISTS (
      SELECT
          C2.CON_ID
      FROM CONTRACT C2
      WHERE C2.CON_ETID = DECODE(p_SET_ETID,'SLA','LAC','MLA','MLC','invalid')
        AND C2.CON_ESID IN ('A','I')
        AND (( C2.CON_DATESTART < TRUNC(sysdate,'MONTH')) OR  ( C2.CON_DATESTART IS NULL))
        AND (( C2.CON_DATEEND > TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')) OR  ( C2.CON_DATEEND IS NULL))
        AND C2.CON_TARID NOT IN ('P','Q','R','S','T','U','V','W','X','Y','Z')   --038SO
        AND C2.CON_MCEFF > C1.CON_MCEFF
        AND C2.CON_PSCALL = C1.CON_PSCALL
      )
   ORDER BY
       C1.CON_PSCALL,
       C1.CON_ID
  ;
cMinChargeableContractsRow cMinChargeableContracts%rowtype;

-- get minimum charge per day as the maximum of any of the running contracts of that day for the pseudo call number
CURSOR cMinChargeByDay(psCall VARCHAR2) IS
  SELECT
      MAX(NVL(CON_MINCHARGE,TAR_MINCHARGE) /(TRUNC(sysdate,'MONTH')-TRUNC(ADD_MONTHS(sysdate,-1),'MONTH'))) x_mincharge_day
  FROM
      CONTRACT,
      TARIFF,
      ENUMERATOR
  WHERE
          CONTRACTPERIODSTART(CON_DATESTART) <= TRUNC(ADD_MONTHS(sysdate,-1),'MONTH') + ENUM_ID -1
      AND CONTRACTPERIODEND(CON_DATEEND) > TRUNC(ADD_MONTHS(sysdate,-1),'MONTH') + ENUM_ID -1
      AND CON_TARID = TAR_ID
      AND CON_ETID IN DECODE(p_SET_ETID,'SLA','LAC','MLA','MLC','invalid')
      AND CON_ESID IN ('A','I')
      AND (( CON_DATESTART < TRUNC(sysdate,'MONTH')) OR  ( CON_DATESTART IS NULL))
      AND (( CON_DATEEND > TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')) OR  ( CON_DATEEND IS NULL))
      AND CON_TARID NOT IN ('P','Q','R','S','T','U','V','W','X','Y','Z')        --038SO
      AND ENUM_ID >= 1
      AND ENUM_ID <= TRUNC(sysdate,'MONTH')- TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
      AND CON_PSCALL = psCall
  GROUP BY
      ENUM_ID
  ;
cMinChargeByDayRow cMinChargeByDay%rowtype;

    x_pscall_last   VARCHAR2(20);
    x_conid_last    VARCHAR2(10);
    x_mincharge_tot Number;

Begin

  UPDATE CONTRACT C1 SET
    C1.CON_MCAPPLIED = NULL,
    C1.CON_MCEFF = NULL
  WHERE C1.CON_ETID = DECODE(p_SET_ETID,'SLA','LAC','MLA','MLC','invalid')
  ;

  UPDATE CONTRACT C1 SET
    C1.CON_MCAPPLIED = NULL,
    C1.CON_MCEFF = (
      SELECT NVL(C2.CON_MINCHARGE,TAR_MINCHARGE) * SettledDuration( C2.CON_DATESTART,C2.CON_DATEEND)/(TRUNC(sysdate,'MONTH')-TRUNC(ADD_MONTHS(sysdate,-1),'MONTH'))
      FROM CONTRACT C2, TARIFF
      WHERE C2.CON_TARID = TAR_ID
          AND C2.CON_ID = C1.CON_ID
      )
  WHERE C1.CON_ETID = DECODE(p_SET_ETID,'SLA','LAC','MLA','MLC','invalid')
    AND C1.CON_ESID IN ('A','I')
    AND (( C1.CON_DATESTART < TRUNC(sysdate,'MONTH')) OR  ( C1.CON_DATESTART IS NULL))
    AND (( C1.CON_DATEEND > TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')) OR  ( C1.CON_DATEEND IS NULL))
    AND C1.CON_TARID NOT IN ('P','Q','R','S','T','U','V','W','X','Y','Z')       --038SO
  ;

  x_pscall_last := 'rubbish';
  x_conid_last := NULL;

  For cMinChargeableContractsRow IN cMinChargeableContracts LOOP

    If cMinChargeableContractsRow.x_pscall <> x_pscall_last Then
        -- only first occurence  of a pseudo numbers needs to be processed
        -- (eliminate duplicates returned by cursor)

        x_mincharge_tot := 0.0;

        For cMinChargeByDayRow IN cMinChargeByDay(cMinChargeableContractsRow.x_pscall) Loop
            -- add minimum charges for the days with running contract(s)
            x_mincharge_tot := x_mincharge_tot + cMinChargeByDayRow.x_mincharge_day;
        End Loop;

        -- update the effectively chargeable minimum charge on the contract selected
        -- this value is compared in the VB part of the OC to the already charged amounts
        -- for this pseudo call number
        UPDATE CONTRACT
            SET CON_MCAPPLIED = x_mincharge_tot
        WHERE CON_ID = cMinChargeableContractsRow.x_conid
        ;

        x_pscall_last := cMinChargeableContractsRow.x_pscall;

    End If;

  End Loop;

  RecordsAffected := SQL%ROWCOUNT ;
  ErrorCode := 0;
  ReturnStatus := 1;
  Return;

/*
Exception
When Others then
   ErrorCode := SQLCODE;
   ErrorMsg  := SQLERRM;
   ReturnStatus := 0;
   RecordsAffected := 0;
*/

END SP_LAPMCC;


procedure SP_LAM_MCC
(
   p_PAC_ID         IN varchar2,
   p_BOH_ID         IN varchar2,
   p_SET_ETID       IN varchar2,    -- SLA or MLA
   p_Gart           In Number,      --016SO
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     OUT number )
IS  --015SO

  Cursor C1  Is
    SELECT
        SEP_DATE2-1                                                             as PosDATETIME,
        C1.CON_PSCALL                                                           as PosMSISDN,
        C1.CON_ID                                                               as PosConId,
        C1.CON_CONSOL                                                           as PosCONSOLIDATION,
        C1.CON_TARID                                                            as PosTarId,
        NVL(C1.CON_PRICEHG,TAR_PRICEHG)                                         as PosPrice,  -- MO price (used for MCC correction, in case of HG)
        'MCC'                                                                   as PosSetDetailType,
        NVL(C1.CON_HDGROUP,0)                                                   as PosHdGroup,
        '0'                                                                     as PosInternational,
        C1.CON_MCAPPLIED                                                        as PosMinCharge,
        SED_COUNT1                                                              as PosCountMT,
        SED_COUNT2                                                              as PosCountMO,
        SED_TOTAL                                                               as PosAmount
    FROM CONTRACT C1, TARIFF, LA_SETTLING_ACCUMULATED
    WHERE TAR_ID = C1.CON_TARID
    AND C1.CON_ETID = DECODE(p_SET_ETID,'SLA','LAC','MLA','MLC','invalid')
    AND SET_ETID = p_SET_ETID
    AND C1.CON_ESID IN ('A','I')
    AND (( C1.CON_DATESTART < TRUNC(sysdate,'MONTH')) OR (C1.CON_DATESTART IS NULL))
    AND (( C1.CON_DATEEND > TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')) OR ( C1.CON_DATEEND IS NULL ))
    AND C1.CON_TARID NOT IN ('P','Q','R','S','T')                               --030SO -- info service Tariffs
    AND SED_CHARGE = C1.CON_PSCALL
    AND CON_MCAPPLIED IS NOT NULL

    UNION ALL

    SELECT
        TRUNC(sysdate,'MONTH')-1                                                as PosDATETIME,
        C1.CON_PSCALL                                                           as PosMSISDN,
        C1.CON_ID                                                               as PosConId,
        C1.CON_CONSOL                                                           as PosCONSOLIDATION,
        C1.CON_TARID                                                            as PosTarId,
        NVL(C1.CON_PRICEHG,TAR_PRICEHG)                                         as PosPrice,
        'MCC'                                                                   as PosSetDetailType,
        NVL(C1.CON_HDGROUP,0)                                                   as PosHdGroup,
        '0'                                                                     as PosInternational,
        C1.CON_MCAPPLIED                                                        as PosMinCharge,
        0                                                                       as PosCountMT,
        0                                                                       as PosCountMO,
        0.0                                                                     as PosAmount
    FROM CONTRACT C1, TARIFF
    Where TAR_ID = C1.CON_TARID
    AND C1.CON_ESID IN ('A','I')
    AND (( C1.CON_DATESTART < TRUNC(sysdate,'MONTH')) OR (C1.CON_DATESTART IS NULL))
    AND (( C1.CON_DATEEND > TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')) OR ( C1.CON_DATEEND IS NULL ))
    AND C1.CON_TARID NOT IN ('P','Q','R','S','T')                               --030SO -- info service Tariffs
    AND CON_MCAPPLIED IS NOT NULL
    AND C1.CON_ETID = DECODE(p_SET_ETID,'SLA','LAC','MLA','MLC','invalid')
    AND NOT EXISTS (SELECT * FROM LA_SETTLING_ACCUMULATED WHERE SED_CHARGE = C1.CON_PSCALL AND SET_ETID = p_SET_ETID)
    ; --038SO

    l_BillText          Varchar2(100);
    l_TimeOffset        NUMBER;
    l_MinChargeLimit    FLOAT;
    l_MCC               FLOAT;


BEGIN

    ErrorCode := 0;             --023SO
    RecordsAffected := 0;
    ReturnStatus := PKG_COMMON.RETURN_STATUS_OK;        -- assume this for now

    For C1_Rec in C1 Loop

        l_MinChargeLimit := C1_Rec.PosMinCharge;
        if C1_Rec.PosHdGroup = 1 then
            l_MinChargeLimit := l_MinChargeLimit - C1_Rec.PosCountMO * C1_Rec.PosPrice;
        end if;
        l_MCC := l_MinChargeLimit - C1_Rec.PosAmount;

        if l_MCC > 0.0 then

            ReturnStatus := 0;

            l_TimeOffset := nextAvailableTimestamp(C1_Rec.PosMSISDN,C1_Rec.PosDATETIME);

            l_BillText := billTextMinCharge(C1_Rec.PosCONSOLIDATION, C1_Rec.PosTarId, C1_Rec.PosDATETIME);

            PKG_BDETAIL_SETTLEMENT.SP_ADD_SETDETAIL(
                   p_SET_ETID,                                                  -- p_SET_ETID       IN varchar2,
                   C1_Rec.PosSetDetailType,                                     -- p_SED_ETID       IN varchar2,
                   C1_Rec.PosMSISDN,                                            -- p_SED_CHARGE     IN varchar2,
                   p_BOH_ID,                                                    -- p_SED_BOHID      IN varchar2,
                   C1_Rec.PosDATETIME + l_TimeOffset/24/3600,                   -- p_Date           IN DATE,
                   C1_Rec.PosConId,                                             -- p_SET_CONID      IN varchar2,
                   C1_Rec.PosTarId,                                             -- p_SED_TARID      IN varchar2,
                   C1_Rec.PosInternational,                                     -- p_SED_INT        IN varchar2,
                   'U',             --C1_Rec.PosPrepaid,                        -- p_SED_PREPAID    IN varchar2,
                   l_MCC,                                                       -- p_SED_PRICE      IN float,
                   0.0,             --C1_Rec.AmountCu,                          -- p_SED_AMOUNTCU   IN float,
                   0.0,             --C1_Rec.RevenueShareLa,                    -- p_SED_RETSHAREPV IN float,
                   0.0,             --C1_Rec.RevenueShareOp,                    -- p_SED_RETSHAREMO IN float,
                   NULL,            --C1_Rec.PosLongId,                         -- p_SED_LONGID     IN varchar2,
                   0,               --C1_Rec.CdrCountMT,                        -- p_SED_COUNT1     IN number,
                   0,               --C1_Rec.CdrCountMO,                        -- p_SED_COUNT2     IN number,
                   l_BillText,                                                  -- p_SED_DESC       IN varchar2,
                   p_Gart,          --C1_Rec.PosGart,                           -- p_GART           IN varchar2,    --016SO
                   ErrorCode,                                                   -- ErrorCode        OUT number,
                   ErrorMsg,                                                    -- ErrorMsg         OUT varchar2,
                   ReturnStatus                                                 -- ReturnStatus     IN OUT number
            );

            if ReturnStatus = 1 then
                RecordsAffected :=   RecordsAffected + 1;
            else
                PKG_COMMON.INSERT_WARNING(
                     'LA SETTLEMENT',
                     'PKG_BDETAIL_SETTLEMENT.SP_LAM_MCC',
                     'PROCESSING ERROR ' || ErrorCode,
                     ErrorMsg,
                     NULL,
                     p_BOH_ID
                );   --032SO
                EXIT;  -- C1_Rec
            end if;
        end if;  -- l_MCC > 0.0
    End Loop;  -- C1_Rec

    Return;
/*
Exception
When Others then
   ErrorCode := SQLCODE;
   ErrorMsg  := SQLERRM;
   ReturnStatus := 0;
   RecordsAffected := 0;
*/

END SP_LAM_MCC;

Procedure SP_LIT_CDR
(
  p_BD_BOHID      In      Varchar2,
  p_SET_ETID      IN      varchar2,     -- 'SLA'  or 'MLA'
  p_Gart          In      Number,
  p_MinAge        In      Number,
  p_MaxAge        In      Number,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  RecordsAffected Out     Number
)
Is  --018SO

  Cursor C1 Is
    SELECT
        TRUNC(to_date(SED_ORDER,'YYYY-MM-DD HH24:MI:SS'))                       as PosDATETIME,
        SED_CHARGE                                                              as PosMSISDN,
        SET_CONID                                                               as PosConId,
        CON_CONSOL                                                              as PosCONSOLIDATION,
        SED_TARID                                                               as PosTarId,
        NVL(SED_INT,'0')                                                        as PosInternational,
        SUBSTR(SED_ETID,1,LENGTH(SED_ETID)-1) || 'T'                            as PosSetDetailType,    --024SO IOTLACT / MOIWST
        NVL(SED_PREPAID,'U')                                                    as PosPrepaid,
        p_Gart                                                                  as PosGart,
        Count(*)                                                                as CdrCount,
        SUM(SED_COUNT1)                                                         as CdrCountMT,
        SUM(SED_COUNT2)                                                         as CdrCountMO,
        ROUND(SUM(SED_TOTAL),2)                                                 as AmountTotal,         --027SO
        SUM(NVL(SED_AMOUNTCU,0.0))                                              as AmountCu,
        SUM(NVL(SED_RETSHAREPV,0.0))                                            as RevenueShareLa,
        SUM(NVL(SED_RETSHAREMO,0.0))                                            as RevenueShareOp
    From SETDETAIL, SETTLING, CONTRACT
    Where SETDETAIL.SED_SETID = SETTLING.SET_ID
    AND SED_ORDER > to_char(sysdate-p_MaxAge,'YYYY-MM-DD')
    AND SED_ORDER < to_char(sysdate-p_MinAge,'YYYY-MM-DD')
    AND CONTRACT.CON_ID = SETTLING.SET_CONID
    AND SED_GOHID = p_BD_BOHID
    GROUP BY
        TRUNC(to_date(SED_ORDER,'YYYY-MM-DD HH24:MI:SS')),                      -- PosDATETIME,
        SED_CHARGE,                                                             -- PosMSISDN,
        SET_CONID,                                                              -- PosConId,
        CON_CONSOL,                                                             -- PosCONSOLIDATION,
        SED_TARID,                                                              -- PosTarId,
        NVL(SED_INT,'0'),                                                       -- PosInternational,
        SUBSTR(SED_ETID,1,LENGTH(SED_ETID)-1),                                  -- PosSetDetailType,
        NVL(SED_PREPAID,'U'),                                                   -- PosPrepaid,
        p_Gart                                                                  -- PosGart,
    ORDER by 1,2,3,4,5,6,7,8,9
    ;

    l_ReturnStatus      NUMBER(1);

    l_TimeOffset        NUMBER;
    l_Amount            Number;
    l_BillText          Varchar2(100);
    l_Ufih              Varchar2(400);

Begin

    RecordsAffected := 0;
    ErrorCode := 0;

    For C1_Rec in C1 Loop

        l_ReturnStatus := 0;

        l_TimeOffset := nextAvailableTimestamp(C1_Rec.PosMSISDN,C1_Rec.PosDATETIME);

        l_BillText := billTextLi(C1_Rec.PosCONSOLIDATION,C1_Rec.CdrCountMT,C1_Rec.CdrCountMO);

        PKG_BDETAIL_SETTLEMENT.SP_ADD_SETDETAIL(
               p_SET_ETID,                                              -- p_SET_ETID       IN varchar2,
               C1_Rec.PosSetDetailType,                                 -- p_SED_ETID       IN varchar2,
               C1_Rec.PosMSISDN,                                        -- p_SED_CHARGE     IN varchar2,
               p_BD_BOHID,                                              -- p_SED_BOHID      IN varchar2,
               C1_Rec.PosDATETIME + l_TimeOffset/24/3600,               -- p_Date           IN DATE,
               C1_Rec.PosConId,                                         -- p_SET_CONID      IN varchar2,
               C1_Rec.PosTarId,                                         -- p_SED_TARID      IN varchar2,
               C1_Rec.PosInternational,                                 -- p_SED_INT        IN varchar2,
               C1_Rec.PosPrepaid,                                       -- p_SED_PREPAID    IN varchar2,
               C1_Rec.AmountTotal,                                      -- p_SED_PRICE      IN float,
               C1_Rec.AmountCu,                                         -- p_SED_AMOUNTCU   IN float,
               C1_Rec.RevenueShareLa,                                   -- p_SED_RETSHAREPV IN float,
               C1_Rec.RevenueShareOp,                                   -- p_SED_RETSHAREMO IN float,
               NULL,            --C1_Rec.PosLongId,                     -- p_SED_LONGID     IN varchar2,
               C1_Rec.CdrCountMT,                                       -- p_SED_COUNT1     IN number,
               C1_Rec.CdrCountMO,                                       -- p_SED_COUNT2     IN number,
               l_BillText,                                              -- p_SED_DESC       IN varchar2,
               C1_Rec.PosGart,                                          -- p_GART           IN varchar2,
               ErrorCode,                                               -- ErrorCode        OUT number,
               ErrorMsg,                                                -- ErrorMsg         OUT varchar2,
               l_ReturnStatus                                           -- ReturnStatus     IN OUT number
        );
        if l_ReturnStatus = 1 then
            RecordsAffected :=   RecordsAffected + C1_Rec.CdrCount;
        else
            PKG_COMMON.INSERT_WARNING(
                 'LA SETTLEMENT',
                 'PKG_BDETAIL_SETTLEMENT.SP_LIT_CDR',
                 'PROCESSING ERROR ' || ErrorCode,
                 ErrorMsg,
                 NULL,
                 p_BD_BOHID
            );  --032SO
            EXIT;  -- C1_Rec
        end if;

    End Loop;  -- C1_Rec

    Return;
/*
Exception
  When Others Then
      ErrorCode := SqlCode;
      ErrorMsg  := SqlErrM;
      RecordsAffected := 0;
*/
End SP_LIT_CDR;


PROCEDURE insertPeriod(
    p_CODE      IN varchar2
)IS     --019SO
BEGIN

    INSERT INTO SETPERIOD (
        SEP_ID,
        SEP_DATE1,
        SEP_DATE2,
        SEP_LANG01,
        SEP_LANG02,
        SEP_LANG03,
        SEP_LANG04
    ) (
        SELECT
            p_CODE,
            to_date(p_CODE,'YYYYMM'),
            to_date(to_char(ADD_MONTHS(to_date(p_CODE,'yyyymm'),1),'yyyymm'),'YYYYMM'),
            to_char(to_date(p_CODE,'YYYYMM'),'Month','NLS_DATE_LANGUAGE = American') || ' ' || to_char(to_date(p_CODE,'YYYYMM'),'YYYY'),
            to_char(to_date(p_CODE,'YYYYMM'),'Month','NLS_DATE_LANGUAGE = German'  ) || ' ' || to_char(to_date(p_CODE,'YYYYMM'),'YYYY'),
            to_char(to_date(p_CODE,'YYYYMM'),'Month','NLS_DATE_LANGUAGE = French'  ) || ' ' || to_char(to_date(p_CODE,'YYYYMM'),'YYYY'),
            to_char(to_date(p_CODE,'YYYYMM'),'Month','NLS_DATE_LANGUAGE = Italian' ) || ' ' || to_char(to_date(p_CODE,'YYYYMM'),'YYYY')
        FROM DUAL
        WHERE NOT EXISTS (SELECT SEP_ID FROM SETPERIOD WHERE SEP_ID = p_CODE)
    );
END;

PROCEDURE SP_CONS_INSERT_PERIOD(
   p_PAC_ID         IN varchar2,
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     OUT number
)
IS --019SO

BEGIN

    insertPeriod(to_char(add_months(sysdate,1),'YYYYMM'));

    ErrorCode :=0;
    ErrorMsg :=NULL;
    ReturnStatus:= 1;

    return;
END;

END; -- Package Body PKG_BDETAIL_SETTLEMENT
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- PKG_BDETAIL_SMSC  (Package Body) 
--
CREATE OR REPLACE PACKAGE BODY SBS1_ADMIN.PKG_BDETAIL_SMSC as

-- MODIFICATION HISTORY
-- Person       Date        Comments
-- -------------------      ------------------------------------------
--  001SO       06.01.2004  correcting bracketing in SP_CONS_SMSC
--  002SO       17.06.2004  exclude Tariff M (mVoting) from Minimum Charge Correction
--  003SO       21.10.2004  Rebuild index partitions instead of using default tablespace
--  004SO       21.10.2004  Compile all in error case too
--  005SO       01.12.2004  Correct index ageing for SMSD indexes (went to SMSC tablespaces before)
--  006SO       16.08.2006  Add period entry by using PKG_BDETAIL_COMMON.SP_INSERT_PERIOD()
--  006SO       09.09.2007  Add SP_UPDATE_BOHEADER_SMSC_2 (moved from PKG_INTERWORKING)
--  007SO       25.09.2007  Reduce retries in manual SMSC partition creation from 100 to 2
--  008SO       25.09.2007  Add error logging for partition creation
--  009SO       21.01.2008  Remove SP_INSERT_SMSC, SP_UPDATE_BIHEADER_SMSC, SP_DELETE_BDETAIL_SMSC, SP_DELETE_ALL_RECORDS_SMSC
--  010SO       22.05.2009  Add SC terminated counter update for home routed SMS
--  011SO       27.05.2009  Add SP_UPDATE_BOHEADER_SMSC_1 for home routed IW counting SMSCCU
--  012SO       28.05.2009  Implement Settlement for SMS Global Reply
--  013SO       04.06.2009  Change SMS Global reply settlement from BDETAIL1 to BDETAIL2
--  014SO       08.06.2009  Add procedure SP_UPDATE_BOHEADER_SMSCCU_1
--  015SO       08.06.2009  Correct bugs in SP_SETTLE_GLOBAL_REPLY
--  016SO       09.06.2009  Remove SP_UPDATE_BOHEADER_CHECKLA_0, SP_UPDATE_BOHEADER_GEMLAT_0
--  017SO       10.06.2009  Use Accumulation for home routing monthly fees and refuse double settlement
--  018SO       12.06.2009  Set customer price to 0.00 for global reply monthly fees
--  019SO       12.06.2009  Correct cleanup in SP_SETTLE_GLOBAL_REPLY
--  020SO       16.06.2009  Use final settlement detail description also for LongID/ShortId accumulation
--  021SO       16.06.2009  Set description for accumulating settlement items which need to be printed
--  022SO       24.06.2009  Correct wrong code for home routed IW refund accumulation
--  023SO       24.09.2009  Ignore not null constraint when counting terminating IW SMS with unknown SMSC ID
--  024SO       31.10.2009  Remove obsolete partition ageing methods ADD_SMSC_PARTITIONS.. ADD_SMSD_PARTITIONS...
--  025SO       31.10.2009  31.03.2010  Implement SP_SMSCCA_TRY (mark and process MSC counter updates)
--  026SO       14.04.2010  Remove Normalisation in DGTI and OGTI Consolidation
--  027SO       15.04.2010  Update state after counter update
--  028SO       17.08.2010  Implement SMSC-LA accumulation in SP_LAA_SMS_TRY
--  029SO       19.08.2010  Correct Group Syntax for changed field
--  030SO       19.08.2010  Correct VAT Code to NA (was N/A)
--  031SO       20.08.2010  Implement SMS-LA UFIH ticket generation in SP_LAT_SMS_CONS
--  032SO       23.08.2010  Remove exception handling for SMS-LA Settlement hard errors
--  033SO       24.08.2010  Implement SP_LAM_SMS_CONS (MCC Consolidation, UFI creation)
--  034SO       25.08.2010  Take out GR processing from SP_LAT_SMS_CONS and implement in SP_LAT_MFGR_CONS
--  035SO       26.08.2010  Rename procedures according to driving Packing-ID
--  036SO       31.08.2010  Implement SP_TRY_LIA_SMS (SMS-LA IW Accumulation, outgoing IW SMS)
--  037SO       31.08.2010  Implement SP_CONS_LIT_SMS
--  038SO       31.08.2010  Implement SP_TRY_LIA_RSGR
--  039SO       06.09.2010  Correct Error Handling
--  040SO       07.09.2010  Consider empty markings and report as success
--  041SO       07.09.2010  Guard old partitions using datetime criterium when commiting marking
--  042SO       07.09.2010  Remove cursor variables where not necessary / check status in ACCU
--  042SO       07.09.2010  Include 'MOIWSA' when generating UFIH IW tickets
--  043SO       08.09.2010  Guard old partitions with 1 hour tolerance
--  044SO       10.09.2010  Set error code when processed records <> marked records
--  045SO       18.09.2010  IW Accumulators: Calculate IW Tariff when marking
--  046SO       18.09.2010  Add ROC_IOT_INTERNAL to consolidation
--  047SO       20.09.2010  Tolerate NULL prices when accumulating charges
--  048SO       21.09.2010  Correct bug in Global reply revenue share calculation
--  049SO       21.09.2010  Do not count zero global reply revenue shares
--  050SO       04.10.2010  Correct result state in SP_CONS_OGTI
--  051SO       11.04.2011  Consider Televote Transport CDRs with tariff T
--  051SOa      12.10.2010  Correct min charge preparation in SP_CONS_LAPMCC_SMS
--  052SO       14.12.2011  Remove schema qualifier "S B S 0 ."
--  053SO       17.10.2013  Add M2M outgoing SMS to IW consolidation
--  054SO       22.02.2016  Implement SC terminating IW counting for home routed roaming cases
--  055SO       23.02.2016  Fix IW Counting for empty home routing counter value
--  055SO       06.03.2016  Generalize settlement for new SMSC and simplify signatures
--  056SO       10.06.2016  Suppress unwanted incoming IW CDRs for ROCONSOLIDATION
--  057SO       09.08.2016  Suppress Tariff 'i' and all internal interworking costs from settlement table
--  058SO       06.10.2016  Ignore internal home routed SMS (OnNet) in Output Consolidation
--  059SO       06.10.2016  Remove obsolete SMS-MV* CDR Type References
--  060SO       16.10.2016  Remove more references to mVoting CDR Tags SMS-MV*
--  061SO       16.10.2016  Assume BD_RETSHAREPV = BD_RETSHAREMO = 0.00 (mVoting cleanup)
--  062SO       16.10.2016  Distinguish OMN from Acision in MO/MT counting for Large Accounts
--  063SO       22.10.2016  Fixes SMS-LA Settlement
--  064SO       09.12.2016  Move MOFN Accumulation from SP_LAA_SMS_ACCU (BDETAIL1) to SP_LAA_SMS_ACCU (BDETAIL2)
--  065SO       09.12.2016  Remove some support for SMSC (old Acision specialities)
--  066SO       10.12.2016  Fix Query in MOFNA processing
--  067SO       12.07.2017  Compress LongId ranges
--  068SO       04.08.2017  Cosmetic comment change
--  069SO       16.02.2018  Consolidate seperately per CDR Type (ROCONSOLIDATION)
--  070SO       13.04.2018  Accumulate pager messages separately into SETDETAIL as PAGA
--  071SO       16.04.2018  Settle pager messages separately (PAG)
--  072SO       10.05.2018  Fix double billing issue for LongIDs with more than one contract in period


Procedure SP_SMSCCU_UPDATE
( BatchSize       In      Integer,
  p_BD_PACSID     In      Varchar2,
  p_BD_BOHID      In      Varchar2,
  p_MaxAge        In      Number,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  RecordsAffected In Out  Number
) --  055SO --  010SO duplicated from standard counter update based on MSC CDRs (in PKG_BDETAIL_MSC)
Is
  l_Count         Number;
  l_BD_SMSCID     Varchar2(10);

  Cursor C1 Is                                                                  --  042SO
    Select /*+ INDEX(BDETAIL2 IDX_BD_BOHID21) */
      BDETAIL2.ROWID,
      BD_SMSCID,
      BD_DATETIME,
      BD_IW_SCENARIO                                                            --  054SO
    From BDETAIL2
    Where BD_BOHID1 = p_BD_BOHID
    And   BD_DATETIME > SYSDATE - p_MaxAge
    And   BD_DATETIME < SYSDATE + 3/24
    ;   --  013SO

Begin

  RecordsAffected := 0;

  For C1_Rec in C1 Loop                                                         --  042SO
    Begin

      l_BD_SMSCID := C1_Rec.BD_SMSCID;

      -- Increment the counter by 1 when updating the count for an existing SMSC ID
      Update IWTCOUNTER Set
        IWTC_COUNT = IWTC_COUNT + DECODE(C1_Rec.BD_IW_SCENARIO,'1',1,0),                --  054SO
        IWTC_HRR_COUNT = NVL(IWTC_HRR_COUNT,0) + DECODE(C1_Rec.BD_IW_SCENARIO,'5',1,0)  --  055SO --  054SO
      Where IWTC_SMSCID = l_BD_SMSCID
      AND IWTC_DATE = TRUNC(C1_Rec.BD_DATETIME)
      AND IWTC_ESID = 'A'
      ;
      If Sql%NotFound Then

        -- If the counter does not exist, insert a new one
        -- Initialise the counter with 1 when inserting the count for a new SMSC ID,
        -- set the Counter state to 'A'ccumulating

        if LENGTH(l_BD_SMSCID)> 0 then  --  023SO
            Insert Into IWTCOUNTER (
                IWTC_DATE, IWTC_SMSCID,
                IWTC_COUNT,
                IWTC_HRR_COUNT,
                IWTC_ESID
            ) Values (
                TRUNC(C1_Rec.BD_DATETIME), l_BD_SMSCID,
                DECODE(C1_Rec.BD_IW_SCENARIO,'1',1,0),                          --  054SO
                DECODE(C1_Rec.BD_IW_SCENARIO,'5',1,0),                          --  054SO
                'A'
            );
        end if;

        RecordsAffected :=   RecordsAffected + 1;

      Else

        -- Counter was updated, ,increment the record count by the rows updated
        RecordsAffected :=   RecordsAffected + Sql%RowCount;

      End If;

    End;
  End Loop;

  Return;
/*
Exception
  When Others Then
  ErrorCode := SqlCode;
  ErrorMsg  := SqlErrM;
  RecordsAffected := 0;
*/
End SP_SMSCCU_UPDATE;


procedure SP_TRY_SMSCCU
(
  p_PAC_ID         IN       varchar2,       -- 'SMSCCU'     SMSC COUNTER UPDATE
  p_BOH_ID         IN OUT   varchar2,
  RecordsAffected  OUT      number,
  ErrorCode        OUT      number,
  ErrorMsg         OUT      varchar2,
  ReturnStatus     OUT      number
)
Is  --  025SO

    CURSOR cCheckCandidate(max_age INTEGER) IS
    SELECT /*+ INDEX(BDETAIL2 IDX_BD_PACSID21) */ 'dummy'
    FROM   BDETAIL2
    where  BD_MAPSID = 'R'
    and ROWNUM <= 1
    and BD_CDRTID = 'SMS-HR'
    and BD_PACSID1 = 'S'
    and BD_DATETIME > SYSDATE - max_age
    and BD_DATETIME < SYSDATE + 3/24
    ;   --  055SO

    l_max_age      INTEGER;
    l_batch_count  INTEGER;
    l_marked_count INTEGER;
    l_dummy        VARCHAR2(10);

BEGIN

    RecordsAffected := 0;
    ReturnStatus := PKG_COMMON.RETURN_STATUS_OK;        -- assume this for now

    l_max_age := to_number(PKG_COMMON_PACKING.getPackingParameter(p_PAC_ID,'MAXAGE'));
    l_batch_count := to_number(PKG_COMMON_PACKING.getPackingParameter(p_PAC_ID,'BATCHCOUNT'));

    l_dummy := NULL;
    OPEN cCheckCandidate(l_max_age);
    FETCH cCheckCandidate into l_dummy;
    CLOSE cCheckCandidate;

    if l_dummy is not NULL then

        PKG_COMMON_PACKING.INSERT_BOHEADER_SPTRY(p_PAC_ID, p_BOH_ID);

        -- mark rows for processing
        update /*+ INDEX(BDETAIL2 IDX_BD_PACSID21) */ BDETAIL2 set
            BD_BOHID1 = p_BOH_ID,
            BD_PACSID1 = 'P'
        where BD_MAPSID = 'R'
        and ROWNUM <= l_batch_count
        and BD_CDRTID = 'SMS-HR'
        and BD_PACSID1 = 'S'
        and BD_DATETIME > SYSDATE - l_max_age
        and BD_DATETIME < SYSDATE
        ; --  055SO
        l_marked_count := Sql%rowcount;

        if l_marked_count > 0 then

            SP_SMSCCU_UPDATE(
              l_marked_count,
              NULL,
              p_BOH_ID,
              l_max_age,
              ErrorCode,
              ErrorMsg,
              RecordsAffected
            ); --  055SO

            if RecordsAffected = l_marked_count then
                -- update state after successful counting                       --  027SO
                update  /*+ INDEX(BDETAIL2 IDX_BD_BOHID21) */ BDETAIL2 set
                        BD_PACSID1 = 'D'
                where   BD_BOHID1 = p_BOH_ID
                and     BD_PACSID1 = 'P'
                and     BD_DATETIME > SYSDATE - l_max_age - 1/24                --  043SO
                ;
                l_marked_count := Sql%rowcount;

            else
                ROLLBACK;
                PKG_COMMON.INSERT_WARNING(
                     'SC TERMINATING SMS IW SETTLEMENT',
                     'PKG_BDETAIL_SMSC.SP_TRY_SMSCCU',
                     'PROCESSING ERROR',
                     'Mismatch in marked/processed SMS CDR counts (' || l_marked_count || '/' || RecordsAffected || ')',
                     NULL,
                     p_BOH_ID
                );
                ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
            end if;
        end if;
    end if;

exception

    when PKG_COMMON.EXCP_INCONVENIENT_TIME then
        ErrorCode := PKG_COMMON.ENO_INCONVENIENT_TIME;
        ErrorMsg := PKG_COMMON.EDESC_INCONVENIENT_TIME;
        ReturnStatus := PKG_COMMON.RETURN_STATUS_SUSPENDED;
        ROLLBACK;
/*
    when PKG_COMMON_PACKING.EXCP_STATISTICS_FAILURE then
        ErrorCode := PKG_COMMON_PACKING.ENO_STATISTICS_FAILURE;
        ErrorMsg := PKG_COMMON_PACKING.EDESC_STATISTICS_FAILURE;
        ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
        ROLLBACK;
    when PKG_COMMON_PACKING.EXCP_WORKFLOW_ABORT then
        ErrorCode := PKG_COMMON_PACKING.ENO_WORKFLOW_ABORT;
        ErrorMsg := PKG_COMMON_PACKING.EDESC_WORKFLOW_ABORT;
        ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
        ROLLBACK;
    when Others then
        ErrorCode := SqlCode;
        ErrorMsg  := SqlErrM;
        ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
        RecordsAffected := 0;
        ROLLBACK;
*/
END SP_TRY_SMSCCU;


procedure SP_UPDATE_BOHEADER_SMSC_0
( p_bohid         In      Varchar2,
  p_status        In      Varchar2,
  p_count         In      Number,
  p_MaxAge        In      Number,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  ReturnStatus    In Out  Number
)
IS
   x_datefc       date;
   x_datelc       date;
   x_reccount     number;
   x_packid       varchar2(10);
   x_fileseqmax   number;
   x_nextseq      number;

Begin
   If p_status = 'S' then /*--- conversion was successful ---- */
      Begin
          x_datefc := NULL;
          x_datelc := NULL;
          x_reccount := p_count;
          Update Boheader set
            boh_DATEFC = x_datefc,
            boh_DATELC = x_datelc,
            boh_RecCount = x_reccount,
            boh_end = sysdate,
            boh_esid = 'OK',
            boh_filename = REPLACE(boh_filename,'Temp-','')
          where boh_id = p_bohid;

          select boh_packid into x_packid
                    from boheader where boh_id = p_bohid;
          select pac_fileseqmax, pac_nextseq into x_fileseqmax, x_nextseq
                    from packing where pac_id  = x_packid;
          If x_fileseqmax = x_nextseq then /*** need to recycle ***/
             Begin
               x_nextseq := 1;
             End;
          else
             Begin
               x_nextseq := x_nextseq + 1;
             End;
          end if;
          update packing set
            pac_nextseq = x_nextseq
          where pac_id = x_packid;
      End;
   Else /*---- file error encountered ----*/
      Begin
        Update Boheader set
          boh_end = sysdate,
          boh_esid = 'PAE'
        where boh_id = p_bohid;
      End;
   End if;
   Returnstatus := 1;
   -- Commit;
   Return;
Exception
When Others then
   ErrorCode := SQLCODE;
   ErrorMsg  := SQLERRM;
   ReturnStatus := 0;
END SP_UPDATE_BOHEADER_SMSC_0;

Procedure SP_UPDATE_BOHEADER_SMSC_1
(
  p_bohid         In      Varchar2,
  p_status        In      Varchar2,
  p_count         In      Number,
  p_MaxAge        In      Number,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  ReturnStatus    In Out  Number
) --  011SO
IS
   x_datefc        date;
   x_datelc        date;
   x_reccount      number;
   x_packid    varchar2(10);
   x_fileseqmax  number;
   x_nextseq   number;

Begin
   If p_status = 'S' then /*--- conversion was successful ---- */
      Begin
            select /*+ INDEX(BDETAIL1 IDX_BD_BOHID11) */ min(BD_DATETIME) into x_datefc
            from BDETAIL1
            where bd_bohid1 = p_bohid
            and BD_DATETIME > sysdate-p_MaxAge and BD_DATETIME < sysdate + 3/24;

            select /*+ INDEX(BDETAIL1 IDX_BD_BOHID11) */ max(BD_DATETIME) into x_datelc
            from BDETAIL1
            where bd_bohid1 = p_bohid
            and BD_DATETIME > sysdate-p_MaxAge and BD_DATETIME < sysdate + 3/24;

            select /*+ INDEX(BDETAIL1 IDX_BD_BOHID11) */ count(*) into x_reccount
            from BDETAIL1
            where bd_bohid1 = p_bohid
            and BD_PACSID1 = 'D' and BD_DATETIME > sysdate-p_MaxAge and BD_DATETIME < sysdate + 3/24;

            Update Boheader set
              boh_DATEFC = x_datefc,
              boh_DATELC = x_datelc,
              boh_RecCount = x_reccount,
              boh_end = sysdate,
              boh_esid = 'OK',
              boh_filename = REPLACE(boh_filename,'Temp-','')
            where boh_id = p_bohid;

            select boh_packid into x_packid
                      from boheader where boh_id = p_bohid;
            select pac_fileseqmax, pac_nextseq into x_fileseqmax, x_nextseq
                      from packing where pac_id  = x_packid;
            If x_fileseqmax = x_nextseq then /*** need to recycle ***/
                 x_nextseq := 1;
            else
                 x_nextseq := x_nextseq + 1;
            end if;
            update packing set
              pac_nextseq = x_nextseq
            where pac_id = x_packid;
      End;
   Else /*---- file error encountered ----*/
      Begin
        Update Boheader set
          boh_end = sysdate,
          boh_esid = 'PAE'
        where boh_id = p_bohid;

        Update /*+ INDEX(BDETAIL1 IDX_BD_BOHID11) */ BDETAIL1  set
          BD_PACSID1 = 'E',
          bd_borecno1 = Null,
          bd_bohid1 = Null
        where bd_bohid1 = p_bohid
        and BD_DATETIME > sysdate-p_MaxAge and BD_DATETIME < sysdate + 3/24;
      End;
   End if;
   Returnstatus := 1;
   -- Commit;
   Return;
Exception
When Others then
   ErrorCode := SQLCODE;
   ErrorMsg  := SQLERRM;
   ReturnStatus := 0;
END SP_UPDATE_BOHEADER_SMSC_1;

Procedure SP_UPDATE_BOHEADER_SMSC_2
(
  p_bohid         In      Varchar2,
  p_status        In      Varchar2,
  p_count         In      Number,
  p_MaxAge        In      Number,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  ReturnStatus    In Out  Number
)
IS
   x_datefc        date;
   x_datelc        date;
   x_reccount      number;
   x_packid    varchar2(10);
   x_fileseqmax  number;
   x_nextseq   number;

Begin
   If p_status = 'S' then /*--- conversion was successful ---- */
      Begin
            select /*+ INDEX(BDETAIL2 IDX_BD_BOHID22) */ min(BD_DATETIME) into x_datefc
            from BDETAIL2
            where bd_bohid2 = p_bohid
            and BD_DATETIME > sysdate-p_MaxAge and BD_DATETIME < sysdate + 3/24;

            select /*+ INDEX(BDETAIL2 IDX_BD_BOHID22) */ max(BD_DATETIME) into x_datelc
            from BDETAIL2
            where bd_bohid2 = p_bohid
            and BD_DATETIME > sysdate-p_MaxAge and BD_DATETIME < sysdate + 3/24;

            select /*+ INDEX(BDETAIL2 IDX_BD_BOHID22) */ count(*) into x_reccount
            from BDETAIL2
            where bd_bohid2 = p_bohid
            and BD_PACSID2 = 'D' and BD_DATETIME > sysdate-p_MaxAge and BD_DATETIME < sysdate + 3/24;

            Update Boheader set
              boh_DATEFC = x_datefc,
              boh_DATELC = x_datelc,
              boh_RecCount = x_reccount,
              boh_end = sysdate,
              boh_esid = 'OK',
              boh_filename = REPLACE(boh_filename,'Temp-','')
            where boh_id = p_bohid;

            select boh_packid into x_packid
                      from boheader where boh_id = p_bohid;
            select pac_fileseqmax, pac_nextseq into x_fileseqmax, x_nextseq
                      from packing where pac_id  = x_packid;
            If x_fileseqmax = x_nextseq then /*** need to recycle ***/
                 x_nextseq := 1;
            else
                 x_nextseq := x_nextseq + 1;
            end if;
            update packing set
              pac_nextseq = x_nextseq
            where pac_id = x_packid;
      End;
   Else /*---- file error encountered ----*/
      Begin
        Update Boheader set
          boh_end = sysdate,
          boh_esid = 'PAE'
        where boh_id = p_bohid;

        Update /*+ INDEX(BDETAIL2 IDX_BD_BOHID22) */ BDETAIL2  set
          BD_PACSID2 = 'E',
          bd_borecno2 = Null,
          bd_bohid2 = Null
        where bd_bohid2 = p_bohid
        and BD_DATETIME > sysdate-p_MaxAge and BD_DATETIME < sysdate + 3/24;
      End;
   End if;
   Returnstatus := 1;
   -- Commit;
   Return;
Exception
When Others then
   ErrorCode := SQLCODE;
   ErrorMsg  := SQLERRM;
   ReturnStatus := 0;
END SP_UPDATE_BOHEADER_SMSC_2;


Procedure SP_UPDATE_BOHEADER_IOTLACA_2
(
  p_bohid         In      Varchar2,
  p_status        In      Varchar2,
  p_count         In      Number,
  p_MaxAge        In      Number,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  ReturnStatus    In Out  Number
)
IS
   x_datefc        date;
   x_datelc        date;
   x_reccount      number;
   x_packid    varchar2(10);
   x_fileseqmax  number;
   x_nextseq   number;

Begin
   If p_status = 'S' then /*--- conversion was successful ---- */
      Begin
            select /*+ INDEX(BDETAIL2 IDX_BD_BOHID22) */ min(BD_DATETIME) into x_datefc
            from BDETAIL2
            where bd_bohid2 = p_bohid
            and BD_DATETIME > sysdate-p_MaxAge and BD_DATETIME < sysdate + 3/24;

            select /*+ INDEX(BDETAIL2 IDX_BD_BOHID22) */ max(BD_DATETIME) into x_datelc
            from BDETAIL2
            where bd_bohid2 = p_bohid
            and BD_DATETIME > sysdate-p_MaxAge and BD_DATETIME < sysdate + 3/24;

            select /*+ INDEX(BDETAIL2 IDX_BD_BOHID22) */ count(*) into x_reccount
            from BDETAIL2
            where bd_bohid2 = p_bohid
            and BD_PACSID2 = 'D' and BD_DATETIME > sysdate-p_MaxAge and BD_DATETIME < sysdate + 3/24;

            Update Boheader set
              boh_DATEFC = x_datefc,
              boh_DATELC = x_datelc,
              boh_RecCount = x_reccount,
              boh_end = sysdate,
              boh_esid = 'OK',
              boh_filename = REPLACE(boh_filename,'Temp-','')
            where boh_id = p_bohid;

            select boh_packid into x_packid
                      from boheader where boh_id = p_bohid;
            select pac_fileseqmax, pac_nextseq into x_fileseqmax, x_nextseq
                      from packing where pac_id  = x_packid;
            If x_fileseqmax = x_nextseq then /*** need to recycle ***/
                 x_nextseq := 1;
            else
                 x_nextseq := x_nextseq + 1;
            end if;
            update packing set
              pac_nextseq = x_nextseq
            where pac_id = x_packid;
      End;
   Else /*---- file error encountered ----*/
      Begin
        Update Boheader set
          boh_end = sysdate,
          boh_esid = 'PAE'
        where boh_id = p_bohid;

        Update /*+ INDEX(BDETAIL2 IDX_BD_BOHID22) */ BDETAIL2  set
          BD_PACSID2 = 'E',
          bd_borecno2 = Null,
          bd_bohid2 = Null
        where bd_bohid2 = p_bohid
        and BD_DATETIME > sysdate-p_MaxAge and BD_DATETIME < sysdate + 3/24;
      End;
   End if;
   Returnstatus := 1;
   -- Commit;
   Return;
Exception
When Others then
   ErrorCode := SQLCODE;
   ErrorMsg  := SQLERRM;
   ReturnStatus := 0;
END SP_UPDATE_BOHEADER_IOTLACA_2;


procedure SP_UPDATE_BOHEADER_MOIWSA_3
( p_bohid         In      Varchar2,
  p_status        In      Varchar2,
  p_count         In      Number,
  p_MaxAge        In      Number,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  ReturnStatus    In Out  Number
)
IS
   x_datefc        date;
   x_datelc        date;
   x_reccount      number;
   x_packid    varchar2(10);
   x_fileseqmax  number;
   x_nextseq   number;

Begin
   If p_status = 'S' then /*--- conversion was successful ---- */
      Begin
            select /*+ INDEX(BDETAIL2 IDX_BD_BOHID32) */ min(BD_DATETIME) into x_datefc
            from BDETAIL2
            where bd_bohid3 = p_bohid
            and BD_DATETIME > sysdate-p_MaxAge and BD_DATETIME < sysdate + 3/24;

            select /*+ INDEX(BDETAIL2 IDX_BD_BOHID32) */ max(BD_DATETIME) into x_datelc
            from BDETAIL2
            where bd_bohid3 = p_bohid
            and BD_DATETIME > sysdate-p_MaxAge and BD_DATETIME < sysdate + 3/24;

            select /*+ INDEX(BDETAIL2 IDX_BD_BOHID32) */ count(*) into x_reccount
            from BDETAIL2
            where bd_bohid3 = p_bohid
            and BD_PACSID3 = 'D' and BD_DATETIME > sysdate-p_MaxAge and BD_DATETIME < sysdate + 3/24;

            Update Boheader set
              boh_DATEFC = x_datefc,
              boh_DATELC = x_datelc,
              boh_RecCount = x_reccount,
              boh_end = sysdate,
              boh_esid = 'OK',
              boh_filename = REPLACE(boh_filename,'Temp-','')
            where boh_id = p_bohid;

            select boh_packid into x_packid
                      from boheader where boh_id = p_bohid;
            select pac_fileseqmax, pac_nextseq into x_fileseqmax, x_nextseq
                      from packing where pac_id  = x_packid;
            If x_fileseqmax = x_nextseq then /*** need to recycle ***/
                 x_nextseq := 1;
            else
                 x_nextseq := x_nextseq + 1;
            end if;
            update packing set
              pac_nextseq = x_nextseq
            where pac_id = x_packid;
      End;
   Else /*---- file error encountered ----*/
      Begin
        Update Boheader set
          boh_end = sysdate,
          boh_esid = 'PAE'
        where boh_id = p_bohid;

        Update /*+ INDEX(BDETAIL1 IDX_BD_BOHID31) */ BDETAIL1  set
          BD_PACSID3 = 'E',
          bd_borecno3 = Null,
          bd_bohid3 = Null
        where bd_bohid3 = p_bohid
        and BD_DATETIME > sysdate-p_MaxAge and BD_DATETIME < sysdate + 3/24;
      End;
   End if;
   Returnstatus := 1;
   -- Commit;
   Return;
Exception
When Others then
   ErrorCode := SQLCODE;
   ErrorMsg  := SQLERRM;
   ReturnStatus := 0;
END SP_UPDATE_BOHEADER_MOIWSA_3;


procedure SP_UPDATE_BOHEADER_SMSC_3
( p_bohid         In      Varchar2,
  p_status        In      Varchar2,
  p_count         In      Number,
  p_MaxAge        In      Number,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  ReturnStatus    In Out  Number
)
IS
   x_datefc        date;
   x_datelc        date;
   x_reccount      number;
   x_packid    varchar2(10);
   x_fileseqmax  number;
   x_nextseq   number;

Begin
   If p_status = 'S' then /*--- conversion was successful ---- */
      Begin
            select /*+ INDEX(BDETAIL1 IDX_BD_BOHID31) */ min(BD_DATETIME) into x_datefc
            from BDETAIL1
            where bd_bohid3 = p_bohid
            and BD_DATETIME > sysdate-p_MaxAge and BD_DATETIME < sysdate + 3/24;

            select /*+ INDEX(BDETAIL1 IDX_BD_BOHID31) */ max(BD_DATETIME) into x_datelc
            from BDETAIL1
            where bd_bohid3 = p_bohid
            and BD_DATETIME > sysdate-p_MaxAge and BD_DATETIME < sysdate + 3/24;

            select /*+ INDEX(BDETAIL1 IDX_BD_BOHID31) */ count(*) into x_reccount
            from BDETAIL1
            where bd_bohid3 = p_bohid
            and BD_PACSID3 = 'D' and BD_DATETIME > sysdate-p_MaxAge and BD_DATETIME < sysdate + 3/24;

            Update Boheader set
              boh_DATEFC = x_datefc,
              boh_DATELC = x_datelc,
              boh_RecCount = x_reccount,
              boh_end = sysdate,
              boh_esid = 'OK',
              boh_filename = REPLACE(boh_filename,'Temp-','')
            where boh_id = p_bohid;

            select boh_packid into x_packid
                      from boheader where boh_id = p_bohid;
            select pac_fileseqmax, pac_nextseq into x_fileseqmax, x_nextseq
                      from packing where pac_id  = x_packid;
            If x_fileseqmax = x_nextseq then /*** need to recycle ***/
                 x_nextseq := 1;
            else
                 x_nextseq := x_nextseq + 1;
            end if;
            update packing set
              pac_nextseq = x_nextseq
            where pac_id = x_packid;
      End;
   Else /*---- file error encountered ----*/
      Begin
        Update Boheader set
          boh_end = sysdate,
          boh_esid = 'PAE'
        where boh_id = p_bohid;

        Update /*+ INDEX(BDETAIL1 IDX_BD_BOHID31) */ BDETAIL1  set
          BD_PACSID3 = 'E',
          bd_borecno3 = Null,
          bd_bohid3 = Null
        where bd_bohid3 = p_bohid
        and BD_DATETIME > sysdate-p_MaxAge and BD_DATETIME < sysdate + 3/24;
      End;
   End if;
   Returnstatus := 1;
   -- Commit;
   Return;
Exception
When Others then
   ErrorCode := SQLCODE;
   ErrorMsg  := SQLERRM;
   ReturnStatus := 0;
END SP_UPDATE_BOHEADER_SMSC_3;



procedure SP_CONS_SMSC
(
   p_PACT_ID        IN varchar2,        -- 'SMSC'   SMSC Consolidation
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     OUT number )                                                --  039SO
IS

Begin

  UPDATE BDCONSOLIDATION SET BDC_ESID = 'D'
  WHERE  BDC_SEPID = TO_CHAR(TRUNC(ADD_MONTHS(sysdate,-1),'MONTH'),'YYYYMM')
    AND BDC_ETID = 'SMSC-RAW'
    AND BDC_ESID = 'R';            -- 001SO

  INSERT INTO BDCONSOLIDATION (
    BDC_ID, BDC_ETID, BDC_ESID, BDC_DATE, BDC_SEPID,
    BDC_FROMDATE, BDC_TODATE, BDC_CONSOLIDATION,
    BDC_CONID, BDC_TARID, BDC_VSMSCID,
    BDC_NPI_A , BDC_PID_A, BDC_TON_A, BDC_NPI_B, BDC_PID_B, BDC_TON_B, BDC_PREPAID,
    BDC_COUNT, BDC_AMOUNTCU, BDC_RETSHAREPV, BDC_RETSHAREMO, BDC_INT )
  SELECT  /*+ NO_INDEX(BDETAIL1) */
    GenerateUniqueKey('G'), 'SMSC-RAW', 'R', SYSDATE, SEP_ID,
    MIN(BD_DATETIME), MAX(BD_DATETIME), BD_CONSOLIDATION,
    BD_CONID, BD_TARID, BD_VSMSCID,
    BD_NPI_A, BD_PID_A, BD_TON_A, BD_NPI_B, BD_PID_B, BD_TON_B, BD_PREPAID,
    COUNT(BDETAIL1.ROWID), SUM(BD_AMOUNTCU), 0.00, 0.00, BD_INT                 --  061SO
  FROM BDETAIL1 , SETPERIOD
  WHERE BD_DATETIME >= TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
    AND BD_DATETIME < TRUNC(sysdate,'MONTH')
    AND SEP_DATE1 = TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
    AND BD_MAPSID = 'R'
  GROUP BY SEP_ID, SEP_DATE1, SEP_DATE2, BD_CONSOLIDATION, BD_CONID, BD_TARID, BD_VSMSCID, BD_NPI_A, BD_TON_A, BD_PID_A, BD_TON_B, BD_NPI_B, BD_PID_B, BD_PREPAID, BD_INT ;

  RecordsAffected := SQL%ROWCOUNT ;
  ErrorCode := 0;
  ReturnStatus := 1;
  Return;
/*
Exception
When Others then
   ErrorCode := SQLCODE;
   ErrorMsg  := SQLERRM;
   ReturnStatus := 0;
   RecordsAffected := 0;
*/
END SP_CONS_SMSC;


procedure SP_CONS_OGTI
(
   p_PACT_ID        IN varchar2,        -- 'OGTI'   OGTI consolidation
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     OUT number )                                                --  039SO
IS

Begin

    ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;                           --  040SO
    RecordsAffected := 0;                                                       --  040SO

    UPDATE OGTICONSOL SET OGTIC_ESID = 'D'
    WHERE  OGTIC_SEPID = TO_CHAR(TRUNC(ADD_MONTHS(sysdate,-1),'MONTH'),'YYYYMM')
    AND OGTIC_ETID = 'SUBMIT'
    AND OGTIC_ESID = 'R'
    ;


    INSERT INTO OGTICONSOL (
        OGTIC_ID,
        OGTIC_ETID,
        OGTIC_ESID,
        OGTIC_SEPID,
        OGTIC_OGTI,
        OGTIC_DATE,
        OGTIC_FROMDATE,
        OGTIC_TODATE,
        OGTIC_STATUS,
        OGTIC_CONID,
        OGTIC_CONSOLIDATION,
        OGTIC_PREPAID,
        OGTIC_VSMSCID,
        OGTIC_COUNT)
    SELECT  /*+ NO_INDEX(BDETAIL1) */
        GenerateUniqueKey('G'),
        'SUBMIT',
        'R',
        SEP_ID,
        BD_OGTI,                                        --  026SO
        SYSDATE,
        MIN(BD_DATETIME),
        MAX(BD_DATETIME),
        BD_STATUS,
        BD_CONID,
        BD_CONSOLIDATION,
        BD_PREPAID,
        BD_VSMSCID,
        COUNT(BDETAIL1.ROWID)
        FROM BDETAIL1 , SETPERIOD
        WHERE BD_DATETIME >= TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
        AND BD_DATETIME < TRUNC(sysdate,'MONTH')
        AND SEP_DATE1 = TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
        AND BD_MAPSID = 'R'
        GROUP BY SEP_ID, BD_OGTI, BD_STATUS, BD_CONID, BD_CONSOLIDATION, BD_PREPAID,BD_VSMSCID
    ;

    RecordsAffected := SQL%ROWCOUNT ;

    UPDATE OGTICONSOL SET OGTIC_OPKEY = (
        SELECT NBR_CONOPKEY
        FROM NUMBERRANGE
        WHERE NBR_CODE <= OGTIC_OGTI
        AND NBR_CODE Like SUBSTR(OGTIC_OGTI,1,3) || '%'
        AND NBR_CODE = SUBSTR(OGTIC_OGTI,1,LENGTH(NBR_CODE))
        AND ROWNUM <= 1)
    WHERE OGTIC_ETID = 'SUBMIT'
    AND OGTIC_ESID = 'R'
    AND OGTIC_SEPID = TO_CHAR(ADD_MONTHS(sysdate,-1),'YYYYMM')
    AND OGTIC_OGTI IS NOT NULL
    ;


    ErrorCode := 0;
    ReturnStatus := PKG_COMMON.RETURN_STATUS_OK;                                --  050SO --  040SO

    Return;

/*
Exception
When Others then
   ErrorCode := SQLCODE;
   ErrorMsg  := SQLERRM;
   ReturnStatus := 0;
   RecordsAffected := 0;
*/

END SP_CONS_OGTI;

procedure SP_CONS_DGTI
(
   p_PAC_ID         IN varchar2,        -- 'DGTI'     DGTI consolidation
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     OUT number )                                                --  039SO
IS

Begin

  ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;

  UPDATE DGTICONSOL SET DGTIC_ESID = 'D'
  WHERE  DGTIC_SEPID = TO_CHAR(TRUNC(ADD_MONTHS(sysdate,-1),'MONTH'),'YYYYMM')
  AND DGTIC_ETID = 'DELIVERY'
  AND DGTIC_ESID = 'R'
  ;

  INSERT INTO DGTICONSOL(
    DGTIC_ID,
    DGTIC_ETID,
    DGTIC_ESID,
    DGTIC_SEPID,
    DGTIC_DGTI,
    DGTIC_DATE,
    DGTIC_FROMDATE,
    DGTIC_TODATE,
    DGTIC_STATUS,
    DGTIC_CONID,
    DGTIC_CONSOLIDATION,
    DGTIC_PREPAID,
    DGTIC_VSMSCID,
    DGTIC_COUNT)
  SELECT  /*+ NO_INDEX(BDETAIL2) */
    GenerateUniqueKey('G'),
    'DELIVERY',
    'R',
    SEP_ID,
    BD_DGTI,                                                   --  026SO
    SYSDATE,
    MIN(BD_DATETIME),
    MAX(BD_DATETIME),
    BD_STATUS,
    BD_CONID,
    BD_CONSOLIDATION,
    BD_PREPAID,
    BD_VSMSCID,
    COUNT(BDETAIL2.ROWID)
  FROM BDETAIL2 , SETPERIOD
  WHERE BD_DATETIME >= TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
    AND BD_DATETIME < TRUNC(sysdate,'MONTH')
    AND SEP_DATE1 = TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
    AND BD_MAPSID = 'R'
  GROUP BY SEP_ID, BD_DGTI, BD_STATUS, BD_CONID, BD_CONSOLIDATION, BD_PREPAID,BD_VSMSCID
  ;
  RecordsAffected := SQL%ROWCOUNT ;

  UPDATE DGTICONSOL SET DGTIC_OPKEY = (
    SELECT NBR_CONOPKEY
    FROM NUMBERRANGE
    WHERE NBR_CODE <= DGTIC_DGTI
    AND NBR_CODE Like SUBSTR(DGTIC_DGTI,1,3) || '%'
    AND NBR_CODE = SUBSTR(DGTIC_DGTI,1,LENGTH(NBR_CODE))
    AND ROWNUM <= 1)
  WHERE DGTIC_ETID = 'DELIVERY'
  AND DGTIC_ESID = 'R'
  AND DGTIC_SEPID = TO_CHAR(ADD_MONTHS(sysdate,-1),'YYYYMM')
  AND DGTIC_DGTI IS NOT NULL
  ;

  ErrorCode := 0;
  ReturnStatus := PKG_COMMON.RETURN_STATUS_OK;

  Return;
/*
Exception
When Others then
   ErrorCode := SQLCODE;
   ErrorMsg  := SQLERRM;
   ReturnStatus := 0;
   RecordsAffected := 0;
*/

END SP_CONS_DGTI;


procedure SP_CONS_IWT
(
   p_PACT_ID        IN varchar2,        -- 'IWT'    IW Consolidation SC Outgoing
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     OUT number )                                                --  039SO
IS

   l_RecordsAffected    number;                                                 --  053SO

Begin

  ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;

  UPDATE ROCONSOLIDATION SET ROC_ESID = 'D'
  WHERE  ROC_SEPID = TO_CHAR(TRUNC(ADD_MONTHS(sysdate,-1),'MONTH'),'YYYYMM')
  AND ROC_ESID = 'R'
  ; --  069SO --  053SO

  INSERT INTO ROCONSOLIDATION (
    ROC_ID,
    ROC_ETID,
    ROC_ESID, ROC_DATE, ROC_SEPID,ROC_FROMDATE, ROC_TODATE,
    ROC_CONSOLIDATION, ROC_CONID, ROC_TOCID, ROC_STATUS, ROC_IW,
    ROC_COUNT, ROC_IOT_INTERNAL, ROC_IOT)                                       --  069SO --  046SO
  SELECT  /*+ NO_INDEX(BDETAIL2) */
    GenerateUniqueKey('G'),
    CASE
      WHEN BD_CDRTID IS NULL THEN 'SMS-GEN'
      WHEN INSTR(BD_CDRTID,'-') > 0 THEN BD_CDRTID
      WHEN BD_CDRTID LIKE '10%' THEN 'SMS-MO'
    ELSE
      'SMS-AO'
    END,
    'R', SYSDATE, SEP_ID, MIN(BD_DATETIME), MAX(BD_DATETIME),
    BD_CONSOLIDATION, BD_CONID, BD_TOCID, BD_STATUS, BD_IW,
    COUNT(*), SUM(BD_IOT_INTERNAL), SUM(BD_IOT)                                 --  069SO --  046SO
  FROM BDETAIL2 , SETPERIOD
  WHERE BD_DATETIME >= TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
    AND BD_DATETIME < TRUNC(ADD_MONTHS(sysdate,-0),'MONTH')
    AND SEP_DATE1 = TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
    AND BD_MAPSID = 'R'
    -- AND BD_NPI_B = '1'
    -- AND BD_PID_B = '0'
    -- AND BD_GENERATED = 0                                                     --  056SO
    -- AND BD_CDRTID <> 'SMS-HR'                                                --  069SO --  058SO
    -- AND BD_CDRTID <> 'SMS-HRON'                                              --  069SO
  GROUP BY
    SEP_ID,
    SEP_DATE1,
    SEP_DATE2,
    CASE
      WHEN BD_CDRTID IS NULL THEN 'SMS-GEN'
      WHEN INSTR(BD_CDRTID,'-') > 0 THEN BD_CDRTID
      WHEN BD_CDRTID LIKE '10%' THEN 'SMS-MO'
    ELSE
      'SMS-AO'
    END,
    BD_CONSOLIDATION,
    BD_CONID,
    BD_TOCID,
    BD_STATUS,
    BD_IW
  ;
  l_RecordsAffected := SQL%ROWCOUNT;                                            --  053SO

  INSERT INTO ROCONSOLIDATION (
    ROC_ID,
    ROC_ETID,
    ROC_ESID, ROC_DATE, ROC_SEPID, ROC_FROMDATE, ROC_TODATE,
    ROC_CONSOLIDATION, ROC_CONID, ROC_TOCID, ROC_STATUS, ROC_IW,
    ROC_COUNT, ROC_IOT_INTERNAL, ROC_IOT)
  SELECT  /*+ NO_INDEX(BDETAIL7) */
    GenerateUniqueKey('G'),
    'SMSC-M2M', 'R',
    SYSDATE, SEP_ID, MIN(BD_DATETIME), MAX(BD_DATETIME),
    BD_SHORTID, BD_CONID, BD_TOCID, BD_STATUS, BD_IW,
    COUNT(*), SUM(BD_IOT_INTERNAL), SUM(BD_IOT)
  FROM BDETAIL7 , SETPERIOD
  WHERE BD_DATETIME >= TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
    AND BD_DATETIME < TRUNC(ADD_MONTHS(sysdate,-0),'MONTH')
    AND SEP_DATE1 = TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
    AND BD_MAPSID = 'R'
    AND BD_MSGTYPE = 'M'
    AND BD_SINKTYPE = '2'
    AND NVL(BD_IW_DIR,'O') <> 'I'                                               --  056SO
  GROUP BY SEP_ID, SEP_DATE1, SEP_DATE2, BD_SHORTID, BD_CONID, BD_TOCID, BD_STATUS, BD_IW
  ;
  RecordsAffected := l_RecordsAffected + SQL%ROWCOUNT ;
  ErrorCode := 0;
  ReturnStatus := PKG_COMMON.RETURN_STATUS_OK;

  Return;

END SP_CONS_IWT;


procedure SP_CONS_PURGELAC
(
   p_PACT_ID        IN varchar2,        -- 'PURGELAC'   Purge LA Contract (de-activate)
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     OUT number )                                                --  039SO
IS

Begin

  UPDATE CONTRACT SET CON_ESID='I'
  WHERE CON_ESID = 'A'
  AND CON_ETID = 'LAC'
  AND CON_DATEEND <= TRUNC(SYSDATE,'MONTH')
  AND EXISTS (SELECT BOH_ID FROM BOHEADER
              WHERE BOH_DATETIME > TRUNC(sysdate,'MONTH')
              AND BOH_PACKID IN ('TR')
              AND BOH_ESID = 'OK')
  AND EXISTS (SELECT BOH_ID FROM BOHEADER
              WHERE BOH_DATETIME > TRUNC(sysdate,'MONTH')
              AND BOH_PACKID IN ('LATMCC_SMS')
              AND BOH_ESID = 'OK')
  ; -- Transport cost calculation and Minimum Charge Correction must be over before we can purge

  RecordsAffected := SQL%ROWCOUNT ;
  ErrorCode := 0;
  ReturnStatus := 1;
  Return;

/*
Exception
When Others then
   ErrorCode := SQLCODE;
   ErrorMsg  := SQLERRM;
   ReturnStatus := 0;
   RecordsAffected := 0;
*/

END SP_CONS_PURGELAC;



procedure SP_CONS_LAA_MFGR
(
   p_PACT_ID        IN varchar2,        -- 'LAT_MFGR'   SMS-LA monthly UFIH Tickets GlobalReply
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     OUT number )                                                --  039SO
IS  --  012SO
-- do SMS Global Reply settlement for last month
-- clear all MFLID charges
-- clear all MFGR  charges
-- insert one MFLID charge per LongID range (individual charge)                 --  068SO
-- insert one MFGR charge per ShortID if one or more LongId is registered for it

    CURSOR cLongId  IS
    SELECT
        LONGID_MIN,
        LONGID_MAX,
        LONGID_CNT,
        LONG_SHORTID,
        PRICE,
        MAX_CONID CON_ID,
        PSCALL CON_PSCALL,
        (SELECT C1.CON_TARID FROM CONTRACT C1 WHERE C1.CON_ID = MAX_CONID) CON_TARID
    FROM
        (SELECT
            MIN(LONGID) LONGID_MIN,
            MAX(LONGID) LONGID_MAX,
            COUNT(DISTINCT LONGID) LONGID_CNT,
            LONG_SHORTID,
            PRICE,
            MAX(CONID) MAX_CONID,
            PSCALL
         FROM
            (SELECT
                LONG_ID LONGID,
                LONG_SHORTID,
                MAX(DECODE(C0.CON_TARID,'S',0.0,'P',0.0,'T',0.0,'X',0.0,'V',0.0,LONG_PRICE)) PRICE,
                C0.CON_ID CONID,
                C0.CON_PSCALL PSCALL
             FROM LONGID, CONTRACT C0
             WHERE
                LONG_SHORTID = C0.CON_CONSOL
                AND LONG_ESID = 'M'
                AND LONG_DATESTART < TRUNC(sysdate, 'MONTH')
                AND NVL(LONG_DATEEND, sysdate) > add_months(TRUNC(sysdate, 'MONTH'),- 1)
                AND C0.CON_ESID IN ('A', 'I')
                AND C0.CON_ETID = 'LAC'
                AND C0.CON_DATESTART < TRUNC(sysdate, 'MONTH')
                AND NVL(C0.CON_DATEEND, sysdate) > add_months(TRUNC(sysdate, 'MONTH'), - 1)
             GROUP BY C0.CON_PSCALL, LONG_SHORTID, LONG_ID, C0.CON_ID
            )
         GROUP BY LONG_SHORTID, PRICE, PSCALL
        )
    ORDER BY 4 ASC, 5 DESC, PSCALL DESC
    ; --  072SO --  067SO
    cLongIdRow          cLongID%rowtype;

    CURSOR cShortId  IS
    SELECT
        LONG_SHORTID,
        PRICE,
        MAX_CONID CON_ID,
        PSCALL CON_PSCALL,
        (SELECT C1.CON_TARID FROM CONTRACT C1 WHERE C1.CON_ID = MAX_CONID) CON_TARID
    FROM
        (SELECT
            LONG_SHORTID,
            MAX(DECODE(CON_TARID,'S',0.0,'P',0.0,'T',0.0,'X',0.0,'V',0.0,CON_MFGR)) PRICE,
            MAX(CON_ID) MAX_CONID,
            C0.CON_PSCALL PSCALL
         FROM LONGID, CONTRACT C0
         WHERE
            LONG_SHORTID = C0.CON_CONSOL
            AND LONG_ESID <> 'F'
            AND LONG_ESID IN ('M')
            AND LONG_DATESTART < TRUNC(sysdate, 'MONTH')
            AND NVL(LONG_DATEEND, sysdate) > add_months(TRUNC(sysdate, 'MONTH'), - 1)
            AND C0.CON_ESID IN ('A', 'I')
            AND C0.CON_ETID = 'LAC'
            AND C0.CON_DATESTART < TRUNC(sysdate, 'MONTH')
            AND NVL(C0.CON_DATEEND, sysdate) > add_months(TRUNC(sysdate, 'MONTH'), - 1)
         GROUP BY LONG_SHORTID, C0.CON_PSCALL
        )
    ORDER BY 1 ASC
    ; --  072SO
    cShortIdRow          cShortID%rowtype;

    PERIOD_ALREADY_SETTLED     Exception;                                       --  017SO

    l_order_pattern     VARCHAR2(10);
    l_period_id         VARCHAR2(10);
    l_last_short_id     VARCHAR2(10);
    l_settlement_date   DATE;
    l_order             VARCHAR2(20);
    l_comment           SETDETAIL.SED_COMMENT%type;

    x_period_id         varchar2(6);
    x_SET_ID            varchar2(10);
    x_SED_ID            varchar2(10);
    x_SED_POS           number;
    x_ErrorCode         number;
    x_ErrorMsg          varchar2(2000);
    x_ReturnStatus      number;
    x_CdrCount          number;

BEGIN

    l_order_pattern := to_char(add_months(sysdate,-1),'YYYY-MM') || '%';        -- period order prefix
    l_period_id := to_char(add_months(sysdate,-1),'YYYYMM');                    -- period code
    l_settlement_date := trunc(sysdate,'MONTH')-1;                              -- last day of period

    RecordsAffected := 0 ;
    ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;

    SELECT COUNT(*) into x_CdrCount
    FROM SETDETAIL
    WHERE SED_ORDER LIKE l_order_pattern
    AND SED_ETID IN ('MFGRA','MFLIDA','MFGR','MFLID')                           --  019SO --  017SO
    AND SED_ESID IN ('V')                                                       --  017SO
    ;

    if x_CdrCount > 0 then
        RAISE PERIOD_ALREADY_SETTLED;                                           --  017SO
    end if;

    SELECT COUNT(*) into x_CdrCount
    FROM SETDETAIL
    WHERE SED_ORDER LIKE l_order_pattern
    AND SED_ETID IN ('MFGR','MFLID')                                            --  019SO
    AND SED_ESID IN ('A')                                                       --  019SO
    ;

    if x_CdrCount > 0 then
        RAISE PERIOD_ALREADY_SETTLED;                                           --  017SO
    end if;

    DELETE FROM SETDETAIL
    WHERE SED_ORDER LIKE l_order_pattern
    AND SED_ETID IN ('MFGRA','MFLIDA','MFGR','MFLID')                           --  017SO
    AND SED_ESID IN ('A')                                                       --  017SO
    ;

    l_comment := 'SMS LongID monthly lease fee';
    for cLongIdRow in cLongId loop
        l_order := PKG_BDETAIL_SETTLEMENT.NextAvailableOrder(
                        cLongIdRow.CON_PSCALL,
                        l_settlement_date
                    );                                                          --  067SO
        x_ReturnStatus := 1;
        PKG_BDETAIL_SETTLEMENT.SP_ADD_SETDETAIL_BY_DATE(
           l_order,                 -- p_Date           IN varchar2,
           cLongIdRow.CON_ID,       -- p_SET_CONID      IN varchar2,
           'SLA',                   -- p_SET_ETID       IN varchar2,
           0,                       -- p_SET_DEMO       IN number,
           'CHF',                   -- p_SET_CURRENCY   IN varchar2,
           NULL,                    -- p_SET_COMMENT    IN varchar2,
           'MFLIDA',                -- p_SED_ETID       IN varchar2,            --  017SO
           cLongIdRow.PRICE,        -- p_SED_PRICE      IN float,
           cLongIdRow.LONGID_CNT,   -- p_SED_QUANTITY   IN float,
           0.0,                     -- p_SED_DISCOUNT   IN float,
           'NA',                    -- p_SED_VATID      IN varchar2,
           0.0,                     -- p_SED_VATRATE    IN float,
           'ID' || cLongIdRow.LONG_SHORTID || '/MFLID' || cLongIdRow.LONGID_CNT,-- p_SED_DESC --  067SO
           l_order,                 -- p_SED_ORDER      IN varchar2,
           1,                       -- p_SED_VISIBLE    IN number,
           l_comment,               -- p_SED_COMMENT    IN varchar2,
           0,                       -- p_SED_COUNT1     IN number,
           0,                       -- p_SED_COUNT2     IN number,
           cLongIdRow.CON_PSCALL,   -- p_SED_CHARGE     IN varchar2,
           p_BOH_ID,                -- p_SED_BOHID      IN varchar2,
           NULL,                    -- p_SED_PMVID      IN varchar2,
           cLongIdRow.CON_TARID,    -- p_SED_TARID      IN varchar2,
           'A',                     -- p_SED_ESID       IN varchar2,            --  017SO
           NULL,                    -- p_SED_INT        IN varchar2,
           'U',                     -- p_SED_PREPAID    IN varchar2,
           0.00,                    -- p_SED_AMOUNTCU   IN float,               --  018SO
           0.00,                    -- p_SED_RETSHAREPV IN float,               --  018SO
           0.00,                    -- p_SED_RETSHAREMO IN float,               --  018SO
           to_char(cLongIdRow.LONGID_MIN), -- p_SED_LONGID_1     IN varchar2,   --  067SO
           to_char(cLongIdRow.LONGID_MAX), -- p_SED_LONGID_2     IN varchar2,   --  067SO
           x_period_id,             -- p_SEP_ID         OUT varchar2,
           x_SET_ID,                -- p_SET_ID         OUT varchar2,
           x_SED_ID,                -- p_SED_ID         OUT varchar2,
           x_SED_POS,               -- p_SED_POS        OUT number,
           x_ErrorCode,             -- ErrorCode        OUT number,
           x_ErrorMsg,              -- ErrorMsg         OUT varchar2,
           x_ReturnStatus           -- ReturnStatus     IN OUT number
        );
        RecordsAffected := RecordsAffected + 1 ;
    end loop;

    l_last_short_id := 'none';
    l_comment := 'SMS Global Reply monthly fee';
    for cShortIdRow in cShortId loop
        if cShortIdRow.LONG_SHORTID <> l_last_short_id then

            l_order := PKG_BDETAIL_SETTLEMENT.NextAvailableOrder(
                            cShortIdRow.CON_PSCALL,
                            l_settlement_date
                        );

            x_ReturnStatus := 1;
            PKG_BDETAIL_SETTLEMENT.SP_ADD_SETDETAIL_BY_DATE(
               l_order,                 -- p_Date           IN varchar2,
               cShortIdRow.CON_ID,      -- p_SET_CONID      IN varchar2,
               'SLA',                   -- p_SET_ETID       IN varchar2,
               0,                       -- p_SET_DEMO       IN number,
               'CHF',                   -- p_SET_CURRENCY   IN varchar2,
               NULL,                    -- p_SET_COMMENT    IN varchar2,
               'MFGRA',                 -- p_SED_ETID       IN varchar2,        --  017SO
               cShortIdRow.PRICE,       -- p_SED_PRICE      IN float,
               1,                       -- p_SED_QUANTITY   IN float,
               0.0,                     -- p_SED_DISCOUNT   IN float,
               'NA',                    -- p_SED_VATID      IN varchar2,
               0.0,                     -- p_SED_VATRATE    IN float,
               'ID' || cShortIdRow.LONG_SHORTID || '/MFGR', -- p_SED_DESC       IN varchar2,  --  020SO --  017SO --  015SO
               l_order,                 -- p_SED_ORDER      IN varchar2,
               1,                       -- p_SED_VISIBLE    IN number,
               l_comment,               -- p_SED_COMMENT    IN varchar2,
               0,                       -- p_SED_COUNT1     IN number,
               0,                       -- p_SED_COUNT2     IN number,
               cShortIdRow.CON_PSCALL,  -- p_SED_CHARGE     IN varchar2,
               p_BOH_ID,                -- p_SED_BOHID      IN varchar2,
               NULL,                    -- p_SED_PMVID      IN varchar2,
               cShortIdRow.CON_TARID,   -- p_SED_TARID      IN varchar2,
               'A',                     -- p_SED_ESID       IN varchar2,        --  017SO
               NULL,                    -- p_SED_INT        IN varchar2,
               'U',                     -- p_SED_PREPAID    IN varchar2,
               0.00,                    -- p_SED_AMOUNTCU   IN float,           --  018SO
               0.00,                    -- p_SED_RETSHAREPV IN float,           --  018SO
               0.00,                    -- p_SED_RETSHAREMO IN float,           --  018SO
               NULL,                    -- p_SED_LONGID_1   IN varchar2,        --  067SO
               NULL,                    -- p_SED_LONGID_2   IN varchar2,        --  067SO
               x_period_id,             -- p_SEP_ID         OUT varchar2,
               x_SET_ID,                -- p_SET_ID         OUT varchar2,
               x_SED_ID,                -- p_SED_ID         OUT varchar2,
               x_SED_POS,               -- p_SED_POS        OUT number,
               x_ErrorCode,             -- ErrorCode        OUT number,
               x_ErrorMsg,              -- ErrorMsg         OUT varchar2,
               x_ReturnStatus           -- ReturnStatus     IN OUT number
            );
            l_last_short_id := cShortIdRow.LONG_SHORTID;                        --  015SO
            RecordsAffected := RecordsAffected + 1 ;
        end if;
    end loop;

    UPDATE SETDETAIL SET
        SED_DESC = (SELECT 'ID' || CON_CONSOL || '/MO' || to_char(SED_COUNT2) || '/FN' FROM CONTRACT WHERE CON_ID IN (SELECT SET_CONID FROM SETTLING WHERE SET_ID = SED_SETID) )
    WHERE SED_ORDER LIKE l_order_pattern
    AND SED_ETID IN ('MOFNA')
    AND SED_ESID IN ('A','V')
    ;   --  021SO

    UPDATE SETDETAIL SET
        SED_DESC = (SELECT 'ID' || CON_CONSOL || '/MO' || to_char(SED_COUNT2) || '/IW' FROM CONTRACT WHERE CON_ID IN (SELECT SET_CONID FROM SETTLING WHERE SET_ID = SED_SETID) )
    WHERE SED_ORDER LIKE l_order_pattern
    AND SED_ETID IN ('MOIWSA')
    AND SED_ESID IN ('A','V')
    ;   --  022SO  --  021SO

  ErrorCode := 0;
  ReturnStatus := PKG_COMMON.RETURN_STATUS_OK;

  Return;

Exception
When PERIOD_ALREADY_SETTLED then
   ErrorCode := 0;
   ErrorMsg  := 'Cannot do SMS Global Reply monthly settlement twice for the same period.';
   ReturnStatus := 0;
   RecordsAffected := 0;
/*                                                                              --  039SO
When Others then
   ErrorCode := SQLCODE;
   ErrorMsg  := SQLERRM;
   ReturnStatus := 0;
   RecordsAffected := 0;
*/
END SP_CONS_LAA_MFGR;


procedure SP_CONS_LAPMCC_SMS
(
   p_PACT_ID        IN varchar2,    -- 'LAPMCC_SMS'     SMS-LA MCC Preparation
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     OUT number )                                                --  039SO
IS  -- 016SO

-- get a list of MMS LA contracts which can have a minimum charge
-- per pseudo call number, the contracts with the top overall min charge are choosen
-- more than one contract can be returned, if they have equal weighted minimum charge
-- this is taken care of in the processing of the result
Begin

    ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;                           --  040SO
    RecordsAffected := 0;                                                       --  040SO

    PKG_BDETAIL_SETTLEMENT.SP_LAPMCC(
       p_PACT_ID,           -- IN varchar2,
       p_BOH_ID,            -- IN varchar2,
       'SLA',               -- IN varchar2,   -- SLA or MLA                     --  051SOa
       RecordsAffected,     -- OUT number,
       ErrorCode,           -- OUT number,
       ErrorMsg,            -- OUT varchar2,
       ReturnStatus         -- IN OUT number
    );

END SP_CONS_LAPMCC_SMS;


Procedure SP_UPDATE_BOHEADER_IOTTOCA_2
(
  p_bohid         In      Varchar2,
  p_status        In      Varchar2,
  p_count         In      Number,
  p_MaxAge        In      Number,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  ReturnStatus    In Out  Number
)
Is
   x_datefc       Date;
   x_datelc       Date;
   x_reccount     Number;
   x_packid       Varchar2(10);
   x_fileseqmax   Number;
   x_nextseq      Number;
Begin
   If p_status = 'S' then /*--- conversion was successful ---- */
      Begin
            select /*+ INDEX(BDETAIL2 IDX_BD_BOHID22) */ min(BD_DATETIME) into x_datefc
            from BDETAIL2
            where bd_bohid2 = p_bohid
            and BD_DATETIME > sysdate-p_MaxAge and BD_DATETIME < sysdate + 3/24;

            select /*+ INDEX(BDETAIL2 IDX_BD_BOHID22) */ max(BD_DATETIME) into x_datelc
            from BDETAIL2
            where bd_bohid2 = p_bohid
            and BD_DATETIME > sysdate-p_MaxAge and BD_DATETIME < sysdate + 3/24;

            select /*+ INDEX(BDETAIL2 IDX_BD_BOHID22) */ count(*) into x_reccount
            from BDETAIL2
            where bd_bohid2 = p_bohid
            and BD_PACSID2 = 'D' and BD_DATETIME > sysdate-p_MaxAge and BD_DATETIME < sysdate + 3/24;

            Update Boheader set
              boh_DATEFC = x_datefc,
              boh_DATELC = x_datelc,
              boh_RecCount = x_reccount,
              boh_end = sysdate,
              boh_esid = 'OK',
              boh_filename = REPLACE(boh_filename,'Temp-','')
            where boh_id = p_bohid;

            select boh_packid into x_packid
                      from boheader where boh_id = p_bohid;
            select pac_fileseqmax, pac_nextseq into x_fileseqmax, x_nextseq
                      from packing where pac_id  = x_packid;
            If x_fileseqmax = x_nextseq then /*** need to recycle ***/
                 x_nextseq := 1;
            else
                 x_nextseq := x_nextseq + 1;
            end if;
            update packing set
              pac_nextseq = x_nextseq
            where pac_id = x_packid;
      End;
   Else /*---- file error encountered ----*/
      Begin
        Update Boheader set
          boh_end = sysdate,
          boh_esid = 'PAE'
        where boh_id = p_bohid;

        Update /*+ INDEX(BDETAIL2 IDX_BD_BOHID22) */ BDETAIL2  set
          BD_PACSID2 = 'E',
          bd_borecno2 = Null,
          bd_bohid2 = Null
        where bd_bohid2 = p_bohid
        and BD_DATETIME > sysdate-p_MaxAge and BD_DATETIME < sysdate + 3/24;
      End;
   End if;
   Returnstatus := 1;
   -- Commit;
   Return;
Exception
When Others then
   ErrorCode := SqlCode;
   ErrorMsg  := SqlErrm;
   ReturnStatus := 0;
End SP_UPDATE_BOHEADER_IOTTOCA_2;

Procedure SP_LAA_SMS_ACCU
( BatchSize       In      Integer,
  p_BD_BOHID      In      Varchar2,
  p_MaxAge        In      Number,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  RecordsAffected Out     Number
)
Is  --  028SO

  Cursor C1 Is                                                                  --  042SO
    SELECT /*+ INDEX(BDETAIL1 IDX_BD_BOHID31) */
        TRUNC(BD_DATETIME)                                                      as PosDATETIME,
        CON_PSCALL                                                              as PosMSISDN,
        BD_CONID                                                                as PosConId,
        BD_CONSOLIDATION                                                        as PosCONSOLIDATION,
        CON_TARID                                                               as PosTarId,
        NVL(CON_HDGROUP,0)                                                      as PosHdGroup,
        DECODE(BD_CDRTID,'SMS-HR','1','SMS-HRON','0',NVL(BD_INT,'0'))           as PosInternational,
        DECODE(BD_CDRTID,'SMS-HR','MOFNA','PAGER-EXT','PAGA','CDRA')            as PosSetDetailType,--  070SO --  059SO
        'U'                                                                     as PosPrepaid,      --  059SO
        DECODE(BD_CDRTID,'SMS-HR',BD_MSISDN_B,NULL)                             as PosLongId,
        Count(*)                                                                as CdrCount,
        SUM(DECODE(BD_ORIG_ESME_ID,BD_CONSOLIDATION,0,1))                       as CdrCountMO,      --  065SO
        SUM(DECODE(BD_ORIG_ESME_ID,BD_CONSOLIDATION,1,0))                       as CdrCountMT,      --  065SO
        SUM(NVL(BD_AMOUNTTR,0.0))                                               as Price,           --  061SO
        SUM(NVL(BD_AMOUNTCU,0.0))                                               as AmountCu,
        0.00                                                                    as RevenueShareLa,  --  061SO
        0.00                                                                    as RevenueShareOp   --  061SO
    FROM BDETAIL1, CONTRACT
    WHERE BD_CONID = CON_ID
    AND BD_BOHID3 = p_BD_BOHID                                                  --  042SO
    AND BD_DATETIME > SYSDATE - p_MaxAge - 3/24                                 --  042SO
    AND BD_DATETIME < SYSDATE + 3/24
    GROUP BY
        TRUNC(BD_DATETIME),                                                     -- PosDATETIME  --  029SO
        CON_PSCALL,                                                             -- PosMSISDN
        BD_CONID,                                                               -- PosConId
        BD_CONSOLIDATION,                                                       -- PosCONSOLIDATION
        CON_TARID,                                                              -- PosTarId
        NVL(CON_HDGROUP,0),                                                     -- PosHdGroup
        DECODE(BD_CDRTID,'SMS-HR','1','SMS-HRON','0',NVL(BD_INT,'0')),          -- PosInternational --  063SO
        DECODE(BD_CDRTID,'SMS-HR','MOFNA','PAGER-EXT','PAGA','CDRA'),           -- PosSetDetailType --  070SO --  059SO
        DECODE(BD_CDRTID,'SMS-HR',BD_MSISDN_B,NULL)                             -- PosLongId
    ORDER by 1,2,3,4,5,6,7,8,9,10
    ;

    l_ReturnStatus      NUMBER(1);

Begin

    RecordsAffected := 0;

    For C1_Rec in C1 Loop                                                       --  042SO

        PKG_BDETAIL_SETTLEMENT.SP_ADD_SETDETAIL(
                       'SLA',                                                   -- p_SET_ETID       IN varchar2,
                       C1_Rec.PosSetDetailType,                                 -- p_SED_ETID       IN varchar2,
                       C1_Rec.PosMSISDN,                                        -- p_SED_CHARGE     IN varchar2,
                       p_BD_BOHID,                                              -- p_SED_BOHID      IN varchar2,
                       C1_Rec.PosDATETIME,                                      -- p_Date           IN DATE,
                       C1_Rec.PosConId,                                         -- p_SET_CONID      IN varchar2,
                       C1_Rec.PosTarId,                                         -- p_SED_TARID      IN varchar2,
                       C1_Rec.PosInternational,                                 -- p_SED_INT        IN varchar2,
                       C1_Rec.PosPrepaid,                                       -- p_SED_PREPAID    IN varchar2,
                       C1_Rec.Price - C1_Rec.RevenueShareLa,                    -- p_SED_PRICE      IN float,
                       C1_Rec.AmountCu,                                         -- p_SED_AMOUNTCU   IN float,
                       C1_Rec.RevenueShareLa,                                   -- p_SED_RETSHAREPV IN float,
                       C1_Rec.RevenueShareOp,                                   -- p_SED_RETSHAREMO IN float,
                       C1_Rec.PosLongId,                                        -- p_SED_LONGID     IN varchar2,
                       C1_Rec.CdrCountMT,                                       -- p_SED_COUNT1     IN number,
                       C1_Rec.CdrCountMO,                                       -- p_SED_COUNT2     IN number,
                       'accumulating',                                          -- p_SED_DESC       IN varchar2,
                       0,               -- C1_Rec.PosGart,                      -- p_GART           IN varchar2,
                       ErrorCode,                                               -- ErrorCode        OUT number,
                       ErrorMsg,                                                -- ErrorMsg         OUT varchar2,
                       l_ReturnStatus                                           -- ReturnStatus     IN OUT number
        );

        if l_ReturnStatus = 1 then
            RecordsAffected :=   RecordsAffected + C1_Rec.CdrCount;             --  042SO
        end if;

    End Loop;

    Return;
/*  --  032SO
Exception
  When Others Then
      ErrorCode := SqlCode;
      ErrorMsg  := SqlErrM;
      RecordsAffected := 0;
*/

End SP_LAA_SMS_ACCU;

procedure SP_TRY_LAA_SMS
(
  p_PAC_ID         IN       varchar2,       -- 'LAA_SMS'    SMS-LA Accumulation
  p_BOH_ID         IN OUT   varchar2,
  RecordsAffected  OUT      number,
  ErrorCode        OUT      number,
  ErrorMsg         OUT      varchar2,
  ReturnStatus     OUT      number
)
Is  --  028SO        Accumulate SMS-LA submit CDRs as a first step in SMS-LA settlement

    CURSOR cCheckCandidate(max_age INTEGER) IS
    SELECT /*+ INDEX(BDETAIL1 IDX_BD_PACSID31) */ 'dummy'
    FROM BDETAIL1
    WHERE BD_PACSID3 = 'S'
    and BD_MAPSID = 'R'
    and BD_DATETIME > SYSDATE - max_age
    and BD_DATETIME < SYSDATE
    and ROWNUM <= 1
    ; --  055SO

    l_max_age      INTEGER;
    l_batch_count  INTEGER;
    l_marked_count INTEGER;
    l_dummy        VARCHAR2(10);

BEGIN

    RecordsAffected := 0;
    ReturnStatus := PKG_COMMON.RETURN_STATUS_OK;        -- assume this for now

    l_max_age := to_number(PKG_COMMON_PACKING.getPackingParameter(p_PAC_ID,'MAXAGE'));
    l_batch_count := to_number(PKG_COMMON_PACKING.getPackingParameter(p_PAC_ID,'BATCHCOUNT'));

    l_dummy := NULL;
    OPEN cCheckCandidate(l_max_age);
    FETCH cCheckCandidate into l_dummy;
    CLOSE cCheckCandidate;

    if l_dummy is not NULL then

        PKG_COMMON_PACKING.INSERT_BOHEADER_SPTRY(p_PAC_ID, p_BOH_ID);

        -- mark rows for processing
        update /*+ INDEX(BDETAIL1 IDX_BD_PACSID31) */ BDETAIL1 set
            BD_BOHID3 = p_BOH_ID,
            BD_PACSID3 = 'P'
        where BD_PACSID3 = 'S'
        and BD_MAPSID = 'R'
        and BD_DATETIME > SYSDATE - l_max_age
        and BD_DATETIME < SYSDATE
        and ROWNUM <= l_batch_count
        ;
        l_marked_count := Sql%rowcount;

        if l_marked_count > 0 then

            SP_LAA_SMS_ACCU(
              l_marked_count,
              p_BOH_ID,
              l_max_age,
              ErrorCode,
              ErrorMsg,
              RecordsAffected
            );

            if RecordsAffected = l_marked_count then
                -- mark rows as processed
                update BDETAIL1 set
                    BD_PACSID3 = 'D'
                where   BD_BOHID3=p_BOH_ID
                and     BD_PACSID3 = 'P'
                and     BD_DATETIME > SYSDATE - l_max_age - 1/24                --  043SO --  041SO
                ;
                l_marked_count := Sql%rowcount;

                UPDATE BOHEADER set (
                    BOH_DATEFC, BOH_DATELC
                ) = (
                    SELECT MIN(BD_DATETIME), MAX(BD_DATETIME)
                    FROM BDETAIL1
                    WHERE BD_BOHID3=p_BOH_ID
                    AND   BD_DATETIME > SYSDATE - l_max_age - 1/24              --  043SO --  041SO
                )
                WHERE boh_id = p_BOH_ID;

            else
                ROLLBACK;
                PKG_COMMON.INSERT_WARNING(
                     'SMS-LA SETTLEMENT',
                     'PKG_BDETAIL_SETTLEMENT.SP_TRY_LAA_SMS',
                     'PROCESSING ERROR',
                     'Mismatch in marked/processed SMS CDR counts (' || l_marked_count || '/' || RecordsAffected || ')',
                     NULL,
                     p_BOH_ID
                );
                ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
            end if;
        end if;
    end if;

exception

    when PKG_COMMON.EXCP_INCONVENIENT_TIME then
        ErrorCode := PKG_COMMON.ENO_INCONVENIENT_TIME;
        ErrorMsg := PKG_COMMON.EDESC_INCONVENIENT_TIME;
        ReturnStatus := PKG_COMMON.RETURN_STATUS_SUSPENDED;
        ROLLBACK;
/*  --  032SO
    when PKG_COMMON_PACKING.EXCP_STATISTICS_FAILURE then
        ErrorCode := PKG_COMMON_PACKING.ENO_STATISTICS_FAILURE;
        ErrorMsg := PKG_COMMON_PACKING.EDESC_STATISTICS_FAILURE;
        ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
        ROLLBACK;
    when PKG_COMMON_PACKING.EXCP_WORKFLOW_ABORT then
        ErrorCode := PKG_COMMON_PACKING.ENO_WORKFLOW_ABORT;
        ErrorMsg := PKG_COMMON_PACKING.EDESC_WORKFLOW_ABORT;
        ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
        ROLLBACK;
    when Others then
        ErrorCode := SqlCode;
        ErrorMsg  := SqlErrM;
        ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
        RecordsAffected := 0;
        ROLLBACK;
*/

END SP_TRY_LAA_SMS;



procedure SP_CONS_LAT_SMS
(
  p_PAC_ID         IN       varchar2,       -- 'LAT_SMS'    SMS-LA daily UFIH Ticket
  p_BOH_ID         IN       varchar2,
  RecordsAffected  OUT      number,
  ErrorCode        OUT      number,
  ErrorMsg         OUT      varchar2,
  ReturnStatus     OUT      number
)
Is  --  031SO Consolidate SMS-LA daily UFIH tickets from accumulated settlement details

    l_min_age      INTEGER;
    l_max_age      INTEGER;
    l_gart         INTEGER;
    l_marked_count INTEGER;

BEGIN

    ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;

    RecordsAffected := 0;

    l_min_age := to_number(PKG_COMMON_PACKING.getPackingParameter(p_PAC_ID,'MINAGE'));
    l_max_age := to_number(PKG_COMMON_PACKING.getPackingParameter(p_PAC_ID,'MAXAGE'));
    l_gart := to_number(PKG_COMMON_PACKING.getPackingParameter(p_PAC_ID,'GART'));

    -- mark rows for processing
    UPDATE SETDETAIL SET
        SED_ESID = 'P',
        SED_GOHID = p_BOH_ID
    Where SED_ESID = 'A'
    AND SED_ORDER > to_char(sysdate-l_max_age,'YYYY-MM-DD')
    AND SED_ORDER < to_char(sysdate-l_min_age,'YYYY-MM-DD')
    AND SED_ETID IN ('CDRA','PAGA', 'MOFNA')                                    --  071SO --  060SO --  034SO remove 'MFGRA','MFLIDA'
    AND SED_SETID IN (SELECT SET_ID FROM SETTLING WHERE SET_ETID IN ('SLA'))
    ;
    l_marked_count := Sql%rowcount;

    if l_marked_count = 0 then
        ReturnStatus := PKG_COMMON.RETURN_STATUS_OK;                            --  040SO
    else  -- l_marked_count <> 0
        PKG_BDETAIL_SETTLEMENT.SP_LAT_CDR(
            p_BOH_ID,                                                           -- p_BD_BOHID      In      Varchar2,
            'SLA',                                                              -- p_SET_ETID      IN      varchar2,
            l_gart,                                                             -- p_Gart          In      Number,
            l_min_age,                                                          -- p_MinAge        In      Number,
            l_max_age,                                                          -- p_MaxAge        In      Number,
            ErrorCode,                                                          -- ErrorCode       Out     Number,
            ErrorMsg,                                                           -- ErrorMsg        Out     Varchar2,
            RecordsAffected                                                     -- RecordsAffected Out     Number
        );

        if RecordsAffected = l_marked_count then
            -- set marked rows to valid
            update SETDETAIL set
                SED_ESID = 'V'
            where SED_ESID = 'P'
            AND SED_GOHID = p_BOH_ID
            AND SED_ORDER > to_char(sysdate-l_max_age,'YYYY-MM-DD')
            AND SED_ORDER < to_char(sysdate-l_min_age,'YYYY-MM-DD')

            ;
            l_marked_count := Sql%rowcount;

            UPDATE BOHEADER set (
                BOH_DATEFC, BOH_DATELC
            ) = (
                SELECT MIN(to_date(SED_ORDER,'YYYY-MM-DD HH24:MI:SS')), MAX(to_date(SED_ORDER,'YYYY-MM-DD HH24:MI:SS'))
                FROM SETDETAIL
                WHERE SED_ESID = 'V'
                AND SED_GOHID = p_BOH_ID
                AND SED_ORDER > to_char(sysdate-l_max_age,'YYYY-MM-DD')
                AND SED_ORDER < to_char(sysdate-l_min_age,'YYYY-MM-DD')
            )
            WHERE boh_id = p_BOH_ID;

            ReturnStatus := PKG_COMMON.RETURN_STATUS_OK;

        else  -- RecordsAffected <> l_marked_count
            ROLLBACK;
            ErrorMsg := 'Mismatch in marked/processed SMS CDR counts (' || l_marked_count || '/' || RecordsAffected || ')'; --  044SO
            PKG_COMMON.INSERT_WARNING(
                 'SMS-LA SETTLEMENT',
                 'PKG_BDETAIL_SETTLEMENT.SP_CONS_LAT_SMS',
                 'PROCESSING ERROR',
                 ErrorMsg,                                                      --  044SO
                 NULL,
                 p_BOH_ID
            );
        end if;  -- RecordsAffected = l_marked_count
    end if;  -- l_marked_count <> 0

END SP_CONS_LAT_SMS;


procedure SP_CONS_LAT_MFGR
(
  p_PAC_ID         IN       varchar2,       -- 'LAT_MFGR'   SMS-LA monthly UFIH Tickets GlobalReply
  p_BOH_ID         IN       varchar2,
  RecordsAffected  OUT      number,
  ErrorCode        OUT      number,
  ErrorMsg         OUT      varchar2,
  ReturnStatus     OUT      number
)
Is  --  034SO Consolidate SMS-Global reply monthly UFIH tickets from accumulated settlement details

    l_gart         INTEGER;
    l_marked_count INTEGER;

BEGIN

    ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
    RecordsAffected := 0;

    l_gart := to_number(PKG_COMMON_PACKING.getPackingParameter(p_PAC_ID,'GART'));

    -- mark rows for processing
    UPDATE SETDETAIL SET
        SED_ESID = 'P',
        SED_GOHID = p_BOH_ID
    Where SED_ESID = 'A'
    AND SED_ORDER > to_char(add_months(trunc(sysdate,'MONTH'),-1),'YYYY-MM-DD') --  034SO
    AND SED_ORDER < to_char(trunc(sysdate,'MONTH'),'YYYY-MM-DD')                --  034SO
    AND SED_ETID IN ('MFGRA','MFLIDA')                                          --  034SO
    AND SED_SETID IN (SELECT SET_ID FROM SETTLING WHERE SET_ETID IN ('SLA'))
    ;
    l_marked_count := Sql%rowcount;

    if l_marked_count = 0 then

            ReturnStatus := PKG_COMMON.RETURN_STATUS_OK;                        --  040SO

    else  -- l_marked_count <> 0

        PKG_BDETAIL_SETTLEMENT.SP_LAT_CDR(
            p_BOH_ID,                                                           -- p_BD_BOHID      In      Varchar2,
            'SLA',                                                              -- p_SET_ETID      IN      varchar2,
            l_gart,                                                             -- p_Gart          In      Number,
            0,                                                                  -- p_MinAge        In      Number,  --  034SO
            61,                                                                 -- p_MaxAge        In      Number,  --  034SO
            ErrorCode,                                                          -- ErrorCode       Out     Number,
            ErrorMsg,                                                           -- ErrorMsg        Out     Varchar2,
            RecordsAffected                                                     -- RecordsAffected Out     Number
        );

        if RecordsAffected = l_marked_count then
            -- set marked rows to valid
            update SETDETAIL set
                SED_ESID = 'V'
            where SED_ESID = 'P'
            AND SED_GOHID = p_BOH_ID
            AND SED_ORDER > to_char(add_months(trunc(sysdate,'MONTH'),-1),'YYYY-MM-DD') --  034SO
            AND SED_ORDER < to_char(trunc(sysdate,'MONTH'),'YYYY-MM-DD')                --  034SO

            ;
            l_marked_count := Sql%rowcount;

            UPDATE BOHEADER set (
                BOH_DATEFC, BOH_DATELC
            ) = (
                SELECT MIN(to_date(SED_ORDER,'YYYY-MM-DD HH24:MI:SS')), MAX(to_date(SED_ORDER,'YYYY-MM-DD HH24:MI:SS'))
                FROM SETDETAIL
                WHERE SED_ESID = 'V'
                AND SED_GOHID = p_BOH_ID
                AND SED_ORDER > to_char(add_months(trunc(sysdate,'MONTH'),-1),'YYYY-MM-DD') --  034SO
                AND SED_ORDER < to_char(trunc(sysdate,'MONTH'),'YYYY-MM-DD')                --  034SO
            )
            WHERE boh_id = p_BOH_ID;

            ReturnStatus := PKG_COMMON.RETURN_STATUS_OK;

        else  -- RecordsAffected <> l_marked_count
            ROLLBACK;
            ErrorMsg := 'Mismatch in marked/processed SMS CDR counts (' || l_marked_count || '/' || RecordsAffected || ')'; --  044SO
            PKG_COMMON.INSERT_WARNING(
                 'SMS-LA SETTLEMENT',
                 'PKG_BDETAIL_SETTLEMENT.SP_CONS_LAT_MFGR',
                 'PROCESSING ERROR',
                 ErrorMsg,
                 NULL,
                 p_BOH_ID
            );
        end if;  -- RecordsAffected = l_marked_count
    end if;  -- l_marked_count > 0

END SP_CONS_LAT_MFGR;


procedure SP_CONS_LAM_SMS
(
   p_PAC_ID         IN varchar2,        -- 'LATMCC_SMS'     SMS-LA MCC UFIH Ticket
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     OUT number )
IS  --  033SO

    l_gart         INTEGER;

Begin

    ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;                           --  040SO
    RecordsAffected := 0;                                                       --  040SO

    l_gart := to_number(PKG_COMMON_PACKING.getPackingParameter(p_PAC_ID,'GART'));

    PKG_BDETAIL_SETTLEMENT.SP_LAM_MCC(
        p_PAC_ID,                   -- IN varchar2,
        p_BOH_ID,                   -- IN varchar2,
        'SLA',        --p_SET_ETID  -- IN varchar2,   -- SLA or MLA
        l_gart,       --p_Gart      -- In Number,      --016SO
        RecordsAffected,            -- OUT number,
        ErrorCode,                  -- OUT number,
        ErrorMsg,                   -- OUT varchar2,
        ReturnStatus                -- OUT number
    );

END SP_CONS_LAM_SMS;


Procedure SP_LIA_SMS_ACCU
( BatchSize       In      Integer,
  p_BD_BOHID      In      Varchar2,
  p_MaxAge        In      Number,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  RecordsAffected Out     Number
)
Is  --  036SO

  Cursor C1 Is                                                                  --  042SO
    SELECT /*+ INDEX(BDETAIL2 IDX_BD_BOHID22) */
        TRUNC(BD_DATETIME)                                                      as PosDATETIME,
        CON_PSCALL                                                              as PosMSISDN,
        BD_CONID                                                                as PosConId,
        BD_CONSOLIDATION                                                        as PosCONSOLIDATION,
        CON_TARID                                                               as PosTarId,
        Count(*)                                                                as CdrCount,
        0                                                                       as CdrCountMO,
        SUM(DECODE(BD_IOT_INTERNAL,0.0,0,NULL,0,1))                             as CdrCountMT,  --  045SO -- count nonzero IOTs
        SUM(NVL(BD_IOT,0.00))                                                   as Price,  --  057SO --  047SO --  045SO -- IOT to LA for these CDRs
        0.0                                                                     as AmountCu,
        0.0                                                                     as RevenueShareLa,
        0.0                                                                     as RevenueShareOp
    FROM BDETAIL2, CONTRACT
    WHERE BD_CONID = CON_ID
    AND BD_BOHID2 = p_BD_BOHID                                                  --  042SO
    AND BD_DATETIME > SYSDATE - p_MaxAge - 3/24                                 --  042SO
    AND BD_DATETIME < SYSDATE + 3/24
    AND BD_NPI_B = '1'              -- Guard, CDR count will fail if not true for all CDRs
    AND BD_PID_B = '0'              -- Guard, CDR count will fail if not true for all CDRs
    GROUP BY
        TRUNC(BD_DATETIME),                                                     -- PosDATETIME  --  029SO
        CON_PSCALL,                                                             -- PosMSISDN
        BD_CONID,                                                               -- PosConId
        BD_CONSOLIDATION,                                                       -- PosCONSOLIDATION
        CON_TARID                                                               -- PosTarId
    ORDER by 1,2,3,4,5
    ;

    l_ReturnStatus      NUMBER(1);

Begin

    RecordsAffected := 0;                                                       --  040SO

    For C1_Rec in C1 Loop                                                       --  042SO

        PKG_BDETAIL_SETTLEMENT.SP_ADD_SETDETAIL(
                       'SLA',                                                   -- p_SET_ETID       IN varchar2,
                       'IOTLACA',            -- C1_Rec.PosSetDetailType,        -- p_SED_ETID       IN varchar2,
                       C1_Rec.PosMSISDN,                                        -- p_SED_CHARGE     IN varchar2,
                       p_BD_BOHID,                                              -- p_SED_BOHID      IN varchar2,
                       C1_Rec.PosDATETIME,                                      -- p_Date           IN DATE,
                       C1_Rec.PosConId,                                         -- p_SET_CONID      IN varchar2,
                       C1_Rec.PosTarId,                                         -- p_SED_TARID      IN varchar2,
                       NULL,                -- C1_Rec.PosInternational,         -- p_SED_INT        IN varchar2,
                       'U',                 -- C1_Rec.PosPrepaid,               -- p_SED_PREPAID    IN varchar2,
                       C1_Rec.Price,                                            -- p_SED_PRICE      IN float,       --  045SO
                       C1_Rec.AmountCu,                                         -- p_SED_AMOUNTCU   IN float,
                       C1_Rec.RevenueShareLa,                                   -- p_SED_RETSHAREPV IN float,
                       C1_Rec.RevenueShareOp,                                   -- p_SED_RETSHAREMO IN float,
                       NULL,                -- C1_Rec.PosLongId,                -- p_SED_LONGID     IN varchar2,
                       C1_Rec.CdrCountMT,                                       -- p_SED_COUNT1     IN number,
                       C1_Rec.CdrCountMO,                                       -- p_SED_COUNT2     IN number,
                       'accumulating',                                          -- p_SED_DESC       IN varchar2,
                       0,                   -- C1_Rec.PosGart,                  -- p_GART           IN varchar2,
                       ErrorCode,                                               -- ErrorCode        OUT number,
                       ErrorMsg,                                                -- ErrorMsg         OUT varchar2,
                       l_ReturnStatus                                           -- ReturnStatus     IN OUT number
        );
        if l_ReturnStatus = 1 then
            RecordsAffected :=   RecordsAffected + C1_Rec.CdrCount;             --  042SO
        end if;

    End Loop;

    Return;
/*  --  032SO
Exception
  When Others Then
      ErrorCode := SqlCode;
      ErrorMsg  := SqlErrM;
      RecordsAffected := 0;
*/

End SP_LIA_SMS_ACCU;


procedure SP_TRY_LIA_SMS
(
  p_PAC_ID         IN       varchar2,       -- 'LIA_SMS'    SMS-LA IW Accumulation
  p_BOH_ID         IN OUT   varchar2,
  RecordsAffected  OUT      number,
  ErrorCode        OUT      number,
  ErrorMsg         OUT      varchar2,
  ReturnStatus     OUT      number
)
Is  --  036SO        Accumulate SMS-LA IW outgoing CDRs as a first step in SMS-LA IW settlement

    CURSOR cCheckCandidate(max_age INTEGER) IS
    SELECT /*+ INDEX(BDETAIL2 IDX_BD_PACSID22) */ 'dummy'
    FROM BDETAIL2
    WHERE BD_PACSID2 = 'S'
    and BD_MAPSID = 'R'
    and BD_DATETIME > SYSDATE - max_age
    and BD_DATETIME < SYSDATE
    and ROWNUM <= 1
    ;

    l_max_age      INTEGER;
    l_batch_count  INTEGER;
    l_marked_count INTEGER;
    l_dummy        VARCHAR2(10);

BEGIN

    RecordsAffected := 0;
    ReturnStatus := PKG_COMMON.RETURN_STATUS_OK;        -- assume this for now

    l_max_age := to_number(PKG_COMMON_PACKING.getPackingParameter(p_PAC_ID,'MAXAGE'));
    l_batch_count := to_number(PKG_COMMON_PACKING.getPackingParameter(p_PAC_ID,'BATCHCOUNT'));

    l_dummy := NULL;
    OPEN cCheckCandidate(l_max_age);
    FETCH cCheckCandidate into l_dummy;
    CLOSE cCheckCandidate;

    if l_dummy is not NULL then

        PKG_COMMON_PACKING.INSERT_BOHEADER_SPTRY(p_PAC_ID, p_BOH_ID);

        -- mark rows for processing
        update /*+ INDEX(BDETAIL2 IDX_BD_PACSID22) */ BDETAIL2 set
            BD_BOHID2 = p_BOH_ID,
            BD_PACSID2 = 'P',
            BD_IOT = DECODE(BD_TARID,'P',0.0,'Q',0.0,'R',0.0,'S',0.0,'T',0.0,'X',0.0,'V',0.0,'i',0.0,
                        NVL(CONTRACT_IOT_CHF(BD_TOCID,'ORIG','SMS',BD_DATETIME),0.00)),  --  057SO --  051SO --  045SO
            BD_IOT_INTERNAL = NVL(CONTRACT_IOT_CHF(BD_TOCID,'ORIG','SMS',BD_DATETIME),0.00)        --  045SO
        where BD_PACSID2 = 'S'
        and BD_MAPSID = 'R'
        and BD_DATETIME > SYSDATE - l_max_age
        and BD_DATETIME < SYSDATE
        and ROWNUM <= l_batch_count
        ;

        l_marked_count := Sql%rowcount;

        if l_marked_count > 0 then

            SP_LIA_SMS_ACCU(
              l_marked_count,
              p_BOH_ID,
              l_max_age,
              ErrorCode,
              ErrorMsg,
              RecordsAffected
            );

            if RecordsAffected = l_marked_count then
                -- mark rows as processed
                update BDETAIL2 set
                    BD_PACSID2 = 'D'
                where   BD_BOHID2=p_BOH_ID
                and     BD_PACSID2 = 'P'
                and     BD_DATETIME > SYSDATE - l_max_age - 1/24                --  043SO --  041SO
                ;
                l_marked_count := Sql%rowcount;

                UPDATE BOHEADER set (
                    BOH_DATEFC, BOH_DATELC
                ) = (
                    SELECT MIN(BD_DATETIME), MAX(BD_DATETIME)
                    FROM BDETAIL2
                    WHERE BD_BOHID2=p_BOH_ID
                    AND   BD_DATETIME > SYSDATE - l_max_age - 1/24              --  043SO --  041SO
                )
                WHERE boh_id = p_BOH_ID;

            else
                ROLLBACK;
                PKG_COMMON.INSERT_WARNING(
                     'SMS-LA IW SETTLEMENT',
                     'PKG_BDETAIL_SETTLEMENT.SP_TRY_LIA_SMS',
                     'PROCESSING ERROR',
                     'Mismatch in marked/processed SMS CDR counts (' || l_marked_count || '/' || RecordsAffected || ')',
                     NULL,
                     p_BOH_ID
                );
                ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
            end if;
        end if;
    end if;

exception

    when PKG_COMMON.EXCP_INCONVENIENT_TIME then
        ErrorCode := PKG_COMMON.ENO_INCONVENIENT_TIME;
        ErrorMsg := PKG_COMMON.EDESC_INCONVENIENT_TIME;
        ReturnStatus := PKG_COMMON.RETURN_STATUS_SUSPENDED;
        ROLLBACK;
/*  --  032SO
    when PKG_COMMON_PACKING.EXCP_STATISTICS_FAILURE then
        ErrorCode := PKG_COMMON_PACKING.ENO_STATISTICS_FAILURE;
        ErrorMsg := PKG_COMMON_PACKING.EDESC_STATISTICS_FAILURE;
        ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
        ROLLBACK;
    when PKG_COMMON_PACKING.EXCP_WORKFLOW_ABORT then
        ErrorCode := PKG_COMMON_PACKING.ENO_WORKFLOW_ABORT;
        ErrorMsg := PKG_COMMON_PACKING.EDESC_WORKFLOW_ABORT;
        ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
        ROLLBACK;
    when Others then
        ErrorCode := SqlCode;
        ErrorMsg  := SqlErrM;
        ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
        RecordsAffected := 0;
        ROLLBACK;
*/

END SP_TRY_LIA_SMS;

procedure SP_CONS_LIT_SMS
(
  p_PAC_ID         IN       varchar2,       -- 'LIT_SMS'    SMS-LA daily UFIH Ticket
  p_BOH_ID         IN       varchar2,
  RecordsAffected  OUT      number,
  ErrorCode        OUT      number,
  ErrorMsg         OUT      varchar2,
  ReturnStatus     OUT      number
)
Is  --  037SO Consolidate SMS-LA daily IW UFIH tickets from accumulated settlement details

    l_min_age      INTEGER;
    l_max_age      INTEGER;
    l_gart         INTEGER;
    l_marked_count INTEGER;

BEGIN

    ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
    RecordsAffected := 0;

    l_min_age := to_number(PKG_COMMON_PACKING.getPackingParameter(p_PAC_ID,'MINAGE'));
    l_max_age := to_number(PKG_COMMON_PACKING.getPackingParameter(p_PAC_ID,'MAXAGE'));
    l_gart := to_number(PKG_COMMON_PACKING.getPackingParameter(p_PAC_ID,'GART'));

    -- mark rows for processing
    UPDATE SETDETAIL SET
        SED_ESID = 'P',
        SED_GOHID = p_BOH_ID
    Where SED_ESID = 'A'
    AND SED_ORDER > to_char(sysdate-l_max_age,'YYYY-MM-DD')
    AND SED_ORDER < to_char(sysdate-l_min_age,'YYYY-MM-DD')
    AND SED_ETID IN ('IOTLACA','MOIWSA')                                        --  042SO
    AND SED_SETID IN (SELECT SET_ID FROM SETTLING WHERE SET_ETID IN ('SLA'))
    ;
    l_marked_count := Sql%rowcount;

    if l_marked_count = 0 then

        ReturnStatus := PKG_COMMON.RETURN_STATUS_OK;                            --  040SO

    else

        PKG_BDETAIL_SETTLEMENT.SP_LIT_CDR(
            p_BOH_ID,                                                           -- p_BD_BOHID      In      Varchar2,
            'SLA',                                                              -- p_SET_ETID      IN      varchar2,
            l_gart,                                                             -- p_Gart          In      Number,
            l_min_age,                                                          -- p_MinAge        In      Number,
            l_max_age,                                                          -- p_MaxAge        In      Number,
            ErrorCode,                                                          -- ErrorCode       Out     Number,
            ErrorMsg,                                                           -- ErrorMsg        Out     Varchar2,
            RecordsAffected                                                     -- RecordsAffected Out     Number
        );

        if RecordsAffected = l_marked_count then
            -- set marked rows to valid
            update SETDETAIL set
                SED_ESID = 'V'
            where SED_ESID = 'P'
            AND SED_GOHID = p_BOH_ID
            AND SED_ORDER > to_char(sysdate-l_max_age,'YYYY-MM-DD')
            AND SED_ORDER < to_char(sysdate-l_min_age,'YYYY-MM-DD')

            ;
            l_marked_count := Sql%rowcount;

            UPDATE BOHEADER set (
                BOH_DATEFC, BOH_DATELC
            ) = (
                SELECT MIN(to_date(SED_ORDER,'YYYY-MM-DD HH24:MI:SS')), MAX(to_date(SED_ORDER,'YYYY-MM-DD HH24:MI:SS'))
                FROM SETDETAIL
                WHERE SED_ESID = 'V'
                AND SED_GOHID = p_BOH_ID
                AND SED_ORDER > to_char(sysdate-l_max_age,'YYYY-MM-DD')
                AND SED_ORDER < to_char(sysdate-l_min_age,'YYYY-MM-DD')
            )
            WHERE boh_id = p_BOH_ID;

            ReturnStatus := PKG_COMMON.RETURN_STATUS_OK;

        else  -- RecordsAffected <> l_marked_count
            ROLLBACK;
            ErrorMsg := 'Mismatch in marked/processed SMS CDR counts (' || l_marked_count || '/' || RecordsAffected || ')'; --  044SO
            PKG_COMMON.INSERT_WARNING(
                 'SMS-LA SETTLEMENT',
                 'PKG_BDETAIL_SETTLEMENT.SP_CONS_LIT_SMS',
                 'PROCESSING ERROR',
                 ErrorMsg,
                 NULL,
                 p_BOH_ID
            );
        end if;  -- RecordsAffected = l_marked_count
    end if;  -- l_marked_count > 0

END SP_CONS_LIT_SMS;

Procedure SP_LIA_RSGR_ACCU
( BatchSize       In      Integer,
  p_BD_BOHID      In      Varchar2,
  p_MaxAge        In      Number,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  RecordsAffected Out     Number
)
Is  --  038SO

  Cursor C1 Is                                                                  --  042SO
    SELECT /*+ INDEX(BDETAIL2 IDX_BD_BOHID32) */
        TRUNC(BD_DATETIME)                                                      as PosDATETIME,
        CON_PSCALL                                                              as PosMSISDN,
        BD_CONID                                                                as PosConId,
        BD_CONSOLIDATION                                                        as PosCONSOLIDATION,
        CON_TARID                                                               as PosTarId,
        BD_MSISDN_B                                                             as PosLongId,
        Count(*)                                                                as CdrCount,
        SUM(DECODE(BD_IOT_INTERNAL,0.0,0,NULL,0,1))                             as CdrCountMO,  --  049SO
        0                                                                       as CdrCountMT,  -- count nonzero IOTs
        SUM(NVL(BD_IOT,0.00))                                                   as Price, --  057SO --  047SO --  045SO -- IOT to LA for these CDRs
        0.0                                                                     as AmountCu,
        0.0                                                                     as RevenueShareLa,
        0.0                                                                     as RevenueShareOp
    FROM BDETAIL2, CONTRACT                                                     --  045SO      no TARFF needed any more
    WHERE BD_CONID = CON_ID
    AND BD_BOHID3 = p_BD_BOHID                                                  --  042SO
    AND BD_DATETIME > SYSDATE - p_MaxAge - 3/24                                 --  042SO
    AND BD_DATETIME < SYSDATE + 3/24
    AND BD_CDRTID = 'SMS-HR'                                                    --  066SO No Revenue Share for OnNet Home Routed
    GROUP BY
        TRUNC(BD_DATETIME),                                                     -- PosDATETIME  --  029SO
        CON_PSCALL,                                                             -- PosMSISDN
        BD_CONID,                                                               -- PosConId
        BD_CONSOLIDATION,                                                       -- PosCONSOLIDATION
        CON_TARID,                                                              -- PosTarId
        BD_MSISDN_B                                                             -- PosLongId
    ORDER by 1,2,3,4,5,6
    ;

  Cursor C2 Is                                                                  --  064SO
    SELECT /*+ INDEX(BDETAIL2 IDX_BD_BOHID32) */
        TRUNC(BD_DATETIME)                                                      as PosDATETIME,
        CON_PSCALL                                                              as PosMSISDN,
        BD_CONID                                                                as PosConId,
        BD_CONSOLIDATION                                                        as PosCONSOLIDATION,
        CON_TARID                                                               as PosTarId,
        NVL(CON_HDGROUP,0)                                                      as PosHdGroup,
        DECODE(BD_CDRTID,'SMS-HR','1','0')                                      as PosInternational,-- 0 for 'SMS-HRON'
        DECODE(BD_CDRTID,'SMS-HR','MOFNA','CDRA')                               as PosSetDetailType,
        'U'                                                                     as PosPrepaid,
        DECODE(BD_CDRTID,'SMS-HR',BD_MSISDN_B,NULL)                             as PosLongId,       -- NULL for 'SMS-HRON'
        Count(*)                                                                as CdrCount,
        Count(*)                                                                as CdrCountMO,      --  064SO
        0                                                                       as CdrCountMT,      --  064SO
        SUM(NVL(BD_AMOUNTTR,0.0))                                               as Price,
        0.00                                                                    as AmountCu,
        0.00                                                                    as RevenueShareLa,
        0.00                                                                    as RevenueShareOp
    FROM BDETAIL2, CONTRACT                                                     --  066SO
    WHERE BD_CONID = CON_ID
    AND BD_BOHID3 = p_BD_BOHID                                                  --  042SO
    AND BD_DATETIME > SYSDATE - p_MaxAge - 3/24                                 --  042SO
    AND BD_DATETIME < SYSDATE + 3/24
    AND BD_CDRTID IN ('SMS-HR', 'SMS-HRON')                                     --  064SO only if Submit CDR is not available
    GROUP BY
        TRUNC(BD_DATETIME),                                                     -- PosDATETIME  --  029SO
        CON_PSCALL,                                                             -- PosMSISDN
        BD_CONID,                                                               -- PosConId
        BD_CONSOLIDATION,                                                       -- PosCONSOLIDATION
        CON_TARID,                                                              -- PosTarId
        NVL(CON_HDGROUP,0),                                                     -- PosHdGroup
        DECODE(BD_CDRTID,'SMS-HR','1','0'),                                     -- PosInternational --  063SO
        DECODE(BD_CDRTID,'SMS-HR','MOFNA','CDRA'),                              -- PosSetDetailType --  059SO
        DECODE(BD_CDRTID,'SMS-HR',BD_MSISDN_B,NULL)                             -- PosLongId
    ORDER by 1,2,3,4,5,6,7,8,9,10
    ;

    l_ReturnStatus      NUMBER(1);

Begin

    RecordsAffected := 0;

    For C1_Rec in C1 Loop                                                       --  042SO

        PKG_BDETAIL_SETTLEMENT.SP_ADD_SETDETAIL(
                       'SLA',                                                   -- p_SET_ETID       IN varchar2,
                       'MOIWSA',             -- C1_Rec.PosSetDetailType,        -- p_SED_ETID       IN varchar2,
                       C1_Rec.PosMSISDN,                                        -- p_SED_CHARGE     IN varchar2,
                       p_BD_BOHID,                                              -- p_SED_BOHID      IN varchar2,
                       C1_Rec.PosDATETIME,                                      -- p_Date           IN DATE,
                       C1_Rec.PosConId,                                         -- p_SET_CONID      IN varchar2,
                       C1_Rec.PosTarId,                                         -- p_SED_TARID      IN varchar2,
                       NULL,                -- C1_Rec.PosInternational,         -- p_SED_INT        IN varchar2,
                       'U',                 -- C1_Rec.PosPrepaid,               -- p_SED_PREPAID    IN varchar2,
                       C1_Rec.Price,                                            -- p_SED_PRICE      IN float,       --  045SO
                       C1_Rec.AmountCu,                                         -- p_SED_AMOUNTCU   IN float,
                       C1_Rec.RevenueShareLa,                                   -- p_SED_RETSHAREPV IN float,
                       C1_Rec.RevenueShareOp,                                   -- p_SED_RETSHAREMO IN float,
                       C1_Rec.PosLongId,                                        -- p_SED_LONGID     IN varchar2,
                       C1_Rec.CdrCountMT,                                       -- p_SED_COUNT1     IN number,
                       C1_Rec.CdrCountMO,                                       -- p_SED_COUNT2     IN number,
                       'accumulating',                                          -- p_SED_DESC       IN varchar2,
                       0,                   -- C1_Rec.PosGart,                  -- p_GART           IN varchar2,
                       ErrorCode,                                               -- ErrorCode        OUT number,
                       ErrorMsg,                                                -- ErrorMsg         OUT varchar2,
                       l_ReturnStatus                                           -- ReturnStatus     IN OUT number
        );
        if l_ReturnStatus = 1 then
            RecordsAffected :=   RecordsAffected + C1_Rec.CdrCount;             --  042SO
        end if;

    End Loop;

    For C1_Rec in C2 Loop                                                       --  064SO

        PKG_BDETAIL_SETTLEMENT.SP_ADD_SETDETAIL(
                       'SLA',                                                   -- p_SET_ETID       IN varchar2,
                       C1_Rec.PosSetDetailType,                                 -- p_SED_ETID       IN varchar2,
                       C1_Rec.PosMSISDN,                                        -- p_SED_CHARGE     IN varchar2,
                       p_BD_BOHID,                                              -- p_SED_BOHID      IN varchar2,
                       C1_Rec.PosDATETIME,                                      -- p_Date           IN DATE,
                       C1_Rec.PosConId,                                         -- p_SET_CONID      IN varchar2,
                       C1_Rec.PosTarId,                                         -- p_SED_TARID      IN varchar2,
                       C1_Rec.PosInternational,                                 -- p_SED_INT        IN varchar2,
                       C1_Rec.PosPrepaid,                                       -- p_SED_PREPAID    IN varchar2,
                       C1_Rec.Price - C1_Rec.RevenueShareLa,                    -- p_SED_PRICE      IN float,
                       C1_Rec.AmountCu,                                         -- p_SED_AMOUNTCU   IN float,
                       C1_Rec.RevenueShareLa,                                   -- p_SED_RETSHAREPV IN float,
                       C1_Rec.RevenueShareOp,                                   -- p_SED_RETSHAREMO IN float,
                       C1_Rec.PosLongId,                                        -- p_SED_LONGID     IN varchar2,
                       C1_Rec.CdrCountMT,                                       -- p_SED_COUNT1     IN number,
                       C1_Rec.CdrCountMO,                                       -- p_SED_COUNT2     IN number,
                       'accumulating',                                          -- p_SED_DESC       IN varchar2,
                       0,               -- C1_Rec.PosGart,                      -- p_GART           IN varchar2,
                       ErrorCode,                                               -- ErrorCode        OUT number,
                       ErrorMsg,                                                -- ErrorMsg         OUT varchar2,
                       l_ReturnStatus                                           -- ReturnStatus     IN OUT number
        );

        if l_ReturnStatus = 1 then
            RecordsAffected :=   RecordsAffected + C1_Rec.CdrCount;
        end if;

    End Loop;

    Return;

End SP_LIA_RSGR_ACCU;


procedure SP_TRY_LIA_RSGR
(
  p_PAC_ID         IN       varchar2,       -- 'LIA_RSGR'   SMS-LA IW Accumulation
  p_BOH_ID         IN OUT   varchar2,
  RecordsAffected  OUT      number,
  ErrorCode        OUT      number,
  ErrorMsg         OUT      varchar2,
  ReturnStatus     OUT      number
)
Is  --  038SO        Accumulate SMS-LA IW Revenue Share CDRs as a first step in SMS-LA IW settlement for these CDRs

    CURSOR cCheckCandidate(max_age INTEGER) IS
    SELECT /*+ INDEX(BDETAIL2 IDX_BD_PACSID32) */ 'dummy'
    FROM BDETAIL2
    WHERE BD_PACSID3 = 'S'
    and BD_MAPSID = 'R'
    and BD_CDRTID IN ('SMS-HR','SMS-HRON')                                      --  066SO
    and BD_DATETIME > SYSDATE - max_age
    and BD_DATETIME < SYSDATE
    and ROWNUM <= 1
    ;

    l_max_age      INTEGER;
    l_batch_count  INTEGER;
    l_marked_count INTEGER;
    l_dummy        VARCHAR2(10);

BEGIN

    RecordsAffected := 0;
    ReturnStatus := PKG_COMMON.RETURN_STATUS_OK;        -- assume this for now

    l_max_age := to_number(PKG_COMMON_PACKING.getPackingParameter(p_PAC_ID,'MAXAGE'));
    l_batch_count := to_number(PKG_COMMON_PACKING.getPackingParameter(p_PAC_ID,'BATCHCOUNT'));

    l_dummy := NULL;
    OPEN cCheckCandidate(l_max_age);
    FETCH cCheckCandidate into l_dummy;
    CLOSE cCheckCandidate;

    if l_dummy is not NULL then

        PKG_COMMON_PACKING.INSERT_BOHEADER_SPTRY(p_PAC_ID, p_BOH_ID);

        -- mark rows for processing
        update /*+ INDEX(BDETAIL2 IDX_BD_PACSID32) */ BDETAIL2 set
            BD_BOHID3 = p_BOH_ID,
            BD_PACSID3 = 'P',
            BD_IOT = DECODE(BD_TARID,'P',0.0,'Q',0.0,'R',0.0,'S',0.0,'T',0.0,'X',0.0,'V',0.0,'i',0.0,(
               SELECT 0.0 - NVL(CON_IWRS,TAR_IWRS_DEF) * NVL(CONTRACT_IOT_CHF(BD_TOCID,'TERM','SMS',BD_DATETIME),0.0)  --  051SO
               FROM CONTRACT, TARIFF
               WHERE CON_ID = BD_CONID                                          --  048SO was BD_TOCID
               AND   TAR_ID = CON_TARID
            )),                                                                 --  057SO
            BD_IOT_INTERNAL = (
               SELECT 0.0 - NVL(CON_IWRS,TAR_IWRS_DEF) * NVL(CONTRACT_IOT_CHF(BD_TOCID,'TERM','SMS',BD_DATETIME),0.0)
               FROM CONTRACT, TARIFF
               WHERE CON_ID = BD_CONID                                          --  048SO was BD_TOCID
               AND   TAR_ID = CON_TARID
            )
        where BD_PACSID3 = 'S'
        and BD_MAPSID = 'R'
        and BD_CDRTID in ('SMS-HR','SMS-HRON')                                  --  066SO
        and BD_DATETIME > SYSDATE - l_max_age
        and BD_DATETIME < SYSDATE
        and ROWNUM <= l_batch_count
        ;
        l_marked_count := Sql%rowcount;

        if l_marked_count > 0 then

            SP_LIA_RSGR_ACCU(
              l_marked_count,
              p_BOH_ID,
              l_max_age,
              ErrorCode,
              ErrorMsg,
              RecordsAffected
            );

            if RecordsAffected >= l_marked_count then                            --  066SO exact records not available
                -- mark rows as processed
                update BDETAIL2 set
                    BD_PACSID3 = 'D'
                where   BD_BOHID3=p_BOH_ID
                and     BD_PACSID3 = 'P'
                and     BD_DATETIME > SYSDATE - l_max_age - 1/24                --  043SO --  041SO
                ;
                l_marked_count := Sql%rowcount;

                UPDATE BOHEADER set (
                    BOH_DATEFC, BOH_DATELC
                ) = (
                    SELECT MIN(BD_DATETIME), MAX(BD_DATETIME)
                    FROM BDETAIL2
                    WHERE BD_BOHID3=p_BOH_ID
                    AND   BD_DATETIME > SYSDATE - l_max_age - 1/24              --  043SO --  041SO
                )
                WHERE boh_id = p_BOH_ID;

            else
                ROLLBACK;
                PKG_COMMON.INSERT_WARNING(
                     'SMS-LA IW SETTLEMENT',
                     'PKG_BDETAIL_SETTLEMENT.SP_TRY_LIA_RSGR',
                     'PROCESSING ERROR',
                     'Mismatch in marked/processed SMS CDR counts (' || l_marked_count || '/' || RecordsAffected || ')',
                     NULL,
                     p_BOH_ID
                );
                ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
            end if;
        end if;
    end if;

exception

    when PKG_COMMON.EXCP_INCONVENIENT_TIME then
        ErrorCode := PKG_COMMON.ENO_INCONVENIENT_TIME;
        ErrorMsg := PKG_COMMON.EDESC_INCONVENIENT_TIME;
        ReturnStatus := PKG_COMMON.RETURN_STATUS_SUSPENDED;
        ROLLBACK;
/*  --  032SO
    when PKG_COMMON_PACKING.EXCP_STATISTICS_FAILURE then
        ErrorCode := PKG_COMMON_PACKING.ENO_STATISTICS_FAILURE;
        ErrorMsg := PKG_COMMON_PACKING.EDESC_STATISTICS_FAILURE;
        ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
        ROLLBACK;
    when PKG_COMMON_PACKING.EXCP_WORKFLOW_ABORT then
        ErrorCode := PKG_COMMON_PACKING.ENO_WORKFLOW_ABORT;
        ErrorMsg := PKG_COMMON_PACKING.EDESC_WORKFLOW_ABORT;
        ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
        ROLLBACK;
    when Others then
        ErrorCode := SqlCode;
        ErrorMsg  := SqlErrM;
        ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
        RecordsAffected := 0;
        ROLLBACK;
*/

END SP_TRY_LIA_RSGR;

End Pkg_BDetail_smsc;
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- PKG_COMMON_PACKING  (Package Body) 
--
CREATE OR REPLACE PACKAGE BODY SBS1_ADMIN.PKG_COMMON_PACKING
is
--
--  MODIFICATION HISTORY
--  Person  Date        Comments
--  -----   ----------  ----------------------------------------------
--001SO     14.01.2010  Created as subset of PKG_BDETAIL_COMMON
--002SO     26.01.2010  Check scheduling for packing
--003SO     28.01.2010  Add Parameter p_FileName to insert header
--004SO     01.02.2010  Implement dependency checks
--005SO     01.02.2010  Implement clearance window for process execution (suspended seconds before period end)
--006SO     02.02.2010  Implement file name token replacement in update header
--007SO     02.02.2010  Generate Job ID for periodic packings
--008SO     03.02.2010  Modify job creation and implement job closing (success only)
--009SO     05.02.2010  Correct Update Header date formats
--010SO     05.02.2010  Schedule / Unschedule Packing if JobId id used
--011DA     19.02.2010  Implementation for method setStringTagsToLowerCase(..)
--012DA     19.02.2010  All tag names to be replaced changed to lower case / additional use of setStringTagsToLowerCase(..)
--013DA     19.02.2010  "<" and ">" must not be removed from filename (UPDATE_BOHEADER) - there may be still tags to replace
--014DA     24.02.2010  Update BoHeader filename only if not NULL
--015DA     04.03.2010  All procedure/function calls from PKG_STATS now rerouted to new PKG_COMMON_STATS
--016SO     26.03.2010  Implement bookkeeping for looper jobs
--017SO     27.03.2010  Add Periodicity to looper registration
--018SO     28.03.2010  Consider STA_CONFIG in suspend evaluation
--019SO     28.03.2010  Consider looper jobs in suspend evaluation
--020SO     29.03.2010  Implement MODIFY_BOHEADER, used by SPTRY output converters
--021SO     29.03.2010  Implement INSERT_BOHEADER_SPTRY, used by SPTRY output converters for dummy header
--022SO     29.03.2010  Correct FileName initialisation (earlier and derived from other packing fields)
--023SO     31.03.2010  Implement packing parameter evaluation form STA_PACPARAM
--024SO     31.03.2010  Correct LoopType conditions
--025SO     01.04.2010  Remove reference to PACKINGSTATE
--026SO     07.04.2010  Correctly set the file mask in BOHEADER when registering an OC
--027SO     12.04.2010  Render packing sequence according to max value
--028SO     12.04.2010  Correct bug in isTimeForPacking
--029SO     14.04.2010  Implement scheduling (in working state) for individual statistic jobs
--030SO     20.04.2010  Recover simple jobs after failure
--031SO     21.04.2010  Set packing to scheduled for non-loopers and restructure UPDATE_BOHEADER for non-loopers
--032SO     21.04.2010  Set packing to done for scheduled empty loopersand implement JobId ='none'
--033SO     23.04.2010  Use 'NONE' instead an properly check the value
--034SO     23.04.2010  Correct debug logging logic and require level 5 for success entries
--035SO     23.04.2010  Commit packing lock while registering, otherwise it will be rolled back by DotNet caller
--036SO     24.04.2010  Clip potentially long token values (ac_name, con_name) to 25 Characters
--037SO     27.04.2010  Correct status list for resuming uncompleted STATIND jobs
--038SO     28.04.2010  Correct packing sequence format bug
--039SO     03.05.2010  Copy SP_INSERT_HEADER here from PKG_MEC_OC
--040SO     17.08.2010  Replace token brackets <> with spaces in dile names with unresolved tokens
--041SO     17.08.2010  Reset locked packings to active in new period (when no jobs exist in current period)
--042SO     17.08.2010  Preserve existing DateFc DateLc in UPDATE_BOHEADER when no values age given
--043SO     01.09.2010  Revert --040SO This must be done in MEC Driver (last occation to replace tokens)
--044SO     07.09.2011  Replace arbitrary job parameters in file naming
--045SO     07.09.2011  Correct casing and simplify one cursor
--046SO     14.12.2011  Remove schema qualifier "S B S 0 ."
--047SO     15.11.2018  Remove reference to CON_CUSTNUMBER and CON_NUMBER

    rHeaderState                    tBoHeaderEsId;
    rPackingState                   tPackingStateId;

    cstrMecDateTimeFormat           varchar2(20) := 'YYYYMMDDHH24MISS';

procedure setPackingStateScheduled(
    p_PAC_ID    IN  VARCHAR2
)
is
begin
    update PACKING set
        PAC_ESID = rPackingState.Scheduled,                                     --031SO --010SO
        PAC_DATESTA = sysdate
    where   PAC_ID = p_PAC_ID;
end;

procedure unLockPacking(
    p_PAC_ID    IN  VARCHAR2
)
is  --041SO
begin
    update PACKING set
        PAC_ESID = rPackingState.Active,
        PAC_DATESTA = sysdate
    where   PAC_ID = p_PAC_ID
    AND PAC_ESID = rPackingState.Locked;
end;

function getPackingParameter(
    p_PAC_ID    in  varchar2,
    p_Name      in  STA_PACPARAM.STAP_NAME%Type
)
return STA_PACPARAM.STAP_VALUE%Type
is
    l_result STA_PACPARAM.STAP_VALUE%Type;
begin

    SELECT  STAP_VALUE
    INTO    l_result
    FROM    STA_PACPARAM
    WHERE   STAP_PACID = p_PAC_ID
    AND     STAP_NAME = '[' || p_Name || ']'
    ;
    return l_result;

EXCEPTION
WHEN NO_DATA_FOUND then
   Raise EXCP_MISSING_PACKING_PAR;
end;


Procedure Lock_Packing(
    p_PackingId                In      Varchar2
)
IS
BEGIN

    update  PACKING set
            PAC_ESID = rPackingState.Locked
    where   PAC_ID = p_PackingId;

    -- this will fire the trigger STA_WATCHPACKINGSTATECHANGES and
    -- result in the locking of individual jobs. Currently done in PKG_STATS
END;

function getTypeForPacking
(
    p_BIH_PACID   in varchar2
)
return varchar2
is
    l_result varchar2(10);
begin

    select  PAC_ETID into l_result
    from    PACKING
    where   PAC_ID = p_BIH_PACID
    ;
    return l_result;

end;

function isTimeForPacking
(
    p_PAC_ID   in varchar2
)
return integer
is

    cursor cPackingCandidate is
    select
            PAC_ESID,
            PAC_EXECUTE,
            PAC_CONDITIONALEXEC,
            PAC_PERIODID,
            PAC_LTID,
            PAC_STARTDAY,
            PAC_STARTHOUR,
            PAC_STARTMINUTE,
            PAC_ENDCLEARANCE,                  --005SO
            PAC_DATETRY,
            PAC_DATEDONE
    from    PACKING, STA_CONFIG
    where   PAC_ID = p_PAC_ID
    AND     STAC_ID ='DEFAULT'
    AND     STAC_EXECSTAT = 1
    AND     (STAC_EXECREP = 1 OR PAC_ETID NOT IN ('STAT','STATIND'))
    AND     (STAC_EXECPROC = 1 OR PAC_ETID IN ('STAT','STATIND'))
    and     PAC_ESID in (rPackingState.Active,rPackingState.Scheduled)
    and     PAC_EXECUTE = 1
    ;   --019SO --018SO

    cursor  cDepencencyPackings is
    select
        PAC_ID,
        PAC_ESID,
        PAC_PERIODID,
        PAC_DATEDONE
    from
        PACPACDEP,
        PACKING
    where
            PACPACDEP.PACPAC_PACID1 = PACKING.PAC_ID
        and PACPAC_PACID2 = p_PAC_ID
    ;

    cursor  cDepencencyMappings is
    select
        MAP_ID,
        MAP_PERIODID,
        MAP_DATEDONE
    from
        MAPPACDEP,
        MAPPING
    where
            MAPPACDEP.MAPPAC_MAPID1 = MAPPING.MAP_ID
        and MAPPAC_PACID2 = p_PAC_ID
    ;

    type tCurDef is ref cursor;
    cvCurVar tCurDef;
    l_sql   varchar2(4000);
    bGo boolean;
    vGo varchar2(4000);

    l_job_count     INTEGER;

    l_debug     INTEGER;

begin
    bGo := false;

    SELECT  NVL(PAC_DEBUG,0) into l_debug
    FROM    PACKING
    WHERE   PAC_ID = p_PAC_ID
    ;

    -- Check if this is a convenient time for processing
    for cPackingCandidateRow in cPackingCandidate loop
        if cPackingCandidateRow.PAC_ESID in (rPackingState.Active,rPackingState.Scheduled) then
            if cPackingCandidateRow.PAC_CONDITIONALEXEC is null then
                bGO := true;
            else
                if SUBSTR(UPPER(cPackingCandidateRow.PAC_CONDITIONALEXEC),1,6) = 'SELECT' then
                    -- must check a condition sql
                    l_sql := cPackingCandidateRow.PAC_CONDITIONALEXEC;
                else
                    -- condition view or table name given
                    l_sql := 'SELECT  * FROM ' || cPackingCandidateRow.PAC_CONDITIONALEXEC;
                end if;

                open cvCurVar for l_sql;
                fetch cvCurVar into vGo;    -- ignore result
                bGo := cvCurVar%found;      -- any result is a GO
                if bGO then
                    if UPPER(NVL(TRIM(vGO),'FALSE')) in ('FALSE','0','NO') then
                        bGO := false;       -- execpt if it is 0 or false or no
                        if l_debug >= 3 then                                        --034SO
                            L('isTimeForPacking (' || p_PAC_ID || ') = ', 'false  because of CONDITIONALEXEC result in (FALSE/0/NO)');
                        end if;
                    end if;
                else
                    if l_debug >= 3 then                                        --034SO
                        L('isTimeForPacking (' || p_PAC_ID || ') = ', 'false  because of empty CONDITIONALEXEC result');
                    end if;
                end if;
                close cvCurVar;
            end if;
            if bGo = true then
                bGo := PKG_COMMON.isTimeForProcess(
                            cPackingCandidateRow.PAC_PERIODID,
                            cPackingCandidateRow.PAC_STARTDAY,
                            cPackingCandidateRow.PAC_STARTHOUR,
                            cPackingCandidateRow.PAC_STARTMINUTE,
                            cPackingCandidateRow.PAC_ENDCLEARANCE,              --005SO
                            cPackingCandidateRow.PAC_DATEDONE
                       );   --002SO
                if l_debug >= 3 and bGo = false then                            --034SO
                    L('isTimeForPacking (' || p_PAC_ID || ') = ', 'false because isTimeForProcess()=false');
                end if;
            end if;
            if bGo = true then
                --004SO
                for cDepencencyPackingsRow in cDepencencyPackings loop
                    if cDepencencyPackingsRow.PAC_ESID not in (rPackingState.Active, rPackingState.Draft) then
                        bGo := false;
                    elsif PKG_COMMON.isDoneInPeriod(
                            cDepencencyPackingsRow.PAC_PERIODID,
                            cDepencencyPackingsRow.PAC_DATEDONE
                            ) = false then                                      --028SO
                        bGo := false;
                        if l_debug >= 3 then                                    --034SO
                            L('isTimeForPacking (' || p_PAC_ID || ') = ', 'false because of PacPacDependency(' || cDepencencyPackingsRow.PAC_ID || ')');
                        end if;
                    end if;
                    exit when bGo = false;
                end loop;
            end if;
            if bGo = true then
                --004SO
                for cDepencencyMappingsRow in cDepencencyMappings loop
                    if PKG_COMMON.isDoneInPeriod(
                            cDepencencyMappingsRow.MAP_PERIODID,
                            cDepencencyMappingsRow.MAP_DATEDONE
                            ) = false then                                      --028SO
                        bGo := false;
                        if l_debug >= 3 then                                    --034SO
                            L('isTimeForPacking (' || p_PAC_ID || ') = ', 'false because of MapPacDependency(' || cDepencencyMappingsRow.MAP_ID || ')');
                        end if;
                    end if;
                    exit when bGo = false;
                end loop;
            end if;
            if bGo = true
                and cPackingCandidateRow.PAC_LTID <> 'NONE'                     --024SO
                 and cPackingCandidateRow.PAC_ESID = rPackingState.Scheduled then
                -- 019SO  This is a sceduled looper
                -- see if we have executable jobs left
                l_job_count := PKG_COMMON_STATS.GET_STA_JOB_SCHEDULED_COUNT (
                                p_PAC_ID,
                                cPackingCandidateRow.PAC_PERIODID);
                bGo := (l_job_count >= 1);                                      --019SO
                if l_debug >= 3 and bGo = false then                            --034SO
                    L('isTimeForPacking (' || p_PAC_ID || ') = ', 'false because no looper jobs are left');
                end if;
            end if;
        end if;
    end loop;

    if bGo then
        if l_debug >= 5 then                                                    --034SO
            L('isTimeForPacking (' || p_PAC_ID || ') = ', 'true');              -- 030SO
        end if;
        return 1;
    else
        return 0;       -- already logged above
    end if;
end;


function getPackingCandidateForType
(
    p_PackingType       in varchar2,
    p_Thread            in  varchar2
)
return varchar2
is

    cursor  cPackingCandidates is
        select  PAC_ID
        from    PACKING, PERIODICITY
        where   PERIODICITY.PERIOD_ID = NVL(PAC_PERIODID,'NONE')
        and     PAC_ETID  = p_PackingType
        and     PAC_ESID in (rPackingState.Active,rPackingState.Scheduled)
        and     PAC_EXECUTE = 1
        and     (PAC_XPROCID = p_Thread or  PAC_XPROCID is null)
        and     (PERIOD_ID = 'NONE' or  NVL(PAC_DATEDONE,sysdate-400) < trunc(sysdate,PERIOD_VALUE1))
        order by PAC_DATETRY NULLS FIRST
    ;

    l_result varchar2(10);
begin

    l_result := null;

    for cPackingCandidatesRow in cPackingCandidates loop
        if isTimeForPacking(cPackingCandidatesRow.PAC_ID) = 1 then
            l_result := cPackingCandidatesRow.PAC_ID;
        end if;
        exit when not(l_result is null);
    end loop;

    return l_result;

end;


function getJobCandidateForType
(
    p_PackingType       in varchar2,
    p_Thread            in  varchar2
)
return varchar2
is
    -- get candidate job id with prepared (active) jobs for given type
    -- only implemented now for p_PackingType = STATIND

    cursor  cJobCandidates is
        select  PAC_ID, STAJ_ID
        from    PACKING, PERIODICITY, STA_JOB, STA_CONFIG
        where   PERIODICITY.PERIOD_ID = NVL(PAC_PERIODID,'NONE')
        and     STAJ_PACID = PAC_ID
        and     STAJ_ESID IN ('A','S','W')                                      --037SO
        and     STAC_ID ='DEFAULT'
        and     PAC_ETID  = p_PackingType
        and     PAC_ESID in (rPackingState.Active,rPackingState.Scheduled)
        and     PAC_EXECUTE = 1
        and     (PAC_XPROCID = p_Thread or  PAC_XPROCID is null)
        and     (PERIOD_ID = 'NONE' or  STAJ_DATECRE >= trunc(sysdate,PERIOD_VALUE1))
        and     STAJ_DATECRE > sysdate - STAC_EXECSCHED
        and     NVL(STAJ_NOOFTRIALS,0) <= STAC_NOOFTRIALS
        order by STAJ_DATESTA NULLS FIRST
    ;

    l_result varchar2(10);
begin

    l_result := null;

    for cJobCandidatesRow in cJobCandidates loop
        if isTimeForPacking(cJobCandidatesRow.PAC_ID) = 1 then
            l_result := cJobCandidatesRow.STAJ_ID;
        end if;
        exit when not(l_result is null);
    end loop;

    return l_result;

end;


function getNextPackingSequence(
    p_PACID                     in      varchar2
)
return  varchar2
is

    cursor cPackingSequence is
        select
            PAC_ID,
            PAC_FILESEQMAX,
            PAC_NEXTSEQ
        from
            PACKING
        where
            PAC_ID = p_PACID
        for update of PAC_NEXTSEQ
    ;
    cPackingSequenceRow         cPackingSequence%rowtype;

    l_NextSequence      number;
    l_FormatMask        number;
    l_ThisSequence      VARCHAR2(10);       --038SO

begin

    open cPackingSequence;
    fetch cPackingSequence into cPackingSequenceRow;
    -- If cPackingSequence%Found Then
        l_NextSequence := cPackingSequenceRow.PAC_NEXTSEQ;
        l_NextSequence := mod( l_NextSequence, cPackingSequenceRow.PAC_FILESEQMAX + 1);
        l_ThisSequence :=  trim(to_char( l_NextSequence ,replace(trim(to_char(cPackingSequenceRow.PAC_FILESEQMAX)),'9','0')));
        l_NextSequence := l_NextSequence + 1;
        if l_NextSequence > cPackingSequenceRow.PAC_FILESEQMAX then
            l_NextSequence := 1;
        end if;
        update PACKING set
            PAC_NEXTSEQ = l_NextSequence
        where current of cPackingSequence;
    -- end if;
    close cPackingSequence;

    return l_ThisSequence;

end;


procedure SP_GET_NEXT_PAC_SEQ(
    p_PACID                     in      varchar2,
    p_NextSequence              out     varchar2,
    p_ErrorCode                 out     number,
    p_ErrorMsg                  out     varchar2,
    p_ReturnStatus              in out  number
)
is
begin

    p_NextSequence := getNextPackingSequence(p_PACID);

    p_ErrorCode := null;
    p_ErrorMsg := null;
    p_Returnstatus := 1;
    return;

exception
    when others then
        p_ErrorCode := sqlcode;
        p_ErrorMsg  := sqlerrm;
        p_ReturnStatus := 0;

end SP_GET_NEXT_PAC_SEQ;


procedure MODIFY_BOHEADER (
    p_HeaderId          in      varchar2,
    p_AppName           in      varchar2,
    p_AppVer            in      varchar2,
    p_Thread            in      varchar2,
    p_TaskId            in      number,
    p_HostName          in      varchar2,
    p_FileName          out     varchar2
    )
is  --020SO

begin

    update BOHEADER set
        BOH_EXE = p_AppName,
        BOH_VERSION = p_AppVer,
        BOH_THREAD = p_Thread,
        BOH_JOB = p_TaskId,
        BOH_HOST = p_HostName
    where BOH_ID = p_HeaderId
    ;
    if SQL%Rowcount <> 1 then
        RAISE PKG_COMMON.EXCP_MISSING_HEADER_FLD;
    end if;

    select  BOH_FILENAME
    into    p_FileName
    from    BOHEADER
    where   BOH_ID = p_HeaderId
    ;

    return;

end MODIFY_BOHEADER;

procedure INSERT_BOHEADER (
    p_PackingType       in      varchar2,
    p_PackingId         in out  varchar2,
    p_HeaderId          in out  varchar2,
    p_JobId             out     varchar2,
    p_FileName          out     varchar2,       --003SO
    p_AppName           in      varchar2,
    p_AppVer            in      varchar2,
    p_Thread            in      varchar2,
    p_TaskId            in      number,
    p_HostName          in      varchar2
    )
is
    -- l_FILENAME          BOHEADER.BOH_FILENAME%type := 'NO NAME';             --026SO
    l_FILESEQ           BOHEADER.BOH_FILESEQ%type := 0;
    l_PackingRow        PACKING%rowtype;                                   --007SO
    l_JobsCreated       integer;                                                --007SO
    l_job_count         INTEGER;                                                --019SO

begin

    l_JobsCreated := 0;

    if p_PackingId is not null then
        -- specific packing is given
        if isTimeForPacking(p_PackingId) = 0 then
            raise PKG_COMMON.EXCP_INCONVENIENT_TIME;
        end if;

    elsif p_PackingType = 'STATIND' then
        -- must search for active jobs of given packing type                    --029SO

        p_JobId := getJobCandidateForType(p_PackingType, p_Thread);

        if p_JobId is null then
            p_JobId := NULL;
            raise PKG_COMMON.EXCP_INCONVENIENT_TIME;
        else
            SELECT  STAJ_PACID  INTO p_PackingId
            FROM    STA_JOB
            WHERE   STAJ_ID = p_JobId
            ;
        end if;
    else
        -- only packing type is given. must search a candidate first

        p_PackingId := getPackingCandidateForType(p_PackingType, p_Thread);

        if p_PackingId is null then
            raise PKG_COMMON.EXCP_INCONVENIENT_TIME;
        end if;
    end if;

    -- packing found, which can be executed

    select  *
    into    l_PackingRow
    from    PACKING
    where   PAC_ID = p_PackingId
    ;   --022SO

    if p_HeaderId is null then
       p_HeaderId := GenerateUniqueKey('G');
    end if;

    p_FileName := NVL(l_PackingRow.PAC_FILEMASK,l_PackingRow.PAC_NAME || '_<pac_nextseq>');     --022SO

    insert into BOHEADER (
        BOH_ID ,
        BOH_DEMO,
        BOH_FILESEQ,
        BOH_DATETIME,
        BOH_FILENAME,
        BOH_START,
        BOH_ESID,
        BOH_FILEDATE,
        BOH_PACKID,
        BOH_EXE,
        BOH_VERSION,
        BOH_THREAD,
        BOH_JOB,
        BOH_HOST
    )
    values (
        p_HeaderId ,
        0,
        l_FILESEQ,
        sysdate,
        p_FileName,                                             --026SO was l_FILENAME,
        sysdate,
        'PAC',
        sysdate,
        p_PackingId,
        p_AppName,
        p_AppVer,
        p_Thread,
        p_TaskId,
        p_HostName
    );

    update PACKING set
        PAC_DATETRY = sysdate,
        PAC_DATESTA = sysdate
    where   PAC_ID = p_PackingId;

    if p_PackingType = 'STATIND' then

        PKG_COMMON_STATS.update_sta_job_working(p_JobId,p_HeaderId);

        setPackingStateScheduled(p_PackingId);                                  --010SO

    elsif NVL(l_PackingRow.PAC_PERIODID,'NONE') = 'NONE' then

        -- Signal to the driver to execute in any case
        p_JobId := 'NONE';                                                      --033SO --032SO

    elsif l_PackingRow.PAC_LTID = 'NONE' then                                   --024SO

        -- non-loopers are scheduled on the fly, but can be already registered
        -- try to recover an existing job
        PKG_COMMON_STATS.GET_STA_JOB_WORKING (
            p_PackingId,
            NVL(l_PackingRow.PAC_PERIODID,'NONE'),
            p_HeaderId,
            p_JobId
        );  --030SO

        if p_JobId is not NULL then
            setPackingStateScheduled(p_PackingId);                          --031SO
        else
            -- no aborted job found which can be re-executed                --030SO
            l_job_count := PKG_COMMON_STATS.GET_STA_JOB_ERROR_COUNT (
                            p_PackingId,
                            l_PackingRow.PAC_PERIODID);
            if l_job_count > 0 then
                -- at least one of the jobs expired unsuccessfully
                -- must throw an exception and set the packing to locked state
                Lock_Packing(p_PackingId);
                COMMIT;                                                         --035SO
                RAISE EXCP_STATISTICS_FAILURE;
            else
                -- no expired job found, must create one
                PKG_COMMON_STATS.NEW_STA_JOB_WORKING (                      --015DA
                    0,              -- p_StajParentId
                    p_PackingId,
                    null,
                    NVL(l_PackingRow.PAC_PERIODID,'NONE'),
                    p_HeaderId,
                    p_JobId
                  );    --008SO --007SO
                l_JobsCreated := 1;
                setPackingStateScheduled(p_PackingId);                      --031SO
            end if;
        end if;

    elsif l_PackingRow.PAC_LTID <> 'NONE' then

        -- this is a looper job                                                       --016SO
        if l_PackingRow.PAC_ESID = rPackingState.Active then
            -- this is a looper job without scheduled jobs
            -- schedule the looper jobs
            PKG_COMMON_STATS.NEW_STA_JOBS_LOOPERS (
                0,              -- p_StajParentId
                p_PackingId,
                NVL(l_PackingRow.PAC_PERIODID,'NONE'),
                p_HeaderId,
                l_JobsCreated
              );

            if l_JobsCreated > 0 then
                -- non-empty looper. One or more jobs scheduled.
                setPackingStateScheduled(p_PackingId);                      --031SO
            else
                update PACKING set
                    PAC_DATEDONE = sysdate,
                    PAC_DATESTA = sysdate
                where   PAC_ID = p_PackingId
                and     PAC_ESID in (rPackingState.Active)
                ;                                                           --032SO
                -- Nothing to do, commit after UPDATE_HEADER will set DateDone
                -- The execution for an empty JobID must fall through without error
                -- in the DotNet driver.
                RETURN;                                                     --032SO
            end if;

        end if;

        PKG_COMMON_STATS.GET_STA_JOB_WORKING (                      --016SO
            p_PackingId,
            NVL(l_PackingRow.PAC_PERIODID,'NONE'),                  --017SO
            p_HeaderId,
            p_JobId
        );

        if p_JobId is NULL then
            -- no jobs found which can be executed
            l_job_count := PKG_COMMON_STATS.GET_STA_JOB_ERROR_COUNT (
                            p_PackingId,
                            l_PackingRow.PAC_PERIODID);                         --019SO
            if l_job_count > 0 then
                -- at least one of the jobs expired unsuccessfully
                -- must throw an exception and set the packing to locked state
                Lock_Packing(p_PackingId);
                COMMIT;                                                         --035SO
                RAISE EXCP_STATISTICS_FAILURE;
            else
                unLockPacking(p_PackingId); --041SO 008158 Workflow Logic Patch for Statistics Loopers
                RAISE EXCP_WORKFLOW_ABORT;  -- cannot continue here, must fail and retry
            end if;
        end if;
    end if;

    return;

end INSERT_BOHEADER;

procedure INSERT_BOHEADER_SPTRY (
    p_PackingId         in      varchar2,
    p_HeaderId          in out  varchar2
    )
is  --021SO
    l_PackingId VARCHAR2(10);
    l_JobId     VARCHAR2(10);
    l_FileName  VARCHAR2(100);
begin

    l_PackingId := p_PackingId;
    if p_HeaderId IS NULL then
        INSERT_BOHEADER(
            'SPTRY',
            l_PackingId,
            p_HeaderId,
            l_JobId,
            l_FileName,
            NULL,
            NULL,
            NULL,
            NULL,
            NULL
        );
    end if;

end;

procedure UPDATE_BOHEADER(
    p_HeaderId          in      varchar2,
    p_JobId             in      varchar2,
    p_FileName          in out  varchar2,
    p_FileDate          in      varchar2,
    p_MaxAge            in      number,
    p_DataHeader        in      varchar2,
    p_RecCount          in      number,
    p_ErrCount          in      number,
    p_DateFc            in      varchar2,
    p_DateLc            in      varchar2
)
is
    -- finalizes a successful packing (except soft errors) on DB
    -- only to be called if operation is completed successfully .

    cursor cPackingInfo is
    select
            PAC_ID,
            PAC_NAME,
            PAC_ETID,
            PAC_LTID,
            PAC_ITID,
            PAC_PERIODID,
            PAC_NEXTSEQ,
            trim(to_char(PAC_NEXTSEQ,replace(PAC_FILESEQMAX,'9','0'))) PAC_NEXTSEQ_STR    --027SO
    from
            BOHEADER,
            PACKING
    where   PAC_ID = BOH_PACKID
    and     BOH_ID = p_HeaderId
    ;      --006SO

    cursor  cLooperInfoContract is
    select
            CON_ID,
            CON_NAME,
            NULL CON_NUMBER,    --047SO
            CON_PSCALL,
            CON_OPKEY,
            NULL CON_CUSTNUMBER,  --047SO
            CON_CONSOL,
            CON_SHORTID
    from    STA_JOB, CONTRACT
    where   STAJ_ID = p_JobId
    and     CON_ID = STAJ_LTVALUE
    ;       --006SO

    cursor  cLooperInfoAccount is
    select
            AC_ID,
            AC_NAME,
            AC_NUMBER,
            AC_MBUNIT,
            AC_TPID
    from    STA_JOB, ACCOUNT
    where   STAJ_ID = p_JobId
    and     AC_ID = STAJ_LTVALUE
    ;

    cursor  cLooperInfo is
    select
            STAJ_LTVALUE
    from    STA_JOB
    where   STAJ_ID = p_JobId
    ;   --044SO

    cursor cJobParameter is
    SELECT
       STAJP_NAME,
       STAJP_VALUE
    FROM    STA_JOBPARAM
    WHERE   STAJP_JOBID = p_JobId
    ;  --045SO --044SO

    x_packid            varchar2(10);
    x_fileseqmax        number;
    x_nextseq           number;
    l_HeaderState       varchar2(10);
    l_time              date;
    l_debug             INTEGER;
    l_loop_type         varchar2(10);           --031SO

begin

    l_time := sysdate;

    select boh_packid
    into x_packid
    from boheader where boh_id = p_HeaderId;

    SELECT  NVL(PAC_DEBUG,0), PAC_LTID into l_debug, l_loop_type                --031SO
    FROM    PACKING
    WHERE   PAC_ID = x_packid
    ;

    p_FileName := setStringTagsToLowerCase(p_FileName);                         --11DA

    --12DA: all tag names to be replaced changed to lower case

    if p_FileName like '%<p%' then      -- <pac_.. or <period>
        for cPackingInfoRow in cPackingInfo loop
            p_FileName := replace(p_FileName,'<pac_id>',cPackingInfoRow.PAC_ID);
            p_FileName := replace(p_FileName,'<pac_name>',cPackingInfoRow.PAC_NAME);
            p_FileName := replace(p_FileName,'<pac_nextseq>',cPackingInfoRow.PAC_NEXTSEQ_STR);  --027SO
            if cPackingInfoRow.PAC_PERIODID = 'YEARLY' then
                p_FileName := replace(p_FileName,'<period>',to_char(add_months(l_time,-12),'YYYY'));
            elsif cPackingInfoRow.PAC_PERIODID = 'MONTHLY' then
                p_FileName := replace(p_FileName,'<period>',to_char(add_months(l_time,-1),'YYYYMM'));
            elsif cPackingInfoRow.PAC_PERIODID = 'WEEKLY' then
                p_FileName := replace(p_FileName,'<period>',to_char(l_time-7,'YYYYWW'));
            elsif cPackingInfoRow.PAC_PERIODID = 'DAILY' then
                p_FileName := replace(p_FileName,'<period>',to_char(l_time-1,'YYYYDD'));
            elsif cPackingInfoRow.PAC_PERIODID = 'HOURLY' then
                p_FileName := replace(p_FileName,'<period>',to_char(l_time-1/24,'YYYYDDHH24'));
            else
                p_FileName := replace(p_FileName,'<period>',null);
            end if;
        end loop;
    end if; --006SO

    if p_FileName like '%<[%' then
        -- must replace job parameter tokens
        for cJobParameterRow in cJobParameter loop  --045SO
            p_FileName := replace(p_FileName,'<' || LOWER(cJobParameterRow.STAJP_NAME) || '>',cJobParameterRow.STAJP_VALUE);
        end loop;
    end if; --044SO

    if INSTR(p_FileName,'<') > 0 then
        -- must replace tokens
        p_FileName := replace(p_FileName,'<staj_id>',p_JobId);
        p_FileName := replace(p_FileName,'<yymmddhhmi>',to_char(l_time,'YYMMDDHH24MI'));
        p_FileName := replace(p_FileName,'<yyyymmdd>',to_char(l_time,'YYYYMMDD'));
        p_FileName := replace(p_FileName,'<yymmdd>',to_char(l_time,'YYMMDD'));
        p_FileName := replace(p_FileName,'<mmdd>',to_char(l_time,'MMDD'));
        p_FileName := replace(p_FileName,'<hhmmss>',to_char(l_time,'hh24miss'));
        p_FileName := replace(p_FileName,'<hhmi>',to_char(l_time,'hh24mi'));
    end if; --006SO

    if INSTR(p_FileName,'<') > 0 then
        -- must replace tokens
        p_FileName := replace(p_FileName,'<yyyy>',to_char(l_time,'YYYY'));
        p_FileName := replace(p_FileName,'<yy>',to_char(l_time,'YY'));
        p_FileName := replace(p_FileName,'<mm>',to_char(l_time,'MM'));
        p_FileName := replace(p_FileName,'<dd>',to_char(l_time,'DD'));
        p_FileName := replace(p_FileName,'<hh>',to_char(l_time,'hh24'));
        p_FileName := replace(p_FileName,'<mi>',to_char(l_time,'mi'));
    end if; --006SO

    if INSTR(p_FileName,'<ac_') > 0 then
        for cLooperInfoRow in cLooperInfoAccount loop
            p_FileName := replace(p_FileName,'<ac_id>',cLooperInfoRow.AC_ID);
            p_FileName := replace(p_FileName,'<ac_name>',SUBSTR(cLooperInfoRow.AC_NAME,1,25));      --036SO
            p_FileName := replace(p_FileName,'<ac_number>',cLooperInfoRow.AC_NUMBER);
            p_FileName := replace(p_FileName,'<ac_mbunit>',cLooperInfoRow.AC_MBUNIT);
            p_FileName := replace(p_FileName,'<ac_tpid>',cLooperInfoRow.AC_TPID);
        end loop;
    end if; --006SO

    if INSTR(p_FileName,'<con_') > 0 then
        for cLooperInfoRow in cLooperInfoContract loop
            p_FileName := replace(p_FileName,'<con_id>',cLooperInfoRow.CON_ID);
            p_FileName := replace(p_FileName,'<con_name>',SUBSTR(cLooperInfoRow.CON_NAME,1,25));    --036SO
            p_FileName := replace(p_FileName,'<con_number>',cLooperInfoRow.CON_NUMBER);
            p_FileName := replace(p_FileName,'<con_pscall>',cLooperInfoRow.CON_PSCALL);
            p_FileName := replace(p_FileName,'<con_opkey>',cLooperInfoRow.CON_OPKEY);
            p_FileName := replace(p_FileName,'<con_consol>',cLooperInfoRow.CON_CONSOL);
            p_FileName := replace(p_FileName,'<con_shortid>',cLooperInfoRow.CON_SHORTID);
        end loop;
    end if; --006SO

    if (INSTR(p_FileName,'<set_id>') > 0)  or (INSTR(p_FileName,'<loopvar>') > 0) then          --044SO
        for cLooperInfoRow in cLooperInfo loop                                              --044SO
            p_FileName := replace(p_FileName,'<set_id>',cLooperInfoRow.STAJ_LTVALUE);
            p_FileName := replace(p_FileName,'<loopvar>',cLooperInfoRow.STAJ_LTVALUE);      --044SO
        end loop;
    end if; --006SO

    p_FileName := TRANSLATE(p_FileName, Chr(9) || Chr(10) || Chr(13) || ',\/:;*?|"''','        ');    --043SO--040SO--013DA --006SO

    if l_debug >= 5 then
        L('UPDATE_BOHEADER (' || p_HeaderId || ') Packing ' || x_packid || ' final filename ', p_FileName);
    end if;

    If p_FileName Is Null Then                                                  --014DA
       update Boheader set
            boh_RecCount = p_RecCount,
            boh_errcount = p_ErrCount,
            BOH_DATEFC = NVL(to_date(p_DateFc,cstrMecDateTimeFormat),BOH_DATEFC),   --042SO --009SO
            BOH_DATELC = NVL(to_date(p_DateLc,cstrMecDateTimeFormat),BOH_DATELC),   --042SO --009SO
            boh_end = l_time,
            boh_esid = rHeaderState.Ok
        where boh_id = p_HeaderId;
    Else
        update Boheader set
            boh_filename = p_FileName,
            boh_RecCount = p_RecCount,
            boh_errcount = p_ErrCount,
            BOH_DATEFC = NVL(to_date(p_DateFc,cstrMecDateTimeFormat),BOH_DATEFC),   --042SO --009SO
            BOH_DATELC = NVL(to_date(p_DateLc,cstrMecDateTimeFormat),BOH_DATELC),   --042SO --009SO
            boh_end = l_time,
            boh_esid = rHeaderState.Ok
        where boh_id = p_HeaderId;
    End If;

    x_nextseq := getNextPackingSequence(x_packid);

    if UPPER(NVL(p_JobId,'NONE')) = 'NONE' then                                 --033SO

        -- simple packing without schedule. JobId can be
        --  NULL    for a looper with nothing to do
        -- 'none'   for an SPTRY defaulting
        -- 'NONE'   for simple workflows

        if l_debug >= 5 then                                                    --034SO
            L('UPDATE_BOHEADER (' || p_HeaderId || ') Packing ' || x_packid || ' simple packing done ', p_FileName);
        end if;
        update PACKING set
            PAC_DATEDONE = sysdate,
            PAC_DATESTA = sysdate
        where   PAC_ID = x_packid
        and     PAC_LTID = 'NONE'
        and     PAC_ESID in (rPackingState.Active)
        ;
        if sql%Rowcount > 0 then
            if l_debug >= 5 then                                                --034SO
                L('UPDATE_BOHEADER (' || p_HeaderId || ') Packing ' || x_packid || ' DateDone set ', p_FileName);
            end if;
        else                                                                    --034SO
            if l_debug > 0 then
                L('UPDATE_BOHEADER (' || p_HeaderId || ') Packing ' || x_packid || ' DateDone not set (packing is not active)', p_FileName);
            end if;
        end if;
    else
        PKG_COMMON_STATS.UPDATE_STA_JOB_SUCCESS(p_JobId);                       --015DA --008SO

        if l_loop_type = 'NONE' then                                            --031SO
            if l_debug >= 5 then                                                --034SO
                L('UPDATE_BOHEADER (' || p_HeaderId || ') Packing ' || x_packid || ' non-looper packing done ', p_FileName);
            end if;
            update PACKING set
                PAC_ESID = rPackingState.Active,                                    --010SO
                PAC_DATEDONE = sysdate,
                PAC_DATESTA = sysdate
            where   PAC_ID = x_packid
            and     PAC_LTID = 'NONE'
            and     PAC_ESID in (rPackingState.Scheduled)                       -- rPackingState.Active,
            ;
            if sql%Rowcount > 0 then
                if l_debug >= 5 then                                            --034SO
                    L('UPDATE_BOHEADER (' || p_HeaderId || ') Packing ' || x_packid || ' DateDone set ', p_FileName);
                end if;
            else
                if l_debug > 0 then
                    L('UPDATE_BOHEADER (' || p_HeaderId || ') Packing ' || x_packid || ' DateDone not set (job is not scheduled any more)', p_FileName);
                end if;
            end if;
        else
            -- it's a looper
            update PACKING set
                PAC_ESID = rPackingState.Active,                                --010SO
                PAC_DATEDONE = sysdate,
                PAC_DATESTA = sysdate
            where   PAC_ID = x_packid
            and     PAC_LTID <> 'NONE'
            and     PAC_ESID in (rPackingState.Scheduled)                       -- rPackingState.Active,
            and     not exists(
                        select  STAJ_ID
                        from    STA_JOB, PERIODICITY
                        where   STAJ_PACID = x_packid
                        and     PERIOD_ID = STAJ_PERIODID
                        and     STAJ_DATESTA >= trunc(sysdate,PERIOD_VALUE1)
                        and     STAJ_ESID <> 'D'
                        and     STAJ_ESID <> 'O'
                    )
            ;
            if sql%Rowcount > 0 then
                if l_debug >= 5 then                                            --034SO
                    L('UPDATE_BOHEADER (' || p_HeaderId || ') Packing ' || x_packid || ' looper done, DateDone set ', p_FileName);
                end if;
            else                                                                --034SO
                if l_debug >= 3 then
                    L('UPDATE_BOHEADER (' || p_HeaderId || ') Packing ' || x_packid || ' looper not finished yet, DateDone not set ', p_FileName);
                end if;
            end if;
        end if;
    end if;

    return;

end UPDATE_BOHEADER;


--011DA
function setStringTagsToLowerCase
(
    p_String in varchar2
)
return varchar2
is
    l_PosStart integer;
    l_PosEnd integer;
    l_Tag varchar2(20);
    l_String varchar2(1000);
begin
    l_String := p_String;

    l_PosStart := INSTR(l_String, '<', 1);
    while (l_PosStart > 0) loop
        l_PosEnd := INSTR(l_String, '>', l_PosStart + 1);
        if l_PosEnd > 0 then
            l_Tag := SUBSTR(l_String, l_PosStart, l_PosEnd - l_PosStart + 1);
            l_String := replace(l_String, l_Tag, LOWER(l_Tag));
        end if;
        l_PosStart := INSTR(l_String, '<', l_PosEnd + 1);
    end loop;

    return l_String;
end setStringTagsToLowerCase;


Procedure SP_INSERT_HEADER (
    p_PackingType       In      Varchar2,
    p_PackingId         In OUT  Varchar2,
    p_HeaderId          OUT     Varchar2,
    p_JobId             OUT     Varchar2,
    p_FileName          Out     Varchar2,
    p_AppName           In      Varchar2,
    p_AppVer            In      Varchar2,
    p_Thread            In      Varchar2,
    p_TaskId            In      Number,
    p_HostName          In      Varchar2,
    p_ErrorCode         Out     Number,
    p_ErrorDesc         Out     Varchar2,
    p_ReturnStatus      Out     Number
    )
Is  --039SO
    l_SrcType                   Varchar2(10);
Begin

    p_HeaderId := NULL;

    INSERT_BOHEADER(
        p_PackingType,
        p_PackingId,
        p_HeaderId,
        p_JobId,
        p_FileName,
        p_AppName,
        p_AppVer,
        p_Thread,
        p_TaskId,
        p_HostName
    );

    p_ReturnStatus := PKG_COMMON.RETURN_STATUS_OK;

Exception
    when PKG_COMMON.EXCP_INCONVENIENT_TIME then
        p_ErrorCode := PKG_COMMON.ENO_INCONVENIENT_TIME;
        p_ErrorDesc := PKG_COMMON.EDESC_INCONVENIENT_TIME;
        p_ReturnStatus := PKG_COMMON.RETURN_STATUS_SUSPENDED;
    when PKG_COMMON_PACKING.EXCP_STATISTICS_FAILURE then
        p_ErrorCode := PKG_COMMON_PACKING.ENO_STATISTICS_FAILURE;
        p_ErrorDesc := PKG_COMMON_PACKING.EDESC_STATISTICS_FAILURE;
        p_ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
    when PKG_COMMON_PACKING.EXCP_WORKFLOW_ABORT then
        p_ErrorCode := PKG_COMMON_PACKING.ENO_WORKFLOW_ABORT;
        p_ErrorDesc := PKG_COMMON_PACKING.EDESC_WORKFLOW_ABORT;
        p_ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
/*
    When others then
        p_ErrorCode := SqlCode;
        p_ErrorDesc := PKG_COMMON.getHardErrorDesc;
        p_ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
*/
END;


end; -- Package Body PKG_COMMON_PACKING
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- PKG_COMMON_STATS  (Package Body) 
--
CREATE OR REPLACE PACKAGE BODY SBS1_ADMIN.PKG_COMMON_STATS
IS
---------------------------------------------------------------------------------------------------------------------------------------
-- MODIFICATION HISTORY
-- Person      Date         Comments
-- ---------   ------       -----------------------------------------------------------------------------------------------------------
-- 000DA       06.03.2010   Creation
-- 001SO       26.03.2010   Add NEW_STA_JOB_SCHEDULED
-- 002SO       26.03.2010   Add NEW_STA_JOBS_LOOPERS
-- 003SO       26.03.2010   Add GET_STA_JOB_WORKING
-- 004SO       26.03.2010   Implement looper mechanism
-- 005SO       28.03.2010   Add function for evaluating executable loop job count
-- 006SO       13.04.2010   Create Job Parameters for DATEFROM and DATETO
-- 007SO       20.04.2010   Correct type DATEFROM
-- 008SO       20.04.2010   Abort when number of retry count is reached (not when overridden)
-- 009SO       23.04.2010   Also consider active jobs for resuming (after package unlock)
-- 010SO       23.04.2010   Move watchPackingStateChanges here ans simplyfy (remove) error handling
-- 011SO       23.04.2010   Consider active job state as executable and also as error cause when trycount is exceeded
-- 012SO       04.05.2010   Use job state change instead of exe date 
-- 046SO       14.12.2011  Remove schema qualifier "S B S 0 ."

-- last update 06-03-2010
---------------------------------------------------------------------------------------------------------------------------------------

-- GLOBALS

   rConfig            sta_config%rowtype;

   bDebug             boolean   := false;
   vDummy             varchar2(100);

   vSysInfo           varchar2(4000);

-- STATES
   type t_xprEsid is Record (
        active      xproc.xpr_esid%type    := 'A',
        inactive    xproc.xpr_esid%type    := 'I',
        deleted     xproc.xpr_esid%type    := 'D'
   );
   rXprEsid    t_xprEsid;


   --PACKING
   type t_pacEsid is Record (
        draft       packing.pac_esid%type    := 'R',
        active      packing.pac_esid%type    := 'A',
        inactive    packing.pac_esid%type    := 'I',
        scheduled   packing.pac_esid%type    := 'S',
        deleted     packing.pac_esid%type    := 'D',
        locked      packing.pac_esid%type    := 'L'
   );
   rPacEsid    t_pacEsid;

   --JOBS
   type t_stajEsid is Record (
        draft       sta_job.staj_esid%type    := 'R',
        active      sta_job.staj_esid%type    := 'A',
        okay        sta_job.staj_esid%type    := 'O',
        error       sta_job.staj_esid%type    := 'E',
        deleted     sta_job.staj_esid%type    := 'D',
        locked      sta_job.staj_esid%type    := 'L',
        scheduled   sta_job.staj_esid%type    := 'S',
        working     sta_job.staj_esid%type    := 'W'
   );
   rStajEsid        t_stajEsid;
   
/*
   --Notifications
   type t_noteEsid is Record (
        active      notificationtempl.not_esid%type    := 'A',
        deleted     notificationtempl.not_esid%type    := 'D',
        inactive    notificationtempl.not_esid%type    := 'I'
   );
   rNoteEsid    t_noteEsid;

-- TYPES
   --PACKING
   type t_pacEtid is Record (
        consol    packing.pac_etid%type    := 'CONSOL',
        stat      packing.pac_etid%type    := 'STAT',
        statind   packing.pac_etid%type    := 'STATIND'
   );
   rPacEtid    t_pacEtid;

-- JOBS
   type t_stajEtid is Record (
        system      sta_job.staj_etid%type    := 'SYSTEM',
        user        sta_job.staj_etid%type    := 'USER'
   );
   rStajEtid t_stajEtid;

--JOB TYPES for WEB STUFF
  Type t_stajType Is Record (                          -- Text from STAJT_LANG01
    Xls             STA_JOBOTYPE.STAOT_ID%Type     := 'XLS',
    Pdf             STA_JOBOTYPE.STAOT_ID%Type     := 'PDF'
  );
  rStajType         t_StajType;
-- CALLER --getNextExecDate
   type t_Caller is Record (
        system      varchar2(10)              := 'SYSTEM',
        indiv       varchar2(10)              := 'INDIV',
        scheduler   varchar2(10)              := 'SCHED'
   );
   rCaller t_Caller;
-- NAMES : STA_JOBPARAM
   type t_JobParam is Record (
        datefrom    varchar2(20)              := '[DATEFROM]',
        dateto      varchar2(20)              := '[DATETO]',
        datetill    varchar2(20)              := '[DATETILL]',
        keywords    varchar2(20)              := '[KEYWORDS]',
        acid        varchar2(20)              := '[AC_ID]',
        conid       varchar2(20)              := '[CON_ID]',
        stajid      varchar2(20)              := '[STAJ_ID]',
        conname     varchar2(20)              := '[CON_NAME]',
        shortid     varchar2(20)              := '[SHORT_ID]',
        msisdna     varchar2(20)              := '[MSISDN_A]',
        msisdnb     varchar2(20)              := '[MSISDN_B]'
   );
   rJobParam t_JobParam;

 -- TOKENS : SQL Parameter to replace --scheduleStats
   type t_SqlParam is Record (
        jobid       varchar2(20)              := '<STAJ_ID>',
        conid       varchar2(20)              := '<CON_ID>',
        acid        varchar2(20)              := '<AC_ID>',
        conname     varchar2(20)              := '<CON_NAME>',
        datefrom    varchar2(20)              := '<DATEFROM>',
        dateto      varchar2(20)              := '<DATETO>',
        datetill    varchar2(20)              := '<DATETILL>',
        keyword     varchar2(20)              := '<BD_KEYWORD>',
        pacetid     varchar2(20)              := '<PAC_ETID>',
        filemask    varchar2(20)              := '<PAC_FILEMASK>',
        pactemp     varchar2(20)              := '<PAC_TEMPLATE>',
        outdir      varchar2(20)              := '<PAC_OUTPUTDIR>',
        status      varchar2(20)              := '<PAC_ESID>',
        nextseq     varchar2(20)              := '<PAC_NEXTSEQ>',
        pacid       varchar2(20)              := '<PAC_ID>',
        pacname     varchar2(20)              := '<PAC_NAME>',
        period      varchar2(20)              := '<PERIOD>',
        noofsql     varchar2(20)              := '<NOOFSQL>',
        keywords    varchar2(20)              := '<KEYWORDS>',
        pdfmask     varchar2(20)              := '<PDFMASK>',
        archivedir  varchar2(20)                            := '<ARCHIVEDIR>',
                mover               varchar2(20)                            := '<MOVER>',
        shortid     varchar2(20)              := '<SHORT_ID>',
        msisdna     varchar2(20)              := '<MSISDN_A>',
        msisdnb     varchar2(20)              := '<MSISDN_B>'
   );
   rSqlParam t_SqlParam;
*/

FUNCTION getConfig return sta_config%rowtype
is
vConfig            sta_config%rowtype;
begin
    select * into vConfig
    from sta_config
    where stac_id = 'DEFAULT';
    return vConfig;
end; 


Procedure NEW_STA_PARAM (
    P_STAJP_JOBID       IN  VARCHAR2,
    P_STAJP_NAME        IN  VARCHAR2,
    P_STAJP_VALUE       IN  VARCHAR2
)
IS  -- 006SO

BEGIN

    INSERT INTO STA_JOBPARAM (
        STAJP_ID,
        STAJP_JOBID,
        STAJP_NAME,
        STAJP_VALUE
    ) VALUES (
        GenerateUniqueKey('G'),
        P_STAJP_JOBID,
        P_STAJP_NAME,
        P_STAJP_VALUE
    );    

END;

  Procedure NEW_STA_JOB_WORKING (
    p_StajParentId      In      STA_JOB.STAJ_PARENTID%Type,
    p_StajPacId         In      STA_JOB.STAJ_PACID%Type,
    p_StajLtValue       In      STA_JOB.STAJ_LTVALUE%Type,
    p_StajPeriodId      In      STA_JOB.STAJ_PERIODID%Type,
    p_BoHeaderId        In      BOHEADER.BOH_ID%Type,
    p_StajId            Out     STA_JOB.STAJ_ID%Type
  )
  Is    -- 015SO Create Job in Working state

    l_period_start      date;   -- 006SO     
    l_period_end        date;   -- 006SO     

  Begin
    -- Get a new Job Id
    p_StajId := GenerateUniqueKey('G');
    insert into sta_job (
        staj_id,
        staj_pacid,
        staj_parentid,
        staj_esid,
        staj_etid,
        staj_acidcre,
        staj_datecre,
        staj_dateexe,
        staj_datesta,
        staj_datetry,
        staj_bohidsched,
        staj_nooftrials,
        staj_bohidexec,
        staj_ltvalue,
        staj_sysinfo,
        staj_periodid,
        STAJ_CHNGCNT
    ) values (
        p_StajId,
        p_StajPacId,
        p_StajParentId,
        rStajEsid.Working,
        'SIMPLE',
        'SYSTEM',
        sysdate,
        sysdate,
        sysdate,
        sysdate,
        p_BoHeaderId,
        1,
        p_BoHeaderId,
        p_StajLtValue,
        'Processing started at '||to_char(sysdate, 'DD.MM.YYYY HH24:MI:SS'),
        p_StajPeriodId,
        0
    );

    PKG_COMMON.getdatesforperiod(p_StajPeriodId,l_period_start,l_period_end);               -- 006SO
    NEW_STA_PARAM(p_StajId, '[DATEFROM]', to_char(l_period_start,'dd.mm.yyyy hh24:mi:ss'));  -- 007SO -- 006SO
    NEW_STA_PARAM(p_StajId, '[DATETO]', to_char(l_period_end,'dd.mm.yyyy hh24:mi:ss'));     -- 006SO

    Return;

  End NEW_STA_JOB_WORKING;


  Procedure NEW_STA_JOB_SCHEDULED (
    p_StajParentId      In      STA_JOB.STAJ_PARENTID%Type,
    p_StajPacId         In      STA_JOB.STAJ_PACID%Type,
    p_StajLtValue       In      STA_JOB.STAJ_LTVALUE%Type,
    p_StajPeriodId      In      STA_JOB.STAJ_PERIODID%Type,
    p_BoHeaderId        In      BOHEADER.BOH_ID%Type,
    p_StajId            Out     STA_JOB.STAJ_ID%Type
  )
  Is    -- 001SO  Create Job in Scheduled state
  
    l_period_start      date;   -- 006SO     
    l_period_end        date;   -- 006SO     

  Begin
    -- Get a new Job Id
    p_StajId := GenerateUniqueKey('G');
    insert into sta_job (
        staj_id,
        staj_pacid,
        staj_parentid,
        staj_esid,
        staj_etid,
        staj_acidcre,
        staj_datecre,
        staj_dateexe,
        staj_datesta,
        staj_datetry,
        staj_bohidsched,
        staj_nooftrials,
        staj_bohidexec,
        staj_ltvalue,
        staj_sysinfo,
        staj_periodid,
        STAJ_CHNGCNT
    ) values (
        p_StajId,
        p_StajPacId,
        p_StajParentId,
        rStajEsid.scheduled,
        'SCHEDULED',
        'SYSTEM',
        sysdate,
        sysdate,
        sysdate,
        NULL,
        p_BoHeaderId,
        0,
        NULL,
        p_StajLtValue,
        'Scheduled at '||to_char(sysdate, 'DD.MM.YYYY HH24:MI:SS'),
        p_StajPeriodId,
        0
    );
    
    PKG_COMMON.getdatesforperiod(p_StajPeriodId,l_period_start,l_period_end);               -- 006SO
    NEW_STA_PARAM(p_StajId, '[DATEFROM]', to_char(l_period_start,'dd.mm.yyyy hh24:mi:ss')); -- 007SO -- 006SO
    NEW_STA_PARAM(p_StajId, '[DATETO]', to_char(l_period_end,'dd.mm.yyyy hh24:mi:ss'));     -- 006SO

    Return;

  End NEW_STA_JOB_SCHEDULED;


Procedure NEW_STA_JOBS_LOOPERS (
    p_StajParentId      In      STA_JOB.STAJ_PARENTID%Type,
    p_StajPacId         In      STA_JOB.STAJ_PACID%Type,
    p_StajPeriodId      In      STA_JOB.STAJ_PERIODID%Type,
    p_BoHeaderId        In      BOHEADER.BOH_ID%Type,
    p_CreatedJobCount   OUT     NUMBER
  )
Is    -- 002SO  Create all looper jobs in Scheduled state
  
    Cursor  cIteratorSql is
    SELECT  PACI_SQL
    FROM    PACITERATOR, PACKING
    WHERE   PACI_ID = PAC_ITID
    AND     PAC_ID = p_StajPacId
    ;

    Type tRefCursor is ref cursor;
    cIterator tRefCursor;
  
    Cursor    cPeriodicity is
    SELECT
        PERIOD_VALUE2,
        PERIOD_VALUE3
    FROM
        PERIODICITY
    WHERE   PERIOD_ID = p_StajPeriodId
    ;
  
    l_IteratorSql     VARCHAR2(2000);
    l_IteratorItem    VARCHAR2(10);
    l_StajId          VARCHAR2(10);
    
Begin
  
    p_CreatedJobCount := 0;
    
    for cIteratorSqlRow in cIteratorSql Loop
        l_IteratorSql := cIteratorSqlRow.PACI_SQL;
        for cPeriodicityRow in cPeriodicity loop
            l_IteratorSql := REPLACE(l_IteratorSql,'''<DATEFROM>''',cPeriodicityRow.PERIOD_VALUE2);
            l_IteratorSql := REPLACE(l_IteratorSql,'''<DATETO>''',cPeriodicityRow.PERIOD_VALUE3);            
            l_IteratorSql := REPLACE(l_IteratorSql,'<DATEFROM>',cPeriodicityRow.PERIOD_VALUE2);
            l_IteratorSql := REPLACE(l_IteratorSql,'<DATETO>',cPeriodicityRow.PERIOD_VALUE3);            
        end loop;

        open cIterator for l_IteratorSql;
        loop
            fetch cIterator into l_IteratorItem;
            exit when cIterator%NOTFOUND;
            NEW_STA_JOB_SCHEDULED (
                p_StajParentId,
                p_StajPacId,   
                l_IteratorItem, 
                p_StajPeriodId,
                p_BoHeaderId,  
                l_StajId
            );
            p_CreatedJobCount := p_CreatedJobCount + 1;              
        end loop;
        close cIterator;
    end loop;

    Return;

End NEW_STA_JOBS_LOOPERS;


Procedure UPDATE_STA_JOB(
    p_StajId            In      STA_JOB.STAJ_ID%Type,
    p_StajEsId          In      STA_JOB.STAJ_ESID%Type
  )
Is
        l_state_text    STA_JOBSTATE.STAJS_LANG01%Type;
  Begin
  
    SELECT  STAJS_LANG01
    INTO    l_state_text
    FROM    STA_JOBSTATE
    WHERE   STAJS_ID = p_StajEsId
    ;
    
    update sta_job set
        staj_esid = p_StajEsId,
        staj_datesta = sysdate,
        staj_sysinfo=substr('Processing ' || l_state_text || ' at '||to_char(sysdate, 'DD.MM.YYYY HH24:MI:SS')||chr(10)||substr(staj_sysinfo,1,3000),1,3999),
        STAJ_CHNGCNT = STAJ_CHNGCNT + 1 
    where staj_id = p_StajId
    ;
    
    Return;

End UPDATE_STA_JOB;

Procedure UPDATE_STA_JOB_WORKING(
    p_StajId            In      STA_JOB.STAJ_ID%Type,
    p_BoHeaderId        In      BOHEADER.BOH_ID%Type    
  )
Is 
Begin

    UPDATE_STA_JOB(p_StajId,rStajEsid.working);  

    update sta_job set
        STAJ_BOHIDEXEC = p_BoHeaderId,
        STAJ_DATETRY = sysdate,
        STAJ_NOOFTRIALS = NVL(STAJ_NOOFTRIALS,0) + 1
    where staj_id = p_StajId
    ;      

End UPDATE_STA_JOB_WORKING;

Procedure UPDATE_STA_JOB_SUCCESS(
    p_StajId            In      STA_JOB.STAJ_ID%Type
  )
Is    -- 015SO
Begin

    UPDATE_STA_JOB(p_StajId,rStajEsid.okay);  

End UPDATE_STA_JOB_SUCCESS;


Procedure UPDATE_STA_JOB_FAILURE(
    p_StajId            In      STA_JOB.STAJ_ID%Type
  )
Is    -- 015SO
Begin

    UPDATE_STA_JOB(p_StajId,rStajEsid.error);  

End UPDATE_STA_JOB_FAILURE;


Function GET_STA_JOB_SCHEDULED_COUNT (
    p_StajPacId         In      STA_JOB.STAJ_PACID%Type,
    p_StajPeriodId      In      STA_JOB.STAJ_PERIODID%Type
  )
return integer
Is    -- 005SO Get scheduled and executable Job count 

    cursor cExecutableLooperJobCount is
    SELECT  COUNT(*)
    FROM    STA_JOB, STA_CONFIG
    WHERE   STAJ_PACID = p_StajPacId
    AND     STAC_ID ='DEFAULT'
    AND     STAJ_ESID in (rStajEsid.scheduled, rStajEsid.working, rStajEsid.active) -- 011SO
    AND     NVL(STAJ_NOOFTRIALS,0) <= STAC_NOOFTRIALS
    AND     STAJ_DATESTA >= sysdate - STAC_EXECSCHED/24                         -- 012SO
    AND     STAJ_DATESTA >= DECODE(p_StajPeriodId,                              -- 012SO
                    'DAILY',trunc(sysdate),
                    'WEEKLY',trunc(sysdate,'day'),
                    'MONTHLY',trunc(sysdate,'MONTH'),
                    'YEARLY',trunc(sysdate,'YEAR'),
                    'HOURLY',trunc(sysdate,'HH24'),sysdate - STAC_EXECSCHED/24)
    ;   -- keep this in sync with cJobCandidate in GET_STA_JOB_WORKING
    
    l_job_count     INTEGER;      
    
Begin

    open cExecutableLooperJobCount;
    fetch cExecutableLooperJobCount into l_job_count;
    close cExecutableLooperJobCount;

    Return l_job_count;

End GET_STA_JOB_SCHEDULED_COUNT;


Function GET_STA_JOB_ERROR_COUNT (
    p_StajPacId         In      STA_JOB.STAJ_PACID%Type,
    p_StajPeriodId      In      STA_JOB.STAJ_PERIODID%Type
  )
return integer
Is    -- 005SO Get scheduled Job count with expired retries 

    cursor cFailedLooperJobCount is
    SELECT  COUNT(*)
    FROM    STA_JOB, STA_CONFIG
    WHERE   STAJ_PACID = p_StajPacId
    AND     STAC_ID ='DEFAULT'
    AND     STAJ_ESID in (rStajEsid.scheduled, rStajEsid.working, rStajEsid.active) -- 011SO
    AND     NVL(STAJ_NOOFTRIALS,0) >= STAC_NOOFTRIALS                               -- 008SO 
    AND     STAJ_DATESTA >= sysdate - STAC_EXECSCHED/24                         -- 012SO
    AND     STAJ_DATESTA >= DECODE(p_StajPeriodId,                              -- 012SO
                    'DAILY',trunc(sysdate),
                    'WEEKLY',trunc(sysdate,'day'),
                    'MONTHLY',trunc(sysdate,'MONTH'),
                    'YEARLY',trunc(sysdate,'YEAR'),
                    'HOURLY',trunc(sysdate,'HH24'),sysdate - STAC_EXECSCHED/24)
    ;   -- keep this in sync with cJobCandidate in GET_STA_JOB_WORKING
    
    l_job_count     INTEGER;      
    
Begin

    open cFailedLooperJobCount;
    fetch cFailedLooperJobCount into l_job_count;
    close cFailedLooperJobCount;

    Return l_job_count;

End GET_STA_JOB_ERROR_COUNT;

Procedure GET_STA_JOB_WORKING (
    p_StajPacId         In      STA_JOB.STAJ_PACID%Type,
    p_StajPeriodId      In      STA_JOB.STAJ_PERIODID%Type,
    p_BoHeaderId        In      BOHEADER.BOH_ID%Type,
    p_StajId            Out     STA_JOB.STAJ_ID%Type
  )
Is    -- 003SO Get next scheduled Job and set to working state

    Cursor cJobCandidate is
    SELECT  STAJ_ID
    FROM    STA_JOB, STA_CONFIG
    WHERE   STAJ_PACID = p_StajPacId
    AND     STAC_ID ='DEFAULT'
    AND     STAJ_ESID in (rStajEsid.scheduled, rStajEsid.working, rStajEsid.active) -- 009SO
    AND     NVL(STAJ_NOOFTRIALS,0) <= STAC_NOOFTRIALS
    AND     STAJ_DATESTA >= sysdate - STAC_EXECSCHED/24                         -- 012SO
    AND     STAJ_DATESTA >= DECODE(p_StajPeriodId,                              -- 012SO
                    'DAILY',trunc(sysdate),
                    'WEEKLY',trunc(sysdate,'day'),
                    'MONTHLY',trunc(sysdate,'MONTH'),
                    'YEARLY',trunc(sysdate,'YEAR'),
                    'HOURLY',trunc(sysdate,'HH24'),sysdate - STAC_EXECSCHED/24)
    ORDER BY
            STAJ_ESID, 
            STAJ_NOOFTRIALS,
            STAJ_DATETRY
    ;   -- 004SO
    
Begin

    open cJobCandidate;
    fetch cJobCandidate into p_StajId;
    if cJobCandidate%found then
        UPDATE_STA_JOB_WORKING(p_StajId,p_BoHeaderId);
    end if;
    close cJobCandidate;

    Return;

End GET_STA_JOB_WORKING;

Procedure watchPackageStateChanges
(  vPacId in packing.pac_id%type,
   vOldPacEsid in packing.pac_esid%type,
   vNewPacEsid in packing.pac_esid%type,
   vOldPacLtid in packing.pac_ltid%type,
   vNewPacLtid in packing.pac_ltid%type
 )
is  -- 010SO

begin

rConfig := getConfig;

--Lock jobs when
--Inactive (Old: Active, Scheduled)
--Locked (Old: Active, Scheduled)

if vOldPacEsid in (rPacEsid.active, rPacEsid.scheduled) and
    vNewPacEsid in (rPacEsid.inactive, rPacEsid.locked)  then

    update sta_job set
        staj_esid=rStajEsid.locked,
        staj_datesta=sysdate,
        staj_chngcnt=NVL(staj_chngcnt,0) + 1,
        staj_sysinfo=substr('Job locked at ' || to_char(sysdate,'DD.MM.YYYY hh24:mi:ss') || chr(10) || substr(staj_sysinfo,1,3000),1,3999)
    where staj_pacid=vPacId
    and staj_esid in (rStajEsid.scheduled, rStajEsid.active, rStajEsid.working)
    ;
    
 end if;

--Unlock jobs when
--Active (Old: Inactive, Locked)
if vNewPacEsid=rPacEsid.active and 
    vOldPacEsid in (rPacEsid.inactive, rPacEsid.locked) then

    update sta_job set
        staj_esid=rStajEsid.active,
        staj_datesta=sysdate,
        staj_chngcnt=NVL(staj_chngcnt,0) + 1,
        STAJ_NOOFTRIALS = 1,                                                    -- 022SO
        staj_sysinfo=substr('Job unlocked/re-activated at ' || to_char(sysdate,'DD.MM.YYYY hh24:mi:ss') || chr(10) || substr(staj_sysinfo,1,3000),1,3999)
    where staj_pacid=vPacId
    and staj_esid = rStajEsid.locked
    ;

end if;

--Delete jobs when
--Draft (Old: working, Scheduled, Locked)
--Deleted (Old: Active, Inactive, Scheduled, Locked, Deleted)

if ((vNewPacEsid=rPacEsid.draft and (vOldPacEsid=rPacEsid.locked)) or
    (vNewPacEsid=rPacEsid.deleted and (vOldPacEsid=rPacEsid.active or vOldPacEsid=rPacEsid.inactive or vOldPacEsid=rPacEsid.scheduled or vOldPacEsid=rPacEsid.locked))
   ) then

    update sta_job set
        staj_esid=rStajEsid.deleted,
        staj_datesta=sysdate,
        staj_chngcnt=NVL(staj_chngcnt,0) + 1,
        staj_sysinfo=substr('Packing was changed at ' || to_char(sysdate,'DD.MM.YYYY hh24:mi:ss') || ' The job cannot be executed anymore. Please define new Job.'||chr(10)||substr(staj_sysinfo,1,3000),1,3999)
    where staj_pacid=vPacId
    and staj_esid in (rStajEsid.scheduled, rStajEsid.active, rStajEsid.locked, rStajEsid.working)
    ;

end if;

/*
exception
     when Others then
        if (rConfig.stac_syslogger > 0) then L('watchPackageStateChanges(' || vPacId || ')', SQLERRM); end if;
*/
        
end watchPackageStateChanges;



END; -- Package Body PKG_COMMON_STATS
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- PKG_INTERWORKING  (Package Body) 
--
CREATE OR REPLACE PACKAGE BODY SBS1_ADMIN.PKG_INTERWORKING
Is

-- MODIFICATION HISTORY
-- Person   Date        Comments
-- -------------------  ------------------------------------------
-- 001SO                Adding con_hdgroup in insert into contract (not null now)
-- 002AA                Increate the size of the parameter arrays declaration for NBR for bulk import
-- 003AH                Create SP_UPDATESR038
-- 004SO                Account Insert must set AC_SHORT (not Null since CENTRUM)
-- 005SO                Moving procedure SP_UPDATE_BOHEADER_IOTLACA_2 to PKG_BDETAIL_SMSC and PKG_BDETAIL_MMSC
-- 006SO    02.03.2009  Insert SMS and MMS IOT prices for new contracts
-- 007SO    02.03.2009  Use MmsSizeClassCount = 8
-- 008SO    10.09.2009  Add prepaid roaming zone field to NUMBERRANGE, fill based on country name (Apollo project)
-- 009SO    29.03.2010  Rename p_PACT_ID to p_PAC_ID
-- 010SO    31.03.2010  Implement SP_UPDATE_DLS_DATES (moved here from PKG_BDETAIL_COMMON)
-- 011SO    26.08.2010  Rename procedures according to driving Packing-ID
-- 012SO    14.12.2011  Remove schema qualifier "S B S 0 ."
-- 013SO    19.04.2012  Use PKG_COMMON.PKG_COMMON.SP_IS_NUMERIC
-- 014SO    14.04.2016  Remove special treatment for Swisscom number ranges
-- 015SO    07.12.2016  Remove redundant implementation of DLS date calculation SP_CONS_DLSUPDATE
-- 016SO    26.05.2017  Do not  create MMS size classes as a default for IW prices
-- 017SO    01.06.2017  Directly assign OpKeys according to NUMBERRANGE modifications
-- 018SO    15.11.2018  Remove reference to CON_DEMO, CON_INIACTIVE and CON_DATEACTIVE

    MmsSizeClassCount   INTEGER := 0;   -- 016SO -- 007SO

procedure SP_CONS_UPDSR038
(
  p_PAC_ID        In      Varchar2,  -- 'UPDSR038'    -- 009SO
  p_BOH_ID        In      Varchar2,
  RecordsAffected Out     Number,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  ReturnStatus    In Out  Number
)
-- 003AH
is

nCount  number;
nCount2 number;
vDummy varchar2(256);

begin

  nCount :=-1;
  nCount2:=-1;

  UPDATE IWTCOUNTER
  SET IWTC_ESID = 'D' WHERE IWTC_BOHID1 = (SELECT MAX(IWTC_BOHID1) FROM IWTCOUNTER);

  nCount := SQL%ROWCOUNT;

  UPDATE SETPERIOD SET SEP_IWTSSID = 'D' WHERE SEP_ID = TO_CHAR(ADD_MONTHS(SYSDATE,-1),'YYYYMM');
  nCount2 := SQL%ROWCOUNT;

  --When Both are Bigger than -1 we at least have been successful
  --Update Packing -> Workflow
  if (nCount > -1 and nCount2 > -1) then
    update packing
        set pac_datedone=sysdate where pac_id='UPDSR038';
  end if;

  RecordsAffected := nCount+nCount2;
  ReturnStatus:=1;

  commit;
/*
Exception
When Others then
  RecordsAffected := 0;
  ReturnStatus:=0;
  ErrorCode := SqlCode;
  ErrorMsg  := SqlErrm;

  PKG_BDETAIL_COMMON.SP_INSERT_WARNING ('PKG_INTERWORKING', 'SP_UPDATESR038', 'Error', sqlcode||': '||sqlerrm, NULL, null, NULL, null, vDummy, vDummy, vDummy);
*/
end  SP_CONS_UPDSR038;
-------------------------------------------------------------------------------------

Function GET_ADR_ID
(
  p_ADR_COUNTRY   In      Varchar2
)
Return
  Varchar2
Is
--
-- Purpose: Return The Adr_Id Of The Given A_Adr_Country For
--          Inserting A New Account Record
--
-- Modification History
-- Person      Date      Comments
-- ---------   --------  -------------------------------------------
-- Ma44        10.10.2001

  l_Adr_Id Varchar2(10);

Begin

  Select
    GENERATEUNIQUEKEY('G') Into l_Adr_Id
  From Dual;

  Insert Into ADDRESS (
    ADR_ID,
    ADR_ETID,
    ADR_DEMO,
    ADR_ESID,
    ADR_COUNTRY,
    ADR_CHNGCNT
  )
  Select
    l_Adr_Id,
    'STD',
    0,
    'A',
    p_ADR_COUNTRY,
    0
  From Dual;
  Return l_Adr_Id;

End; -- Function GET_ADR_ID

Function GET_AC_ID
(
  p_AC_NAME       In      Varchar2,
  p_ADR_COUNTRY   In      Varchar2,
  p_ACIDCRE       In      Varchar2
)
Return
  Varchar2
Is
--
-- Purpose: Return The Ac_Id Of The Given A_Ac_Name For Inserting A
--          New Contract Record
--
-- Modification History
-- Person      Date      Comments
-- ---------   --------  -------------------------------------------
-- Ma44        10.10.2001

  l_Ac_Id   Varchar2(10);
  l_Adr_Id  Varchar2(10);

Begin

  Select
    GENERATEUNIQUEKEY('G') Into l_Ac_Id
  From Dual;
  l_Adr_Id := GET_ADR_ID(p_ADR_COUNTRY);

  Insert Into ACCOUNT (
    AC_ID,
    AC_ETID,
    AC_DEMO,
    AC_SHORT,           -- 004SO
    AC_NAME,
    AC_LOGRET,
    AC_LANGID,
    AC_VAT,
    AC_CURRENCY,
    AC_ESID,
    AC_ADRID_MAIN,
    AC_ACIDCRE,
    AC_DATECRE,
    AC_CHNGCNT
  )
  Select
    l_Ac_Id,
    'TOP',
    0,
    l_Ac_Id,            -- 004SO
    p_AC_NAME,
    0,
    'de',
    1,
    'CHF',
    'A',
    l_Adr_Id,
    p_ACIDCRE,
    SysDate,
    0
  From Dual;
  Return l_Ac_Id;

End; -- Function GET_AC_ID



Function GET_CON_ID
(
  p_CON_OPKEY     In      Varchar2,
  p_AC_NAME       In      Varchar2,
  p_ADR_COUNTRY   In      Varchar2,
  p_ACIDCRE       In      Varchar2
)
Return
  Varchar2
Is
--
-- Purpose: Return The Contract Id Of An Active (or Inactive) Contract Given By
--            The p_CON_OPKEY For
--            Inserting Number Ranges Belonging To That Contract
--          If contract Id is found then update the contract name
--            with the new value of p_AC_NAME
--          else create a new (inactive) contract
--          An active contract takes precedence over an inactive one
-- Modification History
-- Person      Date      Comments
-- ---------   --------  -------------------------------------------
-- Ma44        10.10.2001
-- 002SO       01.11.2001 Inert contract in inactive state

  l_Con_Id  Varchar2(10);
  l_Ac_Id   Varchar2(10);
  l_Adr_Id  Varchar2(10);
  l_idx     INTEGER;        -- 006SO

  Cursor C1 (p_Con_Opkey Varchar2) Is
    Select CON_ID
    From CONTRACT
    Where CON_OPKEY = p_Con_Opkey
        AND CON_ETID = 'TOC'
        AND (CON_ESID = 'A' OR CON_ESID = 'I')
    ORDER BY CON_ESID;        -- And ROWNUM <=1;

Begin

  Open C1(p_Con_Opkey);
  Fetch C1 Into l_Con_Id;

  If C1%Notfound Then
    Select
      GENERATEUNIQUEKEY('G') Into l_Con_Id
    From Dual;

    l_Ac_Id := GET_AC_ID(p_AC_NAME, p_ADR_COUNTRY, p_ACIDCRE);

    Insert Into CONTRACT (
      CON_ID,
      CON_SRCTYPE,
      CON_ETID,
      CON_ACID,
      CON_NAME,
      CON_ESID,
      CON_OPKEY,
      CON_ACIDCRE,
      CON_DATECRE,
      CON_CHNGCNT,
      CON_HDGROUP               -- 001SO
    )
    Select
      l_Con_Id,
      'OPER',
      'TOC',
      l_Ac_Id,
      p_AC_NAME,
      'I',
      P_CON_OPKEY,
      p_ACIDCRE,
      SysDate,
      0,
      0
    From Dual;

    INSERT INTO CONIOT(
        CIOT_ID,CIOT_CONID,CIOT_CURID,CIOT_IWDID,CIOT_TRCTID
    ) VALUES (
        GENERATEUNIQUEKEY('G'),l_Con_Id,NULL,'TERM','SMS'
    );  -- 006SO

    INSERT INTO CONIOT(
        CIOT_ID,CIOT_CONID,CIOT_CURID,CIOT_IWDID,CIOT_TRCTID
    ) VALUES (
        GENERATEUNIQUEKEY('G'),l_Con_Id,NULL,'ORIG','SMS'
    );  -- 006SO

    INSERT INTO CONIOT(
        CIOT_ID,CIOT_CONID,CIOT_CURID,CIOT_IWDID,CIOT_TRCTID
    ) VALUES (
        GENERATEUNIQUEKEY('G'),l_Con_Id,NULL,'ORIG','MMS'
    );  -- 006SO

    INSERT INTO CONIOTE(
        CIOTE_ID,CIOTE_CIOTID,CIOTE_MSGSIZE_MIN,CIOTE_MSGSIZE_MAX,CIOTE_PRICE,CIOTE_CHNGCNT
    ) SELECT
        GENERATEUNIQUEKEY('G'),CIOT_ID,NULL,NULL,NULL,0
      FROM  CONIOT
      WHERE CIOT_CONID = l_Con_Id
      AND   CIOT_IWDID = 'TERM'
      AND   CIOT_TRCTID = 'SMS'
    ;   -- 006SO

    INSERT INTO CONIOTE(
        CIOTE_ID,CIOTE_CIOTID,CIOTE_MSGSIZE_MIN,CIOTE_MSGSIZE_MAX,CIOTE_PRICE,CIOTE_CHNGCNT
    ) SELECT
        GENERATEUNIQUEKEY('G'),CIOT_ID,NULL,NULL,NULL,0
      FROM  CONIOT
      WHERE CIOT_CONID = l_Con_Id
      AND   CIOT_IWDID = 'ORIG'
      AND   CIOT_TRCTID = 'SMS'
    ;   -- 006SO

    for l_idx IN 1 .. MmsSizeClassCount loop                                    -- 007SO
        INSERT INTO CONIOTE(
            CIOTE_ID,CIOTE_CIOTID,CIOTE_MSGSIZE_MIN,CIOTE_MSGSIZE_MAX,CIOTE_PRICE,CIOTE_CHNGCNT
        ) SELECT
            GENERATEUNIQUEKEY('G'),CIOT_ID,NULL,NULL,NULL,0
          FROM  CONIOT
          WHERE CIOT_CONID = l_Con_Id
          AND   CIOT_IWDID = 'ORIG'
          AND   CIOT_TRCTID = 'MMS'
        ;   -- 006SO
    end loop;

  Else
    Close C1;
    For C1_Rec In C1(p_Con_Opkey) Loop
      Update CONTRACT
        Set CON_NAME = p_AC_NAME
        Where CON_ID = C1_Rec.CON_ID;

      Select
        CON_ACID Into l_Ac_Id
        From CONTRACT
        Where CON_ID = C1_Rec.CON_ID;
      Update ACCOUNT
        Set AC_NAME = p_AC_NAME
        Where AC_ID = l_Ac_Id;

      Select
        AC_ADRID_MAIN Into l_Adr_Id
        From ACCOUNT
        Where AC_ID = l_Ac_Id;
      Update ADDRESS
        Set ADR_COUNTRY = p_ADR_COUNTRY
        Where ADR_ID = l_Adr_Id;
    End Loop;
  End If;
  Return l_Con_Id;

End; -- Function GET_CON_ID




Procedure SP_INSERT_OPER
(
  BatchSize       In      Integer,
  p_BD_SRCTYPE    In      Varchar2,
  p_BD_DEMO       In      Number,
  p_BD_BIHID      In      Varchar2,
  p_NBR           In      arrNBR,
  p_COUNTRY       In      arrCOUNTRY,
  p_OPNAME        In      arrOPNAME,
  p_OPKEY         In      arrOPKEY,
  p_BDID          In Out  arrBDID,
  p_ErrNumber     In Out  Number,
  p_ErrDesc       In Out  Varchar2
)
Is
--
-- Purpose: To insert data in the temporary table (ALL_CC_NDC) in batches
--          The intermediate table ALL_CC_NDC must be cleared before calling
--          this sp for the first time (Truncate Table ALL_CC_NDC)
--
-- Modification History
-- Person      Date        Comments
-- ---------   --------    -------------------------------------------
-- Ma44        10.10.2001

  Idx           Integer;
  Idx2          Integer;

Begin
  For Idx In 1..BatchSize loop
    Begin
      Idx2 := Idx;
      Insert into ALL_CC_NDC(
        ACNDC_NBR,
        ACNDC_COUNTRY,
        ACNDC_OPNAME,
        ACNDC_OPKEY
      )
      Values(
        p_NBR(Idx),
        p_COUNTRY(Idx),
        p_OPNAME(Idx),
        p_OPKEY(Idx)
      );
    End;
  End Loop;
  -- Commit; -- $$
Return;

Exception
  when others then
    p_ErrNumber:= SQLCODE;
    p_ErrDesc:= SQLERRM;
    p_ErrDesc:= p_ErrDesc || ';' || Idx2;
    --RollBack;

End SP_INSERT_OPER;



Procedure      NORM_NBR_RANGE_LEVEL
   (p_Level IN integer)
   IS
--
-- Purpose: Normalizes MSISDN number range intermediate table NBRRANGE from last digit to first
--          replacing full sets of 10 consecutive numer range codes by one with one digit less
--          Table must be consistent before calling this reoutine (no contradicting entries on
--          different levels or same level (number of digits)
--          Routine may be called for levels 6 (trying to eliminate digit 7) until 1 (trying to eliminate digit 2)

-- MODIFICATION HISTORY
-- Person      Date         Comments
-- SO          05.08.2003   created
-- ---------   ------       -------------------------------------------

    CURSOR cCandidateCode (level INTEGER) IS
    SELECT
        NBR_CARID,
        NBR_COUNTRY,
        NBR_OPNAME,
        SUBSTR(NBR_CODE,1,level) NEWCODE
    FROM NBRRANGE
    WHERE LENGTH(NBR_CODE) = level + 1
    GROUP BY
        NBR_CARID,
        NBR_COUNTRY,
        NBR_OPNAME,
        SUBSTR(NBR_CODE,1,level)
    HAVING
        COUNT(*) = 10
    ;

BEGIN

    For cCandidateCodeRow In cCandidateCode(p_Level) Loop

        -- delete 10 numberranges
        DELETE FROM NBRRANGE
        where NBR_CARID = cCandidateCodeRow.NBR_CARID
        and LENGTH(NBR_CODE) = p_Level + 1
        and NBR_CODE LIKE cCandidateCodeRow.NEWCODE || '%'
        ;
        -- insert 1 normalized numberrange code instead
        Insert Into NBRRANGE (
          NBR_CODE,
          NBR_COUNTRY,
          NBR_OPNAME,
          NBR_CARID ) VALUES (
          cCandidateCodeRow.NEWCODE,
          cCandidateCodeRow.NBR_COUNTRY,
          cCandidateCodeRow.NBR_OPNAME,
          cCandidateCodeRow.NBR_CARID
        )
        ;

    End Loop;

END; -- Procedure NORM_NBR_RANGE_LEVEL




Procedure PREPARE_TEMP_TABLES_NBR
(
  p_PAC_ID        In      Varchar2,  -- 009SO
  p_BIOH_ID       In      Varchar2,
  RecordsAffected Out     Number
)
Is
--
-- Purpose: To prepare the temporary tables (ALL_CC_NDC, CARRIER, NBRRANGE) to filter and
--          bring the data to be imported in a consistent state.
--          This Stored Proc must be called:
--          - after calling the Stored Proc 'SP_INSERT_OPER' which fills the temporary table
--            ALL_CC_NDC from the given csv file (Input Converter / DDExplorer Copy&Paste)
--          - and before calling the Stored Proc 'SP_SET_NUMBERRANGE' for
--            import (create or merge) the Telecom Operator Contracts and their Number Ranges
--
-- Modification History
-- Person       Date        Comments
-- ---------    --------    -------------------------------------------
-- A.Ahmed      10.10.2001  Created
-- A.Ahmed      06.05.2003  Changed the name by suffixing _NBR. Now called from common
--                          procedure preparing the Msisdn number ranges and Imsi ranges
-- 001SO        14.04.2014  Remove old code for ignoring Swisscom ranges

Begin

  -- Remove Any Spaces In The Number Range Code
  Update ALL_CC_NDC
    Set ACNDC_NBR = Replace(ACNDC_NBR,' ','');

  -- 014SO

  -- Get The Distinct Carrier Names (Group By) Into Intermediate Table Carrier
  Insert Into CARRIER (
    CAR_ID,
    CAR_COUNTRY,
    CAR_OPNAME )
  Select
    ACNDC_OPKEY,
    ACNDC_COUNTRY,
    ACNDC_OPNAME
  From
    ALL_CC_NDC
  Where ACNDC_NBR <> 'CCandND'
  Group By
    ACNDC_OPKEY,
    ACNDC_COUNTRY,
    ACNDC_OPNAME;

  -- Get the Number Ranges into intermediate table Nbrrange
  Insert Into NBRRANGE (
    NBR_CODE,
    NBR_COUNTRY,
    NBR_OPNAME,
    NBR_CARID )
  Select distinct
    ACNDC_NBR,
    ACNDC_COUNTRY,
    ACNDC_OPNAME,
    ACNDC_OPKEY
  From
    ALL_CC_NDC
  Where ACNDC_NBR <> 'CCandND'
  AND LENGTH(ACNDC_NBR) >= 3
  AND PKG_COMMON.SP_IS_NUMERIC(ACNDC_NBR) = 1
  ;  -- 013SO

  -- Filter Out The Number Ranges With Code Length Greater Than 7
  Insert Into NBRRANGE (
    NBR_CODE,
    NBR_COUNTRY,
    NBR_OPNAME,
    NBR_CARID
  )
  Select
    Substr(NBR_CODE,1,10),
    Min(NBR_COUNTRY),
    Min(NBR_OPNAME),
    Min(NBR_CARID)
  From
    NBRRANGE
  Where
    Length(NBR_CODE) > 10
  Group By
    Substr(NBR_CODE,1,10);

  Delete
    From NBRRANGE
    Where Length(NBR_CODE) > 10;

  -- Remove all the Number Range Codes that are overridden by smaller conflicting
  --  Number Ranges
  Delete
    From NBRRANGE
  Where
    NBR_CODE In (
      Select
        A.NBR_CODE
      From
        NBRRANGE A,
        NBRRANGE B
      Where
          A.NBR_CODE <> B.NBR_CODE
          And SubStr(A.NBR_CODE,1,Length(B.NBR_CODE)) = B.NBR_CODE
    );

  -- normalize number ranges from last digit to first
  NORM_NBR_RANGE_LEVEL(9);
  NORM_NBR_RANGE_LEVEL(8);
  NORM_NBR_RANGE_LEVEL(7);
  NORM_NBR_RANGE_LEVEL(6);
  NORM_NBR_RANGE_LEVEL(5);
  NORM_NBR_RANGE_LEVEL(4);
  NORM_NBR_RANGE_LEVEL(3);
  NORM_NBR_RANGE_LEVEL(2);
  NORM_NBR_RANGE_LEVEL(1);

  -- Do not commit here, commit is performed by the calling routine
  -- Commit;

  Select Count(*) Into RecordsAffected from NBRRANGE;

  Return;

End; -- Procedure PREPARE_TEMP_TABLES_NBR

Procedure PREPARE_TEMP_TABLES_IMSI
(
  p_PAC_ID        In      Varchar2,  -- 009SO
  p_BIOH_ID       In      Varchar2,
  RecordsAffected Out     Number
)
Is
--
-- Purpose: To prepare the temporary tables (ALL_MCC_MNC, CARRIER(only compliment earlier fill), IRANGE) to filter and
--          bring the data to be imported in a consistent state.
--          This Stored Proc must be called:
--          - after calling the Stored Proc 'SP_INSERT_MCC_MNC' which fills the temporary table
--            ALL_MCC_MNC from the given Csv file (Input Converter or DDExplorer Copy&Paste)
--          - and before calling the Stored Proc 'SP_SET_IMSIRANGE' for
--            import (create or merge) the Telecom Operator Contracts and their Number Ranges
--
-- Modification History
-- Person       Date        Comments
-- ---------    --------    -------------------------------------------
-- A.Ahmed      06.05.2003  Created with name suffix _IMSI. Based on the prepare stored procedure
--                          for preparing the Msisdn number ranges
--

Begin

  -- Remove Any Spaces In The Mcc and Mnc
  Update ALL_MCC_MNC Set
    AMCMNC_MCC = Replace(AMCMNC_MCC,' ',''),
    AMCMNC_MNC = Replace(AMCMNC_MNC,' ','');

  -- Get The Distinct Carrier Names (Group By) Into Intermediate Table Carrier
  -- Add only those which are not existing in the Carrier table (first inserted when NBRRANGE prepare)
 Insert Into CARRIER (
    CAR_ID,
    CAR_COUNTRY,
    CAR_OPNAME
  )
  Select
    AMCMNC_OPKEY,
    AMCMNC_COUNTRY,
    AMCMNC_OPNAME
  From
    ALL_MCC_MNC
  Where AMCMNC_OPKEY NOT IN (Select CAR_ID From CARRIER)
  Group By
    AMCMNC_OPKEY,
    AMCMNC_COUNTRY,
    AMCMNC_OPNAME;

  -- Get The IMSI Ranges Into Intermediate Table IRange
  -- If carriers share MCC+MNC codes, only the carrier with the lowest id (opkey) is taken
  -- opkey 752 is ignored (TELECOM Liechtenstein) and not transferred to th IRANGE table
  Insert Into IRANGE (
    IMR_MCC,
    IMR_MNC,
    IMR_COUNTRY,
    IMR_OPNAME,
    IMR_CARID )
  Select
    A1.AMCMNC_MCC,
    A1.AMCMNC_MNC,
    A1.AMCMNC_COUNTRY,
    A1.AMCMNC_OPNAME,
    A1.AMCMNC_OPKEY
  From
    ALL_MCC_MNC A1
  Where
    A1.AMCMNC_OPKEY <> '752'
    And Not Exists (
      Select A2.AMCMNC_OPKEY
      From ALL_MCC_MNC A2
      Where A1.AMCMNC_MCC = A2.AMCMNC_MCC
      And   A1.AMCMNC_MNC = A2.AMCMNC_MNC
      And   A2.AMCMNC_OPKEY < A1.AMCMNC_OPKEY
      And   A2.AMCMNC_OPKEY <> '752'
    );

  -- Do not commit here, commit is performed by the calling routine
  --Commit;

  Select Count(*) Into RecordsAffected from IRANGE;

  Return;

End; -- Procedure PREPARE_TEMP_TABLES_IMSI


Procedure SP_CONS_NBR_PREP
(
  p_PAC_ID        In      Varchar2,  -- 'NBR_PREP' -- 009SO
  p_BIOH_ID       In      Varchar2,
  RecordsAffected Out     Number,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  ReturnStatus    In Out  Number
)
Is
--
-- Purpose: To prepare the temporary tables (ALL_CC_NDC, CARRIER, NBRRANGE) to filter and
--          bring the data to be imported in a consistent state.
--          This Stored Proc must be called:
--          - after calling the Stored Proc 'SP_INSERT_OPER' which fills the temporary table
--            ALL_CC_NDC from the given Excel file (Input Converter / DDExplorer Copy&Paste)
--          - before calling the Stored Proc 'SP_SET_NUMBERRANGE' for
--            import (create or merge) the Telecom Operator Contracts and their Number Ranges
--
-- Modification History
-- Person       Date        Comments
-- ---------    --------    -------------------------------------------
-- A.Ahmed      10.10.2001  Created
-- A.Ahmed      06.08.2003  Created Imsi intermediate tables prepare routine based
--                          on Number Ranges preparation, both called from this common procedure

  l_RecordsAffected   Number;

Begin

  -- Clear The Numberrange Temp Table
  Delete From Nbrrange;

  -- Clear The Imsi range Temp Table
  Delete From IRange;

  -- Clear The Carrier Table
  Delete From CARRIER;


  -- call the internal private stored procedure to prepare intermediate tables for Number Ranges (MSISDN)
  PREPARE_TEMP_TABLES_NBR (p_PAC_ID, p_BIOH_ID, l_RecordsAffected);     -- 009SO

  -- store the number of records processed
  RecordsAffected := l_RecordsAffected;

  -- call the internal private stored procedure to prepare intermediate tables for Number Ranges (MSISDN)
  PREPARE_TEMP_TABLES_IMSI (p_PAC_ID, p_BIOH_ID, l_RecordsAffected);    -- 009SO

  -- add the number of records processed by both the Prepare calls
  RecordsAffected := RecordsAffected + l_RecordsAffected;

   -- Make The Intermediate Tables Contents Permanent Before Proceeding
  Commit;

  ReturnStatus := 1;

  Return;
/*
Exception
When Others Then
  ErrorCode := SqlCode;
  ErrorMsg  := SqlErrM;
  RecordsAffected := 0;
  ReturnStatus := 0;
  Rollback;
*/
End  SP_CONS_NBR_PREP; -- Procedure SP_PREPARE_TEMP_TABLES



Procedure MERGE_NUMBERRANGE
(
  p_PAC_ID        In      Varchar2,  -- 009SO
  p_BOH_ID        In      Varchar2,
  RecordsAffected Out     Number
)
Is
--
-- Purpose: Import (create or merge) the Telecom Operator Contracts and their Number Ranges
--            from the Intermediate Tables (CARRIER, NBRRANGE)
--          For each Operator Key of Operator Contract found in the CARRIER table, perform a lookup to
--            determine the Contract Id (if contract is not found create one, else update the contract name)
--          Clear the Number Ranges belonging to this Contract and for each of the new Number Ranges of this
--            contract check if that Number Range belong to any other Contract. If so, clear the Number Ranges
--            of the other Contract
--          Return the number of Operator Contract
--
-- Modification History
-- Person       Date        Comments
-- ---------    --------    -------------------------------------------
-- A.Ahmed      10.10.2001  Created
-- A.Ahmed      06.08.2003  Renamed the procedure and treated as private, called by
--                          other procedure 'SP_SET_NUMBERRANGE' also calling 'SET_IMSIRANGE'

  l_Nbr_Id Varchar2(10);
  l_Con_Id Varchar2(10);
  l_Con_OpKey Number(10);
  l_Con_OpKey_Other Number(10);
  l_RecCnt Number;

  Cursor cCarrier Is
    Select
      CAR_ID,
      CAR_COUNTRY,
      CAR_OPNAME
    FROM CARRIER
    WHERE CAR_ID IS NOT NULL
    AND   CAR_OPNAME IS NOT NULL
    and   CAR_ID >= '0'
    and   CAR_ID <= '9999999999';

  Cursor  cNbrRange (p_Nbr_CarId Varchar2)  Is
    Select
      NBR_CODE,
      NBR_COUNTRY,
      NBR_OPNAME,
      NBR_CARID
    From NBRRANGE
    Where NBR_CARID = p_Nbr_CarId
    ;

    Cursor  cNumberRange (p_Nbr_Code Varchar2)  Is
    Select  NBR_CONOPKEY
    From    NUMBERRANGE
    Where   NBR_CODE = p_Nbr_Code
    ;

    Cursor  cZoneIdFromCountry (countryName VARCHAR2) IS
    SELECT  ZNZNU_ZNID
    FROM    ZONEUSAGE, ZNZNU
    WHERE   ZONEUSAGE.ZNU_CODE = countryName
    AND     ZNZNU.ZNZNU_ZNUID = ZONEUSAGE.ZNU_ID
    ;   -- 008SO

    Cursor  cZoneIdDefault IS
    SELECT  ZNZNU_ZNID
    FROM    ZONEUSAGE, ZNZNU
    WHERE   ZONEUSAGE.ZNU_CODE = '%'
    AND     ZNZNU.ZNZNU_ZNUID = ZONEUSAGE.ZNU_ID
    ;   -- 008SO

    l_zone_id   VARCHAR2(10);   -- 008SO

Begin

  l_RecCnt := 0;

  -- For Each Carrier (Operator Contract)
  For cCarrierRow In cCarrier Loop

    l_Con_Id := GET_CON_ID( cCarrierRow.CAR_ID, cCarrierRow.CAR_OPNAME, cCarrierRow.CAR_COUNTRY, 'ADMIN');

    -- Clear The Number Ranges Of This Operator
    Delete  From NUMBERRANGE
    Where   NBR_CONOPKEY = cCarrierRow.CAR_ID;

    -- For Each Number Range Belonging To This Operator
    For cNbrRangeRow In cNbrRange(cCarrierRow.CAR_ID) Loop

      -- Check if this number range belonged to any other operator until now and delete it
      -- In case the offending code is equal or longer in length
      DELETE FROM NUMBERRANGE
      WHERE NBR_CODE like cNbrRangeRow.NBR_CODE ||'%';

      -- In case the offending code is equal or smaller in length
      DELETE FROM NUMBERRANGE
      WHERE cNbrRangeRow.NBR_CODE like  NBR_CODE ||'%';

      Select
        GENERATEUNIQUEKEY('G') Into l_Nbr_Id
      From Dual;

      l_zone_id := NULL;                                                        -- 008SO
      if not (cCarrierRow.CAR_COUNTRY = 'SWITZERLAND')then
          OPEN cZoneIdFromCountry(cCarrierRow.CAR_COUNTRY);
          FETCH cZoneIdFromCountry INTO l_zone_id;
          if cZoneIdFromCountry%NOTFOUND then
              OPEN cZoneIdDefault;
              FETCH cZoneIdDefault INTO l_zone_id;
              CLOSE cZoneIdDefault;
          end if;
          CLOSE cZoneIdFromCountry;
      end if;   -- 008SO

      Insert Into NUMBERRANGE (
        NBR_ID,
        NBR_CONOPKEY,
        NBR_CODE,
        NBR_ACIDCRE,
        NBR_DATECRE,
        NBR_CHNGCNT,
        NBR_PPRZNID                                                             -- 008SO
      )
      Select
        l_Nbr_Id,
        cCarrierRow.CAR_ID,
        cNbrRangeRow.NBR_CODE,
        'ADMIN',
        SysDate,
        0,
        l_zone_id                                                               -- 008SO
      From
        DUAL;
    End Loop;
    l_RecCnt := l_RecCnt + 1;
  End Loop;
  RecordsAffected := l_RecCnt;
  Return;

End  MERGE_NUMBERRANGE; -- Procedure SET_NUMBERRANGE

Procedure MERGE_IMSIRANGE
(
  p_PAC_ID        In      Varchar2,  -- 009SO
  p_BOH_ID        In      Varchar2,
  RecordsAffected Out     Number
)
Is
--
-- Purpose:
--
-- Modification History
-- Person       Date        Comments
-- ---------    --------    -------------------------------------------
-- A.Ahmed      06.08.2003  Created

  l_Imsi_Id Varchar2(10);
  l_Con_Id Varchar2(10);
  l_Con_OpKey Number(10);
  l_Con_OpKey_Other Number(10);
  l_RecCnt Number;

  Cursor cCarrier Is
    Select
      CAR_ID,
      CAR_COUNTRY,
      CAR_OPNAME
    From CARRIER
    Where CAR_ID IS NOT NULL
    and   CAR_OPNAME IS NOT NULL
    and   CAR_ID >= '0'
    and   CAR_ID <= '9999999999';

  Cursor cIRange (p_Imsi_CarId Varchar2)  Is
    Select
      IMR_MCC,
      IMR_MNC,
      IMR_COUNTRY,
      IMR_OPNAME,
      IMR_CARID
    From IRANGE
    Where IMR_CARID = p_Imsi_CarId;

  Cursor cImsiRange (p_Imsi_Mcc Varchar2, p_Imsi_Mnc Varchar2)  Is
    Select
      IMR_CONOPKEY
    From IMSIRANGE
    Where IMR_MCC = p_Imsi_Mcc
    And   IMR_MNC = p_Imsi_Mnc;

Begin

  l_RecCnt := 0;

  -- For Each Carrier (Operator Contract)
  For cCarrierRow In cCarrier Loop

    l_Con_Id := GET_CON_ID( cCarrierRow.CAR_ID, cCarrierRow.CAR_OPNAME, cCarrierRow.CAR_COUNTRY, 'ADMIN');
    l_Con_OpKey := cCarrierRow.CAR_ID;

    -- Clear The Number Ranges Of This Operator
    Delete
      From IMSIRANGE
      Where IMR_CONOPKEY = l_Con_OpKey;

    -- For Each Imsi Range Belonging To This Operator
    For cIRangeRow In cIRange(cCarrierRow.CAR_ID) Loop

      -- Check If This Number Range Belong To Any Other Operator Contract
      -- If So, Then Delete Them In A Transaction
      -- Start A Transaction For The Consistency Of Number Ranges And Their Contracts
      Open cImsiRange(cIRangeRow.IMR_MCC, cIRangeRow.IMR_MNC);
      Fetch cImsiRange Into l_Con_OpKey_Other;
      If cImsiRange%Found Then
        Delete
          From IMSIRANGE
          Where IMR_CONOPKEY = l_Con_OpKey_Other;
      End If;
      Close cImsiRange;

      Select
        GENERATEUNIQUEKEY('G') Into l_Imsi_Id
      From Dual;

      Insert Into IMSIRANGE (
        IMR_ID,
        IMR_CONOPKEY,
        IMR_MCC,
        IMR_MNC,
        IMR_ACIDCRE,
        IMR_DATECRE,
        IMR_CHNGCNT
      )
      Select
        l_Imsi_Id,
        l_Con_OpKey,
        cIRangeRow.IMR_MCC,
        cIRangeRow.IMR_MNC,
        'ADMIN',
        SysDate,
        0
      From
        DUAL;
    End Loop;
    l_RecCnt := l_RecCnt + 1;
  End Loop;
  RecordsAffected := l_RecCnt;
  Return;

End MERGE_IMSIRANGE; -- Procedure SET_IMSIRANGE


Procedure SP_CONS_NBR_MERGE
(
  p_PAC_ID        In      Varchar2,     -- 'NBR_MERGE'            -- 009SO
  p_BOH_ID        In      Varchar2,
  RecordsAffected Out     Number,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  ReturnStatus    In Out  Number
)
Is
--
-- Purpose:
--
-- Modification History
-- Person       Date        Comments
-- ---------    --------    -------------------------------------------
-- A.Ahmed      10.10.2001  Created
-- A.Ahmed      06.08.2003  Create two sub (private) procedures (SET_NUMBERRANGE & SET_IMSIRANGE)
--                          to set the msisdn numberranges and imsi ranges respectively

  l_RecordsAffected         Number;
  excp_Nbr_Ok_Imsi_Nok      Exception;
  excp_Nbr_Nok_Imsi_Nok     Exception;


Begin

  -- call the procedure to SET (assign to operators) the msisdn numberranges
  MERGE_NUMBERRANGE (p_PAC_ID, p_BOH_ID, l_RecordsAffected);      -- 009SO
  RecordsAffected := l_RecordsAffected;

  -- call the procedure to SET (assign to operators) the imsi ranges
  MERGE_IMSIRANGE  (p_PAC_ID, p_BOH_ID, l_RecordsAffected);       -- 009SO
  RecordsAffected := RecordsAffected + l_RecordsAffected;

  Commit;
  ReturnStatus := 1;
  Return;
/*
Exception
  When Others Then
    ErrorCode := SqlCode;
    ErrorMsg  := SqlErrM;
    ReturnStatus := 0;
    RecordsAffected := 0;
    Rollback;
*/
End SP_CONS_NBR_MERGE;




Procedure SP_UPDATE_BOHEADER_IWMTSET_1
(
  p_bohid         In      Varchar2,
  p_status        In      Varchar2,
  p_count         In      Number,
  p_MaxAge        In      Number,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  ReturnStatus    In Out  Number
)
Is
   x_datefc       Date;
   x_datelc       Date;
   x_reccount     Number;
   x_packid       Varchar2(10);
   x_fileseqmax   Number;
   x_nextseq      Number;
Begin
   If p_status = 'S' then /*--- conversion was successful ---- */
      Begin
            Select /*+ INDEX(IWTCOUNTER IDX_IWTC_BOHID1) */ Min(IWTC_DATE) Into x_datefc
            From IWTCOUNTER
            Where IWTC_BOHID1 = p_bohid
            ;

            Select /*+ INDEX(IWTCOUNTER IDX_IWTC_BOHID1) */ Max(IWTC_DATE) Into x_datelc
            From IWTCOUNTER
            Where IWTC_BOHID1 = p_bohid
            ;

            Select /*+ INDEX(IWTCOUNTER IDX_IWTC_BOHID1) */ Count(*) Into x_reccount
            From IWTCOUNTER
            Where IWTC_BOHID1 = p_bohid
            ;

            Update Boheader Set
              boh_DATEFC = x_datefc,
              boh_DATELC = x_datelc,
              boh_RecCount = x_reccount,
              boh_end = SysDate,
              boh_esid = 'OK',
              boh_filename = Replace(boh_filename,'Temp-','')
            Where boh_id = p_bohid;

            Select boh_packid Into x_packid
                      From boheader Where boh_id = p_bohid;
            Select pac_fileseqmax, pac_nextseq Into x_fileseqmax, x_nextseq
                      From packing Where pac_id  = x_packid;
            If x_fileseqmax = x_nextseq Then /*** need to recycle ***/
                 x_nextseq := 1;
            Else
                 x_nextseq := x_nextseq + 1;
            End If;
            Update packing Set
              pac_nextseq = x_nextseq
            Where pac_id = x_packid;
      End;
   Else /*---- file error encountered ----*/

      Begin
        Update Boheader Set
          boh_end = SysDate,
          boh_esid = 'PAE'
        Where boh_id = p_bohid;
      End;

   End if;
   Returnstatus := 1;
   -- Commit;
   Return;

Exception
When Others Then
   ErrorCode := SqlCode;
   ErrorMsg  := SqlErrm;
   ReturnStatus := 0;
End SP_UPDATE_BOHEADER_IWMTSET_1;

-- Look up the SMSC codes in MSISDN Number Ranges and set the Proposed OperatorKey values and SMSC States
Procedure SP_CONS_SMSC_PROPOSE
(
  p_PAC_ID        In      Varchar2,  -- 'SMSC_PRPS1' or 'SMSC_PRPS2'            -- 009SO
  p_BOH_ID        In      Varchar2,
  RecordsAffected Out     Number,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  ReturnStatus    In Out  Number
)
IS

  l_RowCount        Number(10);
  l_ConOpKey_Curr   SMSC.SMSC_CONOPKEY%Type;
  l_ConOpKey_Prop   SMSC.SMSC_CONOPKEY_PROP%Type;
  l_Smsc_Esid       SMSC.SMSC_ID%Type;
  l_ConOpKey_New    SMSC.SMSC_CONOPKEY%Type;                                    -- 017SO

  Cursor C1 Is
    Select
      SMSC_ID,
      SMSC_CONOPKEY,
      SMSC_CODE
    From
      SMSC
    Order By
      SMSC_CODE
  ;

  Cursor C2 (a_SMSC_CODE Varchar2) Is
    Select
      NBR_CONOPKEY
    From
      NUMBERRANGE
    Where
      NBR_CODE <= a_SMSC_CODE
    And NBR_CODE Like Substr(a_SMSC_CODE, 1, 3) || '%'
    And NBR_CODE = Substr(a_SMSC_CODE, 1, Length(NBR_CODE))
    And ROWNUM <= 1
  ;

BEGIN

  -- Cases (U=unknown operator opkey, T=Trash operator opkey)
  --      Assigned  Proposed      Smsc
  -- SNo  Conopkey  Conopkey      State
  -- ---- --------- ------------- -----
  --  1     xyz     xyz           D
  --  2     xyz     abc           D  -- 017SO was W
  --  3     xyz     notfound(=T)  W
  --  4     U       xyz           D  -- 017SO was S
  --  5     U       notfound(=T)  W
  --  6     T       xyz           D  -- 017SO was S
  --  7     T       notfound(=T)  D

  l_RowCount := 0;

  For C1_Rec in C1 Loop

    l_ConOpKey_New := NULL;                                                     -- 017SO

    -- Currently assigned Operator Key
    l_ConOpKey_Curr := C1_Rec.SMSC_CONOPKEY;

    -- look up Con Opkey in Number Range Codes for this SMSC_CODE
    Open C2 (C1_Rec.SMSC_CODE);
    Fetch C2 Into l_ConOpKey_Prop;

    If C2%Found Then

      -- Set the Proposed OpKey to the Opkey found and the SMSC state (for Web Module display)

      If (l_ConOpKey_Curr = 0) Or (l_ConOpKey_Curr = 9999) Then
        -- CASE 4,5: New Opkey found for SMSC previously assigned to 'UknownToc' or 'TrashToc' -> Schedule the Assigment
        l_ConOpKey_New := l_ConOpKey_Prop;                                      -- 017SO
        l_Smsc_Esid := 'D';                                                     -- 017SO was S
      Else
        -- New Opkey found for SMSC previously assigned to Valid Operator-> Set the state to Warn (do not schedule the Assigment)

        If (l_ConOpKey_Curr = l_ConOpKey_Prop) Then
          -- CASE 1: Proposed Opkey and previously assigned Opkey as same -> Set the SMSC State to Done
          l_Smsc_Esid := 'D';
        Else
          -- CASE 2: Proposed Opkey is different than Opkey previously assigned -> Set the SMSC State to Warn (do not Schedule)
         l_ConOpKey_New := l_ConOpKey_Prop;                                     -- 017SO
         l_Smsc_Esid := 'D';                                                    -- 017SO was W
        End If;

      End If;

    Else

      If (l_ConOpKey_Curr = 0) Then
        -- CASE 6: New Opkey NOT found for SMSC previously assigned to 'UknownToc' -> set State to Warn, Set the Proposed Opkey to 'TrashToc'
        l_ConOpKey_Prop := '9999';
        l_ConOpKey_New := l_ConOpKey_Prop;                                      -- 017SO
        l_Smsc_Esid := 'W';
      ElsIf (l_ConOpKey_Curr = 9999) Then
        -- CASE 7: New Opkey NOT found for SMSC previously assigned to or 'TrashToc' -> Set State to Done, Set the Proposed Opkey to 'TrashToc'
        l_ConOpKey_Prop := '9999';
        l_Smsc_Esid := 'D';
      Else
        -- CASE 3: New Opkey NOT found for SMSC previously assigned to a Valid Operator -> Schedule the Assigment, Set the Proposed Opkey to 'TrashToc'
        l_ConOpKey_Prop := '9999';
        l_ConOpKey_New := l_ConOpKey_Prop;                                      -- 017SO
        l_Smsc_Esid := 'W';
      End If;

    End If;

    if l_ConOpKey_New is not null then
        Update SMSC Set
            SMSC_CONOPKEY = l_ConOpKey_New,                                     -- 017SO
            SMSC_CONOPKEY_PROP = l_ConOpKey_Prop,
            SMSC_ESID = l_Smsc_Esid,
            SMSC_DATEMOD = sysdate,                                             -- 017SO
            SMSC_ACIDMOD = 'ADMIN',                                             -- 017SO
            SMSC_CHNGCNT = SMSC_CHNGCNT + 1                                     -- 017SO
        Where
          SMSC_ID = C1_Rec.SMSC_ID
        ;
    end if;

    l_RowCount := l_RowCount + Sql%RowCount ;

    Close C2;

  End Loop;

  RecordsAffected := l_RowCount ;
  ErrorCode := 0;
  ReturnStatus := 1;
  Return;

/*
Exception

  When Others then
    ErrorCode := SqlCode;
    ErrorMsg  := SqlErrm;
    ReturnStatus := 0;
    RecordsAffected := 0;
    Return;
*/
END SP_CONS_SMSC_PROPOSE;


-- Called from Web Module GUI when Save button is clicked, after selecting/deselecting Assignment approval checkbox
Procedure SP_SMSC_ASSIGNMENT_EXECUTE
(
  p_PAC_ID        In      Varchar2,  -- 009SO
  p_BOH_ID        In      Varchar2,
  p_AC_ID         In      Varchar2,
  RecordsAffected Out     Number,
  ErrorCode       Out     Number,
  ErrorMsg        Out     Varchar2,
  ReturnStatus    In Out  Number
)
Is

  l_RowCount        Number(10);
  l_ConOpkeyCurr    SMSC.SMSC_CONOPKEY%Type;
  l_ConOpkeyProp    SMSC.SMSC_CONOPKEY_PROP%Type;
  l_ConIdCurr       CONTRACT.CON_ID%Type;
  l_ConIdProp       CONTRACT.CON_ID%Type;
  l_booIndependentIssueCreated Boolean;

  -- Cursor for Updating SMSC's Operator Key
  Cursor C1 Is
    Select
      SMSC_ID,
      SMSC_CONOPKEY,
      SMSC_CONOPKEY_PROP,
      SMSC_CODE
    From
      SMSC
    Where
      SMSC_ESID In ('P')
    Order By
      SMSC_CODE
  ;

  -- Cursor for getting the Contract IDs for creating history (ISSUE) entry
  Cursor C2( a_ConOpKey Varchar) Is
    Select
      CON_ID
    From
      Contract
    Where
      CON_OPKEY = a_ConOpKey
      And CON_ESID In ('A','E','I')
    Order By
      CON_ESID
  ;

Begin

  l_RowCount := 0;

  -- Get the SMSCs that were approved by the user (via Web GUI)
  -- and set their Current OpKey with Proposed OpKey, set the SMSC state to Done
  For C1_Rec In C1 Loop

    l_ConOpkeyCurr := C1_Rec.SMSC_CONOPKEY;
    l_ConOpkeyProp := C1_Rec.SMSC_CONOPKEY_PROP;

    Update SMSC Set
      SMSC_CONOPKEY = SMSC_CONOPKEY_PROP,
      SMSC_ESID = 'D',
      SMSC_ACIDMOD = p_AC_ID,
      SMSC_DATEMOD = SysDate,
      SMSC_CHNGCNT = Nvl(SMSC_CHNGCNT,0)
    Where
      SMSC_ID = C1_Rec.SMSC_ID
    ;

    -- Create an Issue for every OpKey change for an SMSC
    If (Sql%RowCount > 0) Then

      l_booIndependentIssueCreated := False;
      l_RowCount := l_RowCount + Sql%RowCount ;

      -- Get the Current Operator Key's Contract ID
      Open C2 (l_ConOpkeyCurr);
      Fetch C2 Into l_ConIdCurr;
      If C2%NotFound Then
        -- Con Id not found, create an independent Issue
        l_ConIdCurr := Null;
      Else
        -- Con Id found, attach the issue to this Contract
        Null;
      End if;
      Close C2;

      -- Insert an Issue with or without Curr. Contract ID
      INSERT INTO ISSUE (
        IS_ID, IS_ETID, IS_ESID, IS_ACIDRESP, IS_DEADLINE,
        IS_CONID,
        IS_DESCRIPTION,
        IS_DATECRE, IS_ACIDCRE, IS_CHNGCNT
      )
      SELECT
        GenerateUniqueKey('G'),'UPD','C', NVL(SRCT_RESPACID,'ADMIN'), TRUNC(SYSDATE),
        l_ConIdCurr,
        'SMSC ' || C1_Rec.SMSC_CODE || ' - Changed OpKey from ' || l_ConOpkeyCurr || ' to ' || l_ConOpkeyProp || ' (' || C1_Rec.SMSC_ID || ')',
        SYSDATE, p_AC_ID, 0
      FROM
        SRCTYPE
      WHERE
        SRCT_ID = 'OPER'
      ;
      If (Sql%RowCount > 0) Then
        If (l_ConIdCurr Is Null) Then
          -- Independent Issue Created, set a flag to avoid creating another independent Issue if ConIdProp not found
          l_booIndependentIssueCreated := True;
        End If;
      End If;

      -- Get the Proposed Operator Key's Contract ID
      Open C2 (l_ConOpkeyProp);
      Fetch C2 Into l_ConIdProp;
      If C2%NotFound Then
        -- Con Id not found, create an independent Issue
        l_ConIdProp := Null;
      Else
        -- Con Id found, attach the issue to this Contract
        Null;
      End if;
      Close C2;

      If (Not l_booIndependentIssueCreated) Then
        -- Insert an Issue with or without Prop. Contract ID
        INSERT INTO ISSUE (
          IS_ID, IS_ETID, IS_ESID, IS_ACIDRESP, IS_DEADLINE,
          IS_CONID,
          IS_DESCRIPTION,
          IS_DATECRE, IS_ACIDCRE, IS_CHNGCNT
        )
        SELECT
          GenerateUniqueKey('G'),'UPD','C', NVL(SRCT_RESPACID,'ADMIN'), TRUNC(SYSDATE),
          l_ConIdProp,
          'SMSC ' || C1_Rec.SMSC_CODE || ' - Changed OpKey from ' || l_ConOpkeyCurr || ' to ' || l_ConOpkeyProp || ' (' || C1_Rec.SMSC_ID || ')',
          SYSDATE, p_AC_ID, 0
        FROM
          SRCTYPE
        WHERE
          SRCT_ID = 'OPER'
        ;
      End If;

    End If;   -- If (Sql%RowCount > 0) Then

  End Loop;

  RecordsAffected := l_RowCount ;
  ErrorCode := 0;
  ReturnStatus := 1;
  Return;

Exception

  When Others then
    ErrorCode := SqlCode;
    ErrorMsg  := SqlErrm;
    ReturnStatus := 0;
    RecordsAffected := 0;
    Return;

END SP_SMSC_ASSIGNMENT_EXECUTE;


PROCEDURE SP_INSERT_MCCMNC
(
  BatchSize         In      Integer,
  p_BD_SRCTYPE      In      Varchar2,
  p_BD_DEMO         In      Number,
  p_BD_BIHID        In      Varchar2,
  p_MCC             In      arrMcc,
  p_MNC             In      arrMnc,
  p_COUNTRY         In      arrCountry,
  p_OPNAME          In      arrOpName,
  p_OPKEY           In      arrOpKey,
  p_STARTDATE       In      arrStartDate,
  p_CEASEDATE       In      arrCeaseDate,
  p_BDID            In Out  arrBDID,
  p_ErrNumber       In Out  Number,
  p_ErrDesc         In Out  Varchar2
)
Is
  Idx     Integer;
  Idx2    Integer;
Begin
  For Idx In 1..BatchSize loop
    Begin
      Idx2 := Idx;
      Insert into ALL_MCC_MNC(
        AMCMNC_MCC,
        AMCMNC_MNC,
        AMCMNC_COUNTRY,
        AMCMNC_OPNAME,
        AMCMNC_OPKEY,
        AMCMNC_STARTDATE,
        AMCMNC_CEASEDATE
      )
      Values(
        p_MCC(Idx),
        p_MNC(Idx),
        p_COUNTRY(Idx),
        p_OPNAME(Idx),
        p_OPKEY(Idx),
        p_STARTDATE(Idx),
        p_CEASEDATE(Idx)
      );
    End;
  End Loop;
  -- Commit; -- $$
Return;

Exception
  when others then
    p_ErrNumber:= SQLCODE;
    p_ErrDesc:= SQLERRM;
    p_ErrDesc:= p_ErrDesc || ';' || Idx2;
    --RollBack;
End SP_INSERT_MCCMNC;



End; -- Package Body PKG_INTERWORKING
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- PKG_KPI_BD  (Package Body) 
--
CREATE OR REPLACE PACKAGE BODY SBS1_ADMIN.pkg_kpi_bd as

-- MODIFICATION HISTORY
-- Person   Date        Comments
-- -------------------  ------------------------------------------
-- 001SO    15.11.2017  Create for Project SBS-17.08 Technical_Application_KPI_Plotter

    max_age_minutes     CONSTANT INTEGER    := 30;
    min_age_minutes     CONSTANT INTEGER    := 1;
    minutes_per_day     CONSTANT INTEGER    := 1440;
    max_proc_seconds    CONSTANT INTEGER    := 60;
    seconds_per_day     CONSTANT INTEGER    := 86400;


procedure DO_WORK (
      SQLT_STR_PACID IN varchar2
    , SQLT_STR_BIHID IN varchar2
    , SQLT_DAT_DATETIME IN DATE
    , SQLT_STR_CONTEXT IN varchar2
)
IS
BEGIN
    INSERT INTO BDKPI (
      BDK_ID, BDK_DATETIME, BDK_PACID, BDK_SCHEMA, BDK_TABLE, BDK_BIHID
    , BDK_CODE
    , BDK_VALUE
    , BDK_CVALUE
    )(
    SELECT
      GenerateBase36KpiKey(), SQLT_DAT_DATETIME, SQLT_STR_PACID, 'SBS1', 'BDETAIL', SQLT_STR_BIHID
    , KPI_CODE
    , round(KPI_VALUE,4)
    , '{' ||
      '"CODE":' || JSON_STRING(KPI_CODE) || ',' ||
      '"VALUE":' || JSON_NUMBER(round(KPI_VALUE,4)) || ',' ||
      SQLT_STR_CONTEXT ||
      '}'
    FROM
    ( select /*+ INDEX (BDETAIL IDX_BD_BIHID) */
      -- Average Customer Price MBS + MVP NonZero Prices only 
        'BdPrice(Price<>0)'             as KPI_CODE
      , AVG(BD_AMOUNTCU)                as KPI_VALUE
      from  BDETAIL
      where BD_MAPSID = 'R'
      and   NVL(BD_AMOUNTCU,0) <> 0
      and   BD_DATETIME >= sysdate - 1
      and   BD_BIHID = SQLT_STR_BIHID
      UNION
      select /*+ INDEX (BDETAIL IDX_BD_BIHID) */
      -- Average revenue Share MBS + MVP NonZero Shares only 
        'BdRShare(Price<>0)'             as KPI_CODE
      , AVG(BD_RETSHAREPV)              as KPI_VALUE
      from  BDETAIL
      where BD_MAPSID = 'R'
      and   NVL(BD_AMOUNTCU,0) <> 0
      and   BD_DATETIME >= sysdate - 1
      and   BD_BIHID = SQLT_STR_BIHID
      UNION
      select /*+ INDEX (BDETAIL IDX_BD_BIHID) */
      -- Percentage of Zero Price for MBS + MVP 
        'BdRate(Price=0)'               as KPI_CODE
      , case
        when COUNT(*) = 0 then NULL
        else SUM(DECODE(BD_AMOUNTCU,0,0,NULL,0,1)) / COUNT(*)
        end                             as KPI_VALUE
      from  BDETAIL
      where BD_MAPSID in ('R','E')
      and   BD_DATETIME >= sysdate - 1
      and   BD_BIHID = SQLT_STR_BIHID
      UNION
      select /*+ INDEX (BDETAIL IDX_BD_BIHID) */
      -- Average transport cost for MBS + MVP (NonNzero only) 
        'BdAmountTr(AmountTr<>0)'       as KPI_CODE
      , AVG(BD_AMOUNTTR)                as KPI_VALUE
      from  BDETAIL
      where BD_MAPSID = 'R'
      and   NVL(BD_AMOUNTTR,0) <> 0
      and   BD_DATETIME >= sysdate - 1
      and   BD_BIHID = SQLT_STR_BIHID
      UNION
      select /*+ INDEX (BDETAIL IDX_BD_BIHID) */
      -- Percentage of Zero Transport Cost  for MBS + MVP 
        'BdRate(AmountTr=0)'    as KPI_CODE
      , case
        when COUNT(*) = 0 then NULL
        else SUM(DECODE(BD_AMOUNTTR,0,1,0)) / COUNT(*)
        end                             as KPI_VALUE
      from  BDETAIL
      where BD_MAPSID in ('R')
      and   BD_DATETIME >= sysdate - 1
      and   BD_BIHID = SQLT_STR_BIHID
      UNION
      select /*+ INDEX (BDETAIL IDX_BD_BIHID) */
        'BdRateError'                  as KPI_CODE
      , case
        when COUNT(*) = 0 then NULL
        else SUM(DECODE(BD_MAPSID, 'R',0,1)) / COUNT(*)
        end                             as KPI_VALUE
      from  BDETAIL
      where BD_MAPSID in ('R','E')
      and   BD_DATETIME >= sysdate - 1
      and   BD_BIHID = SQLT_STR_BIHID
      UNION
      select /*+ INDEX (BDETAIL IDX_BD_BIHID) */
        'BdRateUnknown'                 as KPI_CODE
      , case
        when COUNT(*) = 0 then NULL
        else SUM(DECODE(BD_PREPAID, 'U',1,NULL,1,0)) / COUNT(*)
        end                             as KPI_VALUE
      from  BDETAIL
      where BD_MAPSID in ('R','E')
      and   BD_DATETIME >= sysdate - 1
      and   BD_BIHID = SQLT_STR_BIHID
    )
    );
END;

procedure SP_TRY_KPI
(
    SQLT_STR_PACID        IN      varchar2,       -- 'KPI000' ... 'KPI999'
    SQLT_STR_BOHID        IN OUT  varchar2,
    SQLT_INT_RECORDS      OUT     number,
    SQLT_INT_ERROR        OUT     number,
    SQLT_STR_ERRORMSG     OUT     varchar2,
    SQLT_INT_RETSTATUS    OUT     number
)
Is

    CURSOR cFileCand
    IS
    select
      BIH_ID
    , BIH_DATETIME
    , BIH_RECCOUNT
    , '"FILENAME":' || JSON_STRING(BIH_FILENAME) || ',' ||
      '"ESID":'     || JSON_STRING(BIH_ESID) || ',' ||
      '"DATEFC":' || JSON_DATE(BIH_DATEFC) || ',' ||
      '"DATELC":' || JSON_DATE(BIH_DATELC) || ',' ||
      '"RECCOUNT":' || JSON_NUMBER(BIH_RECCOUNT) || ',' ||
      '"ERRCOUNT":' || JSON_NUMBER(BIH_ERRCOUNT)
      as BIH_CONTEXT
    from BIHEADER
    where BIH_DATETIME >= sysdate - max_age_minutes/minutes_per_day
    and BIH_DATETIME < sysdate - min_age_minutes/minutes_per_day
    and BIH_SRCTYPE = 'ISRV'
    and BIH_MAPID in('MBS_CO','MVP_CO')
    and BIH_ESID IN ('RDY','ERR')
    and BIH_RECCOUNT > 0
    and BIH_ID not in (
        select DISTINCT BDK_BIHID
        from BDKPI
        where BDK_DATETIME >= sysdate - max_age_minutes/minutes_per_day
        and BDK_PACID = SQLT_STR_PACID
    )
    order by 1 asc
    ;
    cFileCandRow cFileCand%rowtype;

    start_time  DATE;
    end_time    DATE;
BEGIN
    start_time := sysdate;
    end_time := start_time + max_proc_seconds/seconds_per_day;
    SQLT_INT_ERROR := 0;
    SQLT_STR_ERRORMSG := '';
    SQLT_INT_RECORDS := 0;
    SQLT_INT_RETSTATUS := PKG_COMMON.RETURN_STATUS_OK;        -- assume this for now

    OPEN cFileCand();
    FETCH cFileCand into cFileCandRow;
    if cFileCand%Found then
        PKG_COMMON_PACKING.INSERT_BOHEADER_SPTRY(SQLT_STR_PACID, SQLT_STR_BOHID);
        LOOP
            DO_WORK(
              SQLT_STR_PACID
            , cFileCandRow.BIH_ID
            , cFileCandRow.BIH_DATETIME
            , cFileCandRow.BIH_CONTEXT
            );
            SQLT_INT_RECORDS := SQLT_INT_RECORDS + cFileCandRow.BIH_RECCOUNT;
            COMMIT WORK;
            EXIT WHEN sysdate > end_time;
            FETCH cFileCand into cFileCandRow;
            EXIT WHEN cFileCand%NotFound;
        END LOOP;
    end if;
    CLOSE cFileCand;

exception

    when PKG_COMMON.EXCP_INCONVENIENT_TIME then
        SQLT_INT_ERROR := PKG_COMMON.ENO_INCONVENIENT_TIME;
        SQLT_STR_ERRORMSG := PKG_COMMON.EDESC_INCONVENIENT_TIME;
        SQLT_INT_RETSTATUS := PKG_COMMON.RETURN_STATUS_SUSPENDED;
        ROLLBACK;
/*
    when PKG_COMMON_PACKING.EXCP_STATISTICS_FAILURE then
        ErrorCode := PKG_COMMON_PACKING.ENO_STATISTICS_FAILURE;
        ErrorMsg := PKG_COMMON_PACKING.EDESC_STATISTICS_FAILURE;
        ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
        ROLLBACK;
    when PKG_COMMON_PACKING.EXCP_WORKFLOW_ABORT then
        ErrorCode := PKG_COMMON_PACKING.ENO_WORKFLOW_ABORT;
        ErrorMsg := PKG_COMMON_PACKING.EDESC_WORKFLOW_ABORT;
        ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
        ROLLBACK;
    when Others then
        ErrorCode := SqlCode;
        ErrorMsg  := SqlErrM;
        ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
        RecordsAffected := 0;
        ROLLBACK;
*/

END SP_TRY_KPI;


End; -- Package Body PKG_KPI_BD

/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- PKG_KPI_BD1  (Package Body) 
--
CREATE OR REPLACE PACKAGE BODY SBS1_ADMIN.pkg_kpi_bd1 as

-- MODIFICATION HISTORY
-- Person   Date        Comments
-- -------------------  ------------------------------------------
-- 001SO    13.11.2017  Create for Project SBS-17.08 Technical_Application_KPI_Plotter
-- 002SO    14.11.2017  First realistic KPI calculation, shortened context attribute names
-- 003SO    15.11.2017  Hint BDETAIL1 Queries

    max_age_minutes     CONSTANT INTEGER    := 30;
    min_age_minutes     CONSTANT INTEGER    := 1;
    minutes_per_day     CONSTANT INTEGER    := 1440;
    max_proc_seconds    CONSTANT INTEGER    := 60;
    seconds_per_day     CONSTANT INTEGER    := 86400;


procedure DO_WORK (
      SQLT_STR_PACID IN varchar2
    , SQLT_STR_BIHID IN varchar2
    , SQLT_DAT_DATETIME IN DATE
    , SQLT_STR_CONTEXT IN varchar2
)
IS
BEGIN
    INSERT INTO BDKPI (
      BDK_ID, BDK_DATETIME, BDK_PACID, BDK_SCHEMA, BDK_TABLE, BDK_BIHID
    , BDK_CODE
    , BDK_VALUE
    , BDK_CVALUE
    )(
    SELECT
      GenerateBase36KpiKey(), SQLT_DAT_DATETIME, SQLT_STR_PACID, 'SBS1', 'BDETAIL1', SQLT_STR_BIHID
    , KPI_CODE
    , round(KPI_VALUE,4)
    , '{' ||
      '"CODE":' || JSON_STRING(KPI_CODE) || ',' ||
      '"VALUE":' || JSON_NUMBER(round(KPI_VALUE,4)) || ',' ||
      SQLT_STR_CONTEXT ||
      '}'                                                                       -- 002SO
    FROM
    ( select /*+ INDEX (BDETAIL1 IDX_BD_BIHID1) */                              -- 003SO ff.
      -- Average LA transport Cost for Tariff h and i  
        'Bd1PriceLaTar(hi)'             as KPI_CODE
      , AVG(BD_AMOUNTTR)                as KPI_VALUE
      from  BDETAIL1
      where BD_MAPSID = 'R'
      and   BD_TARID in ('h','i')
      and   BD_ORIG_ESME_ID IS NOT NULL
      and   BD_GENERATED = 0
      and   BD_DATETIME >= sysdate - 1
      and   BD_BIHID = SQLT_STR_BIHID
      UNION
      select /*+ INDEX (BDETAIL1 IDX_BD_BIHID1) */
      -- Average LA Transport Cost for Tariffs (ABabcdefg)  
        'Bd1PriceLaTar(ABabcdefg)'      as KPI_CODE
      , AVG(BD_AMOUNTTR)                as KPI_VALUE
      from  BDETAIL1
      where BD_MAPSID = 'R'
      and   BD_TARID in ('A','B','a','b','c','d','e','f','g')
      and   BD_ORIG_ESME_ID IS NOT NULL
      and   BD_GENERATED = 0
      and   BD_DATETIME >= sysdate - 1
      and   BD_BIHID = SQLT_STR_BIHID
      UNION
      select /*+ INDEX (BDETAIL1 IDX_BD_BIHID1) */
      -- Percentage of Zero Transport Cost   
        'Bd1RateLa(Prc=0)'              as KPI_CODE
      , case
        when COUNT(*) = 0 then NULL
        else SUM(DECODE(BD_AMOUNTTR,0,1,NULL,1,0)) / COUNT(*)
        end                             as KPI_VALUE
      from  BDETAIL1
      where BD_MAPSID = 'R'
      and   BD_ORIG_ESME_ID IS NOT NULL
      and   BD_GENERATED = 0
      and   BD_DATETIME >= sysdate - 1
      and   BD_BIHID = SQLT_STR_BIHID
      UNION
      select /*+ INDEX (BDETAIL1 IDX_BD_BIHID1) */
      -- Percentage of A2FIXNET CDRs   
        'Bd1RateLa(a2fix)'              as KPI_CODE
      , case
        when COUNT(*) = 0 then NULL
        else SUM(DECODE(BD_DELIVER_ESME_ID,'50542',1,'50541',1,0)) / COUNT(*)
        end                             as KPI_VALUE
      from  BDETAIL1
      where BD_MAPSID = 'R'
      and   BD_ORIG_ESME_ID IS NOT NULL
      and   BD_GENERATED = 0
      and   BD_DATETIME >= sysdate - 1
      and   BD_BIHID = SQLT_STR_BIHID
      UNION
      select /*+ INDEX (BDETAIL1 IDX_BD_BIHID1) */
      -- Percentage of FIXNET A2A CDRs   
        'Bd1RateLa(a2a,not fix)'        as KPI_CODE
      , case
        when COUNT(*) = 0 then NULL
        else SUM(DECODE(BD_DELIVER_ESME_ID,NULL,0,'50542',0,'50541',0,1)) / COUNT(*)
        end                             as KPI_VALUE
      from  BDETAIL1
      where BD_MAPSID = 'R'
      and   BD_ORIG_ESME_ID IS NOT NULL
      and   BD_GENERATED = 0
      and   BD_DATETIME >= sysdate - 1
      and   BD_BIHID = SQLT_STR_BIHID
      UNION
      select /*+ INDEX (BDETAIL1 IDX_BD_BIHID1) */
      -- Percentage of billed P2P OnNet CDRs   
        'Bd1RateMoBilled(p2p)'          as KPI_CODE
      , case
        when COUNT(*) = 0 then NULL
        else SUM(DECODE(BD_BILLED, '1',1,0)) / COUNT(*)
        end                             as KPI_VALUE
      from  BDETAIL1
      where BD_MAPSID = 'R'
      and   BD_ORIG_ESME_ID IS NULL
      and   BD_DELIVER_ESME_ID IS NULL
      and   BD_CDRTID not in ('SMS-ORMO','IMS-ORMO')
      and   BD_GENERATED = 0
      and   BD_DATETIME >= sysdate - 1
      and   BD_BIHID = SQLT_STR_BIHID
      UNION
      select /*+ INDEX (BDETAIL1 IDX_BD_BIHID1) */
      -- Percentage of billed P2P roaming CDRs   
        'Bd1RateMoBilled(p2p roaming)'  as KPI_CODE
      , case
        when COUNT(*) = 0 then NULL
        else SUM(DECODE(BD_BILLED, '1',1,0)) / COUNT(*)
        end                             as KPI_VALUE
      from  BDETAIL1
      where BD_MAPSID = 'R'
      and   BD_ORIG_ESME_ID IS NULL
      and   BD_DELIVER_ESME_ID IS NULL
      and   BD_CDRTID in ('SMS-ORMO','IMS-ORMO')
      and   BD_GENERATED = 0
      and   BD_DATETIME >= sysdate - 1
      and   BD_BIHID = SQLT_STR_BIHID
      UNION
      select /*+ INDEX (BDETAIL1 IDX_BD_BIHID1) */
      -- Percentage of billed P2A OnNet CDRs   
        'Bd1RateMoBilled(p2a)'          as KPI_CODE
      , case
        when COUNT(*) = 0 then NULL
        else SUM(DECODE(BD_BILLED, '1',1,0)) / COUNT(*)
        end                             as KPI_VALUE
      from  BDETAIL1
      where BD_MAPSID = 'R'
      and   BD_ORIG_ESME_ID IS NULL
      and   BD_DELIVER_ESME_ID IS NOT NULL
      and   BD_CDRTID not in ('SMS-ORMO','IMS-ORMO')
      and   BD_GENERATED = 0
      and   BD_DATETIME >= sysdate - 1
      and   BD_BIHID = SQLT_STR_BIHID
      UNION
      select /*+ INDEX (BDETAIL1 IDX_BD_BIHID1) */
      -- Percentage of billed P2A roaming CDRs   
        'Bd1RateMoBilled(p2a roaming)'  as KPI_CODE
      , case
        when COUNT(*) = 0 then NULL
        else SUM(DECODE(BD_BILLED, '1',1,0)) / COUNT(*)
        end                             as KPI_VALUE
      from  BDETAIL1
      where BD_MAPSID = 'R'
      and   BD_ORIG_ESME_ID IS NULL
      and   BD_DELIVER_ESME_ID IS NOT NULL
      and   BD_CDRTID in ('SMS-ORMO','IMS-ORMO')
      and   BD_GENERATED = 0
      and   BD_DATETIME >= sysdate - 1
      and   BD_BIHID = SQLT_STR_BIHID
      UNION
      select /*+ INDEX (BDETAIL1 IDX_BD_BIHID1) */
      -- Percentage of billed P2A IMS OnNet CDRs   
        'Bd1RateMo(p2p ims)'            as KPI_CODE
      , case
        when COUNT(*) = 0 then NULL
        else SUM(DECODE(BD_CDRTID || BD_BILLED, 'IMS-MO1',1,0)) / COUNT(*)
        end                             as KPI_VALUE
      from  BDETAIL1
      where BD_MAPSID = 'R'
      and   BD_ORIG_ESME_ID IS NULL
      and   BD_DELIVER_ESME_ID IS NULL
      and   BD_CDRTID not in ('SMS-ORMO','IMS-ORMO')
      and   BD_GENERATED = 0
      and   BD_DATETIME >= sysdate - 1
      and   BD_BIHID = SQLT_STR_BIHID
      UNION
      select /*+ INDEX (BDETAIL1 IDX_BD_BIHID1) */
      -- Percentage of billed P2A IMS roaming CDRs   
        'Bd1RateMo(p2a ims)'            as KPI_CODE
      , case
        when COUNT(*) = 0 then NULL
        else SUM(DECODE(BD_CDRTID || BD_BILLED, 'IMS-MO1',1,0)) / COUNT(*)
        end                             as KPI_VALUE
      from  BDETAIL1
      where BD_MAPSID = 'R'
      and   BD_ORIG_ESME_ID IS NULL
      and   BD_DELIVER_ESME_ID IS NOT NULL
      and   BD_CDRTID not in ('SMS-ORMO','IMS-ORMO')
      and   BD_GENERATED = 0
      and   BD_DATETIME >= sysdate - 1
      and   BD_BIHID = SQLT_STR_BIHID
      UNION
      select /*+ INDEX (BDETAIL1 IDX_BD_BIHID1) */
      -- Percentage of billed P2P IMS roaming CDRs   
        'Bd1RateMo(p2p ims roaming)'    as KPI_CODE
      , case
        when COUNT(*) = 0 then NULL
        else SUM(DECODE(BD_CDRTID || BD_BILLED, 'IMS-ORMO1',1,0)) / COUNT(*)
        end                             as KPI_VALUE
      from  BDETAIL1
      where BD_MAPSID = 'R'
      and   BD_ORIG_ESME_ID IS NULL
      and   BD_DELIVER_ESME_ID IS NULL
      and   BD_CDRTID in ('SMS-ORMO','IMS-ORMO')
      and   BD_DATETIME >= sysdate - 1
      and   BD_BIHID = SQLT_STR_BIHID
      UNION
      select /*+ INDEX (BDETAIL1 IDX_BD_BIHID1) */
      -- Percentage of billed P2A IMS roaming CDRs   
        'Bd1RateMo(p2a ims roaming)'    as KPI_CODE
      , case
        when COUNT(*) = 0 then NULL
        else SUM(DECODE(BD_CDRTID || BD_BILLED, 'IMS-ORMO1',1,0)) / COUNT(*)
        end                             as KPI_VALUE
      from  BDETAIL1
      where BD_MAPSID = 'R'
      and   BD_ORIG_ESME_ID IS NULL
      and   BD_DELIVER_ESME_ID IS NOT NULL
      and   BD_CDRTID in ('SMS-ORMO','IMS-ORMO')
      and   BD_DATETIME >= sysdate - 1
      and   BD_BIHID = SQLT_STR_BIHID
      UNION
      select /*+ INDEX (BDETAIL1 IDX_BD_BIHID1) */
      -- Percentage of Error CDRs   
        'Bd1RateError'                  as KPI_CODE
      , case
        when COUNT(*) = 0 then NULL
        else SUM(DECODE(BD_MAPSID, 'R',0,1)) / COUNT(*)
        end                             as KPI_VALUE
      from  BDETAIL1
      where BD_MAPSID in ('R','E')
      and   BD_DATETIME >= sysdate - 1
      and   BD_BIHID = SQLT_STR_BIHID
      UNION
      select /*+ INDEX (BDETAIL1 IDX_BD_BIHID1) */
      -- Percentage of Unknown Subscriber MO CDRs   
        'Bd1RateUnknown'                as KPI_CODE
      , case
        when COUNT(*) = 0 then NULL
        else SUM(DECODE(BD_PREPAID, 'U',1,NULL,1,0)) / COUNT(*)
        end                             as KPI_VALUE
      from  BDETAIL1
      where BD_MAPSID in ('R','E')
      and   BD_ORIG_ESME_ID IS NULL
      and   BD_DATETIME >= sysdate - 1
      and   BD_BIHID = SQLT_STR_BIHID
    )
    );
END;

procedure SP_TRY_KPI
(
    SQLT_STR_PACID        IN      varchar2,       -- 'KPI000' ... 'KPI999'
    SQLT_STR_BOHID        IN OUT  varchar2,
    SQLT_INT_RECORDS      OUT     number,
    SQLT_INT_ERROR        OUT     number,
    SQLT_STR_ERRORMSG     OUT     varchar2,
    SQLT_INT_RETSTATUS    OUT     number
)
Is

    CURSOR cFileCand
    IS
    select
      BIH_ID
    , BIH_DATETIME
    , BIH_RECCOUNT
    , '"FILENAME":' || JSON_STRING(BIH_FILENAME) || ',' ||
      '"ESID":'     || JSON_STRING(BIH_ESID) || ',' ||
      '"DATEFC":' || JSON_DATE(BIH_DATEFC) || ',' ||
      '"DATELC":' || JSON_DATE(BIH_DATELC) || ',' ||
      '"RECCOUNT":' || JSON_NUMBER(BIH_RECCOUNT) || ',' ||
      '"ERRCOUNT":' || JSON_NUMBER(BIH_ERRCOUNT)
      as BIH_CONTEXT
    from BIHEADER
    where BIH_DATETIME >= sysdate - max_age_minutes/minutes_per_day
    and BIH_DATETIME < sysdate - min_age_minutes/minutes_per_day
    and BIH_SRCTYPE = 'SMSN'
    and BIH_MAPID like 'SMCH__'
    and BIH_ESID IN ('RDY','ERR')
    and BIH_RECCOUNT > 0
    and BIH_ID not in (
        select DISTINCT BDK_BIHID
        from BDKPI
        where BDK_DATETIME >= sysdate - max_age_minutes/minutes_per_day
        and BDK_PACID = SQLT_STR_PACID
    )
    order by 1 asc
    ;
    cFileCandRow cFileCand%rowtype;

    start_time  DATE;
    end_time    DATE;
BEGIN
    start_time := sysdate;
    end_time := start_time + max_proc_seconds/seconds_per_day;
    SQLT_INT_ERROR := 0;
    SQLT_STR_ERRORMSG := '';
    SQLT_INT_RECORDS := 0;
    SQLT_INT_RETSTATUS := PKG_COMMON.RETURN_STATUS_OK;        -- assume this for now

    OPEN cFileCand();
    FETCH cFileCand into cFileCandRow;
    if cFileCand%Found then
        PKG_COMMON_PACKING.INSERT_BOHEADER_SPTRY(SQLT_STR_PACID, SQLT_STR_BOHID);
        LOOP
            DO_WORK(
              SQLT_STR_PACID
            , cFileCandRow.BIH_ID
            , cFileCandRow.BIH_DATETIME
            , cFileCandRow.BIH_CONTEXT
            );
            SQLT_INT_RECORDS := SQLT_INT_RECORDS + cFileCandRow.BIH_RECCOUNT;
            COMMIT WORK;
            EXIT WHEN sysdate > end_time;
            FETCH cFileCand into cFileCandRow;
            EXIT WHEN cFileCand%NotFound;
        END LOOP;
    end if;
    CLOSE cFileCand;

exception

    when PKG_COMMON.EXCP_INCONVENIENT_TIME then
        SQLT_INT_ERROR := PKG_COMMON.ENO_INCONVENIENT_TIME;
        SQLT_STR_ERRORMSG := PKG_COMMON.EDESC_INCONVENIENT_TIME;
        SQLT_INT_RETSTATUS := PKG_COMMON.RETURN_STATUS_SUSPENDED;
        ROLLBACK;
/*
    when PKG_COMMON_PACKING.EXCP_STATISTICS_FAILURE then
        ErrorCode := PKG_COMMON_PACKING.ENO_STATISTICS_FAILURE;
        ErrorMsg := PKG_COMMON_PACKING.EDESC_STATISTICS_FAILURE;
        ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
        ROLLBACK;
    when PKG_COMMON_PACKING.EXCP_WORKFLOW_ABORT then
        ErrorCode := PKG_COMMON_PACKING.ENO_WORKFLOW_ABORT;
        ErrorMsg := PKG_COMMON_PACKING.EDESC_WORKFLOW_ABORT;
        ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
        ROLLBACK;
    when Others then
        ErrorCode := SqlCode;
        ErrorMsg  := SqlErrM;
        ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
        RecordsAffected := 0;
        ROLLBACK;
*/

END SP_TRY_KPI;


End; -- Package Body PKG_KPI_BD1

/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- PKG_KPI_BD2  (Package Body) 
--
CREATE OR REPLACE PACKAGE BODY SBS1_ADMIN.pkg_kpi_bd2 as

-- MODIFICATION HISTORY
-- Person   Date        Comments
-- -------------------  ------------------------------------------
-- 001SO    14.11.2017  Create for Project SBS-17.08 Technical_Application_KPI_Plotter
-- 002SO    15.11.2017  Hint BDETAIL2 Queries
-- 003SO    29.11.2018  New KPI Item 'Bd2RateMtOutCh'   Percentage of IMS CH MT Delivery CDRs to total CH delivery CDRs
-- 004SO    29.11.2018  New KPI Item 'Bd2RateMtOutRoam' Percentage of IMS Roaming MT Delivery CDRs to total Roaming delivery CDRs


    max_age_minutes     CONSTANT INTEGER    := 30;
    min_age_minutes     CONSTANT INTEGER    := 1;
    minutes_per_day     CONSTANT INTEGER    := 1440;
    max_proc_seconds    CONSTANT INTEGER    := 60;
    seconds_per_day     CONSTANT INTEGER    := 86400;


procedure DO_WORK (
      SQLT_STR_PACID IN varchar2
    , SQLT_STR_BIHID IN varchar2
    , SQLT_DAT_DATETIME IN DATE
    , SQLT_STR_CONTEXT IN varchar2
)
IS
BEGIN
    INSERT INTO BDKPI (
      BDK_ID, BDK_DATETIME, BDK_PACID, BDK_SCHEMA, BDK_TABLE, BDK_BIHID
    , BDK_CODE
    , BDK_VALUE
    , BDK_CVALUE
    )(
    SELECT
      GenerateBase36KpiKey(), SQLT_DAT_DATETIME, SQLT_STR_PACID, 'SBS1', 'BDETAIL2', SQLT_STR_BIHID
    , KPI_CODE
    , round(KPI_VALUE,4)
    , '{' ||
      '"CODE":' || JSON_STRING(KPI_CODE) || ',' ||
      '"VALUE":' || JSON_NUMBER(round(KPI_VALUE,4)) || ',' ||
      SQLT_STR_CONTEXT ||
      '}'
    FROM
    ( select /*+ INDEX (BDETAIL2 IDX_BD_BIHID2) */                              -- 002SO ff.
      -- Percentage of Home Routed P2P CDRs
        'Bd2RateHr(p2p)'                as KPI_CODE
      , case
        when COUNT(*) = 0 then NULL
        else SUM(DECODE(BD_CDRTID,'SMS-HR',1,0)) / COUNT(*)
        end                             as KPI_VALUE
      from  BDETAIL2
      where BD_MAPSID = 'R'
      and   BD_ORIG_ESME_ID IS NULL
      and   BD_DELIVER_ESME_ID IS NULL
      and   BD_STATUS = 0
      and   BD_GENERATED = 0
      and   BD_DATETIME >= sysdate - 1
      and   BD_BIHID = SQLT_STR_BIHID
      UNION
      select /*+ INDEX (BDETAIL2 IDX_BD_BIHID2) */
      -- Percentage of Home Routed P2A CDRs
        'Bd2RateHr(p2a)'                as KPI_CODE
      , case
        when COUNT(*) = 0 then NULL
        else SUM(DECODE(BD_CDRTID,'SMS-HR',1,0)) / COUNT(*)
        end                             as KPI_VALUE
      from  BDETAIL2
      where BD_MAPSID = 'R'
      and   BD_ORIG_ESME_ID IS NULL
      and   BD_DELIVER_ESME_ID IS NOT NULL
      and   BD_STATUS = 0
      and   BD_GENERATED = 0
      and   BD_DATETIME >= sysdate - 1
      and   BD_BIHID = SQLT_STR_BIHID
      UNION
      select /*+ INDEX (BDETAIL2 IDX_BD_BIHID2) */
      -- Percentage of Home Routed P2P Scenario 1 CDRs with active IW Contract
        'Bd2RateHrScenario1A(p2p)'      as KPI_CODE
      , case
        when COUNT(*) = 0 then NULL
        else SUM(DECODE(BD_IW_SCENARIO||BD_IW_CONSTATE, '1A',1,0)) / COUNT(*)
        end                             as KPI_VALUE
      from  BDETAIL2
      where BD_MAPSID = 'R'
      and   BD_ORIG_ESME_ID IS NULL
      and   BD_DELIVER_ESME_ID IS NULL
      and   BD_CDRTID = 'SMS-HR'
      and   BD_STATUS = 0
      and   BD_GENERATED = 0
      and   BD_DATETIME >= sysdate - 1
      and   BD_BIHID = SQLT_STR_BIHID
      UNION
      select /*+ INDEX (BDETAIL2 IDX_BD_BIHID2) */
      -- Percentage of Home Routed P2A Scenario 1 CDRs with active IW Contract
        'Bd2RateHrScenario1A(p2a)'      as KPI_CODE
      , case
        when COUNT(*) = 0 then NULL
        else SUM(DECODE(BD_IW_SCENARIO||BD_IW_CONSTATE, '1A',1,0)) / COUNT(*)
        end                             as KPI_VALUE
      from  BDETAIL2
      where BD_MAPSID = 'R'
      and   BD_ORIG_ESME_ID IS NULL
      and   BD_DELIVER_ESME_ID IS NOT NULL
      and   BD_CDRTID = 'SMS-HR'
      and   BD_STATUS = 0
      and   BD_GENERATED = 0
      and   BD_DATETIME >= sysdate - 1
      and   BD_BIHID = SQLT_STR_BIHID
      UNION
      select /*+ INDEX (BDETAIL2 IDX_BD_BIHID2) */
      -- Percentage of Home Routed Scenario 5 CDRs
        'Bd2RateHrScenario5'      as KPI_CODE
      , case
        when COUNT(*) = 0 then NULL
        else SUM(DECODE(BD_IW_SCENARIO, '5',1,0)) / COUNT(*)
        end                             as KPI_VALUE
      from  BDETAIL2
      where BD_MAPSID = 'R'
      and   BD_CDRTID = 'SMS-HR'
      and   BD_STATUS = 0
      and   BD_GENERATED = 0
      and   BD_DATETIME >= sysdate - 1
      and   BD_BIHID = SQLT_STR_BIHID
      UNION
      select /*+ INDEX (BDETAIL2 IDX_BD_BIHID2) */
      -- Percentage of Home Routed CDRs to Inactive IW Contracts
        'Bd2RateHrInactive'             as KPI_CODE
      , case
        when COUNT(*) = 0 then NULL
        else SUM(DECODE(BD_IW_CONSTATE, 'I',1,0)) / COUNT(*)
        end                             as KPI_VALUE
      from  BDETAIL2
      where BD_MAPSID = 'R'
      and   BD_CDRTID = 'SMS-HR'
      and   BD_STATUS = 0
      and   BD_GENERATED = 0
      and   BD_DATETIME >= sysdate - 1
      and   BD_BIHID = SQLT_STR_BIHID
      UNION
      select /*+ INDEX (BDETAIL2 IDX_BD_BIHID2) */
      -- Percentage of Error CDRs
        'Bd2RateError'                  as KPI_CODE
      , case
        when COUNT(*) = 0 then NULL
        else SUM(DECODE(BD_MAPSID, 'R',0,1)) / COUNT(*)
        end                             as KPI_VALUE
      from  BDETAIL2
      where BD_MAPSID in ('R','E')
      and   BD_DATETIME >= sysdate - 1
      and   BD_BIHID = SQLT_STR_BIHID
      UNION
      select /*+ INDEX (BDETAIL2 IDX_BD_BIHID2) */
      -- Percentage of Expired P2P CDRs
        'Bd2RateExpired(p2p)'           as KPI_CODE
      , case
        when COUNT(*) = 0 then NULL
        else SUM(DECODE(BD_STATUS, '1',1,0)) / COUNT(*)
        end                             as KPI_VALUE
      from  BDETAIL2
      where BD_MAPSID in ('R','E')
      and   BD_ORIG_ESME_ID IS NULL
      and   BD_DELIVER_ESME_ID IS NULL
      and   BD_DATETIME >= sysdate - 1
      and   BD_BIHID = SQLT_STR_BIHID
      UNION
      select /*+ INDEX (BDETAIL2 IDX_BD_BIHID2) */
      -- Percentage of Expired P2A CDRs
        'Bd2RateExpired(p2a)'           as KPI_CODE
      , case
        when COUNT(*) = 0 then NULL
        else SUM(DECODE(BD_STATUS, '1',1,0)) / COUNT(*)
        end                             as KPI_VALUE
      from  BDETAIL2
      where BD_MAPSID in ('R','E')
      and   BD_ORIG_ESME_ID IS NULL
      and   BD_DELIVER_ESME_ID IS NOT NULL
      and   BD_DATETIME >= sysdate - 1
      and   BD_BIHID = SQLT_STR_BIHID
      UNION
      select /*+ INDEX (BDETAIL2 IDX_BD_BIHID2) */                              -- 003SO
      -- Percentage of IMS CH MT Delivery CDRs to total CH delivery CDRs
        'Bd2RateMtOut(ch)'           as KPI_CODE
      , case
        when COUNT(*) = 0 then NULL
        else SUM(DECODE(BD_PACIDHB,'MOSMS3CH', 1,0)) / COUNT(*)
        end                             as KPI_VALUE
      from  BDETAIL2
      where BD_MAPSID in ('R','E')
      and   BD_STATUS = 0
      and   BD_DATETIME >= sysdate - 1
      and   BD_BIHID = SQLT_STR_BIHID
      UNION      
      select /*+ INDEX (BDETAIL2 IDX_BD_BIHID2) */                              -- 004SO
      -- Percentage of IMS Roaming MT Delivery CDRs to total Roaming delivery CDRs
        'Bd2RateMtOut(roaming)'         as KPI_CODE
      , case
        when COUNT(*) = 0 then NULL
        else SUM(DECODE(BD_PACIDHB,'MOSMS4CH', 1,0)) / COUNT(*)
        end                             as KPI_VALUE
      from  BDETAIL2
      where BD_MAPSID in ('R','E')
      and   BD_STATUS = 0
      and   BD_DATETIME >= sysdate - 1
      and   BD_BIHID = SQLT_STR_BIHID
    )
    );
END;

procedure SP_TRY_KPI
(
    SQLT_STR_PACID        IN      varchar2,       -- 'KPI000' ... 'KPI999'
    SQLT_STR_BOHID        IN OUT  varchar2,
    SQLT_INT_RECORDS      OUT     number,
    SQLT_INT_ERROR        OUT     number,
    SQLT_STR_ERRORMSG     OUT     varchar2,
    SQLT_INT_RETSTATUS    OUT     number
)
Is

    CURSOR cFileCand
    IS
    select
      BIH_ID
    , BIH_DATETIME
    , BIH_RECCOUNT
    , '"FILENAME":' || JSON_STRING(BIH_FILENAME) || ',' ||
      '"ESID":'     || JSON_STRING(BIH_ESID) || ',' ||
      '"DATEFC":' || JSON_DATE(BIH_DATEFC) || ',' ||
      '"DATELC":' || JSON_DATE(BIH_DATELC) || ',' ||
      '"RECCOUNT":' || JSON_NUMBER(BIH_RECCOUNT) || ',' ||
      '"ERRCOUNT":' || JSON_NUMBER(BIH_ERRCOUNT)
      as BIH_CONTEXT
    from BIHEADER
    where BIH_DATETIME >= sysdate - max_age_minutes/minutes_per_day
    and BIH_DATETIME < sysdate - min_age_minutes/minutes_per_day
    and BIH_SRCTYPE = 'SMSN'
    and BIH_MAPID like 'SMCH__'
    and BIH_ESID IN ('RDY','ERR')
    and BIH_RECCOUNT > 0
    and BIH_ID not in (
        select DISTINCT BDK_BIHID
        from BDKPI
        where BDK_DATETIME >= sysdate - max_age_minutes/minutes_per_day
        and BDK_PACID = SQLT_STR_PACID
    )
    order by 1 asc
    ;
    cFileCandRow cFileCand%rowtype;

    start_time  DATE;
    end_time    DATE;
BEGIN
    start_time := sysdate;
    end_time := start_time + max_proc_seconds/seconds_per_day;
    SQLT_INT_ERROR := 0;
    SQLT_STR_ERRORMSG := '';
    SQLT_INT_RECORDS := 0;
    SQLT_INT_RETSTATUS := PKG_COMMON.RETURN_STATUS_OK;        -- assume this for now

    OPEN cFileCand();
    FETCH cFileCand into cFileCandRow;
    if cFileCand%Found then
        PKG_COMMON_PACKING.INSERT_BOHEADER_SPTRY(SQLT_STR_PACID, SQLT_STR_BOHID);
        LOOP
            DO_WORK(
              SQLT_STR_PACID
            , cFileCandRow.BIH_ID
            , cFileCandRow.BIH_DATETIME
            , cFileCandRow.BIH_CONTEXT
            );
            SQLT_INT_RECORDS := SQLT_INT_RECORDS + cFileCandRow.BIH_RECCOUNT;
            COMMIT WORK;
            EXIT WHEN sysdate > end_time;
            FETCH cFileCand into cFileCandRow;
            EXIT WHEN cFileCand%NotFound;
        END LOOP;
    end if;
    CLOSE cFileCand;

exception

    when PKG_COMMON.EXCP_INCONVENIENT_TIME then
        SQLT_INT_ERROR := PKG_COMMON.ENO_INCONVENIENT_TIME;
        SQLT_STR_ERRORMSG := PKG_COMMON.EDESC_INCONVENIENT_TIME;
        SQLT_INT_RETSTATUS := PKG_COMMON.RETURN_STATUS_SUSPENDED;
        ROLLBACK;
/*
    when PKG_COMMON_PACKING.EXCP_STATISTICS_FAILURE then
        ErrorCode := PKG_COMMON_PACKING.ENO_STATISTICS_FAILURE;
        ErrorMsg := PKG_COMMON_PACKING.EDESC_STATISTICS_FAILURE;
        ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
        ROLLBACK;
    when PKG_COMMON_PACKING.EXCP_WORKFLOW_ABORT then
        ErrorCode := PKG_COMMON_PACKING.ENO_WORKFLOW_ABORT;
        ErrorMsg := PKG_COMMON_PACKING.EDESC_WORKFLOW_ABORT;
        ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
        ROLLBACK;
    when Others then
        ErrorCode := SqlCode;
        ErrorMsg  := SqlErrM;
        ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
        RecordsAffected := 0;
        ROLLBACK;
*/

END SP_TRY_KPI;


End; -- Package Body PKG_KPI_BD2
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- PKG_MEC_HB  (Package Body) 
--
CREATE OR REPLACE PACKAGE BODY SBS1_ADMIN.PKG_MEC_HB
IS
--
-- Purpose:
-- Message Event Consolidation DUMMY package for SBS1 Database
-- Referenced by PKG_MEC_IC
--
-- MODIFICATION HISTORY see Package Body on SBS0

END;
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- PKG_MEC_IC_ASCII0  (Package Body) 
--
CREATE OR REPLACE PACKAGE BODY SBS1_ADMIN.PKG_MEC_IC_ASCII0
IS
--
-- Purpose:
-- Message Event Consolidation Input Converter
-- Putting ASCII-Data from MEC Handler into SBS1
-- Old interface solution with bookkeeping from DB (RecCount, DateFc, DateLc)
--
-- MODIFICATION HISTORY
-- Person       Date        Comments
-- ---------    ----------  ------------------------------------------
-- 001SO        25.11.2003  Moved several procedures here from PKG_MEC
-- 002AA        04.12.2003  Added SP_INSERT_MEC, SP_UPDATE_BIHEADER_MEC and CutFirstItem procedures/functions
-- 003AA        19.12.2003  Using newly added Type and its declarations for Billing details tables (bdetail, bdetail1, ...)
-- 004AA        07.01.2004  Added Price Model Version Id field to the MSC and MMSC ascii0 formats, extracted and stored in corresponding tables, bdetail4 and bdetail6 tables
-- 005AA        07.01.2004  Updated SP_UPDATE_BIHEADER_MEC to set the Mapping State and BiHeader details separately for each BDetail table depending on the Source Type
-- 006AA(016SO) 09.01.2004  Adding Transport cost calculation for MMSC CDRs (TransportCost and TransportCount added for MMSC)
-- 007AA        09.01.2004  Added Interworking Contract Id field to the MSC ascii0 formats, extracted and stored in corresponding tables, bdetail6 tables (VER.1.0.3)
-- 008AA(020AA) 09.01.2004  Added new fields to the MMSC input interface stored procedure and Ascii0 format (MM7LinkedID, PrepaidFreeText, PromotionPlan, TariffClass, RoamingInfo, DestinationImsi)
-- 009AA        19.01.2004  Added INSERT_MEC_MBS stored procedure for importing Mbs Ascii0 data into transaction table
-- 010AA        20.01.2004  Added INSERT_MEC_OTA stored procedure for importing OTA Ascii0 data into transaction table
-- 011AA        21.01.2004  Added INSERT_MEC_SMSC stored procedure for importing SMSC Ascii0 data into transaction table
-- 012AA        29.01.2004  Added CdrTypeId to OTA and SMSC imports, Added BD_IW and BD_INT to Smsc insert
-- 013AA        30.01.2004  Update the mapping state in the Bdetail2 table along with Bdetail1 (SMSC source type)
-- 014SO        25.02.2004  Correcting bug in iServer ascii parsing
-- 015SO        26.02.2004  Adding error handling in SP_INSERT_MEC
-- 016SO        01.03.2004  Reassigning the schedule flags is unnecessary 'S' should be the only possible value in ASCII0 file
-- 017SO        01.03.2004  Inserting SmsTariff from SMSC ASCII0
-- 018SO        01.03.2004  Inserting analysis fields into BDETAIL for iServer
-- 019SO        01.03.2004  Inserting SmsTariff from MSC ASCII0
-- 020SO        01.03.2004  Insert oCdrInfo.ContractSubType from OTA/ISRV/MBS ASCII0 (to be consistent with iServer and MBS)
-- 021SO        01.04.2004  Add TopStop check/update for Content Services
-- 022SO        05.04.2004  Add SP_DELETE_BDETAIL_MEC
-- 023SO        11.05.2004  Hinting in SP_DELETE_BDETAIL_MEC
-- 024AA        28.05.2004  Added insert of new MMSC version of Ascii0 (cAscii0VersionMmsc_01_00_04)
-- 025AA        18.06.2004  Added DateTime timestamp member to the MEC Structure
-- 026SO        04.07.244   Change max Length of MMS RoamingInfo Field from 10 to 20
-- 027SO        04.07.2004  Add RecipIndex to MMSC interface and to MEC Structure
-- 028SO        05.07.2004  Replace RoamingZone by RoamingZone1 and add RoamingZone2
-- 029SO        06.07.2004  Rename fileds in BDETAIL6:  BD_AMOUNTPV to BD_RETSHAREPV and BD_AMOUNTMO to BD_RETSHAREMO
-- 030SO        06.07.2004  Rename MEC structure var CdrBilling to CdrBilled
-- 031SO        07.07.2004  Support for SMSC ASCII0 version cAscii0VersionSmsc_01_00_02 (MERGED IN)
-- 032SO        19.08.2004  Making oCdrInfo.TransportCost numeric, removing "to_number("
-- 033SO        28.08.2004  Removing AAA TopStop Update from MEC_IC (now done in MEC Handler)
-- 034SO        31.08.2004  Schedule Revenue Assurance Analysis for all files input by MEC_IC
-- 035SO        31.08.2004  Merge UPDATE_BIHEADER statements where possible
-- 036AA        01.09.2004  Added INSERT_MEC_POS and updated related stored procedures
-- 037SO        03.09.2004  Replacing all references PKG_MEC to PKG_MEC_HB
-- 038SO        27.09.2004  Schedule MMS Sync output
-- 039SO        25.11.2004  Correct Submit Timestamp for MMS MM4 Output CDRs (take from  originating record)
-- 040AA        13.12.2004  Update the ascii0 parsing for new versions of ISRV, MBS, OTA
-- 041SO        10.01.2005  Change in SQL for Submit Timestamp Correction: consider State M in current file
-- 042SO        10.01.2005  Additionally correct Submit Timestamp for MMSRrecords with foreign IMSI (Legacy delivery)
-- 043SO        30.05.2005  Correct and more performant evaluation of record count / success count (add records from BDETAIL2)
-- 044SO        15.08.2006  Introduce OrigSubmitTime and populate for Postpaid SMS when time shifted. Use cAscii0VersionMsc_01_00_04
-- 045SO        01.10.2006  Format Size increases for Karjala 2 MB billing
-- 046SO        07.10.2006  Additional fields for Karjala 2 MB content billing
-- 047SO        08.10.2006  Add INSERT_MEC_MMSB for input conversion of Message Broker MMS CDRs
-- 048SO        09.10.2006  Use typed records for MMSC and MMSB input
-- 049SO        11.10.2006  Add Source Type MMSB to SP_UPDATE_BIHEADER_MEC
-- 050SO        11.10.2006  Move Header Update after BDETAIL update (shorten waiting time)
-- 051SO        08.11.2006  Insert BD_CONSTID for iServer IC
-- 052SO        14.03.2007  Look at total record count before rejecting a file as awhole (ERF)
-- 053SO        06.09.2007  Rename BD_MTARID to BD_TARID
-- 054SO        16.09.2007  Add fields BD_ORIGSUBMIT and BD_BILLID to SMSC tables
-- 055SO        16.09.2007  Get BD_SUBMITTIME for SMSC
-- 056SO        25.09.2007  Add TransportCount for iServer and 3 transport fields for OTA, calculate TCs
-- 057SO        30.09.2007  Use TariffId instead of SmsTariffId and MmsTariffId and Ufih instead of Pos
-- 058SO        17.10.2007  Implement STAN input converter
-- 059SO        17.01.2008  Populate BD_VSPRCID (VAS Statistics Product Channel ID)
-- 060SO        21.01.2008  Schedule VAS Statistics Transfer
-- 061SO        21.01.2008  Schedule mVoting View only if we have Tariff M CDRs
-- 062SO        26.01.2008  Add OriginalSubmitTime for ISRV input
-- 063SO        04.02.2008  Add ProductChannel override by service for ISRV
-- 064SO        11.02.2008  Schedule SMSC for DWH export and MMSC not any more
-- 065SO        24.05.2008  Allow future CDR timestamps up to 1 day ahead of time (for load tests)
-- 066SO        20.06.2008  Include BDETAIL2-Timestamps for First/Last Timestamp evaluation
-- 067AT        27.07.2008  Additional field for VASOL Billing: OnlineCharge
-- 068SO        02.02.2009  Implement new fields for Cardinal SMSC
-- 069SO        02.02.2009  Use DGTI also in BDETAIL1 (home routing SMS might go to BDETAIL1 or to BDETAIL2, tbd)
-- 068SOa       15.01.2009  Extend Lookup for Original Submit Timestamp in MM4Rrecord (Nachtrag)
-- 069SO        23.04.2009  Extend Remark Field for UFIH (STAN)
-- 070SO        22.05.2009  Perform SMSC lookup for home routed SMS in BDETAIL1/2 tables
-- 071SO        02.06.2009  Add SMSC fields OriginatorImsi and PpPser
-- 072SO        09.06.2009  Suppress creation of SMSC ID for home routed SMS
-- 073SO        14.09.2009  Populate archive table for SC terminating IW SMS
-- 074SO        15.09.2009  Correct IW schedule channel (1 instead of 3)
-- 075SO        02.11.2009  Implement SP_INSERT_HEADER by calling PKG_BDETAIL_COMMON
-- 076SO        02.11.2009  Evaluate SrcType from Mapping and rename inputParameter to MapTypeId
-- 077SO        03.11.2009  Remove correction of MM4 submit timestamp done in -- 039SO
-- 078DA        13.11.2009  Return p_ReturnStatus for SP_INSERT_MEC
-- 079DA        25.11.2009  New procedure SP_UPDATE_HEADER with generic interface created
-- 080SO        12.01.2010  Use new InsertBiHeader in Common package
-- 081SO        12.01.2010  Remove SP_DELETE_BDETAIL_MEC
-- 082SO        12.01.2010  Create as new Packege PKG_MEC_IC_ASCII0
-- 083SO        15.01.2010  Eliminate calls to PKG_BDETAIL_COMMON and use PKG_COMMON and PKG_BIHEADER_COMMON instead
-- 084SO        15.01.2010  Rename SP_UPDATE_HEADER_MEC to SP_UPDATE_HEADER
-- 085SO        18.01.2010  Invoke renamed common packages
-- 086SO        18.01.2010  Remove Demo flag from internal interface and rename parameters like in PKG_MEC_IC_CSV
-- 087SO        18.01.2010  Use internal error handling like in PKH_MEC_IC_CSV
-- 088SO        18.01.2010  Remove double checks on p_BdetailTable and rename this parameter to p_DataHeader
-- 089SO        18.01.2010  Change interface to match completely PKG_MEC_IC_CSV
-- 090SO        18.01.2010  Parse Header for getting HIH_ID
-- 091SO        20.01.2010  Define version for ASCII0 format
-- 092SO        20.01.2010  Use DateTime for DateFc / DateLc (SMSC/MMSC/MMSB only)
-- 093SO        20.01.2010  Allow failure in product channel evaluation when no contract found
-- 094DA        21.01.2010  Convert varchar dates to valid date format in SP_UPDATE_HEADER
-- 095SO        25.01.2010  Use standardized hardErrorMessage
-- 096SO        25.01.2010  Use standardized exception for record counter mismatch
-- 096SO        25.01.2010  Move CutFirstItem to PKG_COMMON
-- 097SO        25.01.2010  Move getHeaderField to PKG_COMMON
-- 098SO        26.01.2010  Set date done in Mapping table for tracking purposes
-- 099SO        26.01.2010  Flag rejected CDRs as soft errors, Ignors must not be counted
-- 100SO        06.04.2010  Remove older Logging statements
-- 101SO        12.08.2010  Schedule indexing of MMSC CDRs
-- 102SO        17.01.2011  Suppress registration of new SMSC ID when inbound roaming traffic
-- 103SO        11.03.2011  Insert BD_GART into BDETAIL table for Spenden-SMS Project
-- 104SO        11.04.2011  Insert BD_SHOW and BD_CAMPAIGN into BDETAIL table for Televote Project
-- 105SO        11.09.2011  Insert MSC_ID to SMS IW archive table
-- 106SO        12.09.2011  Correct SMS IW Archiver Bug (swap A and B-Number for home routed SMS)
-- 107SO        14.12.2011  Remove schema qualifier "S B S 0 ."
-- 108SO        06.03.2012  Remove obsolete code for OTA, MBS, MMSB
-- 109SO        14.03.2012  Remove obsolete code for BDITEM
-- 110SO        30.05.2012  Add debugging for ascii IC
-- 111SO        29.01.2013  Extend field BD_MSGID from 20 to 30 Bytes
-- 112SO        16.10.2013  Implement basic IC for M2M
-- 113SO        29.08.2014  Add fields BD_DSER and BD_ORIGSCA to BDETAIL1 and BDETAIL2
-- 114SO        04.09.2014  Add calculated field "generated" to SMSC input converter
-- 115SO        04.09.2014  Add calculated field "generated" to MMSC input converter
-- 116SO        05.09.2014  Correct MMSC IC parser
-- 117SO        07.08.2015  Extend SMSC and M2M IC parser by 2/3 new fields (interworking OpKeys)
-- 118SO        12.08.2015  Extend SMSC and M2M IC parser by ScaOpKey
-- 119SO        20.08.2015  Remove insert into BD_PMVID for SMS (column dropped in BDETAIL1)
-- 120SO        20.08.2015  Clean up CDR structure names
-- 121SO        21.08.2015  Use record struct instead of local variables
-- 122SO        21.08.2015  Register SMSCs for home routed SMS now
-- 123SO        21.08.2015  Remove code for ProductChannelId
-- 124SO        21.08.2015  Remove code for ProductChannelId
-- 125SO        26.08.2015  Add RecipImsi for SMSN (home routed incoming SC address)
-- 126SO        27.08.2015  Add RecipAdr / Npi / Ton for SMSN separately
-- 127SO        22.09.2015  Enable SMSN source type wherever SMSC is enabled
-- 128SO        29.09.2015  Add Interworking fields for M2M / SMSC / SMSN (and MSC with OpKeys)
-- 129SO        29.09.2015  Add BD_MESSAGEREFERENCE to BDETAIL4
-- 130SO        08.10.2015  Fix SMSN IC and improve logging
-- 131SO        20.10.2015  Put Mew SMSC Replace-Submit CDRs into BDETAIL1
-- 132SO        14.12.2015  Add BD_MSISDN_B, BD_NPI_B, BD_TON_B to BDETAIL1 and BDETAIL2 for SMSN
-- 133SO        14.04.2016  Truncate B-Numbers for NewSMSC CDRs
-- 134SO        09.12.2016  Remove some support for SMSC (old Acision specialities)
-- 135SO        09.12.2016  Add Attribute BD_AMOUNTTR for SMSN
-- 136SO        09.12.2016  Add Attribute BD_ORIG_DCS for SMSN
-- 137SO        09.12.2016  Add Attribute BD_ORIG_MSG_ID for SMSN
-- 138SO        01.06.2017  Directly assign OpKey to new SMSC
-- 139SO        13.07.2017  Add SMSC-CDR-Attributes PaniHeader, OrigImei, DeliverImei
-- 140SO        12.01.2018  Rename PaniHeader to OrigPaniHeader
-- 141SO        12.01.2018  Add SMSC-CDR-Attributes DeliverPaniHeader, DeliverMapGti
-- 142SO        26.02.2018  Implement externally routed SMS/Pager under SMSN
-- 143SO        26.02.2018  Change counting of inserted CDRs in order to allow CDR cloning for SMS-EXT and PAGER-EXT
-- 144SO        26.02.2018  Default missing SegmentInformation (in bad external CDRs)
-- 145SO        14.03.2018  Add BIO attributes to ASCII IC (for RCS)
-- 146SO        16.11.2018  Add RVA signatures to BDETAIL, BDETAIL1, 2, 4, 6
-- 147SO        18.11.2018  Add more RVA signature characters (BioReqType, La Handygroup, MoPromotion, Reserve)
-- 148SO        25.11.2018  Provide TariffId 1:1 for MMS Signatures
-- 149SO        26.11.2018  Remove insert into VSHEADER
-- 150SO        30.11.2018  Schedule only needed source types for REVA
-- 151SO        11.01.2019  008936 REVA SMSN Roaming Signature fix
-- 152SO        21.01.2019  Fix Error Count for SMSN Records
-- 153SO        30.01.2019  008958 OrigSmsc Default for M2M


    cstrTab                         Varchar2(1) := Chr(9);

    rSourceType                     PKG_COMMON.tSrcType;                        -- 083SO
    rMappingState                   PKG_COMMON_MAPPING.tMapEsId;                -- 085SO -- 083SO
    rBillingTables                  PKG_MEC_HB.tBillingTables;                  -- 037SO
    rPackingIdTemplates             PKG_MEC_HB.tPackingIdTemplates;             -- 037SO

    cstrMecDateTimeFormat           Varchar2(20) := 'YYYYMMDDHH24MISS';

    cstrFieldSeparator              Varchar(1) := cstrTab;

    -- msc related constants
    cstrMscMobileOriginatingSms     Varchar2(6) := 'MSC-MO';
    cstrMscMobileTerminatingSms     Varchar2(6) := 'MSC-MT';

    -- mmsc related constants
    gcstrOwnMccMnc                  Varchar2(10) := '22801';                    -- 042SO -- MCC and MNC of the system owner (GSM operator)
    cstrMmscCdrRecordType_MMSR      Varchar2(10) := 'MMSR';                     -- 042SO -- MMSRrecord: MM1 Recipient
    cstrMmscCdrRecordType_MM4R      Varchar2(10) := 'MM4R';                     -- MM4Rrecord: MM4 Recipient
    cstrMmscCdrRecordType_ORIG      Varchar2(10) := 'MM_O';                     -- Like Mask for originate records

    cstrCdrTypeHomeRoutedSms        Varchar2(10) := 'SMS-HR';                   -- 070SO

    cintCreateSmscForHomeRoutedSms  Number := 1;                                -- 122SO -- 072SO

    cfltFutureCdrTimeSpan           FLOAT   := 1.0;                             -- 065SO

    cstrMappingStateSuccess         VARCHAR2(1) := 'M';                         -- 099SO

Function AddSmscCodeToUnknownToc (
    p_SMSC_CODE     In      Varchar2
) Return Varchar2
Is
    l_SMSC_ID       Varchar2(10);
    l_CON_OPKEY     Varchar2(10);                                               -- 138SO

Begin

    l_CON_OPKEY := NVL(OPKEY_FROM_GT(p_SMSC_CODE),'0');                         -- 138SO

    Select GenerateUniqueKey('G') Into l_SMSC_ID From Dual;

    Insert Into SMSC (
        SMSC_ID,
        SMSC_CONOPKEY,
        SMSC_CODE,
        SMSC_DATECRE,
        SMSC_ACIDCRE,
        SMSC_CHNGCNT
    )
    Values (
        l_SMSC_ID,
        l_CON_OPKEY,                                                            -- 138SO
        p_SMSC_CODE,
        SYSDATE,
        'ADMIN',
        0
    );
    Return l_SMSC_ID;
End AddSmscCodeToUnknownToc;

Function GetSmscId (
    p_BD_SCA        In      Varchar2,
    p_create        IN      Number
) Return Varchar2
Is
    l_SMSC_CODE     Varchar2(20);
    l_SMSC_ID       Varchar2(10);
    Cursor C1(a_SMSC_CODE Varchar2) Is
        Select SMSC_ID
            From SMSC
            Where SMSC_CODE = a_SMSC_CODE;
Begin
    l_SMSC_CODE := p_BD_SCA;
    Open C1(l_SMSC_CODE);
    Fetch C1 Into l_SMSC_ID;
    If C1%Found Then
        -- Smsc Id for given Code found, do nothing, just return the Smsc Id
        Null;
    Elsif p_create = 1 then                                                 -- 072SO
        -- Smsc Id for given Code not found, do something, add the given Code
        -- to the dummy Operator Contract 'UNKNOWNTOC'. And then return the
        -- Smsc Id of the newly added Smsc Code
        l_SMSC_ID := AddSmscCodeToUnknownToc(l_SMSC_CODE);
    End If;
    Close C1;
    Return l_SMSC_ID;
End GetSmscId;

Function ExtMsgReferenceSuffix(
    p_LogicalSegmentId  IN  number,
    p_PhysicalSegmentId IN  number
)   Return Varchar2
is  -- 142SO
begin
    if p_LogicalSegmentId = 0 then
        return 'E' || to_char(p_PhysicalSegmentId,'000');
    else
        return NULL;
    end if;
end ExtMsgReferenceSuffix;


Procedure INSERT_CSV_MSC (                                               -- 009AA
    p_SrcType               In      Varchar2,
    p_BihId                 In      Varchar2,
    p_DataHeader            In      VarChar2,       -- 086SO
    p_RecordNr              In      Number,         -- 086SO
    p_RecordData            In      Varchar2,       -- 086SO
    p_RecordVersion         In      Varchar2,       -- 086SO
    p_Inserted              Out     Number,         -- 143SO
    p_DateTime              Out     Varchar2,
    p_SoftErrorCount        Out     Number,         -- 152SO
    p_SoftErrorId           Out     Varchar2,
    p_SoftErrDesc           Out     Varchar2
)
Is

    l_RecordData            Varchar2(4000);
    oCdrInfo0               PKG_MEC_HB.tCdrInfo;                                -- 037SO   -- untouched empty copy of the structure
    oCdrInfo                PKG_MEC_HB.tCdrInfo;                                -- 037SO   -- working copy of the structure

    l_ExchangeIdentity      Varchar2(20);
    l_Route                 Varchar2(20);
    l_TeleServiceCode       Varchar2(2);
    l_PowerClass            Varchar2(20);
    l_SmscId                Varchar2(10);

Begin

    p_Inserted := 1;                                                            -- 143SO
    p_DateTime := NULL;
    p_SoftErrorCount := 0;                                                      -- 152SO
    p_SoftErrorId := NULL;
    p_SoftErrDesc := NULL;

    -- get the Ascii0 value containing the tap-separated data
    l_RecordData                    := p_RecordData;
    -- use the PKG_MEC CdrInfo structure to store the read in values
    -- clear the structure for every data row
    oCdrInfo :=oCdrInfo0;
    -- split the values and assign to the CdrInfo structure one by one, what is needed for this bdetail table
    If (p_RecordVersion >= PKG_MEC_HB.cAscii0VersionMsc_01_00_04) Then       -- 044SO -- 037SO
        oCdrInfo.MappingStateId         := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 096SO
        oCdrInfo.CdrTypeId              := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.OrigAddress            := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- connected party
        oCdrInfo.RecipAddress           := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- other party
        oCdrInfo.RequestTime            := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.Imsi                   := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.Imei                   := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        l_ExchangeIdentity              := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.MscIdentificationId    := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        l_Route                         := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.Cell                   := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        l_TeleServiceCode               := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.ServiceCenterAddress   := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        l_PowerClass                    := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.SubscriptionType       := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.Prepaid                := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.BillingDetailId        := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.ShortId                := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.AmountCustomer         := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.RevenueShareMobile     := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.RevenueShareProvider   := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.VasContractId          := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.TariffId               := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- 057SO-- 019SO
        oCdrInfo.VasPriceModelVersionId := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- 004AA
        oCdrInfo.ErrorId                := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.CdrBilled              := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.CdrRated               := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.PackingIdHb            := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.OutputHb               := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.RatingZoneId           := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.InterworkingContractId := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- 004AA
        oCdrInfo.Schedule1              := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.Schedule2              := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.Schedule3              := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.OrigSubmitTime         := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- 044SO
        oCdrInfo.MsgReference           := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- 129SO
        oCdrInfo.ScaOpKey               := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- 118SO
        oCdrInfo.OrigGtiOpKey           := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- 117SO
        oCdrInfo.DeliverOpKey           := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- 117SO
        oCdrInfo.DeliverGtiOpKey        := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- 117SO
        oCdrInfo.InterworkingAmount     := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- 128SO
        oCdrInfo.InterworkingApmn       := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- 128SO
        oCdrInfo.InterworkingCurrency   := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- 128SO
        oCdrInfo.InterworkingDirection  := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- 128SO
        oCdrInfo.InterworkingScenario   := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- 128SO
        oCdrInfo.InterworkingState      := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- 128SO
    End If;

    p_DateTime := oCdrInfo.RequestTime;

    If (oCdrInfo.CdrTypeId = cstrMscMobileTerminatingSms) then
        -- Lookup SMSCId (BS_SMSCID) using ServiceCentreAddress (BD_SCA) from the table SMSC
        -- If ServiceCenterAddress is not found then the SMSCs are added to (belong to) a
        -- predefined Operator Contract called 'UNKNOWNTOC'
        if oCdrInfo.Imsi like gcstrOwnMccMnc ||'%' then
            l_SmscId := GetSmscId( oCdrInfo.ServiceCenterAddress, 1);  -- 072SO
        else
            l_SmscId := GetSmscId( oCdrInfo.ServiceCenterAddress, 0);  -- 102SO
        end if;
    Else
        -- SMSC ID is not needed for MO CDRs for now
        l_SmscId := Null;
    End If;

    Insert Into BDETAIL4 (
        BD_ID,
        BD_SRCTYPE,
        BD_DEMO,
        BD_BIHID,
        BD_MAPSID,
        BD_BIRECNO,
        BD_PACSID1,
        BD_PACSID2,
        BD_PACSID3,
        BD_CDRTID,
        BD_MSISDN_A,            -- connected party  (Originator for MO / Recipient for MT)
        BD_MSISDN_B,            -- other party      (Recipient for MO / Originator for MT)
        BD_DATETIME,
        BD_IMSI,
        BD_IMEI,
        BD_EXID,
        BD_MSCID,
        BD_ROUTE,
        BD_CELL,
        BD_TSC,
        BD_SCA,
        BD_POWER,
        BD_SUBTYPE,
        BD_PREPAID,
        BD_ZNID,
        BD_SMSCID,
        BD_SHORTID,
        BD_AMOUNTCU,
        BD_RETSHAREMO,
        BD_RETSHAREPV,
        BD_CONID,
        BD_TARID,                                                               -- 019SO
        BD_PMVID,                                                               -- 004AA
        BD_TOCID,                                                               -- 007AA
        BD_ERRID,
        BD_BILLED,
        BD_RATED,
        BD_PACIDHB,
        BD_OUTPUTHB,
        BD_ORIGSUBMITTIME                                                       -- 044SO
        , BD_MESSAGEREFERENCE                                                   -- 129SO
        , BD_SCA_OPKEY                                                          -- 118SO
        , BD_OGTI_OPKEY                                                         -- 117SO
        , BD_DELIVER_OPKEY                                                      -- 117SO
        , BD_DGTI_OPKEY                                                         -- 117SO
        , BD_IW_AMOUNT                                                          -- 128SO
        , BD_IW_APMN                                                            -- 128SO
        , BD_IW_CURID                                                           -- 128SO
        , BD_IW_DIR                                                             -- 128SO
        , BD_IW_SCENARIO                                                        -- 128SO
        , BD_IW_CONSTATE                                                        -- 128SO
        , BD_SIGNATURE                                                          -- 146SO
    )
    Values (
        oCdrInfo.BillingDetailId,
        p_SrcType,
        0,
        p_BihId,
        oCdrInfo.MappingStateId,
        p_RecordNr,
        oCdrInfo.Schedule1,
        oCdrInfo.Schedule2,
        oCdrInfo.Schedule3,
        oCdrInfo.CdrTypeId,
        oCdrInfo.OrigAddress,               -- connected party
        oCdrInfo.RecipAddress,              -- other party
        To_Date(oCdrInfo.RequestTime,cstrMecDateTimeFormat),
        oCdrInfo.Imsi,
        oCdrInfo.Imei,
        l_ExchangeIdentity,
        oCdrInfo.MscIdentificationId,
        l_Route,
        oCdrInfo.Cell,
        l_TeleServiceCode,
        oCdrInfo.ServiceCenterAddress,
        l_PowerClass,
        oCdrInfo.SubscriptionType,
        oCdrInfo.Prepaid,
        oCdrInfo.RatingZoneId,
        l_SmscId,
        oCdrInfo.ShortId,
        oCdrInfo.AmountCustomer,
        oCdrInfo.RevenueShareMobile,
        oCdrInfo.RevenueShareProvider,
        oCdrInfo.VasContractId,
        oCdrInfo.TariffId,                                                      -- 057SO-- 019SO
        oCdrInfo.VasPriceModelVersionId,                                        -- 004AA
        oCdrInfo.InterworkingContractId,                                        -- 007AA
        oCdrInfo.ErrorId,
        oCdrInfo.CdrBilled,
        oCdrInfo.CdrRated,
        oCdrInfo.PackingIdHb,
        oCdrInfo.OutputHb,
        To_Date(oCdrInfo.OrigSubmitTime,cstrMecDateTimeFormat)                  -- 044SO
        , oCdrInfo.MsgReference                                                 -- BD_MESSAGEREFERENCE -- 129SO
        , oCdrInfo.ScaOpKey                                                     -- BD_SCA_OPKEY     -- 118SO
        , oCdrInfo.OrigGtiOpKey                                                 -- BD_OGTI_OPKEY    -- 117SO
        , oCdrInfo.DeliverOpKey                                                 -- BD_DELIVER_OPKEY -- 117SO
        , oCdrInfo.DeliverGtiOpKey                                              -- BD_DGTI_OPKEY    -- 117SO
        , oCdrInfo.InterworkingAmount                                           -- 'BD_IW_AMOUNT'   -- 128SO
        , oCdrInfo.InterworkingApmn                                             -- 'BD_IW_APMN'     -- 128SO
        , oCdrInfo.InterworkingCurrency                                         -- 'BD_IW_CURID'    -- 128SO
        , oCdrInfo.InterworkingDirection                                        -- 'BD_IW_DIR'      -- 128SO
        , oCdrInfo.InterworkingScenario                                         -- 'BD_IW_SCENARIO' -- 128SO
        , oCdrInfo.InterworkingState                                            -- 'BD_IW_CONSTATE' -- 128SO
        -- BD_SIGNATURE                                                         -- 146SO
        -- 01: ZERO  0=zero charged 1=nonzero charged
        -- 02: BILLED 1=billed, 0=not billed, 2=uninitialized, 3=ignore-dup, 4=ignore-0, 5=reject-dup, 6=reject-sub, 7=send-frng, 8=recv-frng (see table BDBSTATE)
        -- 03: MAPSID E=Error, M=Mapping
        -- 04: CDRTID O=originating, T=terminating
        -- 05: IMSI   S=22801, F=others
        -- 06: PREPAID Y=yes, N=no, U=unknown
        -- 07: TARID  L=LA, S=BN-IS, P=Portal-IS, T=Televote, V=free-free, X=intern or '-' =P2P
        -- 08: RATZONE  0=normal, 1=la-handygroup(SMS-HG-a/SMS-HG-b/SMS-HG-d)   -- 147SO                                          -- 147SO
        -- 09: RESERVED '-'=unused                                              -- 147SO
        -- 10: RESERVED '-'=unused                                              -- 147SO
        -- 11: RESERVED '-'=unused                                              -- 147SO
        ,  DECODE(oCdrInfo.AmountCustomer,0.0,'0','1')
        || oCdrInfo.CdrBilled
        || oCdrInfo.MappingStateId
        || SUBSTR(oCdrInfo.CdrTypeId,6,1)
        || DECODE(SUBSTR(oCdrInfo.Imsi,1,5),'22801','S','F')
        || oCdrInfo.Prepaid
        || DECODE(oCdrInfo.TariffId,'X','X','V','V','S','S','P','P','T','T',NULL,'-','L')
        || DECODE(SUBSTR(oCdrInfo.RatingZoneId,1,6),'SMS-HG','1','0')
        || '-'
        || '-'
        || '-'
    );

    if (oCdrInfo.CdrTypeId = cstrMscMobileTerminatingSms) and
         not (l_SmscId is NULL) and
          (oCdrInfo.Schedule1 = 'S') then                                       -- 074SO
        INSERT INTO SMS_IW_MT_ARCH (
           BDA_DAY ,
           BDA_SMSCID,
           BDA_BIHID,
           BDA_BIRECNO,
           BDA_SCA,
           BDA_DATETIME,
           BDA_MSISDN_A,
           BDA_IMSI,
           BDA_MSISDN_B
           ,BDA_MSCID                                                           -- 105SO
        ) VALUES (
              TRUNC(To_Date(oCdrInfo.RequestTime,cstrMecDateTimeFormat)),
              l_SmscId,
              p_BihId,
              p_RecordNr,
              oCdrInfo.ServiceCenterAddress,
              To_Date(oCdrInfo.RequestTime,cstrMecDateTimeFormat),
              oCdrInfo.OrigAddress,
              oCdrInfo.Imsi,
              oCdrInfo.RecipAddress,
              oCdrInfo.MscIdentificationId                                      -- 105SO
        );  -- 073SO        14.09.2009  Populate archive table for SC terminating IW SMS
    end if;

    if p_SoftErrorId is null and oCdrInfo.MappingStateId <> cstrMappingStateSuccess then
        p_SoftErrorId:= oCdrInfo.ErrorId;                                       -- first error only !
    end if;
    if oCdrInfo.MappingStateId <> cstrMappingStateSuccess then
        p_SoftErrorCount := p_SoftErrorCount + 1;                               -- 152SO
    end if;

    Return;

End INSERT_CSV_MSC;


Procedure INSERT_CSV_M2M (
    p_SrcType               In      Varchar2,
    p_BihId                 In      Varchar2,
    p_DataHeader            In      VarChar2,
    p_RecordNr              In      Number,
    p_RecordData            In      Varchar2,
    p_RecordVersion         In      Varchar2,
    p_Inserted              Out     Number,         -- 143SO
    p_DateTime              Out     Varchar2,
    p_SoftErrorCount        Out     Number,         -- 152SO
    p_SoftErrorId           Out     Varchar2,
    p_SoftErrDesc           Out     Varchar2
)
Is
    -- 112SO
    l_RecordData            Varchar2(4000);
    oCdrInfo0               PKG_MEC_HB.tCdrInfo;                                -- untouched empty copy of the structure
    oCdrInfo                PKG_MEC_HB.tCdrInfo;                                -- working copy of the structure

Begin

    p_Inserted := 1;                                                            -- 143SO
    p_DateTime := NULL;
    p_SoftErrorCount := 0;                                                      -- 152SO
    p_SoftErrorId := NULL;
    p_SoftErrDesc := NULL;

    l_RecordData := p_RecordData;   -- get the Ascii0 value containing the tab-separated data
    oCdrInfo :=oCdrInfo0;           -- clear the structure for every data row

    If (p_RecordVersion >= PKG_MEC_HB.cAscii0VersionM2m_01_00_02) Then
        oCdrInfo.MappingStateId             := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- BD_MAPSID
        oCdrInfo.MsgReference               := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- BD_MESSAGEREFERENCE
        oCdrInfo.OrigImsi                   := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- BD_ORIGINATORIMSI
        oCdrInfo.OrigAddress                := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- BD_MSISDN_A
        oCdrInfo.OrigGti                    := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- BD_OGTI
        oCdrInfo.RequestItem                := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- BD_RECEIPTREQ
        oCdrInfo.DeliverGti                 := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- BD_DGTI
        oCdrInfo.DeliverImsi                := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- BD_IMSI
        oCdrInfo.RecipAddress               := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- BD_MSISDN_B
        oCdrInfo.SegLength                  := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- BD_LENGTH
        oCdrInfo.RequestTime                := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- BD_DATESUBMIT
        oCdrInfo.MsgStatus                  := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- BD_STATUS
        oCdrInfo.DateTime                   := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- BD_DATETIME
        oCdrInfo.Attempts                   := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- BD_ATTEMPTS
        oCdrInfo.SinkName                   := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- BD_SINKNAME
        oCdrInfo.SinkType                   := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- BD_SINKTYPE
        oCdrInfo.SrcName                    := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- BD_SOURCENAME
        oCdrInfo.SrcType                    := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- BD_SOURCETYPE
        oCdrInfo.MessageType                := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- BD_MSGTYPE
        oCdrInfo.ErrorParameter             := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- BD_ERRORPARAM
        oCdrInfo.BillingDetailId            := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- BD_ID
        oCdrInfo.CdrTypeId                  := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- BD_CDRTID
        oCdrInfo.ShortId                    := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- BD_SHORTID
        oCdrInfo.VasContractId              := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- BD_CONID
        oCdrInfo.TariffId                   := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- BD_TARID
        oCdrInfo.InterworkingContractId     := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- BD_TOCID
        oCdrInfo.ForeignRecipient           := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- BD_INT
        oCdrInfo.InterworkingCase           := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- BD_IW
        oCdrInfo.ErrorId                    := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- BD_ERRID
        oCdrInfo.Schedule1                  := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- BD_PACSID1
        oCdrInfo.Schedule2                  := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- BD_PACSID2
        oCdrInfo.Schedule3                  := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- BD_PACSID3
        oCdrInfo.ScaOpKey                   := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- 118SO
        oCdrInfo.OrigGtiOpKey               := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- 117SO
        oCdrInfo.DeliverOpKey               := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- 117SO
        oCdrInfo.DeliverGtiOpKey            := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- 117SO
        oCdrInfo.InterworkingAmount         := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- 128SO
        oCdrInfo.InterworkingApmn           := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- 128SO
        oCdrInfo.InterworkingCurrency       := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- 128SO
        oCdrInfo.InterworkingDirection      := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- 128SO
        oCdrInfo.InterworkingScenario       := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- 128SO
        oCdrInfo.InterworkingState          := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- 128SO
        oCdrInfo.DeliverMapGti              := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- 153SO
    End If;

    p_DateTime := oCdrInfo.DateTime;

    Insert Into
    BDETAIL7( BD_ID
            , BD_SRCTYPE
            , BD_DEMO
            , BD_BIHID
            , BD_MAPSID
            , BD_BIRECNO
            , BD_MESSAGEREFERENCE
            , BD_ORIGINATORIMSI
            , BD_MSISDN_A
            , BD_OGTI
            , BD_RECEIPTREQ
            , BD_DGTI
            , BD_IMSI
            , BD_MSISDN_B
            , BD_LENGTH
            , BD_DATESUBMIT
            , BD_STATUS
            , BD_DATETIME
            , BD_ATTEMPTS
            , BD_SINKNAME
            , BD_SINKTYPE
            , BD_SOURCENAME
            , BD_SOURCETYPE
            , BD_MSGTYPE
            , BD_ERRORPARAM
            , BD_CDRTID
            , BD_SHORTID
            , BD_CONID
            , BD_TARID
            , BD_TOCID
            , BD_INT
            , BD_IW
            , BD_ERRID
            , BD_PACSID1
            , BD_PACSID2
            , BD_PACSID3
            , BD_SCA_OPKEY                                                      -- 118SO
            , BD_OGTI_OPKEY                                                     -- 117SO
            , BD_DELIVER_OPKEY                                                  -- 117SO
            , BD_DGTI_OPKEY                                                     -- 117SO
            , BD_IW_AMOUNT                                                      -- 128SO
            , BD_IW_APMN                                                        -- 128SO
            , BD_IW_CURID                                                       -- 128SO
            , BD_IW_DIR                                                         -- 128SO
            , BD_IW_SCENARIO                                                    -- 128SO
            , BD_IW_CONSTATE                                                    -- 128SO
            , BD_DELIVER_MAP_GTI                                                -- 153SO
    )
    Values  ( oCdrInfo.BillingDetailId
            , p_SrcType
            , 0
            , p_BihId
            , oCdrInfo.MappingStateId                                           -- BD_MAPSID
            , p_RecordNr                                                        -- BD_BIRECNO
            , oCdrInfo.MsgReference                                             -- BD_MESSAGEREFERENCE
            , oCdrInfo.OrigImsi                                                 -- BD_ORIGINATORIMSI
            , oCdrInfo.OrigAddress                                              -- BD_MSISDN_A
            , oCdrInfo.OrigGti                                                  -- BD_OGTI
            , oCdrInfo.RequestItem                                              -- BD_RECEIPTREQ
            , oCdrInfo.DeliverGti                                               -- BD_DGTI
            , oCdrInfo.DeliverImsi                                              -- BD_IMSI
            , oCdrInfo.RecipAddress                                             -- BD_MSISDN_B
            , oCdrInfo.SegLength                                                -- BD_LENGTH
            , To_Date(oCdrInfo.RequestTime,cstrMecDateTimeFormat)               -- BD_DATESUBMIT
            , oCdrInfo.MsgStatus                                                -- BD_STATUS
            , To_Date(oCdrInfo.DateTime,cstrMecDateTimeFormat)                  -- BD_DATETIME
            , oCdrInfo.Attempts                                                 -- BD_ATTEMPTS
            , oCdrInfo.SinkName                                                 -- BD_SINKNAME
            , oCdrInfo.SinkType                                                 -- BD_SINKTYPE
            , oCdrInfo.SrcName                                                  -- BD_SOURCENAME
            , oCdrInfo.SrcType                                                  -- BD_SOURCETYPE
            , oCdrInfo.MessageType                                              -- BD_MSGTYPE
            , oCdrInfo.ErrorParameter                                           -- BD_ERRORPARAM
            , oCdrInfo.CdrTypeId                                                -- BD_CDRTID
            , oCdrInfo.ShortId                                                  -- BD_SHORTID
            , oCdrInfo.VasContractId                                            -- BD_CONID
            , oCdrInfo.TariffId                                                 -- BD_TARID
            , oCdrInfo.InterworkingContractId                                   -- BD_TOCID
            , oCdrInfo.ForeignRecipient                                         -- BD_INT
            , oCdrInfo.InterworkingCase                                         -- BD_IW
            , oCdrInfo.ErrorId                                                  -- BD_ERRID
            , oCdrInfo.Schedule1                                                -- BD_PACSID1
            , oCdrInfo.Schedule2                                                -- BD_PACSID2
            , oCdrInfo.Schedule3                                                -- BD_PACSID3
            , oCdrInfo.ScaOpKey                                                 -- BD_SCA_OPKEY     -- 118SO
            , oCdrInfo.OrigGtiOpKey                                             -- BD_OGTI_OPKEY    -- 117SO
            , oCdrInfo.DeliverOpKey                                             -- BD_DELIVER_OPKEY -- 117SO
            , oCdrInfo.DeliverGtiOpKey                                          -- BD_DGTI_OPKEY    -- 117SO
            , oCdrInfo.InterworkingAmount                                       -- 'BD_IW_AMOUNT'   -- 128SO
            , oCdrInfo.InterworkingApmn                                         -- 'BD_IW_APMN'     -- 128SO
            , oCdrInfo.InterworkingCurrency                                     -- 'BD_IW_CURID'    -- 128SO
            , oCdrInfo.InterworkingDirection                                    -- 'BD_IW_DIR'      -- 128SO
            , oCdrInfo.InterworkingScenario                                     -- 'BD_IW_SCENARIO' -- 128SO
            , oCdrInfo.InterworkingState                                        -- 'BD_IW_CONSTATE' -- 128SO
            , oCdrInfo.DeliverMapGti                                            -- 'BD_DELIVER_MAP_GTI' -- 153SO
    );

    if p_SoftErrorId is null and oCdrInfo.MappingStateId <> cstrMappingStateSuccess then
        p_SoftErrorId:= oCdrInfo.ErrorId;                                       -- first error only !
    end if;
    if oCdrInfo.MappingStateId <> cstrMappingStateSuccess then
        p_SoftErrorCount := p_SoftErrorCount + 1;                               -- 152SO
    end if;

    Return;

End INSERT_CSV_M2M;


Procedure INSERT_CSV_MMSC (
    p_SrcType               In      Varchar2,
    p_BihId                 In      Varchar2,
    p_DataHeader            In      VarChar2,                                   -- 086SO
    p_RecordNr              In      Number,                                     -- 086SO
    p_RecordData            In      Varchar2,                                   -- 086SO
    p_RecordVersion         In      Varchar2,                                   -- 086SO
    p_Inserted              Out     Number,                                     -- 143SO
    p_DateTime              Out     Varchar2,
    p_SoftErrorCount        Out     Number,                                     -- 152SO
    p_SoftErrorId           Out     Varchar2,
    p_SoftErrDesc           Out     Varchar2
)
Is
    l_RecordData            Varchar2(4000);
    oCdrInfo0               PKG_MEC_HB.tCdrInfo;   -- 037SO-- untouched empty copy of the structure
    oCdrInfo                PKG_MEC_HB.tCdrInfo;   -- 037SO-- working copy of the structure

    aCdrInfo                PKG_MEC_HB.tCdrInfoMmsc;                            -- 048SO
    aCdrInfo0               PKG_MEC_HB.tCdrInfoMmsc;                            -- 048SO
    l_dummy                 Varchar2(254);
    l_relevant_address      Varchar2(254);                                      -- 146SO
    l_relevant_imsi         Varchar2(254);                                      -- 146SO

Begin
    p_Inserted := 1;                                                            -- 143SO
    p_DateTime := NULL;
    p_SoftErrorCount := 0;                                                      -- 152SO
    p_SoftErrorId := NULL;
    p_SoftErrDesc := NULL;

    -- get the Ascii0 value containing the tap-separated data
    l_RecordData                    := p_RecordData;

    -- use the PKG_MEC CdrInfo structure to store the read in values
    oCdrInfo :=oCdrInfo0;       -- clear the structure for every data row
    aCdrInfo := aCdrInfo0;      -- clear the structure for every data row

    -- split the values and assign to the CdrInfo structure one by one, what is needed for this bdetail table   -- 037SO
    If (p_RecordVersion >= PKG_MEC_HB.cAscii0VersionMmsc_01_00_05) Then         -- 116SO
        oCdrInfo.MappingStateId                 := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);   -- 096SO
        oCdrInfo.RequestTime                    := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.DateTime                       := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.OrigAddress                    := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.RecipAddress                   := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        aCdrInfo.LayerSpecificAttr              := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.MessageType                    := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        aCdrInfo.MessageSize                    := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.SegLength                      := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        aCdrInfo.StorageDuration                := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.MsgScheduleTime                := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.DeliverTime                    := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.MsgExpiryTime                  := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        aCdrInfo.MessagePriority                := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        aCdrInfo.MessageClass                   := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        aCdrInfo.MessageContent                 := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.MessageId                      := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        aCdrInfo.NumOfNotification              := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        aCdrInfo.MMSIdentifier                  := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        aCdrInfo.CDRRecordType                  := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        aCdrInfo.FwdCopyCopyInd                 := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        aCdrInfo.ContentRequestId               := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.Prepaid                        := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.EventDisposition               := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        aCdrInfo.OutgoingInterfaceId            := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.IncomingInterfaceId            := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        aCdrInfo.Price                          := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        aCdrInfo.DeliveryReadRepReqInd          := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.PartyToCharge                  := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.LegacyTermIndicator            := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        aCdrInfo.NumHomeRecipients              := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        aCdrInfo.NumNonHomeInCountryRecipients  := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        aCdrInfo.NumInternationalRecipients     := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        aCdrInfo.NumEmailRecipients             := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        aCdrInfo.NumShortCodeRecipients         := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        aCdrInfo.NumOfConversions               := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        aCdrInfo.FreeText                       := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.OrigImsi                       := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.RatingZoneId                   := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.BillingDetailId                := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.AmountCustomer                 := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.RevenueShareMobile             := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.RevenueShareProvider           := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.CdrTypeId                      := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.SegLength                      := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.ShortId                        := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.VasContractId                  := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.VasPriceModelVersionId         := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 037SO-- 004AA
        oCdrInfo.TariffId                       := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 057SO
        oCdrInfo.TransportClass                 := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.TransportClassIw               := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.TransportCost                  := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.TransportCount                 := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.InterworkingContractId         := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.ForeignRecipient               := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.InterworkingCase               := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        aCdrInfo.MM7LinkedID                    := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        aCdrInfo.PrepaidFreeText                := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        aCdrInfo.PromotionPlan                  := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        aCdrInfo.TariffClass                    := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.RoamingInfo                    := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.DeliverImsi                    := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        l_dummy                                 := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        l_dummy                                 := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.MmsRoamingZoneId1              := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- 028SO
        l_dummy                                 := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- 028SO
        oCdrInfo.MmsDestinationZoneId           := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.MmsSizeZoneId                  := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.RecipCount                     := To_Number(PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator));
        oCdrInfo.RecipIndex                     := To_Number(PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator));  -- 027SO
        oCdrInfo.ErrorId                        := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.CdrBilled                      := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.CdrRated                       := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.PackingIdHb                    := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.OutputHb                       := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.Schedule1                      := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.Schedule2                      := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.Schedule3                      := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.IsGenerated                    := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- 115SO
        oCdrInfo.MoRoamingPromotion             := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- 147SO
        oCdrInfo.MtRoamingPromotion             := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- 147SO

    End If;

    p_DateTime := oCdrInfo.DateTime;                                            -- 092SO

-- L('BD_SRCTYPE',p_SrcType);
-- L('BD_BIHID',p_BihId);
-- L('BD_MAPSID',oCdrInfo.MappingStateId);
-- L('BD_BIRECNO',p_RecordNr);
-- L('BD_DATETIME',oCdrInfo.DateTime);

    l_relevant_address := CASE WHEN SUBSTR(oCdrInfo.CdrTypeId,4,1) = 'O' THEN oCdrInfo.OrigAddress ELSE oCdrInfo.RecipAddress END;    -- 146SO
    l_relevant_imsi := CASE WHEN SUBSTR(oCdrInfo.CdrTypeId,4,1) = 'O' THEN oCdrInfo.OrigImsi ELSE oCdrInfo.DeliverImsi END;           -- 146SO

    Insert Into BDETAIL6(
        BD_ID
        , BD_SRCTYPE
        , BD_DEMO
        , BD_BIHID
        , BD_MAPSID
        , BD_BIRECNO
        , BD_PACSID1
        , BD_PACSID2
        , BD_PACSID3
        , BD_DATETIME
        , BD_MSISDN_A
        , BD_MSISDN_B
        , BD_LAYERSPECATTR
        , BD_MSGTYPE
        , BD_MSGSIZE
        , BD_STORAGEDURATION
        , BD_DATEDELIVERYFUTURE
        , BD_DATEDELIVERY
        , BD_DATESUBMIT
        , BD_DATEEXPIRE
        , BD_MSGPRIORITY
        , BD_MSGCLASS
        , BD_MSGCONTENT
        , BD_UMSGGRPID
        , BD_NUMNOTIFICATION
        , BD_MMSIDENTIFIER
        , BD_CDRRECTYPE
        , BD_FWDCOPYIND
        , BD_ACCCORRID
        , BD_PREPAID
        , BD_EVENTDISP
        , BD_OUTID
        , BD_INID
        , BD_PRICE
        , BD_REQUESTIND
        , BD_PARTYTOCHARGE
        , BD_LEGACYINDICATOR
        , BD_NUMHOMERECIP
        , BD_NUMNONHOMERECIP
        , BD_NUMINTLRECIP
        , BD_NUMEMAILRECIP
        , BD_NUMSCODERECIP
        , BD_NUMCONVERSION
        , BD_FREETEXT
        , BD_IMSI
        , BD_ZNID
        , BD_SHORTID
        , BD_AMOUNTCU
        , BD_RETSHAREMO                                                         -- 029SO
        , BD_RETSHAREPV                                                         -- 029SO
        , BD_CDRTID
        , BD_LENGTH
        , BD_CONID
        , BD_PMVID                                                              -- 004AA
        , BD_TARID                                                              -- 053SO
        , BD_TRCLASS
        , BD_TRCLASSIW
        , BD_AMOUNTTR                                                           -- 006AA (016SO)
        , BD_COUNTTR                                                            -- 006AA (016SO)
        , BD_TOCID
        , BD_INT
        , BD_IW
        , BD_MM7LINKEDID                                                        -- 008AA (020AA)
        , BD_PREPAIDFREETEXT                                                    -- 008AA (020AA)
        , BD_PROMOTIONPLAN                                                      -- 008AA (020AA)
        , BD_TARIFFCLASS                                                        -- 008AA (020AA)
        , BD_ROAMINGINFO                                                        -- 008AA (020AA)
        , BD_DESTINATIONIMSI                                                    -- 008AA (020AA)
        , BD_MMSRZID1                                                           -- 024AA
        , BD_MMSDZID                                                            -- 024AA
        , BD_MMSSZID                                                            -- 024AA
        , BD_RECIPCOUNT                                                         -- 024AA
        , BD_RECIPINDEX                                                         -- 027SO
        , BD_ERRID
        , BD_BILLED
        , BD_RATED
        , BD_PACIDHB
        , BD_OUTPUTHB
        , BD_GENERATED                                                          -- 115SO
        , BD_SIGNATURE                                                          -- 146SO
        , BD_MO_ROAMING_PROM                                                    -- 147SO
        , BD_MT_ROAMING_PROM                                                    -- 147SO
)   Values(
        oCdrInfo.BillingDetailId
        , p_SrcType
        , 0
        , p_BihId
        , oCdrInfo.MappingStateId
        , p_RecordNr
        , oCdrInfo.Schedule1
        , oCdrInfo.Schedule2
        , oCdrInfo.Schedule3
        , Nvl(To_Date(oCdrInfo.DateTime,cstrMecDateTimeFormat),SysDate)         -- 025AA -- should not be null
        , oCdrInfo.OrigAddress
        , oCdrInfo.RecipAddress
        , aCdrInfo.LayerSpecificAttr
        , oCdrInfo.MessageType
        , aCdrInfo.MessageSize
        , To_Number(aCdrInfo.StorageDuration)
        , To_Date(oCdrInfo.MsgScheduleTime,cstrMecDateTimeFormat)
        , To_Date(oCdrInfo.DeliverTime,cstrMecDateTimeFormat)
        , To_Date(oCdrInfo.RequestTime,cstrMecDateTimeFormat)                   -- 077SO -- 039SO
        , To_Date(oCdrInfo.MsgExpiryTime,cstrMecDateTimeFormat)
        , aCdrInfo.MessagePriority
        , aCdrInfo.MessageClass
        , aCdrInfo.MessageContent
        , oCdrInfo.MessageId
        , aCdrInfo.NumOfNotification
        , aCdrInfo.MMSIdentifier
        , aCdrInfo.CDRRecordType
        , aCdrInfo.FwdCopyCopyInd
        , aCdrInfo.ContentRequestId
        , oCdrInfo.Prepaid
        , oCdrInfo.EventDisposition
        , aCdrInfo.OutgoingInterfaceId
        , oCdrInfo.IncomingInterfaceId
        , aCdrInfo.Price
        , aCdrInfo.DeliveryReadRepReqInd
        , oCdrInfo.PartyToCharge
        , oCdrInfo.LegacyTermIndicator
        , aCdrInfo.NumHomeRecipients
        , aCdrInfo.NumNonHomeInCountryRecipients
        , aCdrInfo.NumInternationalRecipients
        , aCdrInfo.NumEmailRecipients
        , aCdrInfo.NumShortCodeRecipients
        , aCdrInfo.NumOfConversions
        , aCdrInfo.FreeText
        , oCdrInfo.OrigImsi
        , oCdrInfo.RatingZoneId
        , oCdrInfo.ShortId
        , oCdrInfo.AmountCustomer
        , oCdrInfo.RevenueShareMobile
        , oCdrInfo.RevenueShareProvider
        , oCdrInfo.CdrTypeId
        , oCdrInfo.SegLength
        , oCdrInfo.VasContractId
        , oCdrInfo.VasPriceModelVersionId                                       -- 004AA
        , oCdrInfo.TariffId                                                     -- 057SO
        , oCdrInfo.TransportClass
        , oCdrInfo.TransportClassIw
        , oCdrInfo.TransportCost                                                -- 006AA (016SO)
        , oCdrInfo.TransportCount                                               -- 006AA (016SO)
        , oCdrInfo.InterworkingContractId
        , oCdrInfo.ForeignRecipient
        , oCdrInfo.InterworkingCase
        , aCdrInfo.MM7LinkedID                                                  -- 008AA (020AA)
        , aCdrInfo.PrepaidFreeText                                              -- 008AA (020AA)
        , aCdrInfo.PromotionPlan                                                -- 008AA (020AA)
        , aCdrInfo.TariffClass                                                  -- 008AA (020AA)
        , oCdrInfo.RoamingInfo                                                  -- 008AA (020AA)
        , oCdrInfo.DeliverImsi                                                  -- 008AA (020AA)
        , oCdrInfo.MmsRoamingZoneId1                                            -- 028SO
        , oCdrInfo.MmsDestinationZoneId                                         -- 024AA
        , oCdrInfo.MmsSizeZoneId                                                -- 024AA
        , oCdrInfo.RecipCount                                                   -- 024AA
        , oCdrInfo.RecipIndex                                                   -- 027SO
        , oCdrInfo.ErrorId
        , oCdrInfo.CdrBilled
        , oCdrInfo.CdrRated
        , oCdrInfo.PackingIdHb
        , oCdrInfo.OutputHb
        , oCdrInfo.IsGenerated                                                  -- 115SO
        -- BD_SIGNATURE                                                         -- 146SO
        -- 01: ZERO  0=zero charged 1=nonzero charged
        -- 02: BILLED 1=billed, 0=not billed, 2=uninitialized, 3=duplicate submit
        -- 03: MAPSID E=Error, M=Mapping
        -- 04: CDRTID O=MMSOrecord, R=MMSRrecord, 3=MM3Rrecord, 4=MM4Rrecord, 7=MM7?record, U=unexpected
        -- 05: MSISDN F=TFL(42377..), S=others(Swisscom)
        -- 06: PREPAID Y=yes, N=no, U=Unknown
        -- 07: TARID V=free-free, X=internal, S=BN, P=PTS, L=MMS-LA or '-'=P2P
        -- 08: EVENTDISPOSITION 1=delivered, 2=received, 3=expired, 4=rejected network, 7=rejected terminal, 0=others
        -- 09: ROAMINGINFO D=41.794998800 (default), S=NULL (home net), F=foreign net
        -- 10: MESSAGETYPE 0=Message, 1=Notification, 2=DeliveryReport, 3=ReadReply
        -- 11: RECIPINDEX 1=first, n=added by splitter
        -- 12: IMSI D=228010000000, N=NULL, S=22801..., F=others
        -- 13: MOPROM   0=no, 1=yes
        -- 14: MTPROM   0=no, 1=yes
        -- 15: RESERVED '-'=unused
        -- 16: RESERVED '-'=unused
        -- 17: RESERVED '-'=unused
       ,  DECODE(oCdrInfo.AmountCustomer,0.0,'0','1')
        || oCdrInfo.CdrBilled
        || oCdrInfo.MappingStateId
        || DECODE(oCdrInfo.CdrTypeId,'MMSO','O','MMSR','R','MM3O','3','MM3R','3','MM4O','4','MM4R','4','MM7O','7','MM7R','7','U')
        || DECODE(SUBSTR(l_relevant_address,1,5),'42377','F','S')
        || NVL(oCdrInfo.Prepaid,'-')
        || DECODE(NVL(oCdrInfo.TariffId,'-'),'-','-','S','S','P','P','X', 'X', 'V','V','L') -- 148SO
        || DECODE(oCdrInfo.EventDisposition,1,1,2,2,3,3,4,4,7,7,0)
        || DECODE(oCdrInfo.RoamingInfo,'41.794998800','D',NULL,'S','F')
        || oCdrInfo.MessageType
        || DECODE(oCdrInfo.RecipIndex,1,'1','n')
        || DECODE(l_relevant_imsi,'228010000000','D',NULL,'N',DECODE(SUBSTR(l_relevant_imsi,1,5),'22801','S','F'))
        || DECODE(oCdrInfo.MoRoamingPromotion,1,'1','0')                        -- 147SO
        || DECODE(oCdrInfo.MtRoamingPromotion,1,'1','0')                        -- 147SO
        || '-'                                                                  -- 147SO
        || '-'                                                                  -- 147SO
        || '-'                                                                  -- 147SO
        , oCdrInfo.MoRoamingPromotion                                           -- 147SO
        , oCdrInfo.MtRoamingPromotion                                           -- 147SO
    );

    if p_SoftErrorId is null and oCdrInfo.MappingStateId <> cstrMappingStateSuccess then
        p_SoftErrorId:= oCdrInfo.ErrorId;                                       -- first error only !
    end if;
    if oCdrInfo.MappingStateId <> cstrMappingStateSuccess then
        p_SoftErrorCount := p_SoftErrorCount + 1;                               -- 152SO
    end if;

    Return;

End INSERT_CSV_MMSC;

Procedure INSERT_CSV_ISRV (
    p_SrcType               In      Varchar2,
    p_BihId                 In      Varchar2,
    p_DataHeader            In      VarChar2,       -- 086SO
    p_RecordNr              In      Number,         -- 086SO
    p_RecordData            In      Varchar2,       -- 086SO
    p_RecordVersion         In      Varchar2,       -- 086SO
    p_Inserted              Out     Number,         -- 143SO
    p_DateTime              Out     Varchar2,
    p_SoftErrorCount        Out     Number,         -- 152SO
    p_SoftErrorId           Out     Varchar2,
    p_SoftErrDesc           Out     Varchar2
)
Is  -- 086SO

    l_RecordData            Varchar2(4000);
    oCdrInfo0               PKG_MEC_HB.tCdrInfo;                            -- 008AA(020SO)   -- untouched empty copy of the structure
    oCdrInfo                PKG_MEC_HB.tCdrInfo;                            -- 008AA(020SO)   -- working copy of the structure

    l_MimetypeSize          Varchar2(2000);

Begin

    p_Inserted := 1;                                                            -- 143SO
    p_DateTime := NULL;
    p_SoftErrorCount := 0;                                                      -- 152SO
    p_SoftErrorId := NULL;
    p_SoftErrDesc := NULL;

    -- get the Ascii0 value containing the tap-separated data
    l_RecordData                    := p_RecordData;
    -- use the PKG_MEC CdrInfo structure to store the read in values
    -- clear the structure for every data row
    oCdrInfo :=oCdrInfo0;
    -- split the values and assign to the CdrInfo structure one by one, what is needed for this bdetail table -- 008AA(020SO)
    oCdrInfo.MappingStateId         := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);   -- 096SO
    oCdrInfo.RequestTime            := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
    oCdrInfo.OrigAddress            := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);   -- chargeable party
    oCdrInfo.RecipAddress           := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);   -- receiver of the content
    oCdrInfo.OrigImsi               := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
    oCdrInfo.Service                := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
    oCdrInfo.Lang                   := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
    oCdrInfo.MsgStatus              := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
    oCdrInfo.ThirdPartyId           := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
    oCdrInfo.SubscriptionType       := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
    oCdrInfo.ShortId                := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
    oCdrInfo.VasContractId          := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
    oCdrInfo.ContractSubType        := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
    oCdrInfo.VasPriceModelVersionId := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
    oCdrInfo.Prepaid                := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
    oCdrInfo.AmountCustomer         := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
    oCdrInfo.RevenueShareMobile     := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
    oCdrInfo.RevenueShareProvider   := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
    oCdrInfo.BillRate               := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
    oCdrInfo.RatingZoneId           := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
    oCdrInfo.BillingDomain          := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
    oCdrInfo.TransportMedium        := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
    oCdrInfo.CdrTypeId              := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
    oCdrInfo.SegLength              := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
    oCdrInfo.BillingTime            := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
    oCdrInfo.TransportClass         := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
    oCdrInfo.TransportCost          := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
    oCdrInfo.InterworkingContractId := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
    oCdrInfo.ForeignRecipient       := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
    oCdrInfo.InterworkingCase       := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
    oCdrInfo.RequestItemText        := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
    oCdrInfo.BillText               := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
    oCdrInfo.RequestType            := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
    oCdrInfo.RequestId              := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
    oCdrInfo.NodeName               := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
    oCdrInfo.Network                := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
    oCdrInfo.Location               := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
    oCdrInfo.RequestItem            := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
    oCdrInfo.Info                   := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
    oCdrInfo.MessageId              := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
    l_MimetypeSize                  := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- stored in BDITEM table
    oCdrInfo.Category               := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 046SO
    oCdrInfo.TaxRate                := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 046SO
    oCdrInfo.TestMode               := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 046SO
    oCdrInfo.ErrorId                := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
    oCdrInfo.BillingDetailId        := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
    oCdrInfo.AaaTopStopUpdated      := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
    oCdrInfo.CdrBilled              := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
    oCdrInfo.CdrRated               := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
    oCdrInfo.PackingIdHb            := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
    oCdrInfo.OutputHb               := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
    oCdrInfo.Schedule1              := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
    oCdrInfo.Schedule2              := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
    oCdrInfo.Schedule3              := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
    oCdrInfo.TransportCount         := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 056SO
    oCdrInfo.OrigSubmitTime         := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 062SO
    oCdrInfo.OnlineCharge           := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 067AT
    oCdrInfo.Gart                   := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 103SO
    oCdrInfo.Show                   := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 104SO
    oCdrInfo.Campaign               := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 104SO

    p_DateTime := oCdrInfo.RequestTime;

    Insert into BDETAIL(
        BD_ID,
        BD_SRCTYPE,
        BD_DEMO,
        BD_BIHID,
        BD_BIRECNO,
        BD_MSISDN_A,
        BD_DATETIME,
        BD_SERVICE,
        BD_KEYWORD,
        BD_BILLTEXT,
        BD_LANGID,
        BD_REQTYPE,
        BD_REQUESTID,
        BD_NODENAME,
        BD_STATUS,
        BD_TPID,
        BD_NETWORK,
        BD_STYPE,
        BD_MAPSID,
        BD_CONID,
        BD_CONSTID,                                                             -- 051SO
        BD_SHORTID,
        BD_PMVID,
        BD_PREPAID,
        BD_AMOUNTCU,
        BD_RETSHAREMO,
        BD_RETSHAREPV,
        BD_LOCATION,
        BD_ITEMNO,
        BD_IMSI,
        BD_BILLRATE,
        BD_INFO,
        BD_MSISDN_B,
        BD_LENGTH,
        BD_BILLTIME,
        BD_MSGID,
        BD_TRCLASS,
        BD_AMOUNTTR,
        BD_ZNID,                                                                -- 018SO
        BD_BILLINGDOMAIN,                                                       -- 040AA
        BD_TRANSPORTMEDIUM,                                                     -- 040AA
        BD_CDRTID,
        BD_TOCID,
        BD_INT,
        BD_IW,
        BD_CATEGORY,                                                            -- 046SO
        BD_TAXRATE,                                                             -- 046SO
        BD_TESTMODE,                                                            -- 046SO
        BD_ERRID,
        BD_AAATS,
        BD_BILLED,
        BD_RATED,
        BD_PACIDHB,
        BD_OUTPUTHB,
        BD_PACSID1,
        BD_PACSID2,
        BD_PACSID3,
        BD_COUNTTR,                                                             -- 056SO
        BD_ORIGSUBMIT,                                                          -- 062SO
        BD_ONLINECHARGE,                                                        -- 067AT
        BD_GART,                                                                -- 103SO
        BD_SHOW,                                                                -- 104SO
        BD_CAMPAIGN,                                                            -- 104SO
        BD_SIGNATURE                                                            -- 146SO
   )
    Values(
        oCdrInfo.BillingDetailId,
        p_SrcType,
        0,
        p_BihId,
        p_RecordNr,
        oCdrInfo.OrigAddress,
        To_Date(oCdrInfo.RequestTime,cstrMecDateTimeFormat),
        oCdrInfo.Service,
        oCdrInfo.RequestItemText,
        oCdrInfo.BillText,
        oCdrInfo.Lang,
        oCdrInfo.RequestType,
        oCdrInfo.RequestId,
        oCdrInfo.NodeName,
        oCdrInfo.MsgStatus,
        oCdrInfo.ThirdPartyId,
        oCdrInfo.Network,
        oCdrInfo.SubscriptionType,
        oCdrInfo.MappingStateId,
        oCdrInfo.VasContractId,
        oCdrInfo.ContractSubType,                                               -- 051SO
        oCdrInfo.ShortId,
        oCdrInfo.VasPriceModelVersionId,
        oCdrInfo.Prepaid,
        oCdrInfo.AmountCustomer,
        oCdrInfo.RevenueShareMobile,
        oCdrInfo.RevenueShareProvider,
        oCdrInfo.Location,
        oCdrInfo.RequestItem,
        oCdrInfo.Imsi,
        oCdrInfo.BillRate,
        oCdrInfo.Info,
        oCdrInfo.RecipAddress,
        oCdrInfo.SegLength,
        To_Date(oCdrInfo.BillingTime,cstrMecDateTimeFormat),
        oCdrInfo.MessageId,
        oCdrInfo.TransportClass,
        oCdrInfo.TransportCost,
        oCdrInfo.RatingZoneId,                                                  -- 018SO
        oCdrInfo.BillingDomain,                                                 -- 040AA
        oCdrInfo.TransportMedium,                                               -- 040AA
        oCdrInfo.CdrTypeId,
        oCdrInfo.InterworkingContractId,
        oCdrInfo.ForeignRecipient,
        oCdrInfo.InterworkingCase,
        oCdrInfo.Category,                                                      -- 046SO
        oCdrInfo.TaxRate,                                                       -- 046SO
        oCdrInfo.TestMode,                                                      -- 046SO
        oCdrInfo.ErrorId,
        oCdrInfo.AaaTopStopUpdated,
        oCdrInfo.CdrBilled,
        oCdrInfo.CdrRated,
        oCdrInfo.PackingIdHb,
        oCdrInfo.OutputHb,
        oCdrInfo.Schedule1,
        oCdrInfo.Schedule2,
        oCdrInfo.Schedule3,
        oCdrInfo.TransportCount,                                                -- 056SO
        To_Date(oCdrInfo.OrigSubmitTime,cstrMecDateTimeFormat),                 -- 062SO
        oCdrInfo.OnlineCharge ,                                                 -- 067AT
        oCdrInfo.Gart,                                                          -- 103SO
        oCdrInfo.Show,                                                          -- 104SO
        oCdrInfo.Campaign                                                       -- 104SO
        -- BD_SIGNATURE                                                         -- 146SO
        -- 01: ZERO    0=zero charged, 1=nonzero charged
        -- 02: BILLED  1=billed, 0=not billed, 2=uninitialized
        -- 03: MAPSID  E=Error, M=Mapping
        -- 04: MSISDN  T=TFL(42377..), S=others(Swisscom)
        -- 05: PREPAID Y=yes, N=no, U=unknown
        -- 06: RESERVED '-'=unused
        -- 07: RESERVED '-'=unused
        -- 08: RESERVED '-'=unused
        ,  DECODE(oCdrInfo.AmountCustomer,0.0,'0','1')
        || oCdrInfo.CdrBilled
        || oCdrInfo.MappingStateId
        || DECODE(SUBSTR(oCdrInfo.OrigAddress,1,5),'42377','T','S')
        || oCdrInfo.Prepaid                                                     -- 146SO
        || '-'                                                                  -- 147SO
        || '-'                                                                  -- 147SO
        || '-'                                                                  -- 147SO
    );

    if p_SoftErrorId is null and oCdrInfo.MappingStateId <> cstrMappingStateSuccess then
        p_SoftErrorId:= oCdrInfo.ErrorId;                                       -- first error only !
    end if;
    if oCdrInfo.MappingStateId <> cstrMappingStateSuccess then
        p_SoftErrorCount := p_SoftErrorCount + 1;                               -- 152SO
    end if;

    Return;

End INSERT_CSV_ISRV;


Procedure INSERT_CSV_SMSN (
    p_SrcType               In      Varchar2,
    p_BihId                 In      Varchar2,
    p_DataHeader            In      VarChar2,                                   -- 086SO
    p_RecordNr              In      Number,                                     -- 086SO
    p_RecordData            In      Varchar2,                                   -- 086SO
    p_RecordVersion         In      Varchar2,                                   -- 086SO
    p_Inserted              Out     Number,                                     -- 143SO
    p_DateTime              Out     Varchar2,
    p_SoftErrorCount        Out     Number,                                     -- 152SO
    p_SoftErrorId           Out     Varchar2,
    p_SoftErrDesc           Out     Varchar2
)
Is  -- 124SO

    l_RecordData            Varchar2(4000);
    oCdrInfo0               PKG_MEC_HB.tCdrInfo;                                -- untouched empty copy of the structure
    oCdrInfo                PKG_MEC_HB.tCdrInfo;                                -- working copy of the structure

    l_SmscId                Varchar2(10);
    l_FirstSegmentId        Number(8);                                          -- 142SO
    l_LastSegmentId         Number(8);                                          -- 142SO
    l_MsgReference          Varchar2(100);                                      -- 142SO
    l_origin                Varchar2(1);                                        -- 146SO
    l_orignet               Varchar2(1);                                        -- 146SO
    l_dest                  Varchar2(1);                                        -- 146SO
    l_destnet               Varchar2(1);                                        -- 146SO
Begin

    p_Inserted := 0;                                                            -- 143SO
    p_DateTime := NULL;
    p_SoftErrorCount := 0;                                                      -- 152SO
    p_SoftErrorId := NULL;
    p_SoftErrDesc := NULL;

    -- get the Ascii0 value containing the tap-separated data
    l_RecordData                    := p_RecordData;
    -- use the PKG_MEC CdrInfo structure to store the read in values
    -- clear the structure for every data row
    oCdrInfo :=oCdrInfo0;
    -- split the values and assign to the CdrInfo structure one by one, what is needed for this bdetail table
    If  (p_RecordVersion >= PKG_MEC_HB.cAscii0VersionSmsn_01_00_01) Then
        oCdrInfo.MappingStateId         := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);   -- 096SO
        oCdrInfo.OrigAddress            := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.OrigAddressTon         := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.OrigAddressNpi         := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.MsgPid                 := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.DateTime               := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 055SO
        oCdrInfo.RequestTime            := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 055SO
        oCdrInfo.DeliverPid             := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.MsgStatus              := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.ShortId                := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.VsmscId                := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.SegLength              := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.DeliverImsi            := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.OrigGti                := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.DeliverGti             := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.Prepaid                := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.BillingDetailId        := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.RatingZoneId           := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.AmountCustomer         := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.RevenueShareMobile     := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.RevenueShareProvider   := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.TransportCost          := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 031SO
        oCdrInfo.VasContractId          := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.TariffId               := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 057SO-- 017SO
        oCdrInfo.VasPriceModelVersionId := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.InterworkingContractId := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.CdrTypeId              := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 012AA
        oCdrInfo.ForeignRecipient       := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 012AA
        oCdrInfo.InterworkingCase       := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 012AA
        oCdrInfo.ErrorId                := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.CdrBilled              := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.CdrRated               := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.PackingIdHb            := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.OutputHb               := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.Schedule1              := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.Schedule2              := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.Schedule3              := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.OrigSubmitTime         := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 054SO
        oCdrInfo.OrigBillingId          := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 054SO
        oCdrInfo.OnlineCharge           := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 068SO
        oCdrInfo.MsgReference           := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 068SO
        oCdrInfo.OrigImsi               := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 071SO
        oCdrInfo.PpPser                 := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 071SO
        oCdrInfo.Dser                   := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 113SO
        oCdrInfo.OrigSca                := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 113SO
        oCdrInfo.IsGenerated            := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 113SO
        oCdrInfo.ScaOpKey               := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 118SO
        oCdrInfo.OrigGtiOpKey           := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 117SO
        oCdrInfo.DeliverOpKey           := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 117SO
        oCdrInfo.DeliverGtiOpKey        := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 117SO
        oCdrInfo.SubmitMicros           := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 124SO
        oCdrInfo.SubmitGti              := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 124SO
        oCdrInfo.SubmitApp              := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 124SO
        oCdrInfo.OrigCharset            := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 124SO
        oCdrInfo.OrigEsmeId             := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 124SO
        oCdrInfo.OrigIp                 := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 124SO
        oCdrInfo.DeliverMicros          := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 124SO
        oCdrInfo.DeliverAttempt         := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 124SO
        oCdrInfo.DeliverAddress         := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 124SO
        oCdrInfo.DeliverAddressTon      := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 124SO
        oCdrInfo.DeliverAddressNpi      := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 124SO
        oCdrInfo.DeliverEsmeId          := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 124SO
        oCdrInfo.DeliverIp              := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 124SO
        oCdrInfo.MsgReqType             := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 124SO
        oCdrInfo.MsgScheduleTime        := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 124SO
        oCdrInfo.MsgExpiryTime          := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 124SO
        oCdrInfo.SegId                  := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 124SO
        oCdrInfo.SegCount               := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 124SO
        oCdrInfo.ErrorType              := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 124SO
        oCdrInfo.ErrorCode              := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 124SO
        oCdrInfo.DiaResult              := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 124SO
        oCdrInfo.RecipImsi              := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 125SO
        oCdrInfo.RecipAddress           := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 126SO
        oCdrInfo.RecipAddressTon        := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 126SO
        oCdrInfo.RecipAddressNpi        := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 126SO
        oCdrInfo.InterworkingAmount     := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- 128SO
        oCdrInfo.InterworkingApmn       := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- 128SO
        oCdrInfo.InterworkingCurrency   := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- 128SO
        oCdrInfo.InterworkingDirection  := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- 128SO
        oCdrInfo.InterworkingScenario   := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- 128SO
        oCdrInfo.InterworkingState      := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- 128SO
        oCdrInfo.OrigDcs                := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- 136SO
        oCdrInfo.OrigMessageId          := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator); -- 137SO
        oCdrInfo.OrigImei               := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 139SO
        oCdrInfo.DeliverImei            := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 139SO
        oCdrInfo.OrigPaniHeader         := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 140SO -- 139SO
        oCdrInfo.DeliverPaniHeader      := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 141SO
        oCdrInfo.DeliverMapGti          := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 141SO
        oCdrInfo.BioClientId            := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 145SO
        oCdrInfo.BioOrigEsmeId          := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 145SO
        oCdrInfo.BioMsgReference        := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 145SO
        oCdrInfo.RecipEsmeId            := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 145SO
        oCdrInfo.BioRequestType         := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 145SO
        oCdrInfo.MoRoamingPromotion     := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);  -- 147SO

   End If;

    -- All the CDRs with status submit ('4') goto into BDETAIL1 table and
    -- everything else goes to BDETAIL2 table

    If (oCdrInfo.CdrTypeId = cstrCdrTypeHomeRoutedSms) And
        (oCdrInfo.OrigSca is not NULL)then
        -- Lookup SMSCId (BS_SMSCID) using the OrigSca field from the table SMSC
        -- If ServiceCenterAddress is not found then the SMSCs are added to (belong to) a
        -- predefined Operator Contract called 'UNKNOWNTOC'
        l_SmscId := GetSmscId( oCdrInfo.OrigSca, cintCreateSmscForHomeRoutedSms);
    Else
        -- SMSC ID is not needed or not available
        l_SmscId := Null;
    End If;

    p_DateTime := oCdrInfo.DateTime;

    oCdrInfo.RecipAddress := substr(oCdrInfo.RecipAddress,1,20);                -- 133SO
    oCdrInfo.DeliverAddress := substr(oCdrInfo.DeliverAddress,1,20);            -- 133SO

    -- L(p_RecordVersion || '/' || p_DateTime,p_RecordNr);

    if NVL(oCdrInfo.SegId,0) = 0 then                                           -- 144SO
        -- unroll all segments for SMS-EXT/PAGER-EXT
        l_FirstSegmentId := 1;                                                  -- 142SO
        l_LastSegmentId  := NVL(oCdrInfo.SegCount,1);                           -- 144SO -- 142SO
    else
        l_FirstSegmentId := NVL(oCdrInfo.SegId,1);                              -- 144SO -- 142SO
        l_LastSegmentId  := NVL(oCdrInfo.SegId,1);                              -- 144SO -- 142SO
    end if;

    for l_SegmentId in l_FirstSegmentId .. l_LastSegmentId loop                 -- 142SO
        l_MsgReference := oCdrInfo.MsgReference || ExtMsgReferenceSuffix(oCdrInfo.SegId,l_SegmentId); -- 142SO
        -- SegId=0 means multi-segmented external SMS/Pager which needs to be unrolled with multiple SegCount CDRs

        l_origin := CASE
            WHEN oCdrInfo.IsGenerated = 1
            THEN 'G'
            WHEN oCdrInfo.OrigEsmeId IN ('36531','36533')
            THEN 'R'
            WHEN oCdrInfo.OrigIp LIKE 'mscs__.sharedtcs.net:%'
            THEN 'I'
            WHEN oCdrInfo.OrigSca LIKE '4179%'
            THEN 'M'
            WHEN oCdrInfo.OrigSca IS NOT NULL
            THEN 'H'
            WHEN oCdrInfo.CdrTypeId IN ('PAGER-EXT','SMS-EXT')                  -- 151SO
            THEN 'E'
            WHEN oCdrInfo.OrigEsmeId IS NOT NULL
            THEN 'A'
            ELSE 'S'
        END; -- 146SO

        l_orignet := CASE
            WHEN NVL(oCdrInfo.OrigGti,'4179') NOT LIKE '4179%'
            THEN 'F'
            WHEN oCdrInfo.CdrTypeId IN ('IMS-ORMO','RCS-ORMO','SMS-ORMO')
            THEN 'F'
            ELSE 'S'
        END; -- 146SO maybe ToDo: 'C' for CH but not Swisscom

        l_dest := CASE
            WHEN oCdrInfo.CdrTypeId IN ('PAGER-EXT','SMS-EXT')
            THEN 'E'                                                            -- 151SO
            WHEN oCdrInfo.DeliverEsmeId IN ('36531','36533')
            THEN 'R'
            WHEN oCdrInfo.DeliverEsmeId IS NOT NULL
            THEN 'A'
            WHEN oCdrInfo.MsgStatus in ('3','4')
            THEN 'U'
            WHEN oCdrInfo.DeliverIp LIKE 'mscs__.sharedtcs.net:%'
            THEN 'I'
            WHEN oCdrInfo.DeliverImsi IS NOT NULL
            THEN 'S'
            ELSE 'U'
        END; -- 146SO

        l_destnet := CASE
            WHEN oCdrInfo.CdrTypeId IN ('PAGER-EXT')
            THEN 'S'                                                            -- 151SO
            WHEN oCdrInfo.CdrTypeId IN ('SMS-EXT') AND oCdrInfo.DeliverImsi NOT LIKE 'E22801%' 
            THEN 'F'                                                            -- 151SO
            WHEN oCdrInfo.CdrTypeId IN ('SMS-EXT')
            THEN 'S'                                                            -- 151SO
            WHEN oCdrInfo.DeliverGti LIKE '4179%'
            THEN 'S'
            WHEN oCdrInfo.DeliverGti NOT LIKE '4179%'
            THEN 'F'
            WHEN IS_ROAMING_PANI(oCdrInfo.DeliverPaniHeader) = 1
            THEN 'F'                                                            -- 151SO
            ELSE 'S'
        END; -- 146SO maybe ToDo: 'C' for CH but not Swisscom

        If (oCdrInfo.MsgStatus in ('3','4')) Then  -- 131SO
            -- Submit CDR

            Insert Into BDETAIL1 (
                BD_ID,
                BD_SRCTYPE,
                BD_DEMO,
                BD_BIHID,
                BD_MAPSID,
                BD_BIRECNO,
                BD_PACSID1,
                BD_PACSID2,
                BD_PACSID3,
                BD_MSISDN_A,
                BD_TON_A,
                BD_NPI_A,
                BD_PID_A,
                BD_DATETIME,
                BD_PID_B,
                BD_STATUS,
                BD_CONSOLIDATION,
                BD_VSMSCID,
                BD_LENGTH,
                BD_IMSI,
                BD_OGTI,
                BD_DGTI,                                                            -- 069SO
                BD_PREPAID,
                BD_ZNID,
                BD_AMOUNTCU,
                BD_RETSHAREMO,
                BD_RETSHAREPV,
                BD_AMOUNTTR,                                                        -- 031SO
                BD_CONID,
                BD_TARID,                                                           -- 017SO
                BD_TOCID,
                BD_CDRTID,                                                          -- 012AA
                BD_INT,
                BD_IW,
                BD_ERRID,
                BD_BILLED,
                BD_RATED,
                BD_PACIDHB,
                BD_OUTPUTHB,
                BD_ORIGSUBMIT,                                                      -- 054SO
                BD_BILLID,                                                          -- 054SO
                BD_ONLINECHARGE,                                                    -- 068SO
                BD_MESSAGEREFERENCE,                                                -- 068SO
                BD_SMSCID,                                                          -- 070SO
                BD_ORIGINATORIMSI,                                                  -- 071SO
                BD_PPPSER,                                                          -- 071SO
                BD_DSER,                                                            -- 113SO
                BD_ORIGSCA,                                                         -- 113SO
                BD_GENERATED,                                                       -- 114SO
                BD_SCA_OPKEY,                                                       -- 118SO
                BD_OGTI_OPKEY,                                                      -- 117SO
                BD_DELIVER_OPKEY,                                                   -- 117SO
                BD_SUBMIT_US,                                                       -- 124SO
                BD_SUBMIT_GT,
                BD_SUBMIT_APP,
                BD_ORIG_CHARSET,
                BD_ORIG_ESME_ID,
                BD_ORIG_IP,
                BD_DELIVER_ADR,
                BD_DELIVER_TON,
                BD_DELIVER_NPI,
                BD_DELIVER_ESME_ID,
                BD_DELIVER_IP,
                BD_MSGREQTYPE,
                BD_MSGSCHEDULETIME,
                BD_MSGEXPIRYTIME,
                BD_SEG_ID,
                BD_SEG_COUNT,
                BD_ERR_TYPE,
                BD_ERR_CODE,
                BD_DIA_RESULT,
                BD_RECIP_IMSI,                                                  -- 125SO
                BD_RECIP_ADR,                                                   -- 126SO
                BD_RECIP_TON,                                                   -- 126SO
                BD_RECIP_NPI                                                    -- 126SO
                , BD_MSISDN_B                                                   -- 132SO
                , BD_TON_B                                                      -- 132SO
                , BD_NPI_B                                                      -- 132SO
                , BD_ORIG_DCS                                                   -- 136SO
                , BD_ORIG_MSG_ID                                                -- 137SO
                , BD_ORIG_IMEI                                                  -- 139SO
                , BD_PANI_HEADER                                                -- 139SO
                , BD_BIO_CLIENT_ID                                              -- 145SO
                , BD_BIO_ORIG_ESME_ID                                           -- 145SO
                , BD_BIO_MSG_REF                                                -- 145SO
                , BD_RECIP_ESME_ID                                              -- 145SO
                , BD_BIO_REQ_TYPE                                               -- 145SO
                , BD_SIGNATURE                                                  -- 146SO
                , BD_MO_ROAMING_PROM                                            -- 147SO
            )
            Values (
                oCdrInfo.BillingDetailId,
                p_SrcType,
                0,
                p_BihId,
                oCdrInfo.MappingStateId,
                p_RecordNr,
                oCdrInfo.Schedule1,
                oCdrInfo.Schedule2,
                oCdrInfo.Schedule3,
                oCdrInfo.OrigAddress,
                oCdrInfo.OrigAddressTon,
                oCdrInfo.OrigAddressNpi,
                oCdrInfo.MsgPid,
                To_Date(oCdrInfo.DateTime,cstrMecDateTimeFormat),
                oCdrInfo.DeliverPid,
                oCdrInfo.MsgStatus,
                oCdrInfo.ShortId,
                oCdrInfo.VsmscId,
                oCdrInfo.SegLength,
                oCdrInfo.DeliverImsi,
                oCdrInfo.OrigGti,
                oCdrInfo.DeliverGti,                                                -- 069SO
                oCdrInfo.Prepaid,
                oCdrInfo.RatingZoneId,
                oCdrInfo.AmountCustomer,
                oCdrInfo.RevenueShareMobile,
                oCdrInfo.RevenueShareProvider,
                oCdrInfo.TransportCost,                                             -- 032SO -- 031SO
                oCdrInfo.VasContractId,
                oCdrInfo.TariffId,                                                  -- 057SO-- 017SO
                oCdrInfo.InterworkingContractId,
                oCdrInfo.CdrTypeId,                                                 -- 012AA
                oCdrInfo.ForeignRecipient,                                          -- 012AA
                oCdrInfo.InterworkingCase,                                          -- 012AA
                oCdrInfo.ErrorId,
                oCdrInfo.CdrBilled,
                oCdrInfo.CdrRated,
                oCdrInfo.PackingIdHb,
                oCdrInfo.OutputHb,
                To_Date(oCdrInfo.OrigSubmitTime,cstrMecDateTimeFormat),         -- 054SO
                oCdrInfo.OrigBillingId,                                         -- 054SO
                oCdrInfo.OnlineCharge,                                          -- 068SO
                l_MsgReference,                                                 -- 142SO -- 068SO
                l_SmscId,                                                       -- 070SO
                oCdrInfo.OrigImsi,                                              -- 071SO
                oCdrInfo.PpPser,                                                -- 071SO
                oCdrInfo.Dser,                                                  -- 113SO
                oCdrInfo.OrigSca,                                               -- 113SO
                oCdrInfo.IsGenerated,                                           -- 114SO
                oCdrInfo.ScaOpKey,                                              -- 118SO
                oCdrInfo.OrigGtiOpKey,                                          -- 117SO
                oCdrInfo.DeliverOpKey,                                          -- 117SO
                oCdrInfo.SubmitMicros,                                          -- 'BD_SUBMIT_US'
                oCdrInfo.SubmitGti,                                             -- 'BD_SUBMIT_GT'
                oCdrInfo.SubmitApp,                                             -- 'BD_SUBMIT_APP'
                oCdrInfo.OrigCharset,                                           -- 'BD_ORIG_CHARSET'
                oCdrInfo.OrigEsmeId,                                            -- 'BD_ORIG_ESME_ID'
                oCdrInfo.OrigIp,                                                -- 'BD_ORIG_IP'
                oCdrInfo.DeliverAddress,                                        -- 'BD_DELIVER_ADR'
                oCdrInfo.DeliverAddressTon,                                     -- 'BD_DELIVER_TON'
                oCdrInfo.DeliverAddressNpi,                                     -- 'BD_DELIVER_NPI'
                oCdrInfo.DeliverEsmeId,                                         -- 'BD_DELIVER_ESME_ID'
                oCdrInfo.DeliverIp,                                             -- 'BD_DELIVER_IP'
                oCdrInfo.MsgReqType,                                            -- 'BD_MSGREQTYPE'
                to_date(oCdrInfo.MsgScheduleTime,cstrMecDateTimeFormat),        -- 'BD_MSGSCHEDULETIME' -- 130SO
                to_date(oCdrInfo.MsgExpiryTime,cstrMecDateTimeFormat),          -- 'BD_MSGEXPIRYTIME'   -- 130SO
                l_SegmentId,                                                    -- 'BD_SEG_ID'          -- 142SO
                oCdrInfo.SegCount,                                              -- 'BD_SEG_COUNT'
                oCdrInfo.ErrorType,                                             -- 'BD_ERR_TYPE'
                oCdrInfo.ErrorCode,                                             -- 'BD_ERR_CODE'
                oCdrInfo.DiaResult,                                             -- 'BD_DIA_RESULT'
                oCdrInfo.RecipImsi,                                             -- 'BD_RECIP_IMSI' -- 125SO
                oCdrInfo.RecipAddress,                                          -- 'BD_RECIP_ADR'  -- 126SO
                oCdrInfo.RecipAddressTon,                                       -- 'BD_RECIP_TON'  -- 126SO
                oCdrInfo.RecipAddressNpi                                        -- 'BD_RECIP_NPI'  -- 126SO
                , oCdrInfo.DeliverAddress                                       -- BD_MSISDN_B -- 132SO
                , oCdrInfo.DeliverAddressTon                                    -- BD_TON_B -- 132SO
                , oCdrInfo.DeliverAddressNpi                                    -- BD_NPI_B -- 132SO
                , oCdrInfo.OrigDcs                                              -- BD_ORIG_DCS -- 136SO
                , oCdrInfo.OrigMessageId                                        -- BD_ORIG_MSG_ID -- 137SO
                , oCdrInfo.OrigImei                                             -- BD_ORIG_IMEI -- 139SO
                , oCdrInfo.OrigPaniHeader                                       -- BD_PANI_HEADER -- 140SO -- 139SO
                , oCdrInfo.BioClientId                                          -- BD_BIO_CLIENT_ID     -- 145SO
                , oCdrInfo.BioOrigEsmeId                                        -- BD_BIO_ORIG_ESME_ID  -- 145SO
                , oCdrInfo.BioMsgReference                                      -- BD_BIO_MSG_REF       -- 145SO
                , oCdrInfo.RecipEsmeId                                          -- BD_RECIP_ESME_ID     -- 145SO
                , oCdrInfo.BioRequestType                                       -- BD_BIO_REQ_TYPE      -- 145SO
                -- BD_SIGNATURE                                                 -- 146SO
                -- 01: ZERO     0=zero charged, 1=nonzero charged or not charged
                -- 02: BILLED   1=billed, 0=not billed, 2=uninitialized, ... 8=recv-frng , 9=ogti-frng (see table BDBSTATE)
                -- 03: MAPSID   E=Error, M=Mapping
                -- 04: ORIGIN   S=SS7, I=IMS, E=SMSBroker, R=RCS, A=AO, G=Generated, H=HomeRouted, M=M2M(HRON)
                -- 05: ORIGNET  S=System(Swisscom+TFL), C=CH, F=Foreign, U=Unknown
                -- 06: DEST     S=SS7, I=IMS, E=Extern, R=RCS, A=AT, U=Unknown
                -- 07: DESTNET  S=System(Swisscom+TFL), C=CH, F=Foreign, U=Unknown
                -- 08: MSISDN   T=TFL(42377..), S=others(Swisscom)
                -- 09: PREPAID  Y=yes, N=no, U=unknown
                -- 10: TARID    L=LA, S=BN-IS, P=Portal-IS, I=Tariff i, T=Televote, V=free-free, X=intern or '-' =P2P
                -- 11: STATUS   0=delivered, 1=expired, 2=deleted, 3=replaced, 4=submitted
                -- 12: BIOREQT  0=standalone (chargeable), 1=standalone+link (not chargeable), 2=break_out_delivery, U=unknown  -- 147SO
                -- 13: RATZONE  0=normal, 1=la-handygroup(SMS-HG-a/SMS-HG-b/SMS-HG-d) -- 147SO
                -- 14: MOPROM   0=no, 1=yes                                     -- 147SO
                -- 15: RESERVED '-'=unused                                      -- 147SO
                -- 16: RESERVED '-'=unused                                      -- 147SO
                -- 17: RESERVED '-'=unused                                      -- 147SO
                ,  DECODE(oCdrInfo.AmountCustomer,0.0,'0','1')
                || oCdrInfo.CdrBilled
                || oCdrInfo.MappingStateId
                || l_origin
                || l_orignet
                || l_dest
                || l_destnet
                || DECODE(SUBSTR(l_origin || oCdrInfo.OrigAddress,1,6),'S42377','T','I42377','T','R42377','T','S')
                || NVL(oCdrInfo.Prepaid,'-')
                || DECODE(oCdrInfo.TariffId,'X','X','V','V','S','S','P','P','T','T',NULL,'-','L')
                || oCdrInfo.MsgStatus
                || DECODE(oCdrInfo.BioRequestType,0,'0',1,'1',2,'2',NULL,'U')
                || DECODE(SUBSTR(oCdrInfo.RatingZoneId,1,6),'SMS-HG','1','0')   -- 147SO
                || DECODE(oCdrInfo.MoRoamingPromotion,1,'1','0')                -- 147SO
                || '-'                                                          -- 147SO
                || '-'                                                          -- 147SO
                || '-'                                                          -- 147SO
                , oCdrInfo.MoRoamingPromotion                                   -- 147SO
            );
        Else
            Insert into BDETAIL2 (
                BD_ID,
                BD_SRCTYPE,
                BD_DEMO,
                BD_BIHID,
                BD_MAPSID,
                BD_BIRECNO,
                BD_PACSID1,
                BD_PACSID2,
                BD_PACSID3,
                BD_MSISDN_A,
                BD_TON_A,
                BD_NPI_A,
                BD_PID_A,
                BD_DATETIME,
                BD_DATESUBMIT,
                BD_PID_B,
                BD_STATUS,
                BD_CONSOLIDATION,
                BD_VSMSCID,
                BD_LENGTH,
                BD_IMSI,
                BD_PREPAID,
                BD_OGTI,
                BD_DGTI,
                BD_AMOUNTCU,
                BD_RETSHAREMO,
                BD_RETSHAREPV,
                BD_CONID,
                BD_TARID,                                                           -- 017SO
                BD_ZNID,
                BD_TOCID,
                BD_CDRTID,                                                          -- 012AA
                BD_INT,                                                             -- 012AA
                BD_IW,                                                              -- 012AA
                BD_ERRID,
                BD_BILLED,
                BD_RATED,
                BD_PACIDHB,
                BD_OUTPUTHB,
                BD_ORIGSUBMIT,                                                      -- 054SO
                BD_BILLID,                                                          -- 054SO
                BD_ONLINECHARGE,                                                    -- 068SO
                BD_MESSAGEREFERENCE,                                                -- 068SO
                BD_SMSCID,                                                          -- 070SO
                BD_ORIGINATORIMSI,
                BD_DSER,                                                            -- 113SO
                BD_ORIGSCA,                                                         -- 113SO
                BD_GENERATED,                                                       -- 114SO
                BD_SCA_OPKEY,                                                       -- 118SO
                BD_OGTI_OPKEY,                                                      -- 117SO
                BD_DELIVER_OPKEY,                                                   -- 117SO
                BD_DGTI_OPKEY,                                                      -- 117SO
                BD_SUBMIT_US,                                                       -- 124SO
                BD_SUBMIT_GT,
                BD_SUBMIT_APP,
                BD_ORIG_CHARSET,
                BD_ORIG_ESME_ID,
                BD_ORIG_IP,
                BD_DELIVER_US,
                BD_DELIVER_ATT,
                BD_DELIVER_ADR,
                BD_DELIVER_TON,
                BD_DELIVER_NPI,
                BD_DELIVER_ESME_ID,
                BD_DELIVER_IP,
                BD_MSGREQTYPE,
                BD_MSGSCHEDULETIME,
                BD_MSGEXPIRYTIME,
                BD_SEG_ID,
                BD_SEG_COUNT,
                BD_ERR_TYPE,
                BD_ERR_CODE,
                BD_DIA_RESULT,
                BD_RECIP_IMSI,                                                  -- 125SO
                BD_RECIP_ADR,                                                   -- 126SO
                BD_RECIP_TON,                                                   -- 126SO
                BD_RECIP_NPI                                                    -- 126SO
                , BD_IW_AMOUNT                                                  -- 128SO
                , BD_IW_APMN                                                    -- 128SO
                , BD_IW_CURID                                                   -- 128SO
                , BD_IW_DIR                                                     -- 128SO
                , BD_IW_SCENARIO                                                -- 128SO
                , BD_IW_CONSTATE                                                -- 128SO
                , BD_MSISDN_B                                                   -- 132SO
                , BD_TON_B                                                      -- 132SO
                , BD_NPI_B                                                      -- 132SO
                , BD_AMOUNTTR                                                   -- 135SO
                , BD_ORIG_DCS                                                   -- 136SO
                , BD_ORIG_MSG_ID                                                -- 137SO
                , BD_ORIG_IMEI                                                  -- 139SO
                , BD_DELIVER_IMEI                                               -- 139SO
                , BD_PANI_HEADER                                                -- 139SO
                , BD_DELIVER_PANI_HEADER                                        -- 141SO
                , BD_DELIVER_MAP_GTI                                            -- 141SO
                , BD_BIO_CLIENT_ID                                              -- 145SO
                , BD_BIO_ORIG_ESME_ID                                           -- 145SO
                , BD_BIO_MSG_REF                                                -- 145SO
                , BD_RECIP_ESME_ID                                              -- 145SO
                , BD_BIO_REQ_TYPE                                               -- 145SO
                , BD_SIGNATURE                                                  -- 146SO
                , BD_MO_ROAMING_PROM                                            -- 147SO
            )
            Values (
                oCdrInfo.BillingDetailId,
                p_SrcType,
                0,
                p_BihId,
                oCdrInfo.MappingStateId,
                p_RecordNr,
                oCdrInfo.Schedule1,
                oCdrInfo.Schedule2,
                oCdrInfo.Schedule3,
                oCdrInfo.OrigAddress,
                oCdrInfo.OrigAddressTon,
                oCdrInfo.OrigAddressNpi,
                oCdrInfo.MsgPid,
                To_Date(oCdrInfo.DateTime,cstrMecDateTimeFormat),               -- 055SO
                To_Date(oCdrInfo.RequestTime,cstrMecDateTimeFormat),
                oCdrInfo.DeliverPid,
                oCdrInfo.MsgStatus,
                oCdrInfo.ShortId,
                oCdrInfo.VsmscId,
                oCdrInfo.SegLength,
                oCdrInfo.DeliverImsi,
                oCdrInfo.Prepaid,
                oCdrInfo.OrigGti,
                oCdrInfo.DeliverGti,
                oCdrInfo.AmountCustomer,
                oCdrInfo.RevenueShareMobile,
                oCdrInfo.RevenueShareProvider,
                oCdrInfo.VasContractId,
                oCdrInfo.TariffId,                                              -- 057SO-- 017SO
                oCdrInfo.RatingZoneId,
                oCdrInfo.InterworkingContractId,
                oCdrInfo.CdrTypeId,                                             -- 012AA
                oCdrInfo.ForeignRecipient,                                      -- 012AA
                oCdrInfo.InterworkingCase,                                      -- 012AA
                oCdrInfo.ErrorId,
                oCdrInfo.CdrBilled,
                oCdrInfo.CdrRated,
                oCdrInfo.PackingIdHb,
                oCdrInfo.OutputHb,
                To_Date(oCdrInfo.OrigSubmitTime,cstrMecDateTimeFormat),         -- 054SO
                oCdrInfo.OrigBillingId,                                         -- 054SO
                oCdrInfo.OnlineCharge,                                          -- 068SO
                l_MsgReference,                                                 -- 142SO -- 068SO
                l_SmscId,                                                       -- 070SO
                oCdrInfo.OrigImsi,
                oCdrInfo.Dser,                                                  -- 113SO
                oCdrInfo.OrigSca,                                               -- 113SO
                oCdrInfo.IsGenerated,                                           -- 114SO
                oCdrInfo.ScaOpKey,                                              -- 118SO
                oCdrInfo.OrigGtiOpKey,                                          -- 117SO
                oCdrInfo.DeliverOpKey,                                          -- 117SO
                oCdrInfo.DeliverGtiOpKey,                                       -- 117SO
                oCdrInfo.SubmitMicros,                                          -- 'BD_SUBMIT_US'
                oCdrInfo.SubmitGti,                                             -- 'BD_SUBMIT_GT'
                oCdrInfo.SubmitApp,                                             -- 'BD_SUBMIT_APP'
                oCdrInfo.OrigCharset,                                           -- 'BD_ORIG_CHARSET'
                oCdrInfo.OrigEsmeId,                                            -- 'BD_ORIG_ESME_ID'
                oCdrInfo.OrigIp,                                                -- 'BD_ORIG_IP'
                oCdrInfo.DeliverMicros,                                         -- 'BD_DELIVER_US'
                oCdrInfo.DeliverAttempt,                                        -- 'BD_DELIVER_ATT'
                oCdrInfo.DeliverAddress,                                        -- 'BD_DELIVER_ADR'
                oCdrInfo.DeliverAddressTon,                                     -- 'BD_DELIVER_TON'
                oCdrInfo.DeliverAddressNpi,                                     -- 'BD_DELIVER_NPI'
                oCdrInfo.DeliverEsmeId,                                         -- 'BD_DELIVER_ESME_ID'
                oCdrInfo.DeliverIp,                                             -- 'BD_DELIVER_IP'
                oCdrInfo.MsgReqType,                                            -- 'BD_MSGREQTYPE'
                to_date(oCdrInfo.MsgScheduleTime,cstrMecDateTimeFormat),        -- 'BD_MSGSCHEDULETIME' -- 130SO
                to_date(oCdrInfo.MsgExpiryTime,cstrMecDateTimeFormat),          -- 'BD_MSGEXPIRYTIME'   -- 130SO
                l_SegmentId,                                                    -- 'BD_SEG_ID'          -- 142SO
                oCdrInfo.SegCount,                                              -- 'BD_SEG_COUNT'
                oCdrInfo.ErrorType,                                             -- 'BD_ERR_TYPE'
                oCdrInfo.ErrorCode,                                             -- 'BD_ERR_CODE'
                oCdrInfo.DiaResult,                                             -- 'BD_DIA_RESULT'
                oCdrInfo.RecipImsi,                                             -- 'BD_RECIP_IMSI'-- 125SO
                oCdrInfo.RecipAddress,                                          -- 'BD_RECIP_ADR'  -- 126SO
                oCdrInfo.RecipAddressTon,                                       -- 'BD_RECIP_TON'  -- 126SO
                oCdrInfo.RecipAddressNpi                                        -- 'BD_RECIP_NPI'  -- 126SO
                , oCdrInfo.InterworkingAmount                                   -- 'BD_IW_AMOUNT'   -- 128SO
                , oCdrInfo.InterworkingApmn                                     -- 'BD_IW_APMN'     -- 128SO
                , oCdrInfo.InterworkingCurrency                                 -- 'BD_IW_CURID'    -- 128SO
                , oCdrInfo.InterworkingDirection                                -- 'BD_IW_DIR'      -- 128SO
                , oCdrInfo.InterworkingScenario                                 -- 'BD_IW_SCENARIO' -- 128SO
                , oCdrInfo.InterworkingState                                    -- 'BD_IW_CONSTATE' -- 128SO
                , oCdrInfo.DeliverAddress                                       -- BD_MSISDN_B -- 132SO
                , oCdrInfo.DeliverAddressTon                                    -- BD_TON_B -- 132SO
                , oCdrInfo.DeliverAddressNpi                                    -- BD_NPI_B -- 132SO
                , oCdrInfo.TransportCost                                        -- BD_AMOUNTTR  -- 135SO
                , oCdrInfo.OrigDcs                                              -- BD_ORIG_DCS -- 136SO
                , oCdrInfo.OrigMessageId                                        -- BD_ORIG_MSG_ID -- 137SO
                , oCdrInfo.OrigImei                                             -- BD_ORIG_IMEI -- 139SO
                , oCdrInfo.DeliverImei                                          -- BD_DELIVER_IMEI -- 139SO
                , oCdrInfo.OrigPaniHeader                                       -- BD_PANI_HEADER -- 140SO-- 139SO
                , oCdrInfo.DeliverPaniHeader                                    -- BD_DELIVER_PANI_HEADER -- 141SO
                , oCdrInfo.DeliverMapGti                                        -- BD_DELIVER_MAP_GTI  -- 141SO
                , oCdrInfo.BioClientId                                          -- BD_BIO_CLIENT_ID     -- 145SO
                , oCdrInfo.BioOrigEsmeId                                        -- BD_BIO_ORIG_ESME_ID  -- 145SO
                , oCdrInfo.BioMsgReference                                      -- BD_BIO_MSG_REF       -- 145SO
                , oCdrInfo.RecipEsmeId                                          -- BD_RECIP_ESME_ID     -- 145SO
                , oCdrInfo.BioRequestType                                       -- BD_BIO_REQ_TYPE      -- 145SO
                -- BD_SIGNATURE                                                 -- 146SO
                -- 01: ZERO     0=zero charged, 1=nonzero charged or not charged
                -- 02: BILLED   1=billed, 0=not billed, 2=uninitialized, ... 8=recv-frng , 9=ogti-frng (see table BDBSTATE)
                -- 03: MAPSID   E=Error, M=Mapping
                -- 04: ORIGIN   S=SS7, I=IMS, E=SMSBroker, R=RCS, A=AO, G=Generated, H=HomeRouted, M=M2M(HRON)
                -- 05: ORIGNET  S=System(Swisscom+TFL), C=CH, F=Foreign, U=Unknown
                -- 06: DEST     S=SS7, I=IMS, E=Extern, R=RCS, A=AT, U=Unknown
                -- 07: DESTNET  S=System(Swisscom+TFL), C=CH, F=Foreign, U=Unknown
                -- 08: MSISDN   T=TFL(42377..), S=others(Swisscom)
                -- 09: PREPAID  Y=yes, N=no, U=unknown
                -- 10: TARID    L=LA, S=BN-IS, P=Portal-IS, I=Tariff i, T=Televote, V=free-free, X=intern or '-' =P2P
                -- 11: STATUS   0=delivered, 1=expired, 2=deleted, 3=replaced, 4=submitted
                -- 12: BIOREQT  0=standalone (chargeable), 1=standalone+link (not chargeable), 2=break_out_delivery, U=unknown  -- 147SO
                -- 13: RATZONE  0=normal, 1=la-handygroup(SMS-HG-a/SMS-HG-b/SMS-HG-d) -- 147SO
                -- 14: MOPROM   0=no, 1=yes                                     -- 147SO
                -- 15: RESERVED '-'=unused                                      -- 147SO
                -- 16: RESERVED '-'=unused                                      -- 147SO
                -- 17: RESERVED '-'=unused                                      -- 147SO
                ,  DECODE(oCdrInfo.AmountCustomer,0.0,'0','1')
                || oCdrInfo.CdrBilled
                || oCdrInfo.MappingStateId
                || l_origin
                || l_orignet
                || l_dest
                || l_destnet
                || DECODE(SUBSTR(l_dest || oCdrInfo.DeliverAddress,1,6),'S42377','T','I42377','T','R42377','T','S')
                || NVL(oCdrInfo.Prepaid,'-')
                || DECODE(oCdrInfo.TariffId,'X','X','V','V','S','S','P','P','T','T',NULL,'-','L')
                || oCdrInfo.MsgStatus
                || DECODE(oCdrInfo.BioRequestType,0,'0',1,'1',2,'2',NULL,'U')
                || DECODE(SUBSTR(oCdrInfo.RatingZoneId,1,6),'SMS-HG','1','0')   -- 147SO
                || DECODE(oCdrInfo.MoRoamingPromotion,1,'1','0')                -- 147SO
                || '-'                                                          -- 147SO
                || '-'                                                          -- 147SO
                || '-'                                                          -- 147SO
                , oCdrInfo.MoRoamingPromotion                                   -- 147SO
            );

            if not (l_SmscId is NULL) and oCdrInfo.Schedule1 = 'S' then
                -- Populate archive table for SC terminating IW SMS
                INSERT INTO SMS_IW_MT_ARCH (
                   BDA_DAY ,
                   BDA_SMSCID,
                   BDA_BIHID,
                   BDA_BIRECNO,
                   BDA_SCA,
                   BDA_DATETIME,
                   BDA_MSISDN_A,
                   BDA_IMSI,
                   BDA_MSISDN_B,
                   BDA_MSCID
                ) VALUES (
                      TRUNC(To_Date(oCdrInfo.DateTime,cstrMecDateTimeFormat)),
                      l_SmscId,
                      p_BihId,
                      p_RecordNr,
                      oCdrInfo.OrigSca,                                             -- 125SO
                      To_Date(oCdrInfo.DateTime,cstrMecDateTimeFormat),
                      oCdrInfo.RecipAddress,
                      oCdrInfo.RecipImsi,                                           -- 126SO
                      oCdrInfo.OrigAddress,
                      oCdrInfo.SubmitGti
                );
            end if;
        End If;
        p_Inserted := p_Inserted + 1;                                           -- 143SO
        if p_SoftErrorId is null and oCdrInfo.MappingStateId <> cstrMappingStateSuccess then
            p_SoftErrorId:= oCdrInfo.ErrorId;                                   -- first error only !
        end if;
        if oCdrInfo.MappingStateId <> cstrMappingStateSuccess then
            p_SoftErrorCount := p_SoftErrorCount + 1;                           -- 152SO
        end if;
    end loop;


    Return;
/*
Exception
    When others then
        -- 110SO
        L('p_BihId**********',p_BihId);
        L('p_RecordNr*******',p_RecordNr);
        L('Error*******',PKG_COMMON.getHardErrorDesc);  -- 130SO
        L('BD_AMOUNTCU',oCdrInfo.AmountCustomer);
        L('BD_BIHID',p_BihId);
        L('BD_BILLED',oCdrInfo.CdrBilled);
        L('BD_BILLID',oCdrInfo.OrigBillingId);
        L('BD_BIRECNO',p_RecordNr);
        L('BD_CDRTID',oCdrInfo.CdrTypeId);
        L('BD_CONID',oCdrInfo.VasContractId);
        L('BD_CONSOLIDATION',oCdrInfo.ShortId);
        L('BD_DATESUBMIT',oCdrInfo.SubmitTime);
        L('BD_DATETIME',oCdrInfo.DateTime);
        L('BD_DELIVER_ADR',oCdrInfo.DeliverAddress);
        L('BD_DELIVER_ATT',oCdrInfo.DeliverAttempt);
        L('BD_DELIVER_ESME_ID',oCdrInfo.DeliverEsmeId);
        L('BD_DELIVER_IP',oCdrInfo.DeliverIp);
        -- L('BD_DELIVER_NPI',oCdrInfo.DeliverNpi);
        -- L('BD_DELIVER_TON',oCdrInfo.DeliverTon);
        L('BD_DELIVER_US',oCdrInfo.DeliverMicros);
        L('BD_DEMO',0);
        L('BD_DGTI',oCdrInfo.DeliverGti);
        L('BD_DGTI_OPKEY',oCdrInfo.DeliverGtiOpKey);
        L('BD_DIA_RESULT',oCdrInfo.DiaResult);
        L('BD_ERRID',oCdrInfo.ErrorId);
        L('BD_ERR_CODE',oCdrInfo.ErrorCode);
        L('BD_ERR_TYPE',oCdrInfo.ErrorType);
        L('BD_ID',oCdrInfo.BillingDetailId);
        L('BD_IMSI',oCdrInfo.DeliverImsi);
        L('BD_INT',oCdrInfo.ForeignRecipient);
        L('BD_IW',oCdrInfo.InterworkingCase);
        L('BD_LENGTH',oCdrInfo.SegLength);
        L('BD_MAPSID',oCdrInfo.MappingStateId);
        L('BD_MESSAGEREFERENCE',oCdrInfo.MsgReference);
        L('BD_MSGEXPIRYTIME',oCdrInfo.MsgExpiryTime);
        L('BD_MSGREQTYPE',oCdrInfo.MsgReqType);
        L('BD_MSGSCHEDULETIME',oCdrInfo.MsgScheduleTime);
        L('BD_MSISDN_A',oCdrInfo.OrigAddress);
        L('BD_MSISDN_B',oCdrInfo.RecipAddress);
        L('BD_NPI_A',oCdrInfo.OrigAddressNpi);
        L('BD_NPI_B',oCdrInfo.RecipAddressNpi);
        L('BD_OGTI',oCdrInfo.OrigGti);
        L('BD_OGTI_OPKEY',oCdrInfo.OrigGtiOpKey);
        L('BD_ONLINECHARGE',oCdrInfo.OnlineCharge);
        L('BD_ORIGSUBMIT',oCdrInfo.OrigSubmitTime);
        L('BD_ORIG_CHARSET',oCdrInfo.OrigCharset);
        L('BD_ORIG_SUBMIT_APP',oCdrInfo.SubmitApp);
        L('BD_ORIG_ESME_ID',oCdrInfo.OrigEsmeId);
        L('BD_ORIG_IP',oCdrInfo.OrigIp);
        L('BD_OUTPUTHB',oCdrInfo.OutputHb);
        L('BD_PACIDHB',oCdrInfo.PackingIdHb);
        L('BD_PACSID1',oCdrInfo.Schedule1);
        L('BD_PACSID2',oCdrInfo.Schedule2);
        L('BD_PACSID3',oCdrInfo.Schedule3);
        L('BD_PID_A',oCdrInfo.MsgPid);
        L('BD_PID_B',oCdrInfo.DeliverPid);
        L('BD_PREPAID',oCdrInfo.Prepaid);
        L('BD_RATED',oCdrInfo.CdrRated);
        L('BD_RECIP_IMSI',oCdrInfo.RecipImsi);
        L('BD_DELIVER_OPKEY',oCdrInfo.DeliverOpKey);
        L('BD_RETSHAREMO',oCdrInfo.RevenueShareMobile);
        L('BD_RETSHAREPV',oCdrInfo.RevenueShareProvider);
        L('BD_SCA_OPKEY',oCdrInfo.ScaOpKey);
        L('BD_SEG_COUNT',oCdrInfo.Segcount);
        L('BD_SEG_ID',oCdrInfo.SegId);
        L('BD_SMSCID',l_SmscId);
        L('BD_SRCTYPE',p_SrcType);
        L('BD_STATUS',oCdrInfo.MsgStatus);
        L('BD_SUBMIT_APP',oCdrInfo.SubmitApp);
        L('BD_SUBMIT_GT',oCdrInfo.SubmitMicros);
        L('BD_TARID',oCdrInfo.TariffId);
        L('BD_TOCID',oCdrInfo.InterworkingContractId);
        L('BD_TON_A',oCdrInfo.OrigAddressTon);
        L('BD_TON_B',oCdrInfo.RecipAddressTon);
        L('BD_VSMSCID',oCdrInfo.VsmscId);
        L('BD_ZNID',oCdrInfo.RatingZoneId);
        L('BD_IW_AMOUNT',oCdrInfo.InterworkingAmount);      -- 130SO
        L('BD_IW_APMN',oCdrInfo.InterworkingApmn);          -- 130SO
        L('BD_IW_CURID',oCdrInfo.InterworkingCurrency);     -- 130SO
        L('BD_IW_DIR',oCdrInfo.InterworkingDirection);      -- 130SO
        L('BD_IW_SCENARIO',oCdrInfo.InterworkingScenario);  -- 130SO
        L('BD_IW_CONSTATE',oCdrInfo.InterworkingState);     -- 130SO
       RAISE;
*/
End INSERT_CSV_SMSN;


Procedure INSERT_CSV_POS (                                                      -- 036AA
    p_SrcType               In      Varchar2,
    p_BihId                 In      Varchar2,
    p_DataHeader            In      VarChar2,       -- 086SO
    p_RecordNr              In      Number,         -- 086SO
    p_RecordData            In      Varchar2,       -- 086SO
    p_RecordVersion         In      Varchar2,       -- 086SO
    p_Inserted              Out     Number,         -- 143SO
    p_DateTime              Out     Varchar2,
    p_SoftErrorCount        Out     Number,         -- 152SO
    p_SoftErrorId           Out     Varchar2,
    p_SoftErrDesc           Out     Varchar2
)
Is  -- 086SO

    l_RecordData            Varchar2(4000);
    oCdrInfo0               PKG_MEC_HB.tCdrInfo;                                -- 008AA(020SO)   -- untouched empty copy of the structure
    oCdrInfo                PKG_MEC_HB.tCdrInfo;                                -- 008AA(020SO)   -- working copy of the structure

    l_TimeOffset            Varchar2(5);                                        -- for pos
    l_NumMsgs               Varchar2(20);
    l_CallType              Varchar2(2);
    l_ServedPartyCgi        Varchar2(25);
    l_GsmPi                 Varchar2(3);
    l_Remark                Varchar2(160);                                      -- 069SO
    l_UtxParams             Varchar2(15);
    l_product_channel_id    Varchar2(10);                                       -- 059SO

Begin

    p_Inserted := 1;                                                            -- 143SO
    p_DateTime := NULL;
    p_SoftErrorCount := 0;                                                      -- 152SO
    p_SoftErrorId := NULL;
    p_SoftErrDesc := NULL;

    -- get the Ascii0 value containing the tap-separated data
    l_RecordData                    := p_RecordData;
    -- use the PKG_MEC CdrInfo structure to store the read in values
    -- clear the structure for every data row
    oCdrInfo :=oCdrInfo0;
    -- split the values and assign to the CdrInfo structure one by one, what is needed for this bdetail table -- 008AA(020SO)
    If (p_RecordVersion >= PKG_MEC_HB.cAscii0VersionUfih_01_00_01) Then      -- 057SO
        oCdrInfo.MappingStateId         := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);   -- 096SO
        oCdrInfo.RequestTime            := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        l_TimeOffset                    := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        l_NumMsgs                       := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        l_CallType                      := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.OrigAddress            := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        l_ServedPartyCgi                := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        l_GsmPi                         := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        l_Remark                        := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.RatedUnits             := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.AmountCustomer         := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        l_UtxParams                     := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.Prepaid                := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.ContractSubType        := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.CdrTypeId              := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.ForeignRecipient       := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.InterworkingCase       := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.ErrorId                := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.BillingDetailId        := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.AaaTopStopUpdated      := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.CdrBilled              := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.CdrRated               := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.PackingIdHb            := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.OutputHb               := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.Schedule1              := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.Schedule2              := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
        oCdrInfo.Schedule3              := PKG_COMMON.CutFirstItem(l_RecordData, cstrFieldSeparator);
    End If;

    p_DateTime := oCdrInfo.RequestTime;

    l_product_channel_id := NULL;                                               -- 059SO

    Insert Into BDETAIL9 (
        BD_ID,
        BD_SRCTYPE,
        BD_DEMO,
        BD_BIHID,
        BD_BIRECNO,
        BD_DATETIME,
        BD_OFFSET,
        BD_NUMMSG,
        BD_CALLTYPE,
        BD_MSISDN,
        BD_CGI,
        BD_GSMPI,
        BD_REMARK,
        BD_RATEDUNITS,
        BD_AMOUNTCU,
        BD_UTXPARAMS,
        BD_MAPSID,
        BD_PREPAID,
        BD_CONSTID,
        BD_CDRTID,
        BD_INT,
        BD_IW,
        BD_ERRID,
        BD_AAATS,
        BD_BILLED,
        BD_RATED,
        BD_PACIDHB,
        BD_OUTPUTHB,
        BD_PACSID1,
        BD_PACSID2,
        BD_PACSID3,
        BD_VSPRCID                                                              -- 059SO
    )
    Values (
        oCdrInfo.BillingDetailId,
        p_SrcType,
        0,
        p_BihId,
        p_RecordNr,
        To_Date(oCdrInfo.RequestTime,cstrMecDateTimeFormat),
        l_TimeOffset,
        l_NumMsgs,
        l_CallType,
        oCdrInfo.OrigAddress,
        l_ServedPartyCgi,
        l_GsmPi,
        l_Remark,
        oCdrInfo.RatedUnits,
        oCdrInfo.AmountCustomer,
        l_UtxParams,
        oCdrInfo.MappingStateId,
        oCdrInfo.Prepaid,
        oCdrInfo.ContractSubType,
        oCdrInfo.CdrTypeId,
        oCdrInfo.ForeignRecipient,
        oCdrInfo.InterworkingCase,
        oCdrInfo.ErrorId,
        oCdrInfo.AaaTopStopUpdated,
        oCdrInfo.CdrBilled,
        oCdrInfo.CdrRated,
        oCdrInfo.PackingIdHb,
        oCdrInfo.OutputHb,
        oCdrInfo.Schedule1,
        oCdrInfo.Schedule2,
        oCdrInfo.Schedule3,
        l_product_channel_id                                                    -- 059SO
    );
    if p_SoftErrorId is null and oCdrInfo.MappingStateId <> cstrMappingStateSuccess then
        p_SoftErrorId:= oCdrInfo.ErrorId;                                       -- first error only !
    end if;
    if oCdrInfo.MappingStateId <> cstrMappingStateSuccess then
        p_SoftErrorCount := p_SoftErrorCount + 1;                               -- 152SO
    end if;

    Return;

--Exception
--    When others then
--        RAISE;
End INSERT_CSV_POS;


Procedure SP_INSERT_HEADER (
    p_BIH_ID            In Out  Varchar2,
    p_BIH_DEMO          In      Number,
    p_BIH_FILESEQ       In      Number,
    p_BIH_FILENAME      In      Varchar2,
    p_BIH_FILEDATE      In      Varchar2,
    p_BIH_MAPID         In      Varchar2,
    p_AppName           In      Varchar2,
    p_AppVer            In      Varchar2,
    p_Thread            In      Varchar2,
    p_JobId             In      Number,
    p_HostName          In      Varchar2,
    p_Status            In      Varchar,
    p_ErrorCode         Out     Number,
    p_ErrorDesc         Out     Varchar2,
    p_ReturnStatus      Out     Number
    )
Is  -- 075SO
Begin

    PKG_COMMON_MAPPING.INSERT_BIHEADER(                                         -- 085SO -- 083SO -- 082SO
        p_BIH_ID,
        p_BIH_DEMO,
        p_BIH_FILESEQ,
        p_BIH_FILENAME,
        p_BIH_FILEDATE,
        p_BIH_MAPID,
        p_AppName,
        p_AppVer,
        p_Thread,
        p_JobId,
        p_HostName,
        P_Status
    );

    p_ReturnStatus := PKG_COMMON.RETURN_STATUS_OK;

Exception
    when PKG_COMMON.EXCP_RDY_ERR_HEADER_FOUND then
        p_ErrorCode := PKG_COMMON.ENO_RDY_ERR_HEADER_FOUND;
        p_ErrorDesc := PKG_COMMON.EDESC_RDY_ERR_HEADER_FOUND;
        p_ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
    when PKG_COMMON.EXCP_RDY_ERR_MANY_RETRIES then
        p_ErrorCode := PKG_COMMON.ENO_RDY_ERR_MANY_RETRIES;
        p_ErrorDesc := PKG_COMMON.EDESC_RDY_ERR_MANY_RETRIES;
        p_ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
    when PKG_COMMON.EXCP_INCONVENIENT_TIME then
        p_ErrorCode := PKG_COMMON.ENO_INCONVENIENT_TIME;
        p_ErrorDesc := PKG_COMMON.EDESC_INCONVENIENT_TIME;
        p_ReturnStatus := PKG_COMMON.RETURN_STATUS_SUSPENDED;
    When others then
        p_ErrorCode := SqlCode;
        p_ErrorDesc := PKG_COMMON.getHardErrorDesc;                             -- 095SO
        p_ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
END;

Procedure SP_INSERT_CSV (
    p_BiHId                     In      VarChar2,
    p_BatchSize                 In      Integer,
    p_MaxAge                    In      Number,
    p_DataHeader                In      VarChar2,

    p_RecordNr                  In      ArrRecNr,
    p_RecordData                In      ArrRecData,

    p_RecCount                  In Out  Number,
    p_PreParseErrCount          In Out  Number,
    p_ErrCount                  In Out  Number,
    p_DateFc                    In Out  Varchar2,
    p_DateLc                    In Out  Varchar2,
    p_ErrorCode                 Out     Number,
    p_ErrorDesc                 Out     Varchar2,
    p_ReturnStatus              Out     Number
)
Is
    l_SrcType                   Varchar2(10);                                   -- 076SO

    l_inserted                  Number;                                         -- 143SO
    l_DateTime                  Varchar2(20);
    l_SoftErrorCount            Number;                                         -- 152SO
    l_SoftErrorId               Varchar2(10);
    l_SoftErrDesc               Varchar2(2000);

    l_recordIndex               INTEGER;
    l_record_version            Varchar2(20);                                   -- 011SO

Begin

    l_SrcType := PKG_COMMON_MAPPING.getSrcTypeForBiheader(p_BihId);             -- 085SO -- 083SO  -- 076SO

    l_record_version := PKG_COMMON.getRequiredHeaderField(p_DataHeader,'VERSION'); -- 097SO -- 091SO -- 011SO (may later be extracted from the header)

    For I In 1..p_BatchSize Loop

        l_recordIndex := I;

        -- 100SO L(l_SrcType,'l_SrcType');
        -- 100SO L(p_DataHeader,'p_DataHeader');
        -- 100SO L(l_record_version,'l_record_version');
        -- 100SO L(p_RecordNr(I),'p_RecordNr(I)');
        -- 100SO L(p_RecordData(I),'p_RecordData(I)');

        If (l_SrcType = rSourceType.MSC) Then
            INSERT_CSV_MSC(l_SrcType, p_BiHId, p_DataHeader, p_RecordNr(I), 
                p_RecordData(I), l_record_version, l_Inserted, l_DateTime, 
                l_SoftErrorCount, l_SoftErrorId, l_SoftErrDesc);                -- 152SO -- 143SO -- 089SO
        ElsIf (l_SrcType = rSourceType.M2M) Then
            INSERT_CSV_M2M(l_SrcType, p_BiHId, p_DataHeader, p_RecordNr(I), 
                p_RecordData(I), l_record_version, l_Inserted, l_DateTime, 
                l_SoftErrorCount, l_SoftErrorId, l_SoftErrDesc);                -- 152SO -- 143SO -- 112SO
        ElsIf (l_SrcType = rSourceType.MMSC) Then
            INSERT_CSV_MMSC(l_SrcType, p_BiHId, p_DataHeader, p_RecordNr(I), 
                p_RecordData(I), l_record_version, l_Inserted, l_DateTime, 
                l_SoftErrorCount, l_SoftErrorId, l_SoftErrDesc);                -- 152SO -- 143SO -- 089SO
        ElsIf (l_SrcType = rSourceType.ISRV) Then
            INSERT_CSV_ISRV(l_SrcType, p_BiHId, p_DataHeader, p_RecordNr(I), 
                p_RecordData(I), l_record_version, l_Inserted, l_DateTime, 
                l_SoftErrorCount, l_SoftErrorId, l_SoftErrDesc);                -- 152SO -- 143SO -- 089SO
        ElsIf (l_SrcType = rSourceType.SMSN) Then                               -- 124SO
            INSERT_CSV_SMSN(l_SrcType, p_BiHId, p_DataHeader, p_RecordNr(I), 
                p_RecordData(I), l_record_version, l_Inserted, l_DateTime, 
                l_SoftErrorCount, l_SoftErrorId, l_SoftErrDesc);                -- 152SO -- 143SO
            
        ElsIf l_SrcType in (rSourceType.POS, rSourceType.STAN) Then             -- 058SO -- 036AA
            INSERT_CSV_POS(l_SrcType, p_BiHId, p_DataHeader, p_RecordNr(I), 
                p_RecordData(I), l_record_version, l_Inserted, l_DateTime, 
                l_SoftErrorCount, l_SoftErrorId, l_SoftErrDesc);                -- 152SO -- 143SO -- 089SO
        End If;

        -- do the record counting
        p_RecCount := p_RecCount + l_Inserted;                                  -- 143SO
        p_ErrCount := p_ErrCount + l_SoftErrorCount;                            -- 152SO -- 099SO

        -- set first and last datetime of record
        If (l_DateTime is not NULL) and (l_DateTime < p_DateFc) Then
            p_DateFc := l_DateTime;
        End If;
        If (l_DateTime is not NULL) and (l_DateTime > p_DateLc) Then
            p_DateLc := l_DateTime;
        End If;

        -- soft error logging
        If not(l_SoftErrorId is NULL) Then
            PKG_COMMON.Insert_Warning(                                          -- 007SO
                    'PKG_MEC_IC_ASCII0',
                     'SP_INSERT_CSV',
                      'INSERT_CSV_' || l_SrcType ,
                       l_SoftErrDesc || ' *** ' || p_RecordData(I),
                        p_BiHId,
                         Null,
                          Null,
                           Null,
                            l_SoftErrorId                                       -- 008SO
            );
        End If;
    End Loop;

    p_ReturnStatus := PKG_COMMON.RETURN_STATUS_OK;
    Return;

Exception
    When PKG_COMMON.EXCP_MISSING_HEADER_FLD then                                -- 097SO
        p_ErrorCode := PKG_COMMON.ENO_MISSING_HEADER_FLD;
        p_ErrorDesc := PKG_COMMON.EDESC_MISSING_HEADER_FLD || ': VERSION in *** ' || p_DataHeader;
        p_ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
    When Others Then
        p_ErrorCode := SqlCode;
        p_ErrorDesc  := PKG_COMMON.getHardErrorDesc;                            -- 095SO
        p_ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
        -- hard error logging                                                   -- 005SO
        PKG_COMMON.Insert_Warning(                                              -- 007SO
                'PKG_MEC_IC_CSV',
                 'SP_INSERT_CSV',
                  'INSERT_CSV_' || l_SrcType ,
                   p_ErrorDesc || ' *** ' || p_RecordData(l_recordIndex),       -- 095SO
                    p_BiHId                                                     -- 008SO
        );
        Return;
End SP_INSERT_CSV;



Procedure SP_UPDATE_HEADER (
    p_BiHId             In      Varchar2,
    p_MaxAge            In      Number,
    p_DataHeader        In      VarChar2,       -- 012SO
    p_RecCount          In      Number,
    p_PreParseErrCount  In      Number,
    p_ErrCount          In      Number,
    p_DateFc            In      Varchar2,
    p_DateLc            In      Varchar2,
    p_ErrorCode         Out     Number,
    p_ErrorDesc         Out     Varchar2,
    p_ReturnStatus      Out     Number
)
Is
    l_SrcType                   Varchar2(10);
    l_HeaderState               Varchar2(10);
    l_HihId                     Varchar2(10);

    l_SuccessCount              Number := 0;                                    -- 043SO
    l_warehouse_sync_state      Varchar2(1) := NULL;
    l_reva_sync_state           Varchar2(1) := NULL;
    l_TariffMCount              Number(10) := 0 ;                               -- 061SO mVoting CDR count
Begin

    l_SrcType := PKG_COMMON_MAPPING.getSrcTypeForBiheader(p_BiHId);             -- 009SO

    l_HihId := PKG_COMMON.getRequiredHeaderField(p_DataHeader,'HIHID');         -- 097SO                         -- 090SO

    If (l_SrcType = rSourceType.MSC) Then

        Update /*+ INDEX(BDETAIL4 IDX_BD_BIHID4) */ BDETAIL4 Set
            BD_MAPSID = 'R'
        Where BD_BIHID = p_BIHID
        And BD_MAPSID = 'M'
        And BD_DATETIME > SysDate-p_MaxAge
        And BD_DATETIME < SysDate + cfltFutureCdrTimeSpan;                      -- 065SO

        l_SuccessCount := SQL%ROWCOUNT;     -- 043SO (replacing another select)

    ElsIf (l_SrcType = rSourceType.M2M) Then                                    -- 112SO

        Update /*+ INDEX(BDETAIL7 IDX_BD_BIHID7) */ BDETAIL7 Set
            BD_MAPSID = 'R'
        Where BD_BIHID = p_BIHID
        And BD_MAPSID = 'M'
        And BD_DATETIME > SysDate-p_MaxAge
        And BD_DATETIME < SysDate + cfltFutureCdrTimeSpan;

        l_SuccessCount := SQL%ROWCOUNT;

    ElsIf (l_SrcType = rSourceType.MMSC) Then

        Update /*+ INDEX(BDETAIL6 IDX_BD_BIHID6) */ BDETAIL6 Set
            BD_MAPSID = 'R'
        Where BD_BIHID = p_BIHID
        And BD_MAPSID = 'M'
        And BD_DATETIME > SysDate-p_MaxAge
        And BD_DATETIME < SysDate + cfltFutureCdrTimeSpan;                      -- 065SO

        l_SuccessCount := SQL%ROWCOUNT;     -- 043SO (replacing another select)

    ElsIf (l_SrcType In (rSourceType.ISRV)) Then

        Update /*+ INDEX(BDETAIL IDX_BD_BIHID) */ BDETAIL Set
            BD_MAPSID = 'R'
        Where BD_BIHID = p_BIHID
        And BD_MAPSID = 'M'
        And BD_DATETIME > SysDate-p_MaxAge
        And BD_DATETIME < SysDate + cfltFutureCdrTimeSpan;                      -- 065SO

        l_SuccessCount := SQL%ROWCOUNT;     -- 043SO (replacing another select)

    ElsIf l_SrcType in (rSourceType.SMSC, rSourceType.SMSN) Then                -- 127SO

        Select /*+ INDEX(BDETAIL1 IDX_BD_BIHID1) */
            SUM(DECODE(BD_TARID,'M',1,0))                                       -- 061SO
        Into
            l_TariffMCount                                                      -- 061SO
        From BDETAIL1
        Where BD_BIHID = p_BIHID
        And BD_DATETIME > SysDate-p_MaxAge
        And BD_DATETIME < SysDate + cfltFutureCdrTimeSpan;                      -- 065SO

        Update /*+ INDEX(BDETAIL1 IDX_BD_BIHID1) */ BDETAIL1 Set
            BD_MAPSID = 'R'
        Where BD_BIHID = p_BIHID
        And BD_MAPSID = 'M'
        And BD_DATETIME > SysDate-p_MaxAge
        And BD_DATETIME < SysDate + cfltFutureCdrTimeSpan;                  -- 065SO

        l_SuccessCount := SQL%ROWCOUNT;     -- 043SO (replacing another select)

        Update /*+ INDEX(BDETAIL2 IDX_BD_BIHID2) */ BDETAIL2 Set            -- 013AA
            BD_MAPSID = 'R'
        Where BD_BIHID = p_BIHID
        And BD_MAPSID = 'M'
        And BD_DATETIME > SysDate-p_MaxAge
        And BD_DATETIME < SysDate + cfltFutureCdrTimeSpan;                  -- 065SO

        l_SuccessCount := l_SuccessCount + SQL%ROWCOUNT;     -- 043SO added

    ElsIf l_SrcType in (rSourceType.POS,rSourceType.STAN) Then              -- 058SO -- 036AA

        Update /*+ INDEX(BDETAIL9 IDX_BD_BIHID9) */ BDETAIL9 Set
            BD_MAPSID = 'R'
        Where BD_BIHID = p_BIHID
        And BD_MAPSID = 'M'
        And BD_DATETIME > SysDate-p_MaxAge
        And BD_DATETIME < SysDate + cfltFutureCdrTimeSpan;                  -- 065SO

        l_SuccessCount := SQL%ROWCOUNT;     -- 043SO (replacing another select)

    End If;

    -- Update the given Biheader Id with the information supplied
    if p_ErrCount + p_PreParseErrCount = 0 then
        l_HeaderState := 'RDY';     -- no soft errors encounterd
    else
        l_HeaderState := 'ERR';     -- soft or pre-parse-errors encounterd
    end if;

    if  l_SuccessCount + p_ErrCount <> p_RecCount then
        -- we lost CDRs (e.g. by time MaxAge clipping) and must reject the file at this stage
        Rollback;
        RAISE PKG_COMMON.EXCP_RECCOUNT_MISMATCH;                                -- 096SO
    else
        -- this file will be accepted.                                          -- 149SO
        p_ReturnStatus := PKG_COMMON.RETURN_STATUS_OK;
        If l_SrcType IN (rSourceType.MMSC, rSourceType.ISRV, rSourceType.SMSN, rSourceType.MSC) Then    -- 150SO
            l_reva_sync_state := 'S';
        End If;
    end if;

    Update BIHeader Set
        BIH_ESID = l_HeaderState,
        BIH_DATEFC = To_Date(p_DateFc, cstrMecDateTimeFormat),                  -- 094DA
        BIH_DATELC = To_Date(p_DateLc, cstrMecDateTimeFormat),                  -- 094DA
        BIH_RECCOUNT = p_RecCount,
        BIH_ERRCOUNT = p_ErrCount + p_PreParseErrCount,
        BIH_END = SysDate,
        BIH_HIHID = l_HihId,
        BIH_WHSYNCSID = l_warehouse_sync_state,
        BIH_REVASID = l_reva_sync_state,
        BIH_INDEXSID = DECODE(BIH_SRCTYPE,'MMSC','S',NULL)                      -- 101SO
    Where BIH_ID = p_BiHId;

    UPDATE MAPPING SET
        MAP_DATEDONE = SYSDATE                                                  -- 098SO
    WHERE   MAP_ID IN (SELECT BIH_MAPID FROM BIHEADER WHERE BIH_ID = p_BiHId)
    ;

    Return;

Exception
    When PKG_COMMON.EXCP_MISSING_HEADER_FLD then                                -- 097SO
        p_ErrorCode := PKG_COMMON.ENO_MISSING_HEADER_FLD;
        p_ErrorDesc := PKG_COMMON.EDESC_MISSING_HEADER_FLD || ': HIHID in *** ' || p_DataHeader;
        p_ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
    When PKG_COMMON.EXCP_RECCOUNT_MISMATCH then                                 -- 096SO
        p_ErrorCode := PKG_COMMON.ENO_RECCOUNT_MISMATCH;
        p_ErrorDesc := PKG_COMMON.EDESC_RECCOUNT_MISMATCH || ' (' || l_SuccessCount || '+' || p_ErrCount || '<>' || p_RecCount || ')' ;
        p_ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
    When Others then
        p_ErrorCode := SqlCode;
        p_ErrorDesc := PKG_COMMON.getHardErrorDesc;                             -- 095SO
        p_ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
        Return;
End SP_UPDATE_HEADER;


END PKG_MEC_IC_ASCII0;
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- PKG_MEC_OC  (Package Body) 
--
CREATE OR REPLACE PACKAGE BODY SBS1_ADMIN.PKG_MEC_OC
IS
--
-- Purpose:
-- Output Converter
-- Getting Data out from SBS2
--
-- MODIFICATION HISTORY
-- Person       Date        Comments
-- ---------    ----------  -------------------------------------
-- 001SO        27.01.2010  Created based on PKG_MEC_IC_CSV
-- 002SO        28.01.2010  Add Parameter p_FileName to insert header
-- 003SO        09.02.2010  Add Parameter p_JobId and rename to SP_GET_JOB_DETAILS
-- 004SO        09.02.2010  Add SP_GET_JOB_QUERIES
-- 005SO        09.02.2010  Add SP_REGISTER_OUTPUT
-- 006SO        11.02.2010  Change signature of SP_REGISTER_OUTPUT
-- 007DA        23.02.2010  Method SP_GET_PACKING_ID added
-- 008DA        16.03.2010  GetJobDetails() now returns also Email related attribute values (right outer join)
-- 009DA        17.03.2010  Added attributes NOT_MAXATTSIZE & NOT_ETID to GetJobDetails() output
-- 010DA        18.03.2010  Added attributes STAC_SMTPHOST & STAC_SMTPPORT to GetJobDetails() output
-- 011DA        19.03.2010  Added attribute PAC_NOTIFICATION to GetJobDetails() output
-- 012DA        19.03.2010  PAC_COMPRESS, PAC_FIELDSEP and PAC_LINESEP now taken from PACKING table
-- 013SO        28.03.2010  Handle 2 new workflow exceptions
-- 014SO        28.03.2010  Use prepared JobSql for Individual Statistics generation
-- 015SO        29.03.2010  Implement SP_MODIFY_HEADER, used by SPTRY output converters
-- 016SO        07.04.2010  Adapted for use on SBS2 database
-- 017SO        07.04.2010  Adapted for use on SBS2 database
-- 018SO        12.04.2010  Remove wrong packing update
-- 019SO        14.04.2010  Correct parameter typo
-- 020SO        24.04.2010  Remove exception handler for other errors
-- 021SO        08.05.2010  Use generalized job parameter replacement
-- 022DA        27.05.2010  New Packing attribute PAC_ENCODINGTYPE implemented
-- 023SO        12.08.2010  Implement dynamic address evaluation for looper statistics notifications
-- 024SO        26.08.2010  Implement sorting for transaction statements with job queries
-- 025SO        09.09.2010  Correct Token to <EndTransaction>
-- 026SO        10.09.2010  Correct name NOT_ADRTO back to how it was before -- 025SO
-- 027SO        08.12.2010  Implement eMail sending of LA-invoices to several adddresses
-- 028SO        15.09.2011  Implement eMail sending of BN-statistics
-- 029SO        14.12.2011  Remove schema qualifier "S B S 0 ."
-- 030SO        06.08.2017  Remove deprecated notification address placeholder


    cstrTab                         Varchar2(1) := Chr(9);
    cstrCR                          Varchar2(1) := Chr(13);
    cstrLF                          Varchar2(1) := Chr(10);
    cstrComma                       Varchar2(1) := ',';
    cstrSemicolon                   Varchar2(1) := ';';

    rSourceType                     PKG_COMMON.tSrcType;
    rHeaderState                    PKG_COMMON_PACKING.tBoHeaderEsId;
    rPackingState                   PKG_COMMON_PACKING.tPackingStateId;

    cstrMecDateTimeFormat           Varchar2(20) := 'YYYYMMDDHH24MISS';

    cstrFieldSeparator              Varchar(1) := cstrTab;


Procedure SP_INSERT_HEADER (
    p_PackingType       In      Varchar2,
    p_PackingId         In OUT  Varchar2,
    p_HeaderId          OUT     Varchar2,
    p_JobId             OUT     Varchar2,
    p_FileName          Out     Varchar2,       -- 002SO
    p_AppName           In      Varchar2,
    p_AppVer            In      Varchar2,
    p_Thread            In      Varchar2,
    p_TaskId            In      Number,
    p_HostName          In      Varchar2,
    p_ErrorCode         Out     Number,
    p_ErrorDesc         Out     Varchar2,
    p_ReturnStatus      Out     Number
    )
Is
    l_SrcType                   Varchar2(10);
Begin

    p_HeaderId := NULL;

    PKG_COMMON_PACKING.INSERT_BOHEADER(
        p_PackingType,
        p_PackingId,
        p_HeaderId,
        p_JobId,
        p_FileName,                 -- 002SO
        p_AppName,
        p_AppVer,
        p_Thread,
        p_TaskId,                    -- 019SO
        p_HostName
    );

    p_ReturnStatus := PKG_COMMON.RETURN_STATUS_OK;

Exception
    when PKG_COMMON.EXCP_INCONVENIENT_TIME then
        p_ErrorCode := PKG_COMMON.ENO_INCONVENIENT_TIME;
        p_ErrorDesc := PKG_COMMON.EDESC_INCONVENIENT_TIME;
        p_ReturnStatus := PKG_COMMON.RETURN_STATUS_SUSPENDED;
    when PKG_COMMON_PACKING.EXCP_STATISTICS_FAILURE then
        p_ErrorCode := PKG_COMMON_PACKING.ENO_STATISTICS_FAILURE;
        p_ErrorDesc := PKG_COMMON_PACKING.EDESC_STATISTICS_FAILURE;
        p_ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;                     -- 013SO
    when PKG_COMMON_PACKING.EXCP_WORKFLOW_ABORT then
        p_ErrorCode := PKG_COMMON_PACKING.ENO_WORKFLOW_ABORT;
        p_ErrorDesc := PKG_COMMON_PACKING.EDESC_WORKFLOW_ABORT;
        p_ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;                     -- 013SO
/*  -- 020SO
    When others then
        p_ErrorCode := SqlCode;
        p_ErrorDesc := PKG_COMMON.getHardErrorDesc;
        p_ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
*/
END;

Procedure SP_GET_JOB_DETAILS (                                                  -- 003SO
    p_PackingId         In      Varchar2,
    p_JobId             In      Varchar2,                                       -- 003SO
    p_RefCursor         OUT     SYS_REFCURSOR,
    p_ErrorCode         Out     Number,
    p_ErrorDesc         Out     Varchar2,
    p_ReturnStatus      Out     Number
    )
Is
Begin

    Open p_RefCursor For
        SELECT                                                                  -- 008DA
            PAC_ID,
            PAC_NAME,
            PAC_SHORT,
            PAC_TEMPLATE,
            PAC_FILEMASK,
            PAC_PDFMASK,
            PAC_OUTPUTDIR,
            PAC_ARCHIVESTATISTIC,
            PAC_ARCHIVEDIR,
            PAC_COMPRESS,                                                       -- 012DA
            PAC_FIELDSEP,                                                       -- 012DA
            PAC_LINESEP,                                                        -- 012DA
            PAC_NOTIFICATION,                                                   -- 011DA
            NVL(PAC_ENCODINGTYPE, 'UTF8') PAC_ENCODINGTYPE,                     -- 022DA
            NOT_SUBJECT,
            NOT_BODY,
            NOT_SENDERDISP,
            NOT_SENDERTXT,
            NOT_RECDISP,
            NOT_ADRFROM,
            case NOT_ADRTO
            when '<JOB_LA_INVOICE_EMAILS>'  then JOB_LA_INVOICE_EMAILS(p_JobId) -- 027SO
            when '<JOB_BN_STATS_EMAILS>'    then JOB_BN_STATS_EMAILS(p_JobId)   -- 028SO
            else NOT_ADRTO
            end                             AS NOT_ADRTO,
            NOT_ADRCC,
            NOT_ADRBCC,
            NOT_ATTFILE,
            NOT_MAXATTSIZE,                                                     -- 009DA
            NOT_ETID,                                                           -- 009DA
            STAC_SMTPHOST,                                                      -- 010DA
            STAC_SMTPPORT                                                       -- 010DA
        FROM    PACKING, NOTIFICATIONTEMPL, STA_CONFIG           -- 010DA
        WHERE   PAC_ID = p_PackingId
        AND     PAC_ESID IN (rPackingState.Active,rPackingState.Scheduled)
        AND     PAC_NOTID = NOT_ID(+)
        AND     STAC_NAME = 'DEFAULT'                                           -- 010DA
    ;   -- 030SO                                                                when '<JOB_ADRID_MAIN_EMAIL>' removed
    p_ErrorCode := NULL;
    p_ErrorDesc := NULL;
    p_ReturnStatus := PKG_COMMON.RETURN_STATUS_OK;
    Return;
/*  -- 020SO
Exception
    When others then
        p_ErrorCode := SqlCode;
        p_ErrorDesc := PKG_COMMON.getHardErrorDesc;
        p_ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
*/
END;

Procedure SP_GET_JOB_QUERIES (
    p_PackingId         In      Varchar2,
    p_JobId             In      Varchar2,
    p_RefCursor         OUT     SYS_REFCURSOR,
    p_ErrorCode         Out     Number,
    p_ErrorDesc         Out     Varchar2,
    p_ReturnStatus      Out     Number
    )
Is  -- 004SO

    Cursor cPacking is
    SELECT
        PAC_ETID
    FROM PACKING
    WHERE PAC_ID = p_PackingId
    ;   -- 014SO

Begin

    FOR cPackingRow in cPacking LOOP
        IF cPackingRow.PAC_ETID = 'STATIND' then
            Open p_RefCursor For
            SELECT
               STAJQ_QUERYNAME              as STAQ_QUERYNAME,
               JOB_EXPANDED_SQL(p_JobId, STAJQ_SQL) as STAQ_SQL         -- 021SO
            FROM    STA_JOBSQL
            WHERE STAJQ_JOBID = p_JobId
            ORDER BY DECODE(STAJQ_QUERYNAME,'<StartTransaction>','1','<EndTransaction>','9','2' || STAJQ_QUERYNAME)
            ; -- 025SO -- 024SO -- 014SO
        else
            Open p_RefCursor For
            SELECT
                STAQ_QUERYNAME,
                JOB_EXPANDED_SQL(p_JobId, STAQ_SQL) as STAQ_SQL             -- 021SO
            FROM    STA_SQLDEF
            WHERE   STAQ_PACID = p_PackingId
            ORDER BY DECODE(STAQ_QUERYNAME,'<StartTransaction>','1','<EndTransaction>','9','2' || STAQ_QUERYNAME)
            ; -- 025SO-- 024SO
        end if;
    END LOOP;

    p_ErrorCode := NULL;
    p_ErrorDesc := NULL;
    p_ReturnStatus := PKG_COMMON.RETURN_STATUS_OK;
    Return;
/*  -- 020SO
Exception
    When others then
        p_ErrorCode := SqlCode;
        p_ErrorDesc := PKG_COMMON.getHardErrorDesc;
        p_ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
*/
END;

Procedure SP_MODIFY_HEADER (
    p_HeaderId          in      varchar2,
    p_AppName           in      varchar2,
    p_AppVer            in      varchar2,
    p_Thread            in      varchar2,
    p_TaskId            in      number,
    p_HostName          in      varchar2,
    p_FileName          out     varchar2,
    p_ErrorCode         Out     Number,
    p_ErrorDesc         Out     Varchar2,
    p_ReturnStatus      Out     Number
)
Is  -- 015SO
Begin

    -- Update the given Biheader Id with the information supplied

    PKG_COMMON_PACKING.MODIFY_BOHEADER(
        p_HeaderId,
        p_AppName,
        p_AppVer,
        p_Thread,
        p_TaskId,
        p_HostName,
        p_FileName
    );
    p_ReturnStatus := PKG_COMMON.RETURN_STATUS_OK;
    Return;

Exception
    When PKG_COMMON.EXCP_MISSING_HEADER_FLD then                                -- not used yet
        p_ErrorCode := PKG_COMMON.ENO_MISSING_HEADER_FLD;
        p_ErrorDesc := PKG_COMMON.EDESC_MISSING_HEADER_FLD;
        p_ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
/*  -- 020SO
    When Others then
        p_ErrorCode := SqlCode;
        p_ErrorDesc := PKG_COMMON.getHardErrorDesc;
        p_ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
        Return;
*/
End SP_MODIFY_HEADER;

Procedure SP_UPDATE_HEADER (
    p_HeaderId          In      Varchar2,
    p_JobId             In      Varchar2,
    p_FileName          In Out  Varchar2,
    p_FileDate          In      Varchar2,
    p_MaxAge            In      Number,
    p_DataHeader        In      VarChar2,
    p_RecCount          In      Number,
    p_ErrCount          In      Number,
    p_DateFc            In      Varchar2,
    p_DateLc            In      Varchar2,
    p_ErrorCode         Out     Number,
    p_ErrorDesc         Out     Varchar2,
    p_ReturnStatus      Out     Number
)
Is
Begin

    -- Update the given Biheader Id with the information supplied

    PKG_COMMON_PACKING.update_boheader(
        p_headerid,
        p_jobid,
        p_filename,
        p_filedate,
        p_maxage,
        p_dataheader,
        p_reccount,
        p_errcount,
        p_datefc,
        p_datelc
    );
    -- 018SO
    p_ReturnStatus := PKG_COMMON.RETURN_STATUS_OK;
    Return;
Exception
    When PKG_COMMON.EXCP_MISSING_HEADER_FLD then                                -- not used yet
        p_ErrorCode := PKG_COMMON.ENO_MISSING_HEADER_FLD;
        p_ErrorDesc := PKG_COMMON.EDESC_MISSING_HEADER_FLD;
        p_ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
    When PKG_COMMON.EXCP_RECCOUNT_MISMATCH then                                 -- not used yet
        p_ErrorCode := PKG_COMMON.ENO_RECCOUNT_MISMATCH;
        p_ErrorDesc := PKG_COMMON.EDESC_RECCOUNT_MISMATCH;
        p_ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
/*
    When Others then
        p_ErrorCode := SqlCode;
        p_ErrorDesc := PKG_COMMON.getHardErrorDesc;
        p_ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
        Return;
*/
End SP_UPDATE_HEADER;

Procedure SP_REGISTER_OUTPUT (
    p_PackingId         In      Varchar2,
    p_JobId             In      Varchar2,
    p_FilePath          IN      Varchar2,   -- absolute path without file name
    p_FileName          IN      Varchar2,   -- name only
    p_FileSize          IN      Number,     -- 006SO
    p_OutputType        IN      Varchar2,   -- XLS / PDF / CSV for now
    p_OutputId          OUT     Varchar2,
    p_ErrorCode         Out     Number,
    p_ErrorDesc         Out     Varchar2,
    p_ReturnStatus      Out     Number
    )
Is  -- 005SO
Begin

    p_OutputId := GenerateUniqueKey('G');

    INSERT INTO STA_JOBOUTPUT (
        STAJO_ID,
        STAJO_JOBID,
        STAJO_DATECRE,
        STAJO_OUTPUTDIR,
        STAJO_FILENAME,
        STAJO_ETID
    ) VALUES (
        p_OutputId,
        p_JobId,
        SYSDATE,
        p_FilePath,
        p_FileName,
        p_OutputType
    );  -- add file size here $$$$$$$$$$$$$$$$$$$

    p_ErrorCode := NULL;
    p_ErrorDesc := NULL;
    p_ReturnStatus := PKG_COMMON.RETURN_STATUS_OK;
    Return;
/*
Exception
    When others then
        p_ErrorCode := SqlCode;
        p_ErrorDesc := PKG_COMMON.getHardErrorDesc;
        p_ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
*/
END;


-- 007DA
Procedure SP_GET_PACKING_ID (
    p_PackingType   In      Varchar2,
    p_PackingId     In Out  Varchar2,
    p_Thread        In      Varchar2,
    p_ErrorCode     Out     Number,
    p_ErrorDesc     Out     Varchar2,
    p_ReturnStatus  Out     Number
)
Is
Begin
    --
    -- get packing id and raise an exception, if suspended
    --
    If p_PackingId Is Not Null Then
        -- specific packing is given
        If PKG_COMMON_PACKING.isTimeForPacking(p_PackingId) = 0 Then
            Raise PKG_COMMON.EXCP_INCONVENIENT_TIME;
        End If;
    Else
        -- only packing type is given - must search a candidate first
        p_PackingId := PKG_COMMON_PACKING.getPackingCandidateForType(p_PackingType, p_Thread);
        If p_PackingId Is Null Then
            Raise PKG_COMMON.EXCP_INCONVENIENT_TIME;
        End If;
    End If;

    --
    -- packing found, which can be executed
    --
    Update PACKING Set PAC_DATETRY = sysdate Where PAC_ID = p_PackingId;

    p_ReturnStatus := PKG_COMMON.RETURN_STATUS_OK;

Exception
    when PKG_COMMON.EXCP_INCONVENIENT_TIME then
        p_ErrorCode := PKG_COMMON.ENO_INCONVENIENT_TIME;
        p_ErrorDesc := PKG_COMMON.EDESC_INCONVENIENT_TIME;
        p_ReturnStatus := PKG_COMMON.RETURN_STATUS_SUSPENDED;
/*  -- 020SO
    When others then
        p_ErrorCode := SqlCode;
        p_ErrorDesc := PKG_COMMON.getHardErrorDesc;
        p_ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;
*/
END; -- SP_GET_PACKING_ID

END; -- PKG_MEC_OC
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- PKG_REVA  (Package Body) 
--
CREATE OR REPLACE PACKAGE BODY SBS1_ADMIN.PKG_REVA
IS

-- MODIFICATION HISTORY
-- Person       Date                    Comments
-- ----------   ---------- ------------------------------------------
-- AH                   2004-08-11      Creation
-- 001SO        2004-10-20  Add calling parameters BIH_ID, BOH_ID for INSERT_WARNING
-- 002SO        2004-10-20  Remove unused exceptions
-- 003SO        2004-10-20  Set RecordsAffected
-- 004SO        2004-10-20  Remove dependence from BDETAIL4
-- 005SO        2004-10-20  Set / Reset ErrorMsg
-- 006SO        2004-10-20  Check all BiHeader States (''RDY'',''ERR'', ''IDX'', ''IDE'')
-- 007SO        2004-10-20  Reset InCountAnalyzed for each analysis (REVA HEADER)
-- 008SO        2004-10-20  Support some REVA HEADER tokens in REVA SQLs
-- 009SO        2004-10-21  Create unknown signatures with order 999.9999
-- 010SO        2004-10-25  Use static cursor for finding all relevant REVA Headers
-- 011SO        2004-10-25  Correct logic for suspended REVA Headers
-- 012SO        2004-10-25  Add Input parameter p_DESC to call SP_REVA_RECENT (for BOH_FILENAME)
-- 013SO        2004-10-25  Move Variable vBiheaderStm to scope of SP_REVA_RECENT and rename to SqlStmBiHeader
-- 014SO        2004-10-25  Add Input parameter p_SqlStmSrcType to call SP_REVA_RECENT (for BOH_FILENAME)
-- 015SO        2004-10-25  Add config parameter REVAC_RUNTIMELIMIT and use to terminate BIHEADER loop
-- 016SO        2004-10-25  Create separate stub for REVA-SMSC
-- 017SO        2004-10-25  Make SP_REVA_RECENT a private procedure and rename to REVA_RECENT
-- 018SO        2005-01-17  Allow for unions in execution of query REVA_INSQL (counting in more than one table)
-- 019SO        2005-11-12  Also consider indexing intermediate states 'idx' and 'ide' for MMS files (used only for migration)
-- 020SO        2006-08-17  Change signature mask length from 10 to 20
-- 021SO        2008-06-16  Process oldest files first and respect a minimum age and maximum age
-- 022SO        2008-06-19  Create index entries for near realtime Revenue Assurance where appliccable
-- 023SO        29.03.2010  Rename p_PACT_ID to p_PAC_ID
-- 024SO        29.03.2010  Use new generalized method for inserting a dummy header in SPTRY
-- 025SO        2010-06-28  Correct Index Hints (<table> <index>)
-- 026SO        2010-07-01  Optimize Execution Plan for Header Selection
-- 027SO        2010-07-14  Enable use of BIH_MAPID for Header Selection (Parallelizing SMSC RA)
-- 028SO        2010-07-14  Go back to single SMSC RA analysis (Lock contention on REVA_COUNTER)
-- 029SO        2010-07-15  Simplify REVA_OTHERS file query. Suspended REVA_HEADERs not supported any more
-- 030SO        2010_08-10  Correct intendation and initialize variable where unsafe
-- 031SO        26.08.2010  Rename procedures according to driving Packing-ID
-- 032SO        14.12.2011  Remove schema qualifier "S B S 0 ."
-- 033SO        19.04.2012  Use PKG_COMMON.INSERT_WARNING
-- 034SO        16.05.2012  Improve error logging
-- 035SO        18.05.2012  Correct error logging parameters
-- 036SO        18.06.2016  Include SMSN (new SMSCs) in Revenue Assurance
-- 037SO        17.11.2018  Use Bind Variables :1 / :2 for BIHEADER ID
-- 038SO        18.11.2018  Fix multiple insert of new sugnatures for different dates
-- 039SO        19.11.2018  Replace cursor with select/exception and add insert warnings per new signature
-- 040SO        20.11.2018  Improve signature warnings
-- 041SO        27.11.2018  Improve signature warnings (less verbose for less than 5 differences)


-- Globals

-- vHeaderAllStm                varchar2(4000);           -- 010SO
-- vSrctypeStm          varchar2(4000);

vMePkg              varchar2(30) := 'PKG_REVA';

bDebug                          boolean;
rConfig                         reva_config%rowtype;


--REVA States
        type t_RevaEsid is Record (
                active                  reva_state.revas_id%type                := 'A',
                inactive                reva_state.revas_id%type                := 'I',
                deleted                 reva_state.revas_id%type                := 'D',
                scheduled               reva_state.revas_id%type                := 'S',
                done                    reva_state.revas_id%type                := 'O',
                error                   reva_state.revas_id%type                := 'E',
                suspended               reva_state.revas_id%type                := 'U'
        );
        rRevaEsid               t_RevaEsid;

----------------------------------------------------------------------------------------------------------------
FUNCTION getConfig return reva_config%rowtype
is

vConfig            reva_config%rowtype;
begin
    select * into vConfig
    from reva_config
    where revac_id = 'DEFAULT';

    if (vConfig.revac_debugmode=1) then
        bDebug:=true;
    else
        bDebug:=false;
    end if;

    return vConfig;
exception
     WHEN Others THEN
        return vConfig;
end;

----------------------------------------------------------------------
-- Main analysis logic
----------------------------------------------------------------------

procedure REVA_RECENT (
    p_PAC_ID          In      Varchar2,     -- 023SO
    p_DESC            In      Varchar2,     -- 012SO
    p_SqlStmSrcType   In      Varchar2,     -- 014SO
    p_SqlStmMapId     In      VArchar2,     -- 027SO
    p_BOH_ID          In Out  Varchar2,
    RecordsAffected   Out     Number,
    ErrorCode         Out     Number,
    ErrorMsg          Out     Varchar2,
    ReturnStatus      In Out  Number
)
is

    Me varchar2(15) := 'REVA_RECENT';

    type t_FileDetails is Record (                   --Biheader file details
        BIH_RECCOUNT       biheader.bih_reccount%type,
        BIH_ESID           biheader.bih_esid%type,
        BIH_DATETIME       biheader.bih_datetime%type
    );
    rFileDetailsRow t_FileDetails;

    type t_KnownSignature is Record (                                                                                               --Signature details
        bd_datetime       date,                                                 -- 004SO
        revasm_id         reva_sigmask.revasm_id%type,
        incount           number,
        outcount          number
    );
    rKnownSignature       t_KnownSignature;

    type t_UnknownSignature is Record (                                                                                             --Signature details for unknown Signatures
        bd_datetime       date,                                                 -- 004SO
        revasm_code       reva_sigmask.revasm_code%type,
        incount           number,
        outcount          number
    );
    rUnknownSignature     t_UnknownSignature;

    type tRefCur is ref cursor;         --Dynamic Cursor Variables
    cvCurVar    tRefCur;
    cvCurVarSt  tRefCur;
    cvCurVarBi  tRefCur;

    CURSOR cMatchingRevaHeader(CurrentBihid VARCHAR2) IS                        -- 010SO
        select
            REVAH_ID,
            REVAH_SRCTYPE,
            REVAH_PACID,
            REVAH_BILLINGTYPE,
            REVAH_BILLEDITEM,
            REVAH_SQL,
            REVAH_ESID,
            REVAH_INSQL,
            REVAH_NEWSIGSQL
        from reva_header, biheader
        where revah_esid = rRevaEsid.active
        and revah_srctype = bih_srctype
        and bih_id = CurrentBihid
    ;
    cMatchingRevaHeaderRow cMatchingRevaHeader%rowtype;

    CURSOR cSigmaskId(revah_id VARCHAR2, revasm_code VARCHAR2) IS               -- 038SO
        SELECT REVASM_ID
        FROM   REVA_SIGMASK
        WHERE  REVASM_REVAHID = revah_id
        AND    REVASM_CODE = revasm_code
        AND    REVASM_ESID = 'A'
        ;

    BihRevasid             biheader.bih_revasid%type;

    CurrentBihid           biheader.bih_id%type;

    StartTime              DATE;

    InCount                number;
    PartialInCount         number;                                              -- 018SO
    InCountAnalyzed        number;
    ReccountDone           number;

    CachedSqlStmInCount    varchar2(4000);
    CachedInCount          number;

    SqlStm                 varchar2(4000);
    SqlStmBiHeader         varchar2(4000);                                      -- 013SO

    NewSigmaskId           REVA_SIGMASK.REVASM_ID%type;                         -- 020SO

    no_bohid exception;

begin

    --Initialize Variables
    StartTime := sysdate;
    RecordsAffected := 0;
    ReturnStatus := 0;
    ReccountDone := 0;
    InCount := 0;
    SqlStm := null;
    CachedSqlStmInCount := null;
    NewSigmaskId := null;

    --Read Config-Table of REVA_CONFIG
    rConfig := pkg_reva.getConfig;

    --We would like to analyze a certain amount of reccords (see reva_config.revac_batchnorecords
    --Analyze all not-yet analyzed biheader files for all possible input - output pairs -> reva_sigmask
    --Therefore get the latest, not yet Analyzed BIHEADER file for specific CALLER (e.g. MSC or others)
    --Prepare dynamic Cursor Statement
    SqlStmBiHeader := 'select /*+ INDEX (BIHEADER IDX_BIH_REVASID) */  BIH_ID
                FROM    BIHEADER
                WHERE   BIH_DATETIME >= sysdate - ' || rConfig.REVAC_FILE_MAX_AGE || '/24/3600
                AND     BIH_DATETIME <= sysdate - ' || rConfig.REVAC_FILE_MIN_AGE || '/24/3600
                AND     BIH_SRCTYPE IN (' || p_SqlStmSrcType || ')
                AND     BIH_ESID in (''RDY'',''ERR'', ''IDX'', ''IDE'', ''idx'', ''ide'')
                AND     BIH_REVASID=''S''
                AND     ROWNUM <= 1'
    ; -- 026SO -- 025SO -- 021SO -- 019SO -- 014SO -- 011SO -- 006SO

    if p_SqlStmMapId is not NULL then
        SqlStmBiHeader := SqlStmBiHeader || ' AND BIH_MAPID in (' || p_SqlStmMapId || ')';      -- 027SO
    end if;

    while   (ReccountDone < rConfig.revac_batchnorecords) AND (sysdate < StartTime + rConfig.REVAC_RUNTIMELIMIT/24/3600)
    loop

        --Try to analyze another file
        --Repeat unless we analyzed a certain amount of CDRs -> see REVA_CONFIG

        --open dynamic select for last BIHEADER file
        CurrentBihid := NULL;                                                   -- 030SO
        open cvCurVarBi for SqlStmBiHeader;
        fetch cvCurVarBi into CurrentBihid;
        close cvCurVarBi;

        exit when CurrentBihid is null;   -- no more file to be analyzed. Analyze is up to date (no backlog)

        --Initialize Variables for this file
        BihRevasid := rRevaEsid.done;     -- if we have a file without active REVA HEADERs, we are done with the file
        CachedSqlStmInCount:=NULL;
        InCount := 0;
        InCountAnalyzed := 0;

        --Now fetch fileDetails for this biheader id
        select bih_reccount, bih_esid, bih_datetime into rFileDetailsRow
        from biheader
        where bih_id = CurrentBihid;

        --Fetch a NEW BOHEADER ID if not already done
        PKG_COMMON_PACKING.INSERT_BOHEADER_SPTRY(p_PAC_ID, p_BOH_ID);           -- 024SO

        --Fetch and process all matching active REVA HEADERS (depending on SourceType)
        open cMatchingRevaHeader(CurrentBihid);
        loop
            fetch cMatchingRevaHeader into cMatchingRevaHeaderRow;

            exit when cMatchingRevaHeader%notfound;   -- no more REVA HEADER for this file

            -- Perform analysis for this file and current REVA HEADER

            if (bDebug) then
                pkg_debug.debug_reva(CurrentBihid,p_Boh_Id,cMatchingRevaHeaderRow.revah_id,0, 'START','Reva From=>To: '||cMatchingRevaHeaderRow.revah_Srctype||'=>'||cMatchingRevaHeaderRow.revah_pacid);
            end if;

            --1. Count all incoming records of current BIH_ID
            SqlStm := cMatchingRevaHeaderRow.revah_insql;
            SqlStm := replace(SqlStm, '<MINDATE>', rConfig.REVAC_FILE_MAX_AGE / 24/3600);        -- 021SO
            SqlStm := replace(SqlStm, '<REVAH_ID>', cMatchingRevaHeaderRow.revah_id);            -- 008SO
            SqlStm := replace(SqlStm, '<REVAH_SRCTYPE>',cMatchingRevaHeaderRow.revah_srctype);   -- 008SO
            SqlStm := replace(SqlStm, '<REVAH_PACID>', cMatchingRevaHeaderRow.revah_pacid);      -- 008SO

            --InSql Statements are COUNT(*) on BDETAIL* tables and may return more than one row (to be added)
            --If the new SqlStm is equal to the "old" CachedSqlStmInCount, dont Count again
            if SqlStm = CachedSqlStmInCount then
                InCount := CachedInCount;     --Reuse InCount from last loop
            else
                InCount := 0;       --InCount = All CDRs for this BDETAIL* file
                if INSTR(SqlStm,':2') > 0 then
                    open cvCurVar for SqlStm using CurrentBihid, CurrentBihid;  -- 037SO
                else
                    open cvCurVar for SqlStm using CurrentBihid;                -- 037SO
                end if;
                loop                                                            -- 018SO
                    fetch cvCurVar into PartialInCount;                         -- 018SO
                    exit when cvCurVar%NOTFOUND;                                -- 018SO
                    InCount := InCount + PartialInCount;                        -- 018SO
                end loop;                                                       -- 018SO
                close cvCurVar;
                CachedSqlStmInCount := SqlStm;  --Remember SqlStm for next loop
                CachedInCount := InCount;       --Remember InCount for next loop
            end if;

            InCountAnalyzed := 0;                                               -- 007SO

            -- Fetch signature sql statement and replace the tokenized parameters
            SqlStm := cMatchingRevaHeaderRow.revah_sql;
            SqlStm := replace(SqlStm, '<MINDATE>', rConfig.REVAC_FILE_MAX_AGE / 24/3600);        -- 021SO
            SqlStm := replace(SqlStm, '<REVAH_ID>', cMatchingRevaHeaderRow.revah_id);            -- 008SO
            SqlStm := replace(SqlStm, '<REVAH_SRCTYPE>',cMatchingRevaHeaderRow.revah_srctype);   -- 008SO
            SqlStm := replace(SqlStm, '<REVAH_PACID>', cMatchingRevaHeaderRow.revah_pacid);      -- 008SO

            --2. Analyze all known Signatures and update existing counters: Count OUT
            if INSTR(SqlStm,':2') > 0 then
                open cvCurVar for SqlStm using CurrentBihid, CurrentBihid;      -- 037SO
            else
                open cvCurVar for SqlStm using CurrentBihid;                    -- 037SO
            end if;
            loop
                fetch cvCurVar into rKnownSignature;
                exit when cvCurVar%NOTFOUND;
                begin
                    update reva_counter set
                        revac_in = revac_in + rKnownSignature.incount,
                        revac_out = revac_out + rKnownSignature.outcount
                    where revac_revasmid = rKnownSignature.revasm_id
                    and revac_date = rKnownSignature.bd_datetime;
                    if (SQL%ROWCOUNT = 0) then
                        --New SIGMASK for DATE -> create NEW SIG COUNTER
                        insert into reva_counter (
                            revac_date,
                            revac_revasmid,
                            revac_in, revac_out)
                        values (
                            rKnownSignature.bd_datetime,
                            rKnownSignature.revasm_id,
                            rKnownSignature.incount,
                            rKnownSignature.outcount);
                    end if;
                    --Count analyzed in CDRs for later comparing between InCount and InCountSigMasks
                    InCountAnalyzed := InCountAnalyzed + rKnownSignature.incount;
                end;
            end loop; --cvCurVar
            close cvCurVar;

            if (InCount < InCountAnalyzed) then
                --Here is definitely something wrong: more CDRs analyzed than existing. Cannot continue.
                BihRevasid := rRevaEsid.error;
                ErrorMsg  := pkg_admin_common.geterrordesc('INCOUNT_ERROR');
                ErrorMsg  := ErrorMsg ||' (Incount = ' || InCount || ', InCountAnalyzed = ' || InCountAnalyzed || ').';
                PKG_COMMON.INSERT_WARNING (
                    vMePkg,
                    Me,
                    'REVA-ERROR',
                    ErrorMsg ,
                    CurrentBihid,
                    p_BOH_ID,
                    NULL,
                    NULL,
                    '1000000028'
                ); -- 035SO -- 033SO -- 001SO
                ROLLBACK;
                exit; --leave loop, terminate processing of this file
            end if;

            if not(InCount = InCountAnalyzed) then
                --We could not match all CDRs to known signatur masks -> write warning
                if InCountAnalyzed < InCount -5  then                           -- 041SO
                    ErrorMsg := 'Missing ' || cMatchingRevaHeaderRow.revah_id
                    || ' Signature Masks for analyzed file'
                    || ' (Incount = ' || InCount || ', MatchCount = ' || InCountAnalyzed || ' )';  -- 040SO
                    PKG_COMMON.INSERT_WARNING (
                        vMePkg,
                        Me,
                        'REVA-WARNING',
                        ErrorMsg ,
                        CurrentBihid,
                        p_BOH_ID,
                        NULL,
                        NULL,
                        '1000000029'
                    ); -- 035SO -- 033SO -- 001SO
                end if;

                -- Create missing signatures and increment counters for them
                SqlStm := cMatchingRevaHeaderRow.revah_newsigsql;
                SqlStm := replace(SqlStm, '<MINDATE>', rConfig.REVAC_FILE_MAX_AGE / 24/3600);        -- 021SO
                SqlStm := replace(SqlStm, '<REVAH_ID>', cMatchingRevaHeaderRow.revah_id);            -- 008SO
                SqlStm := replace(SqlStm, '<REVAH_SRCTYPE>',cMatchingRevaHeaderRow.revah_srctype);   -- 008SO
                SqlStm := replace(SqlStm, '<REVAH_PACID>', cMatchingRevaHeaderRow.revah_pacid);      -- 008SO

                --3. Analyze all unknow Signatures and create new Counters
                if INSTR(SqlStm,':2') > 0 then
                    open cvCurVar for SqlStm using CurrentBihid, CurrentBihid;  -- 037SO
                else
                    open cvCurVar for SqlStm using CurrentBihid;                -- 037SO
                end if;
                loop
                    fetch cvCurVar into rUnknownSignature;
                    exit when cvCurVar%NOTFOUND;
                    begin
                        -- create signature if not already done for other day in same file
                        BEGIN
                            SELECT REVASM_ID
                            INTO   NewSigmaskId
                            FROM   REVA_SIGMASK
                            WHERE  REVASM_REVAHID = cMatchingRevaHeaderRow.revah_id
                            AND    REVASM_CODE = rUnknownSignature.revasm_code
                            AND    REVASM_ESID = 'A';
                        EXCEPTION
                            WHEN NO_DATA_FOUND
                            THEN
                            NewSigmaskId := generateuniquekey('G');
                            --Insert new Signature mask
                            INSERT INTO reva_sigmask (
                                REVASM_ID,
                                REVASM_CODE,
                                REVASM_REVAHID,
                                REVASM_ESID,
                                REVASM_ETID,
                                REVASM_ORDER,
                                REVASM_DESC
                            ) VALUES (
                               NewSigmaskId,
                               rUnknownSignature.revasm_code,
                               cMatchingRevaHeaderRow.revah_id,
                               rRevaEsid.active,
                               'ERROR',
                               999.9999,
                               'Unknown Signature ' || rUnknownSignature.revasm_code
                            );  -- 009SO
                            ErrorMsg := 'Added Signature ' || rUnknownSignature.revasm_code
                            || ' as ' || NewSigmaskId
                            || ' to ' || cMatchingRevaHeaderRow.revah_id;       -- 040SO
                            PKG_COMMON.INSERT_WARNING (
                                vMePkg,
                                Me,
                                'REVA-WARNING',
                                ErrorMsg ,
                                CurrentBihid,
                                p_BOH_ID,
                                NULL,
                                NULL,
                                '1000000029'
                            );                                                  -- 039SO
                        END;

                        -- update or insert counter
                        update reva_counter set
                            revac_in = revac_in + rUnknownSignature.incount,
                            revac_out = revac_out + rUnknownSignature.outcount
                        where revac_revasmid = NewSigmaskId
                        and revac_date = rUnknownSignature.bd_datetime;
                        if (SQL%ROWCOUNT = 0) then
                            --Create new Counter
                            insert into reva_counter (
                                revac_date,
                                revac_revasmid,
                                revac_in,
                                revac_out)
                            values (
                                rUnknownSignature.bd_datetime,
                                NewSigmaskId,
                                rUnknownSignature.incount,
                                rUnknownSignature.outcount);
                        end if;
                        --Count analyzed in CDRs for later comparing between InCount and InCountSigMasks
                        InCountAnalyzed := InCountAnalyzed + rUnknownSignature.incount;
                    end;
                end loop; --cvCurVar
                close cvCurVar;
            end if;     --(InCount <> InCountAnalyzed)

            if (bDebug) then
                pkg_debug.debug_reva(CurrentBihid,p_Boh_Id,cMatchingRevaHeaderRow.revah_id, to_number(InCount), 'END','Reva From=>To: '||cMatchingRevaHeaderRow.revah_Srctype||'=>'||cMatchingRevaHeaderRow.revah_pacid);
            end if;

        end loop; -- loop for cMatchingRevaHeader
        close cMatchingRevaHeader;

        --Check finally analyzed input CDR count ---------------------------------------------------------------------
        if (InCount <> InCountAnalyzed) then
            --Its not possible to analyze all CDRs properly, last shot missed -> rollback for this file (BIH_ID)
            ROLLBACK;
            BihRevasid := rRevaEsid.error;
            ErrorMsg  := pkg_admin_common.geterrordesc('NO_MATCHINGINCOUNT');
            ErrorMsg        := ErrorMsg ||' (Incount = '||InCount||', InCountAnalyzed = '||InCountAnalyzed||').';
            PKG_COMMON.INSERT_WARNING (
                vMePkg,
                Me,
                'REVA-ERROR',
                ErrorMsg ,
                CurrentBihid,
                p_BOH_ID,
                NULL,
                NULL,
                '1000000027'
            ); -- 035SO -- 033SO -- 001SO
        ELSE
            BihRevasid := rRevaEsid.done;
        end if;

        -- Set bih_etid flag to new state -------------------------------------------------------------------
        update biheader set
            bih_revasid = BihRevasid, bih_dateanalyzed = sysdate
        where bih_id = CurrentBihid;

        ReccountDone := ReccountDone+InCountAnalyzed;

        PKG_REVI.REVI_INDEX_FILE(CurrentBihid,p_BOH_ID);                        -- 022SO

        commit;

    end loop; --Repeat unless we analyzed a certain amount of CDRs -> see REVA_CONFIG

    RecordsAffected := ReccountDone;    -- 003SO
    ErrorCode := 0;                 -- 005SO    only show error if exception is raised
    ErrorMsg  := '';                -- 005SO    only show error if exception is raised
    ReturnStatus := 1;

exception

    when PKG_COMMON.EXCP_INCONVENIENT_TIME then
        ErrorCode := PKG_COMMON.ENO_INCONVENIENT_TIME;
        ErrorMsg := PKG_COMMON.EDESC_INCONVENIENT_TIME;
        ReturnStatus := PKG_COMMON.RETURN_STATUS_SUSPENDED;

    when PKG_COMMON_PACKING.EXCP_STATISTICS_FAILURE then
        ErrorCode := PKG_COMMON_PACKING.ENO_STATISTICS_FAILURE;
        ErrorMsg := PKG_COMMON_PACKING.EDESC_STATISTICS_FAILURE;
        ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;

    when PKG_COMMON_PACKING.EXCP_WORKFLOW_ABORT then
        ErrorCode := PKG_COMMON_PACKING.ENO_WORKFLOW_ABORT;
        ErrorMsg := PKG_COMMON_PACKING.EDESC_WORKFLOW_ABORT;
        ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;

    when no_bohid then
        ErrorCode := 1000000026;
        ErrorMsg  := pkg_admin_common.geterrordesc('NO_BOHID');
        RecordsAffected := ReccountDone;    -- 003SO
        ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;   -- 034SO

    when Others then
        rollback;
        ReturnStatus := 0;
        ErrorCode := SQLCODE;
        ErrorMsg  := PKG_COMMON.getHardErrorDesc;                               -- 034SO
        RecordsAffected := ReccountDone;                                        -- 003SO
        PKG_COMMON.INSERT_WARNING (
            vMePkg,
            Me,
            'PLSQL-ERROR',
            ErrorMsg ,
            CurrentBihid,
            p_BOH_ID,
            NULL,
            NULL,
            ErrorCode
        );  -- 035SO-- 033SO
end;


----------------------------------------------------------------------
-- Stubs for different XPIOCs
----------------------------------------------------------------------

Procedure SP_TRY_REVA_RECENT_MSC (
    p_PAC_ID          In      Varchar2,    -- 023SO
    p_BOH_ID          In Out  Varchar2,
    RecordsAffected   Out     Number,
    ErrorCode         Out     Number,
    ErrorMsg          Out     Varchar2,
    ReturnStatus      In Out  Number)

is

begin

        REVA_RECENT(
        p_PAC_ID,
        'REVA-MSC',
        '''MSC''',      -- 027SO 'SELECT SRCT_ID FROM SRCTYPE WHERE SRCT_ID = ''MSC'' MINUS SELECT DISTINCT REVAH_SRCTYPE FROM REVA_HEADER WHERE REVAH_ESID = ''U''',
        NULL,           -- 027SO
        p_BOH_ID,
        RecordsAffected,ErrorCode,ErrorMsg,ReturnStatus
        );

end SP_TRY_REVA_RECENT_MSC;

Procedure SP_TRY_REVA_RECENT_SMSC (
    p_PAC_ID          In      Varchar2,    -- 023SO
    p_BOH_ID          In Out  Varchar2,
    RecordsAffected   Out     Number,
    ErrorCode         Out     Number,
    ErrorMsg          Out     Varchar2,
    ReturnStatus      In Out  Number)

is

begin
        REVA_RECENT(
        p_PAC_ID,
        'REVA-SMSC',
        '''SMSC'',''SMSN''',                -- 036SO -- 027SO 'SELECT SRCT_ID FROM SRCTYPE WHERE SRCT_ID = ''SMSC'' MINUS SELECT DISTINCT REVAH_SRCTYPE FROM REVA_HEADER WHERE REVAH_ESID = ''U''',
        NULL,                               -- 028SO '''' || SUBSTR(p_PAC_ID,5) || '''', -- 027SO
        p_BOH_ID,
        RecordsAffected,ErrorCode,ErrorMsg,ReturnStatus)
        ;   -- 023SO
end  SP_TRY_REVA_RECENT_SMSC;


Procedure SP_TRY_REVA_RECENT_OTHERS (
    p_PAC_ID          In      Varchar2,    -- 023SO
    p_BOH_ID          In Out  Varchar2,
    RecordsAffected   Out     Number,
    ErrorCode         Out     Number,
    ErrorMsg          Out     Varchar2,
    ReturnStatus      In Out  Number)

is
begin
        -- vHeaderAllStm := 'select * from reva_header where revah_esid = '''||rRevaEsid.active||''' and revah_srctype not like ''MSC''';  -- 010SO
        -- vSrctypeStm := 'select srct_id from srctype where srct_id not like ''MSC''';
        REVA_RECENT(
        p_PAC_ID,
        'REVA-OTHERS',
        '''ISRV'',''MMSC'',''STAN''', -- 029SO  'SELECT SRCT_ID FROM SRCTYPE WHERE SRCT_ID not in (''MSC'',''SMSC'') MINUS SELECT DISTINCT REVAH_SRCTYPE FROM REVA_HEADER WHERE REVAH_ESID = ''U''',
        NULL,               -- 027SO
        p_BOH_ID,
        RecordsAffected,ErrorCode,ErrorMsg,ReturnStatus)
        ;   -- 026SO -- 023SO
end  SP_TRY_REVA_RECENT_OTHERS;
-------------------------------------------------------------------------

END;  --end package pkg_reva
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- PKG_REVI  (Package Body) 
--
CREATE OR REPLACE PACKAGE BODY SBS1_ADMIN.PKG_REVI
IS

-- MODIFICATION HISTORY (see also Package Body)
-- Person       Date            Comments
-- ---------    ------          ------------------------------------------
-- SO               2007-09-18  Creation
-- 001SO        2007-09-30  Correct type problem
-- 002SO        2007-10-13  Corrections
-- 003SO        2007-10-13  Do not assume BillingId to be present (to be reverted)
-- 004SO        2007-11-07  Patch for first month (october 2007)
-- 005SO        2007-11-08  Correct typo
-- 006SO        2008-01-10  Correct SMS and MMS Master cursors (MT only, no MMS-LA)
-- 007SO        2008-01-11  Use truncate instead of delete for index data
-- 008SO        2008-01-21  Remove Condition for iServer/MB distinction
-- 009SO        2008-03-05  Do not index SMS auto-response content %-DEL-% (to be removed after MB Bugfix)
-- 010SO        2008-03-05  Do not index SMS Submits without BillingIdentifier (to be removed after MB Bugfix)
-- 011SO        2008-04-11  use to_date() in date comparisons for proper ExplainPlan and TKPROV
-- 012SO        2008-04-12  Correct typo in MMSB lookup
-- 013SO        2008-04-12  Exclude 333 and 888 mass sendings until we have a better index
-- 014SO        2008-06-02  Remove previous exclusion made in -- 013SO
-- 015SO        2008-06-12  Remove previous exclusions made in -- 010SO and -- 009SO
-- 016SO        2008-06-18  Add file based scanning for near realtime RA analysis
-- 017SO        2008-06-19  Ignore OTA SMS on ShortID 800
-- 018SO        2008-06-19  Also monitor billing states 4 (zero charge ignored) and 7 (MSISDN range ignored)
-- 019SO        2008-07-02  Make use of content lookup for MBB lookup configurable (set to OFF, files only)
-- 020SO        2008-09-07  Implement methods for monthly prepaid charge checking
-- 021SO        2008-09-08  Adapt to details of the new DSS table semantics in CDRSMS and CDRMMS
-- 022SO        2008-09-13  Implement methods for near realtime prepaid charge checking
-- 023SO        2008-09-15  Implement offset for index period (for tests)
-- 024SO        2008-10-17  Rename ROWID to ROWID_PPB in DSS CDR views
-- 025SO        2009-05-06  Remove old and obsolete VASOL constraints
-- 026SO        2009-05-06  Include OTA CDRs in RA to DSS (override RequestID by timestamp, calltype=20)
-- 027SO        2009-05-07  Include request only content
-- 028SO        2009-05-07  Index all billed content tickets of adssured source types
-- 029SO        2009-05-07  Suppress error messages for OTA and request only cases
-- 030SO        2009-05-08  Default empty ShortID on DSS with 800 (OTA)
-- 031SO        2009-05-09  Enable OTA for prepaid check (DSS scan)
-- 032SO        2009-09-09  Remove time condition when looking up DSS content charges
-- 033SO        2010-05-06  Remove support for OTA
-- 034SO        2010-06-28  Correct Index Hints (<table> <index>)
-- 035SO        26.08.2010  Rename procedures according to driving Packing-ID
-- 036SO        11.04.2011  Consider Tariff T for InfoService Transport (Televote)
-- 037SO        14.12.2011  Remove schema qualifier "S B S 0 ."
-- 038SO        14.03.2012  Remove obsolete code for MMSB
-- 039SO        18.04.2012  Use PKG_COMMON.INSERT_WARNING
-- 040SO        10.05.2012  Correct Hint
-- 041SO        16.05.2012  Improve error logging
-- 042SO        18.05.2012  Correct error logging parameters
-- 043SO        25.11.2014  Correlation change for MBS A-Party-Billing: B-Number is Destination
-- 044SO        06.03.2016  Support for CDRs from new SMSC
-- 045SO        31.10.2018  Remove dependency on UCP-Format for MessageId (support MBS over SMPP)
-- 046SO        31.10.2018  Remove check on transport type on prepaid billing logs


vMePkg              varchar2(30) := 'PKG_REVI';

cNotBilledBySbs     VARCHAR2(1) := '0';         -- 028SO
-- cBilledBySbs        VARCHAR2(1) := '1';      -- 028SO -- 018SO
-- cZeroChargeIgnore   VARCHAR2(1) := '4';      -- 028SO -- 018SO
-- cIgnoreSubscriber   VARCHAR2(1) := '7';      -- 028SO -- 018SO

cWarnMissingContentForMbb    boolean := false;       -- 019SO

bDebug                          boolean;
rConfig                         revi_config%rowtype;

MonthToDo           integer := -1;      -- -1 = last month, 0 = this month for tests
MonthToStore        integer := -1;      -- -1 = last month, 0 = this month for tests    -- 023SO

----------------------------------------------------------------------------------------------------------------
FUNCTION getConfig return revi_config%rowtype
is
    vConfig            revi_config%rowtype;
begin
    select * into vConfig
        from revi_config
        where REVIC_id = 'DEFAULT';
                if (vConfig.REVIC_debugmode=1) then
                        bDebug:=true;
                else
                        bDebug:=false;
                end if;
    return vConfig;
exception
     WHEN Others THEN
        return vConfig;
end;

procedure SP_CONS_REVICS (
    p_PAC_ID          In      Varchar2,     -- 'REVICS'
    p_BOH_ID          In      Varchar2,
    RecordsAffected   Out     Number,
    ErrorCode         Out     Number,
    ErrorMsg          Out     Varchar2,
    ReturnStatus      In Out  Number
)
-- find and index SMS and MMS transport submits for chargeable content CDRs for last period
is
        Me varchar2(40) := 'REVI_INDEX_CONTENT_SUB';

    CURSOR cMaster(period varchar2) is
    SELECT /*+ NO_INDEX(BDETAIL) */
        ROWID,
        to_char(BD_DATETIME,'yyyymmddhh24miss') BD_DATETIME_STR,
        BD_MSISDN_A,
        BD_MSISDN_B,                                                            -- 043SO
        BD_SHORTID,
        BD_SERVICE,
        BD_TRANSPORTMEDIUM,
        BD_REQUESTID,                                                           -- 033SO -- 026SO
        BD_MSGID,
        BD_COUNTTR
    FROM
        BDETAIL
    WHERE
                BD_SRCTYPE IN ('ISRV')                                              -- 033SO -- 026SO
        AND     BD_MAPSID = 'R'
        AND     BD_DEMO = 0
        AND     BD_BILLED <> cNotBilledBySbs  -- 026SO IN (cBilledBySbs,cZeroChargeIgnore,cIgnoreSubscriber) -- 018SO
        AND     BD_DATETIME >= add_months(trunc(sysdate,'MONTH'),MonthToDo)
        AND     BD_DATETIME < add_months(trunc(sysdate,'MONTH'),MonthToDo + 1)
        -- AND  LENGTH(BD_SERVICE) >= 10                                        -- 008SO
        -- AND BD_SHORTID not in ('333','888')                                  -- 014SO -- 013SO
            -- AND      (BD_SERVICE NOT LIKE '%-DEL-%'                                  -- 015SO -- 009SO (to be removed)
            -- OR BD_TRANSPORTMEDIUM <> 'SMS')                                      -- 015SO -- 009SO (to be removed)
        -- AND  BD_DATETIME >= to_date('26.10.2007','dd.mm.yyyy')               -- 004SO
    ;   -- 011SO

    cMasterRow         cMaster%rowtype;


    CURSOR cSmsSubmit(cM cMaster%rowtype) is                                    -- 001SO
    SELECT /*+ INDEX(BDETAIL1 IDX_BD_BILLID1) */
        ROWID
    FROM
        BDETAIL1
    WHERE       BD_MAPSID = 'R'
        AND     BD_MSISDN_B = cM.BD_MSISDN_B                                    -- 043SO
        AND     BD_CONSOLIDATION = cM.BD_SHORTID
        AND     BD_STATUS = 4
        AND BD_BILLID = cM.BD_REQUESTID
        AND BD_DATETIME >= to_date(cM.BD_DATETIME_STR,'YYYYMMDDHH24MISS') -  1.1/24    -- 045SO
        AND BD_DATETIME <= to_date(cM.BD_DATETIME_STR,'YYYYMMDDHH24MISS') +  rConfig.REVIC_DELAY_SMS_SUB/86400.0   -- 045SO
    ; -- 044SO


    CURSOR cSmsLongSubmit(cM cMaster%rowtype) is
    SELECT /*+ INDEX(BDETAIL1 IDX_BD_BILLID1) */
        ROWID
    FROM
        BDETAIL1
    WHERE       BD_MAPSID = 'R'
        AND     BD_MSISDN_B = cM.BD_MSISDN_B                                    -- 043SO
        AND     BD_CONSOLIDATION = cM.BD_SHORTID
        AND     BD_STATUS = 4
        AND BD_BILLID = cM.BD_REQUESTID
        AND BD_DATETIME >= to_date(cM.BD_DATETIME_STR,'YYYYMMDDHH24MISS') -  1.1/24 -- 045SO
        AND BD_DATETIME <= to_date(cM.BD_DATETIME_STR,'YYYYMMDDHH24MISS') +  rConfig.REVIC_DELAY_SMS_SUB/86400.0 -- 045SO
    ;

    CURSOR cMmsSubmit(cM cMaster%rowtype) is                                    -- 001SO
    SELECT /*+ INDEX(BDETAIL6 IDX_BD_UMSGGRPID) */
        ROWID
    FROM
        BDETAIL6
    WHERE
                BD_SRCTYPE = 'MMSC'
        AND     BD_DEMO = 0
        AND     BD_MAPSID = 'R'
        AND     BD_MSISDN_B = cM.BD_MSISDN_B                                    -- 043SO
        AND     BD_MSGTYPE = 0
        AND     BD_UMSGGRPID = cM.BD_MSGID
        AND     BD_CDRRECTYPE = 'MM7Orecord'
        AND     BD_EVENTDISP = 2
        AND     BD_SHORTID = cM.BD_SHORTID
        AND BD_DATETIME >= to_date(cM.BD_DATETIME_STR,'yyyymmddhh24miss') -  1.1/24
        AND BD_DATETIME < to_date(cM.BD_DATETIME_STR,'yyyymmddhh24miss') + rConfig.REVIC_DELAY_MMS_SUB/86400.0
    ;   -- 011SO


    l_SepId_To_Do             Varchar2(6);    -- 023SO
    l_SepId_To_Store          Varchar2(6);    -- 023SO

    l_matching_count      integer;

        no_bohid exception;

begin

        --Initialize Variables
    RecordsAffected := 0;
    ReturnStatus := 0;

        --Read Config-Table of REVA_CONFIG
        rConfig := pkg_revi.getConfig;

        l_SepId_To_Do := to_char(add_months(trunc(sysdate,'MONTH'),MonthToDo),'YYYYMM');  -- 023SO
        l_SepId_To_Store := to_char(add_months(trunc(sysdate,'MONTH'),MonthToStore),'YYYYMM');  -- 023SO

        EXECUTE IMMEDIATE 'ALTER TABLE REVI_CONTENT_SUB TRUNCATE PARTITION INFO' || l_SepId_To_Store; -- 007SO

    for cMasterRow in cMaster(l_SepId_To_Do) loop
        -- Analyze master CDR
        RecordsAffected := RecordsAffected + 1;
        l_matching_count := 0;
        if cMasterRow.BD_TRANSPORTMEDIUM = 'SMS' and cMasterRow.BD_COUNTTR <= 1 then    -- 027SO
            for cSmsSubmitRow in cSmsSubmit(cMasterRow) loop
                INSERT INTO REVI_CONTENT_SUB (
                        REVICS_SEPID,
                        REVICS_SHORTID,
                        REVICS_ROWID_MASTER,
                        REVICS_COUNT_EXPECTED,
                        REVICS_TABLE_SLAVE,
                        REVICS_ROWID_SLAVE
                ) VALUES (
                        l_SepId_To_Store,
                        cMasterRow.BD_SHORTID,
                        cMasterRow.ROWID,
                        cMasterRow.BD_COUNTTR,
                        'BDETAIL1',
                        cSmsSubmitRow.ROWID
                );
                l_matching_count := l_matching_count + 1;
            end loop;
            if l_matching_count = 0 then
                -- Insert index row for missing transport CDR
                INSERT INTO REVI_CONTENT_SUB (
                        REVICS_SEPID,
                        REVICS_SHORTID,
                        REVICS_ROWID_MASTER,
                        REVICS_COUNT_EXPECTED,
                        REVICS_TABLE_SLAVE,
                        REVICS_ROWID_SLAVE
                ) VALUES (
                        l_SepId_To_Store,
                        cMasterRow.BD_SHORTID,
                        cMasterRow.ROWID,
                        cMasterRow.BD_COUNTTR,
                        'BDETAIL1',
                        NULL
                );
            end if;
        elsif cMasterRow.BD_TRANSPORTMEDIUM = 'SMS' and cMasterRow.BD_COUNTTR > 1 then
            for cSmsLongSubmitRow in cSmsLongSubmit(cMasterRow) loop
                INSERT INTO REVI_CONTENT_SUB (
                        REVICS_SEPID,
                        REVICS_SHORTID,
                        REVICS_ROWID_MASTER,
                        REVICS_COUNT_EXPECTED,
                        REVICS_TABLE_SLAVE,
                        REVICS_ROWID_SLAVE
                ) VALUES (
                        l_SepId_To_Store,
                        cMasterRow.BD_SHORTID,
                        cMasterRow.ROWID,
                        cMasterRow.BD_COUNTTR,
                        'BDETAIL1',
                        cSmsLongSubmitRow.ROWID
                );
                l_matching_count := l_matching_count + 1;
            end loop;
            if l_matching_count = 0 then
                -- Insert index row for missing transport CDR
                INSERT INTO REVI_CONTENT_SUB (
                        REVICS_SEPID,
                        REVICS_SHORTID,
                        REVICS_ROWID_MASTER,
                        REVICS_COUNT_EXPECTED,
                        REVICS_TABLE_SLAVE,
                        REVICS_ROWID_SLAVE
                ) VALUES (
                        l_SepId_To_Store,
                        cMasterRow.BD_SHORTID,
                        cMasterRow.ROWID,
                        cMasterRow.BD_COUNTTR,
                        'BDETAIL1',
                        NULL
                );
            end if;
        elsif cMasterRow.BD_TRANSPORTMEDIUM = 'SMS' and cMasterRow.BD_COUNTTR is NULL then
            NULL;   -- cannot index this SMS content (
        elsif cMasterRow.BD_TRANSPORTMEDIUM = 'MMS' then
            for cMmsSubmitRow in cMmsSubmit(cMasterRow) loop
                INSERT INTO REVI_CONTENT_SUB (
                    REVICS_SEPID,
                    REVICS_SHORTID,
                    REVICS_ROWID_MASTER,
                    REVICS_COUNT_EXPECTED,
                    REVICS_TABLE_SLAVE,
                    REVICS_ROWID_SLAVE
                    ) VALUES (
                    l_SepId_To_Store,
                    cMasterRow.BD_SHORTID,
                    cMasterRow.ROWID,
                    NVL(cMasterRow.BD_COUNTTR,1),
                    'BDETAIL6',
                    cMmsSubmitRow.ROWID
                );
                l_matching_count := l_matching_count + 1;
            end loop;
            if l_matching_count = 0 then
                -- Insert index row for missing transport CDR
                INSERT INTO REVI_CONTENT_SUB (
                    REVICS_SEPID,
                    REVICS_SHORTID,
                    REVICS_ROWID_MASTER,
                    REVICS_COUNT_EXPECTED,
                    REVICS_TABLE_SLAVE,
                    REVICS_ROWID_SLAVE
                    ) VALUES (
                    l_SepId_To_Store,
                    cMasterRow.BD_SHORTID,
                    cMasterRow.ROWID,
                    NVL(cMasterRow.BD_COUNTTR,1),
                    'BDETAIL6',
                    NULL
                );
            end if;
        end if;

    end loop;

    ErrorCode := 0;
    ErrorMsg  := '';
    ReturnStatus := 1;
/*
exception
        when Others then
                rollback;
                ReturnStatus := 0;
                ErrorCode := SQLCODE;
                ErrorMsg  := PKG_COMMON.getHardErrorDesc;                       -- 041SO
                RecordsAffected := 0;
                pkg_bdetail_common.INSERT_WARNING (vMePkg, Me, 'PLSQL-ERROR', ErrorMsg , ErrorCode);
*/
end  SP_CONS_REVICS;

procedure SP_CONS_REVIPRE
(
    p_PAC_ID          In      Varchar2,     -- 'REVIPRE'
    p_BOH_ID          In      Varchar2,
    RecordsAffected   Out     Number,
    ErrorCode         Out     Number,
    ErrorMsg          Out     Varchar2,
    ReturnStatus      In Out  Number
)
-- 020SO
-- find and index prepaid charges on DSS for chargeable content CDRs for last period
is
        Me varchar2(40) := 'REVI_INDEX_CONTENT_PRE';

    CURSOR cMaster(period varchar2) is
    SELECT /*+ NO_INDEX(BDETAIL) */
        ROWID,
        BD_DATETIME,
        BD_MSISDN_A,
        BD_SHORTID,
        BD_SERVICE,
        BD_TRANSPORTMEDIUM,
        BD_REQUESTID                                                            -- 033SO  -- 026SO
    FROM
        BDETAIL
    WHERE
                BD_SRCTYPE IN ('ISRV')                                              -- 033SO -- 026SO
        AND     BD_MAPSID = 'R'
        AND     BD_DEMO = 0
        AND     BD_PREPAID = 'Y'
        -- AND (BD_AMOUNTCU <> 0.00 OR BD_ONLINECHARGE is not NULL)             -- 028SO
        AND     BD_BILLED <> cNotBilledBySbs                                        -- 028SO IN (cBilledBySbs)
        AND     BD_DATETIME >= add_months(trunc(sysdate,'MONTH'),MonthToDo)
        AND     BD_DATETIME < add_months(trunc(sysdate,'MONTH'),MonthToDo + 1)
        -- AND BD_ONLINECHARGE IS NOT NULL   -- 025SO    -- $$$$$$$$$$$ to be removed after VASOL migration
    ;

    cMasterRow         cMaster%rowtype;

    CURSOR cDssCdrSms(cM cMaster%rowtype) is
    SELECT
        ROWID_PPB,
        0.001 * UNIT    CHARGED_AMOUNT
    FROM
        CDRSMS         -- @DSS
    WHERE   CALLTYPE in (120,20)                                                -- 026SO
        -- AND TRANSPORT_MEDIUM = 'SMS'                                         -- 046SO
        AND     REQUEST_ID = cM.BD_REQUESTID || '_' || cM.BD_MSISDN_A
    ;   -- 024SO -- 021SO

    CURSOR cDssCdrMms(cM cMaster%rowtype) is
    SELECT
        ROWID_PPB,
        0.001 * UNIT    CHARGED_AMOUNT
    FROM
        CDRMMS         -- @DSS
    WHERE   CALLTYPE = 121
        -- AND TRANSPORT_MEDIUM = 'MMS'                                         -- 046SO
        AND     REQUEST_ID = cM.BD_REQUESTID || '_' || cM.BD_MSISDN_A
    ;   -- 024SO -- 024SO -- 021SO

    l_SepId_To_Do             Varchar2(6);    -- 023SO
    l_SepId_To_Store          Varchar2(6);    -- 023SO
    l_matching_count      integer;
        no_bohid exception;

begin

        --Initialize Variables
    RecordsAffected := 0;
    ReturnStatus := 0;

        --Read Config-Table of REVA_CONFIG
        rConfig := pkg_revi.getConfig;

        l_SepId_To_Do := to_char(add_months(trunc(sysdate,'MONTH'),MonthToDo),'YYYYMM');  -- 023SO
        l_SepId_To_Store := to_char(add_months(trunc(sysdate,'MONTH'),MonthToStore),'YYYYMM');  -- 023SO

        EXECUTE IMMEDIATE 'ALTER TABLE REVI_PRE TRUNCATE PARTITION INFO' || l_SepId_To_Store;

    for cMasterRow in cMaster(l_SepId_To_Do) loop
        -- Analyze master CDR
        RecordsAffected := RecordsAffected + 1;
        l_matching_count := 0;
        if cMasterRow.BD_TRANSPORTMEDIUM = 'SMS' then
            for cDssCdrSmsRow in cDssCdrSms(cMasterRow) loop
                INSERT INTO REVI_PRE (
                        REVIPRE_SEPID,
                        REVIPRE_SHORTID,
                        REVIPRE_ROWID_MASTER,
                        REVIPRE_TABLE_SLAVE,
                        REVIPRE_ROWID_SLAVE,
                        REVIPRE_CHARGED_AMOUNT
                ) VALUES (
                        l_SepId_To_Store,
                        cMasterRow.BD_SHORTID,
                        cMasterRow.ROWID,
                        'CDR' || cMasterRow.BD_TRANSPORTMEDIUM,
                        cDssCdrSmsRow.ROWID_PPB,
                        cDssCdrSmsRow.CHARGED_AMOUNT
                );  -- 024SO
                l_matching_count := l_matching_count + 1;
            end loop;
            if l_matching_count = 0 then
                -- Insert index row for missing charge record
                INSERT INTO REVI_PRE (
                        REVIPRE_SEPID,
                        REVIPRE_SHORTID,
                        REVIPRE_ROWID_MASTER,
                        REVIPRE_TABLE_SLAVE,
                        REVIPRE_ROWID_SLAVE,
                        REVIPRE_CHARGED_AMOUNT
                ) VALUES (
                        l_SepId_To_Store,
                        cMasterRow.BD_SHORTID,
                        cMasterRow.ROWID,
                        'CDR' || cMasterRow.BD_TRANSPORTMEDIUM,
                        NULL,
                        NULL
                );
            end if;
        elsif cMasterRow.BD_TRANSPORTMEDIUM = 'MMS' then
            for cDssCdrMmsRow in cDssCdrMms(cMasterRow) loop
                INSERT INTO REVI_PRE (
                        REVIPRE_SEPID,
                        REVIPRE_SHORTID,
                        REVIPRE_ROWID_MASTER,
                        REVIPRE_TABLE_SLAVE,
                        REVIPRE_ROWID_SLAVE,
                        REVIPRE_CHARGED_AMOUNT
                ) VALUES (
                        l_SepId_To_Store,
                        cMasterRow.BD_SHORTID,
                        cMasterRow.ROWID,
                        'CDR' || cMasterRow.BD_TRANSPORTMEDIUM,
                        cDssCdrMmsRow.ROWID_PPB,
                        cDssCdrMmsRow.CHARGED_AMOUNT
                );  -- 024SO
                l_matching_count := l_matching_count + 1;
            end loop;
            if l_matching_count = 0 then
                -- Insert index row for missing charge record
                INSERT INTO REVI_PRE (
                        REVIPRE_SEPID,
                        REVIPRE_SHORTID,
                        REVIPRE_ROWID_MASTER,
                        REVIPRE_TABLE_SLAVE,
                        REVIPRE_ROWID_SLAVE,
                        REVIPRE_CHARGED_AMOUNT
                ) VALUES (
                        l_SepId_To_Store,
                        cMasterRow.BD_SHORTID,
                        cMasterRow.ROWID,
                        'CDR' || cMasterRow.BD_TRANSPORTMEDIUM,
                        NULL,
                        NULL
                );
            end if;
        end if;

    end loop;

    ErrorCode := 0;
    ErrorMsg  := '';
    ReturnStatus := 1;
/*
exception
        when Others then
                rollback;
                ReturnStatus := 0;
                ErrorCode := SQLCODE;
                ErrorMsg  := PKG_COMMON.getHardErrorDesc;                       -- 041SO
                RecordsAffected := 0;
                pkg_bdetail_common.INSERT_WARNING (vMePkg, Me, 'PLSQL-ERROR', ErrorMsg , ErrorCode);
*/
end  SP_CONS_REVIPRE;

procedure REVI_INDEX_CONTENT_FILE (
    p_BIH_ID          In   Varchar2,
    p_BOH_ID          In   Varchar2
)
-- find and index SMS and MMS transport submits for chargeable content CDRs of the given file
is  -- 016SO

        Me varchar2(40) := 'REVI_INDEX_CONTENT_FILE';

    CURSOR cMaster is
    SELECT /*+ INDEX (BDETAIL IDX_BD_BIHID) */
        ROWID,
        BD_DATETIME,       -- 022SO
        to_char(BD_DATETIME,'yyyymmddhh24miss') BD_DATETIME_STR,
        BD_MSISDN_A,
        BD_MSISDN_B,       -- 043SO
        BD_SHORTID,
        BD_SERVICE,
        BD_TRANSPORTMEDIUM,
        BD_REQUESTID,                                                           -- 033SO -- 026SO
        BD_MSGID,
        BD_COUNTTR,
        BD_BILLED,         -- 021SO
        BD_AMOUNTCU,       -- 021SO
        BD_ONLINECHARGE,   -- 021SO
        BD_PREPAID,        -- 028SO
        BD_SRCTYPE         -- 029SO
    FROM
        BDETAIL
    WHERE
                BD_SRCTYPE in ('ISRV')                                              -- 033SO -- 026SO
                AND BD_BIHID = p_BIH_ID
        AND     BD_MAPSID = 'R'
        AND     BD_DEMO = 0
        AND     BD_BILLED <> cNotBilledBySbs              -- 028SO IN (cBilledBySbs,cZeroChargeIgnore,cIgnoreSubscriber) -- 018SO
        AND     BD_DATETIME >= sysdate-30
        AND     BD_DATETIME < sysdate + 1
    ;   -- 034SO -- 022SO -- 016SO  -- compare to similar conditions in REVI_INDEX_CONTENT_SUB

    cMasterRow         cMaster%rowtype;

    CURSOR cSmsSubmit(cM cMaster%rowtype) is
    SELECT /*+ INDEX(BDETAIL1 IDX_BD_BILLID1) */
        ROWID
    FROM
        BDETAIL1
    WHERE       BD_MAPSID = 'R'
        AND     BD_MSISDN_B = cM.BD_MSISDN_B        -- 043SO
        AND     BD_CONSOLIDATION = cM.BD_SHORTID
        AND     BD_STATUS = 4
        AND BD_BILLID = cM.BD_REQUESTID
        AND BD_DATETIME >= to_date(cM.BD_DATETIME_STR,'YYYYMMDDHH24MISS') -  1.1/24 -- 045SO
        AND BD_DATETIME <= to_date(cM.BD_DATETIME_STR,'YYYYMMDDHH24MISS') +  rConfig.REVIC_DELAY_SMS_SUB/86400.0 -- 045SO
    ;   -- 016SO  -- compare to similar conditions in REVI_INDEX_CONTENT_SUB

    CURSOR cSmsLongSubmit(cM cMaster%rowtype) is
    SELECT /*+ INDEX(BDETAIL1 IDX_BD_BILLID1) */
        ROWID
    FROM
        BDETAIL1
    WHERE       BD_MAPSID = 'R'
        AND     BD_MSISDN_B = cM.BD_MSISDN_B       -- 043SO
        AND     BD_CONSOLIDATION = cM.BD_SHORTID
        AND     BD_STATUS = 4
        AND BD_BILLID = cM.BD_REQUESTID
        AND BD_DATETIME >= to_date(cM.BD_DATETIME_STR,'YYYYMMDDHH24MISS') -  1.1/24    -- 045SO
        AND BD_DATETIME <= to_date(cM.BD_DATETIME_STR,'YYYYMMDDHH24MISS') +  rConfig.REVIC_DELAY_SMS_SUB/86400.0   -- 045SO
    ;   -- 016SO  -- compare to similar conditions in REVI_INDEX_CONTENT_SUB

    CURSOR cMmsSubmit(cM cMaster%rowtype) is
    SELECT /*+ INDEX(BDETAIL6 IDX_BD_UMSGGRPID) */
        ROWID
    FROM
        BDETAIL6
    WHERE
                BD_SRCTYPE = 'MMSC'
        AND     BD_DEMO = 0
        AND     BD_MAPSID = 'R'
        AND     BD_MSISDN_B = cM.BD_MSISDN_B    -- 043SO
        AND     BD_MSGTYPE = 0
        AND     BD_UMSGGRPID = cM.BD_MSGID
        AND     BD_CDRRECTYPE = 'MM7Orecord'
        AND     BD_EVENTDISP = 2
        AND     BD_SHORTID = cM.BD_SHORTID
        AND BD_DATETIME >= cM.BD_DATETIME -  1.1/24
        AND BD_DATETIME < cM.BD_DATETIME + rConfig.REVIC_DELAY_MMS_SUB/86400.0
    ;   -- 022SO -- 016SO  -- compare to similar conditions in REVI_INDEX_CONTENT_SUB


    CURSOR cDssCdrSms(cM cMaster%rowtype) is
    SELECT
        ROWID_PPB,
        0.001 * UNIT    CHARGED_AMOUNT
    FROM
        CDRSMS         -- @DSS
    WHERE   CALLTYPE in (120,20)                                                -- 026SO
        -- AND NVL(TRANSPORT_MEDIUM,'SMS') = 'SMS'                              -- 046SO
        AND     REQUEST_ID = cM.BD_REQUESTID || '_' || cM.BD_MSISDN_A
    ;   -- 024SO -- 022SO -- 021SO

    CURSOR cDssCdrMms(cM cMaster%rowtype) is
    SELECT
        ROWID_PPB,
        0.001 * UNIT    CHARGED_AMOUNT
    FROM
        CDRMMS         -- @DSS
    WHERE   CALLTYPE = 121
        -- AND NVL(TRANSPORT_MEDIUM,'MMS') = 'MMS'                              -- 046SO
        AND     REQUEST_ID = cM.BD_REQUESTID || '_' || cM.BD_MSISDN_A
    ;   -- 024SO -- 022SO -- 021SO


    l_SepId             Varchar2(6);
    l_matching_count      integer;
        l_update_count        integer;           -- 022SO
        l_ErrorCode         NUMBER;
        l_ErrorMsg          VARCHAR2(2000);
        l_amount_charged    FLOAT;             -- 022SO

begin

        rConfig := pkg_revi.getConfig;

    for cMasterRow in cMaster loop
        -- Analyze master CDR
        l_SepId := to_char(cMasterRow.BD_DATETIME,'YYYYMM');
        -- Search for transport submit
        l_matching_count := 0;
        if cMasterRow.BD_TRANSPORTMEDIUM = 'SMS' and cMasterRow.BD_COUNTTR <= 1 then    -- 028SO
            for cSmsSubmitRow in cSmsSubmit(cMasterRow) loop
                l_update_count := 0;
                if l_matching_count = 0 then
                    -- must check if orphan entry needs update
                    UPDATE REVI_CONTENT_SUB SET
                        REVICS_ROWID_SLAVE = cSmsSubmitRow.ROWID,
                        REVICS_COUNT_EXPECTED = cMasterRow.BD_COUNTTR
                    WHERE REVICS_SEPID = l_SepId
                        AND   REVICS_SHORTID = cMasterRow.BD_SHORTID
                        AND   REVICS_TABLE_SLAVE = 'BDETAIL1'
                        AND   REVICS_ROWID_MASTER = cMasterRow.ROWID
                        ;
                        l_update_count := SQL%Rowcount;
                end if;
                if l_update_count = 0 then
                    INSERT INTO REVI_CONTENT_SUB (
                        REVICS_SEPID,
                        REVICS_SHORTID,
                        REVICS_ROWID_MASTER,
                        REVICS_COUNT_EXPECTED,
                        REVICS_TABLE_SLAVE,
                        REVICS_ROWID_SLAVE
                        ) VALUES (
                        l_SepId,
                        cMasterRow.BD_SHORTID,
                        cMasterRow.ROWID,
                        cMasterRow.BD_COUNTTR,
                        'BDETAIL1',
                        cSmsSubmitRow.ROWID
                    );
                end if;
                l_matching_count := l_matching_count + 1;
            end loop;
            if l_matching_count = 0 then
                -- Insert index row for missing transport CDR
                INSERT INTO REVI_CONTENT_SUB (
                        REVICS_SEPID,
                        REVICS_SHORTID,
                        REVICS_ROWID_MASTER,
                        REVICS_COUNT_EXPECTED,
                        REVICS_TABLE_SLAVE,
                        REVICS_ROWID_SLAVE
                ) VALUES (
                        l_SepId,
                        cMasterRow.BD_SHORTID,
                        cMasterRow.ROWID,
                        cMasterRow.BD_COUNTTR,
                        'BDETAIL1',
                        NULL
                );
                if cMasterRow.BD_COUNTTR > 0 then                               -- 033SO -- 029SO
                    PKG_COMMON.INSERT_WARNING (
                        vMePkg,
                        Me,
                        cMasterRow.BD_DATETIME_STR,
                        'Missing SMS Submit CDR for Content CDR',
                        p_BIH_ID,
                        p_BOH_ID,
                        to_char(cMasterRow.ROWID),
                        cMasterRow.BD_SHORTID
                    );  -- 039SO
                end if;
            end if;
        elsif cMasterRow.BD_TRANSPORTMEDIUM = 'SMS' and cMasterRow.BD_COUNTTR > 1 then
            for cSmsLongSubmitRow in cSmsLongSubmit(cMasterRow) loop
                l_update_count := 0;
                if l_matching_count = 0 then
                    -- must check if orphan entry needs update
                    UPDATE REVI_CONTENT_SUB SET
                        REVICS_ROWID_SLAVE = cSmsLongSubmitRow.ROWID,
                        REVICS_COUNT_EXPECTED = cMasterRow.BD_COUNTTR
                    WHERE REVICS_SEPID = l_SepId
                        AND   REVICS_SHORTID = cMasterRow.BD_SHORTID
                        AND   REVICS_TABLE_SLAVE = 'BDETAIL1'
                        AND   REVICS_ROWID_MASTER = cMasterRow.ROWID
                        ;
                        l_update_count := SQL%Rowcount;
                end if;
                if l_update_count = 0 then
                    INSERT INTO REVI_CONTENT_SUB (
                        REVICS_SEPID,
                        REVICS_SHORTID,
                        REVICS_ROWID_MASTER,
                        REVICS_COUNT_EXPECTED,
                        REVICS_TABLE_SLAVE,
                        REVICS_ROWID_SLAVE
                        ) VALUES (
                        l_SepId,
                        cMasterRow.BD_SHORTID,
                        cMasterRow.ROWID,
                        cMasterRow.BD_COUNTTR,
                        'BDETAIL1',
                        cSmsLongSubmitRow.ROWID
                    );
                end if;
                l_matching_count := l_matching_count + 1;
            end loop;
            if l_matching_count = 0 then
                -- Insert index row for missing transport CDR
                INSERT INTO REVI_CONTENT_SUB (
                        REVICS_SEPID,
                        REVICS_SHORTID,
                        REVICS_ROWID_MASTER,
                        REVICS_COUNT_EXPECTED,
                        REVICS_TABLE_SLAVE,
                        REVICS_ROWID_SLAVE
                ) VALUES (
                        l_SepId,
                        cMasterRow.BD_SHORTID,
                        cMasterRow.ROWID,
                        cMasterRow.BD_COUNTTR,
                        'BDETAIL1',
                        NULL
                );
                PKG_COMMON.INSERT_WARNING (
                    vMePkg,
                    Me,
                    cMasterRow.BD_DATETIME_STR,
                    'Missing SMS Submit CDR for Content CDR',
                    p_BIH_ID,
                    p_BOH_ID,
                    to_char(cMasterRow.ROWID),
                    cMasterRow.BD_SHORTID
                );  -- 039SO
            end if;
        elsif cMasterRow.BD_TRANSPORTMEDIUM = 'SMS' and cMasterRow.BD_COUNTTR is NULL then
            NULL;   -- cannot index this SMS content (
        elsif cMasterRow.BD_TRANSPORTMEDIUM = 'MMS' then
            for cMmsSubmitRow in cMmsSubmit(cMasterRow) loop
                l_update_count := 0;
                if l_matching_count = 0 then
                    -- must check if orphan entry needs update
                    UPDATE REVI_CONTENT_SUB SET
                        REVICS_ROWID_SLAVE = cMmsSubmitRow.ROWID,
                        REVICS_COUNT_EXPECTED = NVL(cMasterRow.BD_COUNTTR,1)
                    WHERE REVICS_SEPID = l_SepId
                    AND   REVICS_SHORTID = cMasterRow.BD_SHORTID
                    AND   REVICS_TABLE_SLAVE = 'BDETAIL6'
                    AND   REVICS_ROWID_MASTER = cMasterRow.ROWID
                    ;
                    l_update_count := SQL%Rowcount;
                end if;
                if l_update_count = 0 then
                    INSERT INTO REVI_CONTENT_SUB (
                            REVICS_SEPID,
                            REVICS_SHORTID,
                            REVICS_ROWID_MASTER,
                            REVICS_COUNT_EXPECTED,
                            REVICS_TABLE_SLAVE,
                            REVICS_ROWID_SLAVE
                    ) VALUES (
                            l_SepId,
                            cMasterRow.BD_SHORTID,
                            cMasterRow.ROWID,
                            NVL(cMasterRow.BD_COUNTTR,1),
                            'BDETAIL6',
                            cMmsSubmitRow.ROWID
                    );
                end if;
                l_matching_count := l_matching_count + 1;
            end loop;
            if l_matching_count = 0 then
                -- Insert index row for missing transport CDR
                INSERT INTO REVI_CONTENT_SUB (
                    REVICS_SEPID,
                    REVICS_SHORTID,
                    REVICS_ROWID_MASTER,
                    REVICS_COUNT_EXPECTED,
                    REVICS_TABLE_SLAVE,
                    REVICS_ROWID_SLAVE
                    ) VALUES (
                    l_SepId,
                    cMasterRow.BD_SHORTID,
                    cMasterRow.ROWID,
                    NVL(cMasterRow.BD_COUNTTR,1),
                    'BDETAIL6',
                    NULL
                );
                PKG_COMMON.INSERT_WARNING (
                    vMePkg,
                    Me,
                    cMasterRow.BD_DATETIME_STR,
                    'Missing MMS Submit CDR for Content CDR',
                    p_BIH_ID,
                    p_BOH_ID,
                    to_char(cMasterRow.ROWID),
                    cMasterRow.BD_SHORTID
                );  -- 039SO
            end if;
        end if;  -- Search for transport submit

        -- Search for prepaid charging records
        if cMasterRow.BD_PREPAID = 'Y' then -- 028SO (cMasterRow.BD_AMOUNTCU <> 0.00 OR cMasterRow.BD_ONLINECHARGE IS NOT NULL) then
          -- if cMasterRow.BD_ONLINECHARGE IS NOT NULL then  -- 025SO   -- $$$$$$$$$ remove after VASOL migration
            -- can only find charge if online billed (missing RequestID otherwise)
            l_matching_count := 0;
            l_amount_charged := 0.00;
            if cMasterRow.BD_TRANSPORTMEDIUM = 'SMS' then
                for cDssCdrSmsRow in cDssCdrSms(cMasterRow) loop
                    l_update_count := 0;
                    if l_matching_count = 0 then
                        -- must check if orphan entry needs update
                        UPDATE REVI_PRE SET
                            REVIPRE_ROWID_SLAVE = cDssCdrSmsRow.ROWID_PPB,
                            REVIPRE_CHARGED_AMOUNT = cDssCdrSmsRow.CHARGED_AMOUNT
                        WHERE REVIPRE_SEPID = l_SepId
                        AND   REVIPRE_SHORTID = cMasterRow.BD_SHORTID
                        AND   REVIPRE_TABLE_SLAVE = 'CDR' || cMasterRow.BD_TRANSPORTMEDIUM
                        AND   REVIPRE_ROWID_MASTER = cMasterRow.ROWID
                        ;  -- 024SO
                        l_update_count := SQL%Rowcount;
                    end if;
                    if l_update_count = 0 then
                        INSERT INTO REVI_PRE (
                                REVIPRE_SEPID,
                                REVIPRE_SHORTID,
                                REVIPRE_ROWID_MASTER,
                                REVIPRE_TABLE_SLAVE,
                                REVIPRE_ROWID_SLAVE,
                                REVIPRE_CHARGED_AMOUNT
                        ) VALUES (
                                l_SepId,
                                cMasterRow.BD_SHORTID,
                                cMasterRow.ROWID,
                                'CDR' || cMasterRow.BD_TRANSPORTMEDIUM,
                                cDssCdrSmsRow.ROWID_PPB,
                                cDssCdrSmsRow.CHARGED_AMOUNT
                        );  -- 024SO
                    end if;
                    l_matching_count := l_matching_count + 1;
                    l_amount_charged := l_amount_charged + cDssCdrSmsRow.CHARGED_AMOUNT;
                end loop;
            elsif cMasterRow.BD_TRANSPORTMEDIUM = 'MMS' then
                for cDssCdrMmsRow in cDssCdrMms(cMasterRow) loop
                    l_update_count := 0;
                    if l_matching_count = 0 then
                        -- must check if orphan entry needs update
                        UPDATE REVI_PRE SET
                            REVIPRE_ROWID_SLAVE = cDssCdrMmsRow.ROWID_PPB,
                            REVIPRE_CHARGED_AMOUNT = cDssCdrMmsRow.CHARGED_AMOUNT
                        WHERE REVIPRE_SEPID = l_SepId
                        AND   REVIPRE_SHORTID = cMasterRow.BD_SHORTID
                        AND   REVIPRE_TABLE_SLAVE = 'CDR' || cMasterRow.BD_TRANSPORTMEDIUM
                        AND   REVIPRE_ROWID_MASTER = cMasterRow.ROWID
                        ;  -- 024SO
                        l_update_count := SQL%Rowcount;
                    end if;
                    if l_update_count = 0 then
                        INSERT INTO REVI_PRE (
                                REVIPRE_SEPID,
                                REVIPRE_SHORTID,
                                REVIPRE_ROWID_MASTER,
                                REVIPRE_TABLE_SLAVE,
                                REVIPRE_ROWID_SLAVE,
                                REVIPRE_CHARGED_AMOUNT
                        ) VALUES (
                                l_SepId,
                                cMasterRow.BD_SHORTID,
                                cMasterRow.ROWID,
                                'CDR' || cMasterRow.BD_TRANSPORTMEDIUM,
                                cDssCdrMmsRow.ROWID_PPB,
                                cDssCdrMmsRow.CHARGED_AMOUNT
                        );  -- 024SO
                    end if;
                    l_matching_count := l_matching_count + 1;
                    l_amount_charged := l_amount_charged + cDssCdrMmsRow.CHARGED_AMOUNT;
                end loop;
            end if;
            if l_matching_count = 0 then
                -- Insert index row for missing charge record
                INSERT INTO REVI_PRE (
                        REVIPRE_SEPID,
                        REVIPRE_SHORTID,
                        REVIPRE_ROWID_MASTER,
                        REVIPRE_TABLE_SLAVE,
                        REVIPRE_ROWID_SLAVE,
                        REVIPRE_CHARGED_AMOUNT
                ) VALUES (
                        l_SepId,
                        cMasterRow.BD_SHORTID,
                        cMasterRow.ROWID,
                        'CDR' || cMasterRow.BD_TRANSPORTMEDIUM,
                        NULL,
                        NULL
                );
            end if;
            if l_amount_charged < cMasterRow.BD_AMOUNTCU then
                -- underbilling (code opposite to other warnings in this procedure)
                PKG_COMMON.INSERT_WARNING (
                    vMePkg,
                    LOWER(Me),
                    cMasterRow.BD_DATETIME_STR,
                    'Rated amount: ' || to_char(cMasterRow.BD_AMOUNTCU) || ' Online charged: ' || to_char(l_amount_charged) || ' in ' || to_char(l_matching_count) || ' records',
                    p_BIH_ID,
                    p_BOH_ID,
                    to_char(cMasterRow.ROWID),
                    cMasterRow.BD_SHORTID
                );  -- 039SO
            elsif l_amount_charged > cMasterRow.BD_AMOUNTCU then
                -- overbilling (code similar to other warnings in this procedure)
                PKG_COMMON.INSERT_WARNING (
                    vMePkg,
                    Me,
                    cMasterRow.BD_DATETIME_STR,
                    'Rated amount: ' || to_char(cMasterRow.BD_AMOUNTCU) || ' Online charged: ' || to_char(l_amount_charged) || ' in ' || to_char(l_matching_count) || ' records',
                    p_BIH_ID,
                    p_BOH_ID,
                    to_char(cMasterRow.ROWID),
                    cMasterRow.BD_SHORTID
                );  -- 039SO
            end if;
          -- end if;   -- 025SO     -- $$$$$$$$$ remove after VASOL migration
        end if;

    end loop;

/*
EXCEPTION
        when Others then
                l_ErrorCode := SQLCODE;
                l_ErrorMsg := PKG_COMMON.getHardErrorDesc;                      -- 041SO
                PKG_COMMON.INSERT_WARNING (
                    vMePkg,
                    Me,
                    'PLSQL-ERROR',
                    l_ErrorMsg ,
                    p_BIH_ID,
                    p_BOH_ID,
                    NULL,
                    NULL,
                    l_ErrorCode
                );  -- 042SO -- 039SO
    RAISE;
*/
end;



procedure SP_CONS_REVICD (
    p_PAC_ID          In      Varchar2,     -- 'REVICD'
    p_BOH_ID          In      Varchar2,
    RecordsAffected   Out     Number,
    ErrorCode         Out     Number,
    ErrorMsg          Out     Varchar2,
    ReturnStatus      In Out  Number
)
-- find and index SMS and MMS transport delivery CDRs for chargeable content CDRs for last period
is

        Me varchar2(40) := 'REVI_INDEX_CONTENT_DEL';

    CURSOR cMaster(period varchar2) is
    SELECT /*+ NO_INDEX(BDETAIL) */
        ROWID,
        to_char(BD_DATETIME,'yyyymmddhh24miss') BD_DATETIME_STR,
        BD_MSISDN_A,
        BD_MSISDN_B,    -- 043SO
        BD_SHORTID,
        BD_SERVICE,
        BD_TRANSPORTMEDIUM,
        BD_REQUESTID,                                                           -- 033SO -- 026SO
        BD_MSGID,
        BD_COUNTTR
    FROM
        BDETAIL
    WHERE
                BD_SRCTYPE IN ('ISRV')                                              -- 033SO -- 026SO
        AND     BD_MAPSID = 'R'
        AND     BD_DEMO = 0
        AND     BD_BILLED <> cNotBilledBySbs          -- 028SO IN (cBilledBySbs,cZeroChargeIgnore,cIgnoreSubscriber) -- 018SO
        AND     BD_DATETIME >= add_months(trunc(sysdate,'MONTH'),MonthToDo)
        AND     BD_DATETIME < add_months(trunc(sysdate,'MONTH'),MonthToDo + 1)
        -- AND BD_SHORTID not in ('333','888')         -- 014SO -- 013SO   $$$$$$$ to be removed
        -- AND  LENGTH(BD_SERVICE) >= 10                                        -- 008SO
            -- AND      (BD_SERVICE NOT LIKE '%-DEL-%'                                  -- 015SO -- 009SO (to be removed)
            -- OR BD_TRANSPORTMEDIUM <> 'SMS')                                      -- 015SO -- 009SO (to be removed)
        -- AND  BD_DATETIME >= to_date('26.10.2007','dd.mm.yyyy')               -- 004SO
    ;   -- 011SO

    cMasterRow         cMaster%rowtype;


    CURSOR cSmsDelivery(cM cMaster%rowtype) is
    SELECT /*+ INDEX(BDETAIL2 IDX_BD_BILLID2) */
        ROWID
    FROM
        BDETAIL2
    WHERE       BD_MAPSID = 'R'                                                 -- 044SO
        AND     BD_MSISDN_B = cM.BD_MSISDN_B                                    -- 043SO
        AND     BD_CONSOLIDATION = cM.BD_SHORTID
        AND     BD_STATUS = 0
        AND BD_BILLID = cM.BD_REQUESTID
        AND BD_DATETIME >= to_date(cM.BD_DATETIME_STR,'YYYYMMDDHH24MISS') -  1.1/24     -- 045SO
        AND BD_DATETIME <= to_date(cM.BD_DATETIME_STR,'YYYYMMDDHH24MISS') +  rConfig.REVIC_DELAY_SMS_DEL/86400.0    -- 045SO
    ;

    CURSOR cSmsLongDelivery(cM cMaster%rowtype) is
    SELECT /*+ INDEX(BDETAIL2 IDX_BD_BILLID2) */
        ROWID
    FROM
        BDETAIL2
    WHERE       BD_MAPSID = 'R'                                                 -- 044SO
        AND     BD_MSISDN_B = cM.BD_MSISDN_B                                    -- 043SO
        AND     BD_CONSOLIDATION = cM.BD_SHORTID
        AND     BD_STATUS = 0
        AND BD_BILLID = cM.BD_REQUESTID
        AND BD_DATETIME >= to_date(cM.BD_DATETIME_STR,'YYYYMMDDHH24MISS') -  1.1/24    -- 045SO
        AND BD_DATETIME <= to_date(cM.BD_DATETIME_STR,'YYYYMMDDHH24MISS') +  rConfig.REVIC_DELAY_SMS_DEL/86400.0   -- 045SO
    ; -- 040SO

    CURSOR cMmsDelivery(cM cMaster%rowtype) is
    SELECT /*+ INDEX(BDETAIL6 IDX_BD_UMSGGRPID) */
        ROWID
    FROM
        BDETAIL6
    WHERE
                BD_SRCTYPE = 'MMSC'
        AND     BD_DEMO = 0
        AND     BD_MAPSID = 'R'
        AND     BD_MSISDN_B = cM.BD_MSISDN_B                                    -- 043SO
        AND     BD_MSGTYPE = 0
        AND     BD_UMSGGRPID = cM.BD_MSGID
        AND     BD_CDRRECTYPE IN ('MMSRrecord', 'MM4Rrecord')                   -- 005SO
        AND     BD_EVENTDISP = 1
        AND     BD_SHORTID = cM.BD_SHORTID
        AND BD_DATETIME >= to_date(cM.BD_DATETIME_STR,'yyyymmddhh24miss') -  1.1/24
        AND BD_DATETIME < to_date(cM.BD_DATETIME_STR,'yyyymmddhh24miss') + rConfig.REVIC_DELAY_MMS_DEL/86400.0
    ;   -- 011SO

    l_SepId_To_Do             Varchar2(6);    -- 023SO
    l_SepId_To_Store          Varchar2(6);    -- 023SO

    l_matching_count      integer;

        no_bohid exception;

begin

        --Initialize Variables
    RecordsAffected := 0;
    ReturnStatus := 0;

        --Read Config-Table of REVA_CONFIG
        rConfig := pkg_revi.getConfig;

        l_SepId_To_Do := to_char(add_months(trunc(sysdate,'MONTH'),MonthToDo),'YYYYMM');  -- 023SO
        l_SepId_To_Store := to_char(add_months(trunc(sysdate,'MONTH'),MonthToStore),'YYYYMM');  -- 023SO

        EXECUTE IMMEDIATE 'ALTER TABLE REVI_CONTENT_DEL TRUNCATE PARTITION INFO' || l_SepId_To_Store; -- 007SO

    for cMasterRow in cMaster(l_SepId_To_Do) loop
        -- Analyze master CDR
        RecordsAffected := RecordsAffected + 1;
        l_matching_count := 0;
        if cMasterRow.BD_TRANSPORTMEDIUM = 'SMS' and cMasterRow.BD_COUNTTR <= 1 then    -- 028SO
            for cSmsDeliveryRow in cSmsDelivery(cMasterRow) loop
                INSERT INTO REVI_CONTENT_DEL (
                        REVICD_SEPID,
                        REVICD_SHORTID,
                        REVICD_ROWID_MASTER,
                        REVICD_COUNT_EXPECTED,
                        REVICD_TABLE_SLAVE,
                        REVICD_ROWID_SLAVE
                ) VALUES (
                        l_SepId_To_Store,
                        cMasterRow.BD_SHORTID,
                        cMasterRow.ROWID,
                        cMasterRow.BD_COUNTTR,
                        'BDETAIL2',
                        cSmsDeliveryRow.ROWID
                );
                l_matching_count := l_matching_count + 1;
            end loop;
            if l_matching_count = 0 then
                -- Insert index row for missing transport CDR
                INSERT INTO REVI_CONTENT_DEL (
                        REVICD_SEPID,
                        REVICD_SHORTID,
                        REVICD_ROWID_MASTER,
                        REVICD_COUNT_EXPECTED,
                        REVICD_TABLE_SLAVE,
                        REVICD_ROWID_SLAVE
                ) VALUES (
                        l_SepId_To_Store,
                        cMasterRow.BD_SHORTID,
                        cMasterRow.ROWID,
                        cMasterRow.BD_COUNTTR,
                        'BDETAIL2',
                        NULL
                );
            end if;
        elsif cMasterRow.BD_TRANSPORTMEDIUM = 'SMS' and cMasterRow.BD_COUNTTR > 1 then
            for cSmsLongDeliveryRow in cSmsLongDelivery(cMasterRow) loop
                INSERT INTO REVI_CONTENT_DEL (
                        REVICD_SEPID,
                        REVICD_SHORTID,
                        REVICD_ROWID_MASTER,
                        REVICD_COUNT_EXPECTED,
                        REVICD_TABLE_SLAVE,
                        REVICD_ROWID_SLAVE
                ) VALUES (
                        l_SepId_To_Store,
                        cMasterRow.BD_SHORTID,
                        cMasterRow.ROWID,
                        cMasterRow.BD_COUNTTR,
                        'BDETAIL2',
                        cSmsLongDeliveryRow.ROWID
                );
                l_matching_count := l_matching_count + 1;
            end loop;
            if l_matching_count = 0 then
                -- Insert index row for missing transport CDR
                INSERT INTO REVI_CONTENT_DEL (
                        REVICD_SEPID,
                        REVICD_SHORTID,
                        REVICD_ROWID_MASTER,
                        REVICD_COUNT_EXPECTED,
                        REVICD_TABLE_SLAVE,
                        REVICD_ROWID_SLAVE
                ) VALUES (
                        l_SepId_To_Store,
                        cMasterRow.BD_SHORTID,
                        cMasterRow.ROWID,
                        cMasterRow.BD_COUNTTR,
                        'BDETAIL2',
                        NULL
                );
            end if;
        elsif cMasterRow.BD_TRANSPORTMEDIUM = 'SMS' and cMasterRow.BD_COUNTTR is NULL then
            NULL;   -- cannot index this SMS content (
        elsif cMasterRow.BD_TRANSPORTMEDIUM = 'MMS' then
            for cMmsDeliveryRow in cMmsDelivery(cMasterRow) loop
                INSERT INTO REVI_CONTENT_DEL (
                    REVICD_SEPID,
                    REVICD_SHORTID,
                    REVICD_ROWID_MASTER,
                    REVICD_COUNT_EXPECTED,
                    REVICD_TABLE_SLAVE,
                    REVICD_ROWID_SLAVE
                    ) VALUES (
                    l_SepId_To_Store,
                    cMasterRow.BD_SHORTID,
                    cMasterRow.ROWID,
                    NVL(cMasterRow.BD_COUNTTR,1),
                    'BDETAIL6',
                    cMmsDeliveryRow.ROWID
                );
                l_matching_count := l_matching_count + 1;
            end loop;
            if l_matching_count = 0 then
                -- Insert index row for missing transport CDR
                INSERT INTO REVI_CONTENT_DEL (
                    REVICD_SEPID,
                    REVICD_SHORTID,
                    REVICD_ROWID_MASTER,
                    REVICD_COUNT_EXPECTED,
                    REVICD_TABLE_SLAVE,
                    REVICD_ROWID_SLAVE
                    ) VALUES (
                    l_SepId_To_Store,
                    cMasterRow.BD_SHORTID,
                    cMasterRow.ROWID,
                    NVL(cMasterRow.BD_COUNTTR,1),
                    'BDETAIL6',
                    NULL
                );
            end if;
        end if;

    end loop;

    ErrorCode := 0;
    ErrorMsg  := '';
    ReturnStatus := 1;

exception
        when Others then
                rollback;
                ReturnStatus := 0;
                ErrorCode := SQLCODE;
                ErrorMsg  := PKG_COMMON.getHardErrorDesc;                       -- 041SO
                RecordsAffected := 0;
                PKG_COMMON.INSERT_WARNING (
                    vMePkg,
                    Me,
                    'PLSQL-ERROR',
                    ErrorMsg ,
                    p_BOH_ID,
                    NULL,
                    NULL,
                    NULL,
                    ErrorCode
                );  -- 042SO -- 039SO

end  SP_CONS_REVICD;

procedure SP_CONS_REVIS
(
    p_PAC_ID          In      Varchar2,     -- 'REVIS'
    p_BOH_ID          In Out  Varchar2,
    RecordsAffected   Out     Number,
    ErrorCode         Out     Number,
    ErrorMsg          Out     Varchar2,
    ReturnStatus      In Out  Number
)
is

        Me varchar2(40) := 'REVI_INDEX_SMS';

    CURSOR cMaster(period varchar2) is
    SELECT /*+ NO_INDEX(BDETAIL1) */
        ROWID,
        to_char(BD_DATETIME,'yyyymmddhh24miss') BD_DATETIME_STR,
        BD_MSISDN_B,
        BD_CONSOLIDATION,
        BD_BILLID
    FROM
        BDETAIL1
    WHERE       BD_MAPSID = 'R'                                                 -- 044SO
        AND     BD_CONSOLIDATION IS NOT NULL
        AND     BD_TARID IN ('S','P','T')                                       -- 036SO -- 006SO
        AND     BD_NPI_B = '1'                                                  -- 006SO
        AND     BD_PID_B = '0'                                                  -- 006SO
        AND     BD_DATETIME >= add_months(trunc(sysdate,'MONTH'),MonthToDo)
        AND     BD_DATETIME < add_months(trunc(sysdate,'MONTH'),MonthToDo + 1)
        -- AND  BD_BILLID IS NOT NULL                                           -- 015SO -- 010SO (to be removed)
        -- AND BD_CONSOLIDATION not in ('333','888')                            -- 014SO -- 013SO
        -- AND  BD_DATETIME >= to_date('26.10.2007','dd.mm.yyyy')               -- 004SO
    ;   -- 011SO

    cMasterRow         cMaster%rowtype;


    CURSOR cContent(cM cMaster%rowtype) is                                      -- 001SO
    SELECT /*+ INDEX(BDETAIL IDX_BD_REQUESTID) */
        ROWID
    FROM
        BDETAIL
    WHERE
                BD_SRCTYPE IN ('ISRV')                                              -- 033SO -- 026SO will never match, no BILLID
        AND     BD_DEMO = 0
        AND     BD_MAPSID = 'R'
        AND     BD_MSISDN_B = cM.BD_MSISDN_B                                    -- 043SO
        AND     BD_SHORTID = cM.BD_CONSOLIDATION
        AND BD_REQUESTID = cM.BD_BILLID
        AND BD_DATETIME >= to_date(cM.BD_DATETIME_STR,'yyyymmddhh24miss') -  rConfig.REVIC_DELAY_SMS_SUB/86400.0
        AND BD_DATETIME <= to_date(cM.BD_DATETIME_STR,'yyyymmddhh24miss') +  1.1/24
   ;    -- 011SO

    l_SepId_To_Do             Varchar2(6);    -- 023SO
    l_SepId_To_Store          Varchar2(6);    -- 023SO
    l_matching_count      integer;

        no_bohid exception;

begin

        --Initialize Variables
    RecordsAffected := 0;
    ReturnStatus := 0;

        --Read Config-Table of REVA_CONFIG
        rConfig := pkg_revi.getConfig;

        l_SepId_To_Do := to_char(add_months(trunc(sysdate,'MONTH'),MonthToDo),'YYYYMM');  -- 023SO
        l_SepId_To_Store := to_char(add_months(trunc(sysdate,'MONTH'),MonthToStore),'YYYYMM');  -- 023SO

        EXECUTE IMMEDIATE 'ALTER TABLE REVI_SMS TRUNCATE PARTITION INFO' || l_SepId_To_Store; -- 007SO

    for cMasterRow in cMaster(l_SepId_To_Do) loop
        -- Analyze master CDR
        RecordsAffected := RecordsAffected + 1;
        l_matching_count := 0;
        for cContentRow in cContent(cMasterRow) loop
            INSERT INTO REVI_SMS (
                REVIS_SEPID,
                REVIS_SHORTID,
                REVIS_ROWID1,
                REVIS_ROWID
                ) VALUES (
                l_SepId_To_Store,
                cMasterRow.BD_CONSOLIDATION,
                cMasterRow.ROWID,
                cContentRow.ROWID
            );
            l_matching_count := l_matching_count + 1;
        end loop;
        if l_matching_count = 0 then
            -- Insert index row for missing content CDR
            INSERT INTO REVI_SMS (
                REVIS_SEPID,
                REVIS_SHORTID,
                REVIS_ROWID1,
                REVIS_ROWID
                ) VALUES (
                l_SepId_To_Store,
                cMasterRow.BD_CONSOLIDATION,
                cMasterRow.ROWID,
                NULL
            );
        end if;

    end loop;

    ErrorCode := 0;
    ErrorMsg  := '';
    ReturnStatus := 1;
/*
exception
        when Others then
                rollback;
                ReturnStatus := 0;
                ErrorCode := SQLCODE;
                ErrorMsg  := := PKG_COMMON.getHardErrorDesc;                    -- 041SO
                RecordsAffected := 0;
                pkg_bdetail_common.INSERT_WARNING (vMePkg, Me, 'PLSQL-ERROR', ErrorMsg , ErrorCode);
*/
end  SP_CONS_REVIS;

procedure SP_CONS_REVIPRS
(
    p_PAC_ID          In      Varchar2, -- 'REVIPRS'
    p_BOH_ID          In      Varchar2,
    RecordsAffected   Out     Number,
    ErrorCode         Out     Number,
    ErrorMsg          Out     Varchar2,
    ReturnStatus      In Out  Number
)
-- 020SO
-- find and index content CDRs for SMS prepaid charges on DSS for last period
is

        Me varchar2(40) := 'REVI_INDEX_PRE_SMS';

    CURSOR cMaster(period varchar2) is
    SELECT
        ROWID_PPB,
        STARTDATETIME                                      STARTDATETIME,
        SUBSTR(CALLED_NR,3)                                CALLED_NR,
        NVL(SHORT_ID,'800')                                SHORT_ID,            -- 030SO
        SUBSTR(REQUEST_ID,1,INSTR(REQUEST_ID,'_')-1)       REQUEST_ID,
        0.001 * UNIT                                       CHARGED_AMOUNT
    FROM    CDRSMS      -- @DSS
    WHERE   CALLTYPE in (120,20)                                                -- 026SO
        -- AND TRANSPORT_MEDIUM = 'SMS'                                         -- 046SO
        AND STARTDATETIME >= add_months(trunc(sysdate,'MONTH'),MonthToDo)
        AND STARTDATETIME < add_months(trunc(sysdate,'MONTH'),MonthToDo + 1)
    ;   -- 024SO -- 021SO

    cMasterRow         cMaster%rowtype;

    CURSOR cContent(cM cMaster%rowtype) is                                      -- 001SO
    SELECT /*+ INDEX(BDETAIL IDX_BD_REQUESTID) */
        ROWID
    FROM
        BDETAIL
    WHERE
                BD_SRCTYPE in ('ISRV')                                              -- 031SO
        AND     BD_DEMO = 0
        AND     BD_MAPSID = 'R'
        AND     BD_MSISDN_A = cM.CALLED_NR
        AND     BD_SHORTID = cM.SHORT_ID
        AND cM.SHORT_ID <> '800'                                                -- 031SO
        AND BD_REQUESTID = cM.REQUEST_ID
        AND BD_DATETIME >= cM.STARTDATETIME -  1.1/24
        AND BD_DATETIME <= cM.STARTDATETIME +  1.1/24
        ;   -- 033SO

    l_SepId_To_Do             Varchar2(6);    -- 023SO
    l_SepId_To_Store          Varchar2(6);    -- 023SO
    l_matching_count      integer;

        no_bohid exception;

begin

        --Initialize Variables
    RecordsAffected := 0;
    ReturnStatus := 0;

        --Read Config-Table of REVA_CONFIG
        rConfig := pkg_revi.getConfig;

        l_SepId_To_Do := to_char(add_months(trunc(sysdate,'MONTH'),MonthToDo),'YYYYMM');  -- 023SO
        l_SepId_To_Store := to_char(add_months(trunc(sysdate,'MONTH'),MonthToStore),'YYYYMM');  -- 023SO

        EXECUTE IMMEDIATE 'ALTER TABLE REVIPRE_SMS TRUNCATE PARTITION INFO' || l_SepId_To_Store;

    for cMasterRow in cMaster(l_SepId_To_Do) loop
        -- Analyze master CDR
        RecordsAffected := RecordsAffected + 1;
        l_matching_count := 0;
        for cContentRow in cContent(cMasterRow) loop
            INSERT INTO REVIPRE_SMS (
                REVIPRES_SEPID,
                REVIPRES_SHORTID,
                REVIPRES_ROWIDS,
                REVIPRES_ROWID,
                REVIPRES_CHARGED_AMOUNT
                ) VALUES (
                l_SepId_To_Store,
                cMasterRow.SHORT_ID,
                cMasterRow.ROWID_PPB,
                cContentRow.ROWID,
                cMasterRow.CHARGED_AMOUNT
            );  -- 024SO
            l_matching_count := l_matching_count + 1;
        end loop;
        if l_matching_count = 0 then
            -- Insert index row for missing content CDR
             INSERT INTO REVIPRE_SMS (
                REVIPRES_SEPID,
                REVIPRES_SHORTID,
                REVIPRES_ROWIDS,
                REVIPRES_ROWID,
                REVIPRES_CHARGED_AMOUNT
                ) VALUES (
                l_SepId_To_Store,
                cMasterRow.SHORT_ID,
                cMasterRow.ROWID_PPB,
                NULL,
                cMasterRow.CHARGED_AMOUNT
            );  -- 024SO
        end if;

    end loop;

    ErrorCode := 0;
    ErrorMsg  := '';
    ReturnStatus := 1;
/*
exception
        when Others then
                rollback;
                ReturnStatus := 0;
                ErrorCode := SQLCODE;
                ErrorMsg  := := PKG_COMMON.getHardErrorDesc;                    -- 041SO
                RecordsAffected := 0;
                pkg_bdetail_common.INSERT_WARNING (vMePkg, Me, 'PLSQL-ERROR', ErrorMsg , ErrorCode);
*/
end  SP_CONS_REVIPRS;

procedure SP_CONS_REVIPRM
(
    p_PAC_ID          In      Varchar2,     -- 'REVIPRM'
    p_BOH_ID          In      Varchar2,
    RecordsAffected   Out     Number,
    ErrorCode         Out     Number,
    ErrorMsg          Out     Varchar2,
    ReturnStatus      In Out  Number
)
-- 020SO
-- find and index content CDRs for MMS prepaid charges on DSS for last period
is

        Me varchar2(40) := 'REVI_INDEX_PRE_MMS';

    CURSOR cMaster(period varchar2) is
    SELECT
        ROWID_PPB,
        STARTDATETIME                                      STARTDATETIME,
        SUBSTR(CALLED_NR,3)                                CALLED_NR,
        SHORT_ID                                           SHORT_ID,
        SUBSTR(REQUEST_ID,1,INSTR(REQUEST_ID,'_')-1)       REQUEST_ID,
        0.001 * UNIT                                       CHARGED_AMOUNT
    FROM    CDRMMS      -- @DSS
    WHERE   CALLTYPE = 121
        -- AND TRANSPORT_MEDIUM = 'MMS'                                         -- 046SO
        AND STARTDATETIME >= add_months(trunc(sysdate,'MONTH'),MonthToDo)
        AND STARTDATETIME < add_months(trunc(sysdate,'MONTH'),MonthToDo + 1)
    ;   -- 024SO -- 021SO

    cMasterRow         cMaster%rowtype;

    CURSOR cContent(cM cMaster%rowtype) is                                    -- 001SO
    SELECT /*+ INDEX(BDETAIL IDX_BD_REQUESTID) */
        ROWID
    FROM
        BDETAIL
    WHERE
                BD_SRCTYPE = 'ISRV'
        AND     BD_DEMO = 0
        AND     BD_MAPSID = 'R'
        AND     BD_MSISDN_A = cM.CALLED_NR
        AND     BD_SHORTID = cM.SHORT_ID
        AND BD_REQUESTID = cM.REQUEST_ID
        AND BD_DATETIME >= cM.STARTDATETIME -  1.1/24
        AND BD_DATETIME <= cM.STARTDATETIME +  1.1/24
   ;

    l_SepId_To_Do             Varchar2(6);    -- 023SO
    l_SepId_To_Store          Varchar2(6);    -- 023SO
    l_matching_count      integer;

        no_bohid exception;

begin

        --Initialize Variables
    RecordsAffected := 0;
    ReturnStatus := 0;

        --Read Config-Table of REVA_CONFIG
        rConfig := pkg_revi.getConfig;

        l_SepId_To_Do := to_char(add_months(trunc(sysdate,'MONTH'),MonthToDo),'YYYYMM');  -- 023SO
        l_SepId_To_Store := to_char(add_months(trunc(sysdate,'MONTH'),MonthToStore),'YYYYMM');  -- 023SO

        EXECUTE IMMEDIATE 'ALTER TABLE REVIPRE_MMS TRUNCATE PARTITION INFO' || l_SepId_To_Store;

    for cMasterRow in cMaster(l_SepId_To_Do) loop
        -- Analyze master CDR
        RecordsAffected := RecordsAffected + 1;
        l_matching_count := 0;
        for cContentRow in cContent(cMasterRow) loop
            INSERT INTO REVIPRE_MMS (
                REVIPREM_SEPID,
                REVIPREM_SHORTID,
                REVIPREM_ROWIDS,
                REVIPREM_ROWID,
                REVIPREM_CHARGED_AMOUNT
                ) VALUES (
                l_SepId_To_Store,
                cMasterRow.SHORT_ID,
                cMasterRow.ROWID_PPB,
                cContentRow.ROWID,
                cMasterRow.CHARGED_AMOUNT
            );  -- 024SO
            l_matching_count := l_matching_count + 1;
       end loop;
        if l_matching_count = 0 then
            -- Insert index row for missing content CDR
            INSERT INTO REVIPRE_MMS (
                REVIPREM_SEPID,
                REVIPREM_SHORTID,
                REVIPREM_ROWIDS,
                REVIPREM_ROWID,
                REVIPREM_CHARGED_AMOUNT
                ) VALUES (
                l_SepId_To_Store,
                cMasterRow.SHORT_ID,
                cMasterRow.ROWID_PPB,
                NULL,
                cMasterRow.CHARGED_AMOUNT
            );  -- 024SO
        end if;

    end loop;

    ErrorCode := 0;
    ErrorMsg  := '';
    ReturnStatus := 1;
/*
exception
        when Others then
                rollback;
                ReturnStatus := 0;
                ErrorCode := SQLCODE;
                ErrorMsg  := := PKG_COMMON.getHardErrorDesc;                    -- 041SO
                RecordsAffected := 0;
                pkg_bdetail_common.INSERT_WARNING (vMePkg, Me, 'PLSQL-ERROR', ErrorMsg , ErrorCode);
*/
end  SP_CONS_REVIPRM;

procedure REVI_INDEX_SMS_FILE (
    p_BIH_ID          In   Varchar2,
    p_BOH_ID          In   Varchar2
)
is  -- 016SO

        Me varchar2(40) := 'REVI_INDEX_SMS_FILE';

    CURSOR cMaster is
    SELECT /*+ INDEX(BDETAIL1 IDX_BD_BIHID1) */
        ROWID,
        to_char(BD_DATETIME,'yyyymmddhh24miss') BD_DATETIME_STR,
        BD_MSISDN_B,
        BD_CONSOLIDATION,
        BD_BILLID
    FROM
        BDETAIL1
    WHERE       BD_MAPSID = 'R'                                                 -- 044SO
        AND     BD_BIHID = p_BIH_ID
        AND     BD_CONSOLIDATION IS NOT NULL
        AND     BD_TARID IN ('S','P','T')                                       -- 036SO
        AND     BD_DEMO = 0
        AND     BD_NPI_B = '1'
        AND     BD_PID_B = '0'
        AND     BD_DATETIME >= sysdate - 30
        AND     BD_DATETIME < sysdate + 1
    ;   -- 034SO -- 016SO  -- compare to similar conditions in REVI_INDEX_SMS

    cMasterRow         cMaster%rowtype;

    CURSOR cContent(cM cMaster%rowtype) is
    SELECT /*+ INDEX(BDETAIL IDX_BD_REQUESTID) */
        ROWID
    FROM
        BDETAIL
    WHERE
                BD_SRCTYPE in ('ISRV')                                              -- 033SO  -- 026SO OTA will not match, wrong requestID
        AND     BD_DEMO = 0
        AND     BD_MAPSID = 'R'
        AND     BD_MSISDN_B = cM.BD_MSISDN_B                                    -- 043SO
        AND     BD_SHORTID = cM.BD_CONSOLIDATION
        AND BD_REQUESTID = cM.BD_BILLID
        AND BD_DATETIME >= to_date(cM.BD_DATETIME_STR,'yyyymmddhh24miss') -  rConfig.REVIC_DELAY_SMS_SUB/86400.0
        AND BD_DATETIME <= to_date(cM.BD_DATETIME_STR,'yyyymmddhh24miss') +  1.1/24
   ;    -- 016SO  -- compare to similar conditions in REVI_INDEX_SMS

    l_SepId             Varchar2(6);
    l_matching_count      integer;
        l_update_count        integer;
        l_ErrorCode         NUMBER;
        l_ErrorMsg          VARCHAR2(2000);

begin

        rConfig := pkg_revi.getConfig;

    for cMasterRow in cMaster loop
        -- Analyze master CDR
        l_SepId := substr(cMasterRow.BD_DATETIME_STR,1,6);
        l_matching_count := 0;
        for cContentRow in cContent(cMasterRow) loop
            l_update_count := 0;
            if l_matching_count = 0 then
                -- must check if orphan entry needs update
                UPDATE REVI_SMS SET
                    REVIS_ROWID = cContentRow.ROWID
                WHERE REVIS_SEPID = l_SepId
                AND   REVIS_SHORTID = cMasterRow.BD_CONSOLIDATION
                AND   REVIS_ROWID1 = cMasterRow.ROWID
                ;
                l_update_count := SQL%Rowcount;
            end if;
            if l_update_count = 0 then
                INSERT INTO REVI_SMS (
                        REVIS_SEPID,
                        REVIS_SHORTID,
                        REVIS_ROWID1,
                        REVIS_ROWID
                ) VALUES (
                        l_SepId,
                        cMasterRow.BD_CONSOLIDATION,
                        cMasterRow.ROWID,
                        cContentRow.ROWID
                );
            end if;
            l_matching_count := l_matching_count + 1;
        end loop;
        if l_matching_count = 0 then
            -- Insert index row for missing transport CDR
            INSERT INTO REVI_SMS (
                REVIS_SEPID,
                REVIS_SHORTID,
                REVIS_ROWID1,
                REVIS_ROWID
                ) VALUES (
                l_SepId,
                cMasterRow.BD_CONSOLIDATION,
                cMasterRow.ROWID,
                NULL
            );
            if cMasterRow.BD_CONSOLIDATION <> '800' then                                   -- 029SO
                PKG_COMMON.INSERT_WARNING (
                    vMePkg,
                    Me,
                    cMasterRow.BD_DATETIME_STR,
                    'Missing Content CDR for SMS submit',
                    p_BIH_ID,
                    p_BOH_ID,
                    to_char(cMasterRow.ROWID),
                    cMasterRow.BD_CONSOLIDATION
                );  -- 039SO
            end if;
        end if;

    end loop;

EXCEPTION
        when Others then
                l_ErrorCode := SQLCODE;
                l_ErrorMsg := PKG_COMMON.getHardErrorDesc;                      -- 041SO
                PKG_COMMON.INSERT_WARNING (
                    vMePkg,
                    Me,
                    'PLSQL-ERROR',
                    l_ErrorMsg ,
                    p_BIH_ID,
                    p_BOH_ID,
                    NULL,
                    NULL,
                    l_ErrorCode
                );  -- 042SO-- 039SO
    RAISE;
end;



procedure SP_CONS_REVIM (
    p_PAC_ID          In      Varchar2,     -- 'REVIM'
    p_BOH_ID          In      Varchar2,
    RecordsAffected   Out     Number,
    ErrorCode         Out     Number,
    ErrorMsg          Out     Varchar2,
    ReturnStatus      In Out  Number
)
is

        Me varchar2(40) := 'REVI_INDEX_MMS';

    CURSOR cMaster(period varchar2) is
    SELECT /*+ NO_INDEX(BDETAIL6) */
        ROWID,
        to_char(BD_DATETIME,'yyyymmddhh24miss') BD_DATETIME_STR,
        BD_MSISDN_B,
        BD_SHORTID,
        BD_UMSGGRPID
    FROM
        BDETAIL6
    WHERE
                BD_SRCTYPE = 'MMSC'
        AND     BD_DEMO = 0
        AND     BD_MAPSID = 'R'
        AND     BD_MSGTYPE = 0
        AND     BD_CDRRECTYPE = 'MM7Orecord'
        AND BD_TARID IN ('S','P','T')                                           -- 036SO -- 006SO
        AND     BD_EVENTDISP = 2
        AND     BD_DATETIME >= add_months(trunc(sysdate,'MONTH'),MonthToDo)
        AND     BD_DATETIME < add_months(trunc(sysdate,'MONTH'),MonthToDo + 1)
        -- AND BD_SHORTID not in ('333','888')                                  -- 014SO -- 013SO
        -- AND  BD_DATETIME >= to_date('26.10.2007','dd.mm.yyyy')                   -- 004SO
    ;   -- 011SO

    cMasterRow         cMaster%rowtype;


    CURSOR cContent(cM cMaster%rowtype) is                                      -- 001SO
    SELECT /*+ INDEX(BDETAIL IDX_BD_MSGID) */
        ROWID
    FROM
        BDETAIL
    WHERE
                BD_SRCTYPE = 'ISRV'
        AND     BD_DEMO = 0
        AND     BD_MAPSID = 'R'
        AND     BD_MSISDN_B = cM.BD_MSISDN_B                                    -- 043SO
        AND     BD_SHORTID = cM.BD_SHORTID
        AND BD_MSGID = cM.BD_UMSGGRPID
        AND BD_DATETIME >= to_date(cM.BD_DATETIME_STR,'yyyymmddhh24miss') -  rConfig.REVIC_DELAY_MMS_SUB/86400.0
        AND BD_DATETIME <= to_date(cM.BD_DATETIME_STR,'yyyymmddhh24miss') +  1.1/24
   ;    -- 011SO

    l_SepId_To_Do             Varchar2(6);    -- 023SO
    l_SepId_To_Store          Varchar2(6);    -- 023SO
    l_matching_count      integer;

        no_bohid exception;

begin

        --Initialize Variables
    RecordsAffected := 0;
    ReturnStatus := 0;

        --Read Config-Table of REVA_CONFIG
        rConfig := pkg_revi.getConfig;

        l_SepId_To_Do := to_char(add_months(trunc(sysdate,'MONTH'),MonthToDo),'YYYYMM');  -- 023SO
        l_SepId_To_Store := to_char(add_months(trunc(sysdate,'MONTH'),MonthToStore),'YYYYMM');  -- 023SO

        EXECUTE IMMEDIATE 'ALTER TABLE REVI_MMS TRUNCATE PARTITION INFO' || l_SepId_To_Store; -- 007SO

    for cMasterRow in cMaster(l_SepId_To_Do) loop
        -- Analyze master CDR
        RecordsAffected := RecordsAffected + 1;
        l_matching_count := 0;
        for cContentRow in cContent(cMasterRow) loop
            INSERT INTO REVI_MMS (
                REVIM_SEPID,
                REVIM_SHORTID,
                REVIM_ROWID6,
                REVIM_ROWID
                ) VALUES (
                l_SepId_To_Store,
                cMasterRow.BD_SHORTID,
                cMasterRow.ROWID,
                cContentRow.ROWID
            );
            l_matching_count := l_matching_count + 1;
        end loop;
        if l_matching_count = 0 then
            -- Insert index row for missing content CDR
            INSERT INTO REVI_MMS (
                REVIM_SEPID,
                REVIM_SHORTID,
                REVIM_ROWID6,
                REVIM_ROWID
                ) VALUES (
                l_SepId_To_Store,
                cMasterRow.BD_SHORTID,
                cMasterRow.ROWID,
                NULL
            );
        end if;

    end loop;

    ErrorCode := 0;
    ErrorMsg  := '';
    ReturnStatus := 1;
/*
exception
        when Others then
                rollback;
                ReturnStatus := 0;
                ErrorCode := SQLCODE;
                ErrorMsg  := := PKG_COMMON.getHardErrorDesc;                    -- 041SO
                RecordsAffected := 0;
                pkg_bdetail_common.INSERT_WARNING (vMePkg, Me, 'PLSQL-ERROR', ErrorMsg , ErrorCode);
*/
end  SP_CONS_REVIM;

procedure REVI_INDEX_MMS_FILE (
    p_BIH_ID          In   Varchar2,
    p_BOH_ID          In   Varchar2
)
is  -- 016SO

        Me varchar2(40) := 'REVI_INDEX_MMS_FILE';

    CURSOR cMaster is
    SELECT /*+ INDEX(BDETAIL6 IDX_BD_BIHID6) */
        ROWID,
        to_char(BD_DATETIME,'yyyymmddhh24miss') BD_DATETIME_STR,
        BD_MSISDN_B,
        BD_SHORTID,
        BD_UMSGGRPID
    FROM
        BDETAIL6
    WHERE
                BD_SRCTYPE = 'MMSC'
                AND BD_BIHID = p_BIH_ID
        AND     BD_DEMO = 0
        AND     BD_MAPSID = 'R'
        AND     BD_MSGTYPE = 0
        AND     BD_CDRRECTYPE = 'MM7Orecord'
        AND BD_TARID IN ('S','P','T')                                           -- 036SO
        AND     BD_EVENTDISP = 2
        AND     BD_DATETIME >= sysdate - 30
        AND     BD_DATETIME < sysdate + 1
    ;   -- 034SO -- 016SO  -- compare to similar conditions in REVI_INDEX_MMS

    cMasterRow         cMaster%rowtype;

    CURSOR cContent(cM cMaster%rowtype) is
    SELECT /*+ INDEX(BDETAIL IDX_BD_MSGID) */
        ROWID
    FROM
        BDETAIL
    WHERE
                BD_SRCTYPE = 'ISRV'
        AND     BD_DEMO = 0
        AND     BD_MAPSID = 'R'
        AND     BD_MSISDN_B = cM.BD_MSISDN_B        -- 043SO
        AND     BD_SHORTID = cM.BD_SHORTID
        AND BD_MSGID = cM.BD_UMSGGRPID
        AND BD_DATETIME >= to_date(cM.BD_DATETIME_STR,'yyyymmddhh24miss') -  rConfig.REVIC_DELAY_MMS_SUB/86400.0
        AND BD_DATETIME <= to_date(cM.BD_DATETIME_STR,'yyyymmddhh24miss') +  1.1/24
   ;    -- 016SO  -- compare to similar conditions in REVI_INDEX_MMS

    l_SepId             Varchar2(6);
    l_matching_count      integer;
        l_update_count        integer;
        l_ErrorCode         NUMBER;
        l_ErrorMsg          VARCHAR2(2000);

begin

        rConfig := pkg_revi.getConfig;

    for cMasterRow in cMaster loop
        -- Analyze master CDR
        l_SepId := substr(cMasterRow.BD_DATETIME_STR,1,6);
        l_matching_count := 0;
        for cContentRow in cContent(cMasterRow) loop
            l_update_count := 0;
            if l_matching_count = 0 then
                -- must check if orphan entry needs update
                UPDATE REVI_MMS SET
                    REVIM_ROWID = cContentRow.ROWID
                WHERE REVIM_SEPID = l_SepId
                AND   REVIM_SHORTID = cMasterRow.BD_SHORTID
                AND   REVIM_ROWID6 = cMasterRow.ROWID
                ;
                l_update_count := SQL%Rowcount;
            end if;
            if l_update_count = 0 then
                INSERT INTO REVI_MMS (
                        REVIM_SEPID,
                        REVIM_SHORTID,
                        REVIM_ROWID6,
                        REVIM_ROWID
                ) VALUES (
                        l_SepId,
                        cMasterRow.BD_SHORTID,
                        cMasterRow.ROWID,
                        cContentRow.ROWID
                );
            end if;
            l_matching_count := l_matching_count + 1;
        end loop;
        if l_matching_count = 0 then
            -- Insert index row for missing transport CDR
            INSERT INTO REVI_MMS (
                REVIM_SEPID,
                REVIM_SHORTID,
                REVIM_ROWID6,
                REVIM_ROWID
                ) VALUES (
                l_SepId,
                cMasterRow.BD_SHORTID,
                cMasterRow.ROWID,
                NULL
            );
            PKG_COMMON.INSERT_WARNING (
                vMePkg,
                Me,
                cMasterRow.BD_DATETIME_STR,
                'Missing Content CDR for MMS submit',
                p_BIH_ID,
                p_BOH_ID,
                to_char(cMasterRow.ROWID),
                cMasterRow.BD_SHORTID
            );  -- 039SO
        end if;

    end loop;

EXCEPTION
        when Others then
                l_ErrorCode := SQLCODE;
                l_ErrorMsg := PKG_COMMON.getHardErrorDesc;                      -- 041SO
                PKG_COMMON.INSERT_WARNING (
                    vMePkg,
                    Me,
                    'PLSQL-ERROR',
                    l_ErrorMsg ,
                    p_BIH_ID,
                    p_BOH_ID,
                    NULL,
                    NULL,
                    l_ErrorCode
                );  -- 042SO -- 039SO
    RAISE;
end;




procedure REVI_INDEX_FILE (
    p_BIH_ID          In   Varchar2,
    p_BOH_ID          In   Varchar2
)
is  -- 016SO

        Me varchar2(40) := 'REVI_INDEX_FILE';

    CURSOR cBiHeader is
    SELECT
        BIH_ID,
        BIH_SRCTYPE,
        BIH_MAPID,
        BIH_FILENAME,
        BIH_RECCOUNT,
        BIH_ESID
    FROM    BIHEADER
    WHERE   BIH_ID = p_BIH_ID
    ;

    cBiHeaderRow         cBiHeader%rowtype;

begin

        rConfig := pkg_revi.getConfig;

        if rConfig.REVIC_EXEC = 1 then
        for cBiHeaderRow in cBiHeader loop
            if cBiHeaderRow.BIH_RECCOUNT > 0 then
                if cBiHeaderRow.BIH_SRCTYPE = 'ISRV' then
                    REVI_INDEX_CONTENT_FILE (p_BIH_ID, p_BOH_ID);
                elsif cBiHeaderRow.BIH_SRCTYPE in ('SMSC','SMSN') then          -- 044SO
                    REVI_INDEX_SMS_FILE (p_BIH_ID, p_BOH_ID);
                elsif cBiHeaderRow.BIH_SRCTYPE = 'MMSC' then
                    REVI_INDEX_MMS_FILE (p_BIH_ID, p_BOH_ID);
                end if;
            end if;
        end loop;
    end if;

end;


END;
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- PKG_STATS  (Package Body) 
--
CREATE OR REPLACE PACKAGE BODY SBS1_ADMIN.PKG_STATS
IS
---------------------------------------------------------------------------------------------------------------------------------------
-- MODIFICATION HISTORY
-- Person      Date         Comments
-- ---------   ------       -----------------------------------------------------------------------------------------------------------
-- AHAUPENTHAL 31-03-2003   Creation
-- AH          01-04-2003   checkDependencies
-- AH          03-04-2003   cleanJobs, getNextJob
-- AH          03-04-2003   scheduleStats: repeat until...
-- AH          06-04-2003   scheduleStats: anythingToDo??
-- AH          15-04-2003   executer: getNextJob
-- AH          16-04-2003   executer: setJobResult
-- AH          21-04-2003   scheduleStats: repeat until, typ II reports with loop
-- AH          21-04-2003   getNextJob: checkDependencies for all jobs
-- AH          21-04-2003   doAdminCleanJobs
-- AH          22-05-2003   insert into table WARNINGS
-- AH          26-05-2003   getNextJob: collect notification data
-- AH          03-06-2003   scheduleJob: include ExcecutionDelay and job periodid
-- AH          10-06-2003   Schedule Individual Jobs and repeat them; setJobResult -> update Repeat Monkeys
-- AH          13-07-2003   getNextExecDay updated
-- AH          15-07-2003       Transaction read only
-- AH          16-07-2003   getNextDate -> individual
-- AH          17-07-2003       Individuals, getNextExecDate
-- AH          21-07-2003   getNextExecDate
-- AH          07-01-2004   scheduleStats -> Iterator ID for Loopings (SCHNAPPS)
-- AH          08-04-2004   Conditional Execution added to scheduleStats
-- AA          19-03-2004   use Upper() function in cursors cNote and cNoteParam in procedure getNextJob()
-- AH          23-04-2004   RecordCount for TopStopReport (getNextJob)
-- AH          28-04-2004   getNextJob: Extend Array to XPIOC for PDF
-- AH          10-05-2004       getNextJob: Extend Array to XPIOC for ARCHIVE DIR and USER OUTPUT DIR
-- AA          30-06-2004   SP_NEW_STA_JOBSQLS: replace the parameters tokens for ShortId, MsisndnA, MsisdnB
-- AH           05-07-2004  scheduleStats: No lower(vSql) because of CONSTANTS
-- AH           28-07-2004  scheduleStats: bLooped
-- 001AA        18-08-2004  Added procedure for parameter 'SP_REPLACE_PARAMS' replacement
-- 002AH        28-10-2004  scheduleStats: Add individual packing pac_execdelay for STATIND (SBS08.55)
-- 003SO        14-12-2004  Go back to days for parameter pac_execdelay and
-- 004SO        14-12-2004  Consider more than one dependency
-- 005SO        14-12-2004  checkDependenciesWeb removed. Not used any more
-- 006SO        15.12.2004  Simplify query condition in STA_GETNEXTJOB
-- 007SO        15.12.2004  Change rescheduling because of dependencies in STA_GETNEXTJOB
-- 008SO        15.12.2004  Catch exceptions in case of nonexisting BaseTable Info. No BT checking done.
-- 009AA        23.12.2004  Added sp GetJobNotifData to return Job local notification data to Xpioc
-- 010AA        30.12.2004  Added new parameters to SP_NEW_STA_JOB sp (p_StajNotification,p_StajNotId,p_StajNotEmailSuccess,p_StajNotEmailFailure,p_StajNotSendAttachment)
-- 011SO        04.04.2005  Consider locked workflow task as not done when checking dependencies
-- 012SO        13.03.2006  Correct scheduling time for weekly stats reports
-- 013SO        03.05.2007  Consider all packing states of forerunner jobs when checking dependency violations
-- 014SO        01.02.2008  Correct false truncation in scheduler
-- 015SO        02.02.2010  Create MEC_OC Stubs NEW_STA_JOB_xxx and UPDATE_STA_JOB_xxx
-- 016SO        25.03.2010  Remove MEC_OC Stubs NEW_STA_JOB_xxx and UPDATE_STA_JOB_xxx (implemented in PKG_STATS)
-- 017SO        28.03.2010  Implement scheduleIndividualStats as standard CONSOL job
-- 018SO        29.03.2010  Convert scheduleIndividualStats from CONSOL to SPTRY
-- 019SO        29.03.2010  Use new generalized method for inserting a dummy header in SPTRY
-- 020SO        29.03.2010  Correct error handling in scheduleIndividualStats (handle suspend)
-- 021SO        23.04.2010  Also lock working jobs together with locking of a package
-- 022SO        23.04.2010  Unlock job with a trycount reset after re-activating a package.
-- 023SO        18.04.2012  Use PKG_COMMON.INSERT_WARNING


-- GLOBALS

   rConfig            sta_config%rowtype;
   rXproc             xproc%rowtype;

   --Debug mode on => Entries in tabel STA_DEBUG
   bDebug             boolean   := false;
   vDummy             varchar2(100);

   --SysInfo for STA_JOB.STAJ_SYSINFO
   vSysInfo           varchar2(4000);

   --user defined error - raised if we dont have a configurations set with id DEFAULT
   NO_CONFIG_ERROR exception;

-- STATES
   type t_xprEsid is Record (
        active      xproc.xpr_esid%type    := 'A',
        inactive    xproc.xpr_esid%type    := 'I',
        deleted     xproc.xpr_esid%type    := 'D'
   );
   rXprEsid    t_xprEsid;


   --PACKING
   type t_pacEsid is Record (
        draft       packing.pac_esid%type    := 'R',
        active      packing.pac_esid%type    := 'A',
        inactive    packing.pac_esid%type    := 'I',
        scheduled   packing.pac_esid%type    := 'S',
        deleted     packing.pac_esid%type    := 'D',
        locked      packing.pac_esid%type    := 'L'
   );
   rPacEsid    t_pacEsid;

   --JOBS
   type t_stajEsid is Record (
        draft       sta_job.staj_esid%type    := 'R',
        active      sta_job.staj_esid%type    := 'A',
        okay        sta_job.staj_esid%type    := 'O',
        error       sta_job.staj_esid%type    := 'E',
        deleted     sta_job.staj_esid%type    := 'D',
        locked      sta_job.staj_esid%type    := 'L',
        scheduled   sta_job.staj_esid%type    := 'S',
        working     sta_job.staj_esid%type    := 'W'
   );
   rStajEsid    t_stajEsid;
   --Notifications
   type t_noteEsid is Record (
        active      notificationtempl.not_esid%type    := 'A',
        deleted     notificationtempl.not_esid%type    := 'D',
        inactive    notificationtempl.not_esid%type    := 'I'
   );
   rNoteEsid    t_noteEsid;

-- TYPES
   --PACKING
   type t_pacEtid is Record (
        consol    packing.pac_etid%type    := 'CONSOL',
        stat      packing.pac_etid%type    := 'STAT',
        statind   packing.pac_etid%type    := 'STATIND'
   );
   rPacEtid    t_pacEtid;

-- JOBS
   type t_stajEtid is Record (
        system      sta_job.staj_etid%type    := 'SYSTEM',
        user        sta_job.staj_etid%type    := 'USER'
   );
   rStajEtid t_stajEtid;

--JOB TYPES for WEB STUFF
  Type t_stajType Is Record (                          -- Text from STAJT_LANG01
    Xls             STA_JOBOTYPE.STAOT_ID%Type     := 'XLS',
    Pdf             STA_JOBOTYPE.STAOT_ID%Type     := 'PDF'
  );
  rStajType         t_StajType;
-- CALLER --getNextExecDate
   type t_Caller is Record (
        system      varchar2(10)              := 'SYSTEM',
        indiv       varchar2(10)              := 'INDIV',
        scheduler   varchar2(10)              := 'SCHED'
   );
   rCaller t_Caller;
-- NAMES : STA_JOBPARAM
   type t_JobParam is Record (
        datefrom    varchar2(20)              := '[DATEFROM]',
        dateto      varchar2(20)              := '[DATETO]',
        datetill    varchar2(20)              := '[DATETILL]',
        keywords    varchar2(20)              := '[KEYWORDS]',
        acid        varchar2(20)              := '[AC_ID]',
        conid       varchar2(20)              := '[CON_ID]',
        stajid      varchar2(20)              := '[STAJ_ID]',
        conname     varchar2(20)              := '[CON_NAME]',
        shortid     varchar2(20)              := '[SHORT_ID]',
        msisdna     varchar2(20)              := '[MSISDN_A]',
        msisdnb     varchar2(20)              := '[MSISDN_B]'
   );
   rJobParam t_JobParam;

 -- TOKENS : SQL Parameter to replace --scheduleStats
   type t_SqlParam is Record (
        jobid       varchar2(20)              := '<STAJ_ID>',
        conid       varchar2(20)              := '<CON_ID>',
        acid        varchar2(20)              := '<AC_ID>',
        conname     varchar2(20)              := '<CON_NAME>',
        datefrom    varchar2(20)              := '<DATEFROM>',
        dateto      varchar2(20)              := '<DATETO>',
        datetill    varchar2(20)              := '<DATETILL>',
        keyword     varchar2(20)              := '<BD_KEYWORD>',
        pacetid     varchar2(20)              := '<PAC_ETID>',
        filemask    varchar2(20)              := '<PAC_FILEMASK>',
        pactemp     varchar2(20)              := '<PAC_TEMPLATE>',
        outdir      varchar2(20)              := '<PAC_OUTPUTDIR>',
        status      varchar2(20)              := '<PAC_ESID>',
        nextseq     varchar2(20)              := '<PAC_NEXTSEQ>',
        pacid       varchar2(20)              := '<PAC_ID>',
        pacname     varchar2(20)              := '<PAC_NAME>',
        period      varchar2(20)              := '<PERIOD>',
        noofsql     varchar2(20)              := '<NOOFSQL>',
        keywords    varchar2(20)              := '<KEYWORDS>',
        pdfmask     varchar2(20)              := '<PDFMASK>',
        archivedir  varchar2(20)                            := '<ARCHIVEDIR>',
                mover               varchar2(20)                            := '<MOVER>',
        shortid     varchar2(20)              := '<SHORT_ID>',
        msisdna     varchar2(20)              := '<MSISDN_A>',
        msisdnb     varchar2(20)              := '<MSISDN_B>'
   );
   rSqlParam t_SqlParam;

---------------------------------------------------------------------------------------------------------------------------------------
--GLOBAL STUFF ------------------------------------------------------------------------------------------------------------------------

FUNCTION getConfig return sta_config%rowtype
is

vConfig            sta_config%rowtype;
begin
    select * into vConfig
        from sta_config
        where stac_id = 'DEFAULT';
    return vConfig;
exception
     WHEN Others THEN
        writeSysLog('getConfig', SQLCODE, SQLERRM, 'stac_id = DEFAULT', sysdate);
        PKG_COMMON.INSERT_WARNING (
            'PKG_STATS',
            'getConfig',
            'Error ',
            'No configuration (DEFAULT) found. Check STA_CONFIG.'
        );  -- 023SO
        return vConfig;

end; --function getConfig
----------------------------------------------------------------------------------------------------------------------------------------

FUNCTION getXproc (vXprocName xproc.xpr_id%type) return xproc%rowtype
is

vXproc            xproc%rowtype;

begin

    select * into vXproc from xproc where xpr_id=vXprocName;
    return vXproc;

exception
     WHEN Others THEN
        if (rConfig.stac_syslogger=1) then writeSysLog('getXproc', SQLCODE, SQLERRM, null, sysdate); end if;
        return vXproc;
end; --function getXproc

----------------------------------------------------------------------------------------------------------------------------------------
--Author: Anita Haupenthal
--Purpose: Set active Jobs back in case of major user defined error
--Caller: scheduleStats
--Last Update: 21-07-2003
----------------------------------------------------------------------------------------------------------------------------------------
PROCEDURE updateJobOnError(pacid packing.pac_id%type, jobid sta_job.staj_id%type, p_BOH_ID varchar2, reason varchar2)
is

PRAGMA AUTONOMOUS_TRANSACTION;

begin
        if (pacid is not null) then
            update packing set
                pac_esid='I',
                pac_datemod=sysdate,
                pac_chngcnt=pac_chngcnt+1,
                pac_info=substr('updateJobOnError: '||reason||'. Please contact administrator.'||chr(10)||substr(pac_info,1,900),1,999)
            where pac_id=pacid;

        elsif (jobid is not null) then
            update sta_job set
                staj_datetry = sysdate, staj_nooftrials=1,
                staj_esid=rStajEsid.draft, staj_datesta=sysdate,
                staj_sysinfo=substr('Raised Error: '||reason||'. Please contact administrator.'||chr(10)||substr(staj_sysinfo,1,3000),1,3999),
                staj_chngcnt=staj_chngcnt+1,
                staj_bohidexec=p_BOH_ID
            where staj_id=jobid;
        end if;
        commit;

exception
     WHEN Others THEN
        if (rConfig.stac_syslogger=1) then writeSysLog('getXproc', SQLCODE, SQLERRM, null, sysdate); end if;

end; --function updateJobOnError

----------------------------------------------------------------------------------------------------------------------------------------
--Author:       Anita Haupenthal
--LastUpdate:   06.04.2003
--Caller        clsStats (VB)
--Purpose:      checks if there is anything to do; return value <> 0 yep, 0 = no
----------------------------------------------------------------------------------------------------------------------------------------

PROCEDURE anythingToDo
(  p_PACT_ID        IN varchar2,
   p_BOH_ID         IN OUT varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT varchar2
)

is

PRAGMA AUTONOMOUS_TRANSACTION;                  -- $$$$ check necessity

vXprocName xproc.xpr_id%type := ReturnStatus;

nCount number := 0;
nCount1 number := 0;

begin

--Get default configuration settings
rConfig := getConfig;
if (rConfig.stac_id is null) then
    raise NO_CONFIG_ERROR;
end if;

rXproc := getXproc(vXprocName);

--Check if calling XPIOC is valid at all
if (rXproc.xpr_id is null) then
    RecordsAffected := 0;
    ReturnStatus := 0;

    if (rConfig.stac_syslogger=1) then writeSysLog('anythingToDo', 777777, 'Calling XPIOC '||vXprocName||' is unknown. Check table XPROC.', p_PACT_ID, sysdate); end if;
    if (rConfig.stac_logwarning=1) then
        PKG_COMMON.INSERT_WARNING (
            'PKG_STATS',
            'anythingToDo',
            'XPROC',
            'Calling XPIOC '||vXprocName||' is unknown. Check table XPROC.',
            NULL,
            p_BOH_ID
        );  -- 023SO
    end if;


--Check if calling XPIOC is active
elsif (rXproc.xpr_esid = rXprEsid.inactive or rXproc.xpr_esid = rXprEsid.deleted) then
    RecordsAffected := 0;
    ReturnStatus := 0;

    if (rConfig.stac_syslogger=1) then writeSysLog('anythingToDo', 777777, 'Calling XPIOC '||vXprocName||' is not active (Status= '||rXproc.xpr_esid||'). Check table XPROC.', p_PACT_ID, sysdate); end if;
    if (rConfig.stac_logwarning=1) then
        PKG_COMMON.INSERT_WARNING (
            'PKG_STATS',
            'anythingToDo',
            'XPROC',
            'Calling XPIOC '||vXprocName||' is not active (Status= '||rXproc.xpr_esid||'). Check table XPROC.',
            NULL,
            p_BOH_ID
        );  -- 023SO
    end if;

else
    --Check Configuration States STAC_EXECSTAT, STAC_EXECREP and STAC_EXECPROC
    --Check if the main STATISTIC MODULE flag is set to NO/OFF = 0
    if (rConfig.stac_execstat=0) then
        --The Stats Module is deactivated! dont do anything...
        if (rConfig.stac_syslogger=1) then writeSysLog('anythingToDo', 777777, 'The STATS Module is deactivated. Controll the Configuration.', p_PACT_ID, sysdate); end if;
        RecordsAffected := 0;
        ReturnStatus := 0;
    else
        --Initialize variable
        RecordsAffected := 0;
        ReturnStatus := 1;

        --Is the GENERATOR asking for work?
        if (p_PACT_ID = 'STATSCHED') then
            pkg_stats.scheduleStats('ANYTHING', p_BOH_ID, RecordsAffected, ErrorCode, ErrorMsg, vXprocName);
            ReturnStatus:=vXprocName;
        end if;

        if (p_PACT_ID = 'STATEXEC') then
            --Count first the possible scheduled CONSOL-jobs
            --Start read-only session ...
            SET TRANSACTION READ ONLY;          -- $$$$ check necessity

            --Now check, if flag in configuration for executing procedures is on
            if (rConfig.stac_execproc=0) then
                nCount:=0;
            else
                select count(*)
                into nCount
                from sta_job, packing
                where staj_pacid = pac_id
                and pac_esid in (rPacEsid.active, rPacEsid.scheduled)
                and staj_esid = rStajEsid.scheduled
                and pac_etid = rPacEtid.consol
                and sysdate >= staj_dateexe
                and sysdate <= (staj_dateexe+((1/24)*rConfig.stac_execsched))
                and pac_xprocid=vXprocName;
            end if;

            --Count the possible scheduled statistic-jobs STAT, STATIND
            --Now check, if flag in configuration for executing stats is on
            if (rConfig.stac_execrep=0) then
                nCount1:=0;
            else
                select count(*)
                into nCount1
                from sta_job, packing
                where staj_pacid = pac_id
                and pac_esid in (rPacEsid.active, rPacEsid.scheduled)
                and staj_esid = rStajEsid.scheduled
                and pac_etid in (rPacEtid.stat, rPacEtid.statind)
                and sysdate >= staj_dateexe
                and sysdate <= (staj_dateexe+((1/24)*rConfig.stac_execsched))
                and pac_xprocid=vXprocName;
            end if;

            commit; --end read only session calculateOpenJobs       -- $$$$ check necessity
            RecordsAffected := nCount+nCount1;
        end if;
    end if;
end if;

if (RecordsAffected > 0) then
    --fetch BOH_ID key and give it back to caller
    p_BOH_ID:=generateuniquekey('G');

    if (p_PACT_ID='STATEXEC') then
        RecordsAffected := 1;
    end if;

    --insert row into boheader
    insert into boheader (boh_id, boh_demo, boh_fileseq, boh_datetime,
                          boh_filename, boh_filedate,boh_reccount, boh_packid, boh_start,
                          boh_esid)
        values (p_BOH_ID, 0, '0001', sysdate, 'PKG_STATS.anythingToDo', sysdate, RecordsAffected,
        p_PACT_ID, sysdate, 'PAC');
    commit;                             -- $$$$ check necessity
end if;

exception
     WHEN NO_CONFIG_ERROR then
        PKG_COMMON.INSERT_WARNING (
            'PKG_STATS',
            'anythingToDo',
            'Error ',
            'No configuration (DEFAULT) found. Check STA_CONFIG.'
        );  -- 023SO
        RecordsAffected := 0;
        ReturnStatus := 0;

     when no_data_found then

        RecordsAffected := 0;
        ReturnStatus := 0;

        commit; --end Read-Only Transaction         -- $$$$ check necessity

     WHEN Others THEN
        if (rConfig.stac_syslogger=1) then writeSysLog('anythingToDo', SQLCODE, SQLERRM, p_PACT_ID, sysdate); end if;
        if (rConfig.stac_logwarning=1) then
            PKG_COMMON.INSERT_WARNING (
                'PKG_STATS',
                'anythingToDo',
                'Error '||p_PACT_ID, sqlcode||': '||sqlerrm,
                NULL,
                p_BOH_ID
            );  -- 023SO
        end if;

        RecordsAffected := 0;
        ReturnStatus := 0;

        commit; --end Read-Only Transaction         -- $$$$ check necessity

end anythingToDo;

----------------------------------------------------------------------------------------------------------------------------------------
--Anita Haupenthal
--LastUpdate: 14.07.2003

--Called by TRIGGER watchPackageStateChanges
--keep track of package-state and job-state integrity
----------------------------------------------------------------------------------------------------------------------------------------

Procedure watchPackageStateChanges
(  vPacId in packing.pac_id%type,
   vOldPacEsid in packing.pac_esid%type,
   vNewPacEsid in packing.pac_esid%type,
   vOldPacLtid in packing.pac_ltid%type,
   vNewPacLtid in packing.pac_ltid%type
 )

is

nCount number;

vStajLtvalue sta_job.staj_ltvalue%type := 'NO';

Type tJobCursor is ref cursor;
cvCurVarJob tJobCursor;

rJob sta_job%rowtype;

vSelect varchar2(4000);

begin

rConfig := getConfig;
if (rConfig.stac_id is null) then
    raise NO_CONFIG_ERROR;
end if;

if (vOldPacLtid <> vNewPacLtid) then
    vStajLtvalue := null;
end if;

--Lock jobs when
--Inactive (Old: Active, Scheduled)
--Locked (Old: Active, Scheduled)

if ((vNewPacEsid=rPacEsid.inactive and (vOldPacEsid=rPacEsid.active or vOldPacEsid=rPacEsid.scheduled)) or
    (vNewPacEsid=rPacEsid.locked and (vOldPacEsid=rPacEsid.active or vOldPacEsid=rPacEsid.scheduled))
   ) then

    vSelect := 'select * from sta_job where staj_pacid='''||vPacId||''' and staj_esid in ('''||rStajEsid.scheduled||''','''||rStajEsid.active||''','''||rStajEsid.working||''') for update nowait';     -- 021SO
    open cvCurVarJob for vSelect;
    loop
        fetch cvCurVarJob into rJob;
        exit when cvCurVarJob%NOTFOUND;

        update sta_job set
            staj_esid=rStajEsid.locked,
            staj_datesta=sysdate,
            staj_ltvalue=decode(vStajLtvalue, 'NO', staj_ltvalue, vStajLtvalue),
            staj_chngcnt=decode(staj_chngcnt, null, 1, staj_chngcnt+1),
            staj_sysinfo=substr('The state of parent package class was changed. The job cannot be done right now.'||chr(10)||substr(staj_sysinfo,1,3000),1,3999)
        where staj_id=rJob.staj_id;
    end loop;
    close cvCurVarJob;

    nCount := SQL%ROWCOUNT;
end if;

--Unlock jobs when
--Active (Old: Inactive, Locked)
if (vNewPacEsid=rPacEsid.active and (vOldPacEsid=rPacEsid.inactive or vOldPacEsid=rPacEsid.locked)
   ) then

    vSelect := 'select * from sta_job where staj_pacid='''||vPacId||''' and staj_esid in ('''||rStajEsid.locked||''') for update nowait';
    open cvCurVarJob for vSelect;
    loop
        fetch cvCurVarJob into rJob;
        exit when cvCurVarJob%NOTFOUND;

        update sta_job set
            staj_esid=rStajEsid.active,
            staj_datesta=sysdate,
            staj_ltvalue=decode(vStajLtvalue, 'NO', staj_ltvalue, vStajLtvalue),
            staj_chngcnt=decode(staj_chngcnt, null, 1, staj_chngcnt+1),
            STAJ_NOOFTRIALS = 1,                                                -- 022SO
            staj_sysinfo=substr('Unlocked/activated Job ('||to_char(sysdate,'DD.MM.YYYY hh24:mi')||')'||chr(10)||substr(staj_sysinfo,1,3000),1,3999)
        where staj_id=rJob.staj_id;
    end loop;
    close cvCurVarJob;

    nCount := SQL%ROWCOUNT;
end if;

--Delete jobs when
--Draft (Old: working, Scheduled, Locked)
--Deleted (Old: Active, Inactive, Scheduled, Locked, Deleted)

if ((vNewPacEsid=rPacEsid.draft and (vOldPacEsid=rPacEsid.locked)) or
    (vNewPacEsid=rPacEsid.deleted and (vOldPacEsid=rPacEsid.active or vOldPacEsid=rPacEsid.inactive or vOldPacEsid=rPacEsid.scheduled or vOldPacEsid=rPacEsid.locked))
   ) then

    vSelect := 'select * from sta_job where staj_pacid='''||vPacId||''' and staj_esid in ('''||rStajEsid.scheduled||''','''||rStajEsid.active||''','''||rStajEsid.locked||''','''||rStajEsid.working||''') for update nowait';
    open cvCurVarJob for vSelect;
    loop
        fetch cvCurVarJob into rJob;
        exit when cvCurVarJob%NOTFOUND;

            update sta_job set
                staj_esid=rStajEsid.deleted,
                staj_datesta=sysdate,staj_ltvalue=decode(vStajLtvalue, 'NO', staj_ltvalue, vStajLtvalue),
                staj_chngcnt=decode(staj_chngcnt, null, 1, staj_chngcnt+1),
                staj_sysinfo=substr('The state of parent package class was changed. The job cannot be executed anymore. Please define new Job.'||chr(10)||substr(staj_sysinfo,1,3000),1,3999)
            where staj_id=rJob.staj_id;
    end loop;
    close cvCurVarJob;

    nCount := SQL%ROWCOUNT;
end if;

commit;             -- $$$$ check necessity

exception
     WHEN NO_CONFIG_ERROR then
        PKG_COMMON.INSERT_WARNING (
            'PKG_STATS',
            'watchPackageStateChanges',
            'Error',
            'No configuration (DEFAULT) found. Check STA_CONFIG.'
        );  -- 023SO

     when Others then
        commit;         -- $$$$ check necessity
        --Check if one of those dynamic little bastards is still open...
        if (cvCurVarJob%isopen) then
            close cvCurVarJob;
        end if;

        if (bDebug) then pkg_stats_debug.debug('ERROR ',SQLErrM,''); end if;
        if (rConfig.stac_syslogger=1) then writeSysLog('watchPackageStateChanges', SQLCODE, SQLERRM, 'PacId: '||vPacId, sysdate); end if;
        if (rConfig.stac_logwarning=1) then
            PKG_COMMON.INSERT_WARNING (
                'PKG_STATS',
                'watchPackageStateChanges',
                'Error '||vOldPacEsid||'-'||vNewPacEsid||':'||vPacId,
                sqlcode||': '||sqlerrm,
                NULL,
                vPacid
            );  -- 023SO
        end if;

end watchPackageStateChanges;

--------------------------------------------------------------------
-- Author: Anita Haupenthal
--
-- Purpose: Delete old jobs and move their files to separate directory
--          Time of archiving depends on packing.pac_filesaveduration

-- Called: manually by WEB-GUI: Administration -> Button clean Jobs now
-- LastUpdate: 21.04.2003
--------------------------------------------------------------------

Procedure doAdminCleanJobs
(
    p_toDo      in varchar2,
    p_JobId     in out tJob,
    p_JobDir    in out tJob,
    p_JobFile   in out tJob,
    RecordsAffected  out number,
    ErrorCode        out number,
    ErrorMsg         out varchar2,
    ReturnStatus     in out number
)

is

nCount number := 0;
nI  number := 0;

vFinalPath varchar2(2000);

Cursor cJob is
    select
        staj_id,
        staj_datesta,
        stajo_outputdir,
        stajo_filename,
        pac_filesaveduration
    from sta_job, sta_joboutput, packing
    where staj_id = stajo_jobid
    and staj_pacid= pac_id
    and staj_esid = rStajEsid.okay;

cJobRow cJob%rowtype;

begin

--caller is 'getJobs': fetch all jobs which we have to delete and send info back to caller
if (p_toDo = 'getJobs') then
    --Initialize array
    p_JobId.delete;
    p_JobDir.delete;
    p_JobFile.delete;

    for cJobRow in cJob loop
        --if pac_filesaveduration is null --> then dont delete, keep it infinitely
        if (cJobRow.pac_filesaveduration is not null) then
            if (sysdate >= add_months(cJobRow.staj_datesta, cJobRow.pac_filesaveduration)) then
                --time to leave this world...
                nI := nI+1;
                p_JobId(nI) := cJobRow.staj_id;
                p_JobDir(nI) := cJobRow.stajo_outputdir;
                p_JobFile(nI) := vFinalPath;
            end if;
        end if;
    end loop;
    nCount := nI;
end if;

--caller is 'setJobs': update sta_job, set status to deleted
--
if (p_toDo = 'setJobs') then
    for nI IN 1..p_JobId.COUNT loop
        update sta_job set
            staj_esid=rStajEsid.deleted,
            staj_datesta=sysdate,
            staj_chngcnt=decode(staj_chngcnt, null, 1, staj_chngcnt+1),
            staj_sysinfo=substr('Job archive time is over - deleted by doAdminCleanJob.' ||chr(10)||substr(staj_sysinfo,1,3000),1,3999)
        where staj_id=p_JobId(nI);
        nCount:=nCount+1;
    end loop;
end if;

commit;                         -- $$$$ check necessity
RecordsAffected := nCount;
ReturnStatus := 1;

exception
     when Others then
        ErrorCode := SqlCode;
        ErrorMsg  := SqlErrM;
        ReturnStatus := 0;
        RecordsAffected := 0;

        rollback;       -- $$$$ check necessity

        if (bDebug) then pkg_stats_debug.debug('ERROR ',ErrorMsg,''); end if;
        if (rConfig.stac_syslogger=1) then writeSysLog('doAdminCleanJobs', SQLCODE, SQLERRM, '', sysdate); end if;
        if (rConfig.stac_logwarning=1) then
            PKG_COMMON.INSERT_WARNING (
                'PKG_STATS',
                'doAdminCleanJobs',
                'Error',
                sqlcode||': '||sqlerrm
            );  -- 023SO
        end if;

end;


PROCEDURE scheduleIndividualStats(
   p_PAC_ID         IN varchar2,
   p_BOH_ID         IN OUT varchar2,        -- 018SO
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     OUT number
)
is  -- 017SO

    --Schedule the USER STATS (table sta_job)----------------------------
    --INDIVIDUAL STATS Type III


    vPacId      packing.pac_id%type;
    vPacLtid    packing.pac_ltid%type;
    vPacItid        packing.pac_itid%type;

    vLtid       packing.pac_ltid%type;
    vStajpValue sta_jobparam.stajp_name%type;

    vSql    sta_jobsql.stajq_sql%type;
    vQName sta_sqldef.staq_queryname%type;

    dDateExec   date;

    vJobId      sta_job.staj_id%type;
    vNewJobId   sta_job.staj_id%type;
    vPeriod     sta_job.staj_periodid%type;

    dFrom       date;
    dTo         date;
    dToTo       date;
    dTill       date;
    vTill       sta_jobparam.stajp_value%type;

    dNextExecDate date := null;
    nCount  number := 0;
    nSqlDef number := 0;
    dTest date:=null;
    bRepeat boolean := false;
    nSql number;
    vTempString sta_pacparam.stap_name%type;


    Cursor cSqlDef(vPac packing.pac_id%type) is
        select * from sta_sqldef
        where staq_pacid=vPac
    ;
    cSqlRow cSqlDef%rowtype;

    Cursor cPacParam (vPacId packing.pac_id%type) is
        select *
        from sta_pacparam
        where stap_abs=1
        and stap_pacid=vPacId
    ;
    cPacParamRow cPacParam%rowtype;

    Cursor cJob is
        select
            staj_id,
            staj_ltvalue,
            staj_periodid,
            pac_ltid,
            pac_id,
            pac_name,
            pac_periodid,
            pac_datedone,
            pac_esid,
            pac_itid,
            nvl(pac_startday,0) pac_startday,
            nvl(pac_starthour,0) pac_starthour,
            nvl(pac_startminute,0) pac_startminute,
            period_durseq,
            pac_execdelay
        from sta_job, packing, periodicity
        where staj_pacid=pac_id
        and pac_periodid=period_id
        and pac_etid in (rPacEtid.consol, rPacEtid.stat, rPacEtid.statind)
        and pac_etid = 'STATIND'
        and staj_esid = rStajEsid.active
        order by
            period_durseq desc,                 -- $$$$ check ordering
            pac_startday desc,
            pac_starthour desc,
            pac_startminute desc
        ;
    cJobRow   cJob%rowtype;

    --SQL Definitions for individual jobs
    Cursor cJobSql(vJob sta_job.staj_id%type) is
        select * from sta_jobsql
        where stajq_jobid=vJob
        for update of stajq_sql
    ;
    cJobSqlRow cJobSql%rowtype;

    Cursor cPacIt(vItId paciterator.paci_id%type) is
        select paci_sql from paciterator
        where paci_id=vItid
    ;

    --Parameter for "repeat untils..."
    Cursor cParam(vJId sta_job.staj_id%type) is
        select * from sta_jobparam
        where stajp_jobid=vJId
    ;
    cParamRow cParam%rowtype;

    Cursor cStaJobParam(a_StajId sta_job.staj_id%type, a_StajpName sta_jobparam.stajp_name%type) Is
        Select STAJP_VALUE
        From STA_JOBPARAM
        Where STAJP_JOBID = a_StajId
        And   STAJP_NAME = a_StajpName
    ;

    noDateFrom          exception;
    noDateTo            exception;
    noDateToAndUntil    exception;
    noSqlDef            exception;

begin
    --SysInfo
    vSysInfo :='Scheduled on '||to_char(sysdate, 'DD.MM.YYYY HH24:MI:SS');

    --Initialize ReturnValues
    ReturnStatus := 1;
    RecordsAffected := 0;

    --Read configuration
    rConfig := getConfig;
    if (rConfig.stac_id is null) then
        raise NO_CONFIG_ERROR;
    end if;

    dNextExecDate := null;

    for cJobRow in cJob loop
        --initialize variables
        nSqlDef := 0;
        dFrom:=null; dTo:=null; dTill:= null; vTill:=null; vPeriod:=null; bRepeat:=false;

        PKG_COMMON_PACKING.INSERT_BOHEADER_SPTRY(p_PAC_ID, p_BOH_ID);           -- 019SO

        --read cursor variables
        vJobId:=cJobRow.staj_id;
        vPacLtid:= '<'||cJobRow.pac_ltid||'>';
        vLtid:= cJobRow.pac_ltid;
        vPacId := cJobRow.pac_id;

        --read parameter "Date FROM"
        begin
            select to_date(stajp_value, 'DD.MM.YYYY HH24:MI:SS')
            into dFrom
            from sta_jobparam
            where stajp_jobid=vJobId
            and stajp_name=rJobParam.datefrom;

        exception
            when others then
                raise noDateFrom;
        end;

        --try to fetch parameter "Date To"
        begin
            select to_date(stajp_value, 'DD.MM.YYYY HH24:MI:SS')
            into dTo
            from sta_jobparam
            where stajp_jobid=vJobId
            and stajp_name=rJobParam.dateto;

        exception
            when others then
               dTo:=dFrom;
        end;

        --read parameter "Repeat until"
        begin
            select stajp_value
            into vTill
            from sta_jobparam
            where stajp_jobid=vJobId
            and stajp_name=rJobParam.datetill;

            if (substr(vTill,1,10)='01.01.2100') then
                dTill:=null;
            else
                dTill:=to_date(vTill, 'DD.MM.YYYY HH24:MI:SS');
                --check if we still have to repeat this monkey
                if (dTill>=dTo or dTo is null) then
                    bRepeat:=true;
                    --calulate new Date To
                    if (cJobRow.staj_periodid='YEARLY') then
                        dTo:=add_months(dFrom, 12);
                        dToTo:=add_months(dTo, 12);
                    end if;
                    if (cJobRow.staj_periodid='MONTHLY') then
                        dTo:=add_months(dFrom, 1);
                        dToTo:=add_months(dTo, 1);
                    end if;
                    if (cJobRow.staj_periodid='WEEKLY') then
                        dTo:=dFrom+7;
                        dToTo:=dTo+7;
                    end if;
                    if (cJobRow.staj_periodid='DAILY') then
                        dTo:=dFrom+1;
                        dToTo:=dTo+1;
                    end if;
                    if (cJobRow.staj_periodid='HOURLY') then
                        dTo:=dFrom+((1/24)*1);
                        dToTo:=dTo+((1/24)*1);
                    end if;
               end if;
            end if;
        exception
            when others then
                vTill:=null;
                dTill:=null;
        end;

        --if Date To is null AND repeat until is null -> we cant calculate period, therefore raise error
        if (dTo is null and dTill is null) then
            --Set Status of job to draft because of major error
            updateJobOnError(null, cJobRow.staj_id, p_BOH_ID, cJobRow.staj_id||': noDateToAndUntil');
            raise noDateToAndUntil;
        end if;

        if (dTo is not null) then

            --dNextExecDate := getNextExecDate(rCaller.indiv, cJobRow.pac_id, trunc(dTo));
            --Individuals doesnt take care about any definition, no start-day, nothing
            --therefore, the next possible execution day is an hour later...

            dNextExecDate := sysdate;
            if (dTo>=dNextExecDate) then
                dNextExecDate:= dTo + 1/24;
            end if;

        if (sysdate >= (dNextExecDate-((1/24)*nvl(rConfig.stac_schedinadv, 1)))) then

            --If statistic template has an individual execution delay (pac_exec_delay) then take this
            --otherwise the standard from config
            dDateExec:= trunc(dNextExecDate + NVL(cJobRow.pac_execdelay,rConfig.stac_execdelay));   -- 003SO

            if (not bRepeat and dTill is null) then
                --its not a repeat monkey, so just update the original job row
                update sta_job set
                    staj_esid=rStajEsid.scheduled,
                    staj_datesta=sysdate,
                    staj_chngcnt = staj_chngcnt+1,
                    staj_dateexe=dDateExec,
                    staj_bohidsched=p_BOH_ID,
                    staj_nooftrials=0,
                    staj_sysinfo= substr( vSysInfo||chr(10)||substr(staj_sysinfo,1,3000),1,3999)
                where staj_id=cJobRow.staj_id;

                --update the job-sqls: replace the remaining parameters (ltid-value and stajid)
                for cJobSqlRow in cJobSql(vJobId) loop
                    vSql:=cJobSqlRow.stajq_sql;
                    if (cJobRow.staj_ltvalue is null or cJobRow.staj_ltvalue='') then
                        vSql:=replace(vSql, vPacLtid, '');
                    else
                        vSql:=replace(vSql, vPacLtid, ' AND '||vLtid||' = ''' ||cJobRow.staj_ltvalue || '''');
                    end if;
                    vSql:=replace(vSql, ''''||rSqlParam.jobid||'''', ''''||vJobId||'''');
                    --update sta_jobsql table with new sql-definition for this job
                    update sta_jobsql set
                        stajq_sql=vSql
                    where current of cJobSql;
                end loop;
                nCount := nCount+1;
            else
                --REPEAT MONKEY
                --now we have to copy the job-row itself, and update the original job-row
                --first create a new instance, a child of original job
                vNewJobId:=generateuniquekey('G');
                --the CHILD is born...his status set to SCHEDULED
                insert into sta_job(staj_id, staj_pacid, staj_parentid, staj_esid, staj_etid,
                    staj_dateexe, staj_datesta,staj_datecre, staj_chngcnt, staj_bohidsched,
                    staj_nooftrials, staj_sysinfo, staj_ltvalue, staj_periodid)
                values (vNewJobId, cJobRow.pac_id, vJobId, rStajEsid.scheduled,'XLS',
                    dDateExec, sysdate,sysdate, 0, p_BOH_ID,
                    0, 'Child of '||vJobId||'created on '||to_char(sysdate, 'DD.MM.YYYY HH24:MI:SS'),
                    cJobRow.staj_ltvalue, cJobRow.staj_periodid);

                --now copy all parameters
                for cParamRow in cParam(vJobId) loop
                    --Workaround for nice decode function which is here not running
                    --another reason for updating to version 9i:-))
                    if (cParamRow.stajp_name= rJobParam.datefrom) then
                        insert into sta_jobparam(stajp_id, stajp_jobid, stajp_name, stajp_value)
                        values (generateuniquekey('G'), vNewJobId, cParamRow.stajp_name,
                            to_char(dFrom, 'DD.MM.YYYY HH24:MI:SS'));
                    else
                        if (cParamRow.stajp_name= rJobParam.dateto) then
                            insert into sta_jobparam(stajp_id, stajp_jobid, stajp_name, stajp_value)
                            values (generateuniquekey('G'), vNewJobId, cParamRow.stajp_name,
                                to_char(dTo, 'DD.MM.YYYY HH24:MI:SS'));
                        else
                            if (cParamRow.stajp_name= rJobParam.datetill) then
                                insert into sta_jobparam(stajp_id, stajp_jobid, stajp_name, stajp_value)
                                values (generateuniquekey('G'), vNewJobId, cParamRow.stajp_name,
                                    to_char(dTill, 'DD.MM.YYYY HH24:MI:SS'));
                            else
                                insert into sta_jobparam(stajp_id, stajp_jobid, stajp_name, stajp_value)
                                values (generateuniquekey('G'), vNewJobId, cParamRow.stajp_name,
                                    cParamRow.stajp_value);
                            end if;
                        end if;
                    end if;
                end loop;

                --now create all SQL statements
                for cSqlRow in cSqlDef(vPacId) loop
                    nSqlDef := 1;
                    vSql := cSqlRow.staq_sql;
                    vQName := cSqlRow.staq_queryname;
                    --replace the standard parameters staj_id and lt-value
                    if (cJobRow.staj_ltvalue is null or cJobRow.staj_ltvalue='') then
                        vSql:=replace(vSql, vPacLtid, '');
                    else
                        vSql:=replace(vSql, vPacLtid, ' AND '||vLtid||' = ''' ||cJobRow.staj_ltvalue || '''');
                    end if;
                    vSql:=replace(vSql, '''' || rSqlParam.jobid || '''', '''' || vNewJobId || '''');
                    -- 1.Replace DATEFROM job parameter
                    Open cStaJobParam(vJobId, rJobParam.datefrom);
                    Fetch cStaJobParam Into vStajpValue;
                    If (cStaJobParam%Found) Then
                      vSql := Replace(vSql, '''' || rSqlParam.datefrom || '''', 'to_date(''' || vStajpValue || ''',''dd.mm.yyyy hh24:mi:ss'')');
                    Else
                      --Set Status of job to draft because of major error
                      updateJobOnError(null, cJobRow.staj_id, p_BOH_ID, cJobRow.staj_id||': noDateFrom');
                      Raise noDateFrom;
                    End If;
                    Close cStaJobParam;
                    -- 2.Replace DATETO job parameter
                    Open cStaJobParam(vJobId, rJobParam.dateto);
                    Fetch cStaJobParam Into vStajpValue;
                    If (cStaJobParam%Found) Then
                      vSql := Replace(vSql, '''' || rSqlParam.dateto || '''', 'to_date(''' || vStajpValue || ''',''dd.mm.yyyy hh24:mi:ss'')');
                    Else
                      --Set Status of job to draft because of major error
                      updateJobOnError(null, cJobRow.staj_id, p_BOH_ID, cJobRow.staj_id||': noDateTo');
                      Raise noDateTo;
                    End If;
                    Close cStaJobParam;
                    -- 3.Replace DATETILL job parameter
                    Open cStaJobParam(vJobId, rJobParam.dateto);
                    Fetch cStaJobParam Into vStajpValue;
                    If (cStaJobParam%Found) Then
                      vSql := Replace(vSql, '''' || rSqlParam.datetill || '''', 'to_date(''' || vStajpValue || ''',''dd.mm.yyyy hh24:mi:ss'')');
                    Else
                      --Set Status of job to draft because of major error
                      updateJobOnError(null, cJobRow.staj_id, p_BOH_ID, cJobRow.staj_id||': noDateToAndUntil');
                      Raise noDateToAndUntil;
                    End If;
                    Close cStaJobParam;
                    -- 4.Replace KEYWORDS job parameter
                    Open cStaJobParam(vJobId, rJobParam.keywords);
                    Fetch cStaJobParam Into vStajpValue;
                    If (cStaJobParam%Found) Then
                      If (Length(vStajpValue)>0) Then
                        vSql := Replace(vSql, rSqlParam.keywords, ' AND BD_KEYWORD IN (' || vStajpValue || ')');
                      Else
                        vSql := Replace(vSql, rSqlParam.keywords, '');
                      End If;
                    Else
                      vSql := Replace(vSql, rSqlParam.keywords, '');
                    End If;
                    Close cStaJobParam;

                    -- 5.Replace MSISDN A job parameter
                    Open cStaJobParam(vJobId, rJobParam.msisdna);
                    Fetch cStaJobParam Into vStajpValue;
                    If (cStaJobParam%Found) Then
                      If (Length(vStajpValue)>0) Then
                        vStajpValue := Replace (vStajpValue, '*', '%');
                        vStajpValue := Replace (vStajpValue, '?', '_');
                        If (Instr(vStajpValue,'%')>0) Or (Instr(vStajpValue,'_')>0) Then
                            vSql := Replace(vSql, rSqlParam.msisdna, ' AND SENDER LIKE ''' || vStajpValue || '''');
                        Else
                            vSql := Replace(vSql, rSqlParam.msisdna, ' AND SENDER IN (''' || vStajpValue || ''')');
                        End If;
                      Else
                        vSql := Replace(vSql, rSqlParam.msisdna, '');
                      End If;
                    Else
                        vSql := Replace(vSql, rSqlParam.msisdna, '');
                    end if;
                    Close cStaJobParam;

                    -- 6.Replace MSISDN B job parameter
                    Open cStaJobParam(vJobId, rJobParam.msisdnb);
                    Fetch cStaJobParam Into vStajpValue;
                    If (cStaJobParam%Found) Then
                      If (Length(vStajpValue)>0) Then
                        vStajpValue := Replace (vStajpValue, '*', '%');
                        vStajpValue := Replace (vStajpValue, '?', '_');
                        If (Instr(vStajpValue,'%')>0) Or (Instr(vStajpValue,'_')>0) Then
                            vSql := Replace(vSql, rSqlParam.msisdnb, ' AND RECEIVER LIKE ''' || vStajpValue || '''');
                        Else
                            vSql := Replace(vSql, rSqlParam.msisdnb, ' AND RECEIVER IN (''' || vStajpValue || ''')');
                        End If;
                      Else
                        vSql := Replace(vSql, rSqlParam.msisdnb, '');
                      End If;
                    Else
                        vSql := Replace(vSql, rSqlParam.msisdnb, '');
                    end if;
                    Close cStaJobParam;

                    --finally insert the new sql-statement for this child-process into table
                    insert into sta_jobsql (stajq_jobid, stajq_queryname, stajq_sql)
                    values (vNewJobId,vQName , vSql);
                end loop;
                --check if we found a SQL DEFINITION, if not raise error
                if (nSqlDef = 0) then
                    --Set Status of job to draft because of major error
                    updateJobOnError(null, cJobRow.staj_id, p_BOH_ID, cJobRow.staj_id||': noSqlDef');
                    raise noSqlDef;
                end if;

                --finally update the parent, the original job row (preparation for next repeat until)
                --check if this job is the parent row and if we are done
                if (dTill <= dToTo) then
                    --we are done: delete the original job because we dont need it anymore
                    update sta_job set
                        staj_esid=rStajEsid.deleted,
                        staj_datesta=sysdate,
                        staj_chngcnt = staj_chngcnt+1,
                        staj_bohidsched=p_BOH_ID,
                        staj_sysinfo=substr('Parent Row: All children born. Deleted by system on '||to_char(sysdate, 'DD.MM.YYYY hh24:mi:ss')||chr(10)||'Parent of child '||vNewJobId||' scheduled on '||to_char(sysdate, 'DD.MM.YYYY hh24:mi:ss')||chr(10)||substr(staj_sysinfo,1,3000),1,3999)
                    where staj_id=cJobRow.staj_id;
                else
                    update sta_job set
                        staj_esid=rStajEsid.active,
                        staj_datesta=sysdate,
                        staj_chngcnt = staj_chngcnt+1,
                        staj_dateexe=dDateExec,
                        staj_bohidsched=p_BOH_ID,
                        staj_nooftrials=0,
                        staj_sysinfo=substr('Parent of child '||vNewJobId||' scheduled on '||to_char(sysdate, 'DD.MM.YYYY hh24:mi:ss')||chr(10)||substr(staj_sysinfo,1,3000),1,3999)
                    where staj_id=cJobRow.staj_id;

                    update sta_jobparam set
                        stajp_value=to_char(dTo, 'DD.MM.YYYY hh24:mi:ss')
                    where stajp_name=rJobParam.datefrom
                    and stajp_jobid=cJobRow.staj_id;

                    update sta_jobparam set
                        stajp_value=to_char(dToTo, 'DD.MM.YYYY hh24:mi:ss')
                    where stajp_name=rJobParam.dateto
                    and stajp_jobid=cJobRow.staj_id;
                end if;
              end if;
            end if;
        else
            --should never happen, because the Web Interface is verifiying the correct entries of dates
            update sta_job set
                staj_esid=rStajEsid.draft,
                staj_datesta=sysdate,
                staj_chngcnt = staj_chngcnt+1,
                staj_bohidsched=p_BOH_ID,
                staj_nooftrials=0,
                staj_sysinfo= substr( 'Sorry, cannot schedule the job because of missing parameter <DATETO>.'||chr(10)||substr(staj_sysinfo,1,3000),1,3999)
            where staj_id=cJobRow.staj_id;

        end if;
    end loop;

    RecordsAffected := nCount;

    commit;     -- $$$$ check necessity

exception

    when PKG_COMMON.EXCP_INCONVENIENT_TIME then                                 -- 020SO
        ErrorCode := PKG_COMMON.ENO_INCONVENIENT_TIME;
        ErrorMsg := PKG_COMMON.EDESC_INCONVENIENT_TIME;
        ReturnStatus := PKG_COMMON.RETURN_STATUS_SUSPENDED;

    when PKG_COMMON_PACKING.EXCP_STATISTICS_FAILURE then
        ErrorCode := PKG_COMMON_PACKING.ENO_STATISTICS_FAILURE;
        ErrorMsg := PKG_COMMON_PACKING.EDESC_STATISTICS_FAILURE;
        ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;

    when PKG_COMMON_PACKING.EXCP_WORKFLOW_ABORT then
        ErrorCode := PKG_COMMON_PACKING.ENO_WORKFLOW_ABORT;
        ErrorMsg := PKG_COMMON_PACKING.EDESC_WORKFLOW_ABORT;
        ReturnStatus := PKG_COMMON.RETURN_STATUS_FAILURE;

     WHEN NO_CONFIG_ERROR then
        PKG_COMMON.INSERT_WARNING (
            'PKG_STATS',
            'scheduleStats',
            'Error ',
            'No configuration (DEFAULT) found. Check STA_CONFIG.'
        );  -- 023SO
        ReturnStatus := 0;
        RecordsAffected := 0;
        rollback;       -- $$$$ check necessity

     when noDateFrom then
        if (bDebug) then pkg_stats_debug.debug('ERROR ','No parameter Date From for user defined Job '||vJobId||' found.',vJobId); end if;
        if (rConfig.stac_syslogger=1) then writeSysLog('scheduleStats', SQLCODE, SQLERRM|| '(no parameter Date From for user defined Job '||vJobId, '', sysdate); end if;
        if (rConfig.stac_logwarning=1) then
            PKG_COMMON.INSERT_WARNING (
                'PKG_STATS',
                'scheduleStats',
                'Error '||p_BOH_ID,
                'No parameter Date From for user defined Job '||vJobId||' found. Please check table STA_JOB',
                NULL,
                p_BOH_ID
            );  -- 023SO
        end if;
        ReturnStatus := 0;
        RecordsAffected := 0;
        rollback;       -- $$$$ check necessity

     when noDateTo then
        if (bDebug) then pkg_stats_debug.debug('ERROR ','No parameter Date To for user defined Job '||vJobId||' found.',vJobId); end if;
        if (rConfig.stac_syslogger=1) then writeSysLog('scheduleStats', SQLCODE, SQLERRM|| '(no parameter Date From for user defined Job '||vJobId, '', sysdate); end if;
        if (rConfig.stac_logwarning=1) then
            PKG_COMMON.INSERT_WARNING (
                'PKG_STATS',
                'scheduleStats',
                'Error '||p_BOH_ID,
                'No parameter Date From for user defined Job '||vJobId||' found. Please check table STA_JOB',
                NULL,
                p_BOH_ID
            );  -- 023SO
        end if;
        ReturnStatus := 0;
        RecordsAffected := 0;
        rollback;       -- $$$$ check necessity

      when noDateToAndUntil then
        if (bDebug) then pkg_stats_debug.debug('ERROR ','Missing Date To and Date Until for user defined Job '||vJobId||'.',vJobId); end if;
        if (rConfig.stac_syslogger=1) then writeSysLog('scheduleStats', SQLCODE, SQLERRM|| '(Missing Date To and Date Until for user defined Job '||vJobId, '', sysdate); end if;
        if (rConfig.stac_logwarning=1) then
            PKG_COMMON.INSERT_WARNING (
                'PKG_STATS',
                'scheduleStats',
                'Error '||p_BOH_ID,
                'Missing Date To and Date Until for user defined Job '||vJobId||' found. Please check table STA_JOB',
                NULL,
                p_BOH_ID
            );  -- 023SO
        end if;
        ReturnStatus := 0;
        RecordsAffected := 0;
        rollback;       -- $$$$ check necessity

     when noSqlDef then
        if (bDebug) then pkg_stats_debug.debug('ERROR ','No SQL Definitions found for '||vPacLtid,vJobId); end if;
        if (rConfig.stac_syslogger=1) then writeSysLog('scheduleStats', SQLCODE, SQLERRM|| '(no SQL Definition found for '||vPacLtid, '', sysdate); end if;
        if (rConfig.stac_logwarning=1) then
            PKG_COMMON.INSERT_WARNING (
                'PKG_STATS',
                'scheduleStats',
                'Error '||p_BOH_ID,
                'There is no SQL Definition for this packing type. Please check table STA_SQLDEF',
                NULL,
                p_BOH_ID
            );  -- 023SO
        end if;
        ReturnStatus := 0;
        RecordsAffected := 0;
        rollback;       -- $$$$ check necessity

     when Others then
        ErrorCode := SqlCode;
        ErrorMsg  := SqlErrM;
        ReturnStatus := 0;
        RecordsAffected := 0;
        rollback;       -- $$$$ check necessity

        if (bDebug) then pkg_stats_debug.debug('ERROR ',ErrorMsg,''); end if;
        if (rConfig.stac_syslogger=1) then writeSysLog('scheduleStats', SQLCODE, SQLERRM, '', sysdate); end if;
        if (rConfig.stac_logwarning=1) then
            PKG_COMMON.INSERT_WARNING (
                'PKG_STATS',
                'scheduleStats',
                'Error '||p_BOH_ID,
                sqlcode||': '||sqlerrm,
                NULL,
                p_BOH_ID
            );  -- 023SO
        end if;

end scheduleIndividualStats;


--------------------------------------------------------------------
-- Author: Anita Haupenthal
--
-- Purpose: schedule standard periodical stats and consolidation and
--          individual stats

-- Called: by XPIOC: Scheduler

-- LastUpdate: 28.10.2004       Schedule Stats
--------------------------------------------------------------------

PROCEDURE scheduleStats
(  p_PACT_ID        IN varchar2,
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT varchar2
)
is

    vXprocName xproc.xpr_id%type := ReturnStatus;

    vPacId      packing.pac_id%type;
    vPacLtid    packing.pac_ltid%type;
    vPacItid        packing.pac_itid%type;

    vLtid       packing.pac_ltid%type;
    vStajpValue sta_jobparam.stajp_name%type;

    vSql    sta_jobsql.stajq_sql%type;
    vQName sta_sqldef.staq_queryname%type;

    vIterator varchar2(4000) := 'select ''TwoFlowers'' objectID from dual';
    vIteratorValue varchar2(10);

    dDateFrom   date;
    dDateTo     date;
    dDateTill   date := to_date('01.01.2100', 'DD.MM.YYYY');
    dDateExec   date;

    vJobId      sta_job.staj_id%type;
    vNewJobId   sta_job.staj_id%type;
    vPeriod     sta_job.staj_periodid%type;

    dFrom       date;
    dTo         date;
    dToTo       date;
    dTill       date;
    dTemp       date;
    vTill       sta_jobparam.stajp_value%type;
    nExecDelay  packing.pac_execdelay%type;

    dNextExecDate date := null;
    nCount  number := 0;
    nSqlDef number := 0;
    dTest date:=null;

    bRepeat boolean := false;
    bGo boolean := false;
    bLooped boolean := false;

    vGo varchar2(4000);

    nSql number;
    vTempString sta_pacparam.stap_name%type;

--Cursor for iterating throu packing table -> XPIOC
Cursor cPacking (vXproc xproc.xpr_id%type) is
    select
        pac_id,
        pac_ltid,
        pac_name,
        pac_periodid,
        pac_datedone,
        nvl(pac_startday,0) pac_startday,
        nvl(pac_starthour,0) pac_starthour,
        nvl(pac_startminute,0) pac_startminute,
        period_durseq,
        pac_datetry,
        pac_itid,
        pac_etid,
        pac_conditionalexec,
        pac_directoryid,
        pac_execdelay
    from packing, periodicity
    where pac_periodid=period_id
    and pac_esid = rPacEsid.active
    and pac_etid in (rPacEtid.stat, rPacEtid.consol)
    and pac_xprocid = vXproc
    order by
        period_durseq desc,         -- $$$$ check ordering
        pac_startday desc,
        pac_starthour desc,
        pac_startminute desc,
        pac_datetry asc
    ;

    Cursor cSqlDef(vPac packing.pac_id%type) is
        select * from sta_sqldef
        where staq_pacid=vPac;

    cSqlRow cSqlDef%rowtype;

    Cursor cPacParam (vPacId packing.pac_id%type) is
        select *
        from sta_pacparam
        where stap_abs=1
        and stap_pacid=vPacId;

    cPacParamRow cPacParam%rowtype;

    Cursor cJob (vXproc xproc.xpr_id%type) is
        select
            staj_id,
            staj_ltvalue,
            staj_periodid,
            pac_ltid,
            pac_id,
            pac_name,
            pac_periodid,
            pac_datedone,
            pac_esid,
            pac_itid,
            nvl(pac_startday,0) pac_startday,
            nvl(pac_starthour,0) pac_starthour,
            nvl(pac_startminute,0) pac_startminute,
            period_durseq,
            pac_execdelay
        from sta_job, packing, periodicity
        where staj_pacid=pac_id
        and pac_periodid=period_id
        and pac_etid in (rPacEtid.consol, rPacEtid.stat, rPacEtid.statind)
        and pac_xprocid=vXproc
        and staj_esid = rStajEsid.active
        order by
            period_durseq desc,                 -- $$$$ check ordering
            pac_startday desc,
            pac_starthour desc,
            pac_startminute desc
        ;

    cJobRow   cJob%rowtype;

    --SQL Definitions for individual jobs
    Cursor cJobSql(vJob sta_job.staj_id%type) is
        select * from sta_jobsql
        where stajq_jobid=vJob
        for update of stajq_sql;

    cJobSqlRow cJobSql%rowtype;

    Cursor cPacIt(vItId paciterator.paci_id%type) is
        select paci_sql from paciterator
             where paci_id=vItid;


    --Dynamic cursor: to bind run time
    Type tIterator is ref cursor;
    cvIterator tIterator;

    --Parameter for "repeat untils..."
    Cursor cParam(vJId sta_job.staj_id%type) is
        select * from sta_jobparam
        where stajp_jobid=vJId;

    cParamRow cParam%rowtype;

    Cursor cStaJobParam(a_StajId sta_job.staj_id%type, a_StajpName sta_jobparam.stajp_name%type) Is
        Select STAJP_VALUE
        From STA_JOBPARAM
        Where STAJP_JOBID = a_StajId
        And   STAJP_NAME = a_StajpName;

    --Conditional EXEC dynamic cursor
    Type tCurDef is ref cursor;
    cvCurVar tCurDef;

    --user defined exceptions
    noPacIterator exception;
    noDateFrom exception;
    noDateTo exception;
    noDateToAndUntil exception;
    noSqlDef exception;

begin
    --SysInfo
    vSysInfo :='Scheduled on '||to_char(sysdate, 'DD.MM.YYYY HH24:MI:SS');

    --Initialize ReturnValues
    ReturnStatus := 1;
    RecordsAffected := 0;

    --Read configuration
    rConfig := getConfig;
    if (rConfig.stac_id is null) then
        raise NO_CONFIG_ERROR;
    end if;

    --First schedule the SYSTEM STATS and CONSOL (table packing)----------------
    --Loop throu all active, not yet scheduled packings
    for cPackingRow in cPacking(vXprocName) loop

        vPacId := cPackingRow.pac_id;
        nSqlDef := 0;
        bLooped:=false;


        --Conditional Execution: If pac_conditionalexec is not empty,
        -- execute SQL statement: If DATA FOUND = schedule; else Exit
        bGo := true;
        if (cPackingRow.pac_conditionalexec is not null) then
          open cvCurVar for cPackingRow.pac_conditionalexec;
          fetch cvCurVar into vGo;
          bGo := cvCurVar%FOUND;
          close cvCurVar;
        end if;

        if (bGo) then
          --get next possible exec-date depending on periodicity,systime and pac_dateDone
          dNextExecDate := getNextExecDate(rCaller.system, cPackingRow.pac_id, sysdate);

          --Check its time for scheduling...
          if (sysdate >= (dNextExecDate-((1/24)*nvl(rConfig.stac_schedinadv, 1)))) then
              --If procedure is called from anythingToDo just answer with YES, but dont do anything
              if (p_PACT_ID = 'ANYTHING') then
                  nCount:=1;
                  exit;
              end if;

              --Do what we have to do for each job, no regarding what kind of stats he represents...
              --make sure, that we dont schedule the jobs again if somebody changes the packing.pac_esid=active although it was scheduled!
              --staj_dateexe=dNextExecDate);

              delete from sta_jobparam
              where stajp_jobid in (
                select staj_id
                from sta_job
                where staj_pacid=cPackingRow.pac_id
                and staj_esid = rStajEsid.scheduled
              );
              nSql := SQL%ROWCOUNT;

              delete from sta_joboutput
              where stajo_jobid in (
                select staj_id
                from sta_job
                where staj_pacid=cPackingRow.pac_id
                and staj_esid = rStajEsid.scheduled
              );

              nSql := SQL%ROWCOUNT;

              delete from sta_jobsql
              where stajq_jobid in (
                select staj_id
                from sta_job
                where staj_pacid=cPackingRow.pac_id
                and staj_esid = rStajEsid.scheduled
              );
              nSql := SQL%ROWCOUNT;

              delete from sta_job
              where staj_pacid=cPackingRow.pac_id
              and staj_esid = rStajEsid.scheduled;

              nSql := SQL%ROWCOUNT;

              commit;           -- $$$$ check necessity

              --STAT Type II: Fetch iterator condition (select statement from paciterator if looping type not NONE
              vIterator := 'select ''TwoFlowers'' objectID from dual';
              if (cPackingRow.pac_ltid is not null and cPackingRow.pac_ltid<>'NONE') then
                      vPacLtid:=cPackingRow.pac_ltid;
                      vPacItid:=cPackingRow.pac_itid;
                      open cPacIt(vPacItid);
                      fetch cPacIt into vIterator;
                      close cPacIt;
                      if (vIterator=null or vIterator='') then
                          --Set Status of packing to inactive because of major error
                          updateJobOnError(cPackingRow.pac_id, null, p_BOH_ID, cPackingRow.pac_id||': noPacIterator');
                          raise noPacIterator;
                      end if;
                      bLooped:=false;
              end if;

              --Collect the dates, valid for all jobs
              --Define the parameters: here only <DATEFROM> <DATETO>
              if (cPackingRow.pac_periodid='YEARLY') then
                  dDateFrom:= add_months(trunc(dNextExecDate, 'YEAR'),-12);
                  dDateTo:= (trunc(dNextExecDate, 'YEAR'));
              end if;
              if (cPackingRow.pac_periodid='MONTHLY') then
                  dDateFrom:= add_months(trunc(dNextExecDate, 'MONTH'),-1);
                  dDateTo:= trunc(dNextExecDate, 'MONTH');
              end if;
              if (cPackingRow.pac_periodid='WEEKLY') then
                  dDateFrom:=trunc(dNextExecDate)-7;
                  dDateTo:=trunc(dNextExecDate);
              end if;
              if (cPackingRow.pac_periodid='DAILY') then
                  dDateFrom:=trunc(dNextExecDate)-1;
                  dDateTo:=trunc(dNextExecDate);
              end if;
              if (cPackingRow.pac_periodid='HOURLY') then
                  dDateFrom:=dNextExecDate - 1/24;
                  dDateTo:=dNextExecDate;
              end if;

              --Calculate execution date
              --Note: No execution delay for STATS and CONSOL
              if (sysdate>dNextExecDate) then
                dDateExec:=sysdate;                         --Execute immediately
              else
                dDateExec:=dNextExecDate;
              end if;

              if (cPackingRow.pac_etid<>rPacEtid.consol) then
                  vPacLtid:= '<'||cPackingRow.pac_ltid||'>';
                  vLtid:= cPackingRow.pac_ltid;
                  --Replace the parameters within the Iterator Select Statement
                  vIterator:=replace(vIterator, ''''||rSqlParam.datefrom||'''', 'to_date('''||to_char(dDateFrom,'DD.MM.YYYY HH24:MI:SS')||''',''DD.MM.YYYY HH24:MI:SS'')');
                  vIterator:=replace(vIterator, ''''||rSqlParam.dateto||'''', 'to_date('''||to_char(dDateTo,'DD.MM.YYYY HH24:MI:SS')||''',''DD.MM.YYYY HH24:MI:SS'')');
              end if;

                ----Loop for each iterator row!!
                open cvIterator for vIterator;
                loop
                  --loop value, e.g. con_id, ac_id or something equal
                  fetch cvIterator into vIteratorValue;
                  exit when cvIterator%NOTFOUND;

                  vJobId:=generateuniquekey('G');
                  bLooped:=true;
                  --insert the request into job-table
                  insert into sta_job (
                    staj_id,
                    staj_pacid,
                    staj_parentid,
                    staj_esid,
                    staj_etid,
                    staj_dateexe,
                    staj_datesta,
                    staj_datecre,
                    staj_bohidsched,
                    staj_nooftrials,
                    staj_ltvalue,
                    staj_sysinfo,
                    staj_periodid,
                    staj_directoryid
                  ) values (
                    vJobId,
                    cPackingRow.pac_id,
                    0,
                    rStajEsid.scheduled,
                    'XLS',
                    dDateExec,
                    sysdate,
                    sysdate,
                    p_BOH_ID,
                    0,
                    decode(vIteratorValue, 'TwoFlowers', '',vIteratorValue),
                    vSysInfo,
                    cPackingRow.pac_periodid,
                    cPackingRow.pac_directoryid
                  );

                  --insert dates [DATEFROM] and [DATETO]
                  insert into sta_jobparam(stajp_id, stajp_jobid, stajp_name, stajp_value)
                      values (generateuniquekey('G'), vJobId, rJobParam.datefrom, to_char(dDateFrom,'DD.MM.YYYY HH24:MI:SS'));
                  insert into sta_jobparam(stajp_id, stajp_jobid, stajp_name, stajp_value)
                      values (generateuniquekey('G'), vJobId, rJobParam.dateto, to_char(dDateTo,'DD.MM.YYYY HH24:MI:SS'));
                  --Fake the param [DATETILL]
                  insert into sta_jobparam(stajp_id, stajp_jobid, stajp_name, stajp_value)
                      values (generateuniquekey('G'), vJobId, rJobParam.datetill, to_char(dDateTill,'DD.MM.YYYY HH24:MI:SS'));
                  --Insert individual absolute job paramaters
                  for cPacParamRow in cPacParam(cPackingRow.pac_id) loop
                      insert into sta_jobparam(stajp_id, stajp_jobid, stajp_name, stajp_value)
                         values (generateuniquekey('G'), vJobId, cPacParamRow.stap_name, cPacParamRow.stap_value);
                  end loop;

                  if (cPackingRow.pac_etid<>rPacEtid.consol) then

                      --Replace the parameters within the SQL statements
                      for cSqlRow in cSqlDef(vPacId) loop
                          nSqlDef := 1;

                          vSql:=replace(cSqlRow.staq_sql, ''''||vPacLtid||'''', ''''||vIteratorValue||'''');
                          vSql:=replace(vSql, ''''||rSqlParam.jobid||'''', ''''||vJobId||'''');

                          --Check and replace absolute values in PacParam
                          -- 1.Replace DATEFROM job parameter
                          Open cStaJobParam(vJobId, rJobParam.datefrom);
                          Fetch cStaJobParam Into vStajpValue;
                          If (cStaJobParam%Found) Then
                            vSql := Replace(vSql, '''' || rSqlParam.datefrom || '''', 'to_date(''' || vStajpValue || ''',''dd.mm.yyyy hh24:mi:ss'')');
                          Else
                            --Set Status of packing to inactive because of major error
                            updateJobOnError(cPackingRow.pac_id, null, p_BOH_ID, cPackingRow.pac_id||': noDateFrom');
                            Raise noDateFrom;
                          End If;
                          Close cStaJobParam;
                          -- 2.Replace DATETO job parameter
                          Open cStaJobParam(vJobId, rJobParam.dateto);
                          Fetch cStaJobParam Into vStajpValue;
                          If (cStaJobParam%Found) Then
                            vSql := Replace(vSql, '''' || rSqlParam.dateto || '''', 'to_date(''' || vStajpValue || ''',''dd.mm.yyyy hh24:mi:ss'')');
                          Else
                            --Set Status of packing to inactive because of major error
                            updateJobOnError(cPackingRow.pac_id, null, p_BOH_ID, cPackingRow.pac_id||': noDateTo');
                            Raise noDateTo;
                          End If;
                          Close cStaJobParam;
                          -- 3.Replace DATETILL job parameter
                          Open cStaJobParam(vJobId, rJobParam.datetill);
                          Fetch cStaJobParam Into vStajpValue;
                          If (cStaJobParam%Found) Then
                            vSql := Replace(vSql, '''' || rSqlParam.datetill || '''', 'to_date(''' || vStajpValue || ''',''dd.mm.yyyy hh24:mi:ss'')');
                          Else
                            --Set Status of packing to inactive because of major error
                            updateJobOnError(cPackingRow.pac_id, null, p_BOH_ID, cPackingRow.pac_id||': noDateToAndUntil');
                            Raise noDateToAndUntil;
                          End If;
                          Close cStaJobParam;
                          -- 4.Replace KEYWORDS job parameter
                          Open cStaJobParam(vJobId, rJobParam.keywords);
                          Fetch cStaJobParam Into vStajpValue;
                          If (cStaJobParam%Found) Then
                            If (Length(vStajpValue)>0) Then
                              vSql := Replace(vSql, rSqlParam.keywords, ' AND BD_KEYWORD IN (' || vStajpValue || ')');
                            Else
                              vSql := Replace(vSql, rSqlParam.keywords, '');
                            End If;
                          Else
                            vSql := Replace(vSql, rSqlParam.keywords, '');
                          End If;
                          Close cStaJobParam;
                          -- 5.Replace other individual pacparams which are not mandatory like e.g. pmnid of sr022a

                          for cPacParamRow in cPacParam(cPackingRow.pac_id) loop
                              vTempString := '';
                              vTempString := '<'||vTempString||substr(cPacParamRow.stap_name, 2, (length(cPacParamRow.stap_name)-2))||'>';
                              --vSql := Replace(upper(vSql), upper(vTempString), cPacParamRow.stap_value);
                              vSql := Replace(vSql, vTempString, cPacParamRow.stap_value);
                          end loop;

                          insert into sta_jobsql (stajq_jobid, stajq_queryname, stajq_sql)
                          values (vJobId, cSqlRow.staq_queryname, vSql);
                      end loop;

                      --check if we found a SQL Definition; if nSqlDef=0 -> we didnt; raise error!
                      if (nSqlDef = 0) then
                          --Set Status of packing to inactive because of major error
                          updateJobOnError(cPackingRow.pac_id, null, p_BOH_ID, cPackingRow.pac_id||': noSqlDef');
                          raise noSqlDef;
                      end if;
                  end if;
                  nCount := nCount+1;
                end loop;   ---end loop for each iterator row!!!
                close cvIterator;

                if (bLooped) then
                    update packing set
                        pac_esid=rPacEsid.scheduled,
                        pac_datesta=sysdate
                    where pac_id=cPackingRow.pac_id;
                else
                    update packing set
                        pac_esid=rPacEsid.active,
                        pac_datesta=sysdate,
                        pac_datedone=sysdate
                    where pac_id=cPackingRow.pac_id;
                end if;
          end if; --end if packing.dateDone is null
      end if; --bGo
    end loop;

    --Second schedule the USER STATS (table sta_job)----------------------------
    --INDIVIDUAL STATS Type III

    dNextExecDate := null;

    for cJobRow in cJob(vXprocName) loop
        --initialize variables
        nSqlDef := 0;
        dFrom:=null; dTo:=null; dTill:= null; vTill:=null; vPeriod:=null; bRepeat:=false;

        --read cursor variables
        vJobId:=cJobRow.staj_id;
        vPacLtid:= '<'||cJobRow.pac_ltid||'>';
        vLtid:= cJobRow.pac_ltid;
        vPacId := cJobRow.pac_id;

        --read parameter "Date FROM"
        begin
            select to_date(stajp_value, 'DD.MM.YYYY HH24:MI:SS')
            into dFrom
            from sta_jobparam
            where stajp_jobid=vJobId
            and stajp_name=rJobParam.datefrom;

        exception
            when others then
                raise noDateFrom;
        end;

        --try to fetch parameter "Date To"
        begin
            select to_date(stajp_value, 'DD.MM.YYYY HH24:MI:SS')
            into dTo
            from sta_jobparam
            where stajp_jobid=vJobId
            and stajp_name=rJobParam.dateto;

        exception
            when others then
               dTo:=dFrom;
        end;

        --read parameter "Repeat until"
        begin
            select stajp_value
            into vTill
            from sta_jobparam
            where stajp_jobid=vJobId
            and stajp_name=rJobParam.datetill;

            if (substr(vTill,1,10)='01.01.2100') then
                dTill:=null;
            else
                dTill:=to_date(vTill, 'DD.MM.YYYY HH24:MI:SS');
                --check if we still have to repeat this monkey
                if (dTill>=dTo or dTo is null) then
                    bRepeat:=true;
                    --calulate new Date To
                    if (cJobRow.staj_periodid='YEARLY') then
                        dTo:=add_months(dFrom, 12);
                        dToTo:=add_months(dTo, 12);
                    end if;
                    if (cJobRow.staj_periodid='MONTHLY') then
                        dTo:=add_months(dFrom, 1);
                        dToTo:=add_months(dTo, 1);
                    end if;
                    if (cJobRow.staj_periodid='WEEKLY') then
                        dTo:=dFrom+7;
                        dToTo:=dTo+7;
                    end if;
                    if (cJobRow.staj_periodid='DAILY') then
                        dTo:=dFrom+1;
                        dToTo:=dTo+1;
                    end if;
                    if (cJobRow.staj_periodid='HOURLY') then
                        dTo:=dFrom+((1/24)*1);
                        dToTo:=dTo+((1/24)*1);
                    end if;
               end if;
            end if;
        exception
            when others then
                vTill:=null;
                dTill:=null;
        end;

        --if Date To is null AND repeat until is null -> we cant calculate period, therefore raise error
        if (dTo is null and dTill is null) then
            --Set Status of job to draft because of major error
            updateJobOnError(null, cJobRow.staj_id, p_BOH_ID, cJobRow.staj_id||': noDateToAndUntil');
            raise noDateToAndUntil;
        end if;

        if (dTo is not null) then

            --dNextExecDate := getNextExecDate(rCaller.indiv, cJobRow.pac_id, trunc(dTo));
            --Individuals doesnt take care about any definition, no start-day, nothing
            --therefore, the next possible execution day is an hour later...

            dNextExecDate := sysdate;
            if (dTo>=dNextExecDate) then
                dNextExecDate:= dTo + 1/24;
            end if;

        if (sysdate >= (dNextExecDate-((1/24)*nvl(rConfig.stac_schedinadv, 1)))) then
            --If procedure is called from anythingToDo (XPIOC) just answer with YES, but dont do anything
            if (p_PACT_ID = 'ANYTHING') then
                nCount:=1;
                exit;
            end if;

            --If statistic template has an individual execution delay (pac_exec_delay) then take this
            --otherwise the standard from config
            dDateExec:= trunc(dNextExecDate + NVL(cJobRow.pac_execdelay,rConfig.stac_execdelay));   -- 003SO

            if (not bRepeat and dTill is null) then
                --its not a repeat monkey, so just update the original job row
                update sta_job set
                    staj_esid=rStajEsid.scheduled,
                    staj_datesta=sysdate,
                    staj_chngcnt = staj_chngcnt+1,
                    staj_dateexe=dDateExec,
                    staj_bohidsched=p_BOH_ID,
                    staj_nooftrials=0,
                    staj_sysinfo= substr( vSysInfo||chr(10)||substr(staj_sysinfo,1,3000),1,3999)
                where staj_id=cJobRow.staj_id;

                --update the job-sqls: replace the remaining parameters (ltid-value and stajid)
                for cJobSqlRow in cJobSql(vJobId) loop
                    vSql:=cJobSqlRow.stajq_sql;
                    if (cJobRow.staj_ltvalue is null or cJobRow.staj_ltvalue='') then
                        vSql:=replace(vSql, vPacLtid, '');
                    else
                        vSql:=replace(vSql, vPacLtid, ' AND '||vLtid||' = ''' ||cJobRow.staj_ltvalue || '''');
                    end if;
                    vSql:=replace(vSql, ''''||rSqlParam.jobid||'''', ''''||vJobId||'''');
                    --update sta_jobsql table with new sql-definition for this job
                    update sta_jobsql set
                        stajq_sql=vSql
                    where current of cJobSql;
                end loop;
                nCount := nCount+1;
            else
                --REPEAT MONKEY
                --now we have to copy the job-row itself, and update the original job-row
                --first create a new instance, a child of original job
                vNewJobId:=generateuniquekey('G');
                --the CHILD is born...his status set to SCHEDULED
                insert into sta_job(staj_id, staj_pacid, staj_parentid, staj_esid, staj_etid,
                    staj_dateexe, staj_datesta,staj_datecre, staj_chngcnt, staj_bohidsched,
                    staj_nooftrials, staj_sysinfo, staj_ltvalue, staj_periodid)
                values (vNewJobId, cJobRow.pac_id, vJobId, rStajEsid.scheduled,'XLS',
                    dDateExec, sysdate,sysdate, 0, p_BOH_ID,
                    0, 'Child of '||vJobId||'created on '||to_char(sysdate, 'DD.MM.YYYY HH24:MI:SS'),
                    cJobRow.staj_ltvalue, cJobRow.staj_periodid);

                --now copy all parameters
                for cParamRow in cParam(vJobId) loop
                    --Workaround for nice decode function which is here not running
                    --another reason for updating to version 9i:-))
                    if (cParamRow.stajp_name= rJobParam.datefrom) then
                        insert into sta_jobparam(stajp_id, stajp_jobid, stajp_name, stajp_value)
                        values (generateuniquekey('G'), vNewJobId, cParamRow.stajp_name,
                            to_char(dFrom, 'DD.MM.YYYY HH24:MI:SS'));
                    else
                        if (cParamRow.stajp_name= rJobParam.dateto) then
                            insert into sta_jobparam(stajp_id, stajp_jobid, stajp_name, stajp_value)
                            values (generateuniquekey('G'), vNewJobId, cParamRow.stajp_name,
                                to_char(dTo, 'DD.MM.YYYY HH24:MI:SS'));
                        else
                            if (cParamRow.stajp_name= rJobParam.datetill) then
                                insert into sta_jobparam(stajp_id, stajp_jobid, stajp_name, stajp_value)
                                values (generateuniquekey('G'), vNewJobId, cParamRow.stajp_name,
                                    to_char(dTill, 'DD.MM.YYYY HH24:MI:SS'));
                            else
                                insert into sta_jobparam(stajp_id, stajp_jobid, stajp_name, stajp_value)
                                values (generateuniquekey('G'), vNewJobId, cParamRow.stajp_name,
                                    cParamRow.stajp_value);
                            end if;
                        end if;
                    end if;
                end loop;

                --now create all SQL statements
                for cSqlRow in cSqlDef(vPacId) loop
                    nSqlDef := 1;
                    vSql := cSqlRow.staq_sql;
                    vQName := cSqlRow.staq_queryname;
                    --replace the standard parameters staj_id and lt-value
                    if (cJobRow.staj_ltvalue is null or cJobRow.staj_ltvalue='') then
                        vSql:=replace(vSql, vPacLtid, '');
                    else
                        vSql:=replace(vSql, vPacLtid, ' AND '||vLtid||' = ''' ||cJobRow.staj_ltvalue || '''');
                    end if;
                    vSql:=replace(vSql, '''' || rSqlParam.jobid || '''', '''' || vNewJobId || '''');
                    -- 1.Replace DATEFROM job parameter
                    Open cStaJobParam(vJobId, rJobParam.datefrom);
                    Fetch cStaJobParam Into vStajpValue;
                    If (cStaJobParam%Found) Then
                      vSql := Replace(vSql, '''' || rSqlParam.datefrom || '''', 'to_date(''' || vStajpValue || ''',''dd.mm.yyyy hh24:mi:ss'')');
                    Else
                      --Set Status of job to draft because of major error
                      updateJobOnError(null, cJobRow.staj_id, p_BOH_ID, cJobRow.staj_id||': noDateFrom');
                      Raise noDateFrom;
                    End If;
                    Close cStaJobParam;
                    -- 2.Replace DATETO job parameter
                    Open cStaJobParam(vJobId, rJobParam.dateto);
                    Fetch cStaJobParam Into vStajpValue;
                    If (cStaJobParam%Found) Then
                      vSql := Replace(vSql, '''' || rSqlParam.dateto || '''', 'to_date(''' || vStajpValue || ''',''dd.mm.yyyy hh24:mi:ss'')');
                    Else
                      --Set Status of job to draft because of major error
                      updateJobOnError(null, cJobRow.staj_id, p_BOH_ID, cJobRow.staj_id||': noDateTo');
                      Raise noDateTo;
                    End If;
                    Close cStaJobParam;
                    -- 3.Replace DATETILL job parameter
                    Open cStaJobParam(vJobId, rJobParam.dateto);
                    Fetch cStaJobParam Into vStajpValue;
                    If (cStaJobParam%Found) Then
                      vSql := Replace(vSql, '''' || rSqlParam.datetill || '''', 'to_date(''' || vStajpValue || ''',''dd.mm.yyyy hh24:mi:ss'')');
                    Else
                      --Set Status of job to draft because of major error
                      updateJobOnError(null, cJobRow.staj_id, p_BOH_ID, cJobRow.staj_id||': noDateToAndUntil');
                      Raise noDateToAndUntil;
                    End If;
                    Close cStaJobParam;
                    -- 4.Replace KEYWORDS job parameter
                    Open cStaJobParam(vJobId, rJobParam.keywords);
                    Fetch cStaJobParam Into vStajpValue;
                    If (cStaJobParam%Found) Then
                      If (Length(vStajpValue)>0) Then
                        vSql := Replace(vSql, rSqlParam.keywords, ' AND BD_KEYWORD IN (' || vStajpValue || ')');
                      Else
                        vSql := Replace(vSql, rSqlParam.keywords, '');
                      End If;
                    Else
                      vSql := Replace(vSql, rSqlParam.keywords, '');
                    End If;
                    Close cStaJobParam;

                    -- 5.Replace MSISDN A job parameter
                    Open cStaJobParam(vJobId, rJobParam.msisdna);
                    Fetch cStaJobParam Into vStajpValue;
                    If (cStaJobParam%Found) Then
                      If (Length(vStajpValue)>0) Then
                        vStajpValue := Replace (vStajpValue, '*', '%');
                        vStajpValue := Replace (vStajpValue, '?', '_');
                        If (Instr(vStajpValue,'%')>0) Or (Instr(vStajpValue,'_')>0) Then
                            vSql := Replace(vSql, rSqlParam.msisdna, ' AND SENDER LIKE ''' || vStajpValue || '''');
                        Else
                            vSql := Replace(vSql, rSqlParam.msisdna, ' AND SENDER IN (''' || vStajpValue || ''')');
                        End If;
                      Else
                        vSql := Replace(vSql, rSqlParam.msisdna, '');
                      End If;
                    Else
                        vSql := Replace(vSql, rSqlParam.msisdna, '');
                    end if;
                    Close cStaJobParam;

                    -- 6.Replace MSISDN B job parameter
                    Open cStaJobParam(vJobId, rJobParam.msisdnb);
                    Fetch cStaJobParam Into vStajpValue;
                    If (cStaJobParam%Found) Then
                      If (Length(vStajpValue)>0) Then
                        vStajpValue := Replace (vStajpValue, '*', '%');
                        vStajpValue := Replace (vStajpValue, '?', '_');
                        If (Instr(vStajpValue,'%')>0) Or (Instr(vStajpValue,'_')>0) Then
                            vSql := Replace(vSql, rSqlParam.msisdnb, ' AND RECEIVER LIKE ''' || vStajpValue || '''');
                        Else
                            vSql := Replace(vSql, rSqlParam.msisdnb, ' AND RECEIVER IN (''' || vStajpValue || ''')');
                        End If;
                      Else
                        vSql := Replace(vSql, rSqlParam.msisdnb, '');
                      End If;
                    Else
                        vSql := Replace(vSql, rSqlParam.msisdnb, '');
                    end if;
                    Close cStaJobParam;

                    --finally insert the new sql-statement for this child-process into table
                    insert into sta_jobsql (stajq_jobid, stajq_queryname, stajq_sql)
                    values (vNewJobId,vQName , vSql);
                end loop;
                --check if we found a SQL DEFINITION, if not raise error
                if (nSqlDef = 0) then
                    --Set Status of job to draft because of major error
                    updateJobOnError(null, cJobRow.staj_id, p_BOH_ID, cJobRow.staj_id||': noSqlDef');
                    raise noSqlDef;
                end if;

                --finally update the parent, the original job row (preparation for next repeat until)
                --check if this job is the parent row and if we are done
                if (dTill <= dToTo) then
                    --we are done: delete the original job because we dont need it anymore
                    update sta_job set
                        staj_esid=rStajEsid.deleted,
                        staj_datesta=sysdate,
                        staj_chngcnt = staj_chngcnt+1,
                        staj_bohidsched=p_BOH_ID,
                        staj_sysinfo=substr('Parent Row: All children born. Deleted by system on '||to_char(sysdate, 'DD.MM.YYYY hh24:mi:ss')||chr(10)||'Parent of child '||vNewJobId||' scheduled on '||to_char(sysdate, 'DD.MM.YYYY hh24:mi:ss')||chr(10)||substr(staj_sysinfo,1,3000),1,3999)
                    where staj_id=cJobRow.staj_id;
                else
                    update sta_job set
                        staj_esid=rStajEsid.active,
                        staj_datesta=sysdate,
                        staj_chngcnt = staj_chngcnt+1,
                        staj_dateexe=dDateExec,
                        staj_bohidsched=p_BOH_ID,
                        staj_nooftrials=0,
                        staj_sysinfo=substr('Parent of child '||vNewJobId||' scheduled on '||to_char(sysdate, 'DD.MM.YYYY hh24:mi:ss')||chr(10)||substr(staj_sysinfo,1,3000),1,3999)
                    where staj_id=cJobRow.staj_id;

                    update sta_jobparam set
                        stajp_value=to_char(dTo, 'DD.MM.YYYY hh24:mi:ss')
                    where stajp_name=rJobParam.datefrom
                    and stajp_jobid=cJobRow.staj_id;

                    update sta_jobparam set
                        stajp_value=to_char(dToTo, 'DD.MM.YYYY hh24:mi:ss')
                    where stajp_name=rJobParam.dateto
                    and stajp_jobid=cJobRow.staj_id;
                end if;
              end if;
            end if;
        else
            --should never happen, because the Web Interface is verifiying the correct entries of dates
            update sta_job set
                staj_esid=rStajEsid.draft,
                staj_datesta=sysdate,
                staj_chngcnt = staj_chngcnt+1,
                staj_bohidsched=p_BOH_ID,
                staj_nooftrials=0,
                staj_sysinfo= substr( 'Sorry, cannot schedule the job because of missing parameter <DATETO>.'||chr(10)||substr(staj_sysinfo,1,3000),1,3999)
            where staj_id=cJobRow.staj_id;

        end if;
    end loop;

    RecordsAffected := nCount;

    commit;     -- $$$$ check necessity

exception
     WHEN NO_CONFIG_ERROR then
        PKG_COMMON.INSERT_WARNING (
            'PKG_STATS',
            'scheduleStats',
            'Error ',
            'No configuration (DEFAULT) found. Check STA_CONFIG.'
        );  -- 023SO
        ReturnStatus := 0;
        RecordsAffected := 0;

        rollback;       -- $$$$ check necessity

     when noPacIterator then
        if (bDebug) then pkg_stats_debug.debug('ERROR ','No PacIterator SQL found for the looping type: '||vPacLtid,vJobId); end if;
        if (rConfig.stac_syslogger=1) then writeSysLog('scheduleStats', SQLCODE, SQLERRM|| '(no PacIterator SQL for looping type: '||vPacLtid, '', sysdate); end if;
        if (rConfig.stac_logwarning=1) then
            PKG_COMMON.INSERT_WARNING (
                'PKG_STATS',
                'scheduleStats',
                'Error '||p_BOH_ID,
                'There is no iterator condition for this packing type. Please check table PACITERATOR',
                NULL,
                p_BOH_ID
            );  -- 023SO
        end if;
        ReturnStatus := 0;
        RecordsAffected := 0;

        rollback;       -- $$$$ check necessity

     when noDateFrom then
        if (bDebug) then pkg_stats_debug.debug('ERROR ','No parameter Date From for user defined Job '||vJobId||' found.',vJobId); end if;
        if (rConfig.stac_syslogger=1) then writeSysLog('scheduleStats', SQLCODE, SQLERRM|| '(no parameter Date From for user defined Job '||vJobId, '', sysdate); end if;
        if (rConfig.stac_logwarning=1) then
            PKG_COMMON.INSERT_WARNING (
                'PKG_STATS',
                'scheduleStats',
                'Error '||p_BOH_ID,
                'No parameter Date From for user defined Job '||vJobId||' found. Please check table STA_JOB',
                NULL,
                p_BOH_ID
            );  -- 023SO
        end if;
        ReturnStatus := 0;
        RecordsAffected := 0;

        rollback;       -- $$$$ check necessity

     when noDateTo then
        if (bDebug) then pkg_stats_debug.debug('ERROR ','No parameter Date To for user defined Job '||vJobId||' found.',vJobId); end if;
        if (rConfig.stac_syslogger=1) then writeSysLog('scheduleStats', SQLCODE, SQLERRM|| '(no parameter Date From for user defined Job '||vJobId, '', sysdate); end if;
        if (rConfig.stac_logwarning=1) then
            PKG_COMMON.INSERT_WARNING (
                'PKG_STATS',
                'scheduleStats',
                'Error '||p_BOH_ID,
                'No parameter Date From for user defined Job '||vJobId||' found. Please check table STA_JOB',
                NULL,
                p_BOH_ID
            ); -- 023SO
        end if;
        ReturnStatus := 0;
        RecordsAffected := 0;

        rollback;       -- $$$$ check necessity

      when noDateToAndUntil then
        if (bDebug) then pkg_stats_debug.debug('ERROR ','Missing Date To and Date Until for user defined Job '||vJobId||'.',vJobId); end if;
        if (rConfig.stac_syslogger=1) then writeSysLog('scheduleStats', SQLCODE, SQLERRM|| '(Missing Date To and Date Until for user defined Job '||vJobId, '', sysdate); end if;
        if (rConfig.stac_logwarning=1) then
            PKG_COMMON.INSERT_WARNING (
                'PKG_STATS',
                'scheduleStats',
                'Error '||p_BOH_ID,
                'Missing Date To and Date Until for user defined Job '||vJobId||' found. Please check table STA_JOB',
                NULL,
                p_BOH_ID
            ); -- 023SO
        end if;
        ReturnStatus := 0;
        RecordsAffected := 0;

        rollback;       -- $$$$ check necessity

     when noSqlDef then
        if (bDebug) then pkg_stats_debug.debug('ERROR ','No SQL Definitions found for '||vPacLtid,vJobId); end if;
        if (rConfig.stac_syslogger=1) then writeSysLog('scheduleStats', SQLCODE, SQLERRM|| '(no SQL Definition found for '||vPacLtid, '', sysdate); end if;
        if (rConfig.stac_logwarning=1) then
            PKG_COMMON.INSERT_WARNING (
                'PKG_STATS',
                'scheduleStats',
                'Error '||p_BOH_ID,
                'There is no SQL Definition for this packing type. Please check table STA_SQLDEF',
                NULL,
                p_BOH_ID
            ); -- 023SO
        end if;
        ReturnStatus := 0;
        RecordsAffected := 0;

        rollback;       -- $$$$ check necessity

     when Others then
        ErrorCode := SqlCode;
        ErrorMsg  := SqlErrM;
        ReturnStatus := 0;
        RecordsAffected := 0;

        rollback;       -- $$$$ check necessity

        if (bDebug) then pkg_stats_debug.debug('ERROR ',ErrorMsg,''); end if;
        if (rConfig.stac_syslogger=1) then writeSysLog('scheduleStats', SQLCODE, SQLERRM, '', sysdate); end if;
        if (rConfig.stac_logwarning=1) then
            PKG_COMMON.INSERT_WARNING (
                'PKG_STATS',
                'scheduleStats',
                'Error '||p_BOH_ID, sqlcode||': '||sqlerrm,
                NULL,
                p_BOH_ID
            ); -- 023SO
        end if;

end scheduleStats;


---------------------------------------------------------------------------------------------------------------
--Purpose:      Evaluate next execution date for certain package
--
--              This procedure is used in two different ways and meanings:
--              If the caller is SYSTEM, we try to figure out when the next execution date is
--              If the caller is INDIV, we figure, when is the next exec date for the packing, so that
--              the inRefDate is included! Big difference...
--
--Author:       Anita Haupenthal
--LastUpdate:   17-07-2003

FUNCTION getNextExecDate (inCaller in varchar2, inPacId in varchar2, inRefDate date) return date
is

PRAGMA AUTONOMOUS_TRANSACTION;          -- $$$$ check necessity

Cursor cPacking (inPacId packing.pac_id%type) is
    select
        pac_id,
        pac_name,
        pac_periodid,
        pac_datedone,
        pac_esid,
        nvl(pac_startday,0) pac_startday,
        nvl(pac_starthour,0) pac_starthour,
       nvl(pac_startminute,0) pac_startminute,
        period_durseq
    from packing, periodicity
    where pac_periodid=period_id
    and pac_id = inPacId
    order by
        period_durseq desc,             -- $$$$ check ordering
        pac_startday desc,
        pac_starthour desc,
        pac_startminute desc
    ;

cPackingRow cPacking%rowtype;

vHour varchar2(2) := 0;
vMonth varchar2(2) :='';

dNextExecDate date := null;
dDateDone date;

begin

    SET TRANSACTION READ ONLY;          -- $$$$ check necessity

    vHour := to_char(inRefDate, 'HH24');

    for cPackingRow in cPacking(inPacId) loop

        dDateDone:=cPackingRow.pac_datedone;

        if (cPackingRow.pac_periodid='YEARLY') then
            --First: get allowed nextDate for reference Date,
            --considering earliest possible startday and time

            dNextExecDate:= trunc(inRefDate,'YEAR')
                            +(nvl(cPackingRow.pac_startday,1)-1)
                            +((1/24)*nvl(cPackingRow.pac_starthour, 0))
                            +((1/1440)*nvl(cPackingRow.pac_startminute, 0));

            --If caller is system, then we check when we have to execute next time
            --Type: STAT and CONSOL
            if (inCaller=rCaller.system) then
                --Was last dateDone after next proposed execution? then move next execution into next period or
                --Last dateDone was whenever but already in the same period...
                if (dDateDone >= trunc(inRefDate,'YEAR')) then
                    dNextExecDate:= add_months(dNextExecDate, 12);         -- 014SO
                end if;
            end if;
        end if;

        if (cPackingRow.pac_periodid='MONTHLY') then
            --First: get allowed nextDate for reference Date,
            --considering earliest possible startday and time

           select trunc(inRefDate, 'MONTH')
                            + (nvl(cPackingRow.pac_startday,1)-1)
                            + ((1/24)*nvl(cPackingRow.pac_starthour, 0))
                            + ((1/1440)*nvl(cPackingRow.pac_startminute, 0))
           into dNextExecDate
           from dual;  -- 014SO

            --If caller is system, then we check when we have to execute next time
            --Type: STAT and CONSOL
            if (inCaller=rCaller.system) then
                --Was last dateDone after next proposed execution? then move next execution into next period or
                --Last dateDone was whenever but already in the same period...
                if (dDateDone >= trunc(inRefDate,'MONTH')) then
                    dNextExecDate:= add_months(dNextExecDate, 1);      -- 014SO
                end if;
            end if;
        end if;

        if (cPackingRow.pac_periodid='WEEKLY') then
            --first possible execution date of the week
            --fetch monday's date of current week
            select trunc(inRefDate, 'day')
                + (nvl(cPackingRow.pac_startday,1)-1)               -- 014SO  -- 012SO
                +((1/24)*nvl(cPackingRow.pac_starthour, 0))
                +((1/1440)*nvl(cPackingRow.pac_startminute, 0))
            into dNextExecDate
            from dual;

            --If caller is system, then we check when we have to execute next time
            if (inCaller=rCaller.system) then
                if (dDateDone >= trunc(inRefDate,'day')) then
                    dNextExecDate:= dNextExecDate+7;
                end if;
            end if;
        end if;

        if (cPackingRow.pac_periodid='DAILY') then
            --first possible execution date of that day
            dNextExecDate:= trunc(inRefDate)
                           +((1/24)*nvl(cPackingRow.pac_starthour, 0))
                           +((1/1440)*nvl(cPackingRow.pac_startminute, 0));

            --If caller is system, then we check when we have to execute next time
            if (inCaller=rCaller.system) then
                if (dDateDone >= trunc(inRefDate)) then
                    dNextExecDate:= dNextExecDate+1;
                end if;
            end if;
        end if;

        if (cPackingRow.pac_periodid='HOURLY') then
            --first possible execution date of that date
            dNextExecDate:= trunc(inRefDate,'hh24');

            --If caller is system, then we check when we have to execute next time
            if (inCaller=rCaller.system) then
                if (dDateDone >= trunc(inRefDate,'hh24')) then
                    dNextExecDate:= trunc(dNextExecDate,'hh24')+ 1/24;
                end if;
            end if;
       end if;
    end loop;

    commit; --end READ ONLY         -- $$$$ check necessity

    return dNextExecDate;

    exception
     when Others then

        if (bDebug) then pkg_stats_debug.debug('ERROR ',SqlCode||':'||SqlErrM,''); end if;
        if (rConfig.stac_syslogger=1) then writeSysLog('getNextExecDate', SQLCODE, SQLERRM, '', sysdate); end if;
        if (rConfig.stac_logwarning=1) then
            PKG_COMMON.INSERT_WARNING (
                'PKG_STATS',
                'getNextExecDate',
                'Error '||inPacId, sqlcode||': '||sqlerrm,
                NULL,
                inPacid
            ); -- 023SO
        end if;

        commit; --end READ ONLY           -- $$$$ check necessity
        return null;
end;
---------------------------------------------------------------------------------------------------------------------------
--Purpose:      check which procedures or other reports has to be done, before a certain report can be executed
--Caller:       XPIOC and/or WebGUI
--Parameter:    inPacId = report to exececute from <inDateFrom> to <inDateTo>
--ReturnValues: oDepend = false -> NO dependencies or All done = go ahead!
--              oDepend = true  -> wait! Not all dependencies are done!!
--              if oDepend=true -> oDepInfo has the following values:
--                  pac_id of dependend package
--                  pac_name
--                  next date of execution
--
--Author:       Anita Haupenthal
--LastUpdate:   31.03.2003
---------------------------------------------------------------------------------------------------------------------------------------

PROCEDURE checkDependencies
(  inPacId          IN varchar2,
   inDateFrom       IN date,
   inDateTo         IN date,

   oDepend          IN OUT boolean,
   oDepInfo         IN OUT tDepInfo,

   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT varchar2     --also for CALLER
)

is

PRAGMA AUTONOMOUS_TRANSACTION;      -- $$$$ check necessity

Cursor cPacking(inPacId packing.pac_id%type) is                                 -- 004SO
    select
        pac_id,
        pac_name,
        pac_periodid,
        pac_datedone,
        pac_esid,
        nvl(pac_startday,0) pac_startday,
        nvl(pac_starthour,0) pac_starthour,
        nvl(pac_startminute,0) pac_startminute,
        period_durseq
    from packing, periodicity
    where pac_periodid=period_id
    and pac_id = inPacId
    ;

cPackingRow   cPacking%rowtype;                                                 -- 004SO


Cursor cForeRunnerPacking(inPacId packing.pac_id%type) is                       -- 004SO
    select
        pac_id,
        pac_name,
        pac_periodid,
        pac_datedone,
        pac_esid,
        nvl(pac_startday,0) pac_startday,
        nvl(pac_starthour,0) pac_starthour,
        nvl(pac_startminute,0) pac_startminute,
        period_durseq
    from packing, periodicity
    where pac_periodid=period_id
    and pac_id in (
            select pacpac_pacid1
            from pacpacdep
            where pacpac_pacid2=inPacId)
    -- and pac_esid in (rPacEsid.active, rPacEsid.scheduled, rPacEsid.locked)   -- 013SO
    order by
        period_durseq desc,             -- $$$$ check ordering
        pac_startday desc,
        pac_starthour desc,
        pac_startminute desc
    ;

cForeRunnerPackingRow   cForeRunnerPacking%rowtype;                             -- 004SO

dCanBeDoneAfter date := null;                                                   -- 004SO
dMustBeDoneAfter date := null;

vCaller varchar2(30);

begin

vCaller:=ReturnStatus;

--Clear "old" values
oDepInfo := tDepInfo(null, null, null);
oDepInfo.Delete;

--Set return values in case we dont have dependencies
oDepend := false;

SET TRANSACTION READ ONLY;          -- $$$$ check necessity

for cPackingRow in cPacking(inPacId) loop
    -- get the context for the job to be scheduled (no looping here, only one row returned)

    --Loop through eventually existing dependencies:
    for cForeRunnerPackingRow in cForeRunnerPacking(inPacId) loop
        --Check the periodid and the pac_datedone!
        --Calculate next possible execution date depending on periodid
        dCanBeDoneAfter:=getNextExecDate(vCaller, cForeRunnerPackingRow.pac_id, inDateTo);
        if cPackingRow.pac_periodid = 'HOURLY' then
            dMustBeDoneAfter:= trunc(dCanBeDoneAfter,'hh24');
        elsif cPackingRow.pac_periodid = 'DAILY' then
            dMustBeDoneAfter:= trunc(dCanBeDoneAfter);
        elsif cPackingRow.pac_periodid = 'WEEKLY' then
            dMustBeDoneAfter:= trunc(dCanBeDoneAfter,'day');                    -- will be the last monday
        elsif cPackingRow.pac_periodid = 'MONTHLY' then
            dMustBeDoneAfter:= trunc(dCanBeDoneAfter,'MONTH');
        elsif cPackingRow.pac_periodid = 'YEARLY' then
            dMustBeDoneAfter:= trunc(dCanBeDoneAfter,'YEAR');
        end if;
        if (cForeRunnerPackingRow.pac_datedone is null) or
            (cForeRunnerPackingRow.pac_datedone < dMustBeDoneAfter) or
              (cForeRunnerPackingRow.pac_esid not in (rPacEsid.active, rPacEsid.draft)) then   -- 013SO -- 011SO
            oDepend := true;        -- 004SO logic reversed
            oDepInfo.Extend;        -- initalize one null-value element             -- 004SO moved here
            oDepInfo(oDepInfo.Count).depPacId := cForeRunnerPackingRow.pac_id;                -- 004SO fill new element
            oDepInfo(oDepInfo.Count).depPacName := cForeRunnerPackingRow.pac_name;            -- 004SO fill new element
            oDepInfo(oDepInfo.Count).depPacExec := dCanBeDoneAfter;                 -- 004SO fill new element
        end if;
        -- exit;   -- 004SO
    end loop;

end loop;

commit; --End READ ONLY         -- $$$$ check necessity

ReturnStatus := 1;
RecordsAffected := oDepInfo.Count;


exception
     when Others then
        ErrorCode := SqlCode;
        ErrorMsg  := SqlErrM;
        ReturnStatus := 0;
        RecordsAffected := 0;

        if (bDebug) then pkg_stats_debug.debug('ERROR ',ErrorMsg,''); end if;
        if (rConfig.stac_syslogger=1) then writeSysLog('checkDependencies', SQLCODE, SQLERRM, '', sysdate); end if;
        if (rConfig.stac_logwarning=1) then
            PKG_COMMON.INSERT_WARNING (
                'PKG_STATS',
                'checkDependencies',
                'Error '||inPacId, sqlcode||': '||sqlerrm,
                NULL,
                inPacId
            ); -- 023SO
        end if;

end;


--------------------------------------------------------------------------------------------------------------------------------------
--EXECUTER

--Purpose:      Executes next Job in Queue
--Caller:       XPIOC
--Author:       Anita Haupenthal

--001AH         28.04.2004 PDF value
--002AH                 10.05.2004 ARCHIVE DIR and User OUTPUT DIR

--LastUpdate:       10-05-2004 ARCHIVE DIR and User OUTPUT DIR
---------------------------------------------------------------------------------------------------------------------------------------
PROCEDURE getNextJob
(  p_PACT_ID        IN varchar2 DEFAULT NULL,
   p_BOH_ID         IN varchar2 DEFAULT NULL,

   arrKey           OUT tKey,
   arrValue         OUT tValue,
   arrNote          OUT tNote,

   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT varchar2
)
is

vXprocName  xproc.xpr_id%type := ReturnStatus;

vResult     varchar2(20);
vJobId      sta_job.staj_id%type;
vJobPacId   sta_job.staj_pacid%type;

nCount      number := 0;
nRecCount   number := 0;
nI          number := 1;
nSql        number := 0;

--Array for dependencies
tDepI PKG_STATS.TDEPINFO;

bDepend     boolean;
bGoAhead    boolean := false;

dFrom       date;
dTo         date;

--Debug
vP          varchar2(10);
vPN         varchar2(100);
vPE         date;

--Version 1: get next jobs, ordered by dependencies and staj_dateexe, pac_datetry
--sta_getnextjob = VIEW
Cursor cJob(vXproc xproc.xpr_id%type) is
    select
        WICKI, STAJ_ID, STAJ_PACID,STAJ_DATEEXE,PAC_DATETRY,PAC_DATEDONE,
        PAC_OUTPUTDIR,STAJ_DATESTA,DATEEXE,STAJ_ESID,PAC_ESID,STAJ_ETID,
        PAC_ETID,PAC_LTID,STAJ_LTVALUE,PAC_TEMPLATE,PAC_FILEMASK,PAC_NEXTSEQ,
        PAC_ID,PAC_NAME,PERIOD, pac_notification, pac_notid,staj_sysinfo,
        pac_pdfmask, pac_archivestatistic, pac_archivedir, STAJ_DIRECTORYID
    from sta_getnextjob
    where pac_esid in (rPacEsid.active, rPacEsid.scheduled)
    and sysdate >= staj_dateexe
    and sysdate < staj_dateexe + (1/24)*rConfig.stac_execsched                  -- 006SO
    and pac_xprocid=vXproc
        --exclude the original jobs of repeat monkeys. only their children get executed
    and (
        (stajp_value = '01.01.2100 00:00:00' and staj_parentid = 0) or
        (stajp_value <> '01.01.2100 00:00:00' and staj_parentid <> 0 )
        )                                                                       -- 006SO
    ;

cJobRow   cJob%rowtype;

--Fetch parameters for one JOB
Cursor cParam(vJob sta_job.STAJ_ID%type) is
    select stajp_name, stajp_value
    from sta_jobparam
    where stajp_jobid=vJob;

cParamRow cParam%rowtype;

--Fetch sql-statements for one JOB
Cursor cSQL(vJob sta_job.STAJ_ID%type) is
    select stajq_queryname, stajq_sql
    from sta_jobsql
    where stajq_jobid=vJob;

cSQLRow cSQL%rowtype;

--Notification details
Cursor cNote (vNotId varchar2) is
    select * from notificationtempl
    where Upper(not_id)=Upper(vNotId)
    and not_esid=rNoteEsid.active;

cNoteRow cNote%rowtype;

Cursor cNotParam (vNotId varchar2) is
    select * from not_param
    where Upper(notp_notid)=Upper(vNotId);
cNotParamRow cNotParam%rowtype;

--Dynamic cursor: to bind run time
Type tDynCursor is ref cursor;
cvCursor tDynCursor;

vCursor varchar2(4000) :='' ;
vCursorValue varchar2(300) :='';
vTemp varchar2(4000) := '';
vTempParam not_param.notp_name%type;
vMover sta_directory.stad_mover%type;

no_directorypath exception;

begin


--Clear values
arrKey.delete;
arrValue.delete;
arrNote.delete;

--Read the acual configuration settings
rConfig := getConfig;
if (rConfig.stac_id is null) then
    raise NO_CONFIG_ERROR;
end if;


--First get rid of "old" jobs, that means jobs which are scheduled but
--shouldnt be executed anymore, because the schedule time was too long
--see sta_config (DEFAULT is 720 hrs = 1 Month)

nCount := cleanJobs(rConfig.stac_execSched);

--Initalize ReturnValues
RecordsAffected := 0;
nCount := 0;
nRecCount :=0;


--Check each dependencies of each scheduled JOB
--if dependencies are okay: fetch parameters/sql statements and fill
--return array

for cJobRow in cJob(vXprocName) loop
    --clear old values
    nI := 1;
    bDepend := false;

    vJobId := cJobRow.staj_id;
    vJobPacId := cJobRow.staj_pacid;

    --Try to find parameter [DATEFROM] and [DATETO] for checking dependencies
    for cParamRow in cParam(vJobId) loop
        if (cParamRow.stajp_name=rJobParam.datefrom) then
            dFrom := to_date(cParamRow.stajp_value,'DD.MM.YYYY HH24:MI:SS');
        end if;
        if (cParamRow.stajp_name=rJobParam.dateto) then
            dTo := to_date(cParamRow.stajp_value,'DD.MM.YYYY HH24:MI:SS');
        end if;
    end loop;
    if (dFrom is not null and dTo is not null) then
        ReturnStatus:=rCaller.indiv;
        pkg_stats.checkdependencies(vJobPacId,dFrom,dTo,bDepend,tDepI,recordsaffected,errorcode,errormsg,returnstatus);
        if (recordsaffected > 0) then
            vP := tDepI(1).depPacId;
            vPN:= tDepI(1).depPacName;
            vPE:= to_Date(tDepI(1).depPacExec);
            if vPE < sysdate then
                vPE := sysdate + 0.5/24;                                        -- 007SO
            end if;

            if (substr(cJobRow.staj_sysinfo, 1,10)<> 'Dependency') then
                --Shift the execution date and note the dependency in sysinfo
                update sta_job set
                    staj_chngcnt=decode(staj_chngcnt, null, 1, staj_chngcnt+1),
                    staj_dateexe=vPE,
                    staj_datetry=sysdate,
                    staj_bohidexec=p_BOH_ID,
                    staj_sysinfo=substr('Dependency on '||tDepI(1).depPacId||' (next execution after '||to_char(to_date(tDepI(1).depPacExec)+1)||').'||chr(10)||substr(staj_sysinfo,1,3000),1,3999)
                where staj_id=vJobId;
            else
                --Only shift the execution date. Do not note the dependency in sysinfo again    -- 007SO
                update sta_job set
                    staj_chngcnt=decode(staj_chngcnt, null, 1, staj_chngcnt+1),
                    staj_dateexe=vPE,
                    staj_datetry=sysdate,
                    staj_bohidexec=p_BOH_ID
                where staj_id=vJobId;
            end if;
        end if;
    else
        --Cant check dependencies because of missing parameters <DATEFROM> and <DATETO>
        update sta_job set
            staj_chngcnt=decode(staj_chngcnt, null, 1, staj_chngcnt+1),
            staj_datetry=sysdate,
            staj_nooftrials=decode(staj_nooftrials, null, 1, staj_nooftrials+1),
            staj_sysinfo=substr('Couldnt execute job because of failing checkDependencies. Parameter [DATEFROM] and/or [DATETO] are missing.' ||chr(10)||substr(staj_sysinfo,1,3000),1,3999)
        where staj_id=vJobId;
    end if;

    --if we dont have open dependencies (bDepend is false) then send the information back to exececuter
    if (not bDepend) then
        --Check job type (CONSOL or STAT(ind)) and cross-check CONFIGURATION -> STAC_EXECPROC STAC_EXECREP
        --if the flags are set to 0 = off; skip this job and try to fetch another one
        --Check type CONSOL
        if (cJobRow.pac_etid=rPacEtid.consol) then
            if (rConfig.stac_execproc=0) then
                --The Procedure Module is deactivated! dont do anything...
                if (rConfig.stac_syslogger=1) then writeSysLog('anythingToDo', 777777, 'The STATS Procedure Module is deactivated. Controll the Configuration.', p_PACT_ID, sysdate); end if;
            else
                bGoAhead:=true;
            end if;
        end if;

        --Check type STAT
        if (cJobRow.pac_etid=rPacEtid.stat or cJobRow.pac_etid=rPacEtid.statind) then
            if (rConfig.stac_execrep=0) then
                --The Procedure Module is deactivated! dont do anything...
                if (rConfig.stac_syslogger=1) then writeSysLog('anythingToDo', 777777, 'The STATS Report Module is deactivated. Controll the Configuration.', p_PACT_ID, sysdate); end if;
            else
                bGoAhead:=true;
            end if;
        end if;

        --shall we work with a "working state"?
        if (bGoAhead) then
            --we found the next job to work on; send results back to XPIOC and wait till next time sunshine, babe!
            --Fill information for VB-XPIOC-Executer into Array
            --1
            arrKey(nI) := rSqlParam.pacetid;
            arrValue(nI) := cJobRow.pac_etid;
            nI := nI+1;
            --2
            arrKey(nI) := rSqlParam.jobid;
            arrValue(nI) := vJobId;
            nI := nI+1;
            --3
            arrKey(nI) := '<'||cJobRow.pac_ltid||'>';
            arrValue(nI) := cJobRow.staj_ltvalue;
            nI := nI+1;
            --4
            arrKey(nI) := rSqlParam.pactemp;
            arrValue(nI) := cJobRow.pac_template;
            nI := nI+1;

            --5
            arrKey(nI) := rSqlParam.outdir;
            arrValue(nI) := cJobRow.pac_outputdir;
            nI := nI+1;

            --6
            arrKey(nI) := rSqlParam.status;
            arrValue(nI) := cJobRow.pac_esid;
            nI := nI+1;

            --7
            arrKey(nI) := rSqlParam.filemask;
            arrValue(nI) := cJobRow.pac_filemask;
            nI := nI+1;

            --8
            arrKey(nI) := rSqlParam.nextseq;
            arrValue(nI) := cJobRow.pac_nextseq;
            nI := nI+1;

            --9
            arrKey(nI) := rSqlParam.pacid;
            arrValue(nI) := cJobRow.pac_id;
            nI := nI+1;

            --10
            arrKey(nI) := rSqlParam.pacname;
            arrValue(nI) := cJobRow.pac_name;
            nI := nI+1;

            --11
            arrKey(nI) := rSqlParam.period;
            arrValue(nI) := cJobRow.period;
            nI := nI+1;

             --12 No. of SQL statements
            begin
                select count(*)
                into nSql
                from sta_jobsql
                where stajq_jobid=vJobId;
                if (nSql=null) then
                    nSql:=0;
                end if;
            exception
                when no_data_found then
                    nSql:=0;
                when others then
                    nSql:=0;
            end;

            arrKey(nI) := rSqlParam.noofsql;
            arrValue(nI) := nSql;
            nI := nI+1;

            --001AH Add PDFMASK Parameter if STAC_CONFIG.STAC_EXECPDF is set to 1
            --13 PDF MASK
            arrKey(nI) := rSqlParam.pdfmask;
            if (rConfig.stac_execpdf=1) then
              arrValue(nI) := cJobRow.pac_pdfmask;
            else
              arrValue(nI) := '';
            end if;
            nI := nI+1;

            --002AH Add ARCHIVE DIR Parameter if PAC_ARCHIVESTATISTIC=1
            --14 ARCHIVE DIR
            arrKey(nI) := rSqlParam.archivedir;
            arrValue(nI) := '';
            if (rPacEtid.stat = cJobRow.pac_etid) then
              if (cJobRow.pac_archivestatistic=1) then
                arrValue(nI) := cJobRow.pac_archivedir;
              else
                arrValue(nI) := '';
              end if;
            end if;
            nI := nI+1;

            --15 User defined OUTPUT DIR from staj_directoryid -> sta_directory
            arrKey(nI) := rSqlParam.mover;
            if (cJobRow.staj_directoryid is not null) then  --OH, we have to fetch a user defined output dir
                begin
                    select stad_mover into vMover
                    from sta_directory
                    where stad_id=cJobRow.staj_directoryid;
                exception
                    when others then
                        raise no_directorypath;
                end;
              arrValue(nI) := vMover;
            else
              arrValue(nI) := '';
            end if;
            nI := nI+1;

            --Fetch parameter for this job
            --Start with 20
            nI := 20;
            --Fetch SQL Definitions from sta_jobsql

            for cSqlRow in cSql(vJobId) loop
                arrKey(nI) := cSqlRow.stajq_queryname;
                arrValue(nI) := cSqlRow.stajq_sql;
                nI := nI+1;
            end loop;

            --writeSysLog('getNextJob', 0, 'afterSqlRow', arrValue(nI-1), sysdate);
            --Check if we have to send notifications around the world
            --if yes, collect notification info, recipient list, and replace params in body of notification
            --and send the whole package back to xpioc for delivery
            if (cJobRow.pac_notification=1) then
                for cNoteRow in cNote(cJobRow.pac_notid) loop
                    --fetch data into vector

                    arrNote(1):= 1;     --1= send notification; 0=dont send
                    arrNote(2):= cNoteRow.not_id;
                    arrNote(3):= cNoteRow.not_subject;
                    arrNote(4):= cNoteRow.not_body;
                    vTemp:= cNoteRow.not_body;
                    arrNote(5):= cNoteRow.not_senderdisp;
                    arrNote(6):= cNoteRow.not_sendertxt;
                    arrNote(7):= cNoteRow.not_recdisp;
                    arrNote(8):= cNoteRow.not_adrfrom;
                    arrNote(9):= cNoteRow.not_adrto;
                    arrNote(10):=cNoteRow.not_adrcc;
                    arrNote(11):=cNoteRow.not_adrbcc;
                    arrNote(12):=cNoteRow.not_attfile;
                    arrNote(13):=cNoteRow.not_etid;

                    --get recipients
                    if (lower(substr(arrNote(8),1,6))='select') then
                        vCursor:=arrNote(8);
                        open cvCursor for vCursor;
                        arrNote(8):='';
                        loop
                            --loop value, e.g. con_id, ac_id or something equal
                            fetch cvCursor into vCursorValue;
                            exit when cvCursor%NOTFOUND;
                            arrNote(8):=arrNote(8)||rConfig.stac_separator||vCursorValue;
                        end loop;
                        close cvCursor;
                        --check if we found some recipients
                        if (arrNote(8)='') then
                            arrNote(1):=0;
                            --write warning
                            if (rConfig.stac_logwarning=1) then
                                PKG_COMMON.INSERT_WARNING (
                                    'PKG_STATS',
                                    'getNextJob',
                                    'Error '||p_BOH_ID,
                                    'Couldnt find any recipient with the not_adrto select statement ('||vJobPacId||'). No notification was sent.',
                                    NULL,
                                    p_BOH_ID
                                ); -- 023SO
                            end if;
                        end if;
                    end if;
                                        --HACK: Replace all know parameters
                    vTemp:=replace(vTemp, '<Recipients>', arrNote(9));
                    vTemp:=replace(vTemp, '<ReceiptDate>', sysdate);
                    vTemp:=replace(vTemp, '<FileCreationDate>', sysdate);
                    vTemp:=replace(vTemp, '<PackingName>', cJobRow.pac_name);
                    vTemp:=replace(vTemp, '<PackingId>', vJobPacId);
                    vTemp:=replace(vTemp, '<SenderEmail>', arrNote(8));
                    vTemp:=replace(vTemp, '<FileType>', 'Excel');
                    if (vJobPacId)='SR033a' then
                      select count(*) into nRecCount from sr033a_details;
                      vTemp:=replace(vTemp, '<RecordCount>', nRecCount);
                    end if;
                    --replace already known params
                    for cNotParamRow in cNotParam(cJobRow.pac_notid) loop
                        vTempParam:=cNotParamRow.notp_name;
                        if (vTempParam='<Recipients>') then
                            vTemp:=replace(vTemp, vTempParam, arrNote(9));
                        end if;
                        if (vTempParam='<ReceiptDate>' or vTempParam='<FileCreationDate>') then
                            vTemp:=replace(vTemp, vTempParam, sysdate);
                        end if;
                        if (vTempParam='<PackingName>') then
                            vTemp:=replace(vTemp, vTempParam, cJobRow.pac_name);
                            --writeSysLog('getNextJob', 99, vTempParam, vTemp, sysdate);
                        end if;
                        if (vTempParam='<PackingId>') then
                            vTemp:=replace(vTemp, vTempParam, vJobPacId);
                            --writeSysLog('getNextJob', 99, vTempParam, vTemp, sysdate);
                        end if;
                        if (vTempParam='<SenderEmail>') then
                            vTemp:=replace(vTemp, vTempParam, arrNote(8));
                            --writeSysLog('getNextJob', 99, vTempParam, vTemp, sysdate);
                        end if;
                    end loop;

                    arrNote(4):=vTemp;

                end loop;

                --for debugging
                --writeSysLog('getNextJob', 0, 'gotcha', vTemp, sysdate);

                --Check if we could find the proper notification; if not write warning
                if (arrNote.count=0) then
                    if (rConfig.stac_logwarning=1) then
                        PKG_COMMON.INSERT_WARNING (
                            'PKG_STATS',
                            'getNextJob',
                            'Error '||p_BOH_ID, 'Couldnt find proper notification template for packing '||vJobPacId||'. No notification was sent.',
                            NULL,
                            p_BOH_ID
                        ); -- 023SO
                    end if;
                end if;
            end if; --Notification

            --set status to "working", update no of trials and datetry...
            update sta_job set
                staj_esid=rStajEsid.working,
                staj_datesta=sysdate,
                staj_chngcnt=decode(staj_chngcnt, null, 1, staj_chngcnt+1),
                staj_datetry=sysdate, staj_nooftrials=staj_nooftrials+1, staj_bohidexec=p_BOH_ID,
                staj_sysinfo=substr('Processing started at '||to_char(sysdate, 'DD.MM.YYYY HH24:MI:SS')||chr(10)||substr(staj_sysinfo,1,3000),1,3999)
            where staj_id=vJobId;

            nCount := 1;
            --we are done: exit loop
            exit;
        end if; --end bGoAhead
    end if; --end bDepend
end loop;

commit;                     -- $$$$ check necessity
ReturnStatus := 1;
RecordsAffected := nCount;

exception
       when NO_DIRECTORYPATH then
        PKG_COMMON.INSERT_WARNING (
            'PKG_STATS', 
            'getNextJob', 
            'Error ', 
            'No user defined directory path found. Check STA_DIRECTORY.'
        );  -- 023SO

        RecordsAffected := 0;
        ReturnStatus := 0;

     WHEN NO_CONFIG_ERROR then
        PKG_COMMON.INSERT_WARNING (
            'PKG_STATS', 
            'getNextJob', 
            'Error ', 
            'No configuration (DEFAULT) found. Check STA_CONFIG.'
        );  -- 023SO

        RecordsAffected := 0;
        ReturnStatus := 0;

     when Others then
        ErrorCode := SqlCode;
        ErrorMsg  := SqlErrM;
        ReturnStatus := 0;
        RecordsAffected := 0;

        rollback;       -- $$$$ check necessity

        if (bDebug) then pkg_stats_debug.debug('ERROR ',ErrorMsg,''); end if;
        if (rConfig.stac_syslogger=1) then writeSysLog('getNextJob', SQLCODE, SQLERRM,'vJobId: '|| vJobId||', vJobPacId: '||vJobPacId, sysdate); end if;
        if (rConfig.stac_logwarning=1) then  
            PKG_COMMON.INSERT_WARNING (
                'PKG_STATS', 
                'getNextJob', 
                'Error '||p_BOH_ID, sqlcode||': '||sqlerrm, 
                NULL, 
                p_BOH_ID
            ); -- 023SO
        end if;

end;

---------------------------------------------------------------------------------------------------------------------------------------
--Purpose:      Clean already scheduled jobs, which are not executed within allowed time frame
--Caller:       getNextJob
--Author:       Anita Haupenthal
--LastUpdate:   03.04.2003
---------------------------------------------------------------------------------------------------------------------------------------

FUNCTION cleanJobs
(hrsToExec in sta_config.stac_execsched%type) RETURN number

is

PRAGMA AUTONOMOUS_TRANSACTION;              -- $$$$ check necessity

nC number := 0;
BEGIN
    rConfig := getConfig;
    if (rConfig.stac_id is null) then
        raise NO_CONFIG_ERROR;
    end if;


    --Clean already scheduled jobs, which exceeded the allowed time frame between date of
    --scheduling/execution execSched (see sta_config)
    update sta_job set
        staj_esid = rStajEsid.locked,
        staj_datesta=sysdate,
        staj_sysinfo=substr('The job got locked by cleanJobs. The timeframe between scheduling and execution is too long.'||chr(10)||substr(staj_sysinfo,1,3000),1,3999)
    where staj_esid = rStajEsid.scheduled
    and (staj_dateexe < (sysdate-((1/24)*hrsToExec)));

    nC := SQL%ROWCOUNT;

    --System system locked jobs after 6*allowed time between execution and execSched (see sta_config)
    update sta_job set
        staj_esid = rStajEsid.deleted,
        staj_datesta=sysdate,
        staj_sysinfo=substr('The job got deleted by cleanJobs. The job was already locked for too long.'||chr(10)||substr(staj_sysinfo,1,3000),1,3999)
    where staj_esid = rStajEsid.locked
    and (staj_dateexe < (sysdate-(6*(1/24)*hrsToExec)));

    nC := nC + SQL%ROWCOUNT;

    --Set jobs to ERROR where total number of trials exceed maximum of allowed trials (see sta_config.stac_nooftrials)
    update sta_job set
        staj_esid = rStajEsid.error,
        staj_datesta=sysdate,
        staj_sysinfo=substr('Too many unsuccessful trials. Sorry about that.'||chr(10)||substr(staj_sysinfo,1,3000),1,3999)
    where staj_esid in (rStajEsid.locked, rStajEsid.scheduled)
    and staj_nooftrials > rConfig.stac_nooftrials;

    nC := nC + SQL%ROWCOUNT;

     --Set "hanging" (working) back to scheduled if they "hang" longer than stac_waitforwork hours
     --but only for STAT and STATIND and NOT CONSOL
    update sta_job set
        staj_esid = rStajEsid.scheduled,
        staj_datesta=sysdate,
        staj_sysinfo=substr('Job status was set back to scheduled by cleanJobs.'||chr(10)||substr(staj_sysinfo,1,3000),1,3999)
    where staj_esid = rStajEsid.working
    and sysdate > staj_datesta+(1/24*rConfig.stac_waitforwork)
    and staj_pacid in (
        select pac_id
        from packing
        where pac_etid in (rPacEtid.stat,rPacEtid.statind)
    );

    nC := nC + SQL%ROWCOUNT;

    commit;         -- $$$$ check necessity

    return nC;

EXCEPTION
    WHEN NO_CONFIG_ERROR then
        PKG_COMMON.INSERT_WARNING (
            'PKG_STATS', 
            'cleanJobs', 
            'Error ', 
            'No configuration (DEFAULT) found. Check STA_CONFIG.' 
        );  -- 023SO
        rollback;           -- $$$$ check necessity
        return 0;

    WHEN Others THEN
       rollback;            -- $$$$ check necessity

       if (rConfig.stac_syslogger=1) then writeSysLog('cleanJobs', SQLCODE, SQLERRM, '', sysdate); end if;
       if (rConfig.stac_logwarning=1) then  
        PKG_COMMON.INSERT_WARNING (
            'PKG_STATS', 
            'cleanJobs', 
            'Error', 
            sqlcode||': '||sqlerrm
        ); -- 023SO
        end if;

       return 0;

END; -- function CleanJobs;


---------------------------------------------------------------------------------------------------------------------------------------
--Purpose:      writes back Job Results from XPIOS into DB
--Caller:       XPIOC
--Author:       Anita Haupenthal
--LastUpdate:   31.03.2003
---------------------------------------------------------------------------------------------------------------------------------------

PROCEDURE setJobResult
(
   p_PACT_ID        IN varchar2 DEFAULT NULL,
   p_BOH_ID         IN varchar2,

   arrKey           IN tKey,
   arrVal           IN tValue,

   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT varchar2
 )

is

vStatus sta_job.staj_esid%type;
nJobNoOfTrials sta_job.staj_nooftrials%type;

vPacEsid packing.pac_esid%type;
vPacEsidNew packing.pac_esid%type;

vParentId sta_job.staj_parentid%type;
dFrom date;
dTill date;
vTo sta_jobparam.stajp_value%type;

dPacDateSta date;

nCount      number := 0;
nCountA     number := 0;
nCountO     number := 0;
nCountE     number := 0;

bDone       boolean := false;

begin

--arrKey(1) := pac_etid;
--arrKey(2) := job_id;
--arrKey(3) := con_id
--arrKey(4) := pac_template
--arrKey(5) := pac_outputdir
--arrKey(6) := ReturnStatus
--arrKey(7) := filemask
--arrKey(8) := nextseq
--arrKey(9) := pac_id
--arrKey(10) := pac_name
--arrKey(11) := period

--arrKey(20).. := status                 'okay or error
--arrKey(21).. := stajo_outputdir
--arrKey(22).. := stajo_filename
--arrKey(23).. := stajo_etid             'xls or pdf

--Initialize ReturnValues
RecordsAffected:=1;
ReturnStatus:=1;

--Read configuration data
rConfig := getConfig;
if (rConfig.stac_id is null) then
    raise NO_CONFIG_ERROR;
end if;

vStatus:=rStajEsid.okay;
if (arrVal(20) = 'ERROR') then
    vStatus := rStajEsid.error;
end if;

--ALL JOBS: Update the job based information -> Table STA_JOB
--Error-Case: A job is set to error, if we reached the max number of allowed trials and status is error
if (vStatus = rStajEsid.error) then
    select
        staj_nooftrials
    into nJobNoOfTrials
    from sta_job
    where staj_id=arrVal(2);

    if (nJobNoOfTrials >= rConfig.stac_nooftrials) then         --to much trials, shoot em
        --Change status to error, thats the end, boy!
        update sta_job set
            staj_datetry = sysdate,
            staj_nooftrials=nvl(staj_nooftrials+1, 1),
            staj_esid=decode(staj_esid, rStajEsid.deleted, rStajEsid.deleted, vStatus),
            staj_datesta=sysdate,
            staj_sysinfo=substr('Too many unsuccessful trials. Sorry.'||chr(10)||substr(staj_sysinfo,1,3000),1,3999),
            staj_chngcnt=staj_chngcnt+1,
            staj_bohidexec=p_BOH_ID
        where staj_id=arrVal(2);
    else
        --Set status back to scheduled for next trial
        update sta_job set
            staj_esid=decode(staj_esid, rStajEsid.deleted, rStajEsid.deleted, rStajEsid.scheduled),
            staj_sysinfo=substr('Trials: '||nJobNoOfTrials||chr(10)||substr(staj_sysinfo,1,3000),1,3999),
            staj_datesta=sysdate,
            staj_datetry = sysdate,
            staj_chngcnt=staj_chngcnt+1,
            staj_bohidexec=p_BOH_ID
        where staj_id=arrVal(2);
    end if;
else
    --Change status to okay, we made it, cool:-)
    update sta_job set
        staj_datetry = sysdate,
        staj_esid=vStatus,
        staj_datesta=sysdate,
        staj_chngcnt=staj_chngcnt+1,
        staj_bohidexec=p_BOH_ID, staj_sysinfo=substr('Successfully executed ('||to_char(sysdate,'DD.MM.YYYY HH24:MI:SS')||')'||chr(10)||substr(staj_sysinfo,1,3000),1,3999)
    where staj_id=arrVal(2);
end if;
nCount := SQL%ROWCOUNT;

--STAT and STATIND: On success -> insert the generated file information into -> Table STA_JOBOUTPUT
if (vStatus=rStajEsid.okay and (arrVal(1)= rPacEtid.stat or arrVal(1) = rPacEtid.statind)) then
    --Later we have to loop, right now we assume that only one file/job will be generated
    --make sure no "old" shitty files are left...
    delete from sta_joboutput where stajo_id=arrVal(2);
    insert into sta_joboutput (
        stajo_id,
        stajo_jobid,
        stajo_datecre,
        stajo_outputdir,
        stajo_filename,
        stajo_etid
    ) values (
        generateuniquekey('G'),
        arrVal(2),
        sysdate,
        arrVal(21),
        arrVal(22),
        arrVal(23)
    );
end if;

--CONSOL/STAT: set status of packing table if it was a CONSOL or STAT job
--set it back to "old" status unless the status changed meanwhile
--if status is still "scheduled", what we assume, then set status to "active", otherwise to whatever it is now
--Furthmore, check if all instances of a STAT packing is done, if not, keep status "scheduled" or what ever
if (arrVal(1) = rPacEtid.stat or arrVal(1) = rPacEtid.consol) then
    select pac_esid, pac_datesta into vPacEsid, dPacDateSta from packing where pac_id=arrVal(9);

    select count(*)
    into nCountA
    from sta_job                   --Count all active/scheduled jobs for this packing and
    where staj_pacid=arrVal(9)
    and staj_esid in (rStajEsid.active, rStajEsid.scheduled, rStajEsid.okay, rStajEsid.error,rStajEsid.locked)
    and staj_datesta >= dPacDateSta;

    select count(*)
    into nCountO
    from sta_job                   --Count all done/okay jobs for this packing and
    where staj_pacid=arrVal(9)
    and staj_esid = rStajEsid.okay
    and staj_datesta >= dPacDateSta;

    select count(*)
    into nCountE
    from sta_job                   --Count all error/locked jobs for this packing and
    where staj_pacid=arrVal(9)
    and staj_esid in (rStajEsid.error, rStajEsid.locked)
    and staj_datesta >= dPacDateSta;

    --Now decide how to set the packing esid depending on recent status and instanciated jobs
    if (nCountA=nCountO) then                                   --All jobs are done fine, status okay
        if (vPacEsid=arrVal(6)) then
            vPacEsidNew := rPacEsid.active;
        else
            vPacEsidNew := vPacEsid;
        end if;
        bDone := true;
    end if;
    if ((nCountA=nCountO+nCountE) and nCountE>0) then           --All jobs are done, but some with error, status locked
        if (vPacEsid=arrVal(6)) then
            vPacEsidNew := rPacEsid.locked;
        else
            vPacEsidNew := vPacEsid;
        end if;
        bDone := true;
    end if;
    --update packing table
    if (bDone) then
        update packing set
            pac_esid=vPacEsidNew,
            pac_chngcnt=pac_chngcnt+1,
            pac_datetry=sysdate,
            pac_datedone=sysdate,
            pac_datesta=sysdate,
            pac_nextseq=nvl(pac_nextseq+1, 1)
        where pac_id= arrVal(9);
    else
        update packing set
            pac_chngcnt=pac_chngcnt+1,
            pac_datetry=sysdate
        where pac_id= arrVal(9);
    end if;
end if;

RecordsAffected := nCount;

commit;         -- $$$$ check necessity

exception
     WHEN NO_CONFIG_ERROR then
        PKG_COMMON.INSERT_WARNING (
            'PKG_STATS', 
            'setJobResult', 
            'Error ', 
            'No configuration (DEFAULT) found. Check STA_CONFIG.'
        );  -- 023SO
        RecordsAffected := 0;
        ReturnStatus := 0;

     when Others then
        ErrorCode := SqlCode;
        ErrorMsg  := SqlErrM;

        ReturnStatus := 0;
        RecordsAffected := 0;

        rollback;       -- $$$$ check necessity

        if (bDebug) then pkg_stats_debug.debug('ERROR ',ErrorMsg,''); end if;
        if (rConfig.stac_syslogger=1) then writeSysLog('setJobResult', SQLCODE, SQLERRM, '', sysdate); end if;
        if (rConfig.stac_logwarning=1) then  
            PKG_COMMON.INSERT_WARNING (
                'PKG_STATS', 
                'setJobResults', 
                'Error '||p_BOH_ID, sqlcode||': '||sqlerrm, 
                NULL, 
                p_BOH_ID
            ); -- 023SO
        end if;

end;

----------------------------------------------------------------------------------------------------------------------------------------
--SYSTEM Stuff -----------------------------------------------------------------------------------------------------------------------
--Purpose:          Keeping track of all System Messages
--                  Only if STAC_CONFIG.stac_syslogger = 1
--
--Author:           Anita Haupenthal
--LastUpdate:       31.03.2003
----------------------------------------------------------------------------------------------------------------------------------------

PROCEDURE writeSysLog
(   pMethod varchar2, pSqlCode number, pSqlErrM varchar2,pParameter varchar2, pLoggedOn date)
is

PRAGMA AUTONOMOUS_TRANSACTION;

begin

    insert into sta_syslog (stas_method, stas_sqlcode, stas_sqlerrm, stas_parameter, stas_datelog)
        values (pMethod, pSqlCode, pSqlErrM, pParameter, pLoggedOn);

    commit;

exception
     WHEN Others THEN
       if (rConfig.stac_syslogger=1) then writeSysLog('writeSysLog', SQLCODE, SQLERRM, '', sysdate); end if;

end; --writeSysLogger

---------------------------------------------------------------------
--WEB STUFF

--  Purpose:  Implements the Statistics Related functionality
--            See procedure/function specific description within below
--
--  MODIFICATION HISTORY (for details see VSS repository)
--  Person      Date        Comments
--  ---------   ------      ------------------------------------------
--  AA          09.04.2003  Created the package and the procedure SP_INSERT_STA_JOB
--  AH          07.05.2003  Created checkBaseTable
--  AA          07.05.2003  Added error num, desc and return status parameters to the SP checkBaseTable


-------------------------------------------------------------------------------------------------------------------------
--Purpose:          check possible dates of base table for offering to customer (web-gui)
--
--Author:           Anita Haupenthal
--LastUpdate:       07.05.2003
----------------------------------------------------------------------------------------------------------------------------------------

Procedure checkBaseTableData (
  inPacId          In     Varchar2,

  outDateFrom      Out    Date,
  outDateTo        Out    Date,
  outDrop          Out    Number,
  outDropPeriod    Out    Varchar2,

  outDateFromRaw   Out    Date,
  outDateToRaw     Out    Date,

  RecordsAffected  Out    Number,
  ErrorCode        Out    Number,
  ErrorMsg         Out    Varchar2,
  ReturnStatus     In Out Number
)


is

    PRAGMA AUTONOMOUS_TRANSACTION;          -- $$$$ check necessity

    --Dynamic cursor: to bind run time
    Type tBaseTable is ref cursor;
    cvBaseTable tBaseTable;

    vBTConsol      sta_pacparam.stap_value%type :='';
    nBTDrop        sta_pacparam.stap_drop%type;
    vBTDropperiodid sta_pacparam.stap_dropperiodid%type;

    vBTRAW         sta_pacparam.stap_value%type :='';

    vSelect varchar2(2000) := 'select minDate, maxDate from sta_checkBT_';

begin

    SET TRANSACTION READ ONLY;              -- $$$$ check necessity

    --Read BaseTable Name from sta_pacparam
    begin
        select
            stap_value,
            stap_drop,
            stap_dropperiodid
        into vBTConsol, nBTDrop, vBTDropperiodid
        from sta_pacparam
        where stap_pacid=inPacId
        and stap_name='[BASE_TABLE]';
    exception
        when others then                            -- 008SO
            vBTConsol := NULL;
            nBTDrop := NULL;
            vBTDropperiodid := NULL;
    end;

    begin
        select stap_value
        into vBTRaw
        from sta_pacparam
        where stap_pacid=inPacId
        and stap_name='[BASE_TABLE_RAW]';
    exception                                       -- 008SO
        when others then
            vBTRaw := NULL;
    end;

    --If no baseTable is available return null
    if ((vBTConsol is null or vBTConsol='unknown')
         and (vBTRaw is null or vBTRaw ='unknown')) then
        RecordsAffected := 0;
    else
        --we have got the baseTable and try to get min(date) and max(date) -> use views:
        --get the BaseTable Consol dates
        if (vBTConsol is not null and vBTConsol<>'unknown') then
            vSelect := vSelect ||vBTConsol;
            open cvBaseTable for vSelect;
            loop
                fetch cvBaseTable into outDateFrom, outDateTo;
                exit when cvBaseTable%notfound;
                RecordsAffected := 1;
            end loop;
            close cvBaseTable;
            outDrop := nBTDrop;
            outDropPeriod := vBTDropperiodid;
        end if;
        --get the BaseTable Raw dates
        vSelect := 'select minDate, maxDate from sta_checkBT_';
        if (vBTRaw is not null  and vBTRaw<>'unknown') then
            vSelect := vSelect ||vBTRaw;
            open cvBaseTable for vSelect;
            loop
                fetch cvBaseTable into outDateFromRaw, outDateToRaw;
                exit when cvBaseTable%notfound;
                RecordsAffected := 1;
            end loop;
            close cvBaseTable;
        end if;
    end if;
    ReturnStatus := 1;

    commit; --End READ ONLY             -- $$$$ check necessity

exception

     when Others then
       outDateFrom := null;
       outDateTo := null;
       outDrop := null;
       outDropPeriod := null;

       outDateFromRaw := null;
       outDateToRaw := null;
       RecordsAffected :=0;

       ErrorCode := SqlCode;
       ErrorMsg  := SqlErrM;
       ReturnStatus := 0;

       if (bDebug) then pkg_stats_debug.debug('ERROR ',SQLERRM,''); end if;
       if (rConfig.stac_syslogger=1) then writeSysLog('checkBaseTableData', SQLCODE, SQLERRM, '', sysdate); end if;
       if (rConfig.stac_logwarning=1) then  
        PKG_COMMON.INSERT_WARNING (
            'PKG_STATS', 
            'checkBaseTableData', 
            'Error '||inPacId, sqlcode||': '||sqlerrm, 
            NULL, 
            inPacId
        ); -- 023SO
       end if;

       commit; --end READ ONLY      -- $$$$ check necessity
end;

--------------------------------------------------------------------------------------
-- 010AA
--  Author:   Ateeq Ahmed
--  Purpose:  Create a new Stats Job record and
--            return the Job Id in the output parameter
--            Overloaded procedure version of SP_NEW_STA_JOB procedure with extra
--            Job Notification parameters
--  CALLER:   Web Interface (Web Module: clsStat.GetNewJob)
--------------------------------------------------------------------------------------
  Procedure SP_NEW_STA_JOB (
    p_StajParentId      In      STA_JOB.STAJ_PARENTID%Type,
    p_StajPacId         In      STA_JOB.STAJ_PACID%Type,
    p_StajInfo          In      STA_JOB.STAJ_INFO%Type,
    p_StajLtValue       In      STA_JOB.STAJ_LTVALUE%Type,
    p_StajPeriodId      In      STA_JOB.STAJ_PERIODID%Type,
    p_AcIdCre           In      ACCOUNT.AC_ID%Type,
    p_StajId            Out     STA_JOB.STAJ_ID%Type,
    p_StajNotification  In      STA_JOB.STAJ_NOTIFICATION%Type,                 -- 010AA
    p_StajNotId         In      STA_JOB.STAJ_NOTID%Type,                        -- 010AA
    p_StajNotEmailSuccess   In  STA_JOB.STAJ_NOTEMAILSUCCESS%Type,              -- 010AA
    p_StajNotEmailFailure   In  STA_JOB.STAJ_NOTEMAILFAILURE%Type,              -- 010AA
    p_StajNotSendAttachment In  STA_JOB.STAJ_NOTSENDATT%Type,                   -- 010AA
    p_RecordsAffected   Out     Number,
    p_ErrNumber         In Out  Number,
    p_ErrDesc           In Out  Varchar2,
    p_ReturnStatus      In Out  Number
  )
  Is
    l_StajId            Varchar2(10);
  Begin
    -- Get a new Job Id
    Select GenerateUniqueKey('G') Into l_StajId From Dual;
    Insert Into STA_JOB (
      STAJ_ID,
      STAJ_PACID,
      STAJ_PARENTID,
      STAJ_ESID,
      STAJ_ETID,
      STAJ_INFO,
      STAJ_NOTIFICATION,                                                        -- 010AA
      STAJ_NOTID,                                                               -- 010AA
      STAJ_NOTEMAILSUCCESS,                                                     -- 010AA
      STAJ_NOTEMAILFAILURE,                                                     -- 010AA
      STAJ_NOTSENDATT,                                                          -- 010AA
      STAJ_DATEEXE,
      STAJ_DATESTA,
      STAJ_DATECRE,
      STAJ_ACIDCRE,
      STAJ_DATEMOD,
      STAJ_ACIDMOD,
      STAJ_CHNGCNT,
      STAJ_BOHIDSCHED,
      STAJ_BOHIDEXEC,
      STAJ_LTVALUE,
      STAJ_PERIODID
    )
    Values (
      l_StajId,
      p_StajPacId,
      p_StajParentId,
      rStajEsid.Draft,
      rStajType.Xls,
      p_StajInfo,
      p_StajNotification,                                                       -- 010AA
      p_StajNotId,                                                              -- 010AA
      p_StajNotEmailSuccess,                                                    -- 010AA
      p_StajNotEmailFailure,                                                    -- 010AA
      p_StajNotSendAttachment,                                                  -- 010AA
      NULL,
      SysDate,
      SysDate,
      p_AcIdCre,
      NULL,
      NULL,
      0,
      NULL,
      NULL,
      p_StajLtValue,
      p_StajPeriodId
    );
    p_StajId  := l_StajId;
    p_RecordsAffected := Sql%RowCount;
    p_ReturnStatus := 1;
    Return;
  Exception
    When Others Then
      p_ErrNumber := SqlCode;
      p_ErrDesc := SqlErrm;
      p_RecordsAffected := 0;
      p_ReturnStatus := 0;
      if (rConfig.stac_logwarning=1) then  
        PKG_COMMON.INSERT_WARNING (
            'PKG_STATS', 
            'sp_new_sta_job', 
            'Error', 
            sqlcode||': '||sqlerrm
        ); -- 023SO
      end if;
      rollback;     -- $$$$ check necessity
  End SP_NEW_STA_JOB;

--------------------------------------------------------------------------------------
--  Author:   Ateeq Ahmed
--  Purpose:  Create a new Stats Job Parameter for the given StatJob Id
--  CALLER:   Web Interface
--------------------------------------------------------------------------------------
  Procedure SP_NEW_STA_JOBPARAM (
    p_StajId            In      STA_JOB.STAJ_ID%Type,
    p_StajpName         In      STA_JOBPARAM.STAJP_NAME%Type,
    p_StajpValue        In      STA_JOBPARAM.STAJP_VALUE%Type,
    p_RecordsAffected   Out     Number,
    p_ErrNumber         In Out  Number,
    p_ErrDesc           In Out  Varchar2,
    p_ReturnStatus      In Out  Number
  )
  Is


  Begin
    Insert Into STA_JOBPARAM (
      STAJP_ID,
      STAJP_JOBID,
      STAJP_NAME,
      STAJP_VALUE
    )
    Values (
      GenerateUniqueKey('G'),
      p_StajId,
      p_StajpName,
      p_StajpValue
    );

    p_RecordsAffected := Sql%RowCount;
    p_ReturnStatus := 1;
    Return;
  Exception
    When Others Then
      p_ErrNumber := SqlCode;
      p_ErrDesc := SqlErrm;
      p_RecordsAffected := 0;
      p_ReturnStatus := 0;

      if (rConfig.stac_logwarning=1) then  
        PKG_COMMON.INSERT_WARNING (
            'PKG_STATS', 
            'sp_new_sta_jobparam', 
            'Error', 
            sqlcode||': '||sqlerrm
        ); -- 023SO
      end if;

      rollback;     -- $$$$ check necessity

  End SP_NEW_STA_JOBPARAM;

--------------------------------------------------------------------------------------
--  Author:   Ateeq Ahmed
--  Purpose:  Re-create new SQL Statments for the given Stats Job Id
--  CALLER:   Web Interface
--------------------------------------------------------------------------------------
  Procedure SP_NEW_STA_JOBSQLS (
    p_StajId            In      STA_JOB.STAJ_ID%Type,
    p_RecordsAffected   Out     Number,
    p_ErrNumber         In Out  Number,
    p_ErrDesc           In Out  Varchar2,
    p_ReturnStatus      In Out  Number
  )
  Is

  -- Get all the Sql Definitions for this Stat Job's Packing Id
  Cursor C1_StaSqlDef(a_StajPacId Varchar2) Is
    Select STAQ_QUERYNAME, STAQ_VERSION, STAQ_SQL
    From STA_SQLDEF
    Where STAQ_PACID = a_StajPacId
  ;

  -- Get all the Job Parameters name-value pairs for this Stat Job
  Cursor C2_StaJobParam(a_StajId Varchar2, a_StajpName Varchar2) Is
    Select STAJP_VALUE
    From STA_JOBPARAM
    Where STAJP_JOBID = a_StajId
    And   STAJP_NAME = a_StajpName
  ;

  Cursor C3_GetAccountDet(a_StajId Varchar2) Is
    Select Nvl(AC_ID, '<Error>'), Nvl(AC_NAME, '<Error>')
      From ACCOUNT, STA_JOB
      Where 1=1
      And AC_ID = STAJ_LTVALUE (+)
      And STAJ_ID = a_StajId;

  Cursor C4_GetContractDet(a_StajId Varchar2) Is
    Select Nvl(CON_ID, '<Error>'), Nvl(CON_NAME, '<Error>')
      From CONTRACT, STA_JOB
      Where 1=1
      And CON_ID = STAJ_LTVALUE (+)
      And STAJ_ID = a_StajId;

  -- Cursor to check if Period Id is given for the Job
  Cursor C5_GetStajPeriodId(a_StajId Varchar2) Is
    Select STAJ_PERIODID
    From STA_JOB
    Where STAJ_ID = a_StajId
  ;

  l_StaqQueryname     STA_SQLDEF.STAQ_QUERYNAME%Type;
  l_StaqSql           STA_JOBSQL.STAJQ_SQL%Type;
  l_StajPacId         STA_JOB.STAJ_PACID%Type;
  l_PacLtId           PACKING.PAC_LTID%Type;
  l_ConId             CONTRACT.CON_ID%Type;
  l_ConName           CONTRACT.CON_NAME%Type;
  l_AcId              ACCOUNT.AC_ID%Type;
  l_AcName            ACCOUNT.AC_NAME%Type;
  l_StajpValue        STA_JOBPARAM.STAJP_VALUE%Type;
  l_StajPeriodId      STA_JOB.STAJ_PERIODID%Type;
  l_StajpValue_DateTill STA_JOBPARAM.STAJP_VALUE%Type := '';
  booDateToOptional   boolean := false;

  PARAM_NOTFOUND_DATEFROM   exception;
  PARAM_NOTFOUND_DATETO     exception;
  PARAM_NOTFOUND_DATETILL   exception;
  NO_DATETILL_WITH_PERIOD   exception;
  NO_PERIOD_WITH_DATETILL   exception;

  Begin

    p_RecordsAffected := 0;

    Delete From STA_JOBSQL
    Where STAJQ_JOBID = p_StajId;

    -- Get query tokens values other than those in Job Parameters:
    -- for Packing Id, STAJ_PACID
    Select STAJ_PACID, Nvl(PAC_LTID,'-') PAC_LTID
      Into l_StajPacId, l_PacLtId
      From STA_JOB, PACKING
      Where STAJ_PACID = PAC_ID
      And STAJ_ID = p_StajId;

    If (l_PacLtId = 'CON_ID') Then
      -- for CON_ID, CON_NAME
      Open C4_GetContractDet(p_StajId);
      Fetch C4_GetContractDet Into l_ConId, l_ConName;
      If (C4_GetContractDet%NotFound) Then
        l_ConId := '';
        l_ConName := '';
      End If;
      Close C4_GetContractDet;
    ElsIf (l_PacLtId = 'AC_ID') Then
      -- for AC_ID, AC_NAME
      Open C3_GetAccountDet(p_StajId);
      Fetch C3_GetAccountDet Into l_AcId, l_AcName;
      If (C3_GetAccountDet%NotFound) Then
        l_AcId := '';
        l_AcName := '';
      End If;
      Close C3_GetAccountDet;
    Else
      l_ConId := '';
      l_ConName := '';
      l_AcId := '';
      l_AcName := '';
    End If;

    Open C5_GetStajPeriodId(p_StajId);
    Fetch C5_GetStajPeriodId Into l_StajPeriodId;
    If (C5_GetStajPeriodId%NotFound) Then
      l_StajPeriodId := '';
    End If;
    Close C5_GetStajPeriodId;

    -- Loop all the Sql definitions for this Packing Id
    For C1Row_StaSqlDef In C1_StaSqlDef(l_StajPacId) Loop

      l_StaqQueryname := C1Row_StaSqlDef.STAQ_QUERYNAME;
      l_StaqSql := C1Row_StaSqlDef.STAQ_SQL;

      -- replace the DATEFROM parameter in the SqlDef query
      Open C2_StaJobParam(p_StajId, rJobParam.datefrom);
      Fetch C2_StaJobParam Into l_StajpValue;
      If (C2_StaJobParam%Found) Then
        l_StaqSql := Replace(l_StaqSql, '''' || rSqlParam.datefrom || '''', 'to_date(''' || l_StajpValue || ''',''dd.mm.yyyy hh24:mi:ss'')');
      Else
        Raise PARAM_NOTFOUND_DATEFROM;
      End If;
      Close C2_StaJobParam;

      -- replace the DATETILL parameter in the SqlDef query
      Open C2_StaJobParam(p_StajId, rJobParam.datetill);
      Fetch C2_StaJobParam Into l_StajpValue;
      If (C2_StaJobParam%Found) Then
        l_StaqSql := Replace(l_StaqSql, '''' || rSqlParam.datetill || '''', 'to_date(''' || l_StajpValue || ''',''dd.mm.yyyy hh24:mi:ss'')');
        If (Length(l_StajPeriodId)>0) Then
          booDateToOptional := True;
        Else
          If (l_StajpValue <> '01.01.2100') And (l_StajpValue <> '01.01.2100 00:00:00') Then
            l_StajpValue_DateTill := l_StajpValue;
            Raise NO_PERIOD_WITH_DATETILL;
          End If;
        End If;
      Else
        -- DateTill parameter not found, check if the Period is given
        -- if Yes then raise error. If Period not given then DateTill is optional (provided DateTo is given)
        If (Length(l_StajPeriodId)>0) Then
          Raise NO_DATETILL_WITH_PERIOD;
        Else
          booDateToOptional := True;
        End If;
      End If;
      Close C2_StaJobParam;

      -- replace the DATETO parameter in the SqlDef query
      Open C2_StaJobParam(p_StajId, rJobParam.dateto);
      Fetch C2_StaJobParam Into l_StajpValue;
      If (C2_StaJobParam%Found) Then
        l_StaqSql := Replace(l_StaqSql, '''' || rSqlParam.dateto || '''', 'to_date(''' || l_StajpValue || ''',''dd.mm.yyyy hh24:mi:ss'')');
      Else
        If Not booDateToOptional Then
          Raise PARAM_NOTFOUND_DATETO;
        End If;
      End If;
      Close C2_StaJobParam;

      -- replace the KEYWORDS parameter in the SqlDef query
      Open C2_StaJobParam(p_StajId, rJobParam.keywords);
      Fetch C2_StaJobParam Into l_StajpValue;
      If (C2_StaJobParam%Found) Then
        If (Length(l_StajpValue)>0) Then
          l_StaqSql := Replace(l_StaqSql, rSqlParam.keywords, ' AND BD_KEYWORD IN (' || l_StajpValue || ')');
        Else
          l_StaqSql := Replace(l_StaqSql, rSqlParam.keywords, '');
        End If;
      Else
        l_StaqSql := Replace(l_StaqSql, rSqlParam.keywords, '');
      End If;
      Close C2_StaJobParam;

      -- replace the SHORTID token in the SqlDef query
      Open C2_StaJobParam(p_StajId, rJobParam.shortid);
      Fetch C2_StaJobParam Into l_StajpValue;
      If (C2_StaJobParam%Found) Then
        If (Length(l_StajpValue)>0) Then
          l_StaqSql := Replace(l_StaqSql, rSqlParam.shortid, ' AND SHORTID IN (''' || l_StajpValue || ''')');
        Else
          l_StaqSql := Replace(l_StaqSql, rSqlParam.shortid, '');
        End If;
      Else
        l_StaqSql := Replace(l_StaqSql, rSqlParam.shortid, '');
      End If;
      Close C2_StaJobParam;

      -- replace the MSISDNA token in the SqlDef query
      Open C2_StaJobParam(p_StajId, rJobParam.msisdna);
      Fetch C2_StaJobParam Into l_StajpValue;
      If (C2_StaJobParam%Found) Then
        If (Length(l_StajpValue)>0) Then
            l_StajpValue := Replace (l_StajpValue, '*', '%');
            l_StajpValue := Replace (l_StajpValue, '?', '_');
            If (Instr(l_StajpValue,'%')>0) Or (Instr(l_StajpValue,'_')>0) Then
                l_StaqSql := Replace(l_StaqSql, rSqlParam.msisdna, ' AND SENDER LIKE ''' || l_StajpValue || '''');
            Else
                l_StaqSql := Replace(l_StaqSql, rSqlParam.msisdna, ' AND SENDER IN (''' || l_StajpValue || ''')');
            End If;
        Else
          l_StaqSql := Replace(l_StaqSql, rSqlParam.msisdna, '');
        End If;
      Else
        l_StaqSql := Replace(l_StaqSql, rSqlParam.msisdna, '');
      End If;
      Close C2_StaJobParam;

      -- replace the MSISDNB token in the SqlDef query
      Open C2_StaJobParam(p_StajId, rJobParam.msisdnb);
      Fetch C2_StaJobParam Into l_StajpValue;
      If (C2_StaJobParam%Found) Then
        If (Length(l_StajpValue)>0) Then
            l_StajpValue := Replace (l_StajpValue, '*', '%');
            l_StajpValue := Replace (l_StajpValue, '?', '_');
            If (Instr(l_StajpValue,'%')>0) Or (Instr(l_StajpValue,'_')>0) Then
                l_StaqSql := Replace(l_StaqSql, rSqlParam.msisdnb, ' AND RECEIVER LIKE ''' || l_StajpValue || '''');
            Else
                l_StaqSql := Replace(l_StaqSql, rSqlParam.msisdnb, ' AND RECEIVER IN (''' || l_StajpValue || ''')');
            End If;
        Else
          l_StaqSql := Replace(l_StaqSql, rSqlParam.msisdnb, '');
        End If;
      Else
        l_StaqSql := Replace(l_StaqSql, rSqlParam.msisdnb, '');
      End If;
      Close C2_StaJobParam;

      -- Replace other query tokens, JOB_ID, CON_ID, CON_NAME
      l_StaqSql := Replace(l_StaqSql, '<STAJ_ID>', p_StajId);

      -- Replace the Clause-Token with clause and value if value is found
      -- Else remove the Clause-Token
      If (Length(l_ConId)>0) Then
        l_StaqSql := Replace(l_StaqSql, '<CON_ID>', ' AND CON_ID = ''' || l_ConId || '''');
      Else
        l_StaqSql := Replace(l_StaqSql, '<CON_ID>', '');
      End If;

      l_StaqSql := Replace(l_StaqSql, '<CON_NAME>', l_ConName);

      -- Replace the Clause-Token with clause and value if value is found
      -- Else remove the Clause-Token
      If (Length(l_AcId)>0) Then
        l_StaqSql := Replace(l_StaqSql, '<AC_ID>', ' AND AC_ID = ''' || l_AcId || '''');
      Else
        l_StaqSql := Replace(l_StaqSql, '<AC_ID>', '');
      End If;

      l_StaqSql := Replace(l_StaqSql, '<AC_NAME>', l_AcName);

      -- Create a new SQL statement for this Stats Job
      Insert Into STA_JOBSQL (
        STAJQ_JOBID,
        STAJQ_STAQID,
        STAJQ_QUERYNAME,
        STAJQ_SQL
      )
      Values (
        p_StajId,
        'STAQ_ID',
        l_StaqQueryname,
        l_StaqSql
      );
      p_RecordsAffected := p_RecordsAffected + Sql%RowCount;

    End Loop;

    p_ReturnStatus := 1;
    -- Commit or Rollback done by the calling routine
    -- Commit;
    Return;
  Exception
    When PARAM_NOTFOUND_DATEFROM Then
      p_ErrNumber := 1001;
      p_ErrDesc := 'Job Parameter DateFrom not found for replacement';
      p_RecordsAffected := 0;
      p_ReturnStatus := 0;
      if (rConfig.stac_logwarning=1) then  
        PKG_COMMON.INSERT_WARNING (
            'PKG_STATS', 
            'sp_new_sta_jobsqls', 
            'Error', 
            p_ErrNumber||': '||p_ErrDesc
        ); -- 023SO
      end if;
      rollback; -- $$$$ check necessity

    When NO_DATETILL_WITH_PERIOD Then
      p_ErrNumber := 1002;
      p_ErrDesc := 'Job Parameter DateTill not found for replacement (Period=' ||l_StajPeriodId || ')';
      p_RecordsAffected := 0;
      p_ReturnStatus := 0;
      if (rConfig.stac_logwarning=1) then  
        PKG_COMMON.INSERT_WARNING (
            'PKG_STATS', 
            'sp_new_sta_jobsqls', 
            'Error', 
            p_ErrNumber||': '||p_ErrDesc
        ); -- 023SO
      end if;
      rollback;     -- $$$$ check necessity

    When NO_PERIOD_WITH_DATETILL Then
      p_ErrNumber := 1002;
      p_ErrDesc := 'Job Parameter Period not given with Repeat Date (' ||l_StajpValue_DateTill || ')';
      p_RecordsAffected := 0;
      p_ReturnStatus := 0;
      if (rConfig.stac_logwarning=1) then  
        PKG_COMMON.INSERT_WARNING (
            'PKG_STATS', 
            'sp_new_sta_jobsqls', 
            'Error', 
            p_ErrNumber||': '||p_ErrDesc
        ); -- 023SO
      end if;
      rollback;     -- $$$$ check necessity

    When PARAM_NOTFOUND_DATETO Then
      p_ErrNumber := 1003;
      p_ErrDesc := 'Job Parameter DateTo not found for replacement';
      p_RecordsAffected := 0;
      p_ReturnStatus := 0;
      if (rConfig.stac_logwarning=1) then  
        PKG_COMMON.INSERT_WARNING (
            'PKG_STATS', 
            'sp_new_sta_jobsqls', 
            'Error', 
            p_ErrNumber||': '||p_ErrDesc
        ); -- 023SO
      end if;
      rollback;     -- $$$$ check necessity

    When Others Then
      -- Commit or Rollback done by the calling routine
      -- RollBack;
      p_ErrNumber := SqlCode;
      p_ErrDesc := SqlErrm;
      p_RecordsAffected := 0;
      p_ReturnStatus := 0;
      if (rConfig.stac_logwarning=1) then  
        PKG_COMMON.INSERT_WARNING (
            'PKG_STATS', 
            'sp_new_sta_jobsqls', 
            'Error', 
            p_ErrNumber||': '||p_ErrDesc
        ); -- 023SO  
      end if;
      rollback;     -- $$$$ check necessity

   End SP_NEW_STA_JOBSQLS;

    --------------------------------------------------------------------------------------
    -- 001AA
    -- Author:   Ateeq Ahmed
    -- Purpose:  Re-create new SQL Statments for the given Stats Job Id
    -- CALLER:   Web Module (Ver.8.1.1 +)
    -- Remarks:  Make sure to call this function with only either
    --           of the Id (Job or Packing) is given
    --------------------------------------------------------------------------------------
    Procedure SP_REPLACE_PARAMS (
        p_StajId            In      Varchar2,
        p_PacId             In      Varchar2,
        p_PacLtId           In      Varchar2,
        p_StaqSql           In      Varchar2,
        p_StaqSqlNew        Out     Varchar2,
        p_RecordsAffected   Out     Number,
        p_ErrNumber         In Out  Number,
        p_ErrDesc           In Out  Varchar2,
        p_ReturnStatus      In Out  Number
    )
    Is

    -- Get all the Job Parameters name-value pairs for this Packing
    Cursor C1_StaPacParam(a_PacId Varchar2, a_StapName Varchar2) Is
        Select STAP_VALUE
        From STA_PACPARAM
        Where STAP_PACID = a_PacId
        And   STAP_WEB = 1
        And   STAP_NAME = a_StapName
    ;

    -- Get all the Job Parameters name-value pairs for this Stat Job
    Cursor C2_StaJobParam(a_StajId Varchar2, a_PacId Varchar2, a_ParamName Varchar2) Is
        Select STAJP_VALUE
        From STA_JOBPARAM
        Where STAJP_JOBID = a_StajId
        And   STAJP_NAME = a_ParamName
        Union
        Select STAP_VALUE
        From STA_PACPARAM
        Where STAP_PACID = a_PacId
        And   STAP_WEB = 1
        And   STAP_NAME = a_ParamName
    ;

    Cursor C3_GetAccountDet(a_StajId Varchar2) Is
        Select Nvl(AC_ID, '<Error>'), Nvl(AC_NAME, '<Error>')
        From ACCOUNT, STA_JOB
        Where 1=1
        And AC_ID = STAJ_LTVALUE (+)
        And STAJ_ID = a_StajId
    ;

    Cursor C4_GetContractDet(a_StajId Varchar2) Is
        Select Nvl(CON_ID, '<Error>'), Nvl(CON_NAME, '<Error>')
        From CONTRACT, STA_JOB
        Where 1=1
        And CON_ID = STAJ_LTVALUE (+)
        And STAJ_ID = a_StajId
    ;

    -- Cursor to check if Period Id is given for the Job
    Cursor C5_GetStajPeriodId(a_StajId Varchar2) Is
        Select STAJ_PERIODID
        From STA_JOB
        Where STAJ_ID = a_StajId
    ;

    l_ConId                 CONTRACT.CON_ID%Type;
    l_ConName               CONTRACT.CON_NAME%Type;
    l_AcId                  ACCOUNT.AC_ID%Type;
    l_AcName                ACCOUNT.AC_NAME%Type;
    l_StajPeriodId          STA_JOB.STAJ_PERIODID%Type;
    l_StajpValue            STA_JOBPARAM.STAJP_VALUE%Type;
    l_StaqSql               STA_JOBSQL.STAJQ_SQL%Type;
    l_PacLtId               PACKING.PAC_LTID%Type;
    l_StajpValue_DateTill   STA_JOBPARAM.STAJP_VALUE%Type := '';
    booDateToOptional       boolean := false;

    PARAM_NOTFOUND_DATEFROM   exception;
    PARAM_NOTFOUND_DATETO     exception;
    PARAM_NOTFOUND_DATETILL   exception;
    NO_DATETILL_WITH_PERIOD   exception;
    NO_PERIOD_WITH_DATETILL   exception;

Begin

    If (Length(p_PacId) > 0) Then
        Select PACI_SQL
            Into l_StaqSql
            From Packing, PacIterator
            Where Pac_ItId = Paci_Id
            And   Pac_Id = p_PacId;
        If (Sql%NotFound) Then
            l_StaqSql := '';
        End If;
        Select PAC_LTID
            Into l_PacLtId
            From Packing
            Where Pac_Id = p_PacId;
        If (Sql%NotFound) Then
            l_PacLtId := '';
        End If;
    Else
        l_StaqSql := p_StaqSql;
        l_PacLtId := p_PacLtId;
    End If;

    l_ConId := '';
    l_ConName := '';
    l_AcId := '';
    l_AcName := '';
    If (Instr(l_StaqSql,'<CON_ID>')>0)
        Or (Instr(l_StaqSql,'<AC_ID>')>0) Then
        If (l_PacLtId = 'CON_ID') Then
            -- for CON_ID, CON_NAME
            Open C4_GetContractDet(p_StajId);
            Fetch C4_GetContractDet Into l_ConId, l_ConName;
            If (C4_GetContractDet%NotFound) Then
                l_ConId := '';
                l_ConName := '';
            End If;
            Close C4_GetContractDet;
        ElsIf (l_PacLtId = 'AC_ID') Then
            -- for AC_ID, AC_NAME
            Open C3_GetAccountDet(p_StajId);
            Fetch C3_GetAccountDet Into l_AcId, l_AcName;
            If (C3_GetAccountDet%NotFound) Then
                l_AcId := '';
                l_AcName := '';
            End If;
            Close C3_GetAccountDet;
        End If;
    End If;

    Open C5_GetStajPeriodId(p_StajId);
    Fetch C5_GetStajPeriodId Into l_StajPeriodId;
    If (C5_GetStajPeriodId%NotFound) Then
        l_StajPeriodId := '';
    End If;
    Close C5_GetStajPeriodId;

    If (Instr(l_StaqSql,rSqlParam.datefrom)>0) Then
        -- replace the DATEFROM parameter in the SqlDef query
        Open C2_StaJobParam(p_StajId, p_PacId, rJobParam.datefrom);
        Fetch C2_StaJobParam Into l_StajpValue;
        If (C2_StaJobParam%Found) Then
            l_StaqSql := Replace(l_StaqSql, '''' || rSqlParam.datefrom || '''', 'to_date(''' || l_StajpValue || ''',''dd.mm.yyyy hh24:mi:ss'')');
        Else
            Raise PARAM_NOTFOUND_DATEFROM;
        End If;
        Close C2_StaJobParam;
    End If;

    If (Instr(l_StaqSql,rSqlParam.datetill)>0) Then
        -- replace the DATETILL parameter in the SqlDef query
        Open C2_StaJobParam(p_StajId, p_PacId, rJobParam.datetill);
        Fetch C2_StaJobParam Into l_StajpValue;
        If (C2_StaJobParam%Found) Then
            l_StaqSql := Replace(l_StaqSql, '''' || rSqlParam.datetill || '''', 'to_date(''' || l_StajpValue || ''',''dd.mm.yyyy hh24:mi:ss'')');
            If (Length(l_StajPeriodId)>0) Then
                booDateToOptional := True;
            Else
                If (l_StajpValue <> '01.01.2100') And (l_StajpValue <> '01.01.2100 00:00:00') Then
                    l_StajpValue_DateTill := l_StajpValue;
                    Raise NO_PERIOD_WITH_DATETILL;
                End If;
            End If;
        Else
            -- DateTill parameter not found, check if the Period is given
            -- if Yes then raise error. If Period not given then DateTill is optional (provided DateTo is given)
            If (Length(l_StajPeriodId)>0) Then
                Raise NO_DATETILL_WITH_PERIOD;
            Else
                booDateToOptional := True;
            End If;
        End If;
        Close C2_StaJobParam;
    End If;

    If (Instr(l_StaqSql,rSqlParam.dateto)>0) Then
        -- replace the DATETO parameter in the SqlDef query
        Open C2_StaJobParam(p_StajId, p_PacId, rJobParam.dateto);
        Fetch C2_StaJobParam Into l_StajpValue;
        If (C2_StaJobParam%Found) Then
            l_StaqSql := Replace(l_StaqSql, '''' || rSqlParam.dateto || '''', 'to_date(''' || l_StajpValue || ''',''dd.mm.yyyy hh24:mi:ss'')');
        Else
            If Not booDateToOptional Then
                Raise PARAM_NOTFOUND_DATETO;
            End If;
        End If;
        Close C2_StaJobParam;
    End If;

    If (Instr(l_StaqSql,rSqlParam.keywords)>0) Then
        -- replace the KEYWORDS parameter in the SqlDef query
        Open C2_StaJobParam(p_StajId, p_PacId, rJobParam.keywords);
        Fetch C2_StaJobParam Into l_StajpValue;
        If (C2_StaJobParam%Found) Then
            If (Length(l_StajpValue)>0) Then
                l_StaqSql := Replace(l_StaqSql, rSqlParam.keywords, ' AND BD_KEYWORD IN (' || l_StajpValue || ')');
            Else
                l_StaqSql := Replace(l_StaqSql, rSqlParam.keywords, '');
            End If;
        Else
            l_StaqSql := Replace(l_StaqSql, rSqlParam.keywords, '');
        End If;
        Close C2_StaJobParam;
    End If;

    If (Instr(l_StaqSql,rSqlParam.shortid)>0) Then
        -- replace the SHORTID token in the SqlDef query
        Open C2_StaJobParam(p_StajId, p_PacId, rJobParam.shortid);
        Fetch C2_StaJobParam Into l_StajpValue;
        If (C2_StaJobParam%Found) Then
            If (Length(l_StajpValue)>0) Then
                l_StaqSql := Replace(l_StaqSql, rSqlParam.shortid, ' AND SHORTID IN (''' || l_StajpValue || ''')');
            Else
                l_StaqSql := Replace(l_StaqSql, rSqlParam.shortid, '');
            End If;
        Else
            l_StaqSql := Replace(l_StaqSql, rSqlParam.shortid, '');
        End If;
        Close C2_StaJobParam;
    End If;

    If (Instr(l_StaqSql,rSqlParam.msisdna)>0) Then
        -- replace the MSISDNA token in the SqlDef query
        Open C2_StaJobParam(p_StajId, p_PacId, rJobParam.msisdna);
        Fetch C2_StaJobParam Into l_StajpValue;
        If (C2_StaJobParam%Found) Then
            If (Length(l_StajpValue)>0) Then
                l_StajpValue := Replace (l_StajpValue, '*', '%');
                l_StajpValue := Replace (l_StajpValue, '?', '_');
                If (Instr(l_StajpValue,'%')>0) Or (Instr(l_StajpValue,'_')>0) Then
                    l_StaqSql := Replace(l_StaqSql, rSqlParam.msisdna, ' AND SENDER LIKE ''' || l_StajpValue || '''');
                Else
                    l_StaqSql := Replace(l_StaqSql, rSqlParam.msisdna, ' AND SENDER IN (''' || l_StajpValue || ''')');
                End If;
            Else
                l_StaqSql := Replace(l_StaqSql, rSqlParam.msisdna, '');
            End If;
        Else
            l_StaqSql := Replace(l_StaqSql, rSqlParam.msisdna, '');
        End If;
        Close C2_StaJobParam;
    End If;

    If (Instr(l_StaqSql,rSqlParam.msisdnb)>0) Then
        -- replace the MSISDNB token in the SqlDef query
        Open C2_StaJobParam(p_StajId, p_PacId, rJobParam.msisdnb);
        Fetch C2_StaJobParam Into l_StajpValue;
        If (C2_StaJobParam%Found) Then
            If (Length(l_StajpValue)>0) Then
                l_StajpValue := Replace (l_StajpValue, '*', '%');
                l_StajpValue := Replace (l_StajpValue, '?', '_');
                If (Instr(l_StajpValue,'%')>0) Or (Instr(l_StajpValue,'_')>0) Then
                    l_StaqSql := Replace(l_StaqSql, rSqlParam.msisdnb, ' AND RECEIVER LIKE ''' || l_StajpValue || '''');
                Else
                    l_StaqSql := Replace(l_StaqSql, rSqlParam.msisdnb, ' AND RECEIVER IN (''' || l_StajpValue || ''')');
                End If;
            Else
                l_StaqSql := Replace(l_StaqSql, rSqlParam.msisdnb, '');
            End If;
        Else
            l_StaqSql := Replace(l_StaqSql, rSqlParam.msisdnb, '');
        End If;
        Close C2_StaJobParam;
    End If;

    -- Replace other query tokens, JOB_ID, CON_ID, CON_NAME
    l_StaqSql := Replace(l_StaqSql, '<STAJ_ID>', p_StajId);

    -- Replace the Clause-Token with clause and value if value is found
    -- Else remove the Clause-Token
    If (Length(l_ConId)>0) Then
        l_StaqSql := Replace(l_StaqSql, '<CON_ID>', ' AND CON_ID = ''' || l_ConId || '''');
    Else
        l_StaqSql := Replace(l_StaqSql, '<CON_ID>', '');
    End If;

    l_StaqSql := Replace(l_StaqSql, '<CON_NAME>', l_ConName);

    -- Replace the Clause-Token with clause and value if value is found
    -- Else remove the Clause-Token
    If (Length(l_AcId)>0) Then
        l_StaqSql := Replace(l_StaqSql, '<AC_ID>', ' AND AC_ID = ''' || l_AcId || '''');
    Else
        l_StaqSql := Replace(l_StaqSql, '<AC_ID>', '');
    End If;

    l_StaqSql := Replace(l_StaqSql, '<AC_NAME>', l_AcName);

    p_ReturnStatus := 1;
    p_StaqSqlNew := l_StaqSql;

Exception
    When PARAM_NOTFOUND_DATEFROM Then
        p_ReturnStatus := 0;
        Raise PARAM_NOTFOUND_DATEFROM;

    When NO_DATETILL_WITH_PERIOD Then
        p_ReturnStatus := 0;
        Raise NO_DATETILL_WITH_PERIOD;

    When NO_PERIOD_WITH_DATETILL Then
        p_ReturnStatus := 0;
        Raise NO_PERIOD_WITH_DATETILL;

    When PARAM_NOTFOUND_DATETO Then
        p_ReturnStatus := 0;
        Raise PARAM_NOTFOUND_DATETO;

End SP_REPLACE_PARAMS;

--------------------------------------------------------------------------------------
--  Author:   Ateeq Ahmed
--  Purpose:  Re-create new SQL Statments for the given Stats Job Id
--  CALLER:   Web Interface
--------------------------------------------------------------------------------------
  Procedure SP_NEW_STA_JOBSQLS_X (
    p_StajId            In      STA_JOB.STAJ_ID%Type,
    p_RecordsAffected   Out     Number,
    p_ErrNumber         In Out  Number,
    p_ErrDesc           In Out  Varchar2,
    p_ReturnStatus      In Out  Number
  )
  Is

  -- Get all the Sql Definitions for this Stat Job's Packing Id
  Cursor C1_StaSqlDef(a_StajPacId Varchar2) Is
    Select STAQ_QUERYNAME, STAQ_VERSION, STAQ_SQL
    From STA_SQLDEF
    Where STAQ_PACID = a_StajPacId
  ;

  l_StajPacId         STA_JOB.STAJ_PACID%Type;
  l_PacLtId           PACKING.PAC_LTID%Type;
  l_StaqQueryname     STA_SQLDEF.STAQ_QUERYNAME%Type;
  l_StaqSql           STA_JOBSQL.STAJQ_SQL%Type;
  l_StaqSql_New       STA_JOBSQL.STAJQ_SQL%Type;

  l_RecordsAffected   Number;
  l_ErrNumber         Number;
  l_ErrDesc           Varchar2(255);
  l_ReturnStatus      Number;

  PARAM_NOTFOUND_DATEFROM   exception;
  PARAM_NOTFOUND_DATETO     exception;
  PARAM_NOTFOUND_DATETILL   exception;
  NO_DATETILL_WITH_PERIOD   exception;
  NO_PERIOD_WITH_DATETILL   exception;

  Begin

    p_RecordsAffected := 0;

    Delete From STA_JOBSQL
    Where STAJQ_JOBID = p_StajId;

    -- Get query tokens values other than those in Job Parameters:
    -- for Packing Id, STAJ_PACID
    Select STAJ_PACID, Nvl(PAC_LTID,'-') PAC_LTID
        Into l_StajPacId, l_PacLtId
        From STA_JOB, PACKING
        Where STAJ_PACID = PAC_ID
        And STAJ_ID = p_StajId;

    -- Loop all the Sql definitions for this Packing Id
    For C1Row_StaSqlDef In C1_StaSqlDef(l_StajPacId) Loop

        l_StaqQueryname := C1Row_StaSqlDef.STAQ_QUERYNAME;
        l_StaqSql := C1Row_StaSqlDef.STAQ_SQL;

        SP_REPLACE_PARAMS(p_StajId, '', l_PacLtId, l_StaqSql, l_StaqSql_New, l_RecordsAffected, l_ErrNumber, l_ErrDesc, l_ReturnStatus);

        If (p_ReturnStatus = 1) Then
            -- Create a new SQL statement for this Stats Job
            Insert Into STA_JOBSQL (
              STAJQ_JOBID,
              STAJQ_STAQID,
              STAJQ_QUERYNAME,
              STAJQ_SQL
            )
            Values (
              p_StajId,
              'STAQ_ID',
              l_StaqQueryname,
              l_StaqSql_New
            );
            p_RecordsAffected := p_RecordsAffected + Sql%RowCount;
        Else
            Null;
            -- Called procedure raises an exception
        End If;
    End Loop;

    p_ReturnStatus := 1;
    -- Commit or Rollback done by the calling routine
    -- Commit;
    Return;
  Exception
    When PARAM_NOTFOUND_DATEFROM Then
      p_ErrNumber := 1001;
      p_ErrDesc := 'Job Parameter DateFrom not found for replacement';
      p_RecordsAffected := 0;
      p_ReturnStatus := 0;
      if (rConfig.stac_logwarning=1) then  
        PKG_COMMON.INSERT_WARNING (
            'PKG_STATS', 
            'sp_new_sta_jobsqls', 
            'Error', 
            p_ErrNumber||': '||p_ErrDesc
        ); -- 023SO
      end if;
      rollback;     -- $$$$ check necessity

    When NO_DATETILL_WITH_PERIOD Then
      p_ErrNumber := 1002;
      p_ErrDesc := 'Job Parameter DateTill not found for replacement (Period)'; --=' || p_StajPeriodId || ')';
      p_RecordsAffected := 0;
      p_ReturnStatus := 0;
      if (rConfig.stac_logwarning=1) then  
        PKG_COMMON.INSERT_WARNING (
            'PKG_STATS', 
            'sp_new_sta_jobsqls', 
            'Error', 
            p_ErrNumber||': '||p_ErrDesc
        ); -- 023SO
      end if;
      rollback;     -- $$$$ check necessity

    When NO_PERIOD_WITH_DATETILL Then
      p_ErrNumber := 1002;
      p_ErrDesc := 'Job Parameter Period not given with Repeat Date'; -- (' ||l_StajpValue_DateTill || ')';
      p_RecordsAffected := 0;
      p_ReturnStatus := 0;
      if (rConfig.stac_logwarning=1) then  
        PKG_COMMON.INSERT_WARNING (
            'PKG_STATS', 
            'sp_new_sta_jobsqls', 
            'Error', 
            p_ErrNumber||': '||p_ErrDesc
        ); -- 023SO
      end if;
      rollback;     -- $$$$ check necessity

    When PARAM_NOTFOUND_DATETO Then
      p_ErrNumber := 1003;
      p_ErrDesc := 'Job Parameter DateTo not found for replacement';
      p_RecordsAffected := 0;
      p_ReturnStatus := 0;
      if (rConfig.stac_logwarning=1) then  
        PKG_COMMON.INSERT_WARNING (
            'PKG_STATS', 
            'sp_new_sta_jobsqls', 
            'Error', 
            p_ErrNumber||': '||p_ErrDesc
        ); -- 023SO
      end if;
      rollback;     -- $$$$ check necessity

    When Others Then
      -- Commit or Rollback done by the calling routine
      -- RollBack;
      p_ErrNumber := SqlCode;
      p_ErrDesc := SqlErrm;
      p_RecordsAffected := 0;
      p_ReturnStatus := 0;
      if (rConfig.stac_logwarning=1) then  
        PKG_COMMON.INSERT_WARNING (
            'PKG_STATS', 
            'sp_new_sta_jobsqls', 
            'Error', 
            p_ErrNumber||': '||p_ErrDesc
        ); -- 023SO
      end if;
      rollback;     -- $$$$ check necessity

   End SP_NEW_STA_JOBSQLS_X;

--------------------------------------------------------------------------------------------------------------------------------------
--Purpose:      Get the Job's Notification data
--Caller:       XPIOC
--Author:       MA44/AA
--Remarks:      Reuses the tNote structure defined and used for returning Next Job data in getNextJob

--LastUpdate:   23-12-2004 Created
---------------------------------------------------------------------------------------------------------------------------------------
PROCEDURE getJobNotifData
(  p_PACT_ID        IN varchar2 DEFAULT NULL,
   p_BOH_ID         IN varchar2 DEFAULT NULL,
   p_STAJ_ID        IN varchar2,

   arrJobNotif      OUT tNote,

   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT varchar2
)
is

--get a job's notification attributes
Cursor cJob(vStaJobId sta_job.staj_id%type) is
    select
        STAJ_ID, STAJ_PACID, PAC_NAME, PAC_ETID,
        STAJ_NOTIFICATION, STAJ_NOTID,
        nvl(STAJ_NOTEMAILSUCCESS, adr_email) STAJ_NOTEMAILSUCCESS,
        nvl(STAJ_NOTEMAILFAILURE, adr_email) STAJ_NOTEMAILFAILURE,
        STAJ_NOTSENDATT             -- 009AA
    from sta_job, packing, account, address
    where staj_pacid=pac_id
    and staj_acidcre=ac_id
    and ac_adrid_main=adr_id
--    and staj_esid in ('W','S')
    and STAJ_ID=vStaJobId;
cJobRow     cJob%rowtype;

/*
    from sta_getnextjob
    where pac_esid in (rPacEsid.active, rPacEsid.scheduled)
    and sysdate >= staj_dateexe
    and sysdate < staj_dateexe + (1/24)*rConfig.stac_execsched                  -- 006SO
        --exclude the original jobs of repeat monkeys. only their children get executed
    and (
        (stajp_value = '01.01.2100 00:00:00' and staj_parentid = 0) or
        (stajp_value <> '01.01.2100 00:00:00' and staj_parentid <> 0 )
        )                                                                       -- 006SO
    ;
*/

vJobId          sta_job.staj_id%type;
vJobPacId       sta_job.staj_pacid%type;
bGoAhead        boolean := false;

--Notification details
Cursor cNote (vNotId varchar2) is
                select * from notificationtempl
                where Upper(not_id)=Upper(vNotId)
                and not_esid=rNoteEsid.active;

cNoteRow        cNote%rowtype;

Cursor cNotParam (vNotId varchar2) is
                select * from not_param
                where Upper(notp_notid)=Upper(vNotId);

cNotParamRow    cNotParam%rowtype;

vTemp           varchar2(4000) := '';

vCursor         varchar2(4000) :='' ;

--Dynamic cursor: to bind run time
Type tDynCursor is ref cursor;
cvCursor        tDynCursor;
vCursorValue    varchar2(300) :='';

nCount          number := 0;
nRecCount       number := 0;
vTempParam      not_param.notp_name%type;

--Debug
vP              varchar2(10);
vPN             varchar2(100);
vPE             date;

begin

--Clear values
arrJobNotif.delete;

--Read the acual configuration settings
rConfig := getConfig;
if (rConfig.stac_id is null) then
    raise NO_CONFIG_ERROR;
end if;

--Initalize ReturnValues
RecordsAffected := 0;
nCount := 0;
nRecCount :=0;

for cJobRow in cJob(p_STAJ_ID) loop

    vJobId := cJobRow.staj_id;
    vJobPacId := cJobRow.staj_pacid;

    --Check job type (CONSOL or STAT(ind)) and cross-check CONFIGURATION -> STAC_EXECPROC STAC_EXECREP
    --if the flags are set to 0 = off; skip procedure
    --Check type CONSOL
    if (cJobRow.pac_etid=rPacEtid.consol) then
        if (rConfig.stac_execproc=0) then
            --The Procedure Module is deactivated! dont do anything...
            if (rConfig.stac_syslogger=1) then writeSysLog('anythingToDo', 777777, 'The STATS Procedure Module is deactivated. Controll the Configuration.', p_PACT_ID, sysdate); end if;
        else
            bGoAhead:=true;
        end if;
    end if;

    --Check type STAT/STATIND
    if (cJobRow.pac_etid=rPacEtid.stat or cJobRow.pac_etid=rPacEtid.statind) then
        if (rConfig.stac_execrep=0) then
            --The Procedure Module is deactivated! dont do anything...
            if (rConfig.stac_syslogger=1) then writeSysLog('anythingToDo', 777777, 'The STATS Report Module is deactivated. Controll the Configuration.', p_PACT_ID, sysdate); end if;
        else
            bGoAhead:=true;
        end if;
    end if;

    --shall we work with a "working state"?
    if (bGoAhead) then

        --writeSysLog('getNextJob', 0, 'bGoAhead=true', arrValue(nI-1), sysdate);
        --Check if the local per job notification is activated (successful and failed notifs)
        --if yes, collect notification info, recipient list (stored in job), and replace params in body of notification
        --and return the data back to Xpioc for delivery
        if (cJobRow.staj_notification=1) then
            for cNoteRow in cNote(cJobRow.staj_notid) loop
                --assign values to returning array

                arrJobNotif(1):= 1;     --1= send notification; 0=dont send
                arrJobNotif(2):= cNoteRow.not_id;
                arrJobNotif(3):= cNoteRow.not_subject;
                arrJobNotif(4):= cNoteRow.not_body;
                vTemp:= cNoteRow.not_body;
                arrJobNotif(5):= cNoteRow.not_senderdisp;
                arrJobNotif(6):= cNoteRow.not_sendertxt;
                arrJobNotif(7):= cNoteRow.not_recdisp;
                arrJobNotif(8):= cNoteRow.not_adrfrom;
                arrJobNotif(9):= cJobRow.STAJ_NOTEMAILSUCCESS;                  -- to array element user to return success email list
                arrJobNotif(10):= cJobRow.STAJ_NOTEMAILFAILURE;                 -- cc array element used to return failure email list
                arrJobNotif(11):='';                                            -- bcc field not supported
                arrJobNotif(12):= cJobRow.STAJ_NOTSENDATT;
                arrJobNotif(13):=cNoteRow.not_etid;
                --get recipients
                if (lower(substr(arrJobNotif(9),1,6))='select') then
                    vCursor:=arrJobNotif(9);
                    open cvCursor for vCursor;
                    arrJobNotif(9):='';
                    loop
                        --loop value, e.g. con_id, ac_id or something equal
                        fetch cvCursor into vCursorValue;
                        exit when cvCursor%NOTFOUND;
                        arrJobNotif(9):=arrJobNotif(9)||rConfig.stac_separator||vCursorValue;
                    end loop;
                    close cvCursor;
                    --check if we found some recipients
                    if (arrJobNotif(9)='') then
                        arrJobNotif(1):=0;
                        --write warning
                        if (rConfig.stac_logwarning=1) then  
                            PKG_COMMON.INSERT_WARNING (
                                'PKG_STATS', 
                                'getNextJob', 
                                'Error '||p_BOH_ID, 
                                'Couldnt find any recipient with the not_adrto select statement ('||vJobPacId||'). No notification was sent.', 
                                NULL, 
                                p_BOH_ID
                            ); -- 023SO
                       end if;
                    end if;
                end if;
                --HACK: Replace all know parameters
                vTemp:=replace(vTemp, '<Recipients>', arrJobNotif(9));
                vTemp:=replace(vTemp, '<ReceiptDate>', sysdate);
                vTemp:=replace(vTemp, '<FileCreationDate>', sysdate);
                vTemp:=replace(vTemp, '<PackingName>', cJobRow.pac_name);
                vTemp:=replace(vTemp, '<PackingId>', vJobPacId);
                vTemp:=replace(vTemp, '<SenderEmail>', arrJobNotif(8));
                vTemp:=replace(vTemp, '<FileType>', 'Excel');
                if (vJobPacId)='SR033a' then
                  select count(*) into nRecCount from sr033a_details;
                  vTemp:=replace(vTemp, '<RecordCount>', nRecCount);
                end if;
                --replace already known params
                for cNotParamRow in cNotParam(cJobRow.staj_notid) loop
                    vTempParam:=cNotParamRow.notp_name;
                    if (vTempParam='<Recipients>') then
                        vTemp:=replace(vTemp, vTempParam, arrJobNotif(9));
                    end if;
                    if (vTempParam='<ReceiptDate>' or vTempParam='<FileCreationDate>') then
                        vTemp:=replace(vTemp, vTempParam, sysdate);
                    end if;
                    if (vTempParam='<PackingName>') then
                        vTemp:=replace(vTemp, vTempParam, cJobRow.pac_name);
                        --writeSysLog('getNextJob', 99, vTempParam, vTemp, sysdate);
                    end if;
                    if (vTempParam='<PackingId>') then
                        vTemp:=replace(vTemp, vTempParam, vJobPacId);
                        --writeSysLog('getNextJob', 99, vTempParam, vTemp, sysdate);
                    end if;
                    if (vTempParam='<SenderEmail>') then
                        vTemp:=replace(vTemp, vTempParam, arrJobNotif(8));
                        --writeSysLog('getNextJob', 99, vTempParam, vTemp, sysdate);
                    end if;
                end loop;
                arrJobNotif(4):=vTemp;
            end loop;
            --for debugging
            --writeSysLog('getNextJob', 0, 'gotcha', vTemp, sysdate);
            --Check if we could find the proper notification; if not write warning
            if (arrJobNotif.count=0) then
                if (rConfig.stac_logwarning=1) then  
                    PKG_COMMON.INSERT_WARNING (
                        'PKG_STATS', 
                        'getNextJob', 
                        'Error '||p_BOH_ID, 'Couldnt find proper notification template for job '||vJobId||'. No notification was sent.', 
                        NULL, 
                        p_BOH_ID
                    ); -- 023SO
               end if;
            end if;
        end if; -- Stat Indiv (per Job) Notification

        nCount := 1;
        --we are done: exit loop
        exit;
    end if; --end bGoAhead
end loop;

commit;                     -- $$$$ check necessity
ReturnStatus := 1;
RecordsAffected := nCount;

exception
     WHEN NO_CONFIG_ERROR then
        PKG_COMMON.INSERT_WARNING (
            'PKG_STATS', 
            'getNextJob', 
            'Error ', 
            'No configuration (DEFAULT) found. Check STA_CONFIG.'
        );  -- 023SO
        RecordsAffected := 0;
        ReturnStatus := 0;

     when Others then
        ErrorCode := SqlCode;
        ErrorMsg  := SqlErrM;
        ReturnStatus := 0;
        RecordsAffected := 0;

        rollback;       -- $$$$ check necessity

        if (bDebug) then pkg_stats_debug.debug('ERROR ',ErrorMsg,''); end if;
        if (rConfig.stac_syslogger=1) then writeSysLog('getJobNotifData', SQLCODE, SQLERRM,'vJobId: '|| vJobId||', vJobPacId: '||vJobPacId, sysdate); end if;
        if (rConfig.stac_logwarning=1) then  
            PKG_COMMON.INSERT_WARNING (
                'PKG_STATS', 
                'getJobNotifData', 
                'Error '||p_BOH_ID, sqlcode||': '||sqlerrm, 
                NULL, 
                p_BOH_ID
            ); -- 023SO
        end if;

end getJobNotifData;



END; -- Package Body PKG_STATS
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- USERMNG_SBS  (Package Body) 
--
CREATE OR REPLACE PACKAGE BODY SBS1_ADMIN.USERMNG_SBS
Is
--
-- Purpose:
-- Provides an interface to Centrum user for maintaining selected attributes
-- of Accounts and their Address stored in SBS1 tables
--
-- MODIFICATION HISTORY
-- Person       Date        Comments
-- ---------    ----------  ------------------------------------------
-- 001AA        07.01.2005  Created the package
-- 002AA        21.01.2005  Renamed the package from pkg_centrum to 'usermng_sbs'
-- 003AA        21.01.2005  Updated centrum username from CENTRUM_READER to CENTRUM_USER
-- 004AA        27.01.2005  Added flag to deactivate the issues creation
-- 005AA        08.02.2005  Remove (comment) the additional parameters not defined in the Centrum Specs
-- 006AA        14.02.2005  Moved the error codes and descriptions to the table Errdef and implement a sp to retrieve and use them
-- 007SO        28.02.2005  Implementing additional Requirement in Interface (AC_ID)
-- 008SO        03.04.2014  Implement UAM Logging
-- 009SO        13.12.2015  Inject AcId to all UAM Logs to enable efficient sycronisation in CPro

   -- 004AA Deactivate the creation of issues
   bCreateIssueForAccAdrChange  boolean := false;

Function GetCurrentUser
    Return Varchar2
Is
Begin
        Return Sys_Context('USERENV', 'CURRENT_USER');
End GetCurrentUser;

Function GetAcId(
    P_AC_SHORT  IN  varchar2
) Return Varchar2
Is  -- 009SO
    Cursor cGetAccount Is
    Select AC_ID
    From Account
    Where AC_SHORT = P_AC_SHORT;
    l_AcId varchar2(10):= NULL;
Begin
    open cGetAccount;
    fetch cGetAccount Into l_AcId;
    close cGetAccount;
    return  l_AcId;
End GetAcId;


Procedure uamlog (
       P_UAML_ACSHORT   in  varchar2,
       P_UAML_METHOD    in  varchar2,
       P_UAML_ACID      in  varchar2,
       P_UAML_NAME      in  varchar2,
       P_UAML_LANGID    in  varchar2,
       P_UAML_COMMENT   in  varchar2,
       P_UAML_ACTYPE    in  varchar2,
       P_UAML_DEPT      in  varchar2,
       P_UAML_PHONE1    in  varchar2,
       P_UAML_PHONE2    in  varchar2,
       P_UAML_MOBILE    in  varchar2,
       P_UAML_FAX       in  varchar2,
       P_UAML_EMAIL     in  varchar2,
       P_UAML_ERROR     in  varchar2
)
IS  -- 008SO
    PRAGMA AUTONOMOUS_TRANSACTION;
    l_current_user  VARCHAR2(10);
BEGIN
    l_current_user := GetCurrentUser();
    INSERT INTO UAMLOG (
       UAML_ACSHORT,
       UAML_DATETIME,
       UAML_UAMPAID,
       UAML_METHOD,
       UAML_LOGIN_REQ,
       UAML_ACID_REQ,
       UAML_ACID,
       UAML_NAME,
       UAML_LANGID,
       UAML_COMMENT,
       UAML_ACTYPE,
       UAML_DEPT,
       UAML_PHONE1,
       UAML_PHONE2,
       UAML_MOBILE,
       UAML_FAX,
       UAML_EMAIL,
       UAML_ERROR
    ) VALUES (
       P_UAML_ACSHORT,
       SYSDATE,
       'USERMNG_SBS',
       P_UAML_METHOD,
       NULL,
       l_current_user,
       P_UAML_ACID,
       P_UAML_NAME,
       P_UAML_LANGID,
       P_UAML_COMMENT,
       P_UAML_ACTYPE,
       P_UAML_DEPT,
       P_UAML_PHONE1,
       P_UAML_PHONE2,
       P_UAML_MOBILE,
       P_UAML_FAX,
       P_UAML_EMAIL,
       P_UAML_ERROR
    );
    commit;
Exception
    When Others Then
        Pkg_Bdetail_Common.Sp_Insert_Warning(
           'USERMNG_SBS',
           'uamlog',
           sqlcode, sqlerrm,
           NULL,NULL,NULL,NULL);
        ROLLBACK;
END;



    Procedure GetErrCodeAndDescFromErrDef(
        l_errid         In      Varchar2,
        l_errd_code       Out     Varchar2,       --(100)
        l_errd_desc       Out     Varchar2        --(4000)
    )
    Is
    Begin
        Select errd_value1, errd_lang01
            Into l_errd_code, l_errd_desc
            From errdef
            Where errd_id = l_errid;
    End GetErrCodeAndDescFromErrDef;

    Procedure Create_User (
        p_ac_short      in      varchar2,
        p_ac_name       in      varchar2,
        p_ac_lang       in      varchar2,
        p_ac_comment    in      varchar2,
        p_ac_type       in      varchar2,
        p_ac_dept       in      varchar2,   -- 007SO
        p_adr_phone1    in      varchar2,
        p_adr_phone2    in      varchar2,
        p_adr_mobile    in      varchar2,
        p_adr_fax       in      varchar2,
        p_adr_email     in      varchar2
    )
    Is
        l_ProcName                  Varchar2(20) := g_ProcName_User_Create;
        l_AcId                      Varchar2(10);
        l_AdrId                     Varchar2(10);
        l_AcIdCurr                  Varchar2(10);
        l_errorcode                 Varchar2(10);
        l_errormsg                  Varchar2(500);
        l_returnstatus              Number(10);
        l_ac_state                  Varchar2(10) := 'A';
        l_adr_type                  Varchar2(10) := 'STD';
        l_adr_state                 Varchar2(10) := 'A';
        Exp_Duplicate_User_Id       Exception;
        Pragma Exception_Init(Exp_Duplicate_User_Id, -1);
        Exp_Null_User_Name          Exception;
        Pragma Exception_Init(Exp_Null_User_Name, -1400);
        l_errd_code                   Varchar2(100);
        l_errd_desc                   Varchar2(4000);
    Begin
        -- Create Account and its Address in one go (transaction)
        Select GenerateUniqueKey('G') Into l_AdrId From Dual;
        If Sql%NotFound Then
            -- Could not generate unique key for ADR_ID
            -- return error
            GetErrCodeAndDescFromErrDef(Err_Get_Unique_Address_Id, l_errd_code, l_errd_desc);
            uamlog (
                   p_ac_short,
                   l_ProcName ,
                   l_AcId,
                   p_ac_name,
                   p_ac_lang,
                   p_ac_comment,
                   p_ac_type,
                   p_ac_dept,
                   p_adr_phone1,
                   p_adr_phone2,
                   p_adr_mobile,
                   p_adr_fax,
                   p_adr_email,
                   l_errd_code
            ); -- 008SO
            raise_application_error( l_errd_code, l_errd_desc);
            l_AdrId := '';
        End If;
        If (Length(l_AdrId)>0) Then

            -- ?? Validate phone, mobile, fax, email based on rules in Web Module

            Insert Into Address (
                ADR_ID,
                ADR_ETID,
                ADR_DEMO,
                ADR_ESID,
                ADR_PHONE1,
                ADR_PHONE2,
                ADR_MOBILE,
                ADR_FAX,
                ADR_EMAIL,
                ADR_CHNGCNT
            )
            Values (
                l_AdrId,
                l_adr_type,
                0,
                l_adr_state,
                p_adr_phone1,
                p_adr_phone2,
                p_adr_mobile,
                p_adr_fax,
                p_adr_email,
                0
            );
            If (Sql%RowCount > 0) Then
                -- Address created successfully, now create the Account
                Select GenerateUniqueKey('G') Into l_AcId From Dual;
                If Sql%NotFound Then
                    -- Could not generate unique key for AC_ID
                    -- return error
                    GetErrCodeAndDescFromErrDef(Err_Get_Unique_Account_Id, l_errd_code, l_errd_desc);
                    uamlog (
                           p_ac_short,
                           l_ProcName ,
                           l_AcId,
                           p_ac_name,
                           p_ac_lang,
                           p_ac_comment,
                           p_ac_type,
                           p_ac_dept,
                           p_adr_phone1,
                           p_adr_phone2,
                           p_adr_mobile,
                           p_adr_fax,
                           p_adr_email,
                           l_errd_code
                    ); -- 008SO
                    raise_application_error( l_errd_code, l_errd_desc);
                    l_AcId := '';
                End If;
                If (Length(l_AcId) > 0) Then
                    l_AcIdCurr := GetCurrentUser();
                    Insert Into Account (
                        AC_ID,
                        AC_DEMO,
                        AC_LOGRET,
                        AC_VAT,
                        AC_CURRENCY,
                        AC_NAME,
                        AC_SHORT,
                        AC_LANGID,
                        AC_ETID,
                        AC_ESID,
                        AC_DEPT,            -- 007SO
                        AC_COMMENT,
                        AC_ADRID_MAIN,
                        AC_ACIDCRE,
                        AC_DATECRE,
                        AC_CHNGCNT
                    )
                    Values (
                        l_AcId,
                        0,
                        0,
                        0,
                        'CHF',
                        p_ac_name,
                        Upper(p_ac_short),
                        p_ac_lang,
                        p_ac_type,
                        l_ac_state,
                        p_ac_dept,          -- 007SO
                        p_ac_comment,
                        l_AdrId,
                        l_AcIdCurr,
                        sysdate,
                        0
                    );
                    If (Sql%RowCount > 0) Then
                        -- Account and Address, both created successfully
                        If bCreateIssueForAccAdrChange Then                     -- 004AA
                            -- create an issue to mark the creation of Account and its Address
                            Pkg_Admin_Common.sp_insert_issue('UPD', 'C',
                                    'New Account and its Address created', '', '',
                                    l_AcId, 'ADMIN', GetCurrentUser(),
                                    l_errorcode, l_errormsg, l_returnstatus);
                            -- IS_ACIDRESP = ? (centrum user provisioned in SBS)
                            -- IS_ACIDCRE = ? (centrum user provisioned in SBS)
                            If (l_returnstatus = 0) Then
                                -- Could not insert an issue for User_Create action
                                -- return error
                                GetErrCodeAndDescFromErrDef(Err_Cre_Issue_New_user, l_errd_code, l_errd_desc);
                                uamlog (
                                       p_ac_short,
                                       l_ProcName ,
                                       l_AcId,
                                       p_ac_name,
                                       p_ac_lang,
                                       p_ac_comment,
                                       p_ac_type,
                                       p_ac_dept,
                                       p_adr_phone1,
                                       p_adr_phone2,
                                       p_adr_mobile,
                                       p_adr_fax,
                                       p_adr_email,
                                       l_errd_code
                                ); -- 008SO
                                raise_application_error( l_errd_code, l_errd_desc);
                            End If;
                        End If;
                    Else
                        -- Could not create Account. Address created.
                        -- return error
                        GetErrCodeAndDescFromErrDef(Err_Cre_New_Account, l_errd_code, l_errd_desc);
                        uamlog (
                               p_ac_short,
                               l_ProcName ,
                               l_AcId,
                               p_ac_name,
                               p_ac_lang,
                               p_ac_comment,
                               p_ac_type,
                               p_ac_dept,
                               p_adr_phone1,
                               p_adr_phone2,
                               p_adr_mobile,
                               p_adr_fax,
                               p_adr_email,
                               l_errd_code
                        ); -- 008SO
                        raise_application_error( l_errd_code, l_errd_desc);
                    End If;
                Else
                    -- Could not generate unique key for AC_ID
                    -- return error
                    GetErrCodeAndDescFromErrDef(Err_Get_Unique_Account_Id, l_errd_code, l_errd_desc);
                    uamlog (
                           p_ac_short,
                           l_ProcName ,
                           l_AcId,
                           p_ac_name,
                           p_ac_lang,
                           p_ac_comment,
                           p_ac_type,
                           p_ac_dept,
                           p_adr_phone1,
                           p_adr_phone2,
                           p_adr_mobile,
                           p_adr_fax,
                           p_adr_email,
                           l_errd_code
                    ); -- 008SO
                    raise_application_error( l_errd_code, l_errd_desc);
                    l_AcId := '';
                End If;
            Else
                -- Could not create the main Address for new Account
                -- return error
                GetErrCodeAndDescFromErrDef(Err_Cre_New_Address, l_errd_code, l_errd_desc);
                uamlog (
                       p_ac_short,
                       l_ProcName ,
                       l_AcId,
                       p_ac_name,
                       p_ac_lang,
                       p_ac_comment,
                       p_ac_type,
                       p_ac_dept,
                       p_adr_phone1,
                       p_adr_phone2,
                       p_adr_mobile,
                       p_adr_fax,
                       p_adr_email,
                       l_errd_code
                ); -- 008SO
                raise_application_error( l_errd_code, l_errd_desc);
            End If;
        Else
            -- Could not generate unique key for ADR_ID
            -- return error
            GetErrCodeAndDescFromErrDef(Err_Get_Unique_Address_Id, l_errd_code, l_errd_desc);
            uamlog (
                   p_ac_short,
                   l_ProcName ,
                   l_AcId,
                   p_ac_name,
                   p_ac_lang,
                   p_ac_comment,
                   p_ac_type,
                   p_ac_dept,
                   p_adr_phone1,
                   p_adr_phone2,
                   p_adr_mobile,
                   p_adr_fax,
                   p_adr_email,
                   l_errd_code
            ); -- 008SO
            raise_application_error( l_errd_code, l_errd_desc);
            l_AdrId := '';
        End If;
        uamlog (
               p_ac_short,
               l_ProcName ,
               l_AcId,
               p_ac_name,
               p_ac_lang,
               p_ac_comment,
               p_ac_type,
               p_ac_dept,
               p_adr_phone1,
               p_adr_phone2,
               p_adr_mobile,
               p_adr_fax,
               p_adr_email,
               l_errd_code
        ); -- 008SO
        Commit;
    Exception
        When Exp_Duplicate_User_Id Then
            GetErrCodeAndDescFromErrDef(Err_Duplicate_User_Id, l_errd_code, l_errd_desc);
            uamlog (
                   p_ac_short,
                   l_ProcName ,
                   l_AcId,
                   p_ac_name,
                   p_ac_lang,
                   p_ac_comment,
                   p_ac_type,
                   p_ac_dept,
                   p_adr_phone1,
                   p_adr_phone2,
                   p_adr_mobile,
                   p_adr_fax,
                   p_adr_email,
                   l_errd_code
            ); -- 008SO
            raise_application_error( l_errd_code, l_errd_desc);
        When Others Then
            uamlog (
                   p_ac_short,
                   l_ProcName ,
                   l_AcId,
                   p_ac_name,
                   p_ac_lang,
                   p_ac_comment,
                   p_ac_type,
                   p_ac_dept,
                   p_adr_phone1,
                   p_adr_phone2,
                   p_adr_mobile,
                   p_adr_fax,
                   p_adr_email,
                   sqlcode
            ); -- 008SO
            Raise;
    End Create_User;

    Procedure Alter_User (
        p_ac_short      in      varchar2,
        p_ac_name       in      varchar2,
        p_ac_lang       in      varchar2,
        p_ac_comment    in      varchar2,
        p_ac_type       in      varchar2,
        p_ac_dept       in      varchar2,   -- 007SO
        p_adr_phone1    in      varchar2,
        p_adr_phone2    in      varchar2,
        p_adr_mobile    in      varchar2,
        p_adr_fax       in      varchar2,
        p_adr_email     in      varchar2
    )
    Is
        l_ProcName                  Varchar2(20) := g_ProcName_User_Alter;
        l_AcId                      Varchar2(10);
        l_AcAdrIdMain               Varchar2(10);
        l_AcEsid                    Varchar2(10);
        l_AcEtid                    Varchar2(10);
        l_AcIdCurr                  Varchar2(10);
        l_errorcode                 Varchar2(10);
        l_errormsg                  Varchar2(500);
        l_returnstatus              Number(10);
        Cursor cGetAccount(p_ac_short Varchar2) Is
            Select AC_ID, AC_ADRID_MAIN, AC_ESID, AC_ETID
                From Account
                Where AC_SHORT = p_ac_short;
        l_errd_code                   Varchar2(100);
        l_errd_desc                   Varchar2(4000);
    Begin
        l_AcIdCurr := GetCurrentUser();
        -- Check if the Account belonging to the given ShortId is updateable
        Open cGetAccount(p_ac_short);
        Fetch cGetAccount
            Into l_AcId, l_AcAdrIdMain, l_AcEsid, l_AcEtid;
        If cGetAccount%NotFound Then
            -- Account for the given ShortId not found
            -- return error
            GetErrCodeAndDescFromErrDef(Err_Account_Not_Found, l_errd_code, l_errd_desc);
            uamlog (
                   p_ac_short,
                   l_ProcName ,
                   l_AcId,
                   p_ac_name,
                   p_ac_lang,
                   p_ac_comment,
                   p_ac_type,
                   p_ac_dept,
                   p_adr_phone1,
                   p_adr_phone2,
                   p_adr_mobile,
                   p_adr_fax,
                   p_adr_email,
                   l_errd_code
            ); -- 008SO
            raise_application_error( l_errd_code, l_errd_desc);
        End If;
        Close cGetAccount;
        If (l_AcEsid Not In ('A','I')) Then
            -- Account can not be updated if state other than Active or Inactive
            -- return error
            GetErrCodeAndDescFromErrDef(Err_Upd_Account_State_Nok, l_errd_code, l_errd_desc);
            uamlog (
                   p_ac_short,
                   l_ProcName ,
                   l_AcId,
                   p_ac_name,
                   p_ac_lang,
                   p_ac_comment,
                   p_ac_type,
                   p_ac_dept,
                   p_adr_phone1,
                   p_adr_phone2,
                   p_adr_mobile,
                   p_adr_fax,
                   p_adr_email,
                   l_errd_code
            ); -- 008SO
            raise_application_error( l_errd_code, l_errd_desc ||' ('||l_AcEsid||')');
        End If;
        -- update account and its address
        Update Account Set
            AC_NAME     = Nvl(p_ac_name,AC_NAME),
            AC_LANGID   = Nvl(p_ac_lang,AC_LANGID),
            AC_ETID     = Nvl(p_ac_type,AC_ETID),
            AC_DEPT     = Nvl(p_ac_dept,AC_DEPT),           -- 007SO
            AC_COMMENT  = Nvl(p_ac_comment,AC_COMMENT),                         -- May overwrite Previous Ac_Short values! (see drop_user)
            AC_ACIDMOD  = l_AcIdCurr,
            AC_DATEMOD  = sysdate,
            AC_CHNGCNT  = Nvl(AC_CHNGCNT,0) + 1
        Where AC_SHORT = p_ac_short                                             -- AC_SHORT is unique indexed
        And AC_ESID In ('A','I');                                                      -- only active Accounts can be updated
        If (Sql%RowCount > 0) Then
            Update Address Set
                ADR_PHONE1      = Nvl(p_adr_phone1,ADR_PHONE1),
                ADR_PHONE2      = Nvl(p_adr_phone2,ADR_PHONE2),
                ADR_MOBILE      = Nvl(p_adr_mobile,ADR_MOBILE),
                ADR_FAX         = Nvl(p_adr_fax,ADR_FAX),
                ADR_EMAIL       = Nvl(p_adr_email,ADR_EMAIL),
                ADR_CHNGCNT     = ADR_CHNGCNT + 1
            Where ADR_ID = l_AcAdrIdMain;
            If (Sql%RowCount > 0) Then
                -- Successful Update
                If bCreateIssueForAccAdrChange Then                             -- 004AA
                    -- create an issue to mark the update of Account and its Address
                    Pkg_Admin_Common.sp_insert_issue('UPD', 'C',
                            'New Account and its Address updated', '', '',
                            l_AcId, 'ADMIN', GetCurrentUser(),
                            l_errorcode, l_errormsg, l_returnstatus);
                    -- IS_ACIDRESP = ? (centrum user provisioned in SBS)
                    -- IS_ACIDCRE = ? (centrum user provisioned in SBS)
                    If (l_returnstatus = 0) Then
                        -- Could not insert an issue for User_Create action
                        -- return error
                        GetErrCodeAndDescFromErrDef(Err_Cre_Issue_Upd_User, l_errd_code, l_errd_desc);
                        uamlog (
                               p_ac_short,
                               l_ProcName ,
                               l_AcId,
                               p_ac_name,
                               p_ac_lang,
                               p_ac_comment,
                               p_ac_type,
                               p_ac_dept,
                               p_adr_phone1,
                               p_adr_phone2,
                               p_adr_mobile,
                               p_adr_fax,
                               p_adr_email,
                               l_errd_code
                        ); -- 008SO
                        raise_application_error( l_errd_code, l_errd_desc);
                    End If;
                End If;
            Else
                -- Error updating Address
                -- return error
                GetErrCodeAndDescFromErrDef(Err_Upd_Address, l_errd_code, l_errd_desc);
                uamlog (
                       p_ac_short,
                       l_ProcName ,
                       l_AcId,
                       p_ac_name,
                       p_ac_lang,
                       p_ac_comment,
                       p_ac_type,
                       p_ac_dept,
                       p_adr_phone1,
                       p_adr_phone2,
                       p_adr_mobile,
                       p_adr_fax,
                       p_adr_email,
                       l_errd_code
                ); -- 008SO
                raise_application_error( l_errd_code, l_errd_desc);
            End If;
        Else
            -- Error updating Account
            -- return error
            GetErrCodeAndDescFromErrDef(Err_Upd_Account, l_errd_code, l_errd_desc);
            uamlog (
                   p_ac_short,
                   l_ProcName ,
                   l_AcId,
                   p_ac_name,
                   p_ac_lang,
                   p_ac_comment,
                   p_ac_type,
                   p_ac_dept,
                   p_adr_phone1,
                   p_adr_phone2,
                   p_adr_mobile,
                   p_adr_fax,
                   p_adr_email,
                   l_errd_code
            ); -- 008SO
            raise_application_error( l_errd_code, l_errd_desc);
        End If;
        uamlog (
           p_ac_short,
           l_ProcName ,
           l_AcId,
           p_ac_name,
           p_ac_lang,
           p_ac_comment,
           p_ac_type,
           p_ac_dept,
           p_adr_phone1,
           p_adr_phone2,
           p_adr_mobile,
           p_adr_fax,
           p_adr_email,
           l_errd_code
        ); -- 008SO
       Commit;
    Exception
        When Others Then
            uamlog (
                   p_ac_short,
                   l_ProcName ,
                   l_AcId,
                   p_ac_name,
                   p_ac_lang,
                   p_ac_comment,
                   p_ac_type,
                   p_ac_dept,
                   p_adr_phone1,
                   p_adr_phone2,
                   p_adr_mobile,
                   p_adr_fax,
                   p_adr_email,
                   sqlcode
            ); -- 008SO
            Raise;
    End Alter_User;

    Procedure Drop_User (
        p_ac_short      in      varchar2
    )
    Is
        l_ProcName                  Varchar2(20) := g_ProcName_User_Drop;
        l_AcId                      Varchar2(10);
        l_AcIdCurr                  Varchar2(10);
        l_errorcode                 Varchar2(10);
        l_errormsg                  Varchar2(500);
        l_returnstatus              Number(10);
        l_errd_code                   Varchar2(100);
        l_errd_desc                   Varchar2(4000);
    Begin
        l_AcIdCurr := GetCurrentUser();
        l_AcId := GetAcId(p_ac_short);  -- 009SO
        Update Account Set
            AC_ESID     = 'D',
            AC_SHORT    = AC_ID,
            AC_COMMENT  = AC_COMMENT || 'Previous Id:' || AC_SHORT,
            AC_ACIDMOD  = l_AcIdCurr,
            AC_DATEMOD  = sysdate,
            AC_CHNGCNT  = AC_CHNGCNT + 1
        Where AC_SHORT = p_ac_short                                             -- AC_SHORT is unique indexed
        And AC_ESID IN ('A','I');                                               -- Allow deletion for active and locked Accounts only
                                                                                -- Account once soft-deleted can not recovered
                                                                                -- except by DBA by doing a direct table update
        If (Sql%RowCount > 0) Then
            -- Account soft-deleted successfully
            If bCreateIssueForAccAdrChange Then                                 -- 004AA
                -- create an issue to mark the soft-deleting of the Account
                Pkg_Admin_Common.sp_insert_issue('UPD', 'C',
                        'Account deleted', '', '',
                        l_AcId, 'ADMIN', GetCurrentUser(),
                        l_errorcode, l_errormsg, l_returnstatus);
                -- IS_ACIDRESP = ? (centrum user provisioned in SBS)
                -- IS_ACIDCRE = ? (centrum user provisioned in SBS)
                If (l_returnstatus = 0) Then
                    -- Could not insert an issue for User_Create action
                    -- return error
                    GetErrCodeAndDescFromErrDef(Err_Cre_Issue_Del_User, l_errd_code, l_errd_desc);
                    uamlog (
                       p_ac_short,
                       l_ProcName ,
                       l_AcId,
                       NULL, -- p_ac_name,
                       NULL, -- p_ac_lang,
                       NULL, -- p_ac_comment,
                       NULL, -- p_ac_type,
                       NULL, -- p_ac_dept,
                       NULL, -- p_adr_phone1,
                       NULL, -- p_adr_phone2,
                       NULL, -- p_adr_mobile,
                       NULL, -- p_adr_fax,
                       NULL, -- p_adr_email,
                       l_errd_code
                    ); -- 008SO
                    raise_application_error( l_errd_code, l_errd_desc);
                End If;
            End If;
        Else
            -- Account with given Short value not found, or could not be updated
            -- return error
            GetErrCodeAndDescFromErrDef(Err_Account_Not_Found, l_errd_code, l_errd_desc);
            uamlog (
               p_ac_short,
               l_ProcName ,
               l_AcId,
               NULL, -- p_ac_name,
               NULL, -- p_ac_lang,
               NULL, -- p_ac_comment,
               NULL, -- p_ac_type,
               NULL, -- p_ac_dept,
               NULL, -- p_adr_phone1,
               NULL, -- p_adr_phone2,
               NULL, -- p_adr_mobile,
               NULL, -- p_adr_fax,
               NULL, -- p_adr_email,
               l_errd_code
            ); -- 008SO
            raise_application_error( l_errd_code, l_errd_desc);
        End If;
        uamlog (
           p_ac_short,
           l_ProcName ,
           l_AcId,
           NULL, -- p_ac_name,
           NULL, -- p_ac_lang,
           NULL, -- p_ac_comment,
           NULL, -- p_ac_type,
           NULL, -- p_ac_dept,
           NULL, -- p_adr_phone1,
           NULL, -- p_adr_phone2,
           NULL, -- p_adr_mobile,
           NULL, -- p_adr_fax,
           NULL, -- p_adr_email,
           l_errd_code
        ); -- 008SO
        Commit;
    Exception
        When Others Then
            uamlog (
               p_ac_short,
               l_ProcName ,
               l_AcId,
               NULL, -- p_ac_name,
               NULL, -- p_ac_lang,
               NULL, -- p_ac_comment,
               NULL, -- p_ac_type,
               NULL, -- p_ac_dept,
               NULL, -- p_adr_phone1,
               NULL, -- p_adr_phone2,
               NULL, -- p_adr_mobile,
               NULL, -- p_adr_fax,
               NULL, -- p_adr_email,
               sqlcode
            ); -- 008SO
            Raise;
    End Drop_User;

    Procedure Lock_User (
        p_ac_short      in      varchar2
    )
    Is
        l_ProcName                  Varchar2(20) := g_ProcName_User_Lock;
        l_AcId                      Varchar2(10);
        l_AcIdCurr                  Varchar2(10);
        l_errorcode                 Varchar2(10);
        l_errormsg                  Varchar2(500);
        l_returnstatus              Number(10);
        l_errd_code                   Varchar2(100);
        l_errd_desc                   Varchar2(4000);
    Begin
        l_AcIdCurr := GetCurrentUser();
        l_AcId := GetAcId(p_ac_short);  -- 009SO
        -- Set the account state to Active to Unlocked the Account
        Update Account Set
            AC_ESID     = 'I',
            AC_ACIDMOD  = l_AcIdCurr,
            AC_DATEMOD  = sysdate,
            AC_CHNGCNT  = AC_CHNGCNT + 1
        Where AC_SHORT = p_ac_short                                             -- AC_SHORT is unique indexed
        And AC_ESID IN ('A');                                                   -- Allow locking of active Accounts only
        If (Sql%RowCount > 0) Then
            -- Account status set to Inactive (locked) successfully
            If bCreateIssueForAccAdrChange Then                                 -- 004AA
                -- create an issue to mark the lcoking of the Account
                Pkg_Admin_Common.sp_insert_issue('UPD', 'C',
                        'Account deleted', '', '',
                        l_AcId, 'ADMIN', GetCurrentUser(),
                        l_errorcode, l_errormsg, l_returnstatus);
                -- IS_ACIDRESP = ? (centrum user provisioned in SBS)
                -- IS_ACIDCRE = ? (centrum user provisioned in SBS)
                If (l_returnstatus = 0) Then
                    -- Could not insert an issue for User_Create action
                    -- return error
                    GetErrCodeAndDescFromErrDef(Err_Cre_Issue_Lck_User, l_errd_code, l_errd_desc);
                    uamlog (
                       p_ac_short,
                       l_ProcName ,
                       l_AcId,
                       NULL, -- p_ac_name,
                       NULL, -- p_ac_lang,
                       NULL, -- p_ac_comment,
                       NULL, -- p_ac_type,
                       NULL, -- p_ac_dept,
                       NULL, -- p_adr_phone1,
                       NULL, -- p_adr_phone2,
                       NULL, -- p_adr_mobile,
                       NULL, -- p_adr_fax,
                       NULL, -- p_adr_email,
                       l_errd_code
                    ); -- 008SO
                    raise_application_error( l_errd_code, l_errd_desc);
                End If;
            End If;
        Else
            -- Account with given Short value not found, or could not be updated
            -- return error (same as in User_UnLock procedure)
            GetErrCodeAndDescFromErrDef(Err_Account_Not_Found, l_errd_code, l_errd_desc);
            uamlog (
               p_ac_short,
               l_ProcName ,
               l_AcId,
               NULL, -- p_ac_name,
               NULL, -- p_ac_lang,
               NULL, -- p_ac_comment,
               NULL, -- p_ac_type,
               NULL, -- p_ac_dept,
               NULL, -- p_adr_phone1,
               NULL, -- p_adr_phone2,
               NULL, -- p_adr_mobile,
               NULL, -- p_adr_fax,
               NULL, -- p_adr_email,
               l_errd_code
            ); -- 008SO
            raise_application_error( l_errd_code, l_errd_desc);
        End If;
        uamlog (
           p_ac_short,
           l_ProcName ,
           l_AcId,
           NULL, -- p_ac_name,
           NULL, -- p_ac_lang,
           NULL, -- p_ac_comment,
           NULL, -- p_ac_type,
           NULL, -- p_ac_dept,
           NULL, -- p_adr_phone1,
           NULL, -- p_adr_phone2,
           NULL, -- p_adr_mobile,
           NULL, -- p_adr_fax,
           NULL, -- p_adr_email,
           l_errd_code
        ); -- 008SO
        Commit;
    Exception
        When Others Then
            uamlog (
               p_ac_short,
               l_ProcName ,
               l_AcId,
               NULL, -- p_ac_name,
               NULL, -- p_ac_lang,
               NULL, -- p_ac_comment,
               NULL, -- p_ac_type,
               NULL, -- p_ac_dept,
               NULL, -- p_adr_phone1,
               NULL, -- p_adr_phone2,
               NULL, -- p_adr_mobile,
               NULL, -- p_adr_fax,
               NULL, -- p_adr_email,
               sqlcode
            ); -- 008SO
            Raise;
    End Lock_User;

    Procedure Unlock_User (
        p_ac_short      in      varchar2
    )
    Is
        l_ProcName                  Varchar2(20) := g_ProcName_User_UnLock;
        l_AcId                      Varchar2(10);
        l_AcIdCurr                  Varchar2(10);
        l_errorcode                 Varchar2(10);
        l_errormsg                  Varchar2(500);
        l_returnstatus              Number(10);
        l_errd_code                   Varchar2(100);
        l_errd_desc                   Varchar2(4000);
    Begin
        l_AcIdCurr := GetCurrentUser();
        l_AcId := GetAcId(p_ac_short);  -- 009SO
        -- Set the account state to Inactive to enforce Locked-Out Account
        Update Account Set
            AC_ESID     = 'A',
            AC_ACIDMOD  = l_AcIdCurr,
            AC_DATEMOD  = sysdate,
            AC_CHNGCNT  = AC_CHNGCNT + 1
        Where AC_SHORT = p_ac_short                                             -- AC_SHORT is unique indexed
        And AC_ESID IN ('I');                                                   -- Only Locked Accounts can be Unlocked
                                                                                -- Should not include 'D' or any other state
        If (Sql%RowCount > 0) Then
            -- Account status set to Active (unlocked) successfully
            If bCreateIssueForAccAdrChange Then                                 -- 004AA
                -- create an issue to mark the unlocking of the Account
                Pkg_Admin_Common.sp_insert_issue('UPD', 'C',
                        'Account deleted', '', '',
                        l_AcId, 'ADMIN', GetCurrentUser(),
                        l_errorcode, l_errormsg, l_returnstatus);
                -- IS_ACIDRESP = ? (centrum user provisioned in SBS)
                -- IS_ACIDCRE = ? (centrum user provisioned in SBS)
                If (l_returnstatus = 0) Then
                    -- Could not insert an issue for User_Create action
                    -- return error
                    GetErrCodeAndDescFromErrDef(Err_Cre_Issue_Ulk_User, l_errd_code, l_errd_desc);
                    uamlog (
                       p_ac_short,
                       l_ProcName ,
                       l_AcId,
                       NULL, -- p_ac_name,
                       NULL, -- p_ac_lang,
                       NULL, -- p_ac_comment,
                       NULL, -- p_ac_type,
                       NULL, -- p_ac_dept,
                       NULL, -- p_adr_phone1,
                       NULL, -- p_adr_phone2,
                       NULL, -- p_adr_mobile,
                       NULL, -- p_adr_fax,
                       NULL, -- p_adr_email,
                       l_errd_code
                    ); -- 008SO
                    raise_application_error( l_errd_code, l_errd_desc);
                End If;
            End If;
        Else
            -- Account with given Short value not found, or could not be updated
            -- return error (same as in User_Lock procedure)
            GetErrCodeAndDescFromErrDef(Err_Account_Not_Found, l_errd_code, l_errd_desc);
            uamlog (
               p_ac_short,
               l_ProcName ,
               l_AcId,
               NULL, -- p_ac_name,
               NULL, -- p_ac_lang,
               NULL, -- p_ac_comment,
               NULL, -- p_ac_type,
               NULL, -- p_ac_dept,
               NULL, -- p_adr_phone1,
               NULL, -- p_adr_phone2,
               NULL, -- p_adr_mobile,
               NULL, -- p_adr_fax,
               NULL, -- p_adr_email,
               l_errd_code
            ); -- 008SO
            raise_application_error( l_errd_code, l_errd_desc);
        End If;
        uamlog (
           p_ac_short,
           l_ProcName ,
           l_AcId,
           NULL, -- p_ac_name,
           NULL, -- p_ac_lang,
           NULL, -- p_ac_comment,
           NULL, -- p_ac_type,
           NULL, -- p_ac_dept,
           NULL, -- p_adr_phone1,
           NULL, -- p_adr_phone2,
           NULL, -- p_adr_mobile,
           NULL, -- p_adr_fax,
           NULL, -- p_adr_email,
           l_errd_code
        ); -- 008SO
        Commit;
    Exception
        When Others Then
            uamlog (
               p_ac_short,
               l_ProcName ,
               l_AcId,
               NULL, -- p_ac_name,
               NULL, -- p_ac_lang,
               NULL, -- p_ac_comment,
               NULL, -- p_ac_type,
               NULL, -- p_ac_dept,
               NULL, -- p_adr_phone1,
               NULL, -- p_adr_phone2,
               NULL, -- p_adr_mobile,
               NULL, -- p_adr_fax,
               NULL, -- p_adr_email,
               sqlcode
            ); -- 008SO
            Raise;
    End Unlock_User;

    Procedure Upd_Group_Conn (
        p_ac_short      in      varchar2,
        p_ac_type       in      varchar2
    )
    Is
        l_ProcName                  Varchar2(20) := g_ProcName_User_UpdateGroup;
        l_AcId                      Varchar2(10);
        l_AcIdCurr                  Varchar2(10);
        l_errorcode                 Varchar2(10);
        l_errormsg                  Varchar2(500);
        l_returnstatus              Number(10);
        Cursor cGetAccount(p_ac_short Varchar2, p_ac_type Varchar2) Is
            Select AC_ID
                From Account
                Where AC_SHORT = p_ac_short
                And AC_ETID = p_ac_type;
        l_errd_code                   Varchar2(100);
        l_errd_desc                   Varchar2(4000);

    Begin
        l_AcIdCurr := GetCurrentUser();
        l_AcId := GetAcId(p_ac_short);  -- 009SO
        -- Check if the Account belongs to the same Type itself
        Open cGetAccount(p_ac_short, p_ac_type);
        Fetch cGetAccount Into l_AcId;
        If cGetAccount%NotFound Then
            -- If not, update the Ac_type
            Update Account Set
                AC_ETID     = p_ac_type,
                AC_ACIDMOD  = l_AcIdCurr,
                AC_DATEMOD  = sysdate,
                AC_CHNGCNT  = AC_CHNGCNT + 1
            Where AC_SHORT = p_ac_short                                         -- AC_SHORT is unique indexed
            And AC_ETID <> p_ac_type;
            l_AcId := GetAcId(p_ac_short);  -- 009SO                            -- If not already in same group
            If (Sql%RowCount > 0) Then
                -- Account's type updated successfully
                If bCreateIssueForAccAdrChange Then                             -- 004AA
                    -- create an issue to mark the update of Account's Type
                    Pkg_Admin_Common.sp_insert_issue('UPD', 'C',
                            'Account deleted', '', '',
                            l_AcId, 'ADMIN', GetCurrentUser(),
                            l_errorcode, l_errormsg, l_returnstatus);
                    -- IS_ACIDRESP = ? (centrum user provisioned in SBS)
                    -- IS_ACIDCRE = ? (centrum user provisioned in SBS)
                    If (l_returnstatus = 0) Then
                        -- Could not insert an issue for User_Create action
                        -- return error
                        GetErrCodeAndDescFromErrDef(Err_Cre_Issue_Grp_User, l_errd_code, l_errd_desc);
                        uamlog (
                           p_ac_short,
                           l_ProcName ,
                           l_AcId,
                           NULL, -- p_ac_name,
                           NULL, -- p_ac_lang,
                           NULL, -- p_ac_comment,
                           p_ac_type,
                           NULL, -- p_ac_dept,
                           NULL, -- p_adr_phone1,
                           NULL, -- p_adr_phone2,
                           NULL, -- p_adr_mobile,
                           NULL, -- p_adr_fax,
                           NULL, -- p_adr_email,
                           l_errd_code
                        ); -- 008SO
                        raise_application_error( l_errd_code, l_errd_desc);
                    End If;
                End If;
            Else
                -- Account with given Short value not found
                -- return error
                GetErrCodeAndDescFromErrDef(Err_Account_Not_Found, l_errd_code, l_errd_desc);
                uamlog (
                   p_ac_short,
                   l_ProcName ,
                   l_AcId,
                   NULL, -- p_ac_name,
                   NULL, -- p_ac_lang,
                   NULL, -- p_ac_comment,
                   p_ac_type,
                   NULL, -- p_ac_dept,
                   NULL, -- p_adr_phone1,
                   NULL, -- p_adr_phone2,
                   NULL, -- p_adr_mobile,
                   NULL, -- p_adr_fax,
                   NULL, -- p_adr_email,
                   l_errd_code
                ); -- 008SO
                raise_application_error( l_errd_code, l_errd_desc);
            End If;
        Else
            -- Account already belongs to the given Group
            -- No updated needed
            Null;
        End If;
        Close cGetAccount;
        uamlog (
           p_ac_short,
           l_ProcName ,
           l_AcId,
           NULL, -- p_ac_name,
           NULL, -- p_ac_lang,
           NULL, -- p_ac_comment,
           p_ac_type,
           NULL, -- p_ac_dept,
           NULL, -- p_adr_phone1,
           NULL, -- p_adr_phone2,
           NULL, -- p_adr_mobile,
           NULL, -- p_adr_fax,
           NULL, -- p_adr_email,
           l_errd_code
        ); -- 008SO
        Commit;
    Exception
        When Others Then
            uamlog (
               p_ac_short,
               l_ProcName ,
               l_AcId,
               NULL, -- p_ac_name,
               NULL, -- p_ac_lang,
               NULL, -- p_ac_comment,
               p_ac_type,
               NULL, -- p_ac_dept,
               NULL, -- p_adr_phone1,
               NULL, -- p_adr_phone2,
               NULL, -- p_adr_mobile,
               NULL, -- p_adr_fax,
               NULL, -- p_adr_email,
               sqlcode
            ); -- 008SO
            Raise;
    End Upd_Group_Conn;

    Procedure Insert_Group_Conn (
        p_ac_short      in      varchar2,
        p_ac_type       in      varchar2
    )
    Is
    Begin
        Upd_Group_Conn (
            p_ac_short,
            p_ac_type
        );
    End;

END UserMng_Sbs;    -- Package Body
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- CONFIGURE_FOR_TEST  (Procedure) 
--
CREATE OR REPLACE PROCEDURE SBS1_ADMIN.CONFIGURE_FOR_TEST
   IS
-- MODIFICATION HISTORY
-- ---------    ------      -------------------------------------------
-- Person       Date        Comments
-- SO           06.11.2006  Created
-- SO           27.10.2008  Remove MMSVAS Provisioning sections
-- SO           27.10.2008  Add MMSC Provisioning sections
-- SO           27.10.2008  Add SMCH30, CMCH80, SMCH90
-- 001SO        15.07.2010  Reset Cleanup and refresh
-- 002SO        09.07.2010  Enabling test Mapping for SMCH30
-- 003SO        25.08.2010  Adapt to new NAS paths
-- 004SO        01.03.2012  Remove S B S 0 and CAT Code
-- 005SO        19.03.2012  Correct MUS eMail Address
-- 006SO        12.07.2012  Adapt to Exadata environment
-- 007SO        08.01.2014  Truncate log and debug tables
-- 008SO        08.01.2014  Delete provisioning states for production platforms
-- 009SO        08.04.2014  Correct NAS paths for production and test
-- 010SO        18.07.2016  Changes brought in with Ora12c tests
-- 011SO        17.01.2018  Point to new NAS path
-- 012SO        17.10.2018  Remove REFERENCES to ENPLATFORM

    c_prod_nas_path     VARCHAR2(100) := '\sbs-prod\';  -- 011SO -- 010SO -- 009SO -- 006SO -- 003SO
    c_test_nas_path     VARCHAR2(100) := '\sbs-stag\';  -- 011SO -- 010SO -- 009SO -- 006SO -- 003SO

BEGIN

-- RETURN;     -- comment out this line to use the procedure

UPDATE PACKING SET PAC_ESID = 'I'
WHERE PAC_ESID = 'A'
;   -- 004SO

UPDATE PACKING SET
    PAC_OUTPUTDIR = REPLACE (PAC_OUTPUTDIR,c_prod_nas_path,c_test_nas_path),
    PAC_ARCHIVEDIR = REPLACE (PAC_ARCHIVEDIR,c_prod_nas_path,c_test_nas_path)
;   -- 006SO-- 004SO -- 003SO

UPDATE PACKING SET
    PAC_ARCHIVEDIR = NULL,
    PAC_ARCHIVESTATISTIC = 0
WHERE PAC_ARCHIVEDIR Not Like c_test_nas_path || '%'
;   -- 006SO

UPDATE NOTIFICATIONTEMPL SET
NOT_ADRTO = 'paul.marty@swisscom.com;MUS-LU.Mobile-Net@swisscom.com',
NOT_ADRCC = NULL,
NOT_ADRBCC = NULL
;   -- 005SO -- 004SO

UPDATE STA_CONFIG SET
STAC_ARCHIVEDIR = REPLACE (STAC_ARCHIVEDIR,c_prod_nas_path,c_test_nas_path)
;   -- 006SO-- 004SO -- 003SO

UPDATE STA_CONFIG SET
STAC_ARCHIVEDIR = REPLACE (STAC_ARCHIVEDIR,c_prod_nas_path,c_test_nas_path)
;   -- 006SO-- 004SO

UPDATE STA_DIRECTORY SET
STAD_PATH = REPLACE (STAD_PATH,c_prod_nas_path,c_test_nas_path),
STAD_MOVER = REPLACE (STAD_MOVER,c_prod_nas_path,c_test_nas_path)
;   -- 006SO-- 004SO -- 003SO

UPDATE STA_DIRECTORY SET
STAD_PATH = REPLACE (STAD_PATH,c_prod_nas_path,c_test_nas_path),
STAD_MOVER = REPLACE (STAD_MOVER,c_prod_nas_path,c_test_nas_path)
;   -- 006SO-- 004SO

COMMIT WORK;

RETURN;     -- comment out this line to use the procedure
-- 007SO

EXECUTE IMMEDIATE 'truncate table BDETAIL';
EXECUTE IMMEDIATE 'truncate table BDETAIL1';
EXECUTE IMMEDIATE 'truncate table BDETAIL2';
EXECUTE IMMEDIATE 'truncate table BDETAIL4';
EXECUTE IMMEDIATE 'truncate table BDETAIL6';
EXECUTE IMMEDIATE 'truncate table BDETAIL7';
EXECUTE IMMEDIATE 'truncate table BDETAIL9';
EXECUTE IMMEDIATE 'truncate table REVI_CONTENT_DEL';
EXECUTE IMMEDIATE 'truncate table REVI_CONTENT_SUB';
EXECUTE IMMEDIATE 'truncate table REVI_MMS';
EXECUTE IMMEDIATE 'truncate table REVI_PRE';
EXECUTE IMMEDIATE 'truncate table REVI_SMS';
EXECUTE IMMEDIATE 'truncate table REVIPRE_MMS';
EXECUTE IMMEDIATE 'truncate table REVIPRE_SMS';
EXECUTE IMMEDIATE 'truncate table SMS_IW_MT_ARCH';

EXECUTE IMMEDIATE 'TRUNCATE TABLE LOG_DEBUG';
EXECUTE IMMEDIATE 'truncate table REVA_DEBUG';
EXECUTE IMMEDIATE 'truncate table STA_DEBUG';
EXECUTE IMMEDIATE 'TRUNCATE TABLE WARNING';
EXECUTE IMMEDIATE 'TRUNCATE TABLE TEST';
EXECUTE IMMEDIATE 'truncate table TEST1';
EXECUTE IMMEDIATE 'TRUNCATE TABLE SCRIPT';

EXECUTE IMMEDIATE 'truncate table ALL_CC_NDC';
EXECUTE IMMEDIATE 'truncate table ALL_MCC_MNC';
EXECUTE IMMEDIATE 'truncate table CODE';
EXECUTE IMMEDIATE 'truncate table CONIOTE';
EXECUTE IMMEDIATE 'truncate table PROXY';
EXECUTE IMMEDIATE 'truncate table SRAS';

EXECUTE IMMEDIATE 'truncate table IMSIRANGE';
EXECUTE IMMEDIATE 'truncate table IRANGE';
EXECUTE IMMEDIATE 'truncate table KEYWORD';
EXECUTE IMMEDIATE 'truncate table LONGIDHISTDET';
EXECUTE IMMEDIATE 'truncate table LONGIDMAP';
EXECUTE IMMEDIATE 'truncate table MMSCADD';
EXECUTE IMMEDIATE 'truncate table MMSPRICE';
EXECUTE IMMEDIATE 'truncate table MMSRPRICE';
EXECUTE IMMEDIATE 'truncate table NBRRANGE';
EXECUTE IMMEDIATE 'truncate table NUMBERRANGE';

EXECUTE IMMEDIATE 'truncate table PRMODELENTRY';
EXECUTE IMMEDIATE 'truncate table PRMODELVERTRANS';
EXECUTE IMMEDIATE 'truncate table SBS0_STATS';

EXECUTE IMMEDIATE 'truncate table STA_JOBANALYZE';
EXECUTE IMMEDIATE 'truncate table STA_JOBOUTPUT';
EXECUTE IMMEDIATE 'truncate table STA_JOBPARAM';
EXECUTE IMMEDIATE 'truncate table STA_JOBSQL';
EXECUTE IMMEDIATE 'truncate table UAMLOG';

EXECUTE IMMEDIATE 'truncate table BDCONSOLIDATION';
EXECUTE IMMEDIATE 'truncate table ROCONSOLIDATION';
EXECUTE IMMEDIATE 'truncate table DGTICONSOL';
EXECUTE IMMEDIATE 'truncate table OGTICONSOL';
EXECUTE IMMEDIATE 'truncate table MMSCONSOLIDATION';
EXECUTE IMMEDIATE 'truncate table TPMCONSOL';
EXECUTE IMMEDIATE 'truncate table TPMCONSOL_BAD';
EXECUTE IMMEDIATE 'truncate table TRCONSOL';
EXECUTE IMMEDIATE 'truncate table IWOCOUNTER';
EXECUTE IMMEDIATE 'truncate table IWTCOUNTER';
EXECUTE IMMEDIATE 'truncate table REVA_COUNTER';
EXECUTE IMMEDIATE 'truncate table ISCONSOL';
EXECUTE IMMEDIATE 'truncate table ISMSTAT';
EXECUTE IMMEDIATE 'truncate table ISSUE';
EXECUTE IMMEDIATE 'truncate table ISC_AGGREGATION';
EXECUTE IMMEDIATE 'truncate table SETDETAIL';
EXECUTE IMMEDIATE 'truncate table RACACHE';

EXECUTE IMMEDIATE 'alter table STA_JOBSQL disable constraint FK_STA_JOBS_REF_JOBSQ_STA_JOB';
EXECUTE IMMEDIATE 'alter table STA_JOBOUTPUT disable constraint FK_STA_JOBO_REF_STAJO_STA_JOB';
EXECUTE IMMEDIATE 'alter table STA_JOBPARAM disable constraint FK_STA_JOBP_REF_JOBJO_STA_JOB';
EXECUTE IMMEDIATE 'truncate table STA_JOB';
EXECUTE IMMEDIATE 'alter table STA_JOBSQL enable constraint FK_STA_JOBS_REF_JOBSQ_STA_JOB';
EXECUTE IMMEDIATE 'alter table STA_JOBOUTPUT enable constraint FK_STA_JOBO_REF_STAJO_STA_JOB';
EXECUTE IMMEDIATE 'alter table STA_JOBPARAM enable constraint FK_STA_JOBP_REF_JOBJO_STA_JOB';

EXECUTE IMMEDIATE 'alter table SETDETAIL disable constraint FK_SETDETAI_REF_1892_SETTLING';
EXECUTE IMMEDIATE 'alter table SETTLING disable constraint FK_SETTLING_REF_1145_SETTLING';
EXECUTE IMMEDIATE 'truncate table SETTLING';
EXECUTE IMMEDIATE 'alter table SETDETAIL enable constraint FK_SETDETAI_REF_1892_SETTLING';
EXECUTE IMMEDIATE 'alter table SETTLING enable constraint FK_SETTLING_REF_1145_SETTLING';

EXECUTE IMMEDIATE 'alter table PRMODELENTRY disable constraint FK_PRMODELE_REF_131_PRMODELV';
EXECUTE IMMEDIATE 'alter table SETDETAIL disable constraint FK_SETDETAI_REF_24272_PRMODELV';
EXECUTE IMMEDIATE 'alter table BDCONSOLIDATION disable constraint FK_BDCONSOL_REF_24261_PRMODELV';
EXECUTE IMMEDIATE 'alter table PRMODELVERTRANS disable constraint FK_PRMODELV_REF_20126_PRMODELV';
EXECUTE IMMEDIATE 'alter table BDETAIL disable constraint FK_BDETAIL_REF_119_PRMODELV';
EXECUTE IMMEDIATE 'truncate table PRMODELVER';
EXECUTE IMMEDIATE 'alter table PRMODELENTRY enable constraint FK_PRMODELE_REF_131_PRMODELV';
EXECUTE IMMEDIATE 'alter table SETDETAIL enable constraint FK_SETDETAI_REF_24272_PRMODELV';
EXECUTE IMMEDIATE 'alter table BDCONSOLIDATION enable constraint FK_BDCONSOL_REF_24261_PRMODELV';
EXECUTE IMMEDIATE 'alter table PRMODELVERTRANS enable constraint FK_PRMODELV_REF_20126_PRMODELV';
EXECUTE IMMEDIATE 'alter table BDETAIL enable constraint FK_BDETAIL_REF_119_PRMODELV';

EXECUTE IMMEDIATE 'truncate table CONTENTSERVICE';

EXECUTE IMMEDIATE 'alter table CONIOTE disable constraint FK_CONIOTE_REFER_418_CONIOT';
EXECUTE IMMEDIATE 'truncate table CONIOT';
EXECUTE IMMEDIATE 'alter table CONIOTE enable constraint FK_CONIOTE_REFER_418_CONIOT';

EXECUTE IMMEDIATE 'alter table CONTENTSERVICE disable constraint FK_CONTENTS_REFE_377_CONTRACT';
EXECUTE IMMEDIATE 'alter table CONIOT disable constraint FK_CONIOT_REFE_419_CONTRACT';
EXECUTE IMMEDIATE 'alter table ISSUE disable constraint FK_ISSUE_REF_44635_CONTRACT';
EXECUTE IMMEDIATE 'alter table KEYWORD disable constraint FK_KEYWORD_REF_57110_CONTRACT';
EXECUTE IMMEDIATE 'alter table MMSCADD disable constraint FK_MMSCADD_REF_30882_CONTRACT';
EXECUTE IMMEDIATE 'alter table SETTLING disable constraint FK_SETTLING_REF_1142_CONTRACT';
EXECUTE IMMEDIATE 'truncate table CONTRACT';
EXECUTE IMMEDIATE 'alter table CONTENTSERVICE enable constraint FK_CONTENTS_REFE_377_CONTRACT';
EXECUTE IMMEDIATE 'alter table CONIOT enable constraint FK_CONIOT_REFE_419_CONTRACT';
EXECUTE IMMEDIATE 'alter table ISSUE enable constraint FK_ISSUE_REF_44635_CONTRACT';
EXECUTE IMMEDIATE 'alter table KEYWORD enable constraint FK_KEYWORD_REF_57110_CONTRACT';
EXECUTE IMMEDIATE 'alter table SETTLING enable constraint FK_SETTLING_REF_1142_CONTRACT';

EXECUTE IMMEDIATE 'alter table PRMODELVER disable constraint FK_PRMODELV_REF_122_PRMODEL';
EXECUTE IMMEDIATE 'alter table CONTRACT disable constraint FK_CONTRACT_REF_24266_PRMODEL';
EXECUTE IMMEDIATE 'truncate table PRMODEL';
EXECUTE IMMEDIATE 'alter table PRMODELVER enable constraint FK_PRMODELV_REF_122_PRMODEL';
EXECUTE IMMEDIATE 'alter table CONTRACT enable constraint FK_CONTRACT_REF_24266_PRMODEL';

EXECUTE IMMEDIATE 'alter table CONTRACT disable constraint FK_CONTRACT_R_292_MMSCC';
EXECUTE IMMEDIATE 'truncate table MMSCC';
EXECUTE IMMEDIATE 'alter table CONTRACT enable constraint FK_CONTRACT_R_292_MMSCC';

EXECUTE IMMEDIATE 'alter table LONGIDHISTDET disable constraint FK_LONGIDHI_R_438_LONGIDHI';
EXECUTE IMMEDIATE 'truncate table LONGIDHIST';
EXECUTE IMMEDIATE 'alter table LONGIDHISTDET enable constraint FK_LONGIDHI_R_438_LONGIDHI';

EXECUTE IMMEDIATE 'alter table SETDETAIL disable constraint FK_SETDETAI_RE_453_LONGID';
EXECUTE IMMEDIATE 'alter table LONGIDHISTDET disable constraint FK_LONGIDHI_R_439_LONGID';
EXECUTE IMMEDIATE 'alter table LONGIDMAP disable constraint FK_LONGIDMA_R_434_LONGID';
EXECUTE IMMEDIATE 'alter table LONGIDMAP disable constraint FK_LONGIDMA_R_433_LONGID';
EXECUTE IMMEDIATE 'truncate table LONGID';
EXECUTE IMMEDIATE 'alter table SETDETAIL enable constraint FK_SETDETAI_RE_453_LONGID';
EXECUTE IMMEDIATE 'alter table LONGIDHISTDET enable constraint FK_LONGIDHI_R_439_LONGID';
EXECUTE IMMEDIATE 'alter table LONGIDMAP enable constraint FK_LONGIDMA_R_434_LONGID';
EXECUTE IMMEDIATE 'alter table LONGIDMAP enable constraint FK_LONGIDMA_R_433_LONGID';

EXECUTE IMMEDIATE 'truncate table ENPLAROUTING';

EXECUTE IMMEDIATE 'alter table NBRRANGE disable constraint FK_NBRRANGE_REF_49037_CARRIER';
EXECUTE IMMEDIATE 'alter table IRANGE disable constraint FK_IRANGE_REF_35220_CARRIER';
EXECUTE IMMEDIATE 'truncate table CARRIER';
EXECUTE IMMEDIATE 'alter table NBRRANGE enable constraint FK_NBRRANGE_REF_49037_CARRIER';
EXECUTE IMMEDIATE 'alter table IRANGE enable constraint FK_IRANGE_REF_35220_CARRIER';


EXECUTE IMMEDIATE 'alter table IWTCOUNTER disable constraint FK_IWTCOUNT_REF_13685_BOHEADER';
EXECUTE IMMEDIATE 'alter table BDETAIL9 disable constraint FK_BDETAIL9_REF_26632_BOHEADE1';
EXECUTE IMMEDIATE 'alter table BDETAIL9 disable constraint FK_BDETAIL9_REF_26632_BOHEADE2';
EXECUTE IMMEDIATE 'alter table BDETAIL9 disable constraint FK_BDETAIL9_REF_26631_BOHEADER';
EXECUTE IMMEDIATE 'alter table BDETAIL disable constraint FK_BDETAIL_REF_11648_BOHEADER';
EXECUTE IMMEDIATE 'alter table BDETAIL disable constraint FK_BDETAIL_REF_11647_BOHEADER';
EXECUTE IMMEDIATE 'alter table BDETAIL disable constraint FK_BDETAIL_REF_104_BOHEADER';
EXECUTE IMMEDIATE 'alter table BDETAIL1 disable constraint FK_BDETAIL1_REF_14648_BOHEADER';
EXECUTE IMMEDIATE 'alter table BDETAIL1 disable constraint FK_BDETAIL1_REF_14647_BOHEADER';
EXECUTE IMMEDIATE 'alter table BDETAIL1 disable constraint FK_BDETAIL1_REF_14646_BOHEADER';
EXECUTE IMMEDIATE 'alter table BDETAIL2 disable constraint FK_BDETAIL2_REF104871_BOHEADER';
EXECUTE IMMEDIATE 'alter table BDETAIL2 disable constraint FK_BDETAIL2_REF104870_BOHEADER';
EXECUTE IMMEDIATE 'alter table BDETAIL2 disable constraint FK_BDETAIL2_REF104869_BOHEADER';
EXECUTE IMMEDIATE 'alter table BDETAIL4 disable constraint FK_BDETAIL4_REF_92640_BOHEADER';
EXECUTE IMMEDIATE 'alter table BDETAIL4 disable constraint FK_BDETAIL4_REF_92639_BOHEADER';
EXECUTE IMMEDIATE 'alter table BDETAIL4 disable constraint FK_BDETAIL4_REF_92638_BOHEADER';
EXECUTE IMMEDIATE 'alter table BDETAIL6 disable constraint FK_BDETAIL6_RF_173507_BOHEADER';
EXECUTE IMMEDIATE 'alter table BDETAIL6 disable constraint FK_BDETAIL6_RF_173503_BOHEADER';
EXECUTE IMMEDIATE 'alter table BDETAIL6 disable constraint FK_BDETAIL6_RF_173499_BOHEADER';
EXECUTE IMMEDIATE 'truncate table BOHEADER';
EXECUTE IMMEDIATE 'alter table IWTCOUNTER enable constraint FK_IWTCOUNT_REF_13685_BOHEADER';
EXECUTE IMMEDIATE 'alter table BDETAIL9 enable constraint FK_BDETAIL9_REF_26632_BOHEADE1';
EXECUTE IMMEDIATE 'alter table BDETAIL9 enable constraint FK_BDETAIL9_REF_26632_BOHEADE2';
EXECUTE IMMEDIATE 'alter table BDETAIL9 enable constraint FK_BDETAIL9_REF_26631_BOHEADER';
EXECUTE IMMEDIATE 'alter table BDETAIL enable constraint FK_BDETAIL_REF_11648_BOHEADER';
EXECUTE IMMEDIATE 'alter table BDETAIL enable constraint FK_BDETAIL_REF_11647_BOHEADER';
EXECUTE IMMEDIATE 'alter table BDETAIL enable constraint FK_BDETAIL_REF_104_BOHEADER';
EXECUTE IMMEDIATE 'alter table BDETAIL1 enable constraint FK_BDETAIL1_REF_14648_BOHEADER';
EXECUTE IMMEDIATE 'alter table BDETAIL1 enable constraint FK_BDETAIL1_REF_14647_BOHEADER';
EXECUTE IMMEDIATE 'alter table BDETAIL1 enable constraint FK_BDETAIL1_REF_14646_BOHEADER';
EXECUTE IMMEDIATE 'alter table BDETAIL2 enable constraint FK_BDETAIL2_REF104871_BOHEADER';
EXECUTE IMMEDIATE 'alter table BDETAIL2 enable constraint FK_BDETAIL2_REF104870_BOHEADER';
EXECUTE IMMEDIATE 'alter table BDETAIL2 enable constraint FK_BDETAIL2_REF104869_BOHEADER';
EXECUTE IMMEDIATE 'alter table BDETAIL4 enable constraint FK_BDETAIL4_REF_92640_BOHEADER';
EXECUTE IMMEDIATE 'alter table BDETAIL4 enable constraint FK_BDETAIL4_REF_92639_BOHEADER';
EXECUTE IMMEDIATE 'alter table BDETAIL4 enable constraint FK_BDETAIL4_REF_92638_BOHEADER';
EXECUTE IMMEDIATE 'alter table BDETAIL6 enable constraint FK_BDETAIL6_RF_173507_BOHEADER';
EXECUTE IMMEDIATE 'alter table BDETAIL6 enable constraint FK_BDETAIL6_RF_173503_BOHEADER';
EXECUTE IMMEDIATE 'alter table BDETAIL6 enable constraint FK_BDETAIL6_RF_173499_BOHEADER';

EXECUTE IMMEDIATE 'truncate table VSHEADER';

EXECUTE IMMEDIATE 'alter table VSHEADER disable constraint FK_VSHEADER_REFER_430_BIHEADER';
EXECUTE IMMEDIATE 'alter table BDETAIL7 disable constraint FK_BDETAIL7_REF_369_BIHEADER';
EXECUTE IMMEDIATE 'alter table BDETAIL9 disable constraint FK_BDETAIL9_REF_26631_BIHEADER';
EXECUTE IMMEDIATE 'alter table BDETAIL disable constraint FK_BDETAIL_REF_98_BIHEADER';
EXECUTE IMMEDIATE 'alter table BDETAIL1 disable constraint FK_BDETAIL1_REF_14645_BIHEADER';
EXECUTE IMMEDIATE 'alter table BDETAIL2 disable constraint FK_BDETAIL2_REF_94856_BIHEADER';
EXECUTE IMMEDIATE 'alter table BDETAIL4 disable constraint FK_BDETAIL4_REF_92635_BIHEADER';
EXECUTE IMMEDIATE 'alter table BDETAIL6 disable constraint FK_BDETAIL6_REF_17349_BIHEADER';
EXECUTE IMMEDIATE 'truncate table BIHEADER';
EXECUTE IMMEDIATE 'alter table VSHEADER enable constraint FK_VSHEADER_REFER_430_BIHEADER';
EXECUTE IMMEDIATE 'alter table BDETAIL7 enable constraint FK_BDETAIL7_REF_369_BIHEADER';
EXECUTE IMMEDIATE 'alter table BDETAIL9 enable constraint FK_BDETAIL9_REF_26631_BIHEADER';
EXECUTE IMMEDIATE 'alter table BDETAIL enable constraint FK_BDETAIL_REF_98_BIHEADER';
EXECUTE IMMEDIATE 'alter table BDETAIL1 enable constraint FK_BDETAIL1_REF_14645_BIHEADER';
EXECUTE IMMEDIATE 'alter table BDETAIL2 enable constraint FK_BDETAIL2_REF_94856_BIHEADER';
EXECUTE IMMEDIATE 'alter table BDETAIL4 enable constraint FK_BDETAIL4_REF_92635_BIHEADER';
EXECUTE IMMEDIATE 'alter table BDETAIL6 enable constraint FK_BDETAIL6_REF_17349_BIHEADER';

EXECUTE IMMEDIATE 'truncate table SYSPARAMETERS';

EXECUTE IMMEDIATE 'alter table CONTENTSERVICE disable constraint FK_CONTENTS_REF_357_ACCOUNT';
EXECUTE IMMEDIATE 'alter table CONTENTSERVICE disable constraint FK_CONTENTS_REF_356_ACCOUNT';
EXECUTE IMMEDIATE 'alter table SYSPARAMETERS disable constraint FK_SYSPARAM_REF_43130_ACCOUNT';
EXECUTE IMMEDIATE 'alter table SYSPARAMETERS disable constraint FK_SYSPARAM_REF_43129_ACCOUNT';
EXECUTE IMMEDIATE 'alter table SYSPARAMETERS disable constraint FK_SYSPARAM_REF_43128_ACCOUNT';
EXECUTE IMMEDIATE 'alter table SYSPARAMETERS disable constraint FK_SYSPARAM_REF_43127_ACCOUNT';
EXECUTE IMMEDIATE 'alter table SYSPARAMETERS disable constraint FK_SYSPARAM_REF_43126_ACCOUNT';
EXECUTE IMMEDIATE 'alter table ISSUE disable constraint FK_ISSUE_REF_43118_ACCOUNT';
EXECUTE IMMEDIATE 'alter table ISSUE disable constraint FK_ISSUE_REFERENCE_ACCOUNT';
EXECUTE IMMEDIATE 'alter table ACCOUNT disable constraint FK_ACCOUNT_REF_41600_ACCOUNT';
EXECUTE IMMEDIATE 'alter table CONTRACT disable constraint FK_CONTRACT_REF_586_ACCOUNT';
EXECUTE IMMEDIATE 'alter table LONGIDHIST disable constraint FK_LONGIDHI_R_437_ACCOUNT';
EXECUTE IMMEDIATE 'truncate table ACCOUNT';
EXECUTE IMMEDIATE 'alter table CONTENTSERVICE enable constraint FK_CONTENTS_REF_357_ACCOUNT';
EXECUTE IMMEDIATE 'alter table CONTENTSERVICE enable constraint FK_CONTENTS_REF_356_ACCOUNT';
EXECUTE IMMEDIATE 'alter table SYSPARAMETERS enable constraint FK_SYSPARAM_REF_43130_ACCOUNT';
EXECUTE IMMEDIATE 'alter table SYSPARAMETERS enable constraint FK_SYSPARAM_REF_43129_ACCOUNT';
EXECUTE IMMEDIATE 'alter table SYSPARAMETERS enable constraint FK_SYSPARAM_REF_43128_ACCOUNT';
EXECUTE IMMEDIATE 'alter table SYSPARAMETERS enable constraint FK_SYSPARAM_REF_43127_ACCOUNT';
EXECUTE IMMEDIATE 'alter table SYSPARAMETERS enable constraint FK_SYSPARAM_REF_43126_ACCOUNT';
EXECUTE IMMEDIATE 'alter table ISSUE enable constraint FK_ISSUE_REF_43118_ACCOUNT';
EXECUTE IMMEDIATE 'alter table ISSUE enable constraint FK_ISSUE_REFERENCE_ACCOUNT';
EXECUTE IMMEDIATE 'alter table ACCOUNT enable constraint FK_ACCOUNT_REF_41600_ACCOUNT';
EXECUTE IMMEDIATE 'alter table CONTRACT enable constraint FK_CONTRACT_REF_586_ACCOUNT';
EXECUTE IMMEDIATE 'alter table LONGIDHIST enable constraint FK_LONGIDHI_R_437_ACCOUNT';

EXECUTE IMMEDIATE 'alter table ACCOUNT disable constraint FK_ACCOUNT_REF_3323_ADDRESS';
EXECUTE IMMEDIATE 'alter table ACCOUNT disable constraint FK_ACCOUNT_REF_3320_ADDRESS';
EXECUTE IMMEDIATE 'alter table ACCOUNT disable constraint FK_ACCOUNT_REF_3314_ADDRESS';
EXECUTE IMMEDIATE 'alter table ACCOUNT disable constraint FK_ACCOUNT_REF_3311_ADDRESS';
EXECUTE IMMEDIATE 'alter table ACCOUNT disable constraint FK_ACCOUNT_REF_3308_ADDRESS';
EXECUTE IMMEDIATE 'alter table ACCOUNT disable constraint FK_ACCOUNT_REF_3305_ADDRESS';
EXECUTE IMMEDIATE 'alter table ACCOUNT disable constraint FK_ACCOUNT_REF_2055_ADDRESS';
EXECUTE IMMEDIATE 'alter table ACCOUNT disable constraint FK_ACCOUNT_REF_2054_ADDRESS';
EXECUTE IMMEDIATE 'truncate table ADDRESS';
EXECUTE IMMEDIATE 'alter table ACCOUNT enable constraint FK_ACCOUNT_REF_3323_ADDRESS';
EXECUTE IMMEDIATE 'alter table ACCOUNT enable constraint FK_ACCOUNT_REF_3320_ADDRESS';
EXECUTE IMMEDIATE 'alter table ACCOUNT enable constraint FK_ACCOUNT_REF_3314_ADDRESS';
EXECUTE IMMEDIATE 'alter table ACCOUNT enable constraint FK_ACCOUNT_REF_3311_ADDRESS';
EXECUTE IMMEDIATE 'alter table ACCOUNT enable constraint FK_ACCOUNT_REF_3308_ADDRESS';
EXECUTE IMMEDIATE 'alter table ACCOUNT enable constraint FK_ACCOUNT_REF_3305_ADDRESS';
EXECUTE IMMEDIATE 'alter table ACCOUNT enable constraint FK_ACCOUNT_REF_2055_ADDRESS';
EXECUTE IMMEDIATE 'alter table ACCOUNT enable constraint FK_ACCOUNT_REF_2054_ADDRESS';
COMMIT WORK;


END; -- Procedure
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- GPSH_CURRENCY_EXR_DEL  (Procedure) 
--
CREATE OR REPLACE PROCEDURE SBS1_ADMIN.GPSH_CURRENCY_EXR_DEL(
        P_EXR_CURID VARCHAR2,
        P_EXR_START VARCHAR2)
   IS
   ERRORCODE   NUMBER;
   ERRORMSG    VARCHAR2(100);
   RETURNCODE  NUMBER;
-- MODIFICATION HISTORY
-- ---------    ------      -------------------------------------------
-- Person       Date        Comments
-- SS           10.08.2016  Created

BEGIN

    DELETE FROM EXCHANGERATE WHERE EXR_CURID = P_EXR_CURID AND EXR_START = from_json_date(P_EXR_START);

    pkg_admin_common.SP_VALIDATE_EXCHANGE_RATES(P_CUR_ID=>P_EXR_CURID, ERRORCODE=>ERRORCODE, ERRORMSG=>ERRORMSG, RETURNSTATUS=>RETURNCODE);

END; -- Procedure
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- GPSH_CURRENCY_EXR_PUT  (Procedure) 
--
CREATE OR REPLACE PROCEDURE SBS1_ADMIN.GPSH_CURRENCY_EXR_PUT(P_CUR_ID VARCHAR2,P_EXR_JSON IN VARCHAR2)
-- MODIFICATION HISTORY
-- ---------    ------      -------------------------------------------
-- Person       Date        Comments
-- SS           10.08.16    Created

IS
    ID           VARCHAR2(10);
    RATE         VARCHAR2(50);
    VALID_FROM   VARCHAR2(20);
    VALID_TO     VARCHAR2(20);
    T_EXR_ID     VARCHAR2(20);

    ERRORCODE    NUMBER;
    ERRORMSG     VARCHAR2(100);
    RETURNCODE   NUMBER;
BEGIN
    SELECT EXR_ID, EXR_RATE, EXR_VALID_FROM, EXR_VALID_TO
    INTO ID, RATE, VALID_FROM, VALID_TO
    FROM JSON_TABLE(P_EXR_JSON, '$' COLUMNS(
        EXR_ID PATH '$.ID',
        EXR_RATE PATH '$.RATE',
        EXR_VALID_FROM PATH '$.VALID_FROM',
        EXR_VALID_TO PATH '$.VALID_TO'));

    IF VALID_TO IS NULL THEN
        VALID_TO := '2100-01-01T00:00:00Z';
    END IF;

    SELECT EXR_ID INTO T_EXR_ID FROM EXCHANGERATE RIGHT JOIN DUAL ON EXR_START = from_json_date(VALID_FROM) AND EXR_CURID = P_CUR_ID;

    IF T_EXR_ID IS NOT NULL AND T_EXR_ID <> ID THEN
        DELETE FROM EXCHANGERATE WHERE EXR_ID = T_EXR_ID;
    END IF;

    SELECT EXR_ID INTO T_EXR_ID FROM EXCHANGERATE RIGHT JOIN DUAL ON EXR_ID = ID;

    IF T_EXR_ID IS NULL THEN
        INSERT INTO EXCHANGERATE (EXR_ID, EXR_CURID, EXR_VALUE, EXR_START, EXR_END, EXR_DATECRE)
            VALUES (ID, P_CUR_ID, RATE, from_json_date(VALID_FROM), from_json_date(VALID_TO), SYSDATE);
    ELSE
        UPDATE EXCHANGERATE SET
            EXR_CURID = P_CUR_ID,
            EXR_VALUE = RATE,
            EXR_START = from_json_date(VALID_FROM),
            EXR_END = from_json_date(VALID_TO),
            EXR_DATEMOD = SYSDATE
        WHERE EXR_ID = ID;
    END IF;

    pkg_admin_common.SP_VALIDATE_EXCHANGE_RATES(P_CUR_ID=>P_CUR_ID, ERRORCODE=>ERRORCODE, ERRORMSG=>ERRORMSG, RETURNSTATUS=>RETURNCODE);

END;
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SP_CONS_ISMSISDN  (Procedure) 
--
CREATE OR REPLACE PROCEDURE SBS1_ADMIN.SP_CONS_ISMSISDN
(
   p_PAC_ID         IN varchar2,    -- 'ISMSISDN'   ISMSISDN Consolidation
   p_BOH_ID         IN varchar2,
   RecordsAffected  OUT number,
   ErrorCode        OUT number,
   ErrorMsg         OUT varchar2,
   ReturnStatus     IN OUT number )
IS

-- procedure fills up consolidation table ISMSTAT (Info Service Msisdn) with data from bdetail
-- procedure fills up consolidation table TPMCONSOL (Third Party Msisdn) with data from bdetail
   x_TPID           VARCHAR2(10);
   n_TPID           NUMBER;
   x_SERVICE        VARCHAR2(20);       --  040SO
   x_BILLTEXT       VARCHAR2(80);

   x_MSISDN         VARCHAR2(20);
   n_MSISDN         NUMBER;
   x_SHORTID        VARCHAR2(6);
   n_SHORTID        NUMBER;
   x_KEYWORD        VARCHAR2(80);
   x_CONSUBTYPE     VARCHAR2(10);
   x_REQTYPE        NUMBER;
   n_AMOUNTCU       NUMBER(9,4);
   n_PULLINC        NUMBER;
   n_PUSHINC        NUMBER;

   dummy_ErrorCode     NUMBER;
   dummy_ErrorMsg      VARCHAR2(2000);
   dummy_ReturnStatus  NUMBER;

   v_Temp varchar2(2000);
     n_REDCODE number;
   v_Billtext varchar2(2000);

   CURSOR C1 (period_id VARCHAR2) IS
      SELECT /*+ FULL(BDETAIL) */
        BD_MSISDN_A,
        NVL(CON_ESTID,'-e-'),                       --  037SO
        NVL(BD_SHORTID,'0'),
        NVL(BD_KEYWORD,'-empty-'),
        BD_REQTYPE,
        BD_AMOUNTCU,
        BD_SERVICE,
        NVL(BD_BILLTEXT,'-empty-'),
        NVL(BD_TPID,'0')
      FROM
        BDETAIL,
        CONTRACT
      WHERE
             BDETAIL.BD_CONID = CONTRACT.CON_ID
        AND  BD_DEMO = 0
        AND  BD_MAPSID = 'R'
        AND  BD_CDRTID = 'CTB-CO'                                       --  043SO
        AND  BD_DATETIME >= to_date(period_id,'YYYYMM')                 --  032SO
        AND  BD_DATETIME < ADD_MONTHS(to_date(period_id,'YYYYMM'),1)    --  032SO
      ;

    v_sep_id        VARCHAR2(6);        -- YYYYMM                               --  029SO
BEGIN

    -- v_sep_id := to_char(ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1),'YYYYMM');     --  029SO
    v_sep_id := to_char(ADD_MONTHS(TRUNC(sysdate,'MONTH'),0),'YYYYMM');         --  SURRENT MONTH

    RecordsAffected := 0;

    execute immediate 'TRUNCATE TABLE ISMSTAT' ;
    execute immediate 'TRUNCATE TABLE TPMCONSOL';
    execute immediate 'TRUNCATE TABLE TPMCONSOL_BAD';                           --  029SO

    OPEN C1(v_sep_id);

    LOOP
        FETCH C1 INTO x_MSISDN, x_CONSUBTYPE, x_SHORTID, x_KEYWORD, x_REQTYPE, n_AMOUNTCU, x_SERVICE, x_BILLTEXT, x_TPID;
        EXIT WHEN (C1%NOTFOUND);
        BEGIN
          n_MSISDN := to_number(SUBSTR(NormalizedMsisdn(x_MSISDN),1,16));  -- internationalize MSISDN
          n_SHORTID := to_number(x_SHORTID);                  -- convert to number
          x_KEYWORD := SUBSTR(x_KEYWORD,1,30);                -- truncate keyword
          x_BILLTEXT := SUBSTR(x_BILLTEXT,1,30);              -- truncate billtext
          n_TPID := to_number(x_TPID);                        -- convert to number
          IF x_REQTYPE IN (0, 501, 603) THEN
              -- considered pull
              n_PULLINC := 1;
              n_PUSHINC := 0;
          ELSE
              -- everything else considered push: check later for MMS
              n_PULLINC := 0;
              n_PUSHINC := 1;
          END IF;

          UPDATE ISMSTAT SET
              ISM_PULLCOUNT = ISM_PULLCOUNT + n_PULLINC,
              ISM_PUSHCOUNT = ISM_PUSHCOUNT + n_PUSHINC,
              ISM_AMOUNTCU = ISM_AMOUNTCU + n_AMOUNTCU
          WHERE
                  ISM_MSISDN = n_MSISDN
              AND ISM_CONSUB = x_CONSUBTYPE
              AND ISM_SHORTID = n_SHORTID
              AND ISM_KEYWORD = x_KEYWORD
          ;

          IF SQL%ROWCOUNT = 0 THEN    -- must insert this row

              INSERT INTO ISMSTAT (
                  ISM_MSISDN,
                  ISM_CONSUB,
                  ISM_SHORTID,
                  ISM_KEYWORD,
                  ISM_PULLCOUNT,
                  ISM_PUSHCOUNT,
                  ISM_AMOUNTCU
                  )
              VALUES (
                  n_MSISDN,
                  x_CONSUBTYPE,
                  n_SHORTID,
                  x_KEYWORD,
                  n_PULLINC,
                  n_PUSHINC,
                  n_AMOUNTCU
                  );
              RecordsAffected := RecordsAffected + 1 ;

          END IF;

          UPDATE TPMCONSOL SET
              TPMC_PULLCOUNT = TPMC_PULLCOUNT + n_PULLINC,
              TPMC_PUSHCOUNT = TPMC_PUSHCOUNT + n_PUSHINC,
              TPMC_AMOUNTCU  = TPMC_AMOUNTCU  + n_AMOUNTCU
          WHERE
                  TPMC_MSISDN = n_MSISDN
              AND TPMC_CONSUB = x_CONSUBTYPE
              AND TPMC_TPID = n_TPID
              AND TPMC_SERVICE = x_SERVICE
              AND TPMC_BILLTEXT = x_BILLTEXT
          ;
          IF SQL%ROWCOUNT = 0 THEN    -- must insert this row

              INSERT INTO TPMCONSOL (
                  TPMC_MSISDN,
                  TPMC_CONSUB,
                  TPMC_TPID,
                  TPMC_SERVICE,
                  TPMC_BILLTEXT,
                  TPMC_PULLCOUNT,
                  TPMC_PUSHCOUNT,
                  TPMC_AMOUNTCU,
                  TPMC_BILLTEXT_AGR         --  053SO
                  )
              VALUES (
                  n_MSISDN,
                  x_CONSUBTYPE,
                  n_TPID,
                  x_SERVICE,
                  x_BILLTEXT,
                  n_PULLINC,
                  n_PUSHINC,
                  n_AMOUNTCU,
                  0                         --  053SO
                  );
              RecordsAffected := RecordsAffected + 1 ;

          END IF;

        Exception
        When Others then
          PKG_COMMON.INSERT_WARNING (
             'PKG_BDETAIL_INFO',
             'SP_INSERT_ISMSTAT',
             'Illegal values',
             'MSISDN=' || x_MSISDN || ' CONSUBTYPE=' || x_CONSUBTYPE || ' TPID=' || x_TPID || ' SERVICE=' || x_SERVICE || ' SHORTID=' || x_SHORTID || ' KEYWORD=' || x_KEYWORD,
             NULL, p_BOH_ID, NULL, x_SHORTID
             ); --  064SO

        END;

   END LOOP;

   CLOSE C1;

    --  053SO --  029SO aggregate entries for short IDs which have too many BillTexts

    -- Mark the 'bad' entries
    UPDATE  TPMCONSOL SET
        TPMC_BILLTEXT_AGR = 1               --  053SO
    WHERE
        TPMC_SERVICE IN (
            SELECT ISCA_SERVICE
            FROM ISC_AGGREGATION
            WHERE ISCA_SEPID = v_sep_id
        );

   ErrorCode := 0;
   ReturnStatus := 1;
   Return;

END SP_CONS_ISMSISDN;
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- STATS_ANALYZEJOB  (Procedure) 
--
CREATE OR REPLACE PROCEDURE SBS1_ADMIN.STATS_ANALYZEJOB

IS

cursor cDoneJobs is
	select * from sta_job
	where staj_esid='O'
	order by staj_datesta desc, staj_pacid desc;

cJobRow cDoneJobs%rowtype;	

vTemp1 varchar2(50);
vTemp2 varchar2(50);

nTimeSec number;
nTimeMin number;
nTimeStd number;

dDateExe date;
dDateStart date;
dDateTime date;

BEGIN
--Successfully executed (11.07.2003 13:08:55)
--Processing started at 11.07.2003 13:08:24
--Scheduled on 11.07.2003 13:08:21

delete from sta_jobanalyze;
commit;

for cJobRow in cDoneJobs loop
	if (INSTR(cJobRow.staj_sysinfo,'Successfully executed')<>0) then
		vTemp1:=substr(cJobRow.staj_sysinfo,24,19);
		vTemp2:=substr(cJobRow.staj_sysinfo,length('Successfully executed (11.07.2003 13:08:55)')+24,19);
		
		nTimeSec:=(to_date(vTemp1, 'DD.MM.YYYY hh24:mi:ss')-to_date(vTemp2, 'DD.MM.YYYY hh24:mi:ss'))*86400;
		nTimeStd:=trunc(nTimeSec/3600);
		nTimeSec:= nTimeSec-(nTimeStd*3600);
		nTimeMin:=trunc(nTimeSec/60);

		nTimeSec:= trunc(nTimeSec-(nTimeMin*60));
		
		insert into sta_jobanalyze
			values (cJobRow.staj_pacid, to_date(vTemp2, 'DD.MM.YYYY hh24:mi:ss'),
					to_date(vTemp1, 'DD.MM.YYYY hh24:mi:ss'), nTimeStd, nTimeMin, nTimeSec);
		
	end if;
end loop;
commit;

EXCEPTION
    WHEN others THEN
        null ;

END; -- Procedure

 
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- JOB_ADRID_MAIN_EMAIL  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.JOB_ADRID_MAIN_EMAIL (
        p_job_id            In Varchar2
    ) Return Varchar2
Is  

    -- used for evaluation of main eMail-Adress of Job
    
    l_retval            Varchar2(100);                                   
    l_looptype          Varchar2(10);                                   
    l_loopvar           Varchar2(10);                                   

Begin
    
    l_retval := NULL;
    
    SELECT  PAC_LTID, STAJ_LTVALUE
    INTO    l_looptype, l_loopvar
    FROM    STA_JOB,PACKING
    WHERE   STA_JOB.STAJ_PACID = PACKING.PAC_ID
    -- AND     STAJ_PACID = 'SL087a'
    AND     STAJ_ID = p_job_id 
    ;
    
    if l_looptype = 'AC_ID' then
        SELECT  ADR_EMAIL
        INTO    l_retval
        FROM    ACCOUNT,ADDRESS
        WHERE   ACCOUNT.AC_ADRID_MAIN = ADDRESS.ADR_ID
        AND     AC_ID = l_loopvar;
    elsif l_looptype = 'CON_ID' Then
        SELECT  ADR_EMAIL
        INTO    l_retval
        FROM    ACCOUNT,ADDRESS,CONTRACT
        WHERE   ACCOUNT.AC_ADRID_MAIN = ADDRESS.ADR_ID
        AND     AC_ID = CON_ACID
        AND     CON_ID = l_loopvar;
    end if;
    
    RETURN l_retval;
        
End JOB_ADRID_MAIN_EMAIL;
 
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- JOB_BN_STATS_EMAILS  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.JOB_BN_STATS_EMAILS (
        p_job_id            In Varchar2
    ) Return Varchar2
Is

-- Purpose: Return concatenated eMail adresses for BN-Statistics for given statistics job
--
-- uses function BN_STATS_EMAILS(ac_id)
--
-- MODIFICATION HISTORY
-- Person   Date        Comments
-- ------   ----------  -------------------------------------------
-- 001SO    27.08.2011  Created

    l_retval            Varchar2(1000);
    l_looptype          Varchar2(10);
    l_loopvar           Varchar2(10);
    l_acid              Varchar2(10);

Begin

    l_retval := NULL;

    SELECT  PAC_LTID, STAJ_LTVALUE
    INTO    l_looptype, l_loopvar
    FROM    STA_JOB,PACKING
    WHERE   STA_JOB.STAJ_PACID = PACKING.PAC_ID
    AND     STAJ_ID = p_job_id
    ;

    if l_looptype = 'AC_ID' then
        l_retval := BN_STATS_EMAILS(l_loopvar);
    elsif l_looptype = 'CON_ID' Then
        SELECT  CON_ACID
        INTO    l_acid
        FROM    CONTRACT
        WHERE   CON_ID = l_loopvar;
        l_retval := BN_STATS_EMAILS(l_acid);
    end if;

    return l_retval;

End JOB_BN_STATS_EMAILS;
 
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- JOB_BOHIDEXEC  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.JOB_BOHIDEXEC (
        p_job_id            In Varchar2
    ) Return Varchar2
Is  

    -- used for evaluation of BOH_ID belonging to the statistic executor

-- 001SO    14.12.2011  Remove schema qualifier "S B S 0 ."
    
    l_retval            Varchar2(10);                                   

Begin
    
    SELECT 
            STAJ_BOHIDEXEC
    INTO    l_retval
    FROM STA_JOB
    WHERE STAJ_ID = p_job_id 
    ;
    RETURN l_retval;
        
End JOB_BOHIDEXEC;
 
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- JOB_DATEFROM  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.JOB_DATEFROM (
        p_job_id            In Varchar2
    ) Return Date
Is  
Begin
    RETURN to_date(JOB_PARAMETER (p_job_id, '[DATEFROM]'),'dd.mm.yyyy hh24:mi:ss');   
End JOB_DATEFROM;
 
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- JOB_DATETILL  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.JOB_DATETILL (
        p_job_id            In Varchar2
    ) Return Date
Is  
Begin
    RETURN to_date(JOB_PARAMETER (p_job_id, '[DATETILL]'),'dd.mm.yyyy hh24:mi:ss');   
End JOB_DATETILL;
 
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- JOB_DATETO  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.JOB_DATETO (
        p_job_id            In Varchar2
    ) Return Date
Is  
Begin
    RETURN to_date(JOB_PARAMETER (p_job_id, '[DATETO]'),'dd.mm.yyyy hh24:mi:ss');   
End JOB_DATETO;
 
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- JOB_EXPANDED_SQL  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.JOB_EXPANDED_SQL (
        p_JobId              In varchar2,
        p_job_sql            In Varchar2
    ) Return Varchar2
Is

    -- used for evaluation of job sql

--MODIFICATION HISTORY 
--Code  Date        Comments
------- ----------  ----------------------------------------------
--001SO 09.09.2010  Add replacement of JOB_BOHIDEXEC function
--002SO 05.09.2011  Expand buffer variables

    l_retval            Varchar2(4000);     --002SO
    l_pos_proc          INTEGER;
    l_pos_end           INTEGER;
    l_tail              Varchar2(4000);     --002SO
    l_cmd               Varchar2(200);      --002SO
    l_eval              Varchar2(200);      --002SO

Begin

    l_retval := p_job_sql;
    l_retval := REPLACE(l_retval,'<STAJ_ID>',p_JobId);
    
    if INSTR(l_retval,'JOB_DATEFROM(') > 0 then
        l_retval := REPLACE(l_retval,'JOB_DATEFROM(''' || p_JobId || ''')','to_date(''' || JOB_PARAMETER (p_JobId,'[DATEFROM]') || ''',''dd.mm.yyyy hh24:mi:ss'')');
    end if;
    
    if INSTR(l_retval,'JOB_DATETO(') > 0 then
        l_retval := REPLACE(l_retval,'JOB_DATETO(''' || p_JobId || ''')','to_date(''' || JOB_PARAMETER (p_JobId,'[DATETO]') || ''',''dd.mm.yyyy hh24:mi:ss'')');
    end if;
    
    if INSTR(l_retval,'JOB_DATETILL(') > 0 then
        l_retval := REPLACE(l_retval,'JOB_DATETILL(''' || p_JobId || ''')','to_date(''' || JOB_PARAMETER (p_JobId,'[DATETILL]') || ''',''dd.mm.yyyy hh24:mi:ss'')');
    end if;
    
    if INSTR(l_retval,'JOB_LOOPVAR(') > 0 then
        l_retval := REPLACE(l_retval,'JOB_LOOPVAR(''' || p_JobId || ''')','''' || JOB_LOOPVAR (p_JobId) || '''');
    end if;

    if INSTR(l_retval,'JOB_BOHIDEXEC(') > 0 then
        l_retval := REPLACE(l_retval,'JOB_BOHIDEXEC(''' || p_JobId || ''')','''' || JOB_BOHIDEXEC(p_JobId) || '''');
    end if; --001SO

    l_pos_proc := INSTR(l_retval,'JOB_PARAMETER');
    while l_pos_proc > 0 loop
        l_tail := SUBSTR(l_retval,l_pos_proc);                                  -- from proc
        l_pos_end := INSTR(l_tail,')');
        l_cmd := 'SELECT ' || SUBSTR(l_tail,1,l_pos_end) || ' FROM DUAL';
        EXECUTE IMMEDIATE l_cmd INTO l_eval;
        l_retval := substr(l_retval,1,l_pos_proc-1) || '''' || l_eval || '''';
        if length(l_tail) > l_pos_end then
            l_retval := l_retval || SUBSTR(l_tail,l_pos_end +1);
        end if;
        l_pos_proc := INSTR(l_retval,'JOB_PARAMETER');
    end loop;

    l_pos_proc := INSTR(l_retval,'JOB_SEARCH_PARAMETER');
    while l_pos_proc > 0 loop
        l_tail := SUBSTR(l_retval,l_pos_proc);                                  -- from proc
        l_pos_end := INSTR(l_tail,')');
        l_cmd := 'SELECT ' || SUBSTR(l_tail,1,l_pos_end) || ' FROM DUAL';
        EXECUTE IMMEDIATE l_cmd INTO l_eval;
        l_retval := substr(l_retval,1,l_pos_proc-1) || '''' || l_eval || '''';
        if length(l_tail) > l_pos_end then
            l_retval := l_retval || SUBSTR(l_tail,l_pos_end +1);
        end if;
        l_pos_proc := INSTR(l_retval,'JOB_SEARCH_PARAMETER');
    end loop;

    RETURN l_retval;

End job_expanded_sql;
 
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- JOB_LA_INVOICE_EMAILS  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.JOB_LA_INVOICE_EMAILS (
        p_job_id            In Varchar2
    ) Return Varchar2
Is

-- Purpose: Return concatenated eMail adresses for invoices for given statistics job
--
-- uses function LA_INVOICE_EMAILS(ac_id)
--
-- MODIFICATION HISTORY
-- Person   Date        Comments
-- ------   ----------  -------------------------------------------
-- 001SO    08.12.2009  Created

    l_retval            Varchar2(1000);
    l_looptype          Varchar2(10);
    l_loopvar           Varchar2(10);
    l_acid              Varchar2(10);

Begin

    l_retval := NULL;

    SELECT  PAC_LTID, STAJ_LTVALUE
    INTO    l_looptype, l_loopvar
    FROM    STA_JOB,PACKING
    WHERE   STA_JOB.STAJ_PACID = PACKING.PAC_ID
    AND     STAJ_ID = p_job_id
    ;

    if l_looptype = 'AC_ID' then
        l_retval := LA_INVOICE_EMAILS(l_loopvar);
    elsif l_looptype = 'CON_ID' Then
        SELECT  CON_ACID
        INTO    l_acid
        FROM    CONTRACT
        WHERE   CON_ID = l_loopvar;
        l_retval := LA_INVOICE_EMAILS(l_acid);
    end if;

    return l_retval;

End job_la_invoice_emails;
 
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- JOB_LOOPVAR  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.JOB_LOOPVAR (
        p_job_id            In Varchar2
    ) Return VARCHAR2
Is  

-- 001SO    14.12.2011  Remove schema qualifier "S B S 0 ."
-- 002SO    17.03.2012  Correct wrong result type

    l_retval            Varchar2(100);                                   

Begin
    
    SELECT  STAJ_LTVALUE
    INTO    l_retval
    FROM    STA_JOB 
    WHERE   STAJ_ID = p_job_id 
    ;
    RETURN l_retval;

End JOB_LOOPVAR;
 
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- JOB_PARAMETER  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.JOB_PARAMETER (
        p_job_id            In Varchar2,
        p_par_name          In Varchar2
    ) Return Varchar2
Is  

    -- used for evaluation of reporting parematers
    
    l_retval            Varchar2(100);                                   

Begin
    
    SELECT 
            STAJP_VALUE
    INTO    l_retval
    FROM STA_JOBPARAM 
    WHERE STAJP_NAME = p_par_name 
    AND STAJP_JOBID = p_job_id 
    ;
    RETURN l_retval;
        
End JOB_PARAMETER;
 
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- JOB_SEARCH_PARAMETER  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.JOB_SEARCH_PARAMETER (
        p_job_id            In Varchar2,
        p_par_name          In Varchar2
    ) Return Varchar2
Is

    -- used for evaluation of reporting parematers

    CURSOR cParamValue is
    SELECT STAJP_VALUE
    FROM STA_JOBPARAM
    WHERE STAJP_NAME = p_par_name
    AND STAJP_JOBID = p_job_id
    ;

    l_retval            Varchar2(100);

Begin

    open cParamValue;
    fetch cParamValue into l_retval;
    if cParamValue%found then
        if l_retval is NULL then
            l_retval := '%';
        else
            l_retval := REPLACE(l_retval,'*','%');
            l_retval := REPLACE(l_retval,'?','_');
        end if;
    else
        l_retval := '%';
    end if;
    close cParamValue;
    RETURN l_retval;

End JOB_SEARCH_PARAMETER;
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- JOB_SEARCH_PARAMETER_TEST  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.job_search_parameter_test (
        p_job_id            In Varchar2,
        p_par_name          In Varchar2
    ) Return Varchar2
Is

    -- used for evaluation of reporting parematers

-- 002SO    18.04.2010  REMOVE S B S 0 schema reference

    CURSOR cParamValue is
    SELECT STAJP_VALUE
    FROM STA_JOBPARAM
    WHERE STAJP_NAME = p_par_name
    AND STAJP_JOBID = p_job_id
    ;

    l_retval            Varchar2(100);

Begin

    open cParamValue;
    fetch cParamValue into l_retval;
    if cParamValue%found then
        if l_retval is NULL then
            l_retval := '%';
        else
            l_retval := REPLACE(l_retval,'*','%');
            l_retval := REPLACE(l_retval,'?','_');
        end if;
    else
        l_retval := '%';
    end if;
    close cParamValue;
    RETURN l_retval;

End job_search_parameter_test;
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- KPI_SMS_LA_REVENUE  (Function) 
--
CREATE OR REPLACE FUNCTION SBS1_ADMIN.KPI_SMS_LA_REVENUE (
    p_Bihid    IN VARCHAR2
) RETURN  NUMBER IS
--
-- Purpose: SMS-LA Revenue in microfrancs per CDR
--
-- MODIFICATION HISTORY
-- Person   Date        Comments
-- ------   ----------  -------------------------------------------
-- 001SO    16.09.2014  Created
l_result    NUMBER;
BEGIN

  select
      1000000
      *
        SUM ( BD_AMOUNTTR )
      /
        COUNT ( * )
  into  l_result
  from  BDETAIL1
  where BD_BIHID = p_Bihid
  and BD_TARID not in ('X','V','S','P','T');
  return l_result;


/*
SELECT
     BIH_DATEFC
    ,KPI_SMS_LA_REVENUE(BIH_ID)
FROM biheader
WHERE BIH_SRCTYPE = 'SMSC'
AND BIH_DATETIME >= to_date('04.09.2014','dd.mm.yyyy')
AND BIH_DATETIME < to_date('09.09.2014','dd.mm.yyyy')
AND to_char(BIH_DATETIME,'SS') like '00'
*/
END;
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- A2P_SMSC_CDRS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.A2P_SMSC_CDRS
(BD_ID, BD_SRCTYPE, BD_DATETIME, BD_DEMO, BD_BIHID, 
 BD_MAPSID, BD_BIRECNO, BD_BOHID1, BD_PACSID1, BD_BORECNO1, 
 BD_BOHID2, BD_PACSID2, BD_BORECNO2, BD_BOHID3, BD_PACSID3, 
 BD_BORECNO3, BD_CONID, BD_PMVID, BD_TARID, BD_NPI_A, 
 BD_TON_A, BD_PID_A, BD_MSISDN_A, BD_TON_B, BD_NPI_B, 
 BD_PID_B, BD_MSISDN_B, BD_IMSI, BD_LENGTH, BD_PREPAID, 
 BD_NETWORK, BD_NODENAME, BD_SERVICE, BD_SHORTID, BD_ITEMNO, 
 BD_KEYWORD, BD_LANGID, BD_REQTYPE, BD_BILLRATE, BD_AMOUNTCU, 
 BD_RETSHAREPV, BD_RETSHAREMO, BD_VSMSCID, BD_CONSOLIDATION, BD_STATUS, 
 BD_TERMDATE, BD_SETTLING, BD_SETID, BD_STORAGE, BD_DBIDSTORE, 
 BD_DATESTORE, BD_ARCHIVE, BD_DBIDARCH, BD_DATEARCH, BD_REQUESTID, 
 BD_RECTYPE, BD_IDENTITY, BD_REQSERV, BD_SUBSERV, BD_OPERATION, 
 BD_MULTSM, BD_SMSEQ, BD_ANSTYPE, BD_RETCODE, BD_RESPMEDIA, 
 BD_SMSCRESP, BD_TMINODE, BD_REQID, BD_SERVKEY, BD_TOCID, 
 BD_IOT, BD_INT, BD_OGTI, BD_ZNID, BD_CDRTID, 
 BD_IW, BD_ERRID, BD_BILLED, BD_RATED, BD_PACIDHB, 
 BD_OUTPUTHB, BD_AMOUNTTR, BD_ORIGSUBMIT, BD_BILLID)
BEQUEATH DEFINER
AS 
SELECT
    "BD_ID","BD_SRCTYPE","BD_DATETIME","BD_DEMO","BD_BIHID","BD_MAPSID","BD_BIRECNO","BD_BOHID1","BD_PACSID1","BD_BORECNO1","BD_BOHID2","BD_PACSID2","BD_BORECNO2","BD_BOHID3","BD_PACSID3","BD_BORECNO3","BD_CONID"
    ,NULL "BD_PMVID"
    ,"BD_TARID","BD_NPI_A","BD_TON_A","BD_PID_A","BD_MSISDN_A","BD_TON_B","BD_NPI_B","BD_PID_B","BD_MSISDN_B","BD_IMSI","BD_LENGTH","BD_PREPAID"
    ,NULL "BD_NETWORK"
    ,NULL "BD_NODENAME"
    ,NULL "BD_SERVICE"
    ,"BD_SHORTID"
    ,NULL "BD_ITEMNO"
    ,NULL "BD_KEYWORD"
    ,NULL "BD_LANGID"
    ,NULL "BD_REQTYPE"
    ,NULL "BD_BILLRATE"
    ,"BD_AMOUNTCU","BD_RETSHAREPV","BD_RETSHAREMO","BD_VSMSCID","BD_CONSOLIDATION","BD_STATUS"
    ,NULL "BD_TERMDATE"
    ,NULL "BD_SETTLING"
    ,NULL "BD_SETID"
    ,NULL "BD_STORAGE"
    ,NULL "BD_DBIDSTORE"
    ,NULL "BD_DATESTORE"
    ,NULL "BD_ARCHIVE"
    ,NULL "BD_DBIDARCH"
    ,NULL "BD_DATEARCH"
    ,NULL "BD_REQUESTID"
    ,NULL "BD_RECTYPE"
    ,NULL "BD_IDENTITY"
    ,NULL "BD_REQSERV"
    ,NULL "BD_SUBSERV"
    ,NULL "BD_OPERATION"
    ,NULL "BD_MULTSM"
    ,NULL "BD_SMSEQ"
    ,NULL "BD_ANSTYPE"
    ,NULL "BD_RETCODE"
    ,NULL "BD_RESPMEDIA"
    ,NULL "BD_SMSCRESP"
    ,NULL "BD_TMINODE"
    ,NULL "BD_REQID"
    ,NULL "BD_SERVKEY"
    ,"BD_TOCID","BD_IOT","BD_INT","BD_OGTI","BD_ZNID","BD_CDRTID","BD_IW","BD_ERRID","BD_BILLED","BD_RATED","BD_PACIDHB","BD_OUTPUTHB","BD_AMOUNTTR","BD_ORIGSUBMIT","BD_BILLID"
FROM BDETAIL1 WHERE
        BD_NPI_B IN ('1')
    AND BD_PID_B IN ('0')
    AND BD_CONSOLIDATION IN ('9277','30050','30051','30054','30055','30056','30057','30058')
UNION
SELECT
    "BD_ID","BD_SRCTYPE","BD_DATETIME","BD_DEMO","BD_BIHID","BD_MAPSID","BD_BIRECNO","BD_BOHID1","BD_PACSID1","BD_BORECNO1","BD_BOHID2","BD_PACSID2","BD_BORECNO2","BD_BOHID3","BD_PACSID3","BD_BORECNO3","BD_CONID"
    ,NULL "BD_PMVID"
    ,"BD_TARID","BD_NPI_A","BD_TON_A","BD_PID_A","BD_MSISDN_A","BD_TON_B","BD_NPI_B","BD_PID_B","BD_MSISDN_B","BD_IMSI","BD_LENGTH","BD_PREPAID"
    ,NULL "BD_NETWORK"
    ,NULL "BD_NODENAME"
    ,NULL "BD_SERVICE"
    ,"BD_SHORTID"
    ,NULL "BD_ITEMNO"
    ,NULL "BD_KEYWORD"
    ,NULL "BD_LANGID"
    ,"BD_REQTYPE","BD_BILLRATE","BD_AMOUNTCU","BD_RETSHAREPV","BD_RETSHAREMO","BD_VSMSCID","BD_CONSOLIDATION","BD_STATUS"
    ,NULL "BD_TERMDATE"
    ,NULL "BD_SETTLING"
    ,NULL "BD_SETID"
    ,NULL "BD_STORAGE"
    ,NULL "BD_DBIDSTORE"
    ,NULL "BD_DATESTORE"
    ,NULL "BD_ARCHIVE"
    ,NULL "BD_DBIDARCH"
    ,NULL "BD_DATEARCH"
    ,NULL "BD_REQUESTID"
    ,NULL "BD_RECTYPE"
    ,NULL "BD_IDENTITY"
    ,NULL "BD_REQSERV"
    ,NULL "BD_SUBSERV"
    ,NULL "BD_OPERATION"
    ,NULL "BD_MULTSM"
    ,NULL "BD_SMSEQ"
    ,NULL "BD_ANSTYPE"
    ,NULL "BD_RETCODE"
    ,NULL "BD_RESPMEDIA"
    ,NULL "BD_SMSCRESP"
    ,NULL "BD_TMINODE"
    ,NULL "BD_REQID"
    ,NULL "BD_SERVKEY"
    ,"BD_TOCID","BD_IOT","BD_INT","BD_OGTI","BD_ZNID","BD_CDRTID","BD_IW","BD_ERRID","BD_BILLED","BD_RATED","BD_PACIDHB","BD_OUTPUTHB",NULL,"BD_ORIGSUBMIT","BD_BILLID"
FROM BDETAIL2 WHERE
        BD_NPI_B IN ('1')
    AND BD_PID_B IN ('0')
    AND BD_CONSOLIDATION IN ('9277','30050','30051','30054','30055','30056','30057','30058');


/* This object may not be sorted properly in the script due to cirular references. */
--
-- BDETAIL_RA_CHECK  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.BDETAIL_RA_CHECK
(BD_BIHID, BD_TABLE, BD_ROWID, BD_DATETIME, SIGNATURE)
BEQUEATH DEFINER
AS 
select
    /*+ INDEX(BDETAIL1 IDX_BD_BIHID1) */
      BD_BIHID
      ,
      'BDETAIL1' AS BD_TABLE
      ,
      ROWID AS BD_ROWID
      ,
      BD_DATETIME
      ,
          DECODE
            (
            BD_AMOUNTCU,0.0,'0','1' 
            ) 
        ||
        BD_BILLED
        ||
          DECODE
            (
            UPPER(BD_PACIDHB),'MOCONTCH','1','0' 
            ) 
        ||
        BD_MAPSID
        ||
          DECODE
            (
            BD_NPI_A || BD_PID_A,'10','O','T' 
            ) 
        ||
          DECODE
            (
            SUBSTR(DECODE(BD_NPI_A || BD_PID_A,'10',BD_MSISDN_A,BD_MSISDN_B),1,5),'42377','F','S' 
            ) 
        ||
          NVL(BD_PREPAID,'-') 
        ||
          DECODE
            (
            UPPER(NVL(BD_TARID,'-')),'A','L','B','L','C','L','D','L','E','L','F','L','G','L','H','L',UPPER(NVL(BD_TARID,'-')) 
            ) 
        ||
        BD_STATUS
        ||
          DECODE
            (
            SUBSTR(BD_OGTI,1,4),'4179','S',NULL,'S','F' 
            ) as Signature
    from
      BDETAIL1
  union all
  select
    /*+ INDEX(BDETAIL2 IDX_BD_BIHID2) */
      BD_BIHID
      ,
      'BDETAIL2'
      ,
      ROWID
      ,
      BD_DATETIME
      ,
          DECODE
            (
            BD_AMOUNTCU,0.0,'0','1' 
            ) 
        ||
        BD_BILLED
        ||
          DECODE
            (
            UPPER(BD_PACIDHB),'MOCONTCH','1','0' 
            ) 
        ||
        BD_MAPSID
        ||
          DECODE
            (
            BD_NPI_A || BD_PID_A,'10','O','T' 
            ) 
        ||
          DECODE
            (
            SUBSTR(DECODE(BD_NPI_A || BD_PID_A,'10',BD_MSISDN_A,BD_MSISDN_B),1,5),'42377','F','S' 
            ) 
        ||
          NVL(BD_PREPAID,'-') 
        ||
          DECODE
            (
            UPPER(NVL(BD_TARID,'-')),'A','L','B','L','C','L','D','L','E','L','F','L','G','L','H','L',UPPER(NVL(BD_TARID,'-')) 
            ) 
        ||
        BD_STATUS
        ||
          DECODE
            (
            SUBSTR(BD_OGTI,1,4),'4179','S',NULL,'S','F' 
            ) 
    from
      BDETAIL2;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- BD_RECENT_BDETAIL  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.BD_RECENT_BDETAIL
(BD_ID, BD_SRCTYPE, BD_DATETIME, BD_DEMO, BD_BIHID, 
 BD_MAPSID, BD_BIRECNO, BD_CONID, BD_MSISDN_A, BD_LENGTH, 
 BD_PREPAID, BD_NODENAME, BD_SERVICE, BD_SHORTID, BD_ITEMNO, 
 BD_KEYWORD, BD_LANGID, BD_REQTYPE, BD_BILLRATE, BD_AMOUNTCU, 
 BD_RETSHAREPV, BD_RETSHAREMO, BD_STATUS, BD_BILLTEXT, BD_LOCATION, 
 BD_INFO, BD_ZNID, BD_NETWORK, BD_TPID, BD_STYPE, 
 BD_BILLTIME, BD_MSGID, BD_TRCLASS, BD_AMOUNTTR, BD_CDRTID, 
 BD_INT, BD_IW, BD_AAATS, BD_CONSTID, BD_ERRID, 
 BD_BILLED, BD_RATED, BD_PACIDHB, BD_OUTPUTHB, BD_BILLINGDOMAIN, 
 BD_TRANSPORTMEDIUM, BD_CATEGORY, BD_TAXRATE, BD_TESTMODE, BD_REQUESTID, 
 BD_COUNTTR, BD_VSPRCID, BD_ORIGSUBMIT)
BEQUEATH DEFINER
AS 
SELECT /*+ INDEX (BDETAIL IDX_BD_BIHID) */
	BD_ID,
	BD_SRCTYPE,
	BD_DATETIME,
	BD_DEMO,
	BD_BIHID,
	BD_MAPSID,
	BD_BIRECNO,
	BD_CONID,
	BD_MSISDN_A,
	BD_LENGTH,
	BD_PREPAID,
	BD_NODENAME,
	BD_SERVICE,
	BD_SHORTID,
	BD_ITEMNO,
	BD_KEYWORD,
	BD_LANGID,
	BD_REQTYPE,
	BD_BILLRATE,
	BD_AMOUNTCU,
	BD_RETSHAREPV,
	BD_RETSHAREMO,
	BD_STATUS,
	BD_BILLTEXT,
	BD_LOCATION,
	BD_INFO,
	BD_ZNID,
	BD_NETWORK,
	BD_TPID,
	BD_STYPE,
	BD_BILLTIME,
	BD_MSGID,
	BD_TRCLASS,
	BD_AMOUNTTR,
	BD_CDRTID,
	BD_INT,
	BD_IW,
	BD_AAATS,
	BD_CONSTID,
	BD_ERRID,
	BD_BILLED,
	BD_RATED,
	BD_PACIDHB,
	BD_OUTPUTHB,
	BD_BILLINGDOMAIN,
	BD_TRANSPORTMEDIUM,
	BD_CATEGORY,
	BD_TAXRATE,
	BD_TESTMODE,
	BD_REQUESTID,
	BD_COUNTTR,
	BD_VSPRCID,
	BD_ORIGSUBMIT
FROM
	BDETAIL
WHERE
	BD_BIHID IN (SELECT   BIH_ID  FROM   BIHEADER  WHERE    BIH_DATETIME >= sysdate-1/24   AND BIH_MAPID IN ('MEC')   AND BIH_SRCTYPE <> 'MSC'   AND BIH_SRCTYPE <> 'SMSC'   AND BIH_SRCTYPE <> 'POS'   AND BIH_SRCTYPE <> 'MMSC')
AND BD_DATETIME >= sysdate - 15
AND BD_DATETIME < sysdate;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- BD_RECENT_BDETAIL1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.BD_RECENT_BDETAIL1
(BD_ID, BD_SRCTYPE, BD_DATETIME, BD_DEMO, BD_BIHID, 
 BD_MAPSID, BD_BIRECNO, BD_BOHID1, BD_PACSID1, BD_BOHID2, 
 BD_PACSID2, BD_BOHID3, BD_PACSID3, BD_CONID, BD_TARID, 
 BD_NPI_A, BD_TON_A, BD_PID_A, BD_MSISDN_A, BD_TON_B, 
 BD_NPI_B, BD_PID_B, BD_MSISDN_B, BD_IMSI, BD_LENGTH, 
 BD_PREPAID, BD_AMOUNTCU, BD_RETSHAREPV, BD_RETSHAREMO, BD_VSMSCID, 
 BD_CONSOLIDATION, BD_STATUS, BD_TOCID, BD_IOT, BD_INT, 
 BD_OGTI, BD_ZNID, BD_CDRTID, BD_IW, BD_ERRID, 
 BD_BILLED, BD_RATED, BD_PACIDHB, BD_OUTPUTHB, BD_AMOUNTTR, 
 BD_ORIGSUBMIT, BD_BILLID, BD_VSPRCID, BD_ONLINECHARGE, BD_MESSAGEREFERENCE, 
 BD_DGTI)
BEQUEATH DEFINER
AS 
SELECT      /*+ ORDERED */
    BD_ID,
    BD_SRCTYPE,
    BD_DATETIME,
    BD_DEMO,
    BD_BIHID,
    BD_MAPSID,
    BD_BIRECNO,
    BD_BOHID1,
    BD_PACSID1,
    BD_BOHID2,
    BD_PACSID2,
    BD_BOHID3,
    BD_PACSID3,
    BD_CONID,
    BD_TARID,
    BD_NPI_A,
    BD_TON_A,
    BD_PID_A,
    BD_MSISDN_A,
    BD_TON_B,
    BD_NPI_B,
    BD_PID_B,
    BD_MSISDN_B,
    BD_IMSI,
    BD_LENGTH,
    BD_PREPAID,
    BD_AMOUNTCU,
    BD_RETSHAREPV,
    BD_RETSHAREMO,
    BD_VSMSCID,
    BD_CONSOLIDATION,
    BD_STATUS,
    BD_TOCID,
    BD_IOT,
    BD_INT,
    BD_OGTI,
    BD_ZNID,
    BD_CDRTID,
    BD_IW,
    BD_ERRID,
    BD_BILLED,
    BD_RATED,
    BD_PACIDHB,
    BD_OUTPUTHB,
    BD_AMOUNTTR,
    BD_ORIGSUBMIT,
    BD_BILLID,
    BD_VSPRCID,
    BD_ONLINECHARGE,
    BD_MESSAGEREFERENCE,
    BD_DGTI
FROM
    BDETAIL1
WHERE
    BD_BIHID IN  (SELECT   UPPER(BIH_ID)  FROM   BIHEADER  WHERE    BIH_DATETIME >= sysdate - 1/24 AND BIH_MAPID IN ('MEC')   AND BIH_SRCTYPE = 'SMSC'   AND BIH_RECCOUNT <> 0)
AND BD_DATETIME >= sysdate - 15
AND BD_DATETIME < sysdate;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- BD_RECENT_BDETAIL2  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.BD_RECENT_BDETAIL2
(BD_ID, BD_SRCTYPE, BD_DATETIME, BD_DEMO, BD_BIHID, 
 BD_MAPSID, BD_BIRECNO, BD_BOHID1, BD_PACSID1, BD_BOHID2, 
 BD_PACSID2, BD_BOHID3, BD_PACSID3, BD_CONID, BD_TARID, 
 BD_NPI_A, BD_TON_A, BD_PID_A, BD_MSISDN_A, BD_TON_B, 
 BD_NPI_B, BD_PID_B, BD_MSISDN_B, BD_IMSI, BD_LENGTH, 
 BD_PREPAID, BD_AMOUNTCU, BD_RETSHAREPV, BD_RETSHAREMO, BD_VSMSCID, 
 BD_CONSOLIDATION, BD_STATUS, BD_TOCID, BD_IOT, BD_INT, 
 BD_OGTI, BD_ZNID, BD_CDRTID, BD_IW, BD_ERRID, 
 BD_BILLED, BD_RATED, BD_PACIDHB, BD_OUTPUTHB, BD_AMOUNTTR, 
 BD_ORIGSUBMIT, BD_BILLID, BD_VSPRCID)
BEQUEATH DEFINER
AS 
SELECT      /*+ ORDERED */
    BD_ID,
    BD_SRCTYPE,
    BD_DATETIME,
    BD_DEMO,
    BD_BIHID,
    BD_MAPSID,
    BD_BIRECNO,
    BD_BOHID1,
    BD_PACSID1,
    BD_BOHID2,
    BD_PACSID2,
    BD_BOHID3,
    BD_PACSID3,
    BD_CONID,
    BD_TARID,
    BD_NPI_A,
    BD_TON_A,
    BD_PID_A,
    BD_MSISDN_A,
    BD_TON_B,
    BD_NPI_B,
    BD_PID_B,
    BD_MSISDN_B,
    BD_IMSI,
    BD_LENGTH,
    BD_PREPAID,
    BD_AMOUNTCU,
    BD_RETSHAREPV,
    BD_RETSHAREMO,
    BD_VSMSCID,
    BD_CONSOLIDATION,
    BD_STATUS,
    BD_TOCID,
    BD_IOT,
    BD_INT,
    BD_OGTI,
    BD_ZNID,
    BD_CDRTID,
    BD_IW,
    BD_ERRID,
    BD_BILLED,
    BD_RATED,
    BD_PACIDHB,
    BD_OUTPUTHB,
    NULL BD_AMOUNTTR,
    BD_ORIGSUBMIT,
    BD_BILLID,
    BD_VSPRCID
FROM
    BDETAIL2
WHERE
    BD_BIHID IN  (SELECT   UPPER(BIH_ID)  FROM   BIHEADER  WHERE    BIH_DATETIME >= sysdate - 1/24 AND BIH_MAPID IN ('MEC')   AND BIH_SRCTYPE = 'SMSC'   AND BIH_RECCOUNT <> 0)
AND BD_DATETIME >= sysdate - 15
AND BD_DATETIME < sysdate;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- BD_RECENT_BDETAIL4  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.BD_RECENT_BDETAIL4
(BD_ID, BD_SRCTYPE, BD_DEMO, BD_BIHID, BD_MAPSID, 
 BD_BIRECNO, BD_BOHID1, BD_PACSID1, BD_BOHID2, BD_PACSID2, 
 BD_BOHID3, BD_PACSID3, BD_DATETIME, BD_CDRTID, BD_MSISDN_A, 
 BD_MSISDN_B, BD_IMSI, BD_IMEI, BD_EXID, BD_MSCID, 
 BD_SMSCID, BD_ROUTE, BD_CELL, BD_TSC, BD_SCA, 
 BD_POWER, BD_SUBTYPE, BD_PREPAID, BD_ZNID, BD_TOCID, 
 BD_SHORTID, BD_AMOUNTCU, BD_RETSHAREMO, BD_RETSHAREPV, BD_CONID, 
 BD_ERRID, BD_BILLED, BD_RATED, BD_PACIDHB, BD_OUTPUTHB, 
 BD_TARID, BD_PMVID, BD_ORIGSUBMITTIME, BD_VSPRCID)
BEQUEATH DEFINER
AS 
SELECT		/*+ ORDERED */
"BD_ID","BD_SRCTYPE","BD_DEMO","BD_BIHID","BD_MAPSID","BD_BIRECNO","BD_BOHID1","BD_PACSID1","BD_BOHID2","BD_PACSID2","BD_BOHID3","BD_PACSID3","BD_DATETIME","BD_CDRTID","BD_MSISDN_A","BD_MSISDN_B","BD_IMSI","BD_IMEI","BD_EXID","BD_MSCID","BD_SMSCID","BD_ROUTE","BD_CELL","BD_TSC","BD_SCA","BD_POWER","BD_SUBTYPE","BD_PREPAID","BD_ZNID","BD_TOCID","BD_SHORTID","BD_AMOUNTCU","BD_RETSHAREMO","BD_RETSHAREPV","BD_CONID","BD_ERRID","BD_BILLED","BD_RATED","BD_PACIDHB","BD_OUTPUTHB","BD_TARID","BD_PMVID","BD_ORIGSUBMITTIME","BD_VSPRCID"
FROM
	BDETAIL4
WHERE
	BD_BIHID IN  (SELECT   UPPER(BIH_ID)  FROM   BIHEADER  WHERE    BIH_DATETIME >= sysdate - 1/24 AND BIH_MAPID IN ('MEC')   AND BIH_SRCTYPE = 'MSC'   AND BIH_RECCOUNT <> 0)
AND BD_DATETIME >= sysdate - 15
AND BD_DATETIME < sysdate;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- BD_RECENT_BDETAIL6  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.BD_RECENT_BDETAIL6
(BD_ID, BD_SRCTYPE, BD_DEMO, BD_BIHID, BD_MAPSID, 
 BD_BIRECNO, BD_BOHID1, BD_PACSID1, BD_BOHID2, BD_PACSID2, 
 BD_BOHID3, BD_PACSID3, BD_DATETIME, BD_MSISDN_A, BD_MSISDN_B, 
 BD_LAYERSPECATTR, BD_MSGTYPE, BD_MSGSIZE, BD_STORAGEDURATION, BD_DATEDELIVERYFUTURE, 
 BD_DATEDELIVERY, BD_DATESUBMIT, BD_DATEEXPIRE, BD_MSGPRIORITY, BD_MSGCLASS, 
 BD_MSGCONTENT, BD_UMSGGRPID, BD_NUMNOTIFICATION, BD_MMSIDENTIFIER, BD_CDRRECTYPE, 
 BD_FWDCOPYIND, BD_ACCCORRID, BD_PREPAID, BD_EVENTDISP, BD_OUTID, 
 BD_INID, BD_PRICE, BD_REQUESTIND, BD_PARTYTOCHARGE, BD_LEGACYINDICATOR, 
 BD_NUMHOMERECIP, BD_NUMNONHOMERECIP, BD_NUMINTLRECIP, BD_NUMEMAILRECIP, BD_NUMSCODERECIP, 
 BD_NUMCONVERSION, BD_FREETEXT, BD_IMSI, BD_ZNID, BD_AMOUNTCU, 
 BD_AMOUNTPV, BD_AMOUNTMO, BD_CDRTID, BD_LENGTH, BD_SHORTID, 
 BD_CONID, BD_TARID, BD_TRCLASS, BD_TRCLASSIW, BD_TOCID, 
 BD_INT, BD_IW, BD_ERRID, BD_BILLED, BD_RATED, 
 BD_PACIDHB, BD_OUTPUTHB, BD_MM7LINKEDID, BD_PREPAIDFREETEXT, BD_PROMOTIONPLAN, 
 BD_TARIFFCLASS, BD_ROAMINGINFO, BD_DESTINATIONIMSI, BD_AMOUNTTR, BD_COUNTTR, 
 BD_PMVID, BD_RECIPCOUNT, BD_MMSSZID, BD_MMSDZID, BD_MMSRCCID, 
 BD_MMSDCCID, BD_MMSRZID1, BD_MMSRZID2, BD_RECIPINDEX, BD_RETSHAREPV, 
 BD_RETSHAREMO, BD_IOT, BD_VSPRCID)
BEQUEATH DEFINER
AS 
SELECT		/*+ ORDERED */
"BD_ID","BD_SRCTYPE","BD_DEMO","BD_BIHID","BD_MAPSID","BD_BIRECNO","BD_BOHID1","BD_PACSID1","BD_BOHID2","BD_PACSID2","BD_BOHID3","BD_PACSID3","BD_DATETIME","BD_MSISDN_A","BD_MSISDN_B","BD_LAYERSPECATTR","BD_MSGTYPE","BD_MSGSIZE","BD_STORAGEDURATION","BD_DATEDELIVERYFUTURE","BD_DATEDELIVERY","BD_DATESUBMIT","BD_DATEEXPIRE","BD_MSGPRIORITY","BD_MSGCLASS","BD_MSGCONTENT","BD_UMSGGRPID","BD_NUMNOTIFICATION","BD_MMSIDENTIFIER","BD_CDRRECTYPE","BD_FWDCOPYIND","BD_ACCCORRID","BD_PREPAID","BD_EVENTDISP","BD_OUTID","BD_INID","BD_PRICE","BD_REQUESTIND","BD_PARTYTOCHARGE","BD_LEGACYINDICATOR","BD_NUMHOMERECIP","BD_NUMNONHOMERECIP","BD_NUMINTLRECIP","BD_NUMEMAILRECIP","BD_NUMSCODERECIP","BD_NUMCONVERSION","BD_FREETEXT","BD_IMSI","BD_ZNID","BD_AMOUNTCU","BD_AMOUNTPV","BD_AMOUNTMO","BD_CDRTID","BD_LENGTH","BD_SHORTID","BD_CONID","BD_TARID","BD_TRCLASS","BD_TRCLASSIW","BD_TOCID","BD_INT","BD_IW","BD_ERRID","BD_BILLED","BD_RATED","BD_PACIDHB","BD_OUTPUTHB","BD_MM7LINKEDID","BD_PREPAIDFREETEXT","BD_PROMOTIONPLAN","BD_TARIFFCLASS","BD_ROAMINGINFO","BD_DESTINATIONIMSI","BD_AMOUNTTR","BD_COUNTTR","BD_PMVID","BD_RECIPCOUNT","BD_MMSSZID","BD_MMSDZID","BD_MMSRCCID","BD_MMSDCCID","BD_MMSRZID1","BD_MMSRZID2","BD_RECIPINDEX","BD_RETSHAREPV","BD_RETSHAREMO","BD_IOT","BD_VSPRCID"
FROM
	BDETAIL6
WHERE
	BD_BIHID IN  (SELECT   UPPER(BIH_ID)  FROM   BIHEADER  WHERE    BIH_DATETIME >= sysdate - 1/24 AND BIH_MAPID IN ('MEC')   AND BIH_SRCTYPE = 'MMSC'   AND BIH_RECCOUNT <> 0)
AND BD_DATETIME >= sysdate - 15
AND BD_DATETIME < sysdate;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- BD_RECENT_BDETAIL9  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.BD_RECENT_BDETAIL9
(BD_ID, BD_SRCTYPE, BD_DEMO, BD_BIHID, BD_MAPSID, 
 BD_BIRECNO, BD_BOHID1, BD_PACSID1, BD_BORECNO1, BD_BOHID2, 
 BD_PACSID2, BD_BORECNO2, BD_BOHID3, BD_PACSID3, BD_BORECNO3, 
 BD_DATETIME, BD_OFFSET, BD_NUMMSG, BD_CALLTYPE, BD_MSISDN, 
 BD_CGI, BD_GSMPI, BD_REMARK, BD_RATEDUNITS, BD_UTXPARAMS, 
 BD_PREPAID, BD_AMOUNTCU, BD_CDRTID, BD_INT, BD_IW, 
 BD_AAATS, BD_CONSTID, BD_ERRID, BD_BILLED, BD_RATED, 
 BD_PACIDHB, BD_OUTPUTHB, BD_VSPRCID)
BEQUEATH DEFINER
AS 
SELECT		/*+ ORDERED */
"BD_ID","BD_SRCTYPE","BD_DEMO","BD_BIHID","BD_MAPSID","BD_BIRECNO","BD_BOHID1","BD_PACSID1","BD_BORECNO1","BD_BOHID2","BD_PACSID2","BD_BORECNO2","BD_BOHID3","BD_PACSID3","BD_BORECNO3","BD_DATETIME","BD_OFFSET","BD_NUMMSG","BD_CALLTYPE","BD_MSISDN","BD_CGI","BD_GSMPI","BD_REMARK","BD_RATEDUNITS","BD_UTXPARAMS","BD_PREPAID","BD_AMOUNTCU","BD_CDRTID","BD_INT","BD_IW","BD_AAATS","BD_CONSTID","BD_ERRID","BD_BILLED","BD_RATED","BD_PACIDHB","BD_OUTPUTHB","BD_VSPRCID"
FROM
	BDETAIL9
WHERE
	BD_BIHID IN  (SELECT   UPPER(BIH_ID)  FROM   BIHEADER  WHERE    BIH_DATETIME >= sysdate - 1/24 AND BIH_MAPID IN ('MEC')   AND BIH_SRCTYPE = 'POS'   AND BIH_RECCOUNT <> 0)
AND BD_DATETIME >= sysdate - 15
AND BD_DATETIME < sysdate;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- BD_RECENT_VAS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.BD_RECENT_VAS
(BD_ID, BD_SRCTYPE, BD_DATETIME, BD_DEMO, BD_BIHID, 
 BD_MAPSID, BD_BIRECNO, BD_CONID, BD_MSISDN_A, BD_LENGTH, 
 BD_PREPAID, BD_NODENAME, BD_SERVICE, BD_SHORTID, BD_ITEMNO, 
 BD_KEYWORD, BD_LANGID, BD_REQTYPE, BD_BILLRATE, BD_AMOUNTCU, 
 BD_RETSHAREPV, BD_RETSHAREMO, BD_STATUS, BD_BILLTEXT, BD_LOCATION, 
 BD_INFO, BD_ZNID, BD_NETWORK, BD_TPID, BD_STYPE, 
 BD_BILLTIME, BD_MSGID, BD_TRCLASS, BD_AMOUNTTR, BD_CDRTID, 
 BD_INT, BD_IW, BD_AAATS, BD_CONSTID, BD_ERRID, 
 BD_BILLED, BD_RATED, BD_PACIDHB, BD_OUTPUTHB, BD_BILLINGDOMAIN, 
 BD_TRANSPORTMEDIUM, BD_CATEGORY, BD_TAXRATE, BD_TESTMODE, BD_REQUESTID, 
 BD_COUNTTR, BD_VSPRCID, BD_ORIGSUBMIT)
BEQUEATH DEFINER
AS 
SELECT /*+ INDEX (BDETAIL IDX_BD_BIHID) */
	BD_ID,
	BD_SRCTYPE,
	BD_DATETIME,
	BD_DEMO,
	BD_BIHID,
	BD_MAPSID,
	BD_BIRECNO,
	BD_CONID,
	BD_MSISDN_A,
	BD_LENGTH,
	BD_PREPAID,
	BD_NODENAME,
	BD_SERVICE,
	BD_SHORTID,
	BD_ITEMNO,
	BD_KEYWORD,
	BD_LANGID,
	BD_REQTYPE,
	BD_BILLRATE,
	BD_AMOUNTCU,
	BD_RETSHAREPV,
	BD_RETSHAREMO,
	BD_STATUS,
	BD_BILLTEXT,
	BD_LOCATION,
	BD_INFO,
	BD_ZNID,
	BD_NETWORK,
	BD_TPID,
	BD_STYPE,
	BD_BILLTIME,
	BD_MSGID,
	BD_TRCLASS,
	BD_AMOUNTTR,
	BD_CDRTID,
	BD_INT,
	BD_IW,
	BD_AAATS,
	BD_CONSTID,
	BD_ERRID,
	BD_BILLED,
	BD_RATED,
	BD_PACIDHB,
	BD_OUTPUTHB,
	BD_BILLINGDOMAIN,
	BD_TRANSPORTMEDIUM,
	BD_CATEGORY,
	BD_TAXRATE,
	BD_TESTMODE,
	BD_REQUESTID,
	BD_COUNTTR,
	BD_VSPRCID,
	BD_ORIGSUBMIT
FROM
	BDETAIL
WHERE
	BD_BIHID IN (SELECT   BIH_ID  FROM   BIHEADER  WHERE    BIH_DATETIME >= sysdate-4/24   AND BIH_MAPID IN ('MEC')   AND BIH_SRCTYPE <> 'MSC'   AND BIH_SRCTYPE <> 'SMSC'   AND BIH_SRCTYPE <> 'POS'   AND BIH_SRCTYPE <> 'MMSB'   AND BIH_SRCTYPE <> 'MMSC')
AND BD_DATETIME >= sysdate - 10
AND BD_DATETIME < sysdate;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- CDRMMS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.CDRMMS
(ROWID_PPB, MS_ID, STARTDATETIME, CALLTYPE, SEQ_NR, 
 FIL_ID, REC_NBR, ACCOUNT_DATE, CALLING_NR, CALLED_NR, 
 IMSI, IMEI, BILL_RATE, UNIT, DST_ID, 
 BOK_ID, TARIFF_TYPE, RATE, DISCOUNT_FLAGS, EXCHANGE_ID, 
 OGTI, BILLING_DOMAIN, TRANSPORT_MEDIUM, VOLUME, REQUEST_ID, 
 SHORT_ID, REQUESTED_ITEM_TEXT, CATEGORY, DISCOUNT_ID, DISCOUNT_REASON, 
 BALANCE, COUNTER_ID, COUNTER, COUNTER_STARTDATE, COUNTER_ENDDATE, 
 ISCP_ID, ISCP_NODE)
BEQUEATH DEFINER
AS 
SELECT ROWID,
          MS_ID,
          STARTDATETIME,
          CALLTYPE,
          SEQ_NR,
          FIL_ID,
          REC_NBR,
          ACCOUNT_DATE,
          CALLING_NR,
          CALLED_NR,
          IMSI,
          IMEI,
          BILL_RATE,
          UNIT,
          DST_ID,
          BOK_ID,
          TARIFF_TYPE,
          RATE,
          DISCOUNT_FLAGS,
          EXCHANGE_ID,
          OGTI,
          BILLING_DOMAIN,
          TRANSPORT_MEDIUM,
          VOLUME,
          REQUEST_ID,
          SHORT_ID,
          REQUESTED_ITEM_TEXT,
          CATEGORY,
          DISCOUNT_ID,
          DISCOUNT_REASON,
          BALANCE,
          COUNTER_ID,
          COUNTER,
          COUNTER_STARTDATE,
          COUNTER_ENDDATE,
          ISCP_ID,
          ISCP_NODE
     FROM PPB_CDRMMS;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- CDRSMS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.CDRSMS
(ROWID_PPB, MS_ID, STARTDATETIME, CALLTYPE, SEQ_NR, 
 FIL_ID, REC_NBR, ACCOUNT_DATE, CALLING_NR, CALLED_NR, 
 IMSI, IMEI, BILL_RATE, UNIT, DST_ID, 
 RATE, TARIFF_TYPE, BOK_ID, EXCHANGE_ID, OGTI, 
 BILLING_DOMAIN, TRANSPORT_MEDIUM, REQUEST_ID, SHORT_ID, REQUESTED_ITEM_TEXT, 
 CATEGORY, DISCOUNT_ID, DISCOUNT_FLAGS, DISCOUNT_REASON, BALANCE, 
 COUNTER_ID, COUNTER, COUNTER_STARTDATE, COUNTER_ENDDATE, ISCP_ID, 
 ISCP_NODE)
BEQUEATH DEFINER
AS 
SELECT ROWID,
          ms_id,
          startdatetime,
          calltype,
          seq_nr,
          fil_id,
          rec_nbr,
          account_date,
          calling_nr,
          called_nr,
          imsi,
          imei,
          bill_rate,
          unit,
          dst_id,
          rate,
          tariff_type,
          bok_id,
          exchange_id,
          ogti,
          billing_domain,
          transport_medium,
          request_id,
          short_id,
          requested_item_text,
          category,
          discount_id,
          discount_flags,
          discount_reason,
          balance,
          counter_id,
          counter,
          counter_startdate,
          counter_enddate,
          ISCP_ID,
          ISCP_NODE
     FROM PPB_CDRSMS;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- CDR_SUMMARY_BILLRATE_N  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.CDR_SUMMARY_BILLRATE_N
(DATE1, DATE2, BD_SRCTYPE, BD_SERVICE, BD_CONID, 
 CON_NAME, CON_ACNAME, BD_BILLRATE, BD_COUNT, BD_AMOUNTCU, 
 BD_RETSHAREPV, BD_RETSHAREMO)
BEQUEATH DEFINER
AS 
SELECT
  TRUNC(ADD_MONTHS(sysdate,-2),'MONTH')         date1,
  LAST_DAY(ADD_MONTHS(trunc(sysdate),-2))       date2,
  BD_SRCTYPE                                    bd_srctype,
  BD_SERVICE                                    bd_service,
  BD_CONID                                      bd_conid,
  NVL(CON_NAME,AC_NAME)                         con_name,
  AC_NAME                                       con_acname,
  NVL(BD_BILLRATE,to_char(10*BD_AMOUNTCU))      bd_billrate,
  COUNT(BDETAIL.ROWID)                          bd_count,
  SUM(BD_AMOUNTCU)                              bd_amountcu,
  SUM(BD_RETSHAREPV)                            bd_retsharepv,
  SUM(BD_RETSHAREMO)                            bd_retsharemo
FROM BDETAIL, CONTRACT, ACCOUNT
  WHERE
    BDETAIL.BD_CONID = CONTRACT.CON_ID
  AND CON_ACID = AC_ID
  AND BD_DATETIME >= TRUNC(ADD_MONTHS(sysdate,-2),'MONTH')
  AND BD_DATETIME < LAST_DAY(ADD_MONTHS(trunc(sysdate),-2)) + 1
  AND NVL(BD_CDRTID,'CTB-CO') = 'CTB-CO'
GROUP
  BY BD_SRCTYPE,
  AC_NAME,
  NVL(CON_NAME,AC_NAME),
  BD_SERVICE,
  BD_CONID,
  NVL(BD_BILLRATE,to_char(10*BD_AMOUNTCU))
UNION
SELECT
  TRUNC(ADD_MONTHS(sysdate,-2),'MONTH'),
  LAST_DAY(ADD_MONTHS(trunc(sysdate),-2)),
  BD_SRCTYPE,
  BD_SERVICE,
  BD_CONID,
  NULL,
  NULL,
  NVL(BD_BILLRATE,to_char(10*BD_AMOUNTCU)),
  COUNT(BDETAIL.ROWID),
  SUM(BD_AMOUNTCU),
  SUM(BD_RETSHAREPV),
  SUM(BD_RETSHAREMO)
FROM  BDETAIL
WHERE
    BDETAIL.BD_CONID IS NULL
  AND BD_DATETIME >= TRUNC(ADD_MONTHS(sysdate,-2),'MONTH')
  AND BD_DATETIME < LAST_DAY(ADD_MONTHS(trunc(sysdate),-2)) + 1
  AND NVL(BD_CDRTID,'CTB-CO') = 'CTB-CO'
GROUP BY
  BD_SRCTYPE,
  BD_SERVICE,
  BD_CONID,
  NVL(BD_BILLRATE,to_char(10*BD_AMOUNTCU));


/* This object may not be sorted properly in the script due to cirular references. */
--
-- CDR_SUMMARY_BILLRATE_NA  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.CDR_SUMMARY_BILLRATE_NA
(DATE1, DATE2, BD_SRCTYPE, BD_SERVICE, BD_CONID, 
 CON_NAME, CON_ACNAME, BD_BILLRATE, BD_COUNT, BD_AMOUNTCU, 
 BD_RETSHAREPV, BD_RETSHAREMO, BD_PREPAID, BD_PRICE)
BEQUEATH DEFINER
AS 
SELECT
  TRUNC(ADD_MONTHS(sysdate,-2),'MONTH')     date1, 
  LAST_DAY(ADD_MONTHS(trunc(sysdate),-2))   date2,
  BD_SRCTYPE                                bd_srctype,
  BD_SERVICE                                bd_service,
  BD_CONID                                  bd_conid,
  NVL(CON_NAME,AC_NAME)                     con_name,
  AC_NAME                                   con_acname,
  NVL(to_char(BD_BILLRATE),LTRIM(to_char(BD_AMOUNTCU,'9990.000')))  bd_billrate,
  COUNT(BDETAIL.ROWID)                      bd_count,
  SUM(BD_AMOUNTCU)                          bd_amountcu,
  SUM(BD_RETSHAREPV)                        bd_retsharepv,
  SUM(BD_RETSHAREMO)                        bd_retsharemo,
  DECODE(BD_PREPAID,'Y','Pre','N','Post','N.A.')  bd_prepaid,
  BD_AMOUNTCU                               bd_price
FROM BDETAIL, CONTRACT, ACCOUNT
  WHERE
    BDETAIL.BD_CONID = CONTRACT.CON_ID
  AND CON_ACID = AC_ID
  AND BD_DATETIME >= TRUNC(ADD_MONTHS(sysdate,-2),'MONTH')
  AND BD_DATETIME < LAST_DAY(ADD_MONTHS(trunc(sysdate),-2)) + 1
  AND BD_MAPSID NOT IN ('M','m')
  AND NVL(BD_CDRTID,'CTB-CO') = 'CTB-CO'
GROUP
  BY BD_SRCTYPE,
  AC_NAME,
  NVL(CON_NAME,AC_NAME),
  BD_SERVICE,
  BD_CONID,
  NVL(to_char(BD_BILLRATE),LTRIM(to_char(BD_AMOUNTCU,'9990.000'))),
  BD_AMOUNTCU,
  BD_PREPAID
UNION
SELECT
  TRUNC(ADD_MONTHS(sysdate,-2),'MONTH'),
  LAST_DAY(ADD_MONTHS(trunc(sysdate),-2)),
  BD_SRCTYPE,
  BD_SERVICE,
  BD_CONID,
  NULL,
  NULL,
  NVL(to_char(BD_BILLRATE),LTRIM(to_char(BD_AMOUNTCU,'9990.000'))),
  COUNT(BDETAIL.ROWID),
  SUM(BD_AMOUNTCU),
  SUM(BD_RETSHAREPV),
  SUM(BD_RETSHAREMO),
  DECODE(BD_PREPAID,'Y','Pre','N','Post','N.A.'),
  BD_AMOUNTCU
FROM  BDETAIL
WHERE
    BDETAIL.BD_CONID IS NULL
  AND BD_DATETIME >= TRUNC(ADD_MONTHS(sysdate,-2),'MONTH')
  AND BD_DATETIME < LAST_DAY(ADD_MONTHS(trunc(sysdate),-2)) + 1
  AND BD_MAPSID NOT IN ('M','m')
  AND NVL(BD_CDRTID,'CTB-CO') = 'CTB-CO'
GROUP BY
  BD_SRCTYPE,
  BD_SERVICE,
  BD_CONID,
  NVL(to_char(BD_BILLRATE),LTRIM(to_char(BD_AMOUNTCU,'9990.000'))),
  BD_AMOUNTCU,
  BD_PREPAID;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- CDR_SUMMARY_BILLRATE_0  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.CDR_SUMMARY_BILLRATE_0
(DATE1, DATE2, BD_SRCTYPE, BD_SERVICE, BD_CONID, 
 CON_NAME, CON_ACNAME, BD_BILLRATE, BD_COUNT, BD_AMOUNTCU, 
 BD_RETSHAREPV, BD_RETSHAREMO, BD_PREPAID, BD_PRICE)
BEQUEATH DEFINER
AS 
SELECT
  TRUNC(ADD_MONTHS(sysdate,0),'MONTH')     date1,
  LAST_DAY(ADD_MONTHS(trunc(sysdate),0))   date2,
  BD_SRCTYPE                                bd_srctype,
  BD_SERVICE                                bd_service,
  BD_CONID                                  bd_conid,
  NVL(CON_NAME,AC_NAME)                     con_name,
  AC_NAME                                   con_acname,
  BD_BILLRATE                               bd_billrate,
  COUNT(BDETAIL.ROWID)                      bd_count,
  SUM(BD_AMOUNTCU)                          bd_amountcu,
  SUM(BD_RETSHAREPV)                        bd_retsharepv,
  SUM(BD_RETSHAREMO)                        bd_retsharemo,
  DECODE(BD_PREPAID,'Y','Pre','N','Post','N.A.')  bd_prepaid,
  BD_AMOUNTCU                               bd_price
FROM BDETAIL, CONTRACT, ACCOUNT
  WHERE
    BDETAIL.BD_CONID = CONTRACT.CON_ID
  AND CON_ACID = AC_ID
  AND BD_DATETIME >= TRUNC(ADD_MONTHS(sysdate,0),'MONTH')
  AND BD_DATETIME < LAST_DAY(ADD_MONTHS(trunc(sysdate),0)) + 1
  AND BD_MAPSID NOT IN ('M','m')
  AND NVL(BD_CDRTID,'CTB-CO') = 'CTB-CO'
GROUP
  BY BD_SRCTYPE,
  AC_NAME,
  NVL(CON_NAME,AC_NAME),
  BD_SERVICE,
  BD_CONID,
  BD_BILLRATE,
  BD_AMOUNTCU,
  BD_PREPAID
UNION
SELECT
  TRUNC(ADD_MONTHS(sysdate,0),'MONTH'),
  LAST_DAY(ADD_MONTHS(trunc(sysdate),0)),
  BD_SRCTYPE,
  BD_SERVICE,
  BD_CONID,
  NULL,
  NULL,
  BD_BILLRATE,
  COUNT(BDETAIL.ROWID),
  SUM(BD_AMOUNTCU),
  SUM(BD_RETSHAREPV),
  SUM(BD_RETSHAREMO),
  DECODE(BD_PREPAID,'Y','Pre','N','Post','N.A.'),
  BD_AMOUNTCU
FROM  BDETAIL
WHERE
    BDETAIL.BD_CONID IS NULL
  AND BD_DATETIME >= TRUNC(ADD_MONTHS(sysdate,0),'MONTH')
  AND BD_DATETIME < LAST_DAY(ADD_MONTHS(trunc(sysdate),0)) + 1
  AND BD_MAPSID NOT IN ('M','m')
  AND NVL(BD_CDRTID,'CTB-CO') = 'CTB-CO'
GROUP BY
  BD_SRCTYPE,
  BD_SERVICE,
  BD_CONID,
  BD_BILLRATE,
  BD_AMOUNTCU,
  BD_PREPAID;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- CDR_SUMMARY_BILLRATE_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.CDR_SUMMARY_BILLRATE_1
(DATE1, DATE2, BD_SRCTYPE, BD_SERVICE, BD_CONID, 
 CON_NAME, CON_ACNAME, BD_BILLRATE, BD_COUNT, BD_AMOUNTCU, 
 BD_RETSHAREPV, BD_RETSHAREMO, BD_PREPAID, BD_PRICE)
BEQUEATH DEFINER
AS 
SELECT
  TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')     date1,
  LAST_DAY(ADD_MONTHS(trunc(sysdate),-1))   date2,
  BD_SRCTYPE                                bd_srctype,
  BD_SERVICE                                bd_service,
  BD_CONID                                  bd_conid,
  NVL(CON_NAME,AC_NAME)                     con_name,
  AC_NAME                                   con_acname,
  NVL(BD_BILLRATE,to_char(10*BD_AMOUNTCU))  bd_billrate,
  COUNT(BDETAIL.ROWID)                      bd_count,
  SUM(BD_AMOUNTCU)                          bd_amountcu,
  SUM(BD_RETSHAREPV)                        bd_retsharepv,
  SUM(BD_RETSHAREMO)                        bd_retsharemo,
  DECODE(BD_PREPAID,'Y','Pre','N','Post','N.A.') bd_prepaid,
  BD_AMOUNTCU                               bd_price
FROM BDETAIL, CONTRACT, ACCOUNT
  WHERE
    BDETAIL.BD_CONID = CONTRACT.CON_ID
  AND CON_ACID = AC_ID
  AND BD_DATETIME >= TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
  AND BD_DATETIME < LAST_DAY(ADD_MONTHS(trunc(sysdate),-1)) + 1
  AND BD_MAPSID NOT IN ('M','m')  
GROUP
  BY BD_SRCTYPE,
  AC_NAME,
  NVL(CON_NAME,AC_NAME),
  BD_SERVICE,
  BD_CONID,
  NVL(BD_BILLRATE,to_char(10*BD_AMOUNTCU)),
  BD_AMOUNTCU,
  BD_PREPAID
UNION
SELECT
  TRUNC(ADD_MONTHS(sysdate,-1),'MONTH'),
  LAST_DAY(ADD_MONTHS(trunc(sysdate),-1)),
  BD_SRCTYPE,
  BD_SERVICE,
  BD_CONID,
  NULL,
  NULL,
  NVL(BD_BILLRATE,to_char(10*BD_AMOUNTCU)),
  COUNT(BDETAIL.ROWID),
  SUM(BD_AMOUNTCU),
  SUM(BD_RETSHAREPV),
  SUM(BD_RETSHAREMO),
  DECODE(BD_PREPAID,'Y','Pre','N','Post','N.A.'),
  BD_AMOUNTCU
FROM  BDETAIL
WHERE
    BDETAIL.BD_CONID IS NULL
  AND BD_DATETIME >= TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
  AND BD_DATETIME < LAST_DAY(ADD_MONTHS(trunc(sysdate),-1)) + 1
  AND BD_MAPSID NOT IN ('M','m')
  AND NVL(BD_CDRTID,'CTB-CO') = 'CTB-CO'
GROUP BY
  BD_SRCTYPE,
  BD_SERVICE,
  BD_CONID,
  NVL(BD_BILLRATE,to_char(10*BD_AMOUNTCU)),
  BD_AMOUNTCU,
  BD_PREPAID;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- CDR_SUMMARY_BILLRATE_1A  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.CDR_SUMMARY_BILLRATE_1A
(DATE1, DATE2, BD_SRCTYPE, BD_SERVICE, BD_CONID, 
 CON_NAME, CON_ACNAME, BD_BILLRATE, BD_COUNT, BD_AMOUNTCU, 
 BD_RETSHAREPV, BD_RETSHAREMO, BD_PREPAID, BD_PRICE)
BEQUEATH DEFINER
AS 
SELECT
  TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')     date1,
  LAST_DAY(ADD_MONTHS(trunc(sysdate),-1))   date2,
  BD_SRCTYPE                                bd_srctype,
  BD_SERVICE                                bd_service,
  BD_CONID                                  bd_conid,
  NVL(CON_NAME,AC_NAME)                     con_name,
  AC_NAME                                   con_acname,
  NVL(to_char(BD_BILLRATE),LTRIM(to_char(BD_AMOUNTCU,'9990.000')))  bd_billrate,
  COUNT(BDETAIL.ROWID)                      bd_count,
  SUM(BD_AMOUNTCU)                          bd_amountcu,
  SUM(BD_RETSHAREPV)                        bd_retsharepv,
  SUM(BD_RETSHAREMO)                        bd_retsharemo,
  DECODE(BD_PREPAID,'Y','Pre','N','Post','N.A.') bd_prepaid,
  BD_AMOUNTCU                               bd_price
FROM BDETAIL, CONTRACT, ACCOUNT
  WHERE
    BDETAIL.BD_CONID = CONTRACT.CON_ID
  AND CON_ACID = AC_ID
  AND BD_DATETIME >= TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
  AND BD_DATETIME < LAST_DAY(ADD_MONTHS(trunc(sysdate),-1)) + 1
  AND BD_MAPSID NOT IN ('M','m')  
GROUP
  BY BD_SRCTYPE,
  AC_NAME,
  NVL(CON_NAME,AC_NAME),
  BD_SERVICE,
  BD_CONID,
  NVL(to_char(BD_BILLRATE),LTRIM(to_char(BD_AMOUNTCU,'9990.000'))),
  BD_AMOUNTCU,
  BD_PREPAID
UNION
SELECT
  TRUNC(ADD_MONTHS(sysdate,-1),'MONTH'),
  LAST_DAY(ADD_MONTHS(trunc(sysdate),-1)),
  BD_SRCTYPE,
  BD_SERVICE,
  BD_CONID,
  NULL,
  NULL,
  NVL(to_char(BD_BILLRATE),LTRIM(to_char(BD_AMOUNTCU,'9990.000'))),
  COUNT(BDETAIL.ROWID),
  SUM(BD_AMOUNTCU),
  SUM(BD_RETSHAREPV),
  SUM(BD_RETSHAREMO),
  DECODE(BD_PREPAID,'Y','Pre','N','Post','N.A.'),
  BD_AMOUNTCU
FROM  BDETAIL
WHERE
    BDETAIL.BD_CONID IS NULL
  AND BD_DATETIME >= TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
  AND BD_DATETIME < LAST_DAY(ADD_MONTHS(trunc(sysdate),-1)) + 1
  AND BD_MAPSID NOT IN ('M','m')
  AND NVL(BD_CDRTID,'CTB-CO') = 'CTB-CO'
GROUP BY
  BD_SRCTYPE,
  BD_SERVICE,
  BD_CONID,
  NVL(to_char(BD_BILLRATE),LTRIM(to_char(BD_AMOUNTCU,'9990.000'))),
  BD_AMOUNTCU,
  BD_PREPAID;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- CDR_SUMMARY_BILLRATE_1_BN  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.CDR_SUMMARY_BILLRATE_1_BN
(DATE1, DATE2, BD_SRCTYPE, BD_SERVICE, BD_CONID, 
 CON_NAME, CON_ACNAME, BD_BILLRATE, BD_COUNT, BD_AMOUNTCU, 
 BD_RETSHAREPV, BD_RETSHAREMO, BD_PREPAID, BD_PRICE)
BEQUEATH DEFINER
AS 
SELECT
  TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')     date1,
  LAST_DAY(ADD_MONTHS(trunc(sysdate),-1))   date2,
  BD_SRCTYPE                                bd_srctype,
  BD_SERVICE                                bd_service,
  BD_CONID                                  bd_conid,
  NVL(CON_NAME,AC_NAME)                     con_name,
  AC_NAME                                   con_acname,
  NVL(BD_BILLRATE,to_char(10*BD_AMOUNTCU))  bd_billrate,
  COUNT(BDETAIL.ROWID)                      bd_count,
  SUM(BD_AMOUNTCU)                          bd_amountcu,
  SUM(BD_RETSHAREPV)                        bd_retsharepv,
  SUM(BD_RETSHAREMO)                        bd_retsharemo,
  DECODE(BD_PREPAID,'Y','Pre','N','Post','N.A.') bd_prepaid,
  BD_AMOUNTCU                               bd_price
FROM BDETAIL, CONTRACT, ACCOUNT
  WHERE
    BDETAIL.BD_CONID = CONTRACT.CON_ID
  AND CON_ACID = AC_ID
  AND BD_DATETIME >= TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
  AND BD_DATETIME < LAST_DAY(ADD_MONTHS(trunc(sysdate),-1)) + 1
  AND BD_MAPSID NOT IN ('M','m')
  AND CON_ESTID IN ('BN','MVP')
  AND NVL(BD_CDRTID,'CTB-CO') = 'CTB-CO'
GROUP
  BY BD_SRCTYPE,
  AC_NAME,
  NVL(CON_NAME,AC_NAME),
  BD_SERVICE,
  BD_CONID,
  NVL(BD_BILLRATE,to_char(10*BD_AMOUNTCU)),
  BD_AMOUNTCU,
  BD_PREPAID;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- CDR_SUMMARY_BILLRATE_1_BNA  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.CDR_SUMMARY_BILLRATE_1_BNA
(DATE1, DATE2, BD_SRCTYPE, BD_SERVICE, BD_CONID, 
 CON_NAME, CON_ACNAME, BD_BILLRATE, BD_COUNT, BD_AMOUNTCU, 
 BD_RETSHAREPV, BD_RETSHAREMO, BD_PREPAID, BD_PRICE)
BEQUEATH DEFINER
AS 
SELECT
  TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')     date1,
  LAST_DAY(ADD_MONTHS(trunc(sysdate),-1))   date2,
  BD_SRCTYPE                                bd_srctype,
  BD_SERVICE                                bd_service,
  BD_CONID                                  bd_conid,
  NVL(CON_NAME,AC_NAME)                     con_name,
  AC_NAME                                   con_acname,
  NVL(to_char(BD_BILLRATE),LTRIM(to_char(BD_AMOUNTCU,'9990.000')))  bd_billrate,
  COUNT(BDETAIL.ROWID)                      bd_count,
  SUM(BD_AMOUNTCU)                          bd_amountcu,
  SUM(BD_RETSHAREPV)                        bd_retsharepv,
  SUM(BD_RETSHAREMO)                        bd_retsharemo,
  DECODE(BD_PREPAID,'Y','Pre','N','Post','N.A.') bd_prepaid,
  BD_AMOUNTCU                               bd_price
FROM BDETAIL, CONTRACT, ACCOUNT
  WHERE
    BDETAIL.BD_CONID = CONTRACT.CON_ID
  AND CON_ACID = AC_ID
  AND BD_DATETIME >= TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
  AND BD_DATETIME < LAST_DAY(ADD_MONTHS(trunc(sysdate),-1)) + 1
  AND BD_MAPSID NOT IN ('M','m')
  AND CON_ESTID IN ('BN','MVP')
  AND NVL(BD_CDRTID,'CTB-CO') = 'CTB-CO'
GROUP
  BY BD_SRCTYPE,
  AC_NAME,
  NVL(CON_NAME,AC_NAME),
  BD_SERVICE,
  BD_CONID,
  NVL(to_char(BD_BILLRATE),LTRIM(to_char(BD_AMOUNTCU,'9990.000'))),
  BD_AMOUNTCU,
  BD_PREPAID;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- CDR_SUMMARY_BILLRATE_1_IS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.CDR_SUMMARY_BILLRATE_1_IS
(DATE1, DATE2, BD_SRCTYPE, BD_SERVICE, BD_CONID, 
 CON_NAME, CON_ACNAME, BD_BILLRATE, BD_COUNT, BD_AMOUNTCU, 
 BD_RETSHAREPV, BD_RETSHAREMO, BD_PREPAID, BD_PRICE)
BEQUEATH DEFINER
AS 
SELECT
  TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')     date1,
  LAST_DAY(ADD_MONTHS(trunc(sysdate),-1))   date2,
  BD_SRCTYPE                                bd_srctype,
  BD_SERVICE                                bd_service,
  BD_CONID                                  bd_conid,
  NVL(CON_NAME,AC_NAME)                     con_name,
  AC_NAME                                   con_acname,
  NVL(BD_BILLRATE,to_char(10*BD_AMOUNTCU))  bd_billrate,
  COUNT(BDETAIL.ROWID)                      bd_count,
  SUM(BD_AMOUNTCU)                          bd_amountcu,
  SUM(BD_RETSHAREPV)                        bd_retsharepv,
  SUM(BD_RETSHAREMO)                        bd_retsharemo,
  DECODE(BD_PREPAID,'Y','Pre','N','Post','N.A.') bd_prepaid,
  BD_AMOUNTCU                               bd_price
FROM BDETAIL, CONTRACT, ACCOUNT
  WHERE
    BDETAIL.BD_CONID = CONTRACT.CON_ID
  AND CON_ACID = AC_ID
  AND BD_DATETIME >= TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
  AND BD_DATETIME < LAST_DAY(ADD_MONTHS(trunc(sysdate),-1)) + 1
  AND BD_MAPSID NOT IN ('M','m')
  AND (CON_ESTID IS NULL OR CON_ESTID = 'PTS')
  AND NVL(BD_CDRTID,'CTB-CO') = 'CTB-CO'
GROUP
  BY BD_SRCTYPE,
  AC_NAME,
  NVL(CON_NAME,AC_NAME),
  BD_SERVICE,
  BD_CONID,
  NVL(BD_BILLRATE,to_char(10*BD_AMOUNTCU)),
  BD_AMOUNTCU,
  BD_PREPAID;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- CDR_SUMMARY_BILLRATE_1_ISA  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.CDR_SUMMARY_BILLRATE_1_ISA
(DATE1, DATE2, BD_SRCTYPE, BD_SERVICE, BD_CONID, 
 CON_NAME, CON_ACNAME, BD_BILLRATE, BD_COUNT, BD_AMOUNTCU, 
 BD_RETSHAREPV, BD_RETSHAREMO, BD_PREPAID, BD_PRICE)
BEQUEATH DEFINER
AS 
SELECT
  TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')     date1,
  LAST_DAY(ADD_MONTHS(trunc(sysdate),-1))   date2,
  BD_SRCTYPE                                bd_srctype,
  BD_SERVICE                                bd_service,
  BD_CONID                                  bd_conid,
  NVL(CON_NAME,AC_NAME)                     con_name,
  AC_NAME                                   con_acname,
  NVL(to_char(BD_BILLRATE),LTRIM(to_char(BD_AMOUNTCU,'9990.000')))  bd_billrate,
  COUNT(BDETAIL.ROWID)                      bd_count,
  SUM(BD_AMOUNTCU)                          bd_amountcu,
  SUM(BD_RETSHAREPV)                        bd_retsharepv,
  SUM(BD_RETSHAREMO)                        bd_retsharemo,
  DECODE(BD_PREPAID,'Y','Pre','N','Post','N.A.') bd_prepaid,
  BD_AMOUNTCU                               bd_price
FROM BDETAIL, CONTRACT, ACCOUNT
  WHERE
    BDETAIL.BD_CONID = CONTRACT.CON_ID
  AND CON_ACID = AC_ID
  AND BD_DATETIME >= TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
  AND BD_DATETIME < LAST_DAY(ADD_MONTHS(trunc(sysdate),-1)) + 1
  AND BD_MAPSID NOT IN ('M','m')
  AND (CON_ESTID = 'PTS')
  AND NVL(BD_CDRTID,'CTB-CO') = 'CTB-CO'
GROUP
  BY BD_SRCTYPE,
  AC_NAME,
  NVL(CON_NAME,AC_NAME),
  BD_SERVICE,
  BD_CONID,
  NVL(to_char(BD_BILLRATE),LTRIM(to_char(BD_AMOUNTCU,'9990.000'))),
  BD_AMOUNTCU,
  BD_PREPAID;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- CDR_SUMMARY_BILLRATE_1_WEEK  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.CDR_SUMMARY_BILLRATE_1_WEEK
(DATE1, DATE2, BD_SRCTYPE, BD_SERVICE, BD_CONID, 
 CON_NAME, CON_ACNAME, BD_BILLRATE, BD_COUNT, BD_AMOUNTCU, 
 BD_RETSHAREPV, BD_RETSHAREMO, BD_PREPAID, BD_PRICE)
BEQUEATH DEFINER
AS 
SELECT
  TRUNC(sysdate-7,'DAY')           date1,
  TRUNC(sysdate-7,'DAY') +6         date2,
  BD_SRCTYPE                                bd_srctype,
  BD_SERVICE                                bd_service,
  BD_CONID                                  bd_conid,
  NVL(CON_NAME,AC_NAME)                     con_name,
  AC_NAME                                   con_acname,
  NVL(to_char(BD_BILLRATE),LTRIM(to_char(BD_AMOUNTCU,'9990.000')))  bd_billrate,
  COUNT(BDETAIL.ROWID)                      bd_count,
  SUM(BD_AMOUNTCU)                          bd_amountcu,
  SUM(BD_RETSHAREPV)                        bd_retsharepv,
  SUM(BD_RETSHAREMO)                        bd_retsharemo,
  DECODE(BD_PREPAID,'Y','Pre','N','Post','N.A.') bd_prepaid,
  BD_AMOUNTCU                               bd_price
FROM BDETAIL, CONTRACT, ACCOUNT
  WHERE
    BDETAIL.BD_CONID = CONTRACT.CON_ID
  AND CON_ACID = AC_ID
  AND BD_DATETIME >= TRUNC(sysdate-7,'DAY')
  AND BD_DATETIME < TRUNC(sysdate-7,'DAY') +7
  AND BD_MAPSID NOT IN ('M','m')
  AND (CON_ESTID = 'PTS')
  AND NVL(BD_CDRTID,'CTB-CO') = 'CTB-CO'
GROUP
  BY BD_SRCTYPE,
  AC_NAME,
  NVL(CON_NAME,AC_NAME),
  BD_SERVICE,
  BD_CONID,
  NVL(to_char(BD_BILLRATE),LTRIM(to_char(BD_AMOUNTCU,'9990.000'))),
  BD_AMOUNTCU,
  BD_PREPAID;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- CDR_SUMMARY_BILLTEXT_BN  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.CDR_SUMMARY_BILLTEXT_BN
(DATE1, DATE2, BD_SRCTYPE, BD_CONID, CON_ACNAME, 
 BD_TPID, CON_NAME, BD_SERVICE, BD_SHORTID, BD_BILLRATE, 
 BD_PRICE, BD_COUNT, BD_AMOUNTCU, BD_RETSHAREPV, BD_RETSHAREMO, 
 BD_PREPAID, BD_BILLTEXT)
BEQUEATH DEFINER
AS 
SELECT
	ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1) date1,
	TRUNC(SYSDATE,'MONTH') date2,
	BD_SRCTYPE bd_srctype,
	BD_CONID con_id,
	AC_NAME con_acname,
	BD_TPID, 
	NVL(CON_NAME,AC_NAME) con_name,
	BD_SERVICE bd_service,
	BD_SHORTID bd_shortid,
	BD_BILLRATE bd_billrate,
	BD_AMOUNTCU bd_price,
	COUNT(BDETAIL.ROWID) bd_count,
	SUM(BD_AMOUNTCU) bd_amountcu,
	SUM(BD_RETSHAREPV) bd_retsharepv,
	SUM(BD_RETSHAREMO) bd_retsharemo,
	DECODE(BD_PREPAID,'Y','Pre','N','Post','N.A.') BD_PREPAID,
	BD_BILLTEXT
FROM
	BDETAIL,
	CONTRACT,
	ACCOUNT
WHERE
		ACCOUNT.AC_ID = CONTRACT.CON_ACID
	AND	BDETAIL.BD_CONID = CONTRACT.CON_ID
	AND CON_ESTID IN ('BN','MVP')
	AND	BD_DATETIME >= ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1)
	AND	BD_DATETIME < TRUNC(SYSDATE,'MONTH')
	AND	BD_MAPSID NOT IN ('M','m')
  	AND 	NVL(BD_CDRTID,'CTB-CO') = 'CTB-CO'
GROUP BY
	BD_SRCTYPE,
	BD_CONID,
	AC_NAME,
	BD_TPID,
	NVL(CON_NAME,AC_NAME),
	BD_SERVICE,	
	BD_SHORTID,
	BD_BILLRATE,
	BD_AMOUNTCU,
	BD_PREPAID,
	BD_BILLTEXT;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- CDR_SUMMARY_BILLTEXT_WCB  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.CDR_SUMMARY_BILLTEXT_WCB
(DATE1, DATE2, BD_SRCTYPE, BD_CONID, CON_ACNAME, 
 BD_TPID, CON_NAME, BD_SHORTID, BD_BILLRATE, BD_PRICE, 
 BD_COUNT, BD_AMOUNTCU, BD_RETSHAREPV, BD_RETSHAREMO, BD_PREPAID, 
 BD_BILLTEXT)
BEQUEATH DEFINER
AS 
SELECT
	ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1) date1,
	TRUNC(SYSDATE,'MONTH') date2,
	BD_SRCTYPE bd_srctype,
	BD_CONID con_id,
	AC_NAME con_acname,
   	BD_TPID, 
	NVL(CON_NAME,AC_NAME) con_name,
	BD_SHORTID bd_shortid,
	BD_BILLRATE bd_billrate,
   	BD_AMOUNTCU bd_price,
	COUNT(BDETAIL.ROWID) bd_count,
	SUM(BD_AMOUNTCU) bd_amountcu,
	SUM(BD_RETSHAREPV) bd_retsharepv,
	SUM(BD_RETSHAREMO) bd_retsharemo,
	DECODE(BD_PREPAID,'Y','Pre','N','Post','N.A.') BD_PREPAID,
	BD_BILLTEXT	
FROM
	BDETAIL,
	CONTRACT,
	ACCOUNT
WHERE
		ACCOUNT.AC_ID = CONTRACT.CON_ACID
	AND	BDETAIL.BD_CONID = CONTRACT.CON_ID
	AND CON_ESTID = 'WCB'
	AND	BD_DATETIME >= ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1)
	AND	BD_DATETIME < TRUNC(SYSDATE,'MONTH')
	AND	BD_MAPSID NOT IN ('M','m')
  	AND 	NVL(BD_CDRTID,'CTB-CO') = 'CTB-CO'
GROUP BY
	BD_SRCTYPE,
	BD_CONID,
	AC_NAME,
    BD_TPID,
	NVL(CON_NAME,AC_NAME),	
	BD_SHORTID,
	BD_BILLRATE,
	BD_AMOUNTCU,
	BD_PREPAID,
	BD_BILLTEXT;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- CDR_SUMMARY_LOCATION_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.CDR_SUMMARY_LOCATION_1
(DATE1, DATE2, BD_SRCTYPE, BD_SERVICE, BD_CONID, 
 CON_NAME, CON_ACNAME, BD_LOCATION, BD_COUNT, BD_PREPAID)
BEQUEATH DEFINER
AS 
SELECT /*+ FULL(BDETAIL) */
  TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')     date1,    
  LAST_DAY(ADD_MONTHS(trunc(sysdate),-1))   date2,    
  BD_SRCTYPE                                bd_srctype,    
  BD_SERVICE                                bd_service,    
  BD_CONID                                  bd_conid,    
  NVL(CON_NAME,AC_NAME)                     con_name,    
  AC_NAME                                   con_acname,    
  bd_location                               bd_location,    
  COUNT(BDETAIL.ROWID)                      bd_count,    
  DECODE(BD_PREPAID,'Y','Pre','N','Post','N.A.')  bd_prepaid  
FROM BDETAIL, CONTRACT, ACCOUNT    
WHERE      BDETAIL.BD_CONID = CONTRACT.CON_ID    
  AND CON_ACID = AC_ID    
  AND BD_DATETIME >= TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')    
  AND BD_DATETIME < LAST_DAY(ADD_MONTHS(trunc(sysdate),-1)) + 1    
  AND BD_MAPSID NOT IN ('M','m')    
  AND BD_LOCATION IS NOT NULL  
  AND NVL(BD_CDRTID,'CTB-CO') = 'CTB-CO'
GROUP    BY BD_SRCTYPE,    AC_NAME,    NVL(CON_NAME,AC_NAME),    BD_SERVICE,    BD_CONID,    bd_location,    BD_PREPAID  
UNION  SELECT /*+ FULL(BDETAIL) */ 
  TRUNC(ADD_MONTHS(sysdate,-1),'MONTH'),    
  LAST_DAY(ADD_MONTHS(trunc(sysdate),-1)),    
  BD_SRCTYPE,    
  BD_SERVICE,    
  BD_CONID,    
  NULL,    
  NULL,    
  bd_location,    
  COUNT(BDETAIL.ROWID),    
  DECODE(BD_PREPAID,'Y','Pre','N','Post','N.A.')  
FROM  BDETAIL  
  WHERE      
    BDETAIL.BD_CONID IS NULL    
  AND BD_DATETIME >= TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')    
  AND BD_DATETIME < LAST_DAY(ADD_MONTHS(trunc(sysdate),-1)) + 1    
  AND BD_MAPSID NOT IN ('M','m')    
  AND BD_LOCATION IS NOT NULL  
  AND NVL(BD_CDRTID,'CTB-CO') = 'CTB-CO'
GROUP BY    BD_SRCTYPE,    BD_SERVICE,    BD_CONID,    bd_location,    BD_PREPAID;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- CDR_SUMMARY_STYPE_BN  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.CDR_SUMMARY_STYPE_BN
(DATE1, DATE2, BD_SRCTYPE, BD_CONID, CON_ACNAME, 
 BD_TPID, CON_NAME, BD_SERVICE, BD_SHORTID, BD_BILLRATE, 
 BD_PRICE, BD_COUNT, BD_AMOUNTCU, BD_RETSHAREPV, BD_RETSHAREMO, 
 BD_STYPE)
BEQUEATH DEFINER
AS 
SELECT
 ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1) date1,
 TRUNC(SYSDATE,'MONTH') date2,
 BD_SRCTYPE bd_srctype,
 BD_CONID con_id,
 AC_NAME con_acname,
 BD_TPID,
 NVL(CON_NAME,AC_NAME) con_name,
 BD_SERVICE bd_service,
 BD_SHORTID bd_shortid,
 BD_BILLRATE bd_billrate,
 BD_AMOUNTCU bd_price,
 COUNT(BDETAIL.ROWID) bd_count,
 SUM(BD_AMOUNTCU) bd_amountcu,
 SUM(BD_RETSHAREPV) bd_retsharepv,
 SUM(BD_RETSHAREMO) bd_retsharemo,
 ST_LANG01 BD_STYPE
FROM
 BDETAIL,
 CONTRACT,
 ACCOUNT,
 STYPE
WHERE
  ACCOUNT.AC_ID = CONTRACT.CON_ACID
 AND BDETAIL.BD_CONID = CONTRACT.CON_ID
 AND  CON_ESTID IN ('BN','MVP')
 AND BD_DATETIME >= ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1)
 AND BD_DATETIME < TRUNC(SYSDATE,'MONTH')
 AND BD_MAPSID NOT IN ('M','m')
 AND  BDETAIL.BD_STYPE = STYPE.ST_ID
 AND NVL(BD_CDRTID,'CTB-CO') = 'CTB-CO'
GROUP BY
 BD_SRCTYPE,
 BD_CONID,
 AC_NAME,
 BD_TPID,
 NVL(CON_NAME,AC_NAME),
 BD_SERVICE,
 BD_SHORTID,
 BD_AMOUNTCU,
 BD_BILLRATE,
 ST_LANG01;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- DT_BOH  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.DT_BOH
(BOH_ID, BOH_PACKID, BOH_DATETIME, BOH_FILENAME, BOH_RECCOUNT, 
 PROC_DURATION, PROC_SPEED, BOH_DATEFC, BOH_DATELC, BOH_ESID)
BEQUEATH DEFINER
AS 
SELECT BOH_ID, BOH_PACKID, BOH_DATETIME, BOH_FILENAME, BOH_RECCOUNT,
DURATION(BOH_END-BOH_START), SPEED(BOH_RECCOUNT,BOH_START,BOH_END), BOH_DATEFC, BOH_DATELC,
BOH_ESID
FROM BOHEADER;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- DT_BOH_RECENT  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.DT_BOH_RECENT
(BOH_ID, BOH_PACKID, BOH_DATETIME, BOH_FILENAME, BOH_RECCOUNT, 
 PROC_DURATION, PROC_SPEED, BOH_DATEFC, BOH_DATELC, BOH_ESID)
BEQUEATH DEFINER
AS 
SELECT BOH_ID, BOH_PACKID, BOH_DATETIME, BOH_FILENAME, BOH_RECCOUNT, PROC_DURATION,
PROC_SPEED, BOH_DATEFC, BOH_DATELC, BOH_ESID
FROM DT_BOH
WHERE BOH_DATETIME > sysdate - 1;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- DT_BOH_RECENT_CONSOL_DAILY  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.DT_BOH_RECENT_CONSOL_DAILY
(STAJ_BOHIDSCHED, STAJ_BOHIDEXEC, STAJ_ID, STAJ_DATECRE, STAJ_PACID, 
 STAJ_ESID, STAJ_DATEEXE, STAJ_DATESTA, STAJ_DATETRY, STAJ_NOOFTRIALS, 
 STAJ_SYSINFO)
BEQUEATH DEFINER
AS 
SELECT STAJ_BOHIDSCHED, STAJ_BOHIDEXEC, STAJ_ID, STAJ_DATECRE, STAJ_PACID,
STAJ_ESID, STAJ_DATEEXE, STAJ_DATESTA, STAJ_DATETRY, STAJ_NOOFTRIALS,
STAJ_SYSINFO
FROM STA_JOB
WHERE STAJ_PACID IN (SELECT   PAC_ID
FROM   PACKING  WHERE   PAC_ETID = 'CONSOL' )
AND STAJ_DATECRE >= sysdate - 2
AND STAJ_PERIODID IN ('DAILY')
ORDER BY STAJ_DATECRE;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- DT_BOH_RECENT_CONSOL_MONTHLY  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.DT_BOH_RECENT_CONSOL_MONTHLY
(STAJ_BOHIDSCHED, STAJ_BOHIDEXEC, STAJ_ID, STAJ_DATECRE, STAJ_PACID, 
 STAJ_ESID, STAJ_DATEEXE, STAJ_DATESTA, STAJ_DATETRY, STAJ_NOOFTRIALS, 
 STAJ_SYSINFO)
BEQUEATH DEFINER
AS 
SELECT STAJ_BOHIDSCHED, STAJ_BOHIDEXEC, STAJ_ID, STAJ_DATECRE, STAJ_PACID,
STAJ_ESID, STAJ_DATEEXE, STAJ_DATESTA, STAJ_DATETRY, STAJ_NOOFTRIALS,
STAJ_SYSINFO
FROM STA_JOB
WHERE STAJ_PACID IN (SELECT   PAC_ID
FROM   PACKING  WHERE   PAC_ETID = 'CONSOL' )
AND STAJ_DATECRE >= sysdate - 10
AND STAJ_PERIODID IN ('MONTHLY')
ORDER BY STAJ_DATEEXE, STAJ_DATEEXE DESC, STAJ_DATEEXE, STAJ_DATEEXE DESC;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- DT_BOH_RECENT_MOLA  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.DT_BOH_RECENT_MOLA
(BOH_ID, BOH_PACKID, BOH_DATETIME, BOH_FILENAME, BOH_RECCOUNT, 
 PROC_DURATION, PROC_SPEED, BOH_DATEFC, BOH_DATELC, BOH_ESID)
BEQUEATH DEFINER
AS 
SELECT BOH_ID, BOH_PACKID, BOH_DATETIME, BOH_FILENAME, BOH_RECCOUNT, PROC_DURATION,
PROC_SPEED, BOH_DATEFC, BOH_DATELC, BOH_ESID
FROM DT_BOH
WHERE BOH_DATETIME > sysdate - 10
AND BOH_PACKID Like 'LAT__MS';


/* This object may not be sorted properly in the script due to cirular references. */
--
-- DT_BOH_RECENT_MOLAA  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.DT_BOH_RECENT_MOLAA
(BOH_ID, BOH_PACKID, BOH_DATETIME, BOH_FILENAME, BOH_RECCOUNT, 
 PROC_DURATION, PROC_SPEED, BOH_DATEFC, BOH_DATELC, BOH_ESID)
BEQUEATH DEFINER
AS 
SELECT BOH_ID, BOH_PACKID, BOH_DATETIME, BOH_FILENAME, BOH_RECCOUNT, PROC_DURATION,
PROC_SPEED, BOH_DATEFC, BOH_DATELC, BOH_ESID
FROM DT_BOH
WHERE BOH_DATETIME > sysdate - 1/24
AND BOH_PACKID Like 'LAA%';


/* This object may not be sorted properly in the script due to cirular references. */
--
-- DT_BOH_RECENT_MOLAMCC  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.DT_BOH_RECENT_MOLAMCC
(BOH_ID, BOH_PACKID, BOH_DATETIME, BOH_FILENAME, BOH_RECCOUNT, 
 PROC_DURATION, PROC_SPEED, BOH_DATEFC, BOH_DATELC, BOH_ESID)
BEQUEATH DEFINER
AS 
SELECT BOH_ID, BOH_PACKID, BOH_DATETIME, BOH_FILENAME, BOH_RECCOUNT, PROC_DURATION,
PROC_SPEED, BOH_DATEFC, BOH_DATELC, BOH_ESID
FROM DT_BOH
WHERE BOH_DATETIME > sysdate-35
AND BOH_PACKID IN ('MOLAMCC');


/* This object may not be sorted properly in the script due to cirular references. */
--
-- DT_BOH_RECENT_MSC  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.DT_BOH_RECENT_MSC
(BOH_ID, BOH_PACKID, BOH_DATETIME, BOH_FILENAME, BOH_RECCOUNT, 
 PROC_DURATION, PROC_SPEED, BOH_DATEFC, BOH_DATELC, BOH_ESID)
BEQUEATH DEFINER
AS 
SELECT BOH_ID, BOH_PACKID, BOH_DATETIME, BOH_FILENAME, BOH_RECCOUNT, PROC_DURATION,
PROC_SPEED, BOH_DATEFC, BOH_DATELC, BOH_ESID
FROM DT_BOH
WHERE BOH_DATETIME > sysdate - 1/24
AND BOH_PACKID IN ('MSCCU');


/* This object may not be sorted properly in the script due to cirular references. */
--
-- DT_BOH_RECENT_MSCCU  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.DT_BOH_RECENT_MSCCU
(BOH_ID, BOH_PACKID, BOH_DATETIME, BOH_FILENAME, BOH_RECCOUNT, 
 PROC_DURATION, PROC_SPEED, BOH_DATEFC, BOH_DATELC, BOH_ESID)
BEQUEATH DEFINER
AS 
SELECT BOH_ID, BOH_PACKID, BOH_DATETIME, BOH_FILENAME, BOH_RECCOUNT, PROC_DURATION,
PROC_SPEED, BOH_DATEFC, BOH_DATELC, BOH_ESID
FROM DT_BOH
WHERE BOH_DATETIME > sysdate - 1/24
AND BOH_PACKID IN ('MSCCU');


/* This object may not be sorted properly in the script due to cirular references. */
--
-- DT_BOH_RECENT_OPER  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.DT_BOH_RECENT_OPER
(BOH_ID, BOH_PACKID, BOH_DATETIME, BOH_FILENAME, BOH_RECCOUNT, 
 PROC_DURATION, PROC_SPEED, BOH_DATEFC, BOH_DATELC, BOH_ESID)
BEQUEATH DEFINER
AS 
SELECT BOH_ID, BOH_PACKID, BOH_DATETIME, BOH_FILENAME, BOH_RECCOUNT, PROC_DURATION,
PROC_SPEED, BOH_DATEFC, BOH_DATELC, BOH_ESID
FROM DT_BOH
WHERE BOH_DATETIME > sysdate - 1/24
AND BOH_PACKID IN ('NBR_MERGE','NBR_PREP');


/* This object may not be sorted properly in the script due to cirular references. */
--
-- DT_BOH_RECENT_REVA  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.DT_BOH_RECENT_REVA
(BOH_ID, BOH_PACKID, BOH_DATETIME, BOH_FILENAME, BOH_RECCOUNT, 
 PROC_DURATION, PROC_SPEED, BOH_DATEFC, BOH_DATELC, BOH_ESID)
BEQUEATH DEFINER
AS 
SELECT BOH_ID, BOH_PACKID, BOH_DATETIME, BOH_FILENAME, BOH_RECCOUNT, PROC_DURATION,
PROC_SPEED, BOH_DATEFC, BOH_DATELC, BOH_ESID
FROM DT_BOH
WHERE BOH_DATETIME > sysdate - 1/24
AND BOH_PACKID LIKE 'REVA%';


/* This object may not be sorted properly in the script due to cirular references. */
--
-- DT_BOH_RECENT_SMSCCU  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.DT_BOH_RECENT_SMSCCU
(BOH_ID, BOH_PACKID, BOH_DATETIME, BOH_FILENAME, BOH_RECCOUNT, 
 PROC_DURATION, PROC_SPEED, BOH_DATEFC, BOH_DATELC, BOH_ESID)
BEQUEATH DEFINER
AS 
SELECT BOH_ID, BOH_PACKID, BOH_DATETIME, BOH_FILENAME, BOH_RECCOUNT, PROC_DURATION,
PROC_SPEED, BOH_DATEFC, BOH_DATELC, BOH_ESID
FROM DT_BOH
WHERE BOH_DATETIME > sysdate - 1/24
AND BOH_PACKID IN ('SMSCCU');


/* This object may not be sorted properly in the script due to cirular references. */
--
-- DT_BOH_RECENT_TORA  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.DT_BOH_RECENT_TORA
(BOH_ID, BOH_PACKID, BOH_DATETIME, BOH_FILENAME, BOH_RECCOUNT, 
 PROC_DURATION, PROC_SPEED, BOH_DATEFC, BOH_DATELC, BOH_ESID)
BEQUEATH DEFINER
AS 
SELECT BOH_ID, BOH_PACKID, BOH_DATETIME, BOH_FILENAME, BOH_RECCOUNT, PROC_DURATION,
PROC_SPEED, BOH_DATEFC, BOH_DATELC, BOH_ESID
FROM DT_BOH
WHERE BOH_DATETIME > sysdate - 3
AND BOH_PACKID LIKE 'RA0%';


/* This object may not be sorted properly in the script due to cirular references. */
--
-- DT_BOH_RECENT_ZIPPER  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.DT_BOH_RECENT_ZIPPER
(BOH_ID, BOH_PACKID, BOH_DATETIME, BOH_FILENAME, BOH_RECCOUNT, 
 PROC_DURATION, PROC_SPEED, BOH_DATEFC, BOH_DATELC, BOH_ESID)
BEQUEATH DEFINER
AS 
SELECT BOH_ID, BOH_PACKID, BOH_DATETIME, BOH_FILENAME, BOH_RECCOUNT, PROC_DURATION,
PROC_SPEED, BOH_DATEFC, BOH_DATELC, BOH_ESID
FROM DT_BOH
WHERE BOH_DATETIME > sysdate - 3
AND BOH_PACKID Like '%ZIP%';


/* This object may not be sorted properly in the script due to cirular references. */
--
-- KEYWORDS_PER_DAY  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.KEYWORDS_PER_DAY
(BD_DATETIME, BD_SRCTYPE, CON_ACNAME, CON_NAME, CON_SNAME, 
 CON_ID, BD_KEYWORD, BD_COUNT)
BEQUEATH DEFINER
AS 
SELECT
  TRUNC(BD_DATETIME)            bd_datetime,
  BD_SRCTYPE                    bd_srctype,
  AC_NAME                       con_acname,
  NVL(CON_NAME,AC_NAME)         con_name,
  NULL                          con_sname,
  CON_ID                        con_id,
  BD_KEYWORD                    bd_keyword,
  COUNT(BDETAIL.ROWID)          bd_count
FROM
  BDETAIL,
  CONTRACT,
  ACCOUNT
WHERE
    BDETAIL.BD_CONID = CONTRACT.CON_ID
    AND CON_ACID = AC_ID
    AND NVL(BD_CDRTID,'CTB-CO') = 'CTB-CO'
GROUP BY
  TRUNC(BD_DATETIME),
  BD_SRCTYPE,
  AC_NAME,
  NVL(CON_NAME,AC_NAME),
  CON_ID,
  BD_KEYWORD;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- KEYWORDS_PER_DAY_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.KEYWORDS_PER_DAY_1
(BD_DATETIME, BD_SRCTYPE, CON_ACNAME, CON_NAME, CON_SNAME, 
 CON_ID, BD_KEYWORD, BD_COUNT)
BEQUEATH DEFINER
AS 
SELECT
  TRUNC(BD_DATETIME)            bd_datetime,
  BD_SRCTYPE                    bd_srctype,
  AC_NAME                       con_acname,
  NVL(CON_NAME,AC_NAME)         con_name,
  NULL                          con_sname,
  CON_ID                        con_id,
  BD_KEYWORD                    bd_keyword,
  COUNT(BDETAIL.ROWID)          bd_count
FROM
  BDETAIL,
  CONTRACT,
  ACCOUNT
WHERE
    BDETAIL.BD_CONID = CONTRACT.CON_ID
  AND CON_ACID = AC_ID
  AND BD_DATETIME >= TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
  AND BD_DATETIME < LAST_DAY(ADD_MONTHS(trunc(sysdate),-1)) + 1
  AND NVL(BD_CDRTID,'CTB-CO') = 'CTB-CO'
GROUP BY
  TRUNC(BD_DATETIME),
  BD_SRCTYPE,
  AC_NAME,
  NVL(CON_NAME,AC_NAME),
  CON_ID,
  BD_KEYWORD;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- MAY_USE_ALL_PARTITIONS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.MAY_USE_ALL_PARTITIONS
(RESULT)
BEQUEATH DEFINER
AS 
SELECT
	CASE RESULT
	WHEN 'FALSE' THEN 'FALSE'
	ELSE (     SELECT S2.RESULT 
		       FROM SBS2_ADMIN.MAY_USE_DAY_PARTITIONS S2
	    )
	END    AS RESULT
FROM
	MAY_USE_MONTH_PARTITIONS;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- MAY_USE_BDETAIL_PARTITIONS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.MAY_USE_BDETAIL_PARTITIONS
(RESULT)
BEQUEATH DEFINER
AS 
SELECT
	DECODE(SUM(CNT),0,'TRUE','FALSE')
FROM (
SELECT  COUNT(*) CNT
FROM    PACKING
WHERE   PAC_ID IN ('ADDINFOP')
AND     NVL(PAC_DATEDONE,sysdate-31) < trunc(sysdate,'MONTH')
AND     sysdate > trunc(sysdate,'MONTH') + pac_startday - 1 + pac_starthour/24 + (pac_startminute-20)/24/60
UNION ALL
SELECT  COUNT(*) CNT
FROM    SBS1_ADMIN.BDETAIL_MONITOR
WHERE   PARTNAME IN ('BDETAIL')
AND     FK_CREATE = 'Y'
);


/* This object may not be sorted properly in the script due to cirular references. */
--
-- MAY_USE_BDETAIL1_PARTITIONS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.MAY_USE_BDETAIL1_PARTITIONS
(RESULT)
BEQUEATH DEFINER
AS 
SELECT
	DECODE(SUM(CNT),0,'TRUE','FALSE')
FROM (
SELECT  COUNT(*) CNT
FROM    PACKING
WHERE   PAC_ID IN ('ADDSMSCP','ADDSMSDP')
AND     NVL(PAC_DATEDONE,sysdate-31) < trunc(sysdate,'MONTH')
AND     sysdate > trunc(sysdate,'MONTH') + pac_startday - 1 + pac_starthour/24 + (pac_startminute-20)/24/60
UNION ALL
SELECT  COUNT(*) CNT
FROM    SBS1_ADMIN.BDETAIL_MONITOR
WHERE   PARTNAME IN ('BDETAIL1','BDETAIL2')
AND     FK_CREATE = 'Y'
);


/* This object may not be sorted properly in the script due to cirular references. */
--
-- MAY_USE_BDETAIL4_PARTITIONS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.MAY_USE_BDETAIL4_PARTITIONS
(RESULT)
BEQUEATH DEFINER
AS 
SELECT
	DECODE(SUM(CNT),0,'TRUE','FALSE')
FROM (
SELECT  COUNT(*) CNT
FROM    PACKING
WHERE   PAC_ID IN ('ADDMSCAP')
AND     NVL(PAC_DATEDONE,sysdate-31) < trunc(sysdate,'MONTH')
AND     sysdate > trunc(sysdate,'MONTH') + pac_startday - 1 + pac_starthour/24 + (pac_startminute-20)/24/60
UNION ALL
SELECT  COUNT(*) CNT
FROM    SBS1_ADMIN.BDETAIL_MONITOR
WHERE   PARTNAME IN ('BDETAIL4')
AND     FK_CREATE = 'Y'
);


/* This object may not be sorted properly in the script due to cirular references. */
--
-- MAY_USE_BDETAIL6_PARTITIONS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.MAY_USE_BDETAIL6_PARTITIONS
(RESULT)
BEQUEATH DEFINER
AS 
SELECT
	DECODE(SUM(CNT),0,'TRUE','FALSE')
FROM (
SELECT  COUNT(*) CNT
FROM    PACKING
WHERE   PAC_ID IN ('ADDMMSCP')
AND     NVL(PAC_DATEDONE,sysdate-31) < trunc(sysdate,'MONTH')
AND     sysdate > trunc(sysdate,'MONTH') + pac_startday - 1 + pac_starthour/24 + (pac_startminute-20)/24/60
UNION ALL
SELECT  COUNT(*) CNT
FROM    SBS1_ADMIN.BDETAIL_MONITOR
WHERE   PARTNAME IN ('BDETAIL6')
AND     FK_CREATE = 'Y'
);


/* This object may not be sorted properly in the script due to cirular references. */
--
-- MAY_USE_MONTH_PARTITIONS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.MAY_USE_MONTH_PARTITIONS
(RESULT)
BEQUEATH DEFINER
AS 
SELECT
	DECODE(COUNT(*),0,'TRUE','FALSE')
FROM
	PACKING
WHERE
		PAC_ID Like 'ADD%P'
	AND	PAC_ETID = 'CONSOL'
	AND	PAC_ESID IN ('A','S')
	AND	PAC_PERIODID IN ('MONTHLY')
	AND	NVL(PAC_DATEDONE,sysdate-31) < trunc(sysdate,'MONTH')
	AND	sysdate > trunc(sysdate,'MONTH') + pac_startday - 1 + pac_starthour/24 + (pac_startminute-20)/24/60;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- MAY_USE_REVAOTHERS_PARTITIONS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.MAY_USE_REVAOTHERS_PARTITIONS
(RESULT)
BEQUEATH DEFINER
AS 
SELECT
    DECODE(SUM(CNT),0,'TRUE','FALSE')
FROM (
SELECT  COUNT(*) CNT
FROM    PACKING
WHERE   (PAC_ID LIKE 'ADD%P' OR PAC_ID LIKE 'REVI%')
AND	    PAC_ETID = 'CONSOL'
AND     PAC_ESID IN ('A','S')
AND     PAC_PERIODID IN ('MONTHLY')
AND     NVL(PAC_DATEDONE,sysdate-31) < trunc(sysdate,'MONTH')
AND     sysdate > trunc(sysdate,'MONTH') + pac_startday - 1 + pac_starthour/24 + (pac_startminute-20)/24/60
UNION ALL
SELECT  COUNT(*) CNT
FROM    SBS1_ADMIN.BDETAIL_MONITOR
WHERE   PARTNAME IN ('BDETAIL','BDETAIL6')
AND     FK_CREATE = 'Y'
);


/* This object may not be sorted properly in the script due to cirular references. */
--
-- MAY_USE_REVI_PARTITIONS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.MAY_USE_REVI_PARTITIONS
(RESULT)
BEQUEATH DEFINER
AS 
SELECT
	DECODE(COUNT(*),0,'TRUE','FALSE')
FROM
	PACKING
WHERE
		(PAC_ID LIKE 'ADD%P' OR PAC_ID LIKE 'REVI%')
	AND	PAC_ETID = 'CONSOL'
	AND	PAC_ESID IN ('A','S')
	AND	PAC_PERIODID IN ('MONTHLY')
	AND	NVL(PAC_DATEDONE,sysdate-31) < trunc(sysdate,'MONTH')
	AND	sysdate > trunc(sysdate,'MONTH') + pac_startday - 1 + pac_starthour/24 + (pac_startminute-20)/24/60;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- MMS_CDR_DETAIL  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.MMS_CDR_DETAIL
(BD_BIHID, BD_SRCTYPE, BD_ID, BD_BIRECNO, BD_RECIPCOUNT, 
 BD_RECIPINDEX, BD_MAPSID, BD_DATESUBMIT, BD_DATEDELIVERYFUTURE, BD_DATETIME, 
 BD_DATEDELIVERY, BD_DATEEXPIRE, BD_MSISDN_A, BD_MSISDN_B, BD_IMSI, 
 BD_DESTINATIONIMSI, BD_UMSGGRPID, BD_MSGTYPE, BD_CDRRECTYPE, BD_MSGSIZE, 
 BD_EVENTDISP, BD_FWDCOPYIND, BD_LEGACYINDICATOR, BD_ROAMINGINFO, BD_LAYERSPECATTR, 
 BD_STORAGEDURATION, BD_MSGPRIORITY, BD_MSGCLASS, BD_MSGCONTENT, BD_MMSIDENTIFIER, 
 BD_ACCCORRID, BD_INID, BD_OUTID, BD_PRICE, BD_REQUESTIND, 
 BD_PARTYTOCHARGE, BD_MM7LINKEDID, BD_FREETEXT, BD_PREPAIDFREETEXT, BD_PROMOTIONPLAN, 
 BD_TARIFFCLASS, BD_NUMHOMERECIP, BD_NUMNONHOMERECIP, BD_NUMINTLRECIP, BD_NUMEMAILRECIP, 
 BD_NUMSCODERECIP, BD_NUMNOTIFICATION, BD_NUMCONVERSION, BD_PREPAID, BD_CDRTID, 
 BD_LENGTH, BD_SHORTID, BD_CONID, BD_TARID, BD_PMVID, 
 BD_TOCID, BD_INT, BD_IW, BD_BILLED, BD_RATED, 
 BD_ZNID, BD_MMSSZID, BD_MMSDZID, BD_MMSRCCID, BD_MMSDCCID, 
 BD_MMSRZID1, BD_MMSRZID2, BD_AMOUNTCU, BD_RETSHAREPV, BD_RETSHAREMO, 
 BD_AMOUNTTR, BD_COUNTTR, BD_TRCLASS, BD_TRCLASSIW, BD_ERRID, 
 BD_PACIDHB, BD_OUTPUTHB)
BEQUEATH DEFINER
AS 
SELECT
	BD_BIHID,
	BD_SRCTYPE,
	BD_ID,
	BD_BIRECNO,
	BD_RECIPCOUNT,
	BD_RECIPINDEX,
	BD_MAPSID,
	BD_DATESUBMIT,
	BD_DATEDELIVERYFUTURE,
	BD_DATETIME,
	BD_DATEDELIVERY,
	BD_DATEEXPIRE,
	BD_MSISDN_A,
	BD_MSISDN_B,
	BD_IMSI,
	BD_DESTINATIONIMSI,
	BD_UMSGGRPID,
	BD_MSGTYPE,
	BD_CDRRECTYPE,
	BD_MSGSIZE,
	BD_EVENTDISP,
	BD_FWDCOPYIND,
	BD_LEGACYINDICATOR,
	BD_ROAMINGINFO,
	BD_LAYERSPECATTR,
	BD_STORAGEDURATION,
	BD_MSGPRIORITY,
	BD_MSGCLASS,
	BD_MSGCONTENT,
	BD_MMSIDENTIFIER,
	BD_ACCCORRID,
	BD_INID,
	BD_OUTID,
	BD_PRICE,
	BD_REQUESTIND,
	BD_PARTYTOCHARGE,
	BD_MM7LINKEDID,
	BD_FREETEXT,
	BD_PREPAIDFREETEXT,
	BD_PROMOTIONPLAN,
	BD_TARIFFCLASS,
	BD_NUMHOMERECIP,
	BD_NUMNONHOMERECIP,
	BD_NUMINTLRECIP,
	BD_NUMEMAILRECIP,
	BD_NUMSCODERECIP,
	BD_NUMNOTIFICATION,
	BD_NUMCONVERSION,
	BD_PREPAID,
	BD_CDRTID,
	BD_LENGTH,
	BD_SHORTID,
	BD_CONID,
	BD_TARID,
	BD_PMVID,
	BD_TOCID,
	BD_INT,
	BD_IW,
	BD_BILLED,
	BD_RATED,
	BD_ZNID,
	BD_MMSSZID,
	BD_MMSDZID,
	BD_MMSRCCID,
	BD_MMSDCCID,
	BD_MMSRZID1,
	BD_MMSRZID2,
	BD_AMOUNTCU,
	BD_RETSHAREPV,
	BD_RETSHAREMO,
	BD_AMOUNTTR,
	BD_COUNTTR,
	BD_TRCLASS,
	BD_TRCLASSIW,
	BD_ERRID,
	BD_PACIDHB,
	BD_OUTPUTHB
FROM
	BDETAIL6
WHERE
		BD_DEMO = 0
--	AND	BD_MAPSID IN ('R','E')
;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- MMS_SUBMIT_DUPLICATES  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.MMS_SUBMIT_DUPLICATES
(BD_ID, BD_SRCTYPE, BD_DEMO, BD_BIHID, BD_MAPSID, 
 BD_BIRECNO, BD_BOHID1, BD_PACSID1, BD_BORECNO1, BD_BOHID2, 
 BD_PACSID2, BD_BORECNO2, BD_BOHID3, BD_PACSID3, BD_BORECNO3, 
 BD_DATETIME, BD_MSISDN_A, BD_MSISDN_B, BD_LAYERSPECATTR, BD_MSGTYPE, 
 BD_MSGSIZE, BD_STORAGEDURATION, BD_DATEDELIVERYFUTURE, BD_DATEDELIVERY, BD_DATESUBMIT, 
 BD_DATEEXPIRE, BD_MSGPRIORITY, BD_MSGCLASS, BD_MSGCONTENT, BD_UMSGGRPID, 
 BD_NUMNOTIFICATION, BD_MMSIDENTIFIER, BD_CDRRECTYPE, BD_FWDCOPYIND, BD_ACCCORRID, 
 BD_PREPAID, BD_EVENTDISP, BD_OUTID, BD_INID, BD_PRICE, 
 BD_REQUESTIND, BD_PARTYTOCHARGE, BD_LEGACYINDICATOR, BD_NUMHOMERECIP, BD_NUMNONHOMERECIP, 
 BD_NUMINTLRECIP, BD_NUMEMAILRECIP, BD_NUMSCODERECIP, BD_NUMCONVERSION, BD_FREETEXT, 
 BD_IMSI, BD_ZNID, BD_AMOUNTCU, BD_AMOUNTPV, BD_AMOUNTMO, 
 BD_CDRTID, BD_LENGTH, BD_SHORTID, BD_CONID, BD_TARID, 
 BD_TRCLASS, BD_TRCLASSIW, BD_TOCID, BD_INT, BD_IW, 
 BD_ERRID, BD_BILLED, BD_RATED, BD_PACIDHB, BD_OUTPUTHB, 
 BD_MM7LINKEDID, BD_PREPAIDFREETEXT, BD_PROMOTIONPLAN, BD_TARIFFCLASS, BD_ROAMINGINFO, 
 BD_DESTINATIONIMSI, BD_AMOUNTTR, BD_COUNTTR, BD_PMVID, BD_RECIPCOUNT, 
 BD_MMSSZID, BD_MMSDZID, BD_MMSRCCID, BD_MMSDCCID, BD_MMSRZID1, 
 BD_MMSRZID2, BD_RECIPINDEX, BD_RETSHAREPV, BD_RETSHAREMO)
BEQUEATH DEFINER
AS 
SELECT /*+ FULL (BDETAIL6) */
	BD_ID,
	BD_SRCTYPE,
	BD_DEMO,
	BD_BIHID,
	BD_MAPSID,
	BD_BIRECNO,
	BD_BOHID1,
	BD_PACSID1,
	BD_BORECNO1,
	BD_BOHID2,
	BD_PACSID2,
	BD_BORECNO2,
	BD_BOHID3,
	BD_PACSID3,
	BD_BORECNO3,
	BD_DATETIME,
	BD_MSISDN_A,
	BD_MSISDN_B,
	BD_LAYERSPECATTR,
	BD_MSGTYPE,
	BD_MSGSIZE,
	BD_STORAGEDURATION,
	BD_DATEDELIVERYFUTURE,
	BD_DATEDELIVERY,
	BD_DATESUBMIT,
	BD_DATEEXPIRE,
	BD_MSGPRIORITY,
	BD_MSGCLASS,
	BD_MSGCONTENT,
	BD_UMSGGRPID,
	BD_NUMNOTIFICATION,
	BD_MMSIDENTIFIER,
	BD_CDRRECTYPE,
	BD_FWDCOPYIND,
	BD_ACCCORRID,
	BD_PREPAID,
	BD_EVENTDISP,
	BD_OUTID,
	BD_INID,
	BD_PRICE,
	BD_REQUESTIND,
	BD_PARTYTOCHARGE,
	BD_LEGACYINDICATOR,
	BD_NUMHOMERECIP,
	BD_NUMNONHOMERECIP,
	BD_NUMINTLRECIP,
	BD_NUMEMAILRECIP,
	BD_NUMSCODERECIP,
	BD_NUMCONVERSION,
	BD_FREETEXT,
	BD_IMSI,
	BD_ZNID,
	BD_AMOUNTCU,
	BD_AMOUNTPV,
	BD_AMOUNTMO,
	BD_CDRTID,
	BD_LENGTH,
	BD_SHORTID,
	BD_CONID,
	BD_TARID,
	BD_TRCLASS,
	BD_TRCLASSIW,
	BD_TOCID,
	BD_INT,
	BD_IW,
	BD_ERRID,
	BD_BILLED,
	BD_RATED,
	BD_PACIDHB,
	BD_OUTPUTHB,
	BD_MM7LINKEDID,
	BD_PREPAIDFREETEXT,
	BD_PROMOTIONPLAN,
	BD_TARIFFCLASS,
	BD_ROAMINGINFO,
	BD_DESTINATIONIMSI,
	BD_AMOUNTTR,
	BD_COUNTTR,
	BD_PMVID,
	BD_RECIPCOUNT,
	BD_MMSSZID,
	BD_MMSDZID,
	BD_MMSRCCID,
	BD_MMSDCCID,
	BD_MMSRZID1,
	BD_MMSRZID2,
	BD_RECIPINDEX,
	BD_RETSHAREPV,
	BD_RETSHAREMO
FROM
	BDETAIL6
WHERE
		BD_BILLED = '3'
	AND	BD_DATETIME < trunc(sysdate,'MONTH')
	AND	BD_DATETIME >= add_months(trunc(sysdate,'MONTH'),-1);


/* This object may not be sorted properly in the script due to cirular references. */
--
-- RAM_D_BDETAIL6_DETAILS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.RAM_D_BDETAIL6_DETAILS
(DAY, "MMS_IN[CDRs]", "MMS_OUT[CDRs]", "MMS_OUT/IN[%]", "meta_DeliveryDate")
BEQUEATH DEFINER
AS 
select
DAY,
SUM(ORIGINATE_COUNT),
SUM(RECIPIENT_COUNT),
100*(SUM(RECIPIENT_COUNT)/(SUM(ORIGINATE_COUNT)+ 0.00001)-1.0),
trunc(SYSDATE)
from RAM_D_BDETAIL6_IOR_BASE
GROUP BY DAY
ORDER BY DAY DESC;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- RAM_D_BDETAIL6_IOR_BASE  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.RAM_D_BDETAIL6_IOR_BASE
(DAY, ORIGINATE_COUNT, RECIPIENT_COUNT)
BEQUEATH DEFINER
AS 
SELECT  /*+ NO_INDEX (BDETAIL6) */      
        TRUNC(BD_DATESUBMIT),   
        DECODE(SUBSTR(BD_CDRRECTYPE,4,1),'O',1,0),      
        DECODE(SUBSTR(BD_CDRRECTYPE,4,1),'R',1,0)       
FROM            
        BDETAIL6        
WHERE           
                BD_MAPSID = 'R'
        AND     BD_SRCTYPE = 'MMSC'
        AND     BD_DATETIME >= trunc(sysdate) - 90
        AND     BD_DATETIME < trunc(sysdate)
        AND     BD_DATESUBMIT < trunc(sysdate)
        AND     BD_DATESUBMIT>= trunc(sysdate) - 90
        AND     BD_MSGTYPE = 0
        AND NOT (BD_CDRRECTYPE LIKE '___Orecord'
        AND     BD_EVENTDISP <> 2);


/* This object may not be sorted properly in the script due to cirular references. */
--
-- RAM_D_BDETAIL6_IOR_B10  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.RAM_D_BDETAIL6_IOR_B10
(DAY, MSG_ID, ORIGINATE_COUNT, RECIPIENT_COUNT)
BEQUEATH DEFINER
AS 
SELECT  /*+ NO_INDEX (BDETAIL6) */      
        TRUNC(BD_DATESUBMIT),
        BD_UMSGGRPID,
        DECODE(SUBSTR(BD_CDRRECTYPE,4,1),'O',1,0),      
        DECODE(SUBSTR(BD_CDRRECTYPE,4,1),'R',1,0)       
FROM            
        BDETAIL6        
WHERE           
                BD_MAPSID = 'R'
        AND     BD_SRCTYPE = 'MMSC'
        AND     BD_DATETIME >= trunc(sysdate) - 10
        AND     BD_DATETIME < trunc(sysdate)
        AND     BD_DATESUBMIT>= trunc(sysdate) - 10
        AND     BD_DATESUBMIT<= trunc(sysdate) - 10 + 1
        AND     BD_MSGTYPE = 0
        AND NOT (BD_CDRRECTYPE LIKE '___Orecord'
        AND     BD_EVENTDISP <> 2);


/* This object may not be sorted properly in the script due to cirular references. */
--
-- RAM_D_BDETAIL6_IOR_DETAILS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.RAM_D_BDETAIL6_IOR_DETAILS
(DAY, "MMS_IN[CDRs]", "MMS_OUT[CDRs]", "MMS_OUT/IN[%]", "meta_DeliveryDate")
BEQUEATH DEFINER
AS 
select
DAY,
SUM(ORIGINATE_COUNT),
SUM(RECIPIENT_COUNT),
100*(SUM(RECIPIENT_COUNT)/(SUM(ORIGINATE_COUNT)+ 0.00001)-1.0),
trunc(SYSDATE)
from RAM_D_BDETAIL6_IOR_BASE
GROUP BY DAY
ORDER BY DAY DESC;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- RAM_D_BDETAIL6_IOR_I10  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.RAM_D_BDETAIL6_IOR_I10
(DAY, MSG_ID, ORIGINATE_COUNT, RECIPIENT_COUNT)
BEQUEATH DEFINER
AS 
SELECT      
        DAY,
        MSG_ID,
        SUM(ORIGINATE_COUNT),
        SUM(RECIPIENT_COUNT)
FROM            
        RAM_D_BDETAIL6_IOR_B10
GROUP BY
        DAY,
        MSG_ID
HAVING  SUM(ORIGINATE_COUNT) <> SUM(RECIPIENT_COUNT);


/* This object may not be sorted properly in the script due to cirular references. */
--
-- RAM_D_SR054A_DETAILS_3  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.RAM_D_SR054A_DETAILS_3
(REVAH_PACID, REVAC_DATE, REVAH_DESC, CDR_COUNT, CDR_ZEROCOUNT, 
 CDR_ZEROPERCENT)
BEQUEATH DEFINER
AS 
select
    revah_pacid,
    revac_date,
    revah_desc,
    sum(CDR_OUTCOUNT),
    sum(CDR_ZEROCOUNT),
    sum(CDR_ZEROCOUNT) / (sum(CDR_OUTCOUNT)+0.000001)
from RAM_D_SR054A_DETAILS_3_base
group by
    revah_pacid,
    revac_date,
    revah_desc
order by 1,2;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- RAM_D_SR054A_DETAILS_3_BASE  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.RAM_D_SR054A_DETAILS_3_BASE
(REVAH_PACID, PAC_INFO, REVAC_DATE, REVAH_DESC, CDR_OUTCOUNT, 
 REVAH_SRCTYPE, CDR_ZEROCOUNT)
BEQUEATH DEFINER
AS 
select
    revah_pacid,
    pac_info,
    revac_date,
    pac_name REVAH_DESC,
    sum(revac_out) CDR_OUTCOUNT,
    REVAH_SRCTYPE,
    SUM(DECODE(REVASM_ETID,'ZEROBILLED',REVAC_OUT,0)) CDR_ZEROCOUNT
from reva_header, reva_sigmask, reva_counter, packing
where revah_id = revasm_revahid
and revasm_id = revac_revasmid
and pac_id = REVAH_PACID
and revac_date >= trunc(sysdate) - 90
group by
    revah_pacid,
    pac_info,
    REVAH_SRCTYPE,
    revac_date,
    pac_name;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- RAM_D_SR054A_DETAILS_3_FG  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.RAM_D_SR054A_DETAILS_3_FG
(FIELD_NAME_CDR, FIELD_NAME_ZERO, FIELD_VAL_CDR, FIELD_VAL_ZERO, FIELD_SUM_CDR, 
 FIELD_SUM_ZERO, FIELD_DUMMY1, FIELD_DUMMY2)
BEQUEATH DEFINER
AS 
SELECT DISTINCT
	'"' || SRCT_CODE || '_' || PAC_INFO || '[CDRs]",',
	'"' || SRCT_CODE || '_' || PAC_INFO || '[0CDRs]",',
	'DECODE(REVAH_SRCTYPE || ''_'' || REVAH_PACID,''' || REVAH_SRCTYPE || '_' || REVAH_PACID || ''',CDR_OUTCOUNT,0),',
	'DECODE(REVAH_SRCTYPE || ''_'' || REVAH_PACID,''' || REVAH_SRCTYPE || '_' || REVAH_PACID || ''',CDR_ZEROCOUNT,0),',
	'SUM("' || SRCT_CODE || '_' || PAC_INFO || '[CDRs]"),',
	'SUM("' || SRCT_CODE || '_' || PAC_INFO || '[0CDRs]"),',
	'0,' ,'0,'
FROM
	REVA_HEADER, SRCTYPE, PACKING
WHERE   REVAH_SRCTYPE = SRCT_ID
AND     REVAH_PACID = PAC_ID
AND 	REVAH_SRCTYPE <> 'MBS'
AND     REVAH_ESID IN ('A')
AND     REVAH_BILLINGTYPE IN ('CU')
ORDER BY    2;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- RAM_D_SR054A_DETAILS_3_90  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.RAM_D_SR054A_DETAILS_3_90
(DAY, "MBB_BEPPI_CH[CDRs]", "MBB_BEPPI_CH[0CDRs]", "MBB_BEPPI_CH[0cdr%]", "MBB_BEPPI_FL[CDRs]", 
 "MBB_BEPPI_FL[0CDRs]", "MBB_BEPPI_FL[0cdr%]", "MB_BEPPI_CH[CDRs]", "MB_BEPPI_CH[0CDRs]", "MB_BEPPI_CH[0cdr%]", 
 "MB_BEPPI_FL[CDRs]", "MB_BEPPI_FL[0CDRs]", "MB_BEPPI_FL[0cdr%]", "MB_PPB[CDRs]", "MB_PPB[0CDRs]", 
 "MB_PPB[0cdr%]", "MB_RAP[CDRs]", "MB_RAP[0CDRs]", "MB_RAP[0cdr%]", "MMSC_BEPPI_CH[CDRs]", 
 "MMSC_BEPPI_CH[0CDRs]", "MMSC_BEPPI_CH[0cdr%]", "MMSC_BEPPI_FL[CDRs]", "MMSC_BEPPI_FL[0CDRs]", "MMSC_BEPPI_FL[0cdr%]", 
 "MPS_BEPPI_CH[CDRs]", "MPS_BEPPI_CH[0CDRs]", "MPS_BEPPI_CH[0cdr%]", "MSC_BEPPI_CH[CDRs]", "MSC_BEPPI_CH[0CDRs]", 
 "MSC_BEPPI_CH[0cdr%]", "MSC_BEPPI_FL[CDRs]", "MSC_BEPPI_FL[0CDRs]", "MSC_BEPPI_FL[0cdr%]", "OTA_BEPPI_CH[CDRs]", 
 "OTA_BEPPI_CH[0CDRs]", "OTA_BEPPI_CH[0cdr%]", "OTA_BEPPI_FL[CDRs]", "OTA_BEPPI_FL[0CDRs]", "OTA_BEPPI_FL[0cdr%]", 
 "OTA_PPB[CDRs]", "OTA_PPB[0CDRs]", "OTA_PPB[0cdr%]", "SMSC_BEPPI_CH[CDRs]", "SMSC_BEPPI_CH[0CDRs]", 
 "SMSC_BEPPI_CH[0cdr%]", "SMSC_BEPPI_FL[CDRs]", "SMSC_BEPPI_FL[0CDRs]", "SMSC_BEPPI_FL[0cdr%]", "SMSC_PPB[CDRs]", 
 "SMSC_PPB[0CDRs]", "SMSC_PPB[0cdr%]", "SMSC_RAP[CDRs]", "SMSC_RAP[0CDRs]", "SMSC_RAP[0cdr%]", 
 "meta_DeliveryDate")
BEQUEATH DEFINER
AS 
select
DAY,
SUM("MBB_BEPPI_CH[CDRs]"),  	SUM("MBB_BEPPI_CH[0CDRs]"),	SUM("MBB_BEPPI_CH[0CDRs]")/(SUM("MBB_BEPPI_CH[CDRs]") + 0.0001),
SUM("MBB_BEPPI_FL[CDRs]"),  	SUM("MBB_BEPPI_FL[0CDRs]"),	SUM("MBB_BEPPI_FL[0CDRs]")/(SUM("MBB_BEPPI_FL[CDRs]") + 0.0001),
SUM("MB_BEPPI_CH[CDRs]"),   	SUM("MB_BEPPI_CH[0CDRs]"),	SUM("MB_BEPPI_CH[0CDRs]")/(SUM("MB_BEPPI_CH[CDRs]") + 0.0001),
SUM("MB_BEPPI_FL[CDRs]"),   	SUM("MB_BEPPI_FL[0CDRs]"),	SUM("MB_BEPPI_FL[0CDRs]")/(SUM("MB_BEPPI_FL[CDRs]") + 0.0001),
SUM("MB_PPB[CDRs]"),        	SUM("MB_PPB[0CDRs]"),		SUM("MB_PPB[0CDRs]")/(SUM("MB_PPB[CDRs]") + 0.0001),
SUM("MB_RAP[CDRs]"),        	SUM("MB_RAP[0CDRs]"),		SUM("MB_RAP[0CDRs]")/(SUM("MB_RAP[CDRs]") + 0.0001),
SUM("MMSC_BEPPI_CH[CDRs]"), 	SUM("MMSC_BEPPI_CH[0CDRs]"),	SUM("MMSC_BEPPI_CH[0CDRs]")/(SUM("MMSC_BEPPI_CH[CDRs]") + 0.0001),
SUM("MMSC_BEPPI_FL[CDRs]"), 	SUM("MMSC_BEPPI_FL[0CDRs]"),	SUM("MMSC_BEPPI_FL[0CDRs]")/(SUM("MMSC_BEPPI_FL[CDRs]") + 0.0001),
SUM("MPS_BEPPI_CH[CDRs]"),  	SUM("MPS_BEPPI_CH[0CDRs]"),	SUM("MPS_BEPPI_CH[0CDRs]")/(SUM("MPS_BEPPI_CH[CDRs]") + 0.0001),
SUM("MSC_BEPPI_CH[CDRs]"),  	SUM("MSC_BEPPI_CH[0CDRs]"),	SUM("MSC_BEPPI_CH[0CDRs]")/(SUM("MSC_BEPPI_CH[CDRs]") + 0.0001),
SUM("MSC_BEPPI_FL[CDRs]"),  	SUM("MSC_BEPPI_FL[0CDRs]"),	SUM("MSC_BEPPI_FL[0CDRs]")/(SUM("MSC_BEPPI_FL[CDRs]") + 0.0001),
SUM("OTA_BEPPI_CH[CDRs]"),  	SUM("OTA_BEPPI_CH[0CDRs]"),	SUM("OTA_BEPPI_CH[0CDRs]")/(SUM("OTA_BEPPI_CH[CDRs]") + 0.0001),
SUM("OTA_BEPPI_FL[CDRs]"),  	SUM("OTA_BEPPI_FL[0CDRs]"),	SUM("OTA_BEPPI_FL[0CDRs]")/(SUM("OTA_BEPPI_FL[CDRs]") + 0.0001),
SUM("OTA_PPB[CDRs]"),       	SUM("OTA_PPB[0CDRs]"),		SUM("OTA_PPB[0CDRs]")/(SUM("OTA_PPB[CDRs]") +0.0001),
SUM("SMSC_BEPPI_CH[CDRs]"), 	SUM("SMSC_BEPPI_CH[0CDRs]"),	SUM("SMSC_BEPPI_CH[0CDRs]")/(SUM("SMSC_BEPPI_CH[CDRs]") +0.0001),
SUM("SMSC_BEPPI_FL[CDRs]"), 	SUM("SMSC_BEPPI_FL[0CDRs]"),	SUM("SMSC_BEPPI_FL[0CDRs]")/(SUM("SMSC_BEPPI_FL[CDRs]") + 0.0001),
SUM("SMSC_PPB[CDRs]"),      	SUM("SMSC_PPB[0CDRs]"),		SUM("SMSC_PPB[0CDRs]")/(SUM("SMSC_PPB[CDRs]") + 0.0001),
SUM("SMSC_RAP[CDRs]"),      	SUM("SMSC_RAP[0CDRs]"),		SUM("SMSC_RAP[0CDRs]")/(SUM("SMSC_RAP[CDRs]") + 0.0001),
trunc(SYSDATE)
from RAM_D_SR054A_DETAILS_3_90B
where DAY >= trunc(sysdate) - 90
GROUP BY DAY
ORDER BY DAY DESC;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- RAM_D_SR054A_DETAILS_3_90B  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.RAM_D_SR054A_DETAILS_3_90B
(DAY, "MBB_BEPPI_CH[CDRs]", "MBB_BEPPI_CH[0CDRs]", "MBB_BEPPI_FL[CDRs]", "MBB_BEPPI_FL[0CDRs]", 
 "MB_BEPPI_CH[CDRs]", "MB_BEPPI_CH[0CDRs]", "MB_BEPPI_FL[CDRs]", "MB_BEPPI_FL[0CDRs]", "MB_PPB[CDRs]", 
 "MB_PPB[0CDRs]", "MB_RAP[CDRs]", "MB_RAP[0CDRs]", "MMSC_BEPPI_CH[CDRs]", "MMSC_BEPPI_CH[0CDRs]", 
 "MMSC_BEPPI_FL[CDRs]", "MMSC_BEPPI_FL[0CDRs]", "MPS_BEPPI_CH[CDRs]", "MPS_BEPPI_CH[0CDRs]", "MSC_BEPPI_CH[CDRs]", 
 "MSC_BEPPI_CH[0CDRs]", "MSC_BEPPI_FL[CDRs]", "MSC_BEPPI_FL[0CDRs]", "OTA_BEPPI_CH[CDRs]", "OTA_BEPPI_CH[0CDRs]", 
 "OTA_BEPPI_FL[CDRs]", "OTA_BEPPI_FL[0CDRs]", "OTA_PPB[CDRs]", "OTA_PPB[0CDRs]", "SMSC_BEPPI_CH[CDRs]", 
 "SMSC_BEPPI_CH[0CDRs]", "SMSC_BEPPI_FL[CDRs]", "SMSC_BEPPI_FL[0CDRs]", "SMSC_PPB[CDRs]", "SMSC_PPB[0CDRs]", 
 "SMSC_RAP[CDRs]", "SMSC_RAP[0CDRs]", "meta_DeliveryDate")
BEQUEATH DEFINER
AS 
select
REVAC_DATE,
DECODE(REVAH_SRCTYPE || '_' || REVAH_PACID,'MMSB_MOMMSCH',CDR_OUTCOUNT,0),  	DECODE(REVAH_SRCTYPE || '_' || REVAH_PACID,'MMSB_MOMMSCH',CDR_ZEROCOUNT,0),
DECODE(REVAH_SRCTYPE || '_' || REVAH_PACID,'MMSB_MOMMSFL',CDR_OUTCOUNT,0),  	DECODE(REVAH_SRCTYPE || '_' || REVAH_PACID,'MMSB_MOMMSFL',CDR_ZEROCOUNT,0),
DECODE(REVAH_SRCTYPE || '_' || REVAH_PACID,'ISRV_MOCONTCH',CDR_OUTCOUNT,0), 	DECODE(REVAH_SRCTYPE || '_' || REVAH_PACID,'ISRV_MOCONTCH',CDR_ZEROCOUNT,0),
DECODE(REVAH_SRCTYPE || '_' || REVAH_PACID,'ISRV_MOCONTFL',CDR_OUTCOUNT,0), 	DECODE(REVAH_SRCTYPE || '_' || REVAH_PACID,'ISRV_MOCONTFL',CDR_ZEROCOUNT,0),
DECODE(REVAH_SRCTYPE || '_' || REVAH_PACID,'ISRV_PPBISRV',CDR_OUTCOUNT,0),  	DECODE(REVAH_SRCTYPE || '_' || REVAH_PACID,'ISRV_PPBISRV',CDR_ZEROCOUNT,0),
DECODE(REVAH_SRCTYPE || '_' || REVAH_PACID,'ISRV_RAPISRV',CDR_OUTCOUNT,0),  	DECODE(REVAH_SRCTYPE || '_' || REVAH_PACID,'ISRV_RAPISRV',CDR_ZEROCOUNT,0),
DECODE(REVAH_SRCTYPE || '_' || REVAH_PACID,'MMSC_MOMMSCH',CDR_OUTCOUNT,0),  	DECODE(REVAH_SRCTYPE || '_' || REVAH_PACID,'MMSC_MOMMSCH',CDR_ZEROCOUNT,0),
DECODE(REVAH_SRCTYPE || '_' || REVAH_PACID,'MMSC_MOMMSFL',CDR_OUTCOUNT,0),  	DECODE(REVAH_SRCTYPE || '_' || REVAH_PACID,'MMSC_MOMMSFL',CDR_ZEROCOUNT,0),
DECODE(REVAH_SRCTYPE || '_' || REVAH_PACID,'POS_MOPOSCH',CDR_OUTCOUNT,0),   	DECODE(REVAH_SRCTYPE || '_' || REVAH_PACID,'POS_MOPOSCH',CDR_ZEROCOUNT,0),
DECODE(REVAH_SRCTYPE || '_' || REVAH_PACID,'MSC_MOSMSCH',CDR_OUTCOUNT,0),   	DECODE(REVAH_SRCTYPE || '_' || REVAH_PACID,'MSC_MOSMSCH',CDR_ZEROCOUNT,0),
DECODE(REVAH_SRCTYPE || '_' || REVAH_PACID,'MSC_MOSMSFL',CDR_OUTCOUNT,0),   	DECODE(REVAH_SRCTYPE || '_' || REVAH_PACID,'MSC_MOSMSFL',CDR_ZEROCOUNT,0),
DECODE(REVAH_SRCTYPE || '_' || REVAH_PACID,'OTA_MOCONTCH',CDR_OUTCOUNT,0),  	DECODE(REVAH_SRCTYPE || '_' || REVAH_PACID,'OTA_MOCONTCH',CDR_ZEROCOUNT,0),
DECODE(REVAH_SRCTYPE || '_' || REVAH_PACID,'OTA_MOCONTFL',CDR_OUTCOUNT,0),  	DECODE(REVAH_SRCTYPE || '_' || REVAH_PACID,'OTA_MOCONTFL',CDR_ZEROCOUNT,0),
DECODE(REVAH_SRCTYPE || '_' || REVAH_PACID,'OTA_PPBOTA',CDR_OUTCOUNT,0),    	DECODE(REVAH_SRCTYPE || '_' || REVAH_PACID,'OTA_PPBOTA',CDR_ZEROCOUNT,0),
DECODE(REVAH_SRCTYPE || '_' || REVAH_PACID,'SMSC_MOCONTCH',CDR_OUTCOUNT,0), 	DECODE(REVAH_SRCTYPE || '_' || REVAH_PACID,'SMSC_MOCONTCH',CDR_ZEROCOUNT,0),
DECODE(REVAH_SRCTYPE || '_' || REVAH_PACID,'SMSC_MOCONTFL',CDR_OUTCOUNT,0), 	DECODE(REVAH_SRCTYPE || '_' || REVAH_PACID,'SMSC_MOCONTFL',CDR_ZEROCOUNT,0),
DECODE(REVAH_SRCTYPE || '_' || REVAH_PACID,'SMSC_PPBSMSC',CDR_OUTCOUNT,0),  	DECODE(REVAH_SRCTYPE || '_' || REVAH_PACID,'SMSC_PPBSMSC',CDR_ZEROCOUNT,0),
DECODE(REVAH_SRCTYPE || '_' || REVAH_PACID,'SMSC_RAPSMSC',CDR_OUTCOUNT,0),  	DECODE(REVAH_SRCTYPE || '_' || REVAH_PACID,'SMSC_RAPSMSC',CDR_ZEROCOUNT,0),
SYSDATE
from RAM_D_SR054A_DETAILS_3_BASE
where revac_date >= trunc(sysdate) - 90
and revac_date < trunc(sysdate)
UNION ALL
SELECT
TRUNC(SYSDATE)-ROWNUM,
0, 	0,
0, 	0,
0, 	0,
0, 	0,
0, 	0,
0, 	0,
0, 	0,
0, 	0,
0, 	0,
0, 	0,
0, 	0,
0, 	0,
0, 	0,
0, 	0,
0, 	0,
0, 	0,
0, 	0,
0, 	0,
SYSDATE
FROM    ERRDEF
WHERE   ROWNUM <= 90;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- RAM_D_SR075A_BASE_6  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.RAM_D_SR075A_BASE_6
(BD_SHORTID, BD_TRANSPORTMEDIUM, BD_COUNT, BD_ZEROCOUNT_BN, BD_ZEROCOUNT_OTHER)
BEQUEATH DEFINER
AS 
SELECT /*+ NO_INDEX (BDETAIL) */
	BD_SHORTID,
	DECODE(SUBSTR(BD_SERVICE,1,7),'MMS-BLK','MMS BULK',BD_TRANSPORTMEDIUM),
	COUNT(*),
	SUM(DECODE(BD_CONSTID,'BN',DECODE(BD_AMOUNTCU,0.0,1,0),'MVP',DECODE(BD_AMOUNTCU,0.0,1,0),0)),
	SUM(DECODE(BD_CONSTID,'BN',0,DECODE(BD_AMOUNTCU,0.0,1,0),'MVP',DECODE(BD_AMOUNTCU,0.0,1,0),0))
FROM    BDETAIL
WHERE   BD_DATETIME >= trunc(sysdate-1,'MONTH')
AND     BD_DATETIME < trunc(sysdate)
AND	    BD_MAPSID = 'R'
AND	    BD_BILLED = '1'
AND	    BD_RATED = '1'
AND	    BD_SRCTYPE = 'ISRV'
AND	    BD_SHORTID is not NULL
AND	    BD_DEMO = 0
GROUP BY
	BD_SHORTID,
	DECODE(SUBSTR(BD_SERVICE,1,7),'MMS-BLK','MMS BULK',BD_TRANSPORTMEDIUM);


/* This object may not be sorted properly in the script due to cirular references. */
--
-- RAM_D_SR075A_BASE_7  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.RAM_D_SR075A_BASE_7
(SHORTID, TRANSPORTMEDIUM, MATCH_COUNT, MISS_COUNT, MISS_PCT, 
 MISS_AMOUNT, UNDER_COUNT, UNDER_AMOUNT, OVER_COUNT, OVER_AMOUNT)
BEQUEATH DEFINER
AS 
SELECT /*+ NO_INDEX (BDETAIL) */
   SHORTID,
   SUBSTR(TABLE_SLAVE,4),
   COUNT(*),
   SUM(MISS_COUNT),
   SUM(MISS_COUNT)/COUNT(*),
   SUM(DECODE(MISS_COUNT,0,0.00,BD_AMOUNTCU)),
   SUM(DECODE(SIGN(BD_AMOUNTCU-CHARGED_AMOUNT),1,1,0)),
   SUM(DECODE(SIGN(BD_AMOUNTCU-CHARGED_AMOUNT),1,BD_AMOUNTCU-CHARGED_AMOUNT,0.0)),
   SUM(DECODE(SIGN(BD_AMOUNTCU-CHARGED_AMOUNT),-1,1,0)),
   SUM(DECODE(SIGN(BD_AMOUNTCU-CHARGED_AMOUNT),-1,CHARGED_AMOUNT-BD_AMOUNTCU,0.0))
FROM    BDETAIL, RAM_D_SR075A_BASE_7A
WHERE BDETAIL.ROWID = RAM_D_SR075A_BASE_7A.TABLE_ROWID_MASTER
GROUP BY
   SHORTID,
   SUBSTR(TABLE_SLAVE,4)

UNION ALL
SELECT
	SHORTID,
	SUBSTR(TABLE_SLAVE,4),
	0,
	0,
	0.00,
	0.00,
	0,
	0.00,
	MISS_COUNT,
	CHARGED_AMOUNT
FROM
	RAM_D_SR075A_BASE_7B

UNION ALL
SELECT
	SHORTID,
	SUBSTR(TABLE_SLAVE,4),
	0,
	0,
	0.00,
	0.00,
	0,
	0.00,
	MISS_COUNT,
	CHARGED_AMOUNT
FROM
	RAM_D_SR075A_BASE_7C;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- RAM_D_SR075A_DETAILS_6  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.RAM_D_SR075A_DETAILS_6
(BD_SHORTID, BD_TRANSPORTMEDIUM, BD_COUNT, BD_ZEROCOUNT_BN, BD_ZEROPERC_BN, 
 BD_ZEROCOUNT_OTHER, BD_ZEROPERC_OTHER)
BEQUEATH DEFINER
AS 
SELECT
   bd_shortid,
   bd_transportmedium,
   bd_count,
   bd_zerocount_bn,
   bd_zerocount_bn/(bd_count+0.000001),
   bd_zerocount_other,
   bd_zerocount_other/(bd_count+0.000001)
FROM    RAM_D_SR075A_BASE_6
ORDER BY
    to_number(bd_shortid),
    bd_transportmedium;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- RAM_D_SR075A_DETAILS_7  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.RAM_D_SR075A_DETAILS_7
(SHORTID, TRANSPORTMEDIUM, MATCH_COUNT, MISS_COUNT, MISS_PCT, 
 MISS_AMOUNT, UNDER_COUNT, UNDER_AMOUNT, OVER_COUNT, OVER_AMOUNT)
BEQUEATH DEFINER
AS 
SELECT
    SHORTID,
    TRANSPORTMEDIUM,
    SUM(MATCH_COUNT),
    SUM(MISS_COUNT),
    SUM(MISS_PCT),
    SUM(MISS_AMOUNT),
    SUM(UNDER_COUNT),
    SUM(UNDER_AMOUNT),
    SUM(OVER_COUNT),
    SUM(OVER_AMOUNT)
FROM  RAM_D_SR075A_BASE_7
GROUP BY
    SHORTID,
    TRANSPORTMEDIUM
ORDER BY
    to_number(SHORTID),
    2;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SAMPLES_ICB_BEIUK_PO  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SAMPLES_ICB_BEIUK_PO
(TS, DIRECTION, SCENARIO, CALLING_NUMBER, ORIG_SMSC, 
 CALLED_NUMBER, TERMIN_MSC, CALLED_IMSI, APMN, AMOUNT, 
 CURRENCY, OPKEY, SWITCH_ID, CON_STATE, CALL_ID)
BEQUEATH DEFINER
AS 
SELECT TS, DIRECTION, SCENARIO, CALLING_NUMBER, ORIG_SMSC, CALLED_NUMBER, TERMIN_MSC,
CALLED_IMSI, APMN, AMOUNT, CURRENCY, OPKEY, SWITCH_ID, CON_STATE, CALL_ID
FROM SAMPLES_ICB_BEIUK_P0_IW_T

UNION ALL

SELECT TS, DIRECTION, SCENARIO, CALLING_NUMBER, ORIG_SMSC, CALLED_NUMBER, TERMIN_MSC,
CALLED_IMSI, APMN, AMOUNT, CURRENCY, OPKEY, SWITCH_ID, CON_STATE, CALL_ID
FROM SAMPLES_ICB_BEIUK_P0_INACT_T

UNION ALL

SELECT TS, DIRECTION, SCENARIO, CALLING_NUMBER, ORIG_SMSC, CALLED_NUMBER, TERMIN_MSC,
CALLED_IMSI, APMN, AMOUNT, CURRENCY, OPKEY, SWITCH_ID, CON_STATE, CALL_ID
FROM SAMPLES_ICB_BEIUK_P0_ERR_T;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SAMPLES_ICB_BEIUK_P0_ERR_T  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SAMPLES_ICB_BEIUK_P0_ERR_T
(TS, DIRECTION, SCENARIO, CALLING_NUMBER, ORIG_SMSC, 
 CALLED_NUMBER, TERMIN_MSC, CALLED_IMSI, APMN, AMOUNT, 
 CURRENCY, OPKEY, SWITCH_ID, CON_STATE, CALL_ID)
BEQUEATH DEFINER
AS 
SELECT /*+ NO_INDEX (BDETAIL4) */
     to_char(BD_DATETIME,'YYYYMMDDhh24miss') as TS
    ,'I' as DIRECTION
    ,NULL as SCENARIO
    ,case
     when length(BD_MSISDN_B) < 6 then 'SC' || BD_MSISDN_B
     else DECODE(IS_NUMERIC(BD_MSISDN_B), 0, NULL , BD_MSISDN_B)
     end as CALLING_NUMBER
    ,BD_SCA as ORIG_SMSC
    ,BD_MSISDN_A as CALLED_NUMBER
    ,BD_MSCID as TERMIN_MSC
    ,BD_IMSI as CALLED_IMSI
    ,NULL as APMN
    ,NULL as AMOUNT
    ,NULL as CURRENCY
    ,NULL as OPKEY
    ,SUBSTR(BD_EXID,1,5) as SWITCH_ID
    ,'E' as CON_STATE
    ,BDETAIL4.ROWID as CALL_ID
FROM
  BDETAIL4,
  SMSC
WHERE SMSC_ID = BD_SMSCID
  AND BD_MAPSID = 'R'
  AND BD_PREPAID = 'N'
  and BD_IMSI like '22801%'
  and not BD_SCA like '4179%'
  AND ROWNUM <= 50
  AND NOT EXISTS (
    SELECT CON_ID FROM CONTRACT
    WHERE CON_OPKEY = SMSC_CONOPKEY
    AND CON_ESID IN ('A','I')
    AND CON_ETID = 'TOC'
    AND (CON_DATESTART <= BD_DATETIME OR CON_DATESTART IS NULL)
    AND (CON_DATEEND > BD_DATETIME OR CON_DATEEND IS NULL)
    -- AND CON_OPKEY NOT IN (0,9999)
  )

UNION ALL

SELECT /*+ NO_INDEX (BDETAIL4) */
     to_char(BD_DATETIME,'YYYYMMDDhh24miss') as TS
    ,'I' as DIRECTION
    ,NULL as SCENARIO
    ,DECODE(IS_NUMERIC(BD_MSISDN_B), 0, NULL , BD_MSISDN_B) as CALLING_NUMBER
    ,BD_SCA as ORIG_SMSC
    ,BD_MSISDN_A as CALLED_NUMBER
    ,BD_MSCID as TERMIN_MSC
    ,BD_IMSI as CALLED_IMSI
    ,NULL as APMN
    ,NULL as AMOUNT
    ,NULL as CURRENCY
    ,SMSC_CONOPKEY as OPKEY
    ,SUBSTR(BD_EXID,1,5) as SWITCH_ID
    ,'E' as CON_STATE
    ,BDETAIL4.ROWID as CALL_ID
FROM
  BDETAIL4,
  SMSC
WHERE SMSC_ID = BD_SMSCID
  AND BD_MAPSID = 'R'
  AND BD_PREPAID = 'N'
  and BD_IMSI like '22801%'
  and not BD_SCA like '4179%'
  and SMSC_CONOPKEY = '9999'
  AND ROWNUM <= 20

UNION ALL

SELECT /*+ NO_INDEX (BDETAIL4) */
     to_char(BD_DATETIME,'YYYYMMDDhh24miss') as TS
    ,'I' as DIRECTION
    ,NULL as SCENARIO
    ,DECODE(IS_NUMERIC(BD_MSISDN_B), 0, NULL , BD_MSISDN_B) as CALLING_NUMBER
    ,BD_SCA as ORIG_SMSC
    ,BD_MSISDN_A as CALLED_NUMBER
    ,BD_MSCID as TERMIN_MSC
    ,BD_IMSI as CALLED_IMSI
    ,NULL as APMN
    ,NULL as AMOUNT
    ,NULL as CURRENCY
    ,SMSC_CONOPKEY as OPKEY
    ,SUBSTR(BD_EXID,1,5) as SWITCH_ID
    ,'E' as CON_STATE
    ,BDETAIL4.ROWID as CALL_ID
FROM
  BDETAIL4,
  SMSC
WHERE SMSC_ID = BD_SMSCID
  AND BD_MAPSID = 'R'
  AND BD_PREPAID = 'N'
  and BD_IMSI like '22801%'
  and not BD_SCA like '4179%'
  and SMSC_CONOPKEY = '0'
  AND ROWNUM <= 20

ORDER BY 1;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SAMPLES_ICB_BEIUK_P0_INACT_T  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SAMPLES_ICB_BEIUK_P0_INACT_T
(TS, DIRECTION, SCENARIO, CALLING_NUMBER, ORIG_SMSC, 
 CALLED_NUMBER, TERMIN_MSC, CALLED_IMSI, APMN, AMOUNT, 
 CURRENCY, OPKEY, SWITCH_ID, CON_STATE, CALL_ID)
BEQUEATH DEFINER
AS 
SELECT /*+ NO_INDEX (BDETAIL4) */
          to_char(BD_DATETIME,'YYYYMMDDhh24miss') as TS
    ,'I' as DIRECTION
    ,'1' as SCENARIO
    ,case
     when length(BD_MSISDN_B) < 6 then 'SC' || BD_MSISDN_B
     else DECODE(IS_NUMERIC(BD_MSISDN_B), 0, NULL , BD_MSISDN_B)
     end as CALLING_NUMBER
    ,BD_SCA as ORIG_SMSC
    ,BD_MSISDN_A as CALLED_NUMBER
    ,BD_MSCID as TERMIN_MSC
    ,BD_IMSI as CALLED_IMSI
    ,CON_CODE as APMN
    ,0.00 as AMOUNT
    ,NULL as CURRENCY
    ,CON_OPKEY as OPKEY
    ,SUBSTR(BD_EXID,1,5) as SWITCH_ID
    ,CON_ESID as CON_STATE
    ,BDETAIL4.ROWID as CALL_ID
FROM
  CONTRACT,
  BDETAIL4,
  SMSC
WHERE SMSC_ID = BD_SMSCID
  AND SMSC_CONOPKEY NOT IN (0,9999)
  AND CON_OPKEY = SMSC_CONOPKEY
  AND CON_ESID = 'I'
  AND CON_ETID = 'TOC'
  AND (CON_DATESTART <= BD_DATETIME OR CON_DATESTART IS NULL)
  AND (CON_DATEEND > BD_DATETIME OR CON_DATEEND IS NULL)
  AND BD_MAPSID = 'R'
  AND BD_PREPAID = 'N'
  and BD_IMSI like '22801%'
  and not BD_SCA like '4179%'
  AND ROWNUM <= 50

ORDER BY 1;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SAMPLES_ICB_BEIUK_P0_IW_T  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SAMPLES_ICB_BEIUK_P0_IW_T
(TS, DIRECTION, SCENARIO, CALLING_NUMBER, ORIG_SMSC, 
 CALLED_NUMBER, TERMIN_MSC, CALLED_IMSI, APMN, AMOUNT, 
 CURRENCY, OPKEY, SWITCH_ID, CON_STATE, CALL_ID)
BEQUEATH DEFINER
AS 
SELECT /*+ NO_INDEX (BDETAIL4) */
     to_char(BD_DATETIME,'YYYYMMDDhh24miss') as TS
    ,'I' as DIRECTION
    ,'1' as SCENARIO
    ,case
     when length(BD_MSISDN_B) < 6 then 'SC' || BD_MSISDN_B
     else DECODE(IS_NUMERIC(BD_MSISDN_B), 0, NULL , BD_MSISDN_B)
     end as CALLING_NUMBER
    ,BD_SCA as ORIG_SMSC
    ,BD_MSISDN_A as CALLED_NUMBER
    ,BD_MSCID as TERMIN_MSC
    ,BD_IMSI as CALLED_IMSI
    ,CON_CODE as APMN
    ,ROUND(NVL(CIOTE_PRICE,0.00)* dbms_random.value() * 2,4) as AMOUNT
    ,CIOT_CURID as CURRENCY
    ,CON_OPKEY as OPKEY
    ,SUBSTR(BD_EXID,1,5) as SWITCH_ID
    ,CON_ESID as CON_STATE
    ,BDETAIL4.ROWID as CALL_ID
FROM
  CONTRACT,
  CONIOT,
  CONIOTE,
  BDETAIL4,
  SMSC
WHERE SMSC_ID = BD_SMSCID
  AND CON_OPKEY = SMSC_CONOPKEY
  AND CON_ESID = 'A'
  AND CON_ETID = 'TOC'
  AND (CON_DATESTART <= BD_DATETIME OR CON_DATESTART IS NULL)
  AND (CON_DATEEND > BD_DATETIME OR CON_DATEEND IS NULL)
  AND CIOT_ID = CIOTE_CIOTID
  AND CIOT_CONID = CON_ID
  AND CIOT_TRCTID IN ('SMS')
  AND CIOT_IWDID IN ('TERM')
  AND BD_MAPSID = 'R'
  AND BD_PREPAID = 'N'
  and BD_IMSI like '22801%'
  and not BD_SCA like '4179%'
  AND ROWNUM <= 50

ORDER BY 1;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SAMPLES_ICB_SMCH80  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SAMPLES_ICB_SMCH80
(TS, DIRECTION, SCENARIO, CALLING_NUMBER, ORIG_SMSC, 
 CALLED_NUMBER, TERMIN_MSC, CALLED_IMSI, APMN, AMOUNT, 
 CURRENCY, OPKEY, SWITCH_ID, CON_STATE, CALL_ID)
BEQUEATH DEFINER
AS 
SELECT TS, DIRECTION, SCENARIO, CALLING_NUMBER, ORIG_SMSC, CALLED_NUMBER, TERMIN_MSC,
CALLED_IMSI, APMN, AMOUNT, CURRENCY, OPKEY, SWITCH_ID, CON_STATE, CALL_ID
FROM SAMPLES_ICB_SMCH80_IW_O

UNION ALL

SELECT TS, DIRECTION, SCENARIO, CALLING_NUMBER, ORIG_SMSC, CALLED_NUMBER, TERMIN_MSC,
CALLED_IMSI, APMN, AMOUNT, CURRENCY, OPKEY, SWITCH_ID, CON_STATE, CALL_ID
FROM SAMPLES_ICB_SMCH80_ROAM_O

UNION ALL

SELECT TS, DIRECTION, SCENARIO, CALLING_NUMBER, ORIG_SMSC, CALLED_NUMBER, TERMIN_MSC,
CALLED_IMSI, APMN, AMOUNT, CURRENCY, OPKEY, SWITCH_ID, CON_STATE, CALL_ID
FROM SAMPLES_ICB_SMCH80_INACT_O

UNION ALL

SELECT TS, DIRECTION, SCENARIO, CALLING_NUMBER, ORIG_SMSC, CALLED_NUMBER, TERMIN_MSC,
CALLED_IMSI, APMN, AMOUNT, CURRENCY, OPKEY, SWITCH_ID, CON_STATE, CALL_ID
FROM SAMPLES_ICB_SMCH80_ERR_O

UNION ALL

SELECT TS, DIRECTION, SCENARIO, CALLING_NUMBER, ORIG_SMSC, CALLED_NUMBER, TERMIN_MSC,
CALLED_IMSI, APMN, AMOUNT, CURRENCY, OPKEY, SWITCH_ID, CON_STATE, CALL_ID
FROM SAMPLES_ICB_SMCH80_IW_T

UNION ALL

SELECT TS, DIRECTION, SCENARIO, CALLING_NUMBER, ORIG_SMSC, CALLED_NUMBER, TERMIN_MSC,
CALLED_IMSI, APMN, AMOUNT, CURRENCY, OPKEY, SWITCH_ID, CON_STATE, CALL_ID
FROM SAMPLES_ICB_SMCH80_ROAM_T

UNION ALL

SELECT TS, DIRECTION, SCENARIO, CALLING_NUMBER, ORIG_SMSC, CALLED_NUMBER, TERMIN_MSC,
CALLED_IMSI, APMN, AMOUNT, CURRENCY, OPKEY, SWITCH_ID, CON_STATE, CALL_ID
FROM SAMPLES_ICB_SMCH80_INACT_T

UNION ALL

SELECT TS, DIRECTION, SCENARIO, CALLING_NUMBER, ORIG_SMSC, CALLED_NUMBER, TERMIN_MSC,
CALLED_IMSI, APMN, AMOUNT, CURRENCY, OPKEY, SWITCH_ID, CON_STATE, CALL_ID
FROM SAMPLES_ICB_SMCH80_ERR_T;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SAMPLES_ICB_SMCH80_ERR_O  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SAMPLES_ICB_SMCH80_ERR_O
(TS, DIRECTION, SCENARIO, CALLING_NUMBER, ORIG_SMSC, 
 CALLED_NUMBER, TERMIN_MSC, CALLED_IMSI, APMN, AMOUNT, 
 CURRENCY, OPKEY, SWITCH_ID, CON_STATE, CALL_ID)
BEQUEATH DEFINER
AS 
SELECT /*+ NO_INDEX (BDETAIL2) */
     to_char(BD_DATETIME,'YYYYMMDDhh24miss') as TS
    ,'O' as DIRECTION
    , NULL as SCENARIO
    ,DECODE(IS_NUMERIC(BD_MSISDN_A), 0, '4179499900' || DECODE(SUBSTR(BD_MESSAGEREFERENCE,-3),'_80','1','_90','2','0'), BD_MSISDN_A) as CALLING_NUMBER
    ,'4179499900' || DECODE(SUBSTR(BD_MESSAGEREFERENCE,-3),'_80','1','_90','2','0') as ORIG_SMSC
    ,BD_MSISDN_B as CALLED_NUMBER
    ,BD_DGTI as TERMIN_MSC
    ,BD_IMSI as CALLED_IMSI
    ,NULL as APMN
    ,NULL as AMOUNT
    ,NULL as CURRENCY
    ,NULL as OPKEY
    ,'SMCH' || SUBSTR(BD_MESSAGEREFERENCE,-2) as SWITCH_ID
    ,'E' as CON_STATE
    ,BD_MESSAGEREFERENCE as CALL_ID
FROM
  BDETAIL2
WHERE BD_DATETIME >= ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1)
  AND BD_DATETIME < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
  AND BD_TOCID IS NULL
  AND BD_MAPSID = 'R'
  AND BD_NPI_B = '1'
  AND BD_PID_B = '0'
  AND BD_CDRTID <> 'SMS-HR'
  AND BD_IMSI NOT LIKE '22801%'
  AND BD_STATUS = 0
  AND SUBSTR(BD_MESSAGEREFERENCE,-2) = '80'
  AND ROWNUM <= 50
  
ORDER BY 1;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SAMPLES_ICB_SMCH80_ERR_T  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SAMPLES_ICB_SMCH80_ERR_T
(TS, DIRECTION, SCENARIO, CALLING_NUMBER, ORIG_SMSC, 
 CALLED_NUMBER, TERMIN_MSC, CALLED_IMSI, APMN, AMOUNT, 
 CURRENCY, OPKEY, SWITCH_ID, CON_STATE, CALL_ID)
BEQUEATH DEFINER
AS 
SELECT /*+ NO_INDEX (BDETAIL2) */
     to_char(BD_DATETIME,'YYYYMMDDhh24miss') as TS
    ,'I' as DIRECTION
    ,'1' as SCENARIO
    ,DECODE(IS_NUMERIC(BD_MSISDN_A), 0, NULL , BD_MSISDN_A) as CALLING_NUMBER
    ,BD_ORIGSCA as ORIG_SMSC
    ,BD_MSISDN_B as CALLED_NUMBER
    ,'417949990' || BD_VSMSCID as TERMIN_MSC  -- BD_DGTI
    ,BD_IMSI as CALLED_IMSI
    ,NULL as APMN
    ,NULL as AMOUNT
    ,NULL as CURRENCY
    ,NULL as OPKEY
    ,'SMCH' || SUBSTR(BD_MESSAGEREFERENCE,-2) as SWITCH_ID
    ,'E' as CON_STATE
    ,BD_MESSAGEREFERENCE as CALL_ID
FROM
  BDETAIL2
WHERE BD_DATETIME >= ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1)
  AND BD_DATETIME < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
  AND BD_TOCID is NULL
  AND BD_MAPSID = 'R'
  AND BD_CDRTID = 'SMS-HR'
  AND BD_STATUS = 0
  AND SUBSTR(BD_MESSAGEREFERENCE,-2) = '80'
  AND ROWNUM <= 50


ORDER BY 1;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SAMPLES_ICB_SMCH80_INACT_O  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SAMPLES_ICB_SMCH80_INACT_O
(TS, DIRECTION, SCENARIO, CALLING_NUMBER, ORIG_SMSC, 
 CALLED_NUMBER, TERMIN_MSC, CALLED_IMSI, APMN, AMOUNT, 
 CURRENCY, OPKEY, SWITCH_ID, CON_STATE, CALL_ID)
BEQUEATH DEFINER
AS 
SELECT /*+ NO_INDEX (BDETAIL2) */
     to_char(BD_DATETIME,'YYYYMMDDhh24miss') as TS
    ,'O' as DIRECTION
    ,'1' as SCENARIO
    ,DECODE(IS_NUMERIC(BD_MSISDN_A), 0, '4179499900' || DECODE(SUBSTR(BD_MESSAGEREFERENCE,-3),'_80','1','_90','2','0'), BD_MSISDN_A) as CALLING_NUMBER
    ,'4179499900' || DECODE(SUBSTR(BD_MESSAGEREFERENCE,-3),'_80','1','_90','2','0') as ORIG_SMSC
    ,BD_MSISDN_B as CALLED_NUMBER
    ,BD_DGTI as TERMIN_MSC
    ,BD_IMSI as CALLED_IMSI
    ,CON_CODE as APMN
    ,0.00 as AMOUNT
    ,NULL as CURRENCY
    ,CON_OPKEY as OPKEY
    ,'SMCH' || SUBSTR(BD_MESSAGEREFERENCE,-2) as SWITCH_ID
    ,'I' as CON_STATE
    ,BD_MESSAGEREFERENCE as CALL_ID
FROM
  CONTRACT,
  BDETAIL2
WHERE
  CONTRACT.CON_ESID = 'I'
  AND CON_DATESTART < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
  AND (CON_DATEEND > ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1) OR CON_DATEEND IS NULL)
  AND BD_DATETIME >= ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1)
  AND BD_DATETIME < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
  AND BD_TOCID = CON_ID
  AND BD_MAPSID = 'R'
  AND BD_NPI_B = '1'
  AND BD_PID_B = '0'
  AND BD_CDRTID <> 'SMS-HR'
  AND BD_STATUS = 0
  AND SUBSTR(BD_MESSAGEREFERENCE,-2) = '80'
  AND ROWNUM <= 50
  
ORDER BY 1;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SAMPLES_ICB_SMCH80_INACT_T  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SAMPLES_ICB_SMCH80_INACT_T
(TS, DIRECTION, SCENARIO, CALLING_NUMBER, ORIG_SMSC, 
 CALLED_NUMBER, TERMIN_MSC, CALLED_IMSI, APMN, AMOUNT, 
 CURRENCY, OPKEY, SWITCH_ID, CON_STATE, CALL_ID)
BEQUEATH DEFINER
AS 
SELECT /*+ NO_INDEX (BDETAIL2) */
     to_char(BD_DATETIME,'YYYYMMDDhh24miss') as TS
    ,'I' as DIRECTION
    ,'1' as SCENARIO
    ,DECODE(IS_NUMERIC(BD_MSISDN_A), 0, NULL , BD_MSISDN_A) as CALLING_NUMBER
    ,BD_ORIGSCA as ORIG_SMSC
    ,BD_MSISDN_B as CALLED_NUMBER
    ,'417949990' || BD_VSMSCID as TERMIN_MSC  -- BD_DGTI
    ,BD_IMSI as CALLED_IMSI
    ,CON_CODE as APMN
    ,0.00 as AMOUNT
    ,NULL as CURRENCY
    ,CON_OPKEY as OPKEY
    ,'SMCH' || SUBSTR(BD_MESSAGEREFERENCE,-2) as SWITCH_ID
    ,CON_ESID as CON_STATE
    ,BD_MESSAGEREFERENCE as CALL_ID
FROM
  CONTRACT,
  BDETAIL2
WHERE
  CONTRACT.CON_ESID = 'I'
  AND CON_DATESTART < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
  AND (CON_DATEEND > ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1) OR CON_DATEEND IS NULL)
  AND BD_DATETIME >= ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1)
  AND BD_DATETIME < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
  AND BD_TOCID = CON_ID
  AND BD_MAPSID = 'R'
  AND BD_CDRTID = 'SMS-HR'
  AND BD_STATUS = 0
  AND SUBSTR(BD_MESSAGEREFERENCE,-2) = '80'
  AND ROWNUM <= 50


ORDER BY 1;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SAMPLES_ICB_SMCH80_IW_O  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SAMPLES_ICB_SMCH80_IW_O
(TS, DIRECTION, SCENARIO, CALLING_NUMBER, ORIG_SMSC, 
 CALLED_NUMBER, TERMIN_MSC, CALLED_IMSI, APMN, AMOUNT, 
 CURRENCY, OPKEY, SWITCH_ID, CON_STATE, CALL_ID)
BEQUEATH DEFINER
AS 
SELECT /*+ NO_INDEX (BDETAIL2) */
     to_char(BD_DATETIME,'YYYYMMDDhh24miss') as TS
    ,'O' as DIRECTION
    ,'1' as SCENARIO
    ,DECODE(IS_NUMERIC(BD_MSISDN_A), 0, '4179499900' || DECODE(SUBSTR(BD_MESSAGEREFERENCE,-3),'_80','1','_90','2','0'), BD_MSISDN_A) as CALLING_NUMBER
    ,'4179499900' || DECODE(SUBSTR(BD_MESSAGEREFERENCE,-3),'_80','1','_90','2','0') as ORIG_SMSC
    ,BD_MSISDN_B as CALLED_NUMBER
    ,BD_DGTI as TERMIN_MSC
    ,BD_IMSI as CALLED_IMSI
    ,CON_CODE as APMN
    ,ROUND(NVL(CIOTE_PRICE,0.00)* dbms_random.value() * 2,4) as AMOUNT
    ,NULL as CURRENCY
    ,CON_OPKEY as OPKEY
    ,'SMCH' || SUBSTR(BD_MESSAGEREFERENCE,-2) as SWITCH_ID
    ,CON_ESID as CON_STATE
    ,BD_MESSAGEREFERENCE as CALL_ID
FROM
  CONTRACT,
  CONIOT,
  CONIOTE,
  BDETAIL2
WHERE
  CONTRACT.CON_ESID = 'A'
  AND CON_DATESTART < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
  AND (CON_DATEEND > ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1) OR CON_DATEEND IS NULL)
  AND CIOT_ID = CIOTE_CIOTID
  AND CIOT_CONID = CON_ID
  AND CIOT_TRCTID IN ('SMS')
  AND CIOT_IWDID IN ('ORIG')
  AND BD_DATETIME >= ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1)
  AND BD_DATETIME < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
  AND BD_TOCID = CON_ID
  AND BD_MAPSID = 'R'
  AND BD_NPI_B = '1'
  AND BD_PID_B = '0'
  AND BD_CDRTID <> 'SMS-HR'
  AND BD_IW = '1'
  AND BD_STATUS = 0
  AND SUBSTR(BD_MESSAGEREFERENCE,-2) = '80'
  AND ROWNUM <= 50


ORDER BY 1;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SAMPLES_ICB_SMCH80_IW_T  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SAMPLES_ICB_SMCH80_IW_T
(TS, DIRECTION, SCENARIO, CALLING_NUMBER, ORIG_SMSC, 
 CALLED_NUMBER, TERMIN_MSC, CALLED_IMSI, APMN, AMOUNT, 
 CURRENCY, OPKEY, SWITCH_ID, CON_STATE, CALL_ID)
BEQUEATH DEFINER
AS 
SELECT /*+ NO_INDEX (BDETAIL2) */
     to_char(BD_DATETIME,'YYYYMMDDhh24miss') as TS
    ,'I' as DIRECTION
    ,'1' as SCENARIO
    ,DECODE(IS_NUMERIC(BD_MSISDN_A), 0, NULL , BD_MSISDN_A) as CALLING_NUMBER
    ,BD_ORIGSCA as ORIG_SMSC
    ,BD_MSISDN_B as CALLED_NUMBER
    ,'417949990' || BD_VSMSCID as TERMIN_MSC  -- BD_DGTI
    ,BD_IMSI as CALLED_IMSI
    ,CON_CODE as APMN
    ,ROUND(NVL(CIOTE_PRICE,0.00)* dbms_random.value() * 2,4) as AMOUNT
    ,NULL as CURRENCY
    ,CON_OPKEY as OPKEY
    ,'SMCH' || SUBSTR(BD_MESSAGEREFERENCE,-2) as SWITCH_ID
    ,CON_ESID as CON_STATE
    ,BD_MESSAGEREFERENCE as CALL_ID
FROM
  CONTRACT,
  CONIOT,
  CONIOTE,
  BDETAIL2
WHERE
  CONTRACT.CON_ESID = 'A'
  AND CON_DATESTART < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
  AND (CON_DATEEND > ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1) OR CON_DATEEND IS NULL)
  AND CIOT_ID = CIOTE_CIOTID
  AND CIOT_CONID = CON_ID
  AND CIOT_TRCTID IN ('SMS')
  AND CIOT_IWDID IN ('TERM')
  AND BD_DATETIME >= ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1)
  AND BD_DATETIME < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
  AND BD_TOCID = CON_ID
  AND BD_MAPSID = 'R'
  AND BD_CDRTID = 'SMS-HR'
  AND BD_IW = '1'
  AND BD_STATUS = 0
  AND SUBSTR(BD_MESSAGEREFERENCE,-2) = '80'
  AND ROWNUM <= 50


ORDER BY 1;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SAMPLES_ICB_SMCH80_ROAM_O  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SAMPLES_ICB_SMCH80_ROAM_O
(TS, DIRECTION, SCENARIO, CALLING_NUMBER, ORIG_SMSC, 
 CALLED_NUMBER, TERMIN_MSC, CALLED_IMSI, APMN, AMOUNT, 
 CURRENCY, OPKEY, SWITCH_ID, CON_STATE, CALL_ID)
BEQUEATH DEFINER
AS 
SELECT /*+ NO_INDEX (BDETAIL2) */
     to_char(BD_DATETIME,'YYYYMMDDhh24miss') as TS
    ,'O' as DIRECTION
    ,'5' as SCENARIO
    ,DECODE(IS_NUMERIC(BD_MSISDN_A), 0, '4179499900' || DECODE(SUBSTR(BD_MESSAGEREFERENCE,-3),'_80','1','_90','2','0'), BD_MSISDN_A) as CALLING_NUMBER
    ,'4179499900' || DECODE(SUBSTR(BD_MESSAGEREFERENCE,-3),'_80','1','_90','2','0') as ORIG_SMSC
    ,BD_MSISDN_B as CALLED_NUMBER
    ,BD_DGTI as TERMIN_MSC
    ,BD_IMSI as CALLED_IMSI
    ,CON_CODE as APMN
    ,0.00 as AMOUNT
    ,NULL as CURRENCY
    ,CON_OPKEY as OPKEY
    ,'SMCH' || SUBSTR(BD_MESSAGEREFERENCE,-2) as SWITCH_ID
    ,CON_ESID as CON_STATE
    ,BD_MESSAGEREFERENCE as CALL_ID
FROM
  CONTRACT,
  BDETAIL2
WHERE
  CONTRACT.CON_ESID = 'A'
  AND CON_DATESTART < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
  AND (CON_DATEEND > ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1) OR CON_DATEEND IS NULL)
  AND BD_DATETIME >= ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1)
  AND BD_DATETIME < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
  AND BD_TOCID = CON_ID
  AND BD_MAPSID = 'R'
  AND BD_NPI_B = '1'
  AND BD_PID_B = '0'
  AND BD_CDRTID <> 'SMS-HR'
  AND NVL(BD_IW,'0') = '0'
  AND BD_STATUS = 0
  AND SUBSTR(BD_MESSAGEREFERENCE,-2) = '80'
  AND ROWNUM <= 50
  
ORDER BY 1;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SAMPLES_ICB_SMCH80_ROAM_T  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SAMPLES_ICB_SMCH80_ROAM_T
(TS, DIRECTION, SCENARIO, CALLING_NUMBER, ORIG_SMSC, 
 CALLED_NUMBER, TERMIN_MSC, CALLED_IMSI, APMN, AMOUNT, 
 CURRENCY, OPKEY, SWITCH_ID, CON_STATE, CALL_ID)
BEQUEATH DEFINER
AS 
SELECT /*+ NO_INDEX (BDETAIL2) */
     to_char(BD_DATETIME,'YYYYMMDDhh24miss') as TS
    ,'I' as DIRECTION
    ,'5' as SCENARIO
    ,DECODE(IS_NUMERIC(BD_MSISDN_A), 0, NULL , BD_MSISDN_A) as CALLING_NUMBER
    ,BD_ORIGSCA as ORIG_SMSC
    ,BD_MSISDN_B as CALLED_NUMBER
    ,'417949990' || BD_VSMSCID as TERMIN_MSC  -- BD_DGTI
    ,BD_IMSI as CALLED_IMSI
    ,CON_CODE as APMN
    ,0.00 as AMOUNT
    ,NULL as CURRENCY
    ,CON_OPKEY as OPKEY
    ,'SMCH' || SUBSTR(BD_MESSAGEREFERENCE,-2) as SWITCH_ID
    ,CON_ESID as CON_STATE
    ,BD_MESSAGEREFERENCE as CALL_ID
FROM
  CONTRACT,
  BDETAIL2
WHERE
  CONTRACT.CON_ESID = 'A'
  AND CON_DATESTART < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
  AND (CON_DATEEND > ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1) OR CON_DATEEND IS NULL)
  AND BD_DATETIME >= ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1)
  AND BD_DATETIME < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
  AND BD_TOCID = CON_ID
  AND BD_MAPSID = 'R'
  AND BD_CDRTID = 'SMS-HR'
  AND NVL(BD_IW,'0') = '0'
  AND BD_STATUS = 0
  AND SUBSTR(BD_MESSAGEREFERENCE,-2) = '80'
  AND ROWNUM <= 50


ORDER BY 1;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SAMPLES_ICB_SMCH90  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SAMPLES_ICB_SMCH90
(TS, DIRECTION, SCENARIO, CALLING_NUMBER, ORIG_SMSC, 
 CALLED_NUMBER, TERMIN_MSC, CALLED_IMSI, APMN, AMOUNT, 
 CURRENCY, OPKEY, SWITCH_ID, CON_STATE, CALL_ID)
BEQUEATH DEFINER
AS 
SELECT TS, DIRECTION, SCENARIO, CALLING_NUMBER, ORIG_SMSC, CALLED_NUMBER, TERMIN_MSC,
CALLED_IMSI, APMN, AMOUNT, CURRENCY, OPKEY, SWITCH_ID, CON_STATE, CALL_ID
FROM SAMPLES_ICB_SMCH90_IW_O

UNION ALL

SELECT TS, DIRECTION, SCENARIO, CALLING_NUMBER, ORIG_SMSC, CALLED_NUMBER, TERMIN_MSC,
CALLED_IMSI, APMN, AMOUNT, CURRENCY, OPKEY, SWITCH_ID, CON_STATE, CALL_ID
FROM SAMPLES_ICB_SMCH90_ROAM_O

UNION ALL

SELECT TS, DIRECTION, SCENARIO, CALLING_NUMBER, ORIG_SMSC, CALLED_NUMBER, TERMIN_MSC,
CALLED_IMSI, APMN, AMOUNT, CURRENCY, OPKEY, SWITCH_ID, CON_STATE, CALL_ID
FROM SAMPLES_ICB_SMCH90_INACT_O

UNION ALL

SELECT TS, DIRECTION, SCENARIO, CALLING_NUMBER, ORIG_SMSC, CALLED_NUMBER, TERMIN_MSC,
CALLED_IMSI, APMN, AMOUNT, CURRENCY, OPKEY, SWITCH_ID, CON_STATE, CALL_ID
FROM SAMPLES_ICB_SMCH90_ERR_O

UNION ALL

SELECT TS, DIRECTION, SCENARIO, CALLING_NUMBER, ORIG_SMSC, CALLED_NUMBER, TERMIN_MSC,
CALLED_IMSI, APMN, AMOUNT, CURRENCY, OPKEY, SWITCH_ID, CON_STATE, CALL_ID
FROM SAMPLES_ICB_SMCH90_IW_T

UNION ALL

SELECT TS, DIRECTION, SCENARIO, CALLING_NUMBER, ORIG_SMSC, CALLED_NUMBER, TERMIN_MSC,
CALLED_IMSI, APMN, AMOUNT, CURRENCY, OPKEY, SWITCH_ID, CON_STATE, CALL_ID
FROM SAMPLES_ICB_SMCH90_ROAM_T

UNION ALL

SELECT TS, DIRECTION, SCENARIO, CALLING_NUMBER, ORIG_SMSC, CALLED_NUMBER, TERMIN_MSC,
CALLED_IMSI, APMN, AMOUNT, CURRENCY, OPKEY, SWITCH_ID, CON_STATE, CALL_ID
FROM SAMPLES_ICB_SMCH90_INACT_T

UNION ALL

SELECT TS, DIRECTION, SCENARIO, CALLING_NUMBER, ORIG_SMSC, CALLED_NUMBER, TERMIN_MSC,
CALLED_IMSI, APMN, AMOUNT, CURRENCY, OPKEY, SWITCH_ID, CON_STATE, CALL_ID
FROM SAMPLES_ICB_SMCH90_ERR_T;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SAMPLES_ICB_SMCH90_ERR_O  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SAMPLES_ICB_SMCH90_ERR_O
(TS, DIRECTION, SCENARIO, CALLING_NUMBER, ORIG_SMSC, 
 CALLED_NUMBER, TERMIN_MSC, CALLED_IMSI, APMN, AMOUNT, 
 CURRENCY, OPKEY, SWITCH_ID, CON_STATE, CALL_ID)
BEQUEATH DEFINER
AS 
SELECT /*+ NO_INDEX (BDETAIL2) */
     to_char(BD_DATETIME,'YYYYMMDDhh24miss') as TS
    ,'O' as DIRECTION
    , NULL as SCENARIO
    ,case
     when length(BD_MSISDN_A) < 6 then 'SC' || BD_MSISDN_A
     else DECODE(IS_NUMERIC(BD_MSISDN_A), 0, '4179499900' || DECODE(SUBSTR(BD_MESSAGEREFERENCE,-3),'_80','1','_90','2','0'), BD_MSISDN_A)
     end  as CALLING_NUMBER
    ,'4179499900' || DECODE(SUBSTR(BD_MESSAGEREFERENCE,-3),'_80','1','_90','2','0') as ORIG_SMSC
    ,BD_MSISDN_B as CALLED_NUMBER
    ,BD_DGTI as TERMIN_MSC
    ,BD_IMSI as CALLED_IMSI
    ,NULL as APMN
    ,NULL as AMOUNT
    ,NULL as CURRENCY
    ,NULL as OPKEY
    ,'SMCH' || SUBSTR(BD_MESSAGEREFERENCE,-2) as SWITCH_ID
    ,'E' as CON_STATE
    ,BD_MESSAGEREFERENCE as CALL_ID
FROM
  BDETAIL2
WHERE BD_DATETIME >= ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1)
  AND BD_DATETIME < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
  AND BD_TOCID IS NULL
  AND BD_MAPSID = 'R'
  AND BD_NPI_B = '1'
  AND BD_PID_B = '0'
  AND BD_CDRTID <> 'SMS-HR'
  AND BD_IMSI NOT LIKE '22801%'
  AND BD_STATUS = 0
  AND SUBSTR(BD_MESSAGEREFERENCE,-2) = '90'
  AND ROWNUM <= 50
  
ORDER BY 1;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SAMPLES_ICB_SMCH90_ERR_T  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SAMPLES_ICB_SMCH90_ERR_T
(TS, DIRECTION, SCENARIO, CALLING_NUMBER, ORIG_SMSC, 
 CALLED_NUMBER, TERMIN_MSC, CALLED_IMSI, APMN, AMOUNT, 
 CURRENCY, OPKEY, SWITCH_ID, CON_STATE, CALL_ID)
BEQUEATH DEFINER
AS 
SELECT /*+ NO_INDEX (BDETAIL2) */
     to_char(BD_DATETIME,'YYYYMMDDhh24miss') as TS
    ,'I' as DIRECTION
    ,'1' as SCENARIO
    ,case
     when length(BD_MSISDN_A) < 6 then 'SC' || BD_MSISDN_A
     else DECODE(IS_NUMERIC(BD_MSISDN_A), 0, NULL , BD_MSISDN_A)
     end  as CALLING_NUMBER
    ,BD_ORIGSCA as ORIG_SMSC
    ,BD_MSISDN_B as CALLED_NUMBER
    ,'417949990' || BD_VSMSCID as TERMIN_MSC  -- BD_DGTI
    ,BD_IMSI as CALLED_IMSI
    ,NULL as APMN
    ,NULL as AMOUNT
    ,NULL as CURRENCY
    ,NULL as OPKEY
    ,'SMCH' || SUBSTR(BD_MESSAGEREFERENCE,-2) as SWITCH_ID
    ,'E' as CON_STATE
    ,BD_MESSAGEREFERENCE as CALL_ID
FROM
  BDETAIL2
WHERE BD_DATETIME >= ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1)
  AND BD_DATETIME < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
  AND BD_TOCID is NULL
  AND BD_MAPSID = 'R'
  AND BD_CDRTID = 'SMS-HR'
  AND BD_STATUS = 0
  AND SUBSTR(BD_MESSAGEREFERENCE,-2) = '90'
  AND ROWNUM <= 50


ORDER BY 1;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SAMPLES_ICB_SMCH90_INACT_O  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SAMPLES_ICB_SMCH90_INACT_O
(TS, DIRECTION, SCENARIO, CALLING_NUMBER, ORIG_SMSC, 
 CALLED_NUMBER, TERMIN_MSC, CALLED_IMSI, APMN, AMOUNT, 
 CURRENCY, OPKEY, SWITCH_ID, CON_STATE, CALL_ID)
BEQUEATH DEFINER
AS 
SELECT /*+ NO_INDEX (BDETAIL2) */
     to_char(BD_DATETIME,'YYYYMMDDhh24miss') as TS
    ,'O' as DIRECTION
    ,'1' as SCENARIO
    ,case
     when length(BD_MSISDN_A) < 6 then 'SC' || BD_MSISDN_A
     else DECODE(IS_NUMERIC(BD_MSISDN_A), 0, '4179499900' || DECODE(SUBSTR(BD_MESSAGEREFERENCE,-3),'_80','1','_90','2','0'), BD_MSISDN_A)
     end  as CALLING_NUMBER
    ,'4179499900' || DECODE(SUBSTR(BD_MESSAGEREFERENCE,-3),'_80','1','_90','2','0') as ORIG_SMSC
    ,BD_MSISDN_B as CALLED_NUMBER
    ,BD_DGTI as TERMIN_MSC
    ,BD_IMSI as CALLED_IMSI
    ,CON_CODE as APMN
    ,0.00 as AMOUNT
    ,NULL as CURRENCY
    ,CON_OPKEY as OPKEY
    ,'SMCH' || SUBSTR(BD_MESSAGEREFERENCE,-2) as SWITCH_ID
    ,'I' as CON_STATE
    ,BD_MESSAGEREFERENCE as CALL_ID
FROM
  CONTRACT,
  BDETAIL2
WHERE
  CONTRACT.CON_ESID = 'I'
  AND CON_DATESTART < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
  AND (CON_DATEEND > ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1) OR CON_DATEEND IS NULL)
  AND BD_DATETIME >= ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1)
  AND BD_DATETIME < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
  AND BD_TOCID = CON_ID
  AND BD_MAPSID = 'R'
  AND BD_NPI_B = '1'
  AND BD_PID_B = '0'
  AND BD_CDRTID <> 'SMS-HR'
  AND BD_STATUS = 0
  AND SUBSTR(BD_MESSAGEREFERENCE,-2) = '90'
  AND ROWNUM <= 50
  
ORDER BY 1;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SAMPLES_ICB_SMCH90_INACT_T  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SAMPLES_ICB_SMCH90_INACT_T
(TS, DIRECTION, SCENARIO, CALLING_NUMBER, ORIG_SMSC, 
 CALLED_NUMBER, TERMIN_MSC, CALLED_IMSI, APMN, AMOUNT, 
 CURRENCY, OPKEY, SWITCH_ID, CON_STATE, CALL_ID)
BEQUEATH DEFINER
AS 
SELECT /*+ NO_INDEX (BDETAIL2) */
     to_char(BD_DATETIME,'YYYYMMDDhh24miss') as TS
    ,'I' as DIRECTION
    ,'1' as SCENARIO
    ,case
     when length(BD_MSISDN_A) < 6 then 'SC' || BD_MSISDN_A
     else DECODE(IS_NUMERIC(BD_MSISDN_A), 0, NULL , BD_MSISDN_A)
     end  as CALLING_NUMBER
    ,BD_ORIGSCA as ORIG_SMSC
    ,BD_MSISDN_B as CALLED_NUMBER
    ,'417949990' || BD_VSMSCID as TERMIN_MSC  -- BD_DGTI
    ,BD_IMSI as CALLED_IMSI
    ,CON_CODE as APMN
    ,0.00 as AMOUNT
    ,NULL as CURRENCY
    ,CON_OPKEY as OPKEY
    ,'SMCH' || SUBSTR(BD_MESSAGEREFERENCE,-2) as SWITCH_ID
    ,CON_ESID as CON_STATE
    ,BD_MESSAGEREFERENCE as CALL_ID
FROM
  CONTRACT,
  BDETAIL2
WHERE
  CONTRACT.CON_ESID = 'I'
  AND CON_DATESTART < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
  AND (CON_DATEEND > ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1) OR CON_DATEEND IS NULL)
  AND BD_DATETIME >= ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1)
  AND BD_DATETIME < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
  AND BD_TOCID = CON_ID
  AND BD_MAPSID = 'R'
  AND BD_CDRTID = 'SMS-HR'
  AND BD_STATUS = 0
  AND SUBSTR(BD_MESSAGEREFERENCE,-2) = '90'
  AND ROWNUM <= 50


ORDER BY 1;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SAMPLES_ICB_SMCH90_IW_O  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SAMPLES_ICB_SMCH90_IW_O
(TS, DIRECTION, SCENARIO, CALLING_NUMBER, ORIG_SMSC, 
 CALLED_NUMBER, TERMIN_MSC, CALLED_IMSI, APMN, AMOUNT, 
 CURRENCY, OPKEY, SWITCH_ID, CON_STATE, CALL_ID)
BEQUEATH DEFINER
AS 
SELECT /*+ NO_INDEX (BDETAIL2) */
     to_char(BD_DATETIME,'YYYYMMDDhh24miss') as TS
    ,'O' as DIRECTION
    ,'1' as SCENARIO
    ,case
     when length(BD_MSISDN_A) < 6 then 'SC' || BD_MSISDN_A
     else DECODE(IS_NUMERIC(BD_MSISDN_A), 0, '4179499900' || DECODE(SUBSTR(BD_MESSAGEREFERENCE,-3),'_80','1','_90','2','0'), BD_MSISDN_A)
     end  as CALLING_NUMBER
    ,'4179499900' || DECODE(SUBSTR(BD_MESSAGEREFERENCE,-3),'_80','1','_90','2','0') as ORIG_SMSC
    ,BD_MSISDN_B as CALLED_NUMBER
    ,BD_DGTI as TERMIN_MSC
    ,BD_IMSI as CALLED_IMSI
    ,CON_CODE as APMN
    ,ROUND(NVL(CIOTE_PRICE,0.00)* dbms_random.value() * 2,4) as AMOUNT
    ,CIOT_CURID as CURRENCY
    ,CON_OPKEY as OPKEY
    ,'SMCH' || SUBSTR(BD_MESSAGEREFERENCE,-2) as SWITCH_ID
    ,CON_ESID as CON_STATE
    ,BD_MESSAGEREFERENCE as CALL_ID
FROM
  CONTRACT,
  CONIOT,
  CONIOTE,
  BDETAIL2
WHERE
  CONTRACT.CON_ESID = 'A'
  AND CON_DATESTART < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
  AND (CON_DATEEND > ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1) OR CON_DATEEND IS NULL)
  AND CIOT_ID = CIOTE_CIOTID
  AND CIOT_CONID = CON_ID
  AND CIOT_TRCTID IN ('SMS')
  AND CIOT_IWDID IN ('ORIG')
  AND BD_DATETIME >= ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1)
  AND BD_DATETIME < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
  AND BD_TOCID = CON_ID
  AND BD_MAPSID = 'R'
  AND BD_NPI_B = '1'
  AND BD_PID_B = '0'
  AND BD_CDRTID <> 'SMS-HR'
  AND BD_IW = '1'
  AND BD_STATUS = 0
  AND SUBSTR(BD_MESSAGEREFERENCE,-2) = '90'
  AND ROWNUM <= 50


ORDER BY 1;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SAMPLES_ICB_SMCH90_IW_T  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SAMPLES_ICB_SMCH90_IW_T
(TS, DIRECTION, SCENARIO, CALLING_NUMBER, ORIG_SMSC, 
 CALLED_NUMBER, TERMIN_MSC, CALLED_IMSI, APMN, AMOUNT, 
 CURRENCY, OPKEY, SWITCH_ID, CON_STATE, CALL_ID)
BEQUEATH DEFINER
AS 
SELECT /*+ NO_INDEX (BDETAIL2) */
     to_char(BD_DATETIME,'YYYYMMDDhh24miss') as TS
    ,'I' as DIRECTION
    ,'1' as SCENARIO
    ,case
     when length(BD_MSISDN_A) < 6 then 'SC' || BD_MSISDN_A
     else DECODE(IS_NUMERIC(BD_MSISDN_A), 0, NULL , BD_MSISDN_A)
     end  as CALLING_NUMBER
    ,BD_ORIGSCA as ORIG_SMSC
    ,BD_MSISDN_B as CALLED_NUMBER
    ,'417949990' || BD_VSMSCID as TERMIN_MSC  -- BD_DGTI
    ,BD_IMSI as CALLED_IMSI
    ,CON_CODE as APMN
    ,ROUND(NVL(CIOTE_PRICE,0.00)* dbms_random.value() * 2,4) as AMOUNT
    ,CIOT_CURID as CURRENCY
    ,CON_OPKEY as OPKEY
    ,'SMCH' || SUBSTR(BD_MESSAGEREFERENCE,-2) as SWITCH_ID
    ,CON_ESID as CON_STATE
    ,BD_MESSAGEREFERENCE as CALL_ID
FROM
  CONTRACT,
  CONIOT,
  CONIOTE,
  BDETAIL2
WHERE
  CONTRACT.CON_ESID = 'A'
  AND CON_DATESTART < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
  AND (CON_DATEEND > ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1) OR CON_DATEEND IS NULL)
  AND CIOT_ID = CIOTE_CIOTID
  AND CIOT_CONID = CON_ID
  AND CIOT_TRCTID IN ('SMS')
  AND CIOT_IWDID IN ('TERM')
  AND BD_DATETIME >= ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1)
  AND BD_DATETIME < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
  AND BD_TOCID = CON_ID
  AND BD_MAPSID = 'R'
  AND BD_CDRTID = 'SMS-HR'
  AND BD_IW = '1'
  AND BD_STATUS = 0
  AND SUBSTR(BD_MESSAGEREFERENCE,-2) = '90'
  AND ROWNUM <= 50


ORDER BY 1;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SAMPLES_ICB_SMCH90_ROAM_O  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SAMPLES_ICB_SMCH90_ROAM_O
(TS, DIRECTION, SCENARIO, CALLING_NUMBER, ORIG_SMSC, 
 CALLED_NUMBER, TERMIN_MSC, CALLED_IMSI, APMN, AMOUNT, 
 CURRENCY, OPKEY, SWITCH_ID, CON_STATE, CALL_ID)
BEQUEATH DEFINER
AS 
SELECT /*+ NO_INDEX (BDETAIL2) */
     to_char(BD_DATETIME,'YYYYMMDDhh24miss') as TS
    ,'O' as DIRECTION
    ,'5' as SCENARIO
    ,case
     when length(BD_MSISDN_A) < 6 then 'SC' || BD_MSISDN_A
     else DECODE(IS_NUMERIC(BD_MSISDN_A), 0, '4179499900' || DECODE(SUBSTR(BD_MESSAGEREFERENCE,-3),'_80','1','_90','2','0'), BD_MSISDN_A)
     end  as CALLING_NUMBER
    ,'4179499900' || DECODE(SUBSTR(BD_MESSAGEREFERENCE,-3),'_80','1','_90','2','0') as ORIG_SMSC
    ,BD_MSISDN_B as CALLED_NUMBER
    ,BD_DGTI as TERMIN_MSC
    ,BD_IMSI as CALLED_IMSI
    ,CON_CODE as APMN
    ,0.00 as AMOUNT
    ,NULL as CURRENCY
    ,CON_OPKEY as OPKEY
    ,'SMCH' || SUBSTR(BD_MESSAGEREFERENCE,-2) as SWITCH_ID
    ,CON_ESID as CON_STATE
    ,BD_MESSAGEREFERENCE as CALL_ID
FROM
  CONTRACT,
  BDETAIL2
WHERE
  CONTRACT.CON_ESID = 'A'
  AND CON_DATESTART < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
  AND (CON_DATEEND > ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1) OR CON_DATEEND IS NULL)
  AND BD_DATETIME >= ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1)
  AND BD_DATETIME < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
  AND BD_TOCID = CON_ID
  AND BD_MAPSID = 'R'
  AND BD_NPI_B = '1'
  AND BD_PID_B = '0'
  AND BD_CDRTID <> 'SMS-HR'
  AND NVL(BD_IW,'0') = '0'
  AND BD_STATUS = 0
  AND SUBSTR(BD_MESSAGEREFERENCE,-2) = '90'
  AND ROWNUM <= 50
  
ORDER BY 1;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SAMPLES_ICB_SMCH90_ROAM_T  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SAMPLES_ICB_SMCH90_ROAM_T
(TS, DIRECTION, SCENARIO, CALLING_NUMBER, ORIG_SMSC, 
 CALLED_NUMBER, TERMIN_MSC, CALLED_IMSI, APMN, AMOUNT, 
 CURRENCY, OPKEY, SWITCH_ID, CON_STATE, CALL_ID)
BEQUEATH DEFINER
AS 
SELECT /*+ NO_INDEX (BDETAIL2) */
     to_char(BD_DATETIME,'YYYYMMDDhh24miss') as TS
    ,'I' as DIRECTION
    ,'5' as SCENARIO
    ,case
     when length(BD_MSISDN_A) < 6 then 'SC' || BD_MSISDN_A
     else DECODE(IS_NUMERIC(BD_MSISDN_A), 0, NULL , BD_MSISDN_A)
     end  as CALLING_NUMBER
    ,BD_ORIGSCA as ORIG_SMSC
    ,BD_MSISDN_B as CALLED_NUMBER
    ,'417949990' || BD_VSMSCID as TERMIN_MSC  -- BD_DGTI
    ,BD_IMSI as CALLED_IMSI
    ,CON_CODE as APMN
    ,0.00 as AMOUNT
    ,NULL as CURRENCY
    ,CON_OPKEY as OPKEY
    ,'SMCH' || SUBSTR(BD_MESSAGEREFERENCE,-2) as SWITCH_ID
    ,CON_ESID as CON_STATE
    ,BD_MESSAGEREFERENCE as CALL_ID
FROM
  CONTRACT,
  BDETAIL2
WHERE
  CONTRACT.CON_ESID = 'A'
  AND CON_DATESTART < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
  AND (CON_DATEEND > ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1) OR CON_DATEEND IS NULL)
  AND BD_DATETIME >= ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1)
  AND BD_DATETIME < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
  AND BD_TOCID = CON_ID
  AND BD_MAPSID = 'R'
  AND BD_CDRTID = 'SMS-HR'
  AND NVL(BD_IW,'0') = '0'
  AND BD_STATUS = 0
  AND SUBSTR(BD_MESSAGEREFERENCE,-2) = '90'
  AND ROWNUM <= 50


ORDER BY 1;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SERVICES_PER_DAY  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SERVICES_PER_DAY
(BD_DATETIME, BD_SRCTYPE, CON_ACNAME, CON_NAME, CON_SNAME, 
 CON_ID, BD_COUNT)
BEQUEATH DEFINER
AS 
SELECT
  TRUNC(BD_DATETIME),
  BD_SRCTYPE,
  AC_NAME,
  NVL(CON_NAME,AC_NAME),
  NULL CON_SERVICE,
  CON_ID,
  COUNT(BDETAIL.ROWID)
FROM
  BDETAIL,
  CONTRACT,
  ACCOUNT
WHERE
    BDETAIL.BD_CONID = CONTRACT.CON_ID(+)
    AND CON_ACID = AC_ID
    AND NVL(BD_CDRTID,'CTB-CO') = 'CTB-CO'
GROUP BY
  TRUNC(BD_DATETIME),
  BD_SRCTYPE,
  AC_NAME,
  NVL(CON_NAME,AC_NAME),
  CON_ID;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SERVICETYPES_PER_DAY  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SERVICETYPES_PER_DAY
(BD_DATETIME, BD_COUNT_VASP, BD_COUNT_SDC, BD_COUNT_OTA, BD_COUNT_MBS, 
 BD_COUNT_ISRV)
BEQUEATH DEFINER
AS 
SELECT
  TRUNC(BD_DATETIME),
  SUM(DECODE(BD_SRCTYPE,'VASP',1,0)),
  SUM(DECODE(BD_SRCTYPE,'SDC',1,0)),
  SUM(DECODE(BD_SRCTYPE,'OTA',1,0)),
  SUM(DECODE(BD_SRCTYPE,'MBS',1,0)),
  SUM(DECODE(BD_SRCTYPE,'ISRV',1,0))
FROM
  BDETAIL
WHERE NVL(BD_CDRTID,'CTB-CO') = 'CTB-CO'
GROUP BY
  TRUNC(BD_DATETIME);


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SI008A_DETAILS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SI008A_DETAILS
(BD_DATETIME, BD_SRCTYPE, AC_ID, CON_ACNAME, CON_NAME, 
 CON_SNAME, CON_ID, BD_KEYWORD, BD_COUNT)
BEQUEATH DEFINER
AS 
SELECT
  TRUNC(BD_DATETIME)            bd_datetime,
  BD_SRCTYPE                    bd_srctype,
  AC_ID                         ac_id,
  AC_NAME                       con_acname,
  NVL(CON_NAME,AC_NAME)         con_name,
  NULL                          con_sname,
  CON_ID                        con_id,
  BD_KEYWORD                    bd_keyword,
  COUNT(BDETAIL.ROWID)          bd_count
FROM
  BDETAIL,
  CONTRACT,
  ACCOUNT
WHERE
    BDETAIL.BD_CONID = CONTRACT.CON_ID
  AND CON_ACID = AC_ID
  AND NVL(BD_CDRTID,'CTB-CO') = 'CTB-CO'
GROUP BY
  TRUNC(BD_DATETIME),
  BD_SRCTYPE,
  AC_ID,
  AC_NAME,
  NVL(CON_NAME,AC_NAME),
  CON_ID,
  BD_KEYWORD;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SI012A_DETAILS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SI012A_DETAILS
(BD_DATETIME, CON_ID, TOTAL, MTDELIVERED0, MTDELETED1, 
 MTEXPIRED2, MTREPLACED3)
BEQUEATH DEFINER
AS 
SELECT /*+ NO_INDEX(BDETAIL2) */
    BD_DATETIME,
    BD_CONID,
    1 COUNTMT,
    DECODE(BD_STATUS,0,1,0) MtDelivered0,
    DECODE(BD_STATUS,1,1,0) MtDeleted1,
    DECODE(BD_STATUS,2,1,0) MtExpired2,
    DECODE(BD_STATUS,3,1,0) MtReplaced3
FROM
    BDETAIL2
WHERE   BD_MAPSID = 'R'
AND     BD_NPI_B = 1
AND     BD_PID_B = 0;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SI029A_DETAILS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SI029A_DETAILS
(BD_DATETIME, BD_KEYWORD, BD_MSISDN, CON_ID)
BEQUEATH DEFINER
AS 
SELECT
	BD_DATETIME,
	BD_KEYWORD,
	BD_MSISDN_A,
	BD_CONID con_id
FROM
	BDETAIL
ORDER BY
	BD_DATETIME,
	BD_KEYWORD;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SI056A_DETAILS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SI056A_DETAILS
(BD_DATETIME, AC_NAME, CON_NAME, BD_SERVICE, CDRCOUNT, 
 BD_AMOUNTCU, BD_RETSHAREPV, BD_RETSHAREMO, AC_ID, CON_ID)
BEQUEATH DEFINER
AS 
SELECT  /*+ NO_INDEX(BDETAIL) */
    bd_datetime,
    AC_NAME,
    CON_NAME,
    BD_SERVICE,
    COUNT(BDETAIL.ROWID) CDRCOUNT,
    SUM(BD_AMOUNTCU) BD_AMOUNTCU,
    SUM(BD_RETSHAREPV) BD_RETSHAREPV,
    SUM(BD_RETSHAREMO) BD_RETSHAREMO,
    AC_ID,
    CON_ID
FROM
    BDETAIL,
    CONTRACT,
    ACCOUNT
WHERE BDETAIL.BD_CONID = CONTRACT.CON_ID
  AND CONTRACT.CON_ACID = ACCOUNT.AC_ID
  AND BD_MAPSID = 'R'
  AND NVL(BD_CDRTID,'CTB-CO') = 'CTB-CO'
GROUP BY
    BD_DATETIME,
    AC_NAME,
    CON_NAME,
    BD_SERVICE,
    AC_ID,
    CON_ID;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SI057A_DETAILS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SI057A_DETAILS
(SENDER, SUBMITTIME, MSGLEN, RECEIVER, DELIVTIME, 
 MSGID, RECTYPE, ISDELIV, STATCODE, ERRCODE)
BEQUEATH DEFINER
AS 
Select /*+ FULL (BDETAIL6) */
    BD_MSISDN_A,
    BD_DATESUBMIT,
    Max(Decode(Substr(BD_CDRRECTYPE,4,1),'O',BD_MSGSIZE,0)),
    BD_MSISDN_B,
    Max(Decode(BD_MSGTYPE||BD_EVENTDISP,01,To_Char(BD_DATEDELIVERY,'DD.MM.YYYY HH24:MI:SS'),012,To_Char(BD_DATEDELIVERY,'DD.MM.YYYY HH24:MI:SS'),' ')),
    BD_UMSGGRPID,
    'MMS',
--    Decode(Max(Decode(BD_MSGTYPE,0,Nvl(BD_LEGACYINDICATOR,0),0)),0,'','Leg')
    MAX(DECODE(BD_MSGTYPE||BD_EVENTDISP,01,'Y',012,'Y','N')),
    '-',
    '-'
From BDETAIL6
Group By
    BD_DATESUBMIT,
    BD_MSISDN_B,
    BD_MSISDN_A,
    BD_UMSGGRPID;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SI096A_TEMPLATE  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SI096A_TEMPLATE
(CON_OPKEY, TEXT)
BEQUEATH DEFINER
AS 
SELECT
    JOB_PARAMETER('<STAJ_ID>', '[OPT_PARAM]') ,
    'R,SENDER,RECIPIENT,START_DATETIME,END_DATETIME,UTC_OFFSET,DATE_CREATION' || CHR(10) ||
        'H,' ||
    'CHEC1,' ||
    JOB_PARAMETER('<STAJ_ID>', '[OPT_PARAM]') || ',' ||
    to_char(JOB_DATEFROM('<STAJ_ID>'),'YYYYMMDDhh24miss') || ',' ||
    to_char(JOB_DATETO('<STAJ_ID>'),'YYYYMMDDhh24miss') || ',' ||
    '+0100,' ||
    to_char(SYSDATE,'YYYYMMDDhh24miss') || CHR(10) ||
    'R,TIMESTAMP,DIRECTION,SCENARIO,CALLING_NUMBER,ORIG_SMSC,CALLED_NUMBER,TERMIN_MSC,AMOUNT,CALLED_IMSI'
FROM    DUAL

UNION ALL

SELECT /*+ NO_INDEX (BDETAIL2) */
     CON_OPKEY,
     'S,' ||
     to_char(BD_DATETIME,'YYYYMMDDhh24miss') || ',' ||
    'O,' ||
    '1,' ||
     DECODE(IS_NUMERIC(BD_MSISDN_A), 0, '41794999000', BD_MSISDN_A) || ',' ||
     NVL(BD_DELIVER_MAP_GTI,'41794999000') || ',' ||
     BD_MSISDN_B || ',' ||
     BD_DGTI || ',' ||
     (
     SELECT LTRIM(TO_CHAR(CIOTE_PRICE)*10000,'00000')
     FROM CONIOT, CONIOTE
     WHERE  CIOT_ID = CIOTE_CIOTID
        AND CIOT_CONID = CON_ID
        AND CIOT_TRCTID IN ('SMS')
        AND CIOT_IWDID IN ('ORIG')
     ) || ',' ||
     BD_IMSI
FROM
  CONTRACT,
  BDETAIL2
WHERE
  CON_ESID = 'A'
  AND CON_OPKEY = JOB_PARAMETER('<STAJ_ID>', '[OPT_PARAM]')
  AND CON_DATESTART < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
  AND (CON_DATEEND > ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1) OR CON_DATEEND IS NULL)
  AND BD_DATETIME >= JOB_DATEFROM('<STAJ_ID>')
  AND BD_DATETIME < JOB_DATETO('<STAJ_ID>')
  AND BD_TOCID = CON_ID
  AND BD_MAPSID = 'R'
  AND BD_IW = '1'
  AND BD_CDRTID NOT IN ('SMS-HR','SMS-EXT','PAGER-EXT')
  AND BD_STATUS = 0

UNION ALL

SELECT /*+ NO_INDEX (BDETAIL7) */
     CON_OPKEY,
     'S,' ||
     to_char(BD_DATETIME,'YYYYMMDDhh24miss') || ',' ||
    'O,' ||
    '1,' ||
     DECODE(IS_NUMERIC(BD_MSISDN_A), 0, '41794992115' , BD_MSISDN_A) || ',' ||
     '41794992115' || ',' ||
     BD_MSISDN_B || ',' ||
     BD_DGTI || ',' ||
     (
     SELECT LTRIM(TO_CHAR(CIOTE_PRICE)*10000,'00000')
     FROM CONIOT, CONIOTE
     WHERE  CIOT_ID = CIOTE_CIOTID
     AND CIOT_CONID = CON_ID
     AND CIOT_TRCTID IN ('SMS')
     AND CIOT_IWDID IN ('ORIG')
     ) || ',' ||
     BD_IMSI
FROM
  CONTRACT,
  BDETAIL7
WHERE
  CONTRACT.CON_ESID = 'A'
  AND CON_OPKEY = JOB_PARAMETER('<STAJ_ID>', '[OPT_PARAM]')
  AND CON_DATESTART < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
  AND (CON_DATEEND > ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1) OR CON_DATEEND IS NULL)
  AND BD_DATETIME >= JOB_DATEFROM('<STAJ_ID>')
  AND BD_DATETIME < JOB_DATETO('<STAJ_ID>')
  AND BD_TOCID = CON_ID
  AND BD_MAPSID = 'R'
  AND BD_MSGTYPE = 'M'
  AND BD_SINKTYPE = '2'
  AND BD_IW = '1'
  AND BD_STATUS = 0

ORDER   BY 2;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SI121A_DETAILS_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SI121A_DETAILS_1
(BD_MSISDN_A, BD_AMOUNT, BD_COUNT, SERVICE_COUNT, BD_MIN_DATE, 
 BD_MAX_DATE)
BEQUEATH DEFINER
AS 
SELECT
    BD_MSISDN_A, BD_AMOUNT, BD_COUNT, SERVICE_COUNT, BD_MIN_DATE, BD_MAX_DATE
FROM
    (SELECT /*+ NO_INDEX(BDETAIL) */
        BD_MSISDN_A, 
        SUM(BD_AMOUNTCU) BD_AMOUNT,
        COUNT(*) BD_COUNT,
        COUNT(DISTINCT BD_SHORTID) SERVICE_COUNT,
        MIN(BD_DATETIME) BD_MIN_DATE, 
        MAX(BD_DATETIME) BD_MAX_DATE
    FROM
        BDETAIL
    WHERE
        BD_CONSTID = 'BN'
        AND BD_PACIDHB = 'mocontch'
        AND BD_BILLED = '1'
        AND BD_RATED = '1'
        AND BD_AMOUNTCU <> 0.0000
        AND BD_DATETIME >= TRUNC(SYSDATE, 'MONTH')
        AND BD_DATETIME < TRUNC(SYSDATE)
    GROUP BY
        BD_MSISDN_A
    ORDER BY
        2 DESC, 3 DESC, 4 DESC)
WHERE
    ROWNUM <= 100;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SI121A_DETAILS_2  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SI121A_DETAILS_2
(BD_MSISDN_A, BD_AMOUNT, BD_COUNT, SERVICE_COUNT, BD_MIN_DATE, 
 BD_MAX_DATE)
BEQUEATH DEFINER
AS 
SELECT
    BD_MSISDN_A, BD_AMOUNT, BD_COUNT, SERVICE_COUNT, BD_MIN_DATE, BD_MAX_DATE
FROM
    (SELECT /*+ NO_INDEX(BDETAIL) */
        BD_MSISDN_A, 
        SUM(BD_AMOUNTCU) BD_AMOUNT,
        COUNT(*) BD_COUNT, 
        COUNT(DISTINCT BD_SHORTID) SERVICE_COUNT,
        MIN(BD_DATETIME) BD_MIN_DATE, 
        MAX(BD_DATETIME) BD_MAX_DATE
    FROM
        BDETAIL
    WHERE
        BD_CONSTID = 'BN'
        AND BD_PACIDHB = 'mocontch'
        AND BD_BILLED = '1'
        AND BD_RATED = '1'
        AND BD_AMOUNTCU <> 0.0000
        AND BD_DATETIME >= TRUNC(SYSDATE, 'MONTH')
        AND BD_DATETIME < TRUNC(SYSDATE)
    GROUP BY
        BD_MSISDN_A
    ORDER BY
        3 DESC, 2 DESC, 4 DESC)
WHERE
    ROWNUM <= 100;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SI121A_DETAILS_3  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SI121A_DETAILS_3
(BD_MSISDN_A, BD_AMOUNT, BD_COUNT, SERVICE_COUNT, BD_MIN_DATE, 
 BD_MAX_DATE)
BEQUEATH DEFINER
AS 
SELECT
    BD_MSISDN_A, BD_AMOUNT, BD_COUNT, SERVICE_COUNT, BD_MIN_DATE, BD_MAX_DATE
FROM
    (SELECT /*+ NO_INDEX(BDETAIL) */
        BD_MSISDN_A, 
        SUM(BD_AMOUNTCU) BD_AMOUNT,
        COUNT(*) BD_COUNT, 
        COUNT(DISTINCT BD_SHORTID) SERVICE_COUNT,
        MIN(BD_DATETIME) BD_MIN_DATE, 
        MAX(BD_DATETIME) BD_MAX_DATE
    FROM
        BDETAIL
    WHERE
        BD_CONSTID = 'BN'
        AND BD_PACIDHB = 'mocontch'
        AND BD_BILLED = '1'
        AND BD_RATED = '1'
        AND BD_AMOUNTCU <> 0.0000
        AND BD_DATETIME >= TRUNC(SYSDATE, 'MONTH')
        AND BD_DATETIME < TRUNC(SYSDATE)
    GROUP BY
        BD_MSISDN_A
    ORDER BY
        4 DESC, 2 DESC, 3 DESC)
WHERE
    ROWNUM <= 100;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SL087A_DETAILS_2  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SL087A_DETAILS_2
(SED_CHARGE, CON_CONSOL, SED_DATE_CHAR, SEDT_VALUE1_NAME, SED_DESC, 
 SED_TARID, RETRY_NAME, RETRY_PRICE, PRICE, CON_ESID, 
 SED_LONGID, SED_COUNT2_MO, SED_COUNT2_MO_INT, SED_COUNT2_MO_IW, SED_COUNT1_NAT, 
 SED_COUNT1_INT, SED_COUNT1_IW, SED_TOTAL, AC_ID, AC_NAME, 
 CON_NAME, ADR_EMAIL, CON_ID, SEDT_VALUE2_ORDER, SED_DATE)
BEQUEATH DEFINER
AS 
SELECT
  SED_CHARGE,
  to_number(NVL(CON_CONSOL,'0')),
  to_char(SED_DATE,'dd.mm.yyyy'),
  SEDT_VALUE1,
  SED_DESC,
  SED_TARID,
  DECODE(SED_ETID || SED_INT,'CDR0',RS_LANG03,'CDR1',RS_LANG03,NULL),
  DECODE(SED_ETID || SED_INT,'CDR0',DECODE(RS_PRICE,0,NULL,RS_PRICE),'CDR1',DECODE(RS_PRICEINT,0,NULL,RS_PRICEINT),NULL),
  DECODE(SUM(SED_COUNT1+SED_COUNT2),1,SUM(SED_TOTAL),0,NULL,SUM(SED_TOTAL)/SUM(SED_COUNT1+SED_COUNT2)),
  DECODE(CON_ESID,'A','A','I'),
  NULL,
  SUM(DECODE(SED_ETID,'CDR',SED_COUNT2,'PAG',SED_COUNT2,0)),
  SUM(DECODE(SED_ETID,'MOFN',SED_COUNT2,0)),
  SUM(DECODE(SED_ETID,'MOIWST',SED_COUNT2,0)),
  SUM(DECODE(SED_ETID || SED_INT,'CDR0',SED_COUNT1,'PAG0',SED_COUNT1,0)),
  SUM(DECODE(SED_ETID || SED_INT,'CDR1',SED_COUNT1,'PAG1',SED_COUNT1,0)),
  SUM(DECODE(SED_ETID,'IOTLACT',SED_COUNT1,0)),
  SUM(SED_TOTAL),
  AC_ID,
  AC_NAME,
  NVL(CON_NAME,AC_NAME),
  NULL ADR_EMAIL,
  CON_ID,
  SEDT_VALUE2,
  SED_DATE
FROM
  SETTLING,
  SEDTYPE,
  SETDETAIL,
  CONTRACT,
  ACCOUNT,
  BOHEADER,
  RETSCHEMA
WHERE   CONTRACT.CON_ACID = ACCOUNT.AC_ID
  AND RETSCHEMA.RS_ID = CON_RSID
  AND SETDETAIL.SED_UFIH_BOHID = BOHEADER.BOH_ID
  AND SETDETAIL.SED_SETID = SETTLING.SET_ID
  AND SETDETAIL.SED_ETID = SEDT_ID
  AND CONTRACT.CON_ID = SETTLING.SET_CONID
  AND CON_ETID = 'LAC'
  AND SED_TARID NOT IN ('S','P')
  AND SED_ETID IN ('CDR','PAG','MCC','IOTLACT','MFGR','MFLID','MOFN','MOIWST')
  AND SED_ORDER > TO_CHAR(TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')-1,'YYYY-MM-DD')
  AND SED_ORDER < TO_CHAR(TRUNC(sysdate,'MONTH'),'YYYY-MM-DD')
  AND (SED_COUNT1 <> 0 OR SED_COUNT2 <> 0 OR SED_TOTAL <> 0.00)
  AND SED_UFIH_BOSID = 'O'
  AND BOH_END >= TRUNC(ADD_MONTHS(sysdate,-1),'MONTH') + 17/24
  AND BOH_END < TRUNC(sysdate,'MONTH') + 17/24
GROUP BY
  AC_ID,
  AC_NAME,
  SED_CHARGE,
  NVL(CON_NAME,AC_NAME),
  to_number(NVL(CON_CONSOL,'0')),
  SED_DATE,
  SEDT_VALUE2,
  SEDT_VALUE1,
  SED_DESC,
  SED_TARID,
  DECODE(SED_ETID || SED_INT,'CDR0',RS_LANG03,'CDR1',RS_LANG03,NULL),
  DECODE(SED_ETID || SED_INT,'CDR0',DECODE(RS_PRICE,0,NULL,RS_PRICE),'CDR1',DECODE(RS_PRICEINT,0,NULL,RS_PRICEINT),NULL),
  DECODE(CON_ESID,'A','A','I'),
  CON_ID
ORDER BY
  AC_NAME,
  AC_ID,
  SED_CHARGE,
  NVL(CON_NAME,AC_NAME),
  to_number(NVL(CON_CONSOL,'0')),
  SED_DATE,
  SEDT_VALUE2,
  SEDT_VALUE1,
  SED_DESC,
  SED_TARID,
  DECODE(CON_ESID,'A','A','I'),
  CON_ID;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SL091A_DETAILS_2  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SL091A_DETAILS_2
(SED_CHARGE, CON_CONSOL, SED_DATE_CHAR, SEDT_VALUE1_NAME, SED_DESC, 
 SED_TARID, CON_HDGROUP, PRICE, CON_ESID, SED_LONGID, 
 SED_COUNT2_MO, SED_COUNT2_MO_INT, SED_COUNT2_MO_IW, SED_COUNT1_NAT, SED_COUNT1_INT, 
 SED_COUNT1_IW, SED_TOTAL, AC_ID, AC_NAME, CON_NAME, 
 ADR_EMAIL, CON_ID, SEDT_VALUE2_ORDER, SED_DATE)
BEQUEATH DEFINER
AS 
SELECT
  SED_CHARGE,
  to_number(NVL(CON_CONSOL,'0')),
  to_char(SED_DATE,'dd.mm.yyyy'),
  SEDT_VALUE3,
  SED_DESC,
  SED_TARID,
  DECODE(CON_HDGROUP,0,'',1,'HG',to_char(CON_HDGROUP)),
  DECODE(SUM(SED_COUNT1+SED_COUNT2),1,SUM(SED_TOTAL),0,NULL,SUM(SED_TOTAL)/SUM(SED_COUNT1+SED_COUNT2)),
  DECODE(CON_ESID,'A','A','I'),
  NULL,
  SUM(DECODE(SED_ETID,'CDR',SED_COUNT2,0)),
  SUM(DECODE(SED_ETID,'MOFN',SED_COUNT2,0)),
  SUM(DECODE(SED_ETID,'MOIWST',SED_COUNT2,0)),
  SUM(DECODE(SED_ETID || SED_INT,'CDR0',SED_COUNT1,0)),
  SUM(DECODE(SED_ETID || SED_INT,'CDR1',SED_COUNT1,0)),
  SUM(DECODE(SED_ETID,'IOTLACT',SED_COUNT1,0)),
  SUM(SED_TOTAL),
  AC_ID,
  AC_NAME,
  NVL(CON_NAME,AC_NAME),
  NULL ADR_EMAIL,
  CON_ID,
  SEDT_VALUE4,
  SED_DATE
FROM
  SETTLING,
  SEDTYPE,
  SETDETAIL,
  CONTRACT,
  ACCOUNT,
  BOHEADER
WHERE   CONTRACT.CON_ACID = ACCOUNT.AC_ID
  AND SETDETAIL.SED_UFIH_BOHID = BOHEADER.BOH_ID
  AND SETDETAIL.SED_SETID = SETTLING.SET_ID
  AND SETDETAIL.SED_ETID = SEDT_ID
  AND CONTRACT.CON_ID = SETTLING.SET_CONID
  AND CON_ETID = 'MLC'
  AND SED_TARID NOT IN ('S','P')
  AND SED_ETID IN ('SMS-MV','SMS-MVN','SMS-MVR','CDR','MCC','IOTLACT','MFGR','MFLID','MOFN','MOIWST')
  AND SED_ORDER > TO_CHAR(TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')-1,'YYYY-MM-DD')
  AND SED_ORDER < TO_CHAR(TRUNC(sysdate,'MONTH'),'YYYY-MM-DD')
  AND (SED_COUNT1 <> 0 OR SED_COUNT2 <> 0 OR SED_TOTAL <> 0.00)
  AND SED_UFIH_BOSID = 'O'
  AND BOH_END >= TRUNC(ADD_MONTHS(sysdate,-1),'MONTH') + 17/24
  AND BOH_END < TRUNC(sysdate,'MONTH') + 17/24
GROUP BY
  AC_ID,
  AC_NAME,
  SED_CHARGE,
  NVL(CON_NAME,AC_NAME),
  to_number(NVL(CON_CONSOL,'0')),
  SED_DATE,
  SEDT_VALUE4,
  SEDT_VALUE3,
  SED_DESC,
  SED_TARID,
  DECODE(CON_HDGROUP,0,'',1,'HG',to_char(CON_HDGROUP)),
  DECODE(CON_ESID,'A','A','I'),
  CON_ID
ORDER BY
  AC_NAME,
  AC_ID,
  SED_CHARGE,
  NVL(CON_NAME,AC_NAME),
  to_number(NVL(CON_CONSOL,'0')),
  SED_DATE,
  SEDT_VALUE4,
  SEDT_VALUE3,
  SED_DESC,
  SED_TARID,
  DECODE(CON_HDGROUP,0,'',1,'HG',to_char(CON_HDGROUP)),
  DECODE(CON_ESID,'A','A','I'),
  CON_ID;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SL093A_BASE  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SL093A_BASE
(CON_CODE, IWTC_DATE, IWTC_SMSCID, IWTC_COUNT, PRICE, 
 AMOUNT, CURRENCY, IWTC_BOHID1)
BEQUEATH DEFINER
AS 
SELECT
     CON_CODE,
     IWTC_DATE,
     IWTC_SMSCID,
     IWTC_COUNT,
     CIOTE_PRICE + 0.0,
     IWTC_COUNT * Nvl(CIOTE_PRICE,0),
     CIOT_CURID,
     IWTC_BOHID1
FROM
  IWTCOUNTER,
  SMSC,
  CONTRACT,
  CONIOT,
  CONIOTE
WHERE
   IWTCOUNTER.IWTC_SMSCID = SMSC.SMSC_ID
  AND SMSC.SMSC_CONOPKEY = CONTRACT.CON_OPKEY
  AND CONTRACT.CON_ESID = 'A'
  AND IWTC_DATE >= CON_DATESTART
  AND ((IWTC_DATE < CON_DATEEND ) OR (CON_DATEEND IS NULL))
  AND IWTC_BOHID1 = (Select Max(IWTC_BOHID1) From IWTCOUNTER)
  AND CIOT_ID = CIOTE_CIOTID
  AND CIOT_CONID = CON_ID
  AND CIOT_TRCTID IN ('SMS')
  AND CIOT_IWDID IN ('TERM');


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SL093A_DETAILS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SL093A_DETAILS
(CON_CODE, CSV_TEXT)
BEQUEATH DEFINER
AS 
SELECT
    CON_CODE,
    'R,SENDER,RECIPIENT,START_DATETIME,END_DATETIME,UTC_OFFSET,DATE_CREATION' || CHR(10) ||
    'H,' ||
    'CHEC1,' ||
    CON_CODE || ',' ||
    to_char(START_TIME,'YYYYMMDDhh24miss') || ',' ||
    to_char(END_TIME,'YYYYMMDDhh24miss') || ',' ||
    UTC_OFF || ',' ||
    to_char(SYSDATE,'YYYYMMDDhh24miss') || CHR(10) ||
    'R,TIMESTAMP,DIRECTION,SCENARIO,CALLING_NUMBER,ORIG_SMSC,CALLED_NUMBER,TERMIN_MSC,AMOUNT,CALLED_IMSI'
FROM
    SL093A_HEADER
UNION ALL
SELECT
    CON_CODE,
    'S,' ||
    to_char(TIME_STAMP,'YYYYMMDDhh24miss') || ',' ||
    'I,' ||
    '1,' ||
    CALLING_NUMBER || ',' ||
    ORIG_SMSC || ',' ||
    CALLED_NUMBER || ',' ||
    TERMIN_MSC || ',' ||
    LTRIM(TO_CHAR(PRICE * 10000,'00000')) || ',' ||
    IMSI
FROM SL093A_RECORDS
UNION ALL
SELECT
    CON_CODE,
    'T,' ||
    LTRIM(to_char(RECORD_COUNT+4))
FROM SL093A_FOOTER;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SL093A_FOOTER  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SL093A_FOOTER
(CON_CODE, RECORD_COUNT)
BEQUEATH DEFINER
AS 
SELECT
    CON_CODE,
    COUNT(*)
FROM
    SL093A_RECORDS
GROUP BY
    CON_CODE;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SL093A_HEADER  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SL093A_HEADER
(CON_CODE, START_TIME, END_TIME, UTC_OFF, FILE_TIME)
BEQUEATH DEFINER
AS 
SELECT
    CON_CODE,
    MIN(TIME_STAMP),
    MAX(TIME_STAMP),
    SUBSTR(REPLACE(to_char(tz_offset(DBTIMEZONE)),':',''),1,5),
    SYSDATE
FROM
    SL093A_RECORDS
GROUP BY
    CON_CODE;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SL093A_RECORDS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SL093A_RECORDS
(CON_CODE, TIME_STAMP, CALLING_NUMBER, ORIG_SMSC, CALLED_NUMBER, 
 TERMIN_MSC, PRICE, IMSI)
BEQUEATH DEFINER
AS 
SELECT
    CON_CODE,
    BDA_DATETIME,
    DECODE(IS_NUMERIC(BDA_MSISDN_B), 0, BDA_SCA, BDA_MSISDN_B),
    BDA_SCA,
    BDA_MSISDN_A,
    BDA_MSCID,
    PRICE,
    BDA_IMSI
FROM
    SL093A_BASE,
    SMS_IW_MT_ARCH
WHERE
        SL093A_BASE.IWTC_DATE = SMS_IW_MT_ARCH.BDA_DAY
    AND SL093A_BASE.IWTC_SMSCID = SMS_IW_MT_ARCH.BDA_SMSCID
    AND (BDA_IMSI LIKE '22801%' OR BDA_IMSI IS  NULL)
ORDER BY 2;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SL094A_DETAILS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SL094A_DETAILS
(CON_CODE, CSV_TEXT)
BEQUEATH DEFINER
AS 
SELECT
    CON_CODE,
    'R,SENDER,RECIPIENT,START_DATETIME,END_DATETIME,UTC_OFFSET,DATE_CREATION' || CHR(10) ||
    'H,' ||
    'CHEC1,' ||
    CON_CODE || ',' ||
    to_char(START_TIME,'YYYYMMDDhh24miss') || ',' ||
    to_char(END_TIME,'YYYYMMDDhh24miss') || ',' ||
    UTC_OFF ||  ',' ||
    to_char(SYSDATE,'YYYYMMDDhh24miss') || CHR(10) ||
    'R,TIMESTAMP,DIRECTION,SCENARIO,CALLING_NUMBER,ORIG_SMSC,CALLED_NUMBER,TERMIN_MSC,AMOUNT,CALLED_IMSI'
FROM
    SL094A_HEADER
UNION ALL
SELECT
    CON_CODE,
    'S,' ||
    to_char(TIME_STAMP,'YYYYMMDDhh24miss') || ',' ||
    'O,' ||
    '1,' ||
    CALLING_NUMBER || ',' ||
    ORIG_SMSC || ',' ||
    CALLED_NUMBER || ',' ||
    TERMIN_MSC || ',' ||
    LTRIM(TO_CHAR(PRICE * 10000,'00000')) || ',' ||
    IMSI
FROM SL094A_RECORDS
UNION ALL
SELECT
    CON_CODE,
    'T,' ||
    LTRIM(to_char(RECORD_COUNT+4))
FROM SL094A_FOOTER;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SL094A_RECORDS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SL094A_RECORDS
(CON_CODE, TIME_STAMP, CALLING_NUMBER, ORIG_SMSC, CALLED_NUMBER, 
 TERMIN_MSC, PRICE, IMSI)
BEQUEATH DEFINER
AS 
SELECT /*+ NO_INDEX (BDETAIL2) */
     CON_CODE,
     BD_DATETIME,
     DECODE(IS_NUMERIC(BD_MSISDN_A), 0, '41794999000', BD_MSISDN_A),
     NVL(BD_DELIVER_MAP_GTI,'41794999000'),
     BD_MSISDN_B,
     BD_DGTI,
     NVL(CIOTE_PRICE,0.00),
     BD_IMSI
FROM
  CONTRACT,
  CONIOT,
  CONIOTE,
  BDETAIL2
WHERE
  CONTRACT.CON_ESID = 'A'
  AND CON_DATESTART < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
  AND (CON_DATEEND > ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1) OR CON_DATEEND IS NULL)
  AND CIOT_ID = CIOTE_CIOTID
  AND CIOT_CONID = CON_ID
  AND CIOT_TRCTID IN ('SMS')
  AND CIOT_IWDID IN ('ORIG')
  AND BD_DATETIME >= ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1)
  AND BD_DATETIME < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
  AND BD_TOCID = CON_ID
  AND BD_MAPSID = 'R'
  AND BD_CDRTID NOT IN ('SMS-HR','SMS-EXT','PAGER-EXT')
  AND BD_IW = '1'
  AND BD_STATUS = 0
  
UNION ALL

SELECT /*+ NO_INDEX (BDETAIL7) */
     CON_CODE,
     BD_DATETIME,
     DECODE(IS_NUMERIC(BD_MSISDN_A), 0, '41794992115' , BD_MSISDN_A),
     '41794992115',
     BD_MSISDN_B,
     BD_DGTI,
     NVL(CIOTE_PRICE,0.00),
     BD_IMSI
FROM
  CONTRACT,
  CONIOT,
  CONIOTE,
  BDETAIL7
WHERE
  CONTRACT.CON_ESID = 'A'
  AND CON_DATESTART < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
  AND (CON_DATEEND > ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1) OR CON_DATEEND IS NULL)
  AND CIOT_ID = CIOTE_CIOTID
  AND CIOT_CONID = CON_ID
  AND CIOT_TRCTID IN ('SMS')
  AND CIOT_IWDID IN ('ORIG')
  AND BD_DATETIME >= ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1)
  AND BD_DATETIME < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
  AND BD_TOCID = CON_ID
  AND BD_MAPSID = 'R'
  AND BD_SINKTYPE = '2'
  AND BD_IW = '1'
  AND BD_STATUS = 0

ORDER BY 2;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SMS_SHIFTED_TIMESTAMPS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SMS_SHIFTED_TIMESTAMPS
(BD_ID, BD_SRCTYPE, BD_DEMO, BD_BIHID, BD_MAPSID, 
 BD_BIRECNO, BD_BOHID1, BD_PACSID1, BD_BORECNO1, BD_BOHID2, 
 BD_PACSID2, BD_BORECNO2, BD_BOHID3, BD_PACSID3, BD_BORECNO3, 
 BD_DATETIME, BD_CDRTID, BD_MSISDN_A, BD_MSISDN_B, BD_IMSI, 
 BD_IMEI, BD_EXID, BD_MSCID, BD_SMSCID, BD_ROUTE, 
 BD_CELL, BD_TSC, BD_SCA, BD_POWER, BD_SUBTYPE, 
 BD_PREPAID, BD_ZNID, BD_TOCID, BD_SHORTID, BD_AMOUNTCU, 
 BD_RETSHAREMO, BD_RETSHAREPV, BD_CONID, BD_ERRID, BD_BILLED, 
 BD_RATED, BD_PACIDHB, BD_OUTPUTHB, BD_TARID, BD_PMVID, 
 BD_ORIGSUBMITTIME, OFFSET)
BEQUEATH DEFINER
AS 
SELECT /*+ FULL (BDETAIL4) */
	BD_ID,
	BD_SRCTYPE,
	BD_DEMO,
	BD_BIHID,
	BD_MAPSID,
	BD_BIRECNO,
	BD_BOHID1,
	BD_PACSID1,
	BD_BORECNO1,
	BD_BOHID2,
	BD_PACSID2,
	BD_BORECNO2,
	BD_BOHID3,
	BD_PACSID3,
	BD_BORECNO3,
	BD_DATETIME,
	BD_CDRTID,
	BD_MSISDN_A,
	BD_MSISDN_B,
	BD_IMSI,
	BD_IMEI,
	BD_EXID,
	BD_MSCID,
	BD_SMSCID,
	BD_ROUTE,
	BD_CELL,
	BD_TSC,
	BD_SCA,
	BD_POWER,
	BD_SUBTYPE,
	BD_PREPAID,
	BD_ZNID,
	BD_TOCID,
	BD_SHORTID,
	BD_AMOUNTCU,
	BD_RETSHAREMO,
	BD_RETSHAREPV,
	BD_CONID,
	BD_ERRID,
	BD_BILLED,
	BD_RATED,
	BD_PACIDHB,
	BD_OUTPUTHB,
	BD_TARID,
	BD_PMVID,
	BD_ORIGSUBMITTIME,
	24*3600*(BD_DATETIME-BD_ORIGSUBMITTIME) OFFSET
FROM
	BDETAIL4
WHERE
	BD_ORIGSUBMITTIME Is Not NULL
AND	BD_DATETIME < trunc(sysdate,'MONTH')
AND	BD_DATETIME >= add_months(trunc(sysdate,'MONTH'),-1);


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR000A_REPORT  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR000A_REPORT
(STAJ_ID, PAC_TITLE, PAC_TEMPLATE, PAC_PERIODID, STAJP_NAME, 
 STAJP_VALUE, ORDERING, SYS_DATE)
BEQUEATH DEFINER
AS 
SELECT
	STAJ_ID,
	PAC_TITLE PAC_TITLE, 
	PAC_TEMPLATE PAC_TEMPLATE,
	PAC_PERIODID PAC_PERIODID,
	STAJP_NAME STAJP_NAME,
	STAJP_VALUE STAJP_VALUE,
	'1' ORDERING, to_char(sysdate,'DD.MM.YYYY hh24:mi:ss')
FROM
	STA_JOB,
	PACKING,
	STA_JOBPARAM
WHERE
		STA_JOB.STAJ_PACID = PACKING.PAC_ID
	AND	STA_JOB.STAJ_ID = STA_JOBPARAM.STAJP_JOBID
	AND	STAJP_NAME = '[DATEFROM]'

UNION ALL
SELECT
	STAJ_ID,
	PAC_TITLE PAC_TITLE, 
	PAC_TEMPLATE PAC_TEMPLATE,
	PAC_PERIODID PAC_PERIODID,
	STAJP_NAME STAJP_NAME,
	STAJP_VALUE STAJP_VALUE,
	'2' ORDERING, to_char(sysdate,'DD.MM.YYYY hh24:mi:ss')
FROM
	STA_JOB,
	PACKING,
	STA_JOBPARAM
WHERE
		STA_JOB.STAJ_PACID = PACKING.PAC_ID
	AND	STA_JOB.STAJ_ID = STA_JOBPARAM.STAJP_JOBID
	AND	STAJP_NAME = '[DATETO]'

UNION ALL
SELECT
	STAJ_ID,
	PAC_TITLE PAC_TITLE, 
	PAC_TEMPLATE PAC_TEMPLATE,
	PAC_PERIODID PAC_PERIODID,
	STAJP_NAME STAJP_NAME,
	Decode(STAJP_VALUE,'0','-',STAJP_VALUE) STAJP_VALUE,
	'3' ORDERING, to_char(sysdate,'DD.MM.YYYY hh24:mi:ss')
FROM
	STA_JOB,
	PACKING,
	STA_JOBPARAM
WHERE
		STA_JOB.STAJ_PACID = PACKING.PAC_ID
	AND	STA_JOB.STAJ_ID = STA_JOBPARAM.STAJP_JOBID
	AND	STAJP_NAME = '[DATETILL]'

UNION ALL
SELECT
	STAJ_ID,
	PAC_TITLE PAC_TITLE, 
	PAC_TEMPLATE PAC_TEMPLATE,
	PAC_PERIODID PAC_PERIODID,
	STAJP_NAME STAJP_NAME,
	STAJP_VALUE STAJP_VALUE,
	'4' ORDERING, to_char(sysdate,'DD.MM.YYYY hh24:mi:ss')
FROM
	STA_JOB,
	PACKING,
	STA_JOBPARAM
WHERE
		STA_JOB.STAJ_PACID = PACKING.PAC_ID
	AND	STA_JOB.STAJ_ID = STA_JOBPARAM.STAJP_JOBID
	AND	STAJP_NAME = '[KEYWORDS]'


ORDER BY 1, 7;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR005A_DETAILS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR005A_DETAILS
(AC_NAME, CON_NAME, BD_SERVICE, CDRS_POST, CDRS_PRE, 
 CDRS_TOTAL, AMOUNTCU_POST, AMOUNTCU_PRE, AMOUNTCU_TOTAL, SHAREPV_POST, 
 SHAREPV_PRE, SHAREPV_TOTAL, SHAREMO_POST, SHAREMO_PRE, SHAREMO_TOTAL, 
 AC_ID)
BEQUEATH DEFINER
AS 
SELECT /*+ FULL (BDETAIL) */
    AC_NAME, 
    CON_NAME, 
    BD_SERVICE, 
    SUM(DECODE(BD_PREPAID,'Y',0,1)) CDRs_Post, 
    SUM(DECODE(BD_PREPAID,'Y',1,0)) CDRs_Pre,
    SUM(1) CDRs_Total, 
    SUM(DECODE(BD_PREPAID,'Y',0,BD_AMOUNTCU)) AmountCu_Post, 
    SUM(DECODE(BD_PREPAID,'Y',BD_AMOUNTCU,0)) AmountCu_Pre,
    SUM(BD_AMOUNTCU) AmountCu_Total, 
    SUM(DECODE(BD_PREPAID,'Y',0,BD_RETSHAREPV)) SharePv_Post, 
    SUM(DECODE(BD_PREPAID,'Y',BD_RETSHAREPV,0)) SharePv_Pre,
    SUM(BD_RETSHAREPV) SharePv_Total, 
    SUM(DECODE(BD_PREPAID,'Y',0,BD_RETSHAREMO)) ShareMo_Post, 
    SUM(DECODE(BD_PREPAID,'Y',BD_RETSHAREMO,0)) ShareMo_Pre,
    SUM(BD_RETSHAREMO) ShareMo_Total,
    AC_ID
FROM BDETAIL, CONTRACT, ACCOUNT
  WHERE
    BDETAIL.BD_CONID = CONTRACT.CON_ID
  AND CON_ACID = AC_ID
  AND BD_DATETIME >= TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
  AND BD_DATETIME < LAST_DAY(ADD_MONTHS(trunc(sysdate),-1)) + 1
  AND BD_MAPSID = 'E'
  AND NVL(BD_CDRTID,'CTB-CO') = 'CTB-CO'
GROUP BY 
  AC_NAME,
  CON_NAME,
  BD_SERVICE,
  BD_CONID,
  AC_ID

UNION
SELECT /*+ FULL (BDETAIL) */
    'unknown',
    'unknown',
    BD_SERVICE, 
    SUM(DECODE(BD_PREPAID,'Y',0,1)) CDRs_Post, 
    SUM(DECODE(BD_PREPAID,'Y',1,0)) CDRs_Pre,
    SUM(1) CDRs_Total, 
    SUM(DECODE(BD_PREPAID,'Y',0,BD_AMOUNTCU)) AmountCu_Post, 
    SUM(DECODE(BD_PREPAID,'Y',BD_AMOUNTCU,0)) AmountCu_Pre,
    SUM(BD_AMOUNTCU) AmountCu_Total, 
    SUM(DECODE(BD_PREPAID,'Y',0,BD_RETSHAREPV)) SharePv_Post, 
    SUM(DECODE(BD_PREPAID,'Y',BD_RETSHAREPV,0)) SharePv_Pre,
    SUM(BD_RETSHAREPV) SharePv_Total, 
    SUM(DECODE(BD_PREPAID,'Y',0,BD_RETSHAREMO)) ShareMo_Post, 
    SUM(DECODE(BD_PREPAID,'Y',BD_RETSHAREMO,0)) ShareMo_Pre,
    SUM(BD_RETSHAREMO) ShareMo_Total,
    '' AC_ID
FROM  BDETAIL
WHERE
    BDETAIL.BD_CONID IS NULL
    AND BD_DATETIME >= TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
    AND BD_DATETIME < LAST_DAY(ADD_MONTHS(trunc(sysdate),-1)) + 1
    AND BD_MAPSID = 'E'
    AND NVL(BD_CDRTID,'CTB-CO') = 'CTB-CO'
GROUP BY
  BD_SERVICE;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR006A_DETAILS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR006A_DETAILS
(AC_NAME, CON_NAME, BD_SERVICE, BD_BILLRATE, CDRS_POST, 
 CDRS_PRE, CDRS_TOTAL, AMOUNTCU_POST, AMOUNTCU_PRE, AMOUNTCU_TOTAL, 
 SHAREPV_POST, SHAREPV_PRE, SHAREPV_TOTAL, SHAREMO_POST, SHAREMO_PRE, 
 SHAREMO_TOTAL, AC_ID)
BEQUEATH DEFINER
AS 
SELECT /*+ FULL (BDETAIL) */
 AC_NAME,
 CON_NAME,
 BD_SERVICE,
 NVL(to_char(BD_BILLRATE),LTRIM(to_char(BD_AMOUNTCU,'9990.000')))  bd_billrate,
 
 SUM(DECODE(BD_PREPAID,'Y',0,1)) CDRs_Post,
 SUM(DECODE(BD_PREPAID,'Y',1,0)) CDRs_Pre,
 SUM(1) CDRs_Total,

 SUM(DECODE(BD_PREPAID,'Y',0,BD_AMOUNTCU)) AmountCu_Post,
 SUM(DECODE(BD_PREPAID,'Y',BD_AMOUNTCU,0)) AmountCu_Pre,
 SUM(BD_AMOUNTCU) AmountCu_Total,

 SUM(DECODE(BD_PREPAID,'Y',0,BD_RETSHAREPV)) SharePv_Post,
 SUM(DECODE(BD_PREPAID,'Y',BD_RETSHAREPV,0)) SharePv_Pre,
 SUM(BD_RETSHAREPV) SharePv_Total,

 SUM(DECODE(BD_PREPAID,'Y',0,BD_RETSHAREMO)) ShareMo_Post,
 SUM(DECODE(BD_PREPAID,'Y',BD_RETSHAREMO,0)) ShareMo_Pre,
 SUM(BD_RETSHAREMO) ShareMo_Total,
 AC_ID
FROM BDETAIL, CONTRACT, ACCOUNT
  WHERE
    BDETAIL.BD_CONID = CONTRACT.CON_ID
  AND CON_ACID = AC_ID
  AND BD_DATETIME >= TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
  AND BD_DATETIME < LAST_DAY(ADD_MONTHS(trunc(sysdate),-1)) + 1
  AND BD_MAPSID = 'R'
  AND CON_ESTID IN ('PTS')
  AND NVL(BD_CDRTID,'CTB-CO') = 'CTB-CO'
GROUP BY 
  AC_NAME,
  CON_NAME,
  BD_SERVICE,
  NVL(to_char(BD_BILLRATE),LTRIM(to_char(BD_AMOUNTCU,'9990.000'))),
  BD_CONID,
  AC_ID
ORDER BY
  1,
  2,
  3,
  4,
  BD_CONID,
  AC_ID;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR007A_DETAILS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR007A_DETAILS
(AC_NAME, CON_NAME, BD_SERVICE, BD_BILLRATE, CDRS_POST, 
 CDRS_PRE, CDRS_TOTAL, AMOUNTCU_POST, AMOUNTCU_PRE, AMOUNTCU_TOTAL, 
 SHAREPV_POST, SHAREPV_PRE, SHAREPV_TOTAL, SHAREMO_POST, SHAREMO_PRE, 
 SHAREMO_TOTAL, AC_ID)
BEQUEATH DEFINER
AS 
SELECT /*+ FULL (BDETAIL) */
 AC_NAME,
 CON_NAME,
 BD_SERVICE,
 NVL(to_char(BD_BILLRATE),LTRIM(to_char(BD_AMOUNTCU,'9990.000')))  bd_billrate,
 SUM(DECODE(BD_PREPAID,'Y',0,1)) CDRs_Post,
 SUM(DECODE(BD_PREPAID,'Y',1,0)) CDRs_Pre,
 SUM(1) CDRs_Total,

 SUM(DECODE(BD_PREPAID,'Y',0,BD_AMOUNTCU)) AmountCu_Post,
 SUM(DECODE(BD_PREPAID,'Y',BD_AMOUNTCU,0)) AmountCu_Pre,
 SUM(BD_AMOUNTCU) AmountCu_Total,

 SUM(DECODE(BD_PREPAID,'Y',0,BD_RETSHAREPV)) SharePv_Post,
 SUM(DECODE(BD_PREPAID,'Y',BD_RETSHAREPV,0)) SharePv_Pre,
 SUM(BD_RETSHAREPV) SharePv_Total,

 SUM(DECODE(BD_PREPAID,'Y',0,BD_RETSHAREMO)) ShareMo_Post,
 SUM(DECODE(BD_PREPAID,'Y',BD_RETSHAREMO,0)) ShareMo_Pre,
 SUM(BD_RETSHAREMO) ShareMo_Total,
 AC_ID
FROM BDETAIL, CONTRACT, ACCOUNT
  WHERE
    BDETAIL.BD_CONID = CONTRACT.CON_ID
  AND CON_ACID = AC_ID
  AND BD_DATETIME >= TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
  AND BD_DATETIME < LAST_DAY(ADD_MONTHS(trunc(sysdate),-1)) + 1
  AND BD_MAPSID = 'R'
  AND CON_ESTID IN ('BN','MVP')
  AND NVL(BD_CDRTID,'CTB-CO') = 'CTB-CO'
GROUP BY 
  AC_NAME,
  CON_NAME,
  BD_SERVICE,
  NVL(to_char(BD_BILLRATE),LTRIM(to_char(BD_AMOUNTCU,'9990.000'))),
  BD_CONID,
  AC_ID
ORDER BY
  AC_NAME,
  CON_NAME,
  BD_SERVICE,
  4,
  BD_CONID,
  AC_ID;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR008A_DETAILS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR008A_DETAILS
(BD_DATETIME, BD_SRCTYPE, CON_ACNAME, CON_NAME, CON_SNAME, 
 CON_ID, BD_KEYWORD, BD_COUNT)
BEQUEATH DEFINER
AS 
SELECT
  TRUNC(BD_DATETIME)            bd_datetime,
  BD_SRCTYPE                    bd_srctype,
  AC_NAME                       con_acname,
  NVL(CON_NAME,AC_NAME)         con_name,
  NULL                          con_sname,
  CON_ID                        con_id,
  BD_KEYWORD                    bd_keyword,
  COUNT(BDETAIL.ROWID)          bd_count
FROM
  BDETAIL,
  CONTRACT,
  ACCOUNT
WHERE
    BDETAIL.BD_CONID = CONTRACT.CON_ID
  AND CON_ACID = AC_ID
  AND BD_DATETIME >= TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
  AND BD_DATETIME < LAST_DAY(ADD_MONTHS(trunc(sysdate),-1)) + 1
  AND NVL(BD_CDRTID,'CTB-CO') = 'CTB-CO'
GROUP BY
  TRUNC(BD_DATETIME),
  BD_SRCTYPE,
  AC_NAME,
  NVL(CON_NAME,AC_NAME),
  CON_ID,
  BD_KEYWORD
ORDER BY
  TRUNC(BD_DATETIME),
  BD_SRCTYPE,
  AC_NAME,
  NVL(CON_NAME,AC_NAME),
  CON_ID,
  BD_KEYWORD;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR012A_DETAILS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR012A_DETAILS
(BD_DATETIME, CON_ID, TOTAL, MTDELIVERED0, MTDELETED1, 
 MTEXPIRED2, MTREPLACED3)
BEQUEATH DEFINER
AS 
SELECT /*+ FULL(BDETAIL2) */
    BD_DATETIME,
    BD_CONID CON_ID,
    SUM(1) COUNTMT,
    SUM(DECODE(BD_STATUS,0,1,0)) MtDelivered0,
    SUM(DECODE(BD_STATUS,1,1,0)) MtDeleted1,
    SUM(DECODE(BD_STATUS,2,1,0)) MtExpired2,
    SUM(DECODE(BD_STATUS,3,1,0)) MtReplaced3
FROM
    BDETAIL2
WHERE
      BD_DATETIME >= TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
  AND BD_DATETIME < LAST_DAY(ADD_MONTHS(trunc(sysdate),-1)) + 1
  AND BD_MAPSID = 'R'
  AND     BD_NPI_B = 1
  AND     BD_PID_B = 0  
GROUP BY BD_DATETIME, BD_CONID;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR013A_DETAILS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR013A_DETAILS
(BD_SHORTID, BD_DATETIME, TOTAL, BD_AMOUNTCU, BD_RETSHAREPV, 
 BD_RETSHAREMO)
BEQUEATH DEFINER
AS 
SELECT /*+ FULL(BDETAIL) */
        NVL(BD_SHORTID,'NA') BD_SHORTID,
    to_char(BD_DATETIME,'YYYY-MM-DD') bd_datetime,
    COUNT(*),
    SUM(BD_AMOUNTCU),
    SUM(BD_RETSHAREPV),
    SUM(BD_RETSHAREMO)
FROM
    BDETAIL,
    CONTRACT
WHERE
        BDETAIL.BD_CONID = CONTRACT.CON_ID
    AND BD_DATETIME >= TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
    AND BD_DATETIME < LAST_DAY(ADD_MONTHS(trunc(sysdate),-1)) + 1
    AND BD_DEMO = 0
    AND BD_MAPSID = 'R'
    AND CON_ESTID IN ('BN','MVP')
    AND NVL(BD_CDRTID,'CTB-CO') = 'CTB-CO'
GROUP BY
    CON_ACID,
        NVL(BD_SHORTID,'NA'),
    to_char(BD_DATETIME,'YYYY-MM-DD')
ORDER BY
    CON_ACID,
    1,
    2;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR014A_DETAILS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR014A_DETAILS
(BD_SHORTID, BD_DATETIME, TOTAL, BD_AMOUNTCU, BD_RETSHAREPV, 
 BD_RETSHAREMO)
BEQUEATH DEFINER
AS 
SELECT /*+ FULL(BDETAIL) */
    NVL(BD_SHORTID,'NA') BD_SHORTID,
    to_char(BD_DATETIME,'YYYY-MM-DD') bd_datetime,
    COUNT(*),
    SUM(BD_AMOUNTCU),
    SUM(BD_RETSHAREPV),
    SUM(BD_RETSHAREMO)
FROM
    BDETAIL,
    CONTRACT
WHERE
        BDETAIL.BD_CONID = CONTRACT.CON_ID
    AND BD_DATETIME >= TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
    AND BD_DATETIME < LAST_DAY(ADD_MONTHS(trunc(sysdate),-1)) + 1
    AND BD_DEMO = 0
    AND BD_MAPSID = 'R'
    AND CON_ESTID = 'PTS'
    AND NVL(BD_CDRTID,'CTB-CO') = 'CTB-CO'
GROUP BY
    CON_ACID,
        NVL(BD_SHORTID,'NA'),
    to_char(BD_DATETIME,'YYYY-MM-DD')
ORDER BY
    CON_ACID,
    1,
    2;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR015A_DETAILS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR015A_DETAILS
(BD_SRCTYPE, AC_NAME, CON_NAME, BD_SERVICE, BD_LOCATION, 
 CDR_COUNT, BD_PREPAID)
BEQUEATH DEFINER
AS 
SELECT /*+ FULL(BDETAIL) */
  BD_SRCTYPE,
  AC_NAME,
  CON_NAME,
  BD_SERVICE,
  bd_location,
  COUNT(BDETAIL.ROWID) cdr_count,
  DECODE(BD_PREPAID,'Y','Pre','N','Post','N.A.')  bd_prepaid
FROM BDETAIL, CONTRACT, ACCOUNT
WHERE      BDETAIL.BD_CONID = CONTRACT.CON_ID
  AND CON_ACID = AC_ID
  AND CON_ESTID IN ('BN','MVP')
  AND BD_DATETIME >= TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
  AND BD_DATETIME < LAST_DAY(ADD_MONTHS(trunc(sysdate),-1)) + 1
  AND BD_MAPSID = 'R'    
  AND BD_LOCATION IS NOT NULL  
  AND NVL(BD_CDRTID,'CTB-CO') = 'CTB-CO'
GROUP BY
    BD_SRCTYPE,    
    AC_NAME,    
    CON_NAME,
    BD_SERVICE,
    bd_location,    
    BD_PREPAID;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR016A_DETAILS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR016A_DETAILS
(BD_SRCTYPE, AC_NAME, CON_NAME, BD_SERVICE, BD_LOCATION, 
 CDR_COUNT, BD_PREPAID)
BEQUEATH DEFINER
AS 
SELECT /*+ FULL(BDETAIL) */
  BD_SRCTYPE,
  AC_NAME,
  CON_NAME,
  BD_SERVICE,
  bd_location,
  COUNT(BDETAIL.ROWID) cdr_count,
  DECODE(BD_PREPAID,'Y','Pre','N','Post','N.A.')  bd_prepaid
FROM BDETAIL, CONTRACT, ACCOUNT
WHERE      BDETAIL.BD_CONID = CONTRACT.CON_ID
  AND CON_ACID = AC_ID
  AND CON_ESTID = 'PTS'
  AND BD_DATETIME >= TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
  AND BD_DATETIME < LAST_DAY(ADD_MONTHS(trunc(sysdate),-1)) + 1
  AND BD_MAPSID = 'R'
  AND BD_LOCATION IS NOT NULL
  AND NVL(BD_CDRTID,'CTB-CO') = 'CTB-CO'
GROUP BY
    BD_SRCTYPE,
    AC_NAME,
    CON_NAME,
    BD_SERVICE,
    bd_location,
    BD_PREPAID;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR017A_DETAILS_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR017A_DETAILS_1
(BD_PREPAID, ST_LANG01, BD_AMOUNTCU, BD_DATETIME, BD_NETWORK, 
 COUNTER)
BEQUEATH DEFINER
AS 
SELECT /*+ FULL (BDETAIL) */
 DECODE(BD_PREPAID,'Y','Pre Paid','N','Post Paid','N.A.') BD_PREPAID,
 ST_LANG01,
 BD_AMOUNTCU,
 TRUNC(BD_DATETIME) BD_DATETIME,
 DECODE(BD_NETWORK,'CSD','GSM','PSD','GPRS',BD_NETWORK) BD_NETWORK,
 ((COUNT(*))*BD_AMOUNTCU) COUNTER
FROM
 BDETAIL,
 CONTRACT,
 STYPE
WHERE
  BDETAIL.BD_CONID = CONTRACT.CON_ID
 AND STYPE.ST_ID = BDETAIL.BD_STYPE
 AND BDETAIL.BD_MAPSID NOT IN ('M','m')
 AND CON_ESTID = 'WCB'
 AND BD_DATETIME >= ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1)
 AND BD_DATETIME < TRUNC(sysdate,'MONTH')
 AND NVL(BD_CDRTID,'CTB-CO') = 'CTB-CO'
GROUP BY
 BD_PREPAID,
 ST_LANG01,
 BD_AMOUNTCU,
 TRUNC(BD_DATETIME),
 DECODE(BD_NETWORK,'CSD','GSM','PSD','GPRS',BD_NETWORK)
ORDER BY
 BD_PREPAID,
 ST_LANG01,
 BD_AMOUNTCU,
 TRUNC(BD_DATETIME),
 DECODE(BD_NETWORK,'CSD','GSM','PSD','GPRS',BD_NETWORK) DESC;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR017A_DETAILS_2  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR017A_DETAILS_2
(BD_PREPAID, BD_AMOUNTCU, BD_DATETIME, BD_NETWORK, COUNTER)
BEQUEATH DEFINER
AS 
SELECT /*+ FULL (BDETAIL) */
  DECODE(BD_PREPAID,'Y','Pre Paid','N','Post Paid','N.A.') BD_PREPAID,
  BD_AMOUNTCU,
  TRUNC(BD_DATETIME) BD_DATETIME,
  DECODE(BD_NETWORK,'CSD','GSM','PSD','GPRS',BD_NETWORK) BD_NETWORK,
  COUNT(*) Counter
 FROM
  BDETAIL,
  CONTRACT
 WHERE
   BDETAIL.BD_CONID = CONTRACT.CON_ID
  AND BDETAIL.BD_MAPSID NOT IN ('M','m')
  AND CON_ESTID = 'WCB'
  AND BD_DATETIME >= ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1)
  AND BD_DATETIME < TRUNC(sysdate,'MONTH')
  AND NVL(BD_CDRTID,'CTB-CO') = 'CTB-CO'
GROUP BY
  CON_ID,
  BD_PREPAID,
  BD_AMOUNTCU,
  TRUNC(BD_DATETIME),
  DECODE(BD_NETWORK,'CSD','GSM','PSD','GPRS',BD_NETWORK)
 ORDER BY
  CON_ID,
  BD_PREPAID,
  BD_AMOUNTCU,
  TRUNC(BD_DATETIME),
  DECODE(BD_NETWORK,'CSD','GSM','PSD','GPRS',BD_NETWORK) DESC;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR018A_DETAILS_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR018A_DETAILS_1
(CON_ACNAME, BD_PREPAID, ST_LANG01, BD_AMOUNTCU, BD_DATETIME, 
 BD_NETWORK, COUNTER)
BEQUEATH DEFINER
AS 
SELECT /*+ NO_INDEX (BDETAIL) */
 NVL(CON_NAME,AC_NAME) CON_ACNAME,
 DECODE(BD_PREPAID,'Y','Pre Paid','N','Post Paid','N.A.') BD_PREPAID,
 ST_LANG01,
 BD_AMOUNTCU,
 TRUNC(BD_DATETIME) BD_DATETIME,
 DECODE(BD_NETWORK,'CSD','GSM','PSD','GPRS',BD_NETWORK) BD_NETWORK,
 ((COUNT(*))*BD_AMOUNTCU) COUNTER
FROM
 BDETAIL,
 CONTRACT,
 ACCOUNT,
 STYPE
WHERE
  BDETAIL.BD_CONID = CONTRACT.CON_ID
 AND ACCOUNT.AC_ID = CONTRACT.CON_ACID
 AND STYPE.ST_ID = BDETAIL.BD_STYPE
 AND BDETAIL.BD_MAPSID NOT IN ('M','m')
 AND CON_ESTID = 'WCB'
 AND BD_DATETIME >= ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1)
 AND BD_DATETIME < TRUNC(sysdate,'MONTH')
 AND NVL(BD_CDRTID,'CTB-CO') = 'CTB-CO'
GROUP BY
 NVL(CON_NAME,AC_NAME),
 CON_ID,
 BD_PREPAID,
 ST_LANG01,
 BD_AMOUNTCU,
 TRUNC(BD_DATETIME),
 DECODE(BD_NETWORK,'CSD','GSM','PSD','GPRS',BD_NETWORK)
ORDER BY
 NVL(CON_NAME,AC_NAME),
 CON_ID,
 BD_PREPAID,
 ST_LANG01,
 BD_AMOUNTCU,
 TRUNC(BD_DATETIME),
 DECODE(BD_NETWORK,'CSD','GSM','PSD','GPRS',BD_NETWORK) DESC;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR018A_DETAILS_2  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR018A_DETAILS_2
(CON_ACNAME, BD_PREPAID, BD_AMOUNTCU, BD_DATETIME, BD_NETWORK, 
 COUNTER)
BEQUEATH DEFINER
AS 
SELECT /*+ NO_INDEX (BDETAIL) */
 NVL(CON_NAME,AC_NAME) CON_ACNAME,
 DECODE(BD_PREPAID,'Y','Pre Paid','N','Post Paid','N.A.') BD_PREPAID,
 BD_AMOUNTCU,
 TRUNC(BD_DATETIME) BD_DATETIME,
 DECODE(BD_NETWORK,'CSD','GSM','PSD','GPRS',BD_NETWORK) BD_NETWORK,
 COUNT(*) COUNTER
FROM
 BDETAIL,
 CONTRACT,
 ACCOUNT
WHERE
  BDETAIL.BD_CONID = CONTRACT.CON_ID
 AND ACCOUNT.AC_ID = CONTRACT.CON_ACID
 AND BDETAIL.BD_MAPSID NOT IN ('M','m')
 AND CON_ESTID = 'WCB'
 AND BD_DATETIME >= ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1)
 AND BD_DATETIME < TRUNC(sysdate,'MONTH')
 AND NVL(BD_CDRTID,'CTB-CO') = 'CTB-CO'
GROUP BY
 NVL(CON_NAME,AC_NAME),
 CON_ID,
 BD_PREPAID,
 BD_AMOUNTCU,
 TRUNC(BD_DATETIME),
 DECODE(BD_NETWORK,'CSD','GSM','PSD','GPRS',BD_NETWORK)
ORDER BY
 NVL(CON_NAME,AC_NAME),
 CON_ID,
 BD_PREPAID,
 BD_AMOUNTCU,
 TRUNC(BD_DATETIME),
 DECODE(BD_NETWORK,'CSD','GSM','PSD','GPRS',BD_NETWORK) DESC;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR023A_DETAILS_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR023A_DETAILS_1
(ADR_COUNTRY, AC_NAME, CON_CODE, IWTC_DATE, TOTAL_COUNT, 
 HRR_COUNT, CHARGEABLE_COUNT)
BEQUEATH DEFINER
AS 
SELECT
 ADR_COUNTRY,
 AC_NAME,
 CON_CODE,
 TO_CHAR(IWTC_DATE,'YYYYMM') IWTC_DATE,
 SUM(IWTC_COUNT + NVL(IWTC_HRR_COUNT,0)) TOTAL_COUNT,
 SUM(NVL(IWTC_HRR_COUNT,0)) HRR_COUNT,
 SUM(IWTC_COUNT) CHARGEABLE_COUNT
FROM
 IWTCOUNTER,
 SMSC,
 CONTRACT,
 ACCOUNT,
 ADDRESS
WHERE
  IWTC_SMSCID = SMSC_ID
 AND SMSC_CONOPKEY = CON_OPKEY
 AND CON_ACID = AC_ID
 AND CON_ETID = 'TOC'
 AND CON_ESID IN ('A','I','E')
 AND ((IWTC_DATE >= CON_DATESTART) OR (CON_DATESTART IS NULL))
 AND ((IWTC_DATE < CON_DATEEND) OR (CON_DATEEND IS NULL)) 
 AND ADR_ID = AC_ADRID_MAIN
 AND IWTC_DATE < trunc(SYSDATE,'MONTH')
 AND IWTC_DATE >= add_months(trunc(SYSDATE,'MONTH'),-6)
 AND IWTC_ESID In ('A','P','D')
GROUP BY
 ADR_COUNTRY,
 AC_NAME,
 CON_CODE,
 To_Char(IWTC_DATE,'YYYYMM')
ORDER BY
 1,
 2,
 3,
 4;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR023A_DETAILS_2  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR023A_DETAILS_2
(ADR_COUNTRY, AC_NAME, CON_CODE, SMSC_CODE, TOTAL_COUNT, 
 HRR_COUNT, CHARGEABLE_COUNT)
BEQUEATH DEFINER
AS 
SELECT
 ADR_COUNTRY,
 AC_NAME,
 CON_CODE,
 SMSC_CODE,
 SUM(IWTC_COUNT + NVL(IWTC_HRR_COUNT,0)) TOTAL_COUNT,
 SUM(NVL(IWTC_HRR_COUNT,0)) HRR_COUNT,
 SUM(IWTC_COUNT) CHARGEABLE_COUNT
FROM
 IWTCOUNTER,
 SMSC,
 CONTRACT,
 ACCOUNT,
 ADDRESS
WHERE
  IWTC_SMSCID = SMSC_ID
 AND SMSC_CONOPKEY = CON_OPKEY
 AND CON_ACID = AC_ID
 AND ADR_ID = AC_ADRID_MAIN
 AND CON_ETID = 'TOC'
 AND CON_ESID in ('A','I','E')
 AND ((IWTC_DATE >= CON_DATESTART)
 OR (CON_DATESTART IS NULL))
 AND ((IWTC_DATE < CON_DATEEND)
 OR (CON_DATEEND IS NULL))
 AND IWTC_DATE < trunc(SYSDATE,'MONTH')
 AND IWTC_DATE >= add_months(trunc(SYSDATE,'MONTH'),-1)
 AND IWTC_ESID In ('A','P','D')
GROUP BY
 ADR_COUNTRY,
 CON_CODE,
 AC_NAME,
 SMSC_CODE
ORDER BY
 ADR_COUNTRY,
 AC_NAME,
 CON_CODE,
 SMSC_CODE;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR024A_DETAILS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR024A_DETAILS
(BD_DATETIME, SMUCP31, SMGSM31, SMTOTAL31, SMUCP41, 
 SMGSM41, SMTOTAL41, SMUCP51, SMGSM51, SMTOTAL51)
BEQUEATH DEFINER
AS 
SELECT /*+ FULL(BDETAIL1) */
    TO_CHAR(BD_DATETIME,'HH24') || ':00-' || TO_CHAR(TO_NUMBER(TO_CHAR(BD_DATETIME,'HH24')) + 1, '00') || ':00',
    SUM(DECODE(BD_VSMSCID || BD_PID_A,'3139',1,0)),
    SUM(DECODE(BD_VSMSCID,'31',1,0))-SUM(DECODE(BD_VSMSCID || BD_PID_A,'3139',1,0)),
    SUM(DECODE(BD_VSMSCID,'31',1,0)),
    SUM(DECODE(BD_VSMSCID || BD_PID_A,'4139',1,0)),
    SUM(DECODE(BD_VSMSCID,'41',1,0))-SUM(DECODE(BD_VSMSCID || BD_PID_A,'4139',1,0)),
    SUM(DECODE(BD_VSMSCID,'41',1,0)),
    SUM(DECODE(BD_VSMSCID || BD_PID_A,'5139',1,0)),
    SUM(DECODE(BD_VSMSCID,'51',1,0))-SUM(DECODE(BD_VSMSCID || BD_PID_A,'5139',1,0)),
    SUM(DECODE(BD_VSMSCID,'51',1,0))
FROM
    BDETAIL1
WHERE
        BD_MAPSID = 'R'
    AND BD_SRCTYPE = 'SMSC'
    AND BD_DEMO = 0
    AND BD_STATUS = 4
    AND BD_DATETIME < trunc(sysdate)
    AND BD_DATETIME >= trunc(sysdate)-1
GROUP BY
    TO_CHAR(BD_DATETIME,'HH24');


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR025A_DETAILS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR025A_DETAILS
(BD_DATETIME, SDUCP31, SDGSM31, NDDUCP31, NDDGSM31, 
 NDEUCP31, NDEGSM31, NDRUCP31, NDRGSM31, TOTAL31, 
 SDUCP41, SDGSM41, NDDUCP41, NDDGSM41, NDEUCP41, 
 NDEGSM41, NDRUCP41, NDRGSM41, TOTAL41, SDUCP51, 
 SDGSM51, NDDUCP51, NDDGSM51, NDEUCP51, NDEGSM51, 
 NDRUCP51, NDRGSM51, TOTAL51)
BEQUEATH DEFINER
AS 
SELECT /*+ FULL(BDETAIL2) */
    TO_CHAR(BD_DATETIME,'HH24') || ':00-' || TO_CHAR(TO_NUMBER(TO_CHAR(BD_DATETIME,'HH24')) + 1, '00') || ':00' bd_datetime,

    SUM(DECODE(BD_VSMSCID || BD_STATUS || BD_PID_A,'31039',1,0)) sducp31,
    SUM(DECODE(BD_VSMSCID || BD_STATUS, '310',1,0))-SUM(DECODE(BD_VSMSCID || BD_STATUS || BD_PID_A,'31039',1,0)) sdgsm31,
    SUM(DECODE(BD_VSMSCID || BD_STATUS || BD_PID_A,'31139',1,0)) ndducp31,
    SUM(DECODE(BD_VSMSCID || BD_STATUS, '311',1,0))-SUM(DECODE(BD_VSMSCID || BD_STATUS || BD_PID_A,'31139',1,0)) nddgsm31,
    SUM(DECODE(BD_VSMSCID || BD_STATUS || BD_PID_A,'31239',1,0)) ndeucp31,
    SUM(DECODE(BD_VSMSCID || BD_STATUS, '312',1,0))-SUM(DECODE(BD_VSMSCID || BD_STATUS || BD_PID_A,'31239',1,0)) ndegsm31,
    SUM(DECODE(BD_VSMSCID || BD_STATUS || BD_PID_A,'31339',1,0)) ndrucp31,
    SUM(DECODE(BD_VSMSCID || BD_STATUS, '313',1,0))-SUM(DECODE(BD_VSMSCID || BD_STATUS || BD_PID_A,'31339',1,0)) ndrgsm31,
    SUM(DECODE(BD_VSMSCID,'31',1,0)) Total31,

    SUM(DECODE(BD_VSMSCID || BD_STATUS || BD_PID_A,'41039',1,0)) sducp41,
    SUM(DECODE(BD_VSMSCID || BD_STATUS, '410',1,0))-SUM(DECODE(BD_VSMSCID || BD_STATUS || BD_PID_A,'41039',1,0)) sdgsm41,
    SUM(DECODE(BD_VSMSCID || BD_STATUS || BD_PID_A,'41139',1,0)) ndducp41,
    SUM(DECODE(BD_VSMSCID || BD_STATUS, '411',1,0))-SUM(DECODE(BD_VSMSCID || BD_STATUS || BD_PID_A,'41139',1,0)) nddgsm41,
    SUM(DECODE(BD_VSMSCID || BD_STATUS || BD_PID_A,'41239',1,0)) ndeucp41,
    SUM(DECODE(BD_VSMSCID || BD_STATUS, '412',1,0))-SUM(DECODE(BD_VSMSCID || BD_STATUS || BD_PID_A,'41239',1,0)) ndegsm41,
    SUM(DECODE(BD_VSMSCID || BD_STATUS || BD_PID_A,'41339',1,0)) ndrucp41,
    SUM(DECODE(BD_VSMSCID || BD_STATUS, '413',1,0))-SUM(DECODE(BD_VSMSCID || BD_STATUS || BD_PID_A,'41339',1,0)) ndrgsm41,
    SUM(DECODE(BD_VSMSCID,'41',1,0)) Total41,

    SUM(DECODE(BD_VSMSCID || BD_STATUS || BD_PID_A,'51039',1,0)) sducp51,
    SUM(DECODE(BD_VSMSCID || BD_STATUS, '510',1,0))-SUM(DECODE(BD_VSMSCID || BD_STATUS || BD_PID_A,'51039',1,0)) sdgsm51,
    SUM(DECODE(BD_VSMSCID || BD_STATUS || BD_PID_A,'51139',1,0)) ndducp51,
    SUM(DECODE(BD_VSMSCID || BD_STATUS, '511',1,0))-SUM(DECODE(BD_VSMSCID || BD_STATUS || BD_PID_A,'51139',1,0)) nddgsm51,
    SUM(DECODE(BD_VSMSCID || BD_STATUS || BD_PID_A,'51239',1,0)) ndeucp51,
    SUM(DECODE(BD_VSMSCID || BD_STATUS, '512',1,0))-SUM(DECODE(BD_VSMSCID || BD_STATUS || BD_PID_A,'51239',1,0)) ndegsm51,
    SUM(DECODE(BD_VSMSCID || BD_STATUS || BD_PID_A,'51339',1,0)) ndrucp51,
    SUM(DECODE(BD_VSMSCID || BD_STATUS, '513',1,0))-SUM(DECODE(BD_VSMSCID || BD_STATUS || BD_PID_A,'51339',1,0)) ndrgsm51,
    SUM(DECODE(BD_VSMSCID,'51',1,0)) Total51
FROM
    BDETAIL2
WHERE
        BD_MAPSID = 'R'
    AND BD_SRCTYPE = 'SMSC'
    AND BD_DEMO = 0
    AND BD_DATETIME < trunc(sysdate)
    AND BD_DATETIME >= trunc(sysdate)-1
GROUP BY
    TO_CHAR(BD_DATETIME,'HH24');


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR026A_DETAILS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR026A_DETAILS
(BD_SHORTID, BD_DATETIME, TOTAL, BD_AMOUNTCU, BD_RETSHAREPV, 
 BD_RETSHAREMO)
BEQUEATH DEFINER
AS 
SELECT /*+ FULL(BDETAIL) */
        NVL(BD_SHORTID,'NA') BD_SHORTID,
    to_char(BD_DATETIME,'YYYY-MM-DD') bd_datetime,
    COUNT(*),
    SUM(BD_AMOUNTCU),
    SUM(BD_RETSHAREPV),
    SUM(BD_RETSHAREMO)
FROM
    BDETAIL,
    CONTRACT
WHERE
        BDETAIL.BD_CONID = CONTRACT.CON_ID
    AND BD_DATETIME >= TRUNC(ADD_MONTHS(sysdate,-1),'MONTH')
    AND BD_DATETIME < LAST_DAY(ADD_MONTHS(trunc(sysdate),-1)) + 1
    AND BD_DEMO = 0
    AND BD_MAPSID = 'R'
    AND NVL(BD_CDRTID,'CTB-CO') = 'CTB-CO'
GROUP BY
    CON_ACID,
        NVL(BD_SHORTID,'NA'),
    to_char(BD_DATETIME,'YYYY-MM-DD');


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR030A_DETAILS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR030A_DETAILS
(BD_MSISDN)
BEQUEATH DEFINER
AS 
SELECT /*+ INDEX(BIHEADER IDX_BIH_DATETIME) */ DISTINCT
	BD_MSISDN_A
FROM
	BDETAIL,
	BIHEADER
WHERE
		BDETAIL.BD_BIHID = BIHEADER.BIH_ID
	AND	BD_SHORTID = '333'
	AND	BIH_DATETIME >= trunc(sysdate-1)
	AND	BIH_DATETIME < trunc(sysdate)
	AND	LOWER(BD_KEYWORD) IN ('plus')
    AND NVL(BD_CDRTID,'CTB-CO') = 'CTB-CO'
  AND ROWNUM <= 65500;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR031A_DETAILS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR031A_DETAILS
(BD_MSISDN)
BEQUEATH DEFINER
AS 
SELECT /*+ INDEX(BIHEADER IDX_BIH_DATETIME) */ DISTINCT
	BD_MSISDN_A
FROM
	BDETAIL,
	BIHEADER
WHERE
		BDETAIL.BD_BIHID = BIHEADER.BIH_ID
	AND	BD_SHORTID = '333'
	AND	BIH_DATETIME >= trunc(sysdate-1)
	AND	BIH_DATETIME < trunc(sysdate)
	AND	LOWER(BD_KEYWORD) IN ('standard','stantard','standart','sdandart')
    AND NVL(BD_CDRTID,'CTB-CO') = 'CTB-CO'
    AND ROWNUM <= 65500;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR034A_DETAILS_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR034A_DETAILS_1
(CON_ACNAME, BD_PREPAID, ST_LANG01, CLASS_0, CLASS0, 
 CLASS0_1, CLASS1_2, CLASS2_3, CLASS3_4, CLASS4_5, 
 CLASS5_6, CLASS6_7, CLASS7_8, CLASS8_9, CLASS9_10, 
 CLASS10_11, CLASS11_12, CLASS12_13, CLASS13_14, CLASS14_15, 
 CLASS15_16, CLASS16_17, CLASS17_18, CLASS18_19, CLASS19_20, 
 CLASS20_21, CLASS21_22, CLASS22_23, CLASS23_24, CLASS24_25, 
 CLASS25_26, CLASS26_27, CLASS27_28, CLASS28_29, CLASS29_30, 
 CLASS30_)
BEQUEATH DEFINER
AS 
SELECT /*+ FULL (BDETAIL) */
 NVL(CON_NAME,AC_NAME) CON_ACNAME,
 DECODE(BD_PREPAID,'Y','Pre Paid','N','Post Paid','N.A.') BD_PREPAID,
 ST_LANG01,
 SUM(CASE WHEN BD_AMOUNTCU < 0 THEN 1 ELSE 0 END) AS CLASS_0,
 SUM(CASE WHEN BD_AMOUNTCU = 0 THEN 1 ELSE 0 END) AS CLASS0,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 0.0001 AND 1 THEN 1 ELSE 0 END) AS CLASS0_1,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 1.0001 AND 2 THEN 1 ELSE 0 END) AS CLASS1_2,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 2.0001 AND 3 THEN 1 ELSE 0 END) AS CLASS2_3,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 3.0001 AND 4 THEN 1 ELSE 0 END) AS CLASS3_4,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 4.0001 AND 5 THEN 1 ELSE 0 END) AS CLASS4_5,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 5.0001 AND 6 THEN 1 ELSE 0 END) AS CLASS5_6,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 6.0001 AND 7 THEN 1 ELSE 0 END) AS CLASS6_7,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 7.0001 AND 8 THEN 1 ELSE 0 END) AS CLASS7_8,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 8.0001 AND 9 THEN 1 ELSE 0 END) AS CLASS8_9,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 9.0001 AND 10 THEN 1 ELSE 0 END) AS CLASS9_10,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 10.0001 AND 11 THEN 1 ELSE 0 END) AS CLASS10_11,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 11.0001 AND 12 THEN 1 ELSE 0 END) AS CLASS11_12,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 12.0001 AND 13 THEN 1 ELSE 0 END) AS CLASS12_13,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 13.0001 AND 14 THEN 1 ELSE 0 END) AS CLASS13_14,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 14.0001 AND 15 THEN 1 ELSE 0 END) AS CLASS14_15,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 15.0001 AND 16 THEN 1 ELSE 0 END) AS CLASS15_16,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 16.0001 AND 17 THEN 1 ELSE 0 END) AS CLASS16_17,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 17.0001 AND 18 THEN 1 ELSE 0 END) AS CLASS17_18,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 18.0001 AND 19 THEN 1 ELSE 0 END) AS CLASS18_19,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 19.0001 AND 20 THEN 1 ELSE 0 END) AS CLASS19_20,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 20.0001 AND 21 THEN 1 ELSE 0 END) AS CLASS20_21,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 21.0001 AND 22 THEN 1 ELSE 0 END) AS CLASS21_22,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 22.0001 AND 23 THEN 1 ELSE 0 END) AS CLASS22_23,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 23.0001 AND 24 THEN 1 ELSE 0 END) AS CLASS23_24,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 24.0001 AND 25 THEN 1 ELSE 0 END) AS CLASS24_25,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 25.0001 AND 26 THEN 1 ELSE 0 END) AS CLASS25_26,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 26.0001 AND 27 THEN 1 ELSE 0 END) AS CLASS26_27,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 27.0001 AND 28 THEN 1 ELSE 0 END) AS CLASS27_28,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 28.0001 AND 29 THEN 1 ELSE 0 END) AS CLASS28_29,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 29.0001 AND 30 THEN 1 ELSE 0 END) AS CLASS29_30,
 SUM(CASE WHEN BD_AMOUNTCU > 30 THEN 1 ELSE 0 END) AS CLASS30_
FROM
 BDETAIL,
 CONTRACT,
 ACCOUNT,
 STYPE
WHERE
  BDETAIL.BD_CONID = CONTRACT.CON_ID
 AND ACCOUNT.AC_ID = CONTRACT.CON_ACID
 AND NVL(STYPE.ST_ID, '0') = BDETAIL.BD_STYPE
 AND BDETAIL.BD_MAPSID = ('R')
 AND CON_ESTID IN ('BN','MVP')
 AND BD_DATETIME >= ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1)
 AND BD_DATETIME < TRUNC(sysdate,'MONTH')
 AND NVL(BD_CDRTID,'CTB-CO') = 'CTB-CO'
GROUP BY
 NVL(CON_NAME,AC_NAME),
 BD_PREPAID,
 ST_LANG01
ORDER BY
 1, 2, 3;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR034A_DETAILS_2  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR034A_DETAILS_2
(CON_ACNAME, BD_PREPAID, ST_LANG01, CLASS_0, CLASS0, 
 CLASS0_1, CLASS1_2, CLASS2_3, CLASS3_4, CLASS4_5, 
 CLASS5_6, CLASS6_7, CLASS7_8, CLASS8_9, CLASS9_10, 
 CLASS10_11, CLASS11_12, CLASS12_13, CLASS13_14, CLASS14_15, 
 CLASS15_16, CLASS16_17, CLASS17_18, CLASS18_19, CLASS19_20, 
 CLASS20_21, CLASS21_22, CLASS22_23, CLASS23_24, CLASS24_25, 
 CLASS25_26, CLASS26_27, CLASS27_28, CLASS28_29, CLASS29_30, 
 CLASS30_)
BEQUEATH DEFINER
AS 
SELECT
 CON_ACNAME,
 BD_PREPAID,
 ST_LANG01,
 count(distinct(CLASS_0)) CLASS_0,
 count(distinct(CLASS0)) CLASS0,
 count(distinct(CLASS0_1)) CLASS0_1,
 count(distinct(CLASS1_2)) CLASS1_2,
 count(distinct(CLASS2_3)) CLASS2_3,
 count(distinct(CLASS3_4)) CLASS3_4,
 count(distinct(CLASS4_5)) CLASS4_5,
 count(distinct(CLASS5_6)) CLASS5_6,
 count(distinct(CLASS6_7)) CLASS6_7,
 count(distinct(CLASS7_8)) CLASS7_8,
 count(distinct(CLASS8_9)) CLASS8_9,
 count(distinct(CLASS9_10)) CLASS9_10,
 count(distinct(CLASS10_11)) CLASS10_11,
 count(distinct(CLASS11_12)) CLASS11_12,
 count(distinct(CLASS12_13)) CLASS12_13,
 count(distinct(CLASS13_14)) CLASS13_14,
 count(distinct(CLASS14_15)) CLASS14_15,
 count(distinct(CLASS15_16)) CLASS15_16,
 count(distinct(CLASS16_17)) CLASS16_17,
 count(distinct(CLASS17_18)) CLASS17_18,
 count(distinct(CLASS18_19)) CLASS18_19,
 count(distinct(CLASS19_20)) CLASS19_20,
 count(distinct(CLASS20_21)) CLASS20_21,
 count(distinct(CLASS21_22)) CLASS21_22,
 count(distinct(CLASS22_23)) CLASS22_23,
 count(distinct(CLASS23_24)) CLASS23_24,
 count(distinct(CLASS24_25)) CLASS24_25,
 count(distinct(CLASS25_26)) CLASS25_26,
 count(distinct(CLASS26_27)) CLASS26_27,
 count(distinct(CLASS27_28)) CLASS27_28,
 count(distinct(CLASS28_29)) CLASS28_29,
 count(distinct(CLASS29_30)) CLASS29_30,
 count(distinct(CLASS30_)) CLASS30_
FROM
 sr034a_details_2_base
GROUP BY
 CON_ACNAME,
 BD_PREPAID,
 ST_LANG01;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR034A_DETAILS_2_BASE  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR034A_DETAILS_2_BASE
(CON_ACNAME, BD_PREPAID, ST_LANG01, CLASS_0, CLASS0, 
 CLASS0_1, CLASS1_2, CLASS2_3, CLASS3_4, CLASS4_5, 
 CLASS5_6, CLASS6_7, CLASS7_8, CLASS8_9, CLASS9_10, 
 CLASS10_11, CLASS11_12, CLASS12_13, CLASS13_14, CLASS14_15, 
 CLASS15_16, CLASS16_17, CLASS17_18, CLASS18_19, CLASS19_20, 
 CLASS20_21, CLASS21_22, CLASS22_23, CLASS23_24, CLASS24_25, 
 CLASS25_26, CLASS26_27, CLASS27_28, CLASS28_29, CLASS29_30, 
 CLASS30_)
BEQUEATH DEFINER
AS 
SELECT /*+ FULL (BDETAIL) */
 NVL(CON_NAME,AC_NAME) CON_ACNAME,
 DECODE(BD_PREPAID,'Y','Pre Paid','N','Post Paid','N.A.') BD_PREPAID,
 ST_LANG01,
 (CASE WHEN BD_AMOUNTCU < 0 THEN BD_MSISDN_A ELSE NULL END) AS CLASS_0,
 (CASE WHEN BD_AMOUNTCU = 0 THEN BD_MSISDN_A ELSE NULL END) AS CLASS0,
 (CASE WHEN BD_AMOUNTCU BETWEEN 0.0001 AND 1 THEN BD_MSISDN_A ELSE NULL END) AS CLASS0_1,
 (CASE WHEN BD_AMOUNTCU BETWEEN 1.0001 AND 2 THEN BD_MSISDN_A ELSE NULL END) AS CLASS1_2,
 (CASE WHEN BD_AMOUNTCU BETWEEN 2.0001 AND 3 THEN BD_MSISDN_A ELSE NULL END) AS CLASS2_3,
 (CASE WHEN BD_AMOUNTCU BETWEEN 3.0001 AND 4 THEN BD_MSISDN_A ELSE NULL END) AS CLASS3_4,
 (CASE WHEN BD_AMOUNTCU BETWEEN 4.0001 AND 5 THEN BD_MSISDN_A ELSE NULL END) AS CLASS4_5,
 (CASE WHEN BD_AMOUNTCU BETWEEN 5.0001 AND 6 THEN BD_MSISDN_A ELSE NULL END) AS CLASS5_6,
 (CASE WHEN BD_AMOUNTCU BETWEEN 6.0001 AND 7 THEN BD_MSISDN_A ELSE NULL END) AS CLASS6_7,
 (CASE WHEN BD_AMOUNTCU BETWEEN 7.0001 AND 8 THEN BD_MSISDN_A ELSE NULL END) AS CLASS7_8,
 (CASE WHEN BD_AMOUNTCU BETWEEN 8.0001 AND 9 THEN BD_MSISDN_A ELSE NULL END) AS CLASS8_9,
 (CASE WHEN BD_AMOUNTCU BETWEEN 9.0001 AND 10 THEN BD_MSISDN_A ELSE NULL END) AS CLASS9_10,
 (CASE WHEN BD_AMOUNTCU BETWEEN 10.0001 AND 11 THEN BD_MSISDN_A ELSE NULL END) AS CLASS10_11,
 (CASE WHEN BD_AMOUNTCU BETWEEN 11.0001 AND 12 THEN BD_MSISDN_A ELSE NULL END) AS CLASS11_12,
 (CASE WHEN BD_AMOUNTCU BETWEEN 12.0001 AND 13 THEN BD_MSISDN_A ELSE NULL END) AS CLASS12_13,
 (CASE WHEN BD_AMOUNTCU BETWEEN 13.0001 AND 14 THEN BD_MSISDN_A ELSE NULL END) AS CLASS13_14,
 (CASE WHEN BD_AMOUNTCU BETWEEN 14.0001 AND 15 THEN BD_MSISDN_A ELSE NULL END) AS CLASS14_15,
 (CASE WHEN BD_AMOUNTCU BETWEEN 15.0001 AND 16 THEN BD_MSISDN_A ELSE NULL END) AS CLASS15_16,
 (CASE WHEN BD_AMOUNTCU BETWEEN 16.0001 AND 17 THEN BD_MSISDN_A ELSE NULL END) AS CLASS16_17,
 (CASE WHEN BD_AMOUNTCU BETWEEN 17.0001 AND 18 THEN BD_MSISDN_A ELSE NULL END) AS CLASS17_18,
 (CASE WHEN BD_AMOUNTCU BETWEEN 18.0001 AND 19 THEN BD_MSISDN_A ELSE NULL END) AS CLASS18_19,
 (CASE WHEN BD_AMOUNTCU BETWEEN 19.0001 AND 20 THEN BD_MSISDN_A ELSE NULL END) AS CLASS19_20,
 (CASE WHEN BD_AMOUNTCU BETWEEN 20.0001 AND 21 THEN BD_MSISDN_A ELSE NULL END) AS CLASS20_21,
 (CASE WHEN BD_AMOUNTCU BETWEEN 21.0001 AND 22 THEN BD_MSISDN_A ELSE NULL END) AS CLASS21_22,
 (CASE WHEN BD_AMOUNTCU BETWEEN 22.0001 AND 23 THEN BD_MSISDN_A ELSE NULL END) AS CLASS22_23,
 (CASE WHEN BD_AMOUNTCU BETWEEN 23.0001 AND 24 THEN BD_MSISDN_A ELSE NULL END) AS CLASS23_24,
 (CASE WHEN BD_AMOUNTCU BETWEEN 24.0001 AND 25 THEN BD_MSISDN_A ELSE NULL END) AS CLASS24_25,
 (CASE WHEN BD_AMOUNTCU BETWEEN 25.0001 AND 26 THEN BD_MSISDN_A ELSE NULL END) AS CLASS25_26,
 (CASE WHEN BD_AMOUNTCU BETWEEN 26.0001 AND 27 THEN BD_MSISDN_A ELSE NULL END) AS CLASS26_27,
 (CASE WHEN BD_AMOUNTCU BETWEEN 27.0001 AND 28 THEN BD_MSISDN_A ELSE NULL END) AS CLASS27_28,
 (CASE WHEN BD_AMOUNTCU BETWEEN 28.0001 AND 29 THEN BD_MSISDN_A ELSE NULL END) AS CLASS28_29,
 (CASE WHEN BD_AMOUNTCU BETWEEN 29.0001 AND 30 THEN BD_MSISDN_A ELSE NULL END) AS CLASS29_30,
 (CASE WHEN BD_AMOUNTCU > 30 THEN BD_MSISDN_A ELSE NULL END) AS CLASS30_
FROM
 BDETAIL,
 CONTRACT,
 ACCOUNT,
 STYPE
WHERE
  BDETAIL.BD_CONID = CONTRACT.CON_ID
 AND ACCOUNT.AC_ID = CONTRACT.CON_ACID
 AND NVL(STYPE.ST_ID, '0') = BDETAIL.BD_STYPE
 AND BDETAIL.BD_MAPSID = ('R')
 AND CON_ESTID IN ('BN','MVP')
 AND BD_DATETIME >= ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1)
 AND BD_DATETIME < TRUNC(sysdate,'MONTH')
 AND NVL(BD_CDRTID,'CTB-CO') = 'CTB-CO'
ORDER BY
 1, 2, 3;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR034A_DETAILS_3  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR034A_DETAILS_3
(CON_ACNAME, BD_PREPAID, ST_LANG01, CLASS_0, CLASS0, 
 CLASS0_1, CLASS1_2, CLASS2_3, CLASS3_4, CLASS4_5, 
 CLASS5_6, CLASS6_7, CLASS7_8, CLASS8_9, CLASS9_10, 
 CLASS10_11, CLASS11_12, CLASS12_13, CLASS13_14, CLASS14_15, 
 CLASS15_16, CLASS16_17, CLASS17_18, CLASS18_19, CLASS19_20, 
 CLASS20_21, CLASS21_22, CLASS22_23, CLASS23_24, CLASS24_25, 
 CLASS25_26, CLASS26_27, CLASS27_28, CLASS28_29, CLASS29_30, 
 CLASS30_, TOTAL)
BEQUEATH DEFINER
AS 
SELECT /*+ FULL (BDETAIL) */
 NVL(CON_NAME,AC_NAME) CON_ACNAME,
 DECODE(BD_PREPAID,'Y','Pre Paid','N','Post Paid','N.A.') BD_PREPAID,
 ST_LANG01,
 SUM(CASE WHEN BD_AMOUNTCU < 0 THEN 1 ELSE 0 END) AS CLASS_0,
 SUM(CASE WHEN BD_AMOUNTCU = 0 THEN 1 ELSE 0 END) AS CLASS0,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 0.0001 AND 1 THEN 1 ELSE 0 END) AS CLASS0_1,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 1.0001 AND 2 THEN 1 ELSE 0 END) AS CLASS1_2,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 2.0001 AND 3 THEN 1 ELSE 0 END) AS CLASS2_3,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 3.0001 AND 4 THEN 1 ELSE 0 END) AS CLASS3_4,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 4.0001 AND 5 THEN 1 ELSE 0 END) AS CLASS4_5,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 5.0001 AND 6 THEN 1 ELSE 0 END) AS CLASS5_6,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 6.0001 AND 7 THEN 1 ELSE 0 END) AS CLASS6_7,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 7.0001 AND 8 THEN 1 ELSE 0 END) AS CLASS7_8,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 8.0001 AND 9 THEN 1 ELSE 0 END) AS CLASS8_9,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 9.0001 AND 10 THEN 1 ELSE 0 END) AS CLASS9_10,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 10.0001 AND 11 THEN 1 ELSE 0 END) AS CLASS10_11,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 11.0001 AND 12 THEN 1 ELSE 0 END) AS CLASS11_12,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 12.0001 AND 13 THEN 1 ELSE 0 END) AS CLASS12_13,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 13.0001 AND 14 THEN 1 ELSE 0 END) AS CLASS13_14,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 14.0001 AND 15 THEN 1 ELSE 0 END) AS CLASS14_15,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 15.0001 AND 16 THEN 1 ELSE 0 END) AS CLASS15_16,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 16.0001 AND 17 THEN 1 ELSE 0 END) AS CLASS16_17,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 17.0001 AND 18 THEN 1 ELSE 0 END) AS CLASS17_18,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 18.0001 AND 19 THEN 1 ELSE 0 END) AS CLASS18_19,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 19.0001 AND 20 THEN 1 ELSE 0 END) AS CLASS19_20,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 20.0001 AND 21 THEN 1 ELSE 0 END) AS CLASS20_21,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 21.0001 AND 22 THEN 1 ELSE 0 END) AS CLASS21_22,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 22.0001 AND 23 THEN 1 ELSE 0 END) AS CLASS22_23,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 23.0001 AND 24 THEN 1 ELSE 0 END) AS CLASS23_24,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 24.0001 AND 25 THEN 1 ELSE 0 END) AS CLASS24_25,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 25.0001 AND 26 THEN 1 ELSE 0 END) AS CLASS25_26,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 26.0001 AND 27 THEN 1 ELSE 0 END) AS CLASS26_27,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 27.0001 AND 28 THEN 1 ELSE 0 END) AS CLASS27_28,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 28.0001 AND 29 THEN 1 ELSE 0 END) AS CLASS28_29,
 SUM(CASE WHEN BD_AMOUNTCU BETWEEN 29.0001 AND 30 THEN 1 ELSE 0 END) AS CLASS29_30,
 SUM(CASE WHEN BD_AMOUNTCU > 30 THEN 1 ELSE 0 END) AS CLASS30_,
 COUNT(*)
FROM
 BDETAIL,
 CONTRACT,
 ACCOUNT,
 STYPE
WHERE
  BDETAIL.BD_CONID = CONTRACT.CON_ID
 AND ACCOUNT.AC_ID = CONTRACT.CON_ACID
 AND NVL(STYPE.ST_ID,'0') = BDETAIL.BD_STYPE
 AND BDETAIL.BD_MAPSID = 'R'
 AND CON_ESTID IN ('BN','MVP')
 AND BD_DATETIME >= ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1)
 AND BD_DATETIME < TRUNC(sysdate,'MONTH')
 AND NVL(BD_CDRTID,'CTB-CO') = 'CTB-CO'
GROUP BY
 NVL(CON_NAME,AC_NAME),
 BD_PREPAID,
 ST_LANG01
ORDER BY
 1, 2, 3;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR034A_DETAILS_4  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR034A_DETAILS_4
(CON_ACNAME, BD_PREPAID, ST_LANG01, CLASS_0, CLASS0, 
 CLASS0_1, CLASS1_2, CLASS2_3, CLASS3_4, CLASS4_5, 
 CLASS5_6, CLASS6_7, CLASS7_8, CLASS8_9, CLASS9_10, 
 CLASS10_11, CLASS11_12, CLASS12_13, CLASS13_14, CLASS14_15, 
 CLASS15_16, CLASS16_17, CLASS17_18, CLASS18_19, CLASS19_20, 
 CLASS20_21, CLASS21_22, CLASS22_23, CLASS23_24, CLASS24_25, 
 CLASS25_26, CLASS26_27, CLASS27_28, CLASS28_29, CLASS29_30, 
 CLASS30_)
BEQUEATH DEFINER
AS 
SELECT
 CON_ACNAME,
 BD_PREPAID,
 ST_LANG01,
 count(distinct(CLASS_0)) CLASS_0,
 count(distinct(CLASS0)) CLASS0,
 count(distinct(CLASS0_1)) CLASS0_1,
 count(distinct(CLASS1_2)) CLASS1_2,
 count(distinct(CLASS2_3)) CLASS2_3,
 count(distinct(CLASS3_4)) CLASS3_4,
 count(distinct(CLASS4_5)) CLASS4_5,
 count(distinct(CLASS5_6)) CLASS5_6,
 count(distinct(CLASS6_7)) CLASS6_7,
 count(distinct(CLASS7_8)) CLASS7_8,
 count(distinct(CLASS8_9)) CLASS8_9,
 count(distinct(CLASS9_10)) CLASS9_10,
 count(distinct(CLASS10_11)) CLASS10_11,
 count(distinct(CLASS11_12)) CLASS11_12,
 count(distinct(CLASS12_13)) CLASS12_13,
 count(distinct(CLASS13_14)) CLASS13_14,
 count(distinct(CLASS14_15)) CLASS14_15,
 count(distinct(CLASS15_16)) CLASS15_16,
 count(distinct(CLASS16_17)) CLASS16_17,
 count(distinct(CLASS17_18)) CLASS17_18,
 count(distinct(CLASS18_19)) CLASS18_19,
 count(distinct(CLASS19_20)) CLASS19_20,
 count(distinct(CLASS20_21)) CLASS20_21,
 count(distinct(CLASS21_22)) CLASS21_22,
 count(distinct(CLASS22_23)) CLASS22_23,
 count(distinct(CLASS23_24)) CLASS23_24,
 count(distinct(CLASS24_25)) CLASS24_25,
 count(distinct(CLASS25_26)) CLASS25_26,
 count(distinct(CLASS26_27)) CLASS26_27,
 count(distinct(CLASS27_28)) CLASS27_28,
 count(distinct(CLASS28_29)) CLASS28_29,
 count(distinct(CLASS29_30)) CLASS29_30,
 count(distinct(CLASS30_)) CLASS30_
FROM
 sr034a_details_4_base
GROUP BY
 CON_ACNAME,
 BD_PREPAID,
 ST_LANG01;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR034A_DETAILS_4_BASE  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR034A_DETAILS_4_BASE
(CON_ACNAME, BD_PREPAID, ST_LANG01, CLASS_0, CLASS0, 
 CLASS0_1, CLASS1_2, CLASS2_3, CLASS3_4, CLASS4_5, 
 CLASS5_6, CLASS6_7, CLASS7_8, CLASS8_9, CLASS9_10, 
 CLASS10_11, CLASS11_12, CLASS12_13, CLASS13_14, CLASS14_15, 
 CLASS15_16, CLASS16_17, CLASS17_18, CLASS18_19, CLASS19_20, 
 CLASS20_21, CLASS21_22, CLASS22_23, CLASS23_24, CLASS24_25, 
 CLASS25_26, CLASS26_27, CLASS27_28, CLASS28_29, CLASS29_30, 
 CLASS30_)
BEQUEATH DEFINER
AS 
SELECT /*+ FULL (BDETAIL) */
 NVL(CON_NAME,AC_NAME) CON_ACNAME,
 DECODE(BD_PREPAID,'Y','Pre Paid','N','Post Paid','N.A.') BD_PREPAID,
 ST_LANG01,
 (CASE WHEN BD_AMOUNTCU < 0 THEN BD_MSISDN_A ELSE NULL END) AS CLASS_0,
 (CASE WHEN BD_AMOUNTCU = 0 THEN BD_MSISDN_A ELSE NULL END) AS CLASS0,
 (CASE WHEN BD_AMOUNTCU BETWEEN 0.0001 AND 1 THEN BD_MSISDN_A ELSE NULL END) AS CLASS0_1,
 (CASE WHEN BD_AMOUNTCU BETWEEN 1.0001 AND 2 THEN BD_MSISDN_A ELSE NULL END) AS CLASS1_2,
 (CASE WHEN BD_AMOUNTCU BETWEEN 2.0001 AND 3 THEN BD_MSISDN_A ELSE NULL END) AS CLASS2_3,
 (CASE WHEN BD_AMOUNTCU BETWEEN 3.0001 AND 4 THEN BD_MSISDN_A ELSE NULL END) AS CLASS3_4,
 (CASE WHEN BD_AMOUNTCU BETWEEN 4.0001 AND 5 THEN BD_MSISDN_A ELSE NULL END) AS CLASS4_5,
 (CASE WHEN BD_AMOUNTCU BETWEEN 5.0001 AND 6 THEN BD_MSISDN_A ELSE NULL END) AS CLASS5_6,
 (CASE WHEN BD_AMOUNTCU BETWEEN 6.0001 AND 7 THEN BD_MSISDN_A ELSE NULL END) AS CLASS6_7,
 (CASE WHEN BD_AMOUNTCU BETWEEN 7.0001 AND 8 THEN BD_MSISDN_A ELSE NULL END) AS CLASS7_8,
 (CASE WHEN BD_AMOUNTCU BETWEEN 8.0001 AND 9 THEN BD_MSISDN_A ELSE NULL END) AS CLASS8_9,
 (CASE WHEN BD_AMOUNTCU BETWEEN 9.0001 AND 10 THEN BD_MSISDN_A ELSE NULL END) AS CLASS9_10,
 (CASE WHEN BD_AMOUNTCU BETWEEN 10.0001 AND 11 THEN BD_MSISDN_A ELSE NULL END) AS CLASS10_11,
 (CASE WHEN BD_AMOUNTCU BETWEEN 11.0001 AND 12 THEN BD_MSISDN_A ELSE NULL END) AS CLASS11_12,
 (CASE WHEN BD_AMOUNTCU BETWEEN 12.0001 AND 13 THEN BD_MSISDN_A ELSE NULL END) AS CLASS12_13,
 (CASE WHEN BD_AMOUNTCU BETWEEN 13.0001 AND 14 THEN BD_MSISDN_A ELSE NULL END) AS CLASS13_14,
 (CASE WHEN BD_AMOUNTCU BETWEEN 14.0001 AND 15 THEN BD_MSISDN_A ELSE NULL END) AS CLASS14_15,
 (CASE WHEN BD_AMOUNTCU BETWEEN 15.0001 AND 16 THEN BD_MSISDN_A ELSE NULL END) AS CLASS15_16,
 (CASE WHEN BD_AMOUNTCU BETWEEN 16.0001 AND 17 THEN BD_MSISDN_A ELSE NULL END) AS CLASS16_17,
 (CASE WHEN BD_AMOUNTCU BETWEEN 17.0001 AND 18 THEN BD_MSISDN_A ELSE NULL END) AS CLASS17_18,
 (CASE WHEN BD_AMOUNTCU BETWEEN 18.0001 AND 19 THEN BD_MSISDN_A ELSE NULL END) AS CLASS18_19,
 (CASE WHEN BD_AMOUNTCU BETWEEN 19.0001 AND 20 THEN BD_MSISDN_A ELSE NULL END) AS CLASS19_20,
 (CASE WHEN BD_AMOUNTCU BETWEEN 20.0001 AND 21 THEN BD_MSISDN_A ELSE NULL END) AS CLASS20_21,
 (CASE WHEN BD_AMOUNTCU BETWEEN 21.0001 AND 22 THEN BD_MSISDN_A ELSE NULL END) AS CLASS21_22,
 (CASE WHEN BD_AMOUNTCU BETWEEN 22.0001 AND 23 THEN BD_MSISDN_A ELSE NULL END) AS CLASS22_23,
 (CASE WHEN BD_AMOUNTCU BETWEEN 23.0001 AND 24 THEN BD_MSISDN_A ELSE NULL END) AS CLASS23_24,
 (CASE WHEN BD_AMOUNTCU BETWEEN 24.0001 AND 25 THEN BD_MSISDN_A ELSE NULL END) AS CLASS24_25,
 (CASE WHEN BD_AMOUNTCU BETWEEN 25.0001 AND 26 THEN BD_MSISDN_A ELSE NULL END) AS CLASS25_26,
 (CASE WHEN BD_AMOUNTCU BETWEEN 26.0001 AND 27 THEN BD_MSISDN_A ELSE NULL END) AS CLASS26_27,
 (CASE WHEN BD_AMOUNTCU BETWEEN 27.0001 AND 28 THEN BD_MSISDN_A ELSE NULL END) AS CLASS27_28,
 (CASE WHEN BD_AMOUNTCU BETWEEN 28.0001 AND 29 THEN BD_MSISDN_A ELSE NULL END) AS CLASS28_29,
 (CASE WHEN BD_AMOUNTCU BETWEEN 29.0001 AND 30 THEN BD_MSISDN_A ELSE NULL END) AS CLASS29_30,
 (CASE WHEN BD_AMOUNTCU > 30 THEN BD_MSISDN_A ELSE NULL END) AS CLASS30_
FROM
 BDETAIL,
 CONTRACT,
 ACCOUNT,
 STYPE
WHERE
  BDETAIL.BD_CONID = CONTRACT.CON_ID
 AND ACCOUNT.AC_ID = CONTRACT.CON_ACID
 AND NVL(STYPE.ST_ID,'0') = BDETAIL.BD_STYPE
 AND BDETAIL.BD_MAPSID = 'R'
 AND CON_ESTID IN ('BN','MVP')
 AND BD_DATETIME >= ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1)
 AND BD_DATETIME < TRUNC(sysdate,'MONTH')
 AND NVL(BD_CDRTID,'CTB-CO') = 'CTB-CO'
ORDER BY
 1, 2, 3;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR035A_DETAILS_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR035A_DETAILS_1
(SMSC, SMSCOUNT)
BEQUEATH DEFINER
AS 
SELECT
    SMSC_CODE,
    SUM(IWTC_COUNT)
FROM
    IWTCOUNTER,
    SMSC
WHERE
        IWTCOUNTER.IWTC_SMSCID = SMSC.SMSC_ID
    AND IWTC_DATE < trunc(sysdate,'MONTH')
    AND IWTC_DATE >= add_months(trunc(sysdate,'MONTH'),-1)
    AND SMSC_CONOPKEY_PROP = '9999'
GROUP BY
    SMSC_CODE
ORDER BY
    SMSC_CODE;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR035A_DETAILS_4  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR035A_DETAILS_4
(IMSI_PREFIX, DELIVERY_COUNT)
BEQUEATH DEFINER
AS 
SELECT
    SUBSTR(BD_IMSI,1,7), COUNT(*)
FROM
    BDETAIL2
WHERE
        BD_DATETIME >= add_months(trunc(sysdate,'MONTH'),-1)
    AND BD_DATETIME < add_months(trunc(sysdate,'MONTH'),-0)
    AND BD_MAPSID = 'R'
    AND BD_NPI_B = '1'
    AND BD_PID_B = '0'
    AND BD_STATUS = 0
    AND BD_IMSI NOT LIKE '22801%'
    AND BD_TOCID IS NULL
GROUP BY
    SUBSTR(BD_IMSI,1,7)
ORDER BY
    SUBSTR(BD_IMSI,1,7);


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR038A_BASE  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR038A_BASE
(PERIOD, APMN, HPMN, TOTAL_COUNT, HRR_COUNT, 
 CHARGEABLE_COUNT, PRICE, NET_AMOUNT, VAT, GROSS_AMOUNT, 
 CURRENCY, IWTC_BOHID1)
BEQUEATH DEFINER
AS 
SELECT
    PERIOD, APMN, HPMN, TOTAL_COUNT,
    HRR_COUNT, CHARGEABLE_COUNT, PRICE, NET_AMOUNT,
    VAT, GROSS_AMOUNT, CURRENCY, IWTC_BOHID1
FROM
  SR038A_BASE1
UNION ALL
SELECT
     TO_CHAR(ADD_MONTHS(SYSDATE,-1),'YYYYMM') PERIOD,
     SC.CON_CODE APMN,
     'CHEC1' HPMN,
     0 TOTAL_COUNT,
     0 HRR_COUNT,
     0 CHARGEABLE_COUNT,
     CIOTE_PRICE + 0.0  PRICE,
     0.0 NET_AMOUNT,
     0.0 VAT,
     0.0 GROSS_AMOUNT,
     CIOT_CURID CURRENCY,
     'none'
FROM
  CONTRACT PC,  -- physical contract (SMSC range owner)
  CONTRACT SC,  -- settlement contract
  CONIOT,
  CONIOTE
WHERE PC.CON_ETID = 'TOC'
  AND SC.CON_ETID = 'TOC'
  AND PC.CON_ESID = 'A'
  AND SC.CON_ESID = 'A'
  AND NVL(PC.CON_VIRTUAL,0) = 0
  AND NVL(SC.CON_VIRTUAL,0) = 0
  AND PC.CON_DATESTART < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
  AND (PC.CON_DATEEND > ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1) OR PC.CON_DATEEND IS NULL)
  AND SC.CON_DATESTART < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
  AND (SC.CON_DATEEND > ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1) OR SC.CON_DATEEND IS NULL)
  AND SC.CON_OPKEY = NVL(PC.CON_HUB,PC.CON_OPKEY)
  AND CIOT_ID = CIOTE_CIOTID
  AND CIOT_CONID = SC.CON_ID
  AND CIOT_TRCTID IN ('SMS')
  AND CIOT_IWDID IN ('TERM')
  AND NOT Exists (
  SELECT B.PERIOD, B.HPMN
  FROM SR038A_BASE1 B
  WHERE B.PERIOD = TO_CHAR(ADD_MONTHS(SYSDATE,-1),'YYYYMM')
  AND B.HPMN = SC.CON_CODE
  );


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR038A_BASE1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR038A_BASE1
(PERIOD, APMN, HPMN, TOTAL_COUNT, HRR_COUNT, 
 CHARGEABLE_COUNT, PRICE, NET_AMOUNT, VAT, GROSS_AMOUNT, 
 CURRENCY, IWTC_BOHID1)
BEQUEATH DEFINER
AS 
SELECT
     To_Char(IWTC_DATE,'YYYYMM') PERIOD,
     SC.CON_CODE APMN,
     'CHEC1' HPMN,
     IWTC_COUNT + NVL(IWTC_HRR_COUNT,0) TOTAL_COUNT,
     NVL(IWTC_HRR_COUNT,0) HRR_COUNT,
     IWTC_COUNT CHARGEABLE_COUNT,
     CIOTE_PRICE + 0.0  PRICE,
     IWTC_COUNT * Nvl(CIOTE_PRICE,0) NET_AMOUNT,
     0.01 * NVL(SC.CON_VATT,0.00) * IWTC_COUNT * Nvl(CIOTE_PRICE,0) VAT,
     (1.00 + 0.01 * NVL(SC.CON_VATT,0.00)) * IWTC_COUNT * Nvl(CIOTE_PRICE,0) GROSS_AMOUNT,
     CIOT_CURID Currency,
     IWTC_BOHID1
FROM
  IWTCOUNTER,
  SMSC,
  CONTRACT PC,  -- physical contract (SMSC range owner)
  CONTRACT SC,  -- settlement contract
  CONIOT,
  CONIOTE
WHERE
   IWTCOUNTER.IWTC_SMSCID = SMSC.SMSC_ID
  AND SMSC.SMSC_CONOPKEY = PC.CON_OPKEY
  AND PC.CON_ETID = 'TOC'
  AND SC.CON_ETID = 'TOC'
  AND PC.CON_ESID = 'A'
  AND SC.CON_ESID = 'A'
  AND NVL(PC.CON_VIRTUAL,0) = 0
  AND NVL(SC.CON_VIRTUAL,0) = 0
  AND IWTC_DATE >= PC.CON_DATESTART
  AND ((IWTC_DATE < PC.CON_DATEEND ) OR (PC.CON_DATEEND IS NULL))
  AND IWTC_DATE >= SC.CON_DATESTART
  AND ((IWTC_DATE < SC.CON_DATEEND ) OR (SC.CON_DATEEND IS NULL))
  AND IWTC_BOHID1 = (Select Max(IWTC_BOHID1) From IWTCOUNTER)
  AND SC.CON_OPKEY = NVL(PC.CON_HUB,PC.CON_OPKEY)
  AND CIOT_ID = CIOTE_CIOTID
  AND CIOT_CONID = SC.CON_ID
  AND CIOT_TRCTID IN ('SMS')
  AND CIOT_IWDID IN ('TERM');


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR038A_DETAILS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR038A_DETAILS
(PERIOD, APMN, HPMN, TOTAL_COUNT, HRR_COUNT, 
 CHARGEABLE_COUNT, PRICE, NET_AMOUNT, VAT, GROSS_AMOUNT, 
 CURRENCY, IWTC_BOHID1)
BEQUEATH DEFINER
AS 
SELECT
    PERIOD, APMN, HPMN, SUM(TOTAL_COUNT),
    SUM(HRR_COUNT), SUM(CHARGEABLE_COUNT), PRICE, SUM(NET_AMOUNT),
    SUM(VAT), SUM(GROSS_AMOUNT), CURRENCY, MIN(IWTC_BOHID1)
FROM SR038A_BASE
GROUP BY
    PERIOD,
    APMN,
    HPMN,
    PRICE,
    CURRENCY
ORDER BY
  PERIOD,
  APMN,
  PRICE,
  CURRENCY;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR039A_DETAILS_4  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR039A_DETAILS_4
(AC_NAME, ROC_CONSOLIDATION, CON_PSCALL, ADR_COUNTRY, AC_NAMETO, 
 CON_OPKEY, ROC_COUNT, ROC_IOT, ROC_IOT_INTERNAL)
BEQUEATH DEFINER
AS 
SELECT /*+ NO_INDEX (BDETAIL2) */
  AC_NAME,
  BD_CONSOLIDATION,
  CON_PSCALL,
  CAR_COUNTRY,
  CAR_OPNAME,
  BD_DELIVER_OPKEY,
  COUNT(*),
  SUM(BD_IOT),
  SUM(NVL(BD_IW_AMOUNT,0.0) - NVL(BD_IOT,0.00)) -- works for HUB currency = CHF only
FROM
  BDETAIL2,
  CONTRACT,
  ACCOUNT,
  CARRIER
WHERE BD_MAPSID = 'R'
  AND BD_DATETIME >= ADD_MONTHS(trunc(SYSDATE,'MONTH'),-1)
  AND BD_DATETIME < trunc(SYSDATE,'MONTH')
  AND BD_STATUS = 0
  AND BD_IW = '1'
  AND BD_IW_DIR = 'O'
  AND BD_IW_SCENARIO = '1'
  AND BD_IW_APMN = 'CHENS'
  AND BD_CDRTID NOT IN ('SMS-HR','SMS-EXT','PAGER-EXT')
  AND BD_CONSOLIDATION IS NOT NULL
  AND BD_CONID = CON_ID
  AND AC_ID = CON_ACID
  AND CAR_ID = NVL(BD_DELIVER_OPKEY,'28')
GROUP BY
  AC_NAME,
  BD_CONSOLIDATION,
  CON_PSCALL,
  CAR_COUNTRY,
  CAR_OPNAME,
  BD_DELIVER_OPKEY
ORDER BY
  AC_NAME,
  to_number(BD_CONSOLIDATION),
  CON_PSCALL,
  CAR_COUNTRY,
  CAR_OPNAME,
  BD_DELIVER_OPKEY;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR040A_DETAILS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR040A_DETAILS
(SHORTID, SMSCOUNT)
BEQUEATH DEFINER
AS 
SELECT /*+ NO_INDEX (BDETAIL2) */
 NVL(BD_ORIG_ESME_ID,'MO->MT'),
 COUNT(BD_DATETIME)
FROM
 BDETAIL2,
 SETPERIOD
WHERE BD_MAPSID = 'R'
 AND BD_NPI_B = '1'
 AND BD_PID_B = '0'
 AND BD_IMSI LIKE '22801%'
 AND BD_STATUS = 0
 AND BD_CDRTID NOT IN ('SMS-HR','SMS-EXT','PAGER-EXT')
 AND SEP_ID = TO_CHAR(ADD_MONTHS(SYSDATE,-1),'YYYYMM')
 AND BD_DATETIME < SEP_DATE2
 AND BD_DATETIME >= SEP_DATE1
 AND (BD_TARID NOT IN ('P','Q','R','S','T','U','V','W','X','Y','Z') OR BD_TARID IS NULL)
GROUP BY
 BD_ORIG_ESME_ID
ORDER BY TO_NUMBER(NVL(BD_ORIG_ESME_ID,0));


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR042A_DETAILS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR042A_DETAILS
(DATE1, DATE2, BD_SRCTYPE, BD_CONID, CON_ACNAME, 
 BD_TPID, CON_NAME, BD_SERVICE, BD_SHORTID, BD_BILLRATE, 
 BD_PRICE, BD_COUNT, BD_AMOUNTCU, BD_RETSHAREPV, BD_RETSHAREMO, 
 BD_PREPAID, BD_BILLTEXT)
BEQUEATH DEFINER
AS 
SELECT /*+ FULL (BDETAIL) */
	ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1) date1,
	TRUNC(SYSDATE,'MONTH') date2,
	BD_SRCTYPE bd_srctype,
	BD_CONID con_id,
	AC_NAME con_acname,
	BD_TPID, 
	NVL(CON_NAME,AC_NAME) con_name,
	BD_SERVICE bd_service,
	BD_SHORTID bd_shortid,
	BD_BILLRATE bd_billrate,
	BD_AMOUNTCU + 0.00 bd_price,
	COUNT(BDETAIL.ROWID) bd_count,
	SUM(BD_AMOUNTCU) bd_amountcu,
	SUM(BD_RETSHAREPV) bd_retsharepv,
	SUM(BD_RETSHAREMO) bd_retsharemo,
	DECODE(BD_PREPAID,'Y','Pre','N','Post','N.A.') BD_PREPAID,
	BD_BILLTEXT
FROM
	BDETAIL,
	CONTRACT,
	ACCOUNT
WHERE
		ACCOUNT.AC_ID = CONTRACT.CON_ACID
	AND	BDETAIL.BD_CONID = CONTRACT.CON_ID
	AND 	CON_ESTID IN ('BN')
	AND	BD_DATETIME >= ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1)
	AND	BD_DATETIME < TRUNC(SYSDATE,'MONTH')
	AND	BD_MAPSID NOT IN ('M','m')
    	AND 	NVL(BD_CDRTID,'CTB-CO') = 'CTB-CO'
GROUP BY
	BD_SRCTYPE,
	BD_CONID,
	AC_NAME,
	BD_TPID,
	NVL(CON_NAME,AC_NAME),
	BD_SERVICE,	
	BD_SHORTID,
	BD_BILLRATE,
	BD_AMOUNTCU,
	BD_PREPAID,
	BD_BILLTEXT
ORDER BY
	BD_SRCTYPE,
	BD_CONID,
	AC_NAME,
	BD_TPID,
	NVL(CON_NAME,AC_NAME),
	BD_SERVICE,	
	BD_SHORTID,
	BD_BILLRATE,
	BD_AMOUNTCU,
	BD_PREPAID,
	BD_BILLTEXT;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR043A_DETAILS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR043A_DETAILS
(DATE1, DATE2, BD_SRCTYPE, BD_CONID, CON_ACNAME, 
 BD_TPID, CON_NAME, BD_SERVICE, BD_SHORTID, BD_BILLRATE, 
 BD_PRICE, BD_COUNT, BD_AMOUNTCU, BD_RETSHAREPV, BD_RETSHAREMO, 
 BD_STYPE)
BEQUEATH DEFINER
AS 
SELECT /*+ FULL (BDETAIL) */
 ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1) date1,
 TRUNC(SYSDATE,'MONTH') date2,
 BD_SRCTYPE bd_srctype,
 BD_CONID con_id,
 AC_NAME con_acname,
 BD_TPID,
 NVL(CON_NAME,AC_NAME) con_name,
 BD_SERVICE bd_service,
 BD_SHORTID bd_shortid,
 BD_BILLRATE bd_billrate,
 BD_AMOUNTCU bd_price,
 COUNT(BDETAIL.ROWID) bd_count,
 SUM(BD_AMOUNTCU) bd_amountcu,
 SUM(BD_RETSHAREPV) bd_retsharepv,
 SUM(BD_RETSHAREMO) bd_retsharemo,
 ST_LANG01 BD_STYPE
FROM
 BDETAIL,
 CONTRACT,
 ACCOUNT,
 STYPE
WHERE
  ACCOUNT.AC_ID = CONTRACT.CON_ACID
 AND BDETAIL.BD_CONID = CONTRACT.CON_ID
 AND  CON_ESTID IN ('BN')
 AND BD_DATETIME >= ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1)
 AND BD_DATETIME < TRUNC(SYSDATE,'MONTH')
 AND BD_MAPSID NOT IN ('M','m')
 AND  BDETAIL.BD_STYPE = STYPE.ST_ID
 AND NVL(BD_CDRTID,'CTB-CO') = 'CTB-CO'
GROUP BY
 AC_NAME,
 BD_TPID,
 BD_SRCTYPE,
 BD_CONID,
 NVL(CON_NAME,AC_NAME),
 BD_SERVICE,
 BD_SHORTID,
 BD_AMOUNTCU,
 BD_BILLRATE,
 ST_LANG01
ORDER BY
 AC_NAME,
 BD_TPID,
 BD_SRCTYPE,
 BD_CONID,
 NVL(CON_NAME,AC_NAME),
 BD_SERVICE,
 BD_SHORTID,
 BD_AMOUNTCU,
 BD_BILLRATE,
 ST_LANG01;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR043A_DETAILS_MVP  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR043A_DETAILS_MVP
(DATE1, DATE2, BD_SRCTYPE, BD_CONID, CON_ACNAME, 
 BD_TPID, CON_NAME, BD_SERVICE, BD_SHORTID, BD_BILLRATE, 
 BD_PRICE, BD_COUNT, BD_AMOUNTCU, BD_RETSHAREPV, BD_RETSHAREMO, 
 BD_STYPE)
BEQUEATH DEFINER
AS 
SELECT /*+ FULL (BDETAIL) */
 ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1) date1,
 TRUNC(SYSDATE,'MONTH') date2,
 BD_SRCTYPE bd_srctype,
 BD_CONID con_id,
 AC_NAME con_acname,
 BD_TPID,
 NVL(CON_NAME,AC_NAME) con_name,
 BD_SERVICE bd_service,
 BD_SHORTID bd_shortid,
 BD_BILLRATE bd_billrate,
 BD_AMOUNTCU bd_price,
 COUNT(BDETAIL.ROWID) bd_count,
 SUM(BD_AMOUNTCU) bd_amountcu,
 SUM(BD_RETSHAREPV) bd_retsharepv,
 SUM(BD_RETSHAREMO) bd_retsharemo,
 ST_LANG01 BD_STYPE
FROM
 BDETAIL,
 CONTRACT,
 ACCOUNT,
 STYPE
WHERE
  ACCOUNT.AC_ID = CONTRACT.CON_ACID
 AND BDETAIL.BD_CONID = CONTRACT.CON_ID
 AND CON_ESTID IN ('MVP')
 AND BD_DATETIME >= ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1)
 AND BD_DATETIME < TRUNC(SYSDATE,'MONTH')
 AND BD_MAPSID NOT IN ('M','m')
 AND  BDETAIL.BD_STYPE = STYPE.ST_ID
 AND NVL(BD_CDRTID,'CTB-CO') = 'CTB-CO'
GROUP BY
 AC_NAME,
 BD_TPID,
 BD_SRCTYPE,
 BD_CONID,
 NVL(CON_NAME,AC_NAME),
 BD_SERVICE,
 BD_SHORTID,
 BD_AMOUNTCU,
 BD_BILLRATE,
 ST_LANG01
ORDER BY
 AC_NAME,
 BD_TPID,
 BD_SRCTYPE,
 BD_CONID,
 NVL(CON_NAME,AC_NAME),
 BD_SERVICE,
 BD_SHORTID,
 BD_AMOUNTCU,
 BD_BILLRATE,
 ST_LANG01;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR043A_DETAILS_SPENDEN  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR043A_DETAILS_SPENDEN
(DATE1, DATE2, BD_SRCTYPE, BD_CONID, CON_ACNAME, 
 BD_TPID, CON_NAME, BD_SERVICE, BD_SHORTID, BD_BILLRATE, 
 BD_PRICE, BD_COUNT, BD_AMOUNTCU, BD_RETSHAREPV, BD_RETSHAREMO, 
 BD_STYPE)
BEQUEATH DEFINER
AS 
SELECT /*+ FULL (BDETAIL) */
 ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1) date1,
 TRUNC(SYSDATE,'MONTH') date2,
 BD_SRCTYPE bd_srctype,
 BD_CONID con_id,
 AC_NAME con_acname,
 BD_TPID,
 NVL(CON_NAME,AC_NAME) con_name,
 BD_SERVICE bd_service,
 BD_SHORTID bd_shortid,
 BD_BILLRATE bd_billrate,
 BD_AMOUNTCU bd_price,
 COUNT(BDETAIL.ROWID) bd_count,
 SUM(BD_AMOUNTCU) bd_amountcu,
 SUM(BD_RETSHAREPV) bd_retsharepv,
 SUM(BD_RETSHAREMO) bd_retsharemo,
 ST_LANG01 BD_STYPE
FROM
 BDETAIL,
 CONTRACT,
 ACCOUNT,
 STYPE
WHERE
  ACCOUNT.AC_ID = CONTRACT.CON_ACID
 AND BDETAIL.BD_CONID = CONTRACT.CON_ID
 AND CON_ESTID IN ('BN')
 AND BD_GART = '82'
 AND BD_DATETIME >= ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1)
 AND BD_DATETIME < TRUNC(SYSDATE,'MONTH')
 AND BD_MAPSID NOT IN ('M','m')
 AND  BDETAIL.BD_STYPE = STYPE.ST_ID
 AND NVL(BD_CDRTID,'CTB-CO') = 'CTB-CO'
GROUP BY
 AC_NAME,
 BD_TPID,
 BD_SRCTYPE,
 BD_CONID,
 NVL(CON_NAME,AC_NAME),
 BD_SERVICE,
 BD_SHORTID,
 BD_AMOUNTCU,
 BD_BILLRATE,
 ST_LANG01
ORDER BY
 AC_NAME,
 BD_TPID,
 BD_SRCTYPE,
 BD_CONID,
 NVL(CON_NAME,AC_NAME),
 BD_SERVICE,
 BD_SHORTID,
 BD_AMOUNTCU,
 BD_BILLRATE,
 ST_LANG01;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR044A_DETAILS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR044A_DETAILS
(DATE1, DATE2, BD_SRCTYPE, BD_CONID, CON_ACNAME, 
 BD_TPID, CON_NAME, BD_SHORTID, BD_BILLRATE, BD_PRICE, 
 BD_COUNT, BD_AMOUNTCU, BD_RETSHAREPV, BD_RETSHAREMO, BD_PREPAID, 
 BD_BILLTEXT)
BEQUEATH DEFINER
AS 
SELECT /*+ FULL (BDETAIL) */
	ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1) date1,
	TRUNC(SYSDATE,'MONTH') date2,
	BD_SRCTYPE bd_srctype,
	BD_CONID con_id,
	AC_NAME con_acname,
   	BD_TPID, 
	NVL(CON_NAME,AC_NAME) con_name,
	BD_SHORTID bd_shortid,
	BD_BILLRATE bd_billrate,
   	BD_AMOUNTCU bd_price,
	COUNT(BDETAIL.ROWID) bd_count,
	SUM(BD_AMOUNTCU) bd_amountcu,
	SUM(BD_RETSHAREPV) bd_retsharepv,
	SUM(BD_RETSHAREMO) bd_retsharemo,
	DECODE(BD_PREPAID,'Y','Pre','N','Post','N.A.') BD_PREPAID,
	BD_BILLTEXT	
FROM
	BDETAIL,
	CONTRACT,
	ACCOUNT
WHERE
		ACCOUNT.AC_ID = CONTRACT.CON_ACID
	AND	BDETAIL.BD_CONID = CONTRACT.CON_ID
	AND 	CON_ESTID = 'WCB'
	AND	BD_DATETIME >= ADD_MONTHS(TRUNC(sysdate,'MONTH'),-1)
	AND	BD_DATETIME < TRUNC(SYSDATE,'MONTH')
	AND	BD_MAPSID NOT IN ('M','m')
	AND 	NVL(BD_CDRTID,'CTB-CO') = 'CTB-CO'
GROUP BY
	BD_SRCTYPE,
	BD_CONID,
	AC_NAME,
    BD_TPID,
	NVL(CON_NAME,AC_NAME),	
	BD_SHORTID,
	BD_BILLRATE,
	BD_AMOUNTCU,
	BD_PREPAID,
	BD_BILLTEXT
ORDER BY
	BD_SRCTYPE,
	BD_CONID,
	AC_NAME,
    BD_TPID,
	NVL(CON_NAME,AC_NAME),	
	BD_SHORTID,
	BD_BILLRATE,
	BD_AMOUNTCU,
	BD_PREPAID,
	BD_BILLTEXT;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR054A_DETAILS_3  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR054A_DETAILS_3
(REVAH_PACID, REVAC_DATE, REVAH_DESC, CDR_COUNT, CDR_ZEROCOUNT, 
 CDR_ZEROPERCENT, CDR_LEGALCOUNT, CDR_LEGALPERCENT)
BEQUEATH DEFINER
AS 
select
    revah_pacid,
    revac_date,
    revah_desc,
    sum(CDR_OUTCOUNT),
    sum(CDR_ZEROCOUNT),
    sum(CDR_ZEROCOUNT) / (sum(CDR_OUTCOUNT)+0.000001),
    sum(CDR_LEGALCOUNT),
    sum(CDR_LEGALCOUNT) / (sum(CDR_OUTCOUNT)+0.000001)
from SR054A_DETAILS_3_base
group by
    revah_pacid,
    revac_date,
    revah_desc
order by 1,2;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR054A_DETAILS_3_BASE  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR054A_DETAILS_3_BASE
(REVAH_PACID, REVAC_DATE, REVAH_DESC, CDR_OUTCOUNT, REVAH_SRCTYPE, 
 CDR_ZEROCOUNT, CDR_LEGALCOUNT)
BEQUEATH DEFINER
AS 
select
    revah_pacid,
    revac_date,
    pac_name REVAH_DESC,
    sum(revac_out) CDR_OUTCOUNT,
    REVAH_SRCTYPE,
    SUM(DECODE(REVASM_ETID,'ZEROBILLED',REVAC_OUT,0)) CDR_ZEROCOUNT,
    SUM(DECODE(REVASM_ETID,'LEGAL',REVAC_OUT,0)) CDR_LEGALCOUNT
from reva_header, reva_sigmask, reva_counter, packing
where revah_id = revasm_revahid
and revasm_id = revac_revasmid
and pac_id = REVAH_PACID
and revac_date >= trunc(add_months(sysdate,-1),'MONTH')
and revac_date < trunc(sysdate,'MONTH')
group by
    revah_pacid,
    REVAH_SRCTYPE,
    revac_date,
    pac_name;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR054A_DETAILS_3_BASE_ROLL  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR054A_DETAILS_3_BASE_ROLL
(REVAH_PACID, REVAC_DATE, REVAH_DESC, CDR_OUTCOUNT, REVAH_SRCTYPE, 
 CDR_ZEROCOUNT, CDR_LEGALCOUNT)
BEQUEATH DEFINER
AS 
select
    revah_pacid,
    revac_date,
    pac_name REVAH_DESC,
    sum(revac_out) CDR_OUTCOUNT,
    REVAH_SRCTYPE,
    SUM(DECODE(REVASM_ETID,'ZEROBILLED',REVAC_OUT,0)) CDR_ZEROCOUNT,
    SUM(DECODE(REVASM_ETID,'LEGAL',REVAC_OUT,0)) CDR_LEGALCOUNT
from reva_header, reva_sigmask, reva_counter, packing
where revah_id = revasm_revahid
and revasm_id = revac_revasmid
and pac_id = REVAH_PACID
and revac_date >= trunc(sysdate)-30
and revac_date < trunc(sysdate)
group by
    revah_pacid,
    REVAH_SRCTYPE,
    revac_date,
    pac_name;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR054A_DETAILS_3_ROLL  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR054A_DETAILS_3_ROLL
(REVAH_PACID, REVAC_DATE, REVAH_DESC, CDR_COUNT, CDR_ZEROCOUNT, 
 CDR_ZEROPERCENT, CDR_LEGALCOUNT, CDR_LEGALPERCENT)
BEQUEATH DEFINER
AS 
select
    revah_pacid,
    revac_date,
    revah_desc,
    sum(CDR_OUTCOUNT),
    sum(CDR_ZEROCOUNT),
    sum(CDR_ZEROCOUNT) / (sum(CDR_OUTCOUNT)+0.000001),
    sum(CDR_LEGALCOUNT),
    sum(CDR_LEGALCOUNT) / (sum(CDR_OUTCOUNT)+0.000001)
from SR054A_DETAILS_3_base_roll
group by
    revah_pacid,
    revac_date,
    revah_desc
order by 1,2;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR074_BASE  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR074_BASE
(BD_TOCID, BD_OUTID, BD_TRCLASS, BD_INT, BD_IW, 
 BD_BILLED, BD_SHORTID, BD_MMSRZID1, BD_MMSRZID2, BD_MMSDZID, 
 RECCOUNT, AMOUNTCU, VOLUME, IOT, MSGID)
BEQUEATH DEFINER
AS 
SELECT
	BD_TOCID,
	BD_OUTID,
	BD_TRCLASS,
	BD_INT,
	BD_IW,
	BD_BILLED,
	BD_SHORTID,
	BD_MMSRZID1,
	BD_MMSRZID2,
	BD_MMSDZID,
	COUNT(*) as RECCOUNT,
	SUM(BD_AMOUNTCU) AS AMOUNTCU,
	SUM(BD_LENGTH) AS VOLUME,
	SUM(BD_IOT) AS IOT,
	MIN(BD_UMSGGRPID) AS MSGID
FROM
	BDETAIL6
WHERE
		BD_DATETIME >= to_date('01.06.2009','dd.mm.yyyy')
	AND	BD_MAPSID = 'R'
	AND	BD_CDRRECTYPE = 'MM4Rrecord'
	AND	BD_EVENTDISP = 1
	AND	BD_MSGTYPE = 0
	AND	BD_DATETIME < to_date('01.07.2009','dd.mm.yyyy')
GROUP BY 
	BD_TOCID,
	BD_OUTID,
	BD_TRCLASS,
	BD_INT,
	BD_IW,
	BD_BILLED,
	BD_SHORTID,
	BD_MMSRZID1,
	BD_MMSRZID2,
	BD_MMSDZID;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR075A_BASE_6  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR075A_BASE_6
(BD_SHORTID, BD_TRANSPORTMEDIUM, BD_COUNT, BD_ZEROCOUNT_BN, BD_ZEROCOUNT_OTHER)
BEQUEATH DEFINER
AS 
SELECT /*+ NO_INDEX (BDETAIL) */
        BD_SHORTID,
        DECODE(SUBSTR(BD_SERVICE,1,7),'MMS-BLK','MMS BULK',BD_TRANSPORTMEDIUM),
        COUNT(*),
        SUM(DECODE(BD_CONSTID,'BN',DECODE(BD_AMOUNTCU,0.0,1,0),'MVP',DECODE(BD_AMOUNTCU,0.0,1,0),0)),
        SUM(DECODE(BD_CONSTID,'BN',0,DECODE(BD_AMOUNTCU,0.0,1,0),'MVP',0,DECODE(BD_AMOUNTCU,0.0,1,0)))
FROM    BDETAIL
WHERE   BD_DATETIME >= add_months(trunc(sysdate,'MONTH'),-1)
AND     BD_DATETIME < add_months(trunc(sysdate,'MONTH'),0)
AND         BD_MAPSID = 'R'
AND         BD_BILLED <> '0'
AND         BD_RATED = '1'
AND         BD_SRCTYPE IN ('ISRV','OTA')
AND         BD_SHORTID is not NULL
AND         BD_DEMO = 0
GROUP BY
        BD_SHORTID,
        DECODE(SUBSTR(BD_SERVICE,1,7),'MMS-BLK','MMS BULK',BD_TRANSPORTMEDIUM);


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR075A_BASE_7  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR075A_BASE_7
(SHORTID, TRANSPORTMEDIUM, MATCH_COUNT, MATCH_AMOUNT, MISS_COUNT, 
 MISS_PCT, MISS_AMOUNT, UNDER_COUNT, UNDER_AMOUNT, OVER_COUNT, 
 OVER_AMOUNT)
BEQUEATH DEFINER
AS 
SELECT /*+ NO_INDEX (BDETAIL) */ 
   SHORTID,
   SUBSTR(TABLE_SLAVE,4),
   COUNT(*),
   SUM(BD_AMOUNTCU),
   SUM(MISS_COUNT),
   SUM(MISS_COUNT)/COUNT(*),
   SUM(DECODE(MISS_COUNT,0,0.00,BD_AMOUNTCU)),
   SUM(DECODE(SIGN(BD_AMOUNTCU-CHARGED_AMOUNT),1,1,0)),
   SUM(DECODE(SIGN(BD_AMOUNTCU-CHARGED_AMOUNT),1,BD_AMOUNTCU-CHARGED_AMOUNT,0.0)),
   SUM(DECODE(SIGN(BD_AMOUNTCU-CHARGED_AMOUNT),-1,1,0)),
   SUM(DECODE(SIGN(BD_AMOUNTCU-CHARGED_AMOUNT),-1,CHARGED_AMOUNT-BD_AMOUNTCU,0.0))
FROM    BDETAIL, SR075A_BASE_7A
WHERE BDETAIL.ROWID = SR075A_BASE_7A.TABLE_ROWID_MASTER
GROUP BY
   SHORTID,
   SUBSTR(TABLE_SLAVE,4)

UNION ALL
SELECT
	SHORTID,
	SUBSTR(TABLE_SLAVE,4),
	0,
	0.00,
	0,
	0.00,
	0.00,
	0,
	0.00,
	MISS_COUNT,
	CHARGED_AMOUNT
FROM
	SR075A_BASE_7B

UNION ALL
SELECT
	SHORTID,
	SUBSTR(TABLE_SLAVE,4),
	0,
	0.00,
	0,
	0.00,
	0.00,
	0,
	0.00,
	MISS_COUNT,
	CHARGED_AMOUNT
FROM
	SR075A_BASE_7C;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR075A_DETAILS_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR075A_DETAILS_1
(REVICS_SHORTID, REVICS_MEDIUM, REVICS_COUNT_MASTER, BD_AMOUNTCU, REVICS_COUNT_MISSING, 
 REVICS_FRACTION_MISSING, REVICS_COUNT_MULTIPLES, REVICS_FRACTION_MULTIPLES)
BEQUEATH DEFINER
AS 
SELECT
	REVICS_SHORTID,
	DECODE(REVICS_TABLE_SLAVE,'BDETAIL1','SMS','BDETAIL6','MMS','MMS BULK'),
	COUNT(*),
	SUM(BD_AMOUNTCU),
	SUM(DECODE(REVICS_COUNT_MATCHING,-1.0,1,0)),
	SUM(DECODE(REVICS_COUNT_MATCHING,-1.0,1,0))/COUNT(*),	
	SUM(DECODE(REVICS_COUNT_MATCHING,1.0,1,0)),
	SUM(DECODE(REVICS_COUNT_MATCHING,1.0,1,0))/COUNT(*)	
FROM
	SR075A_BASE_1A, BDETAIL
WHERE BDETAIL.ROWID = SR075A_BASE_1A.REVICS_ROWID_MASTER
GROUP BY
	REVICS_SHORTID,
	REVICS_TABLE_SLAVE
ORDER BY
	to_number(REVICS_SHORTID),
	2;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR075A_DETAILS_6  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR075A_DETAILS_6
(BD_SHORTID, BD_TRANSPORTMEDIUM, BD_COUNT, BD_ZEROCOUNT_BN, BD_ZEROPERC_BN, 
 BD_ZEROCOUNT_OTHER, BD_ZEROPERC_OTHER)
BEQUEATH DEFINER
AS 
SELECT
   bd_shortid,
   bd_transportmedium,
   bd_count,
   bd_zerocount_bn,
   bd_zerocount_bn/(bd_count+0.000001),
   bd_zerocount_other,
   bd_zerocount_other/(bd_count+0.000001)
FROM    SR075A_BASE_6
ORDER BY
    to_number(bd_shortid),
    2;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR075A_DETAILS_7  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR075A_DETAILS_7
(SHORTID, TRANSPORTMEDIUM, MATCH_COUNT, MATCH_AMOUNT, MISS_COUNT, 
 MISS_PCT, MISS_AMOUNT, UNDER_COUNT, UNDER_AMOUNT, OVER_COUNT, 
 OVER_AMOUNT)
BEQUEATH DEFINER
AS 
SELECT
    SHORTID,
    TRANSPORTMEDIUM,
    SUM(MATCH_COUNT),
    SUM(MATCH_AMOUNT),
    SUM(MISS_COUNT),
    SUM(MISS_PCT),
    SUM(MISS_AMOUNT),
    SUM(UNDER_COUNT),
    SUM(UNDER_AMOUNT),
    SUM(OVER_COUNT),
    SUM(OVER_AMOUNT)
FROM  SR075A_BASE_7
GROUP BY
    SHORTID,
    TRANSPORTMEDIUM
ORDER BY
    to_number(SHORTID),
    2;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR076A_BASE  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR076A_BASE
(BD_DATETIME, BD_SERVICE, BD_MSISDN_A, BD_REQTYPE, BD_BILLTEXT, 
 BD_BILLRATE, BD_AMOUNTCU, BD_RETSHAREPV, BD_RETSHAREMO, BD_PREPAID, 
 BD_STYPE, BD_TPID, BD_CONSTID, BD_BILLINGDOMAIN, BD_TRANSPORTMEDIUM, 
 BD_CONID, BD_SHORTID, BD_PMVID, BD_KEYWORD, BD_BILLTIME, 
 BD_MSGID, BD_AAATS, BD_ERRID, BD_BILLED, BD_RATED, 
 BD_PACIDHB, BD_OUTPUTHB, BD_CATEGORY, BD_TAXRATE, BD_REQUESTID)
BEQUEATH DEFINER
AS 
SELECT /*+ NO_INDEX (BDETAIL) */
 	BD_DATETIME,
	BD_SERVICE,
	BD_MSISDN_A,
	BD_REQTYPE,
	BD_BILLTEXT,
	BD_BILLRATE,
	BD_AMOUNTCU,
	BD_RETSHAREPV,
	BD_RETSHAREMO,
	BD_PREPAID,
	BD_STYPE,
	BD_TPID,
	BD_CONSTID,
	BD_BILLINGDOMAIN,
	BD_TRANSPORTMEDIUM,
	BD_CONID,
	BD_SHORTID,
	BD_PMVID,
	BD_KEYWORD,
	BD_BILLTIME,
	BD_MSGID,
	BD_AAATS,
	BD_ERRID,
	BD_BILLED,
	BD_RATED,
	BD_PACIDHB,
	BD_OUTPUTHB,
	BD_CATEGORY,
	BD_TAXRATE,
	BD_REQUESTID
FROM
	BDETAIL
WHERE
		BD_DEMO IN (0)
	AND	BD_MAPSID IN ('R')
	AND	BD_DATETIME < trunc(sysdate)
	AND	BD_DATETIME < add_months(trunc(sysdate,'MONTH'),0)
	AND	BD_DATETIME >= add_months(trunc(sysdate,'MONTH'),-1)
	AND     BD_SHORTID IN ('888','88801','88802') 
        AND	BD_CDRTID = 'CTB-CO';


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR076A_BASE_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR076A_BASE_1
(BD_MSISDN_A, COUNT_MT_2_5, COUNT_MT_10_0, COUNT_MT_0, COUNT_MT_OTHER, 
 COUNT_MO_0, COUNT_MO_OTHER, BD_AMOUNTCU, COUNT_OTHER, COUNT_ALL)
BEQUEATH DEFINER
AS 
SELECT   BD_MSISDN_A,   DECODE(BD_REQTYPE,4,DECODE(BD_AMOUNTCU,2.5,1,0),0),   DECODE(BD_REQTYPE,4,DECODE(BD_AMOUNTCU,10.0,1,0),0),   DECODE(BD_REQTYPE,4,DECODE(BD_AMOUNTCU,0.0,1,0),0),   DECODE(BD_REQTYPE,4,DECODE(BD_AMOUNTCU,0.0,0,2.5,0,10.0,0,1),0),   DECODE(BD_REQTYPE,0,DECODE(BD_AMOUNTCU,0.0,1,0),0),   DECODE(BD_REQTYPE,0,DECODE(BD_AMOUNTCU,0.0,0,2.5,0,10.0,0,1),0),   BD_AMOUNTCU,   DECODE(BD_REQTYPE,0,0,4,0,1),   1  FROM   SR076A_BASE;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR076A_DETAILS_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR076A_DETAILS_1
(BD_MSISDN_A, COUNT_MT_2_5, COUNT_MT_10_0, COUNT_MT_0, COUNT_MT_OTHER, 
 COUNT_MO_0, COUNT_MO_OTHER, BD_AMOUNTCU, COUNT_OTHER, COUNT_ALL)
BEQUEATH DEFINER
AS 
SELECT
    BD_MSISDN_A,
    SUM(COUNT_MT_2_5),
    SUM(COUNT_MT_10_0),
    SUM(COUNT_MT_0),
    SUM(COUNT_MT_OTHER),
    SUM(COUNT_MO_0),
    SUM(COUNT_MO_OTHER),
    SUM(BD_AMOUNTCU),
    SUM(COUNT_OTHER),
    SUM(COUNT_ALL)
FROM   SR076A_BASE_1
WHERE BD_MSISDN_A IN (SELECT DISTINCT BD_MSISDN_A FROM SR076A_BASE WHERE BD_AMOUNTCU = 10.0000)
GROUP BY   BD_MSISDN_A
ORDER BY   BD_MSISDN_A;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR076A_DETAILS_2  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR076A_DETAILS_2
(BD_MSISDN_A, COUNT_MT_2_5, COUNT_MT_10_0, COUNT_MT_0, COUNT_MT_OTHER, 
 COUNT_MO_0, COUNT_MO_OTHER, BD_AMOUNTCU, COUNT_OTHER, COUNT_ALL)
BEQUEATH DEFINER
AS 
SELECT
    BD_MSISDN_A,
    SUM(COUNT_MT_2_5),
    SUM(COUNT_MT_10_0),
    SUM(COUNT_MT_0),
    SUM(COUNT_MT_OTHER),
    SUM(COUNT_MO_0),
    SUM(COUNT_MO_OTHER),
    SUM(BD_AMOUNTCU),
    SUM(COUNT_OTHER),
    SUM(COUNT_ALL)
FROM   SR076A_BASE_1
WHERE BD_MSISDN_A NOT IN (SELECT DISTINCT BD_MSISDN_A FROM SR076A_BASE WHERE BD_AMOUNTCU = 10.0000)
GROUP BY   BD_MSISDN_A
ORDER BY   BD_MSISDN_A;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR076A_DETAILS_3  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR076A_DETAILS_3
(BD_DATETIME, BD_SERVICE, BD_MSISDN_A, BD_REQTYPE, BD_BILLTEXT, 
 BD_BILLRATE, BD_AMOUNTCU, BD_RETSHAREPV, BD_RETSHAREMO, BD_PREPAID, 
 BD_STYPE, BD_TPID, BD_CONSTID, BD_BILLINGDOMAIN, BD_TRANSPORTMEDIUM, 
 BD_CONID, BD_SHORTID, BD_PMVID, BD_KEYWORD, BD_BILLTIME, 
 BD_MSGID, BD_AAATS, BD_ERRID, BD_BILLED, BD_RATED, 
 BD_PACIDHB, BD_OUTPUTHB, BD_CATEGORY, BD_TAXRATE, BD_REQUESTID)
BEQUEATH DEFINER
AS 
SELECT
    BD_DATETIME,
    BD_SERVICE,
    BD_MSISDN_A,
    DECODE(BD_REQTYPE,0,'MO','MT'),   BD_BILLTEXT,
    BD_BILLRATE,
    BD_AMOUNTCU + 0.0,
    NULL BD_RETSHAREPV,
    NULL BD_RETSHAREMO,
    BD_PREPAID,
    NULL BD_STYPE,
    NULL BD_TPID,
    NULL BD_CONSTID,
    NULL BD_BILLINGDOMAIN,
    NULL BD_TRANSPORTMEDIUM,
    NULL BD_CONID,
    BD_SHORTID,
    NULL BD_PMVID,
    NULL BD_KEYWORD,
    NULL BD_BILLTIME,
    NULL BD_MSGID,
    NULL BD_AAATS,
    NULL BD_ERRID,
    BD_BILLED,
    BD_RATED,
    NULL BD_PACIDHB,
    NULL BD_OUTPUTHB,
    NULL BD_CATEGORY,
    NULL BD_TAXRATE,
    NULL BD_REQUESTID
FROM   SR076A_BASE
WHERE SUBSTR(BD_MSISDN_A,-1,1) IN ('0','1')
AND BD_AMOUNTCU <> 0;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR076A_DETAILS_4  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR076A_DETAILS_4
(BD_DATETIME, BD_SERVICE, BD_MSISDN_A, BD_REQTYPE, BD_BILLTEXT, 
 BD_BILLRATE, BD_AMOUNTCU, BD_RETSHAREPV, BD_RETSHAREMO, BD_PREPAID, 
 BD_STYPE, BD_TPID, BD_CONSTID, BD_BILLINGDOMAIN, BD_TRANSPORTMEDIUM, 
 BD_CONID, BD_SHORTID, BD_PMVID, BD_KEYWORD, BD_BILLTIME, 
 BD_MSGID, BD_AAATS, BD_ERRID, BD_BILLED, BD_RATED, 
 BD_PACIDHB, BD_OUTPUTHB, BD_CATEGORY, BD_TAXRATE, BD_REQUESTID)
BEQUEATH DEFINER
AS 
SELECT
    BD_DATETIME,
    BD_SERVICE,
    BD_MSISDN_A,
    DECODE(BD_REQTYPE,0,'MO','MT'),   BD_BILLTEXT,
    BD_BILLRATE,
    BD_AMOUNTCU + 0.0,
    NULL BD_RETSHAREPV,
    NULL BD_RETSHAREMO,
    BD_PREPAID,
    NULL BD_STYPE,
    NULL BD_TPID,
    NULL BD_CONSTID,
    NULL BD_BILLINGDOMAIN,
    NULL BD_TRANSPORTMEDIUM,
    NULL BD_CONID,
    BD_SHORTID,
    NULL BD_PMVID,
    NULL BD_KEYWORD,
    NULL BD_BILLTIME,
    NULL BD_MSGID,
    NULL BD_AAATS,
    NULL BD_ERRID,
    BD_BILLED,
    BD_RATED,
    NULL BD_PACIDHB,
    NULL BD_OUTPUTHB,
    NULL BD_CATEGORY,
    NULL BD_TAXRATE,
    NULL BD_REQUESTID
FROM   SR076A_BASE
WHERE SUBSTR(BD_MSISDN_A,-1,1) IN ('2','3')
AND BD_AMOUNTCU <> 0;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR076A_DETAILS_5  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR076A_DETAILS_5
(BD_DATETIME, BD_SERVICE, BD_MSISDN_A, BD_REQTYPE, BD_BILLTEXT, 
 BD_BILLRATE, BD_AMOUNTCU, BD_RETSHAREPV, BD_RETSHAREMO, BD_PREPAID, 
 BD_STYPE, BD_TPID, BD_BILLINGDOMAIN, BD_CONSTID, BD_TRANSPORTMEDIUM, 
 BD_CONID, BD_SHORTID, BD_PMVID, BD_KEYWORD, BD_BILLTIME, 
 BD_MSGID, BD_AAATS, BD_ERRID, BD_BILLED, BD_RATED, 
 BD_PACIDHB, BD_OUTPUTHB, BD_CATEGORY, BD_TAXRATE, BD_REQUESTID)
BEQUEATH DEFINER
AS 
SELECT
    BD_DATETIME,
    BD_SERVICE,
    BD_MSISDN_A,
    DECODE(BD_REQTYPE,0,'MO','MT'),   BD_BILLTEXT,
    BD_BILLRATE,
    BD_AMOUNTCU + 0.0,
    NULL BD_RETSHAREPV,
    NULL BD_RETSHAREMO,
    BD_PREPAID,
    NULL BD_STYPE,
    NULL BD_TPID,
    NULL BD_CONSTID,
    NULL BD_BILLINGDOMAIN,
    NULL BD_TRANSPORTMEDIUM,
    NULL BD_CONID,
    BD_SHORTID,
    NULL BD_PMVID,
    NULL BD_KEYWORD,
    NULL BD_BILLTIME,
    NULL BD_MSGID,
    NULL BD_AAATS,
    NULL BD_ERRID,
    BD_BILLED,
    BD_RATED,
    NULL BD_PACIDHB,
    NULL BD_OUTPUTHB,
    NULL BD_CATEGORY,
    NULL BD_TAXRATE,
    NULL BD_REQUESTID
FROM   SR076A_BASE
WHERE SUBSTR(BD_MSISDN_A,-1,1) IN ('4','5')
AND BD_AMOUNTCU <> 0;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR076A_DETAILS_6  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR076A_DETAILS_6
(BD_DATETIME, BD_SERVICE, BD_MSISDN_A, BD_REQTYPE, BD_BILLTEXT, 
 BD_BILLRATE, BD_AMOUNTCU, BD_RETSHAREPV, BD_RETSHAREMO, BD_PREPAID, 
 BD_STYPE, BD_TPID, BD_CONSTID, BD_BILLINGDOMAIN, BD_TRANSPORTMEDIUM, 
 BD_CONID, BD_SHORTID, BD_PMVID, BD_KEYWORD, BD_BILLTIME, 
 BD_MSGID, BD_AAATS, BD_ERRID, BD_BILLED, BD_RATED, 
 BD_PACIDHB, BD_OUTPUTHB, BD_CATEGORY, BD_TAXRATE, BD_REQUESTID)
BEQUEATH DEFINER
AS 
SELECT
    BD_DATETIME,
    BD_SERVICE,
    BD_MSISDN_A,
    DECODE(BD_REQTYPE,0,'MO','MT'),   BD_BILLTEXT,
    BD_BILLRATE,
    BD_AMOUNTCU + 0.0,
    NULL BD_RETSHAREPV,
    NULL BD_RETSHAREMO,
    BD_PREPAID,
    NULL BD_STYPE,
    NULL BD_TPID,
    NULL BD_CONSTID,
    NULL BD_BILLINGDOMAIN,
    NULL BD_TRANSPORTMEDIUM,
    NULL BD_CONID,
    BD_SHORTID,
    NULL BD_PMVID,
    NULL BD_KEYWORD,
    NULL BD_BILLTIME,
    NULL BD_MSGID,
    NULL BD_AAATS,
    NULL BD_ERRID,
    BD_BILLED,
    BD_RATED,
    NULL BD_PACIDHB,
    NULL BD_OUTPUTHB,
    NULL BD_CATEGORY,
    NULL BD_TAXRATE,
    NULL BD_REQUESTID
FROM   SR076A_BASE
WHERE SUBSTR(BD_MSISDN_A,-1,1) IN ('6','7')
AND BD_AMOUNTCU <> 0;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR076A_DETAILS_7  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR076A_DETAILS_7
(BD_DATETIME, BD_SERVICE, BD_MSISDN_A, BD_REQTYPE, BD_BILLTEXT, 
 BD_BILLRATE, BD_AMOUNTCU, BD_RETSHAREPV, BD_RETSHAREMO, BD_PREPAID, 
 BD_STYPE, BD_TPID, BD_CONSTID, BD_BILLINGDOMAIN, BD_TRANSPORTMEDIUM, 
 BD_CONID, BD_SHORTID, BD_PMVID, BD_KEYWORD, BD_BILLTIME, 
 BD_MSGID, BD_AAATS, BD_ERRID, BD_BILLED, BD_RATED, 
 BD_PACIDHB, BD_OUTPUTHB, BD_CATEGORY, BD_TAXRATE, BD_REQUESTID)
BEQUEATH DEFINER
AS 
SELECT
    BD_DATETIME,
    BD_SERVICE,
    BD_MSISDN_A,
    DECODE(BD_REQTYPE,0,'MO','MT'),   BD_BILLTEXT,
    BD_BILLRATE,
    BD_AMOUNTCU + 0.0,
    NULL BD_RETSHAREPV,
    NULL BD_RETSHAREMO,
    BD_PREPAID,
    NULL BD_STYPE,
    NULL BD_TPID,
    NULL BD_CONSTID,
    NULL BD_BILLINGDOMAIN,
    NULL BD_TRANSPORTMEDIUM,
    NULL BD_CONID,
    BD_SHORTID,
    NULL BD_PMVID,
    NULL BD_KEYWORD,
    NULL BD_BILLTIME,
    NULL BD_MSGID,
    NULL BD_AAATS,
    NULL BD_ERRID,
    BD_BILLED,
    BD_RATED,
    NULL BD_PACIDHB,
    NULL BD_OUTPUTHB,
    NULL BD_CATEGORY,
    NULL BD_TAXRATE,
    NULL BD_REQUESTID
FROM   SR076A_BASE
WHERE SUBSTR(BD_MSISDN_A,-1,1) IN ('8','9')
AND BD_AMOUNTCU <> 0;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR078A_DETAILS_N  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR078A_DETAILS_N
(STARTDATETIME, ACCOUNT_DATE, CALLING_NR, CALLED_NR, CHARGE, 
 REQUEST_ID, BILL_RATE)
BEQUEATH DEFINER
AS 
SELECT TO_CHAR (STARTDATETIME, 'yyyymmddhh24miss'),
          TO_CHAR (ACCOUNT_DATE, 'yyyymmddhh24miss'),
          NVL (SHORT_ID,
               SUBSTR (CALLING_NR, 11, INSTR (CALLING_NR, '-', 11) - 11)),
          SUBSTR (CALLED_NR, 3),
          TRIM (TO_CHAR (0.001 * UNIT, '99990.000')),
          REQUEST_ID,
          CASE
             WHEN (SEQ_NR IN (0, 1, 2, 3))
             THEN
                DECODE (BILL_RATE,  0, 0,  999, NULL,  BILL_RATE)
             ELSE
                NULL
          END
     FROM PPB_CDRSMS
    WHERE     ACCOUNT_DATE <
                 TO_DATE ('02.05.2010', 'dd.mm.yyyy') + 1 + 0.5 / 24
          AND ACCOUNT_DATE >= TO_DATE ('02.05.2010', 'dd.mm.yyyy') + 0.5 / 24
          AND CALLTYPE = 120
          AND SUBSTR (CALLING_NR, 6, 5) IN ('-SUB-', '-DEL-')
   UNION ALL
   SELECT TO_CHAR (STARTDATETIME, 'yyyymmddhh24miss'),
          TO_CHAR (ACCOUNT_DATE, 'yyyymmddhh24miss'),
          SHORT_ID,
          SUBSTR (CALLED_NR, 3),
          TRIM (TO_CHAR (0.001 * UNIT, '99990.000')),
          REQUEST_ID,
          DECODE (BILL_RATE,  0, 0,  999, NULL,  BILL_RATE)
     FROM PPB_CDRMMS
    WHERE     ACCOUNT_DATE <
                 TO_DATE ('02.05.2010', 'dd.mm.yyyy') + 1 + 0.5 / 24
          AND ACCOUNT_DATE >= TO_DATE ('02.05.2010', 'dd.mm.yyyy') + 0.5 / 24
          AND CALLTYPE = 121
          AND SUBSTR (CALLING_NR, 6, 5) IN ('-SUB-', '-DEL-', '-BLK-')
   UNION ALL
   SELECT TO_CHAR (STARTDATETIME, 'yyyymmddhh24miss'),
          TO_CHAR (ACCOUNT_DATE, 'yyyymmddhh24miss'),
          SUBSTR (CALLING_NR, 11, INSTR (CALLING_NR, '-', 11) - 11),
          SUBSTR (CALLED_NR, 3),
          TRIM (TO_CHAR (0.001 * UNIT, '99990.000')),
          NULL,
          NULL
     FROM PPB_CDRSMS
    WHERE     ACCOUNT_DATE <
                 TO_DATE ('02.05.2010', 'dd.mm.yyyy') + 1 + 0.5 / 24
          AND ACCOUNT_DATE >= TO_DATE ('02.05.2010', 'dd.mm.yyyy') + 0.5 / 24
          AND CALLTYPE = 24
          AND SUBSTR (CALLING_NR, 6, 5) IN ('-SUB-', '-DEL-', '-BLK-');


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR078A_DETAILS_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR078A_DETAILS_1
(DUMMY, STARTDATETIME, ACCOUNT_DATE, CALLING_NR, CALLED_NR, 
 CHARGE, REQUEST_ID, BILL_RATE)
BEQUEATH DEFINER
AS 
SELECT
    'DUMMY',
	to_char(STARTDATETIME,'yyyymmddhh24miss'),
    to_char(ACCOUNT_DATE,'yyyymmddhh24miss'),
    NVL(SHORT_ID,SUBSTR(CALLING_NR,11,INSTR(CALLING_NR,'-',11)-11)),
    SUBSTR(CALLED_NR,3),
    trim(to_char(0.001 * UNIT,'99990.000')),
    REQUEST_ID,
    CASE WHEN (SEQ_NR in (0,1,2,3)) THEN
        DECODE(BILL_RATE,0,0,999,NULL,BILL_RATE)
    ELSE
        NULL
    END
FROM
	CDRSMS
WHERE
		ACCOUNT_DATE < TRUNC(SYSDATE)  -0 + 0.5/24
	AND	ACCOUNT_DATE >= TRUNC(SYSDATE) -1 + 0.5/24
	AND	CALLTYPE = 120
	AND SUBSTR(CALLING_NR,6,5) IN ('-SUB-','-DEL-')

UNION ALL
SELECT
	'DUMMY',
	to_char(STARTDATETIME,'yyyymmddhh24miss'),
    to_char(ACCOUNT_DATE,'yyyymmddhh24miss'),
    SHORT_ID,
    SUBSTR(CALLED_NR,3),
    trim(to_char(0.001 * UNIT,'99990.000')),
    REQUEST_ID,
    DECODE(BILL_RATE,0,0,999,NULL,BILL_RATE)
FROM
	CDRMMS
WHERE
		ACCOUNT_DATE < TRUNC(SYSDATE)  -0 + 0.5/24
	AND	ACCOUNT_DATE >= TRUNC(SYSDATE) -1 + 0.5/24
	AND	CALLTYPE = 121
	AND SUBSTR(CALLING_NR,6,5) IN ('-SUB-','-DEL-','-BLK-')

UNION ALL
SELECT
	'DUMMY',
	to_char(STARTDATETIME,'yyyymmddhh24miss'),
    to_char(ACCOUNT_DATE,'yyyymmddhh24miss'),
    SUBSTR(CALLING_NR,11,INSTR(CALLING_NR,'-',11)-11),
    SUBSTR(CALLED_NR,3),
    trim(to_char(0.001 * UNIT,'99990.000')),
    NULL,
    NULL
FROM
	CDRSMS
WHERE
		ACCOUNT_DATE < TRUNC(SYSDATE)  -0 + 0.5/24
	AND	ACCOUNT_DATE >= TRUNC(SYSDATE) -1 + 0.5/24
	AND	CALLTYPE = 24
	AND SUBSTR(CALLING_NR,6,5) IN ('-SUB-','-DEL-','-BLK-');


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR078A_DETAILS_2  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR078A_DETAILS_2
(STARTDATETIME, ACCOUNT_DATE, CALLING_NR, CALLED_NR, CHARGE, 
 REQUEST_ID, BILL_RATE)
BEQUEATH DEFINER
AS 
SELECT
	to_char(STARTDATETIME,'yyyymmddhh24miss'),
    to_char(ACCOUNT_DATE,'yyyymmddhh24miss'),
    NVL(SHORT_ID,SUBSTR(CALLING_NR,11,INSTR(CALLING_NR,'-',11)-11)),
    SUBSTR(CALLED_NR,3),
    trim(to_char(0.001 * UNIT,'99990.000')),
    REQUEST_ID,
    CASE WHEN (SEQ_NR in (0,1,2,3)) THEN
        DECODE(BILL_RATE,0,0,999,NULL,BILL_RATE)
    ELSE
        NULL
    END
FROM
	CDRSMS
WHERE
		ACCOUNT_DATE < TRUNC(SYSDATE)  -1 + 0.5/24
	AND	ACCOUNT_DATE >= TRUNC(SYSDATE) -2 + 0.5/24
	AND	CALLTYPE = 120
	AND SUBSTR(CALLING_NR,6,5) IN ('-SUB-','-DEL-')

UNION ALL
SELECT
	to_char(STARTDATETIME,'yyyymmddhh24miss'),
    to_char(ACCOUNT_DATE,'yyyymmddhh24miss'),
    SHORT_ID,
    SUBSTR(CALLED_NR,3),
    trim(to_char(0.001 * UNIT,'99990.000')),
    REQUEST_ID,
    DECODE(BILL_RATE,0,0,999,NULL,BILL_RATE)
FROM
	CDRMMS
WHERE
		ACCOUNT_DATE < TRUNC(SYSDATE)  -1 + 0.5/24
	AND	ACCOUNT_DATE >= TRUNC(SYSDATE) -2 + 0.5/24
	AND	CALLTYPE = 121
	AND SUBSTR(CALLING_NR,6,5) IN ('-SUB-','-DEL-','-BLK-')

UNION ALL
SELECT
	to_char(STARTDATETIME,'yyyymmddhh24miss'),
    to_char(ACCOUNT_DATE,'yyyymmddhh24miss'),
    SUBSTR(CALLING_NR,11,INSTR(CALLING_NR,'-',11)-11),
    SUBSTR(CALLED_NR,3),
    trim(to_char(0.001 * UNIT,'99990.000')),
    NULL,
    NULL
FROM
	CDRSMS
WHERE
		ACCOUNT_DATE < TRUNC(SYSDATE)  -1 + 0.5/24
	AND	ACCOUNT_DATE >= TRUNC(SYSDATE) -2 + 0.5/24
	AND	CALLTYPE = 24
	AND SUBSTR(CALLING_NR,6,5) IN ('-SUB-','-DEL-','-BLK-');


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR078A_DETAILS_3  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR078A_DETAILS_3
(STARTDATETIME, ACCOUNT_DATE, CALLING_NR, CALLED_NR, CHARGE, 
 REQUEST_ID, BILL_RATE)
BEQUEATH DEFINER
AS 
SELECT
	to_char(STARTDATETIME,'yyyymmddhh24miss'),
    to_char(ACCOUNT_DATE,'yyyymmddhh24miss'),
    NVL(SHORT_ID,SUBSTR(CALLING_NR,11,INSTR(CALLING_NR,'-',11)-11)),
    SUBSTR(CALLED_NR,3),
    trim(to_char(0.001 * UNIT,'99990.000')),
    REQUEST_ID,
    CASE WHEN (SEQ_NR in (0,1,2,3)) THEN
        DECODE(BILL_RATE,0,0,999,NULL,BILL_RATE)
    ELSE
        NULL
    END
FROM
	CDRSMS
WHERE
		ACCOUNT_DATE < TRUNC(SYSDATE)  -2 + 0.5/24
	AND	ACCOUNT_DATE >= TRUNC(SYSDATE) -3 + 0.5/24
	AND	CALLTYPE = 120
	AND SUBSTR(CALLING_NR,6,5) IN ('-SUB-','-DEL-')

UNION ALL
SELECT
	to_char(STARTDATETIME,'yyyymmddhh24miss'),
    to_char(ACCOUNT_DATE,'yyyymmddhh24miss'),
    SHORT_ID,
    SUBSTR(CALLED_NR,3),
    trim(to_char(0.001 * UNIT,'99990.000')),
    REQUEST_ID,
    DECODE(BILL_RATE,0,0,999,NULL,BILL_RATE)
FROM
	CDRMMS
WHERE
		ACCOUNT_DATE < TRUNC(SYSDATE)  -2 + 0.5/24
	AND	ACCOUNT_DATE >= TRUNC(SYSDATE) -3 + 0.5/24
	AND	CALLTYPE = 121
	AND SUBSTR(CALLING_NR,6,5) IN ('-SUB-','-DEL-','-BLK-')

UNION ALL
SELECT
	to_char(STARTDATETIME,'yyyymmddhh24miss'),
    to_char(ACCOUNT_DATE,'yyyymmddhh24miss'),
    SUBSTR(CALLING_NR,11,INSTR(CALLING_NR,'-',11)-11),
    SUBSTR(CALLED_NR,3),
    trim(to_char(0.001 * UNIT,'99990.000')),
    NULL,
    NULL
FROM
	CDRSMS
WHERE
		ACCOUNT_DATE < TRUNC(SYSDATE)  -2 + 0.5/24
	AND	ACCOUNT_DATE >= TRUNC(SYSDATE) -3 + 0.5/24
	AND	CALLTYPE = 24
	AND SUBSTR(CALLING_NR,6,5) IN ('-SUB-','-DEL-','-BLK-');


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR078A_DETAILS_4  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR078A_DETAILS_4
(STARTDATETIME, ACCOUNT_DATE, CALLING_NR, CALLED_NR, CHARGE, 
 REQUEST_ID, BILL_RATE)
BEQUEATH DEFINER
AS 
SELECT
	to_char(STARTDATETIME,'yyyymmddhh24miss'),
    to_char(ACCOUNT_DATE,'yyyymmddhh24miss'),
    NVL(SHORT_ID,SUBSTR(CALLING_NR,11,INSTR(CALLING_NR,'-',11)-11)),
    SUBSTR(CALLED_NR,3),
    trim(to_char(0.001 * UNIT,'99990.000')),
    REQUEST_ID,
    CASE WHEN (SEQ_NR in (0,1,2,3)) THEN
        DECODE(BILL_RATE,0,0,999,NULL,BILL_RATE)
    ELSE
        NULL
    END
FROM
	CDRSMS
WHERE
		ACCOUNT_DATE < TRUNC(SYSDATE)  -3 + 0.5/24
	AND	ACCOUNT_DATE >= TRUNC(SYSDATE) -4 + 0.5/24
	AND	CALLTYPE = 120
	AND SUBSTR(CALLING_NR,6,5) IN ('-SUB-','-DEL-')

UNION ALL
SELECT
	to_char(STARTDATETIME,'yyyymmddhh24miss'),
    to_char(ACCOUNT_DATE,'yyyymmddhh24miss'),
    SHORT_ID,
    SUBSTR(CALLED_NR,3),
    trim(to_char(0.001 * UNIT,'99990.000')),
    REQUEST_ID,
    DECODE(BILL_RATE,0,0,999,NULL,BILL_RATE)
FROM
	CDRMMS
WHERE
		ACCOUNT_DATE < TRUNC(SYSDATE)  -3 + 0.5/24
	AND	ACCOUNT_DATE >= TRUNC(SYSDATE) -4 + 0.5/24
	AND	CALLTYPE = 121
	AND SUBSTR(CALLING_NR,6,5) IN ('-SUB-','-DEL-','-BLK-')

UNION ALL
SELECT
	to_char(STARTDATETIME,'yyyymmddhh24miss'),
    to_char(ACCOUNT_DATE,'yyyymmddhh24miss'),
    SUBSTR(CALLING_NR,11,INSTR(CALLING_NR,'-',11)-11),
    SUBSTR(CALLED_NR,3),
    trim(to_char(0.001 * UNIT,'99990.000')),
    NULL,
    NULL
FROM
	CDRSMS
WHERE
		ACCOUNT_DATE < TRUNC(SYSDATE)  -3 + 0.5/24
	AND	ACCOUNT_DATE >= TRUNC(SYSDATE) -4 + 0.5/24
	AND	CALLTYPE = 24
	AND SUBSTR(CALLING_NR,6,5) IN ('-SUB-','-DEL-','-BLK-');


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR088A_DEL_BASE  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR088A_DEL_BASE
(BD_PREPAID, BD_MMSRZID1, BD_BILLED, BD_EVENTDISP, BD_MMSDZID, 
 BD_LEGACYINDICATOR_N, BD_MMSSZID, BD_TARID, BD_AMOUNTCU, BD_MSGSIZE, 
 BD_AMOUNTCU_EFF)
BEQUEATH DEFINER
AS 
SELECT /*+ NO_INDEX (BDETAIL6) */
	BD_PREPAID,
	BD_MMSRZID1,
	BD_BILLED,
	BD_EVENTDISP,
	BD_MMSDZID,
    BD_LEGACYINDICATOR,
	BD_MMSSZID,
	BD_TARID,
	BD_AMOUNTCU,
	BD_MSGSIZE,
	DECODE(BD_BILLED,1.0,BD_AMOUNTCU,NULL)
FROM
	BDETAIL6
WHERE
		BD_MSGTYPE = 0
	AND	BD_CDRRECTYPE = 'MMSRrecord'
	AND	BD_DATETIME >= add_months(trunc(sysdate,'MONTH'),-1)
	AND	BD_DATETIME < trunc(sysdate,'MONTH')
	AND	BD_SRCTYPE = 'MMSC'
	AND	BD_MAPSID = 'R'
	AND	BD_ROAMINGINFO Is Not NULL
	-- AND ROWNUM <= 5000
;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR088A_DETAILS1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR088A_DETAILS1
(BD_PREPAID, ROAM_ZONE, BDBS_LANG01, MMSCET_LANG01, DEST_ZONE, 
 LEGACYIND, MMSSZ_MAXSIZE, BD_TARID, BD_AMOUNTCU, MMS_COUNT, 
 MMS_VOL, MMS_CHARGE)
BEQUEATH DEFINER
AS 
SELECT  /*+ ORDERED */
	BD_PREPAID,
	DECODE(MMSRZ_CODE,'HOME','unknown','Zone3-6') as ROAM_ZONE,
	BDBS_LANG01,
	MMSCET_LANG01,
	DECODE(MMSDZ_CODE,'LgM3','Zone3-6','LgM4','Zone3-6','LgM5','Zone3-6','LgM6','Zone3-6',MMSDZ_CODE) as DEST_ZONE,
    DECODE(BD_LEGACYINDICATOR_N,1,'yes',NULL),
	MMSSZ_MAXSIZE,
	BD_TARID,
	BD_AMOUNTCU,
	COUNT(*) as MMS_COUNT,
	SUM(BD_MSGSIZE)/1024.0 as MMS_VOL,
	SUM(BD_AMOUNTCU_EFF) as MMS_CHARGE
FROM
	SR088A_SUB_BASE,
	MMSSZ,
	MMSC_EVENTDISPTYPE,
	MMSRZ,
	BDBSTATE,
	MMSDZ
WHERE
		SR088A_SUB_BASE.BD_MMSSZID = MMSSZ.MMSSZ_ID
	AND	to_char(SR088A_SUB_BASE.BD_EVENTDISP) = MMSC_EVENTDISPTYPE.MMSCET_ID
	AND	SR088A_SUB_BASE.BD_MMSRZID1 = MMSRZ.MMSRZ_ID
	AND	SR088A_SUB_BASE.BD_BILLED = BDBSTATE.BDBS_ID
	AND	SR088A_SUB_BASE.BD_MMSDZID = MMSDZ.MMSDZ_ID
GROUP BY
	BD_PREPAID,
	DECODE(MMSRZ_CODE,'HOME','unknown','Zone3-6'),
	BDBS_LANG01,
	MMSCET_LANG01,
	DECODE(MMSDZ_CODE,'LgM3','Zone3-6','LgM4','Zone3-6','LgM5','Zone3-6','LgM6','Zone3-6',MMSDZ_CODE),
	BD_LEGACYINDICATOR_N,
	BD_TARID,
	MMSSZ_MAXSIZE,
	BD_AMOUNTCU
ORDER BY
	1,
	2,
	3,
	4,
	5,
	6,
	7,
	8;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR088A_DETAILS2  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR088A_DETAILS2
(BD_PREPAID, ROAM_ZONE, BDBS_LANG01, MMSCET_LANG01, DEST_ZONE, 
 LEGACYIND, MMSSZ_MAXSIZE, BD_TARID, BD_AMOUNTCU, MMS_COUNT, 
 MMS_VOL, MMS_CHARGE)
BEQUEATH DEFINER
AS 
SELECT
	BD_PREPAID,
	DECODE(MMSRZ_CODE,'HOME','unknown','Zone3-6') as ROAM_ZONE,
	BDBS_LANG01,
	MMSCET_LANG01,
	DECODE(MMSDZ_CODE,'LgM3','Zone3-6','LgM4','Zone3-6','LgM5','Zone3-6','LgM6','Zone3-6',MMSDZ_CODE) as DEST_ZONE,
    DECODE(BD_LEGACYINDICATOR_N,1,'yes',NULL),
	MMSSZ_MAXSIZE,
	BD_TARID,
	BD_AMOUNTCU,
	COUNT(*) as MMS_COUNT,
	SUM(BD_MSGSIZE)/1024.0 as MMS_VOL,
	SUM(BD_AMOUNTCU_EFF) as MMS_CHARGE
FROM
	SR088A_DEL_BASE,
	MMSSZ,
	MMSC_EVENTDISPTYPE,
	MMSRZ,
	BDBSTATE,
	MMSDZ
WHERE
		SR088A_DEL_BASE.BD_MMSSZID = MMSSZ.MMSSZ_ID
	AND	to_char(SR088A_DEL_BASE.BD_EVENTDISP) = MMSC_EVENTDISPTYPE.MMSCET_ID
	AND	SR088A_DEL_BASE.BD_MMSRZID1 = MMSRZ.MMSRZ_ID
	AND	SR088A_DEL_BASE.BD_BILLED = BDBSTATE.BDBS_ID
	AND	SR088A_DEL_BASE.BD_MMSDZID = MMSDZ.MMSDZ_ID
GROUP BY
	BD_PREPAID,
	DECODE(MMSRZ_CODE,'HOME','unknown','Zone3-6'),
	BDBS_LANG01,
	MMSCET_LANG01,
	DECODE(MMSDZ_CODE,'LgM3','Zone3-6','LgM4','Zone3-6','LgM5','Zone3-6','LgM6','Zone3-6',MMSDZ_CODE),
	BD_LEGACYINDICATOR_N,
	BD_TARID,
	MMSSZ_MAXSIZE,
	BD_AMOUNTCU
ORDER BY
	1,
	2,
	3,
	4,
	5,
	6,
	7,
	8;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR088A_SUB_BASE  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR088A_SUB_BASE
(BD_PREPAID, BD_MMSRZID1, BD_BILLED, BD_EVENTDISP, BD_MMSDZID, 
 BD_LEGACYINDICATOR_N, BD_MMSSZID, BD_TARID, BD_AMOUNTCU, BD_MSGSIZE, 
 BD_AMOUNTCU_EFF)
BEQUEATH DEFINER
AS 
SELECT /*+ NO_INDEX (O) */
	O.BD_PREPAID,
	O.BD_MMSRZID1,
	O.BD_BILLED,
	O.BD_EVENTDISP,
	O.BD_MMSDZID,
	(
    SELECT /*+ INDEX (IDX_BD_UMSGGRPID, N) */
        N.BD_LEGACYINDICATOR
    FROM BDETAIL6 N
    WHERE N.BD_UMSGGRPID = O.BD_UMSGGRPID
	AND	N.BD_LEGACYINDICATOR = 1
	AND	N.BD_CDRRECTYPE = 'MMSRrecord'
	AND	N.BD_MSGTYPE = 1
	AND	N.BD_DATETIME >= add_months(trunc(sysdate,'MONTH'),-1)
	AND	N.BD_DATETIME < trunc(sysdate,'MONTH')
	AND ROWNUM <= 1
    ),
	O.BD_MMSSZID,
	O.BD_TARID,
	O.BD_AMOUNTCU,
	O.BD_MSGSIZE,
	DECODE(O.BD_BILLED,1.0,O.BD_AMOUNTCU,NULL)
FROM
	BDETAIL6 O
WHERE
		O.BD_MSGTYPE = 0
	AND	O.BD_CDRRECTYPE = 'MMSOrecord'
	AND	O.BD_DATETIME >= add_months(trunc(sysdate,'MONTH'),-1)
	AND	O.BD_DATETIME < trunc(sysdate,'MONTH')
	AND	O.BD_SRCTYPE = 'MMSC'
	AND	O.BD_MAPSID = 'R'
	AND	O.BD_ROAMINGINFO Is Not NULL
	-- AND ROWNUM <= 5000
;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR089A_BASE  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR089A_BASE
(ROC_SEPID, CAR_COUNTRY, CAR_OPNAME, CON_OPKEY, CON_CODE, 
 ROC_COUNT_SCO, ROC_COUNT_SCT)
BEQUEATH DEFINER
AS 
SELECT ROC_SEPID, CAR_COUNTRY, CAR_OPNAME, CON_OPKEY, NVL(CON_CODE,' '), ROC_COUNT_SCO, ROC_COUNT_SCT
FROM SR089A_BASE_SCO
UNION ALL
SELECT ROC_SEPID, CAR_COUNTRY, CAR_OPNAME, CON_OPKEY, NVL(CON_CODE,' '), ROC_COUNT_SCO, ROC_COUNT_SCT FROM sr089a_base_sct;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR089A_BASE_SCT  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR089A_BASE_SCT
(ROC_SEPID, CAR_COUNTRY, CAR_OPNAME, CON_OPKEY, CON_CODE, 
 ROC_COUNT_SCO, ROC_COUNT_SCT)
BEQUEATH DEFINER
AS 
SELECT
    TO_CHAR(IWTC_DATE,'yyyymm'),
    CAR_COUNTRY,
    CAR_OPNAME,
    CAR_ID,
    NULL,
    0,
    IWTC_COUNT
FROM
    IWTCOUNTER,
    SMSC,
    CARRIER,
    CONTRACT PC,  -- physical contract (SMSC range owner)
    CONTRACT SC   -- settlement contract
WHERE IWTCOUNTER.IWTC_SMSCID = SMSC.SMSC_ID
  AND PC.CON_OPKEY = SMSC.SMSC_CONOPKEY
  AND SC.CON_OPKEY = CARRIER.CAR_ID
  AND PC.CON_ETID = 'TOC'
  AND SC.CON_ETID = 'TOC'
  AND PC.CON_ESID = 'A'
  AND SC.CON_ESID = 'A'
  AND PC.CON_DATESTART < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
  AND (PC.CON_DATEEND > ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1) OR PC.CON_DATEEND IS NULL)
  AND SC.CON_DATESTART < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
  AND (SC.CON_DATEEND > ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1) OR SC.CON_DATEEND IS NULL)
  AND SC.CON_OPKEY = NVL(PC.CON_HUB,PC.CON_OPKEY)   
  AND IWTC_DATE < ADD_MONTHS(trunc(sysdate,'MONTH'),-0)
  AND IWTC_DATE >= ADD_MONTHS(trunc(sysdate,'MONTH'),-1)
UNION ALL
SELECT
    TO_CHAR(IWTC_DATE,'yyyymm'),
    CAR_COUNTRY,
    CAR_OPNAME,
    CAR_ID,
    NULL,
    0,
    IWTC_COUNT
FROM
    IWTCOUNTER,
    SMSC,
    CARRIER,
    CONTRACT PC   -- physical contract (SMSC range owner)
WHERE IWTCOUNTER.IWTC_SMSCID = SMSC.SMSC_ID
  AND PC.CON_OPKEY = SMSC.SMSC_CONOPKEY
  AND PC.CON_OPKEY = CARRIER.CAR_ID
  AND PC.CON_ETID = 'TOC'
  AND PC.CON_ESID = 'I'
  AND (PC.CON_DATESTART < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0) OR PC.CON_DATESTART IS NULL)
  AND (PC.CON_DATEEND > ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1) OR PC.CON_DATEEND IS NULL)
  AND IWTC_DATE < ADD_MONTHS(trunc(sysdate,'MONTH'),-0)
  AND IWTC_DATE >= ADD_MONTHS(trunc(sysdate,'MONTH'),-1)
UNION ALL
SELECT
    TO_CHAR(IWTC_DATE,'yyyymm'),
    CAR_COUNTRY,
    CAR_OPNAME,
    CAR_ID,
    NULL,
    0,
    IWTC_COUNT
FROM
    IWTCOUNTER,
    SMSC,
    CARRIER
WHERE IWTCOUNTER.IWTC_SMSCID = SMSC.SMSC_ID
  AND IWTC_DATE < ADD_MONTHS(trunc(sysdate,'MONTH'),-0)
  AND IWTC_DATE >= ADD_MONTHS(trunc(sysdate,'MONTH'),-1)
  AND CARRIER.CAR_ID = SMSC.SMSC_CONOPKEY
  AND NOT EXISTS (
    SELECT CON_OPKEY FROM CONTRACT
    WHERE CON_OPKEY = SMSC.SMSC_CONOPKEY
    AND CON_ETID = 'TOC'
    AND CON_ESID in ('A','I')
    AND (CON_DATESTART < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0) OR CON_DATESTART IS NULL)
    AND (CON_DATEEND > ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1) OR CON_DATEEND IS NULL)
  );


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR089A_BASE_SCT_INACT  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR089A_BASE_SCT_INACT
(ROC_SEPID, CAR_COUNTRY, CAR_OPNAME, CON_OPKEY, CON_CODE, 
 ROC_COUNT_SCO, ROC_COUNT_SCT)
BEQUEATH DEFINER
AS 
SELECT
    TO_CHAR(IWTC_DATE,'yyyymm'),
    CAR_COUNTRY,
    CAR_OPNAME,
    CAR_ID,
    NULL,
    0,
    IWTC_COUNT
FROM
    IWTCOUNTER,
    SMSC,
    CARRIER,
    CONTRACT PC   -- physical contract (SMSC range owner)
WHERE IWTCOUNTER.IWTC_SMSCID = SMSC.SMSC_ID
  AND PC.CON_OPKEY = SMSC.SMSC_CONOPKEY
  AND PC.CON_OPKEY = CARRIER.CAR_ID
  AND PC.CON_ETID = 'TOC'
  AND PC.CON_ESID = 'I'
  AND (PC.CON_DATESTART < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0) OR PC.CON_DATESTART IS NULL)
  AND (PC.CON_DATEEND > ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1) OR PC.CON_DATEEND IS NULL)
  AND IWTC_DATE < ADD_MONTHS(trunc(sysdate,'MONTH'),-0)
  AND IWTC_DATE >= ADD_MONTHS(trunc(sysdate,'MONTH'),-1);


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR089A_BASE_SCT_NEW  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR089A_BASE_SCT_NEW
(ROC_SEPID, CAR_COUNTRY, CAR_OPNAME, CON_OPKEY, CON_CODE, 
 ROC_COUNT_SCO, ROC_COUNT_SCT)
BEQUEATH DEFINER
AS 
SELECT
    TO_CHAR(IWTC_DATE,'yyyymm'),
    CAR_COUNTRY,
    CAR_OPNAME,
    CAR_ID,
    NULL,
    0,
    IWTC_COUNT
FROM
    IWTCOUNTER,
    SMSC,
    CARRIER,
    CONTRACT PC,  -- physical contract (SMSC range owner)
    CONTRACT SC   -- settlement contract
WHERE IWTCOUNTER.IWTC_SMSCID = SMSC.SMSC_ID
  AND PC.CON_OPKEY = SMSC.SMSC_CONOPKEY
  AND SC.CON_OPKEY = CARRIER.CAR_ID
  AND PC.CON_ETID = 'TOC'
  AND SC.CON_ETID = 'TOC'
  AND PC.CON_ESID = 'A'
  AND SC.CON_ESID = 'A'
  AND PC.CON_DATESTART < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
  AND (PC.CON_DATEEND > ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1) OR PC.CON_DATEEND IS NULL)
  AND SC.CON_DATESTART < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
  AND (SC.CON_DATEEND > ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1) OR SC.CON_DATEEND IS NULL)
  AND SC.CON_OPKEY = NVL(NULL,PC.CON_OPKEY)   
  AND IWTC_DATE < ADD_MONTHS(trunc(sysdate,'MONTH'),-0)
  AND IWTC_DATE >= ADD_MONTHS(trunc(sysdate,'MONTH'),-1)
UNION ALL
SELECT
    TO_CHAR(IWTC_DATE,'yyyymm'),
    CAR_COUNTRY,
    CAR_OPNAME,
    CAR_ID,
    NULL,
    0,
    IWTC_COUNT
FROM
    IWTCOUNTER,
    SMSC,
    CARRIER,
    CONTRACT PC   -- physical contract (SMSC range owner)
WHERE IWTCOUNTER.IWTC_SMSCID = SMSC.SMSC_ID
  AND PC.CON_OPKEY = SMSC.SMSC_CONOPKEY
  AND PC.CON_OPKEY = CARRIER.CAR_ID
  AND PC.CON_ETID = 'TOC'
  AND PC.CON_ESID = 'I'
  AND (PC.CON_DATESTART < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0) OR PC.CON_DATESTART IS NULL)
  AND (PC.CON_DATEEND > ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1) OR PC.CON_DATEEND IS NULL)
  AND IWTC_DATE < ADD_MONTHS(trunc(sysdate,'MONTH'),-0)
  AND IWTC_DATE >= ADD_MONTHS(trunc(sysdate,'MONTH'),-1)
UNION ALL
SELECT
    TO_CHAR(IWTC_DATE,'yyyymm'),
    CAR_COUNTRY,
    CAR_OPNAME,
    CAR_ID,
    NULL,
    0,
    IWTC_COUNT
FROM
    IWTCOUNTER,
    SMSC,
    CARRIER
WHERE IWTCOUNTER.IWTC_SMSCID = SMSC.SMSC_ID
  AND IWTC_DATE < ADD_MONTHS(trunc(sysdate,'MONTH'),-0)
  AND IWTC_DATE >= ADD_MONTHS(trunc(sysdate,'MONTH'),-1)
  AND CARRIER.CAR_ID = SMSC.SMSC_CONOPKEY
  AND NOT EXISTS (
    SELECT CON_OPKEY FROM CONTRACT
    WHERE CON_OPKEY = SMSC.SMSC_CONOPKEY
    AND CON_ETID = 'TOC'
    AND CON_ESID in ('A','I')
    AND (CON_DATESTART < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0) OR CON_DATESTART IS NULL)
    AND (CON_DATEEND > ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1) OR CON_DATEEND IS NULL)
  );


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR089A_BASE_SCT_NOC  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR089A_BASE_SCT_NOC
(ROC_SEPID, CAR_COUNTRY, CAR_OPNAME, CON_OPKEY, CON_CODE, 
 ROC_COUNT_SCO, ROC_COUNT_SCT)
BEQUEATH DEFINER
AS 
SELECT
    TO_CHAR(IWTC_DATE,'yyyymm'),
    CAR_COUNTRY,
    CAR_OPNAME,
    CAR_ID,
    NULL,
    0,
    IWTC_COUNT
FROM
    IWTCOUNTER,
    SMSC,
    CARRIER
WHERE IWTCOUNTER.IWTC_SMSCID = SMSC.SMSC_ID
  AND IWTC_DATE < ADD_MONTHS(trunc(sysdate,'MONTH'),-0)
  AND IWTC_DATE >= ADD_MONTHS(trunc(sysdate,'MONTH'),-1)
  AND CARRIER.CAR_ID = SMSC.SMSC_CONOPKEY
  AND NOT EXISTS (
    SELECT CON_OPKEY FROM CONTRACT
    WHERE CON_OPKEY = SMSC.SMSC_CONOPKEY
    AND CON_ETID = 'TOC'
    AND CON_ESID in ('A','I')
    AND (CON_DATESTART < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0) OR CON_DATESTART IS NULL)
    AND (CON_DATEEND > ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1) OR CON_DATEEND IS NULL)
  );


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR089A_DETAILS_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR089A_DETAILS_1
(ROC_SEPID, CAR_COUNTRY, CAR_OPNAME, CON_OPKEY, PLMN, 
 CURID_ORIG, PRICE_ORIG, CURID_TERM, PRICE_TERM, COUNT_SCO, 
 COUNT_SCT, COUNT_DIFF)
BEQUEATH DEFINER
AS 
SELECT
	ROC_SEPID,
	CAR_COUNTRY,
	CAR_OPNAME,
	SR089A_BASE.CON_OPKEY,
	MAX(NVL(SR089A_CONTRACT.CON_CODE,SR089A_BASE.CON_CODE)),
	CURID_ORIG,
	DECODE(SR089A_CONTRACT.CON_VIRTUAL,1,NULL,PRICE_ORIG + 0.00),
	CURID_TERM,
	DECODE(SR089A_CONTRACT.CON_VIRTUAL,1,NULL,PRICE_TERM + 0.00),
	SUM(ROC_COUNT_SCO)                 COUNT_SCO,
	SUM(ROC_COUNT_SCT)                 COUNT_SCT,
	SUM(ROC_COUNT_SCO-ROC_COUNT_SCT)   COUNT_DIFF
FROM
	SR089A_BASE,
	SR089A_CONTRACT
WHERE
    SR089A_BASE.CON_OPKEY = SR089A_CONTRACT.CON_OPKEY(+)
GROUP BY
	ROC_SEPID,
	CAR_COUNTRY,
	CAR_OPNAME,
	SR089A_BASE.CON_OPKEY,
	CURID_ORIG,
	DECODE(SR089A_CONTRACT.CON_VIRTUAL,1,NULL,PRICE_ORIG + 0.00),
	CURID_TERM,
	DECODE(SR089A_CONTRACT.CON_VIRTUAL,1,NULL,PRICE_TERM + 0.00)
ORDER BY 12;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR089A_DETAILS_2  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR089A_DETAILS_2
(ROC_SEPID, CAR_COUNTRY, CAR_OPNAME, CON_OPKEY, PLMN, 
 CURID_ORIG, PRICE_ORIG, CURID_TERM, PRICE_TERM, COUNT_SCO, 
 COUNT_SCT, COUNT_DIFF)
BEQUEATH DEFINER
AS 
SELECT
    "ROC_SEPID","CAR_COUNTRY","CAR_OPNAME","CON_OPKEY","PLMN","CURID_ORIG","PRICE_ORIG","CURID_TERM","PRICE_TERM","COUNT_SCO","COUNT_SCT","COUNT_DIFF"
FROM
	SR089A_DETAILS_1
WHERE
    -- COUNT_DIFF < 0 AND 
    PRICE_TERM IS NULL
ORDER BY 12;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR089A_DETAILS_3  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR089A_DETAILS_3
(ROC_SEPID, CAR_COUNTRY, CAR_OPNAME, CON_OPKEY, PLMN, 
 CURID_ORIG, PRICE_ORIG, CURID_TERM, PRICE_TERM, COUNT_SCO, 
 COUNT_SCT, COUNT_DIFF)
BEQUEATH DEFINER
AS 
SELECT
    "ROC_SEPID","CAR_COUNTRY","CAR_OPNAME","CON_OPKEY","PLMN","CURID_ORIG","PRICE_ORIG","CURID_TERM","PRICE_TERM","COUNT_SCO","COUNT_SCT","COUNT_DIFF"
FROM
	SR089A_DETAILS_1
WHERE
    COUNT_DIFF > 0
AND PRICE_TERM IS NOT NULL
ORDER BY 12 DESC;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR098A_DETAILS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR098A_DETAILS
(BD_STATUS, BD_DGTI, BD_COUNT, BD_IW_COUNT)
BEQUEATH DEFINER
AS 
SELECT  /*+ NO_INDEX(BDETAIL2) */
    BD_STATUS,  
    BD_DGTI,
    count(*),
    CASE
        WHEN BD_STATUS <> 0 THEN 0
        -- WHEN BD_IW = '0' THEN 0
        -- WHEN BD_IW_SCENARIO is NULL THEN 0
        -- WHEN BD_IW_SCENARIO = '5' THEN 0
        WHEN (BD_DGTI LIKE '4179%' OR BD_DGTI LIKE '41779%') THEN count(*)
        ELSE 0
    END CASE 
FROM        
    BDETAIL2
WHERE       
        BD_DATETIME < trunc(sysdate,'MONTH')
    AND BD_DATETIME >= add_months( trunc(sysdate,'MONTH'),-1)
    AND BD_MAPSID = 'R'
    AND BD_IMSI LIKE '22854%'
    AND BD_GENERATED = 0
    AND BD_CDRTID NOT IN ('SMS-HR','SMS-EXT','PAGER-EXT')
GROUP BY BD_STATUS,
    BD_DGTI 
ORDER BY BD_STATUS,     
    BD_DGTI;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR107A_BASE_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR107A_BASE_1
(SUBMIT_TIME, BD_CONSOLIDATION, SENDER, STATUS, BD_TOCID, 
 BD_IW, BD_IOT_INTERNAL)
BEQUEATH DEFINER
AS 
SELECT
    TO_CHAR(BD_DATESUBMIT,'HH24') AS SUBMIT_TIME,
    BD_CONSOLIDATION,
    DECODE(BD_MSISDN_A,'9E728040201804020180','system','user') AS SENDER,
    DECODE(BD_STATUS,0,'delivered','not_delivered') AS STATUS,
    BD_TOCID,
    BD_IW,
    BD_IOT_INTERNAL
FROM
    BDETAIL2
WHERE
        BD_DATETIME < TRUNC(SYSDATE)
    AND BD_DATETIME >= TRUNC(SYSDATE)-1
    AND BD_CONSOLIDATION in ('30115','30294')
    AND BD_MAPSID = 'R'
    AND BD_PID_B = '0';


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR107A_BASE_2  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR107A_BASE_2
(BD_TOCID, BD_CONSOLIDATION, SENDER, STATUS, BD_IW, 
 BD_IOT_INTERNAL)
BEQUEATH DEFINER
AS 
SELECT
    NVL(BD_TOCID,'0160623254') BD_TOCID,
    BD_CONSOLIDATION,
    SENDER,
    STATUS,
    BD_IW,
    BD_IOT_INTERNAL
FROM
    SR107A_BASE_1;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR107A_DETAILS_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR107A_DETAILS_1
(SUBMIT_TIME, USER_COUNT1, USER_COUNT2, SYSTEM_COUNT1, SYSTEM_COUNT2, 
 TOTAL_COUNT)
BEQUEATH DEFINER
AS 
SELECT
    SUBMIT_TIME || 'h-' || trim(to_char(to_number(SUBMIT_TIME)+1,'00')) || 'h',
    SUM(DECODE(BD_CONSOLIDATION || SENDER,'30115user',1,0)),
    SUM(DECODE(BD_CONSOLIDATION || SENDER,'30294user',1,0)),
    SUM(DECODE(BD_CONSOLIDATION || SENDER,'30115system',1,0)),
    SUM(DECODE(BD_CONSOLIDATION || SENDER,'30294system',1,0)),    COUNT(*)AS TOTAL_COUNT
FROM
    SR107A_BASE_1
GROUP BY
    SUBMIT_TIME
ORDER BY
    SUBMIT_TIME;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR107A_DETAILS_2  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR107A_DETAILS_2
(CAR_COUNTRY, UD1, UD2, UN1, UN2, 
 SD1, SD2, SN1, SN2)
BEQUEATH DEFINER
AS 
SELECT
    CAR_COUNTRY,
    SUM(DECODE(BD_CONSOLIDATION || SENDER || STATUS,'30115userdelivered',1,0)),
    SUM(DECODE(BD_CONSOLIDATION || SENDER || STATUS,'30294userdelivered',1,0)),
    SUM(DECODE(BD_CONSOLIDATION || SENDER || STATUS,'30115usernot_delivered',1,0)),
    SUM(DECODE(BD_CONSOLIDATION || SENDER || STATUS,'30294usernot_delivered',1,0)),
    SUM(DECODE(BD_CONSOLIDATION || SENDER || STATUS,'30115systemdelivered',1,0)),
    SUM(DECODE(BD_CONSOLIDATION || SENDER || STATUS,'30294systemdelivered',1,0)),
    SUM(DECODE(BD_CONSOLIDATION || SENDER || STATUS,'30115systemnot_delivered',1,0)),
    SUM(DECODE(BD_CONSOLIDATION || SENDER || STATUS,'30294systemnot_delivered',1,0))
FROM
    SR107A_BASE_2,
    CONTRACT,
    CARRIER
WHERE
        SR107A_BASE_2.BD_TOCID = CONTRACT.CON_ID
    AND CARRIER.CAR_ID = CONTRACT.CON_OPKEY
GROUP BY
    CAR_COUNTRY
ORDER BY
    CAR_COUNTRY;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR107A_DETAILS_3  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR107A_DETAILS_3
(CAR_COUNTRY, CON_NAME, CON_OPKEY, CON_CODE, BD_TOCID, 
 IW, UD1, UD2, UN1, UN2, 
 SD1, SD2, SN1, SN2, IOT_INTERNAL)
BEQUEATH DEFINER
AS 
SELECT
    CAR_COUNTRY,
    CON_NAME,
    CON_OPKEY,
    CON_CODE,
    BD_TOCID,
    decode(BD_IW,1,'iw',''),
    SUM(DECODE(BD_CONSOLIDATION || SENDER || STATUS,'30115userdelivered',1,0)),
    SUM(DECODE(BD_CONSOLIDATION || SENDER || STATUS,'30294userdelivered',1,0)),
    SUM(DECODE(BD_CONSOLIDATION || SENDER || STATUS,'30115usernot_delivered',1,0)),
    SUM(DECODE(BD_CONSOLIDATION || SENDER || STATUS,'30294usernot_delivered',1,0)),
    SUM(DECODE(BD_CONSOLIDATION || SENDER || STATUS,'30115systemdelivered',1,0)),
    SUM(DECODE(BD_CONSOLIDATION || SENDER || STATUS,'30294systemdelivered',1,0)),
    SUM(DECODE(BD_CONSOLIDATION || SENDER || STATUS,'30115systemnot_delivered',1,0)),
    SUM(DECODE(BD_CONSOLIDATION || SENDER || STATUS,'30294systemnot_delivered',1,0)),
    SUM(BD_IOT_INTERNAL)
FROM
    SR107A_BASE_2,
    CONTRACT,
    CARRIER
WHERE
        SR107A_BASE_2.BD_TOCID = CONTRACT.CON_ID
    AND CARRIER.CAR_ID = CONTRACT.CON_OPKEY
GROUP BY
    CAR_COUNTRY,CON_NAME,CON_OPKEY,CON_CODE,BD_TOCID,decode(BD_IW,1,'iw','')
ORDER BY
    CAR_COUNTRY,CON_NAME,CON_OPKEY,CON_CODE,BD_TOCID,decode(BD_IW,1,'iw','');


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR107A_DETAILS_4  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR107A_DETAILS_4
(BD_DATESUBMIT, BD_DATETIME, BD_CONSOLIDATION, BD_MSISDN_A, BD_MSISDN_B, 
 BD_IMSI, BD_STATUS, BD_TOCID, BD_IOT, BD_DGTI, 
 BD_IW, BD_MESSAGEREFERENCE, BD_IOT_INTERNAL)
BEQUEATH DEFINER
AS 
SELECT
    BD_DATESUBMIT,
    BD_DATETIME,
    BD_CONSOLIDATION,
    BD_MSISDN_A,
    BD_MSISDN_B,
    BD_IMSI,
    BD_STATUS,
    BD_TOCID,
    BD_IOT,
    BD_DGTI,
    BD_IW,
    BD_MESSAGEREFERENCE,
    BD_IOT_INTERNAL
FROM
    BDETAIL2
WHERE
        BD_DATETIME < TRUNC(SYSDATE)
    AND BD_DATETIME >= TRUNC(SYSDATE)-1
    AND BD_CONSOLIDATION in ('30115','30294')
    AND BD_MAPSID = 'R'
    AND BD_PID_B = '0'
    AND ROWNUM <= 10000;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR108A_BASE  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR108A_BASE
(MVP_SHORTID)
BEQUEATH DEFINER
AS 
SELECT  /*+ NO_INDEX (BDETAIL1) */ 
    DISTINCT BD_SHORTID
FROM    BDETAIL
WHERE   BD_DATETIME < trunc(sysdate)      
    AND BD_DATETIME >= trunc(sysdate)-1   
    AND BD_CONSTID <> 'BN'
    AND BD_CONSTID <> 'PTS'
    AND BD_CONSTID IN ('MVP')
    AND BD_CDRTID IN ('CTB-CO')
    AND BD_MAPSID = 'R'
    AND BD_SHOW <> 'WRONG KEYWORD'
    AND BD_SHOW <> 'Dispatcher BadReq';


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR108A_BASE_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR108A_BASE_1
(MVP_SHORTID, HOUR, INCOMING, OUTGOING)
BEQUEATH DEFINER
AS 
SELECT  /*+ NO_INDEX (BDETAIL1) */
    MVP_SHORTID,
    TRUNC(BD_DATETIME,'HH24'),
    SUM(DECODE(BD_NPI_B || BD_PID_B,'10',0,1)),
    SUM(DECODE(BD_NPI_B || BD_PID_B,'10',1,0))
FROM    SR108A_BASE, BDETAIL1
WHERE   BD_DATETIME < trunc(sysdate) 
AND     BD_DATETIME >= trunc(sysdate)-1
AND     BD_MAPSID = 'R'
AND     BD_STATUS = 4
AND     BD_CONSOLIDATION = MVP_SHORTID
GROUP BY MVP_SHORTID, TRUNC(BD_DATETIME,'HH24')
ORDER BY to_number(MVP_SHORTID), TRUNC(BD_DATETIME,'HH24');


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR108A_DETAILS_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR108A_DETAILS_1
(MVP_SHORTID, HOUR, INCOMING, OUTGOING, LOSS, 
 LOSSPTC)
BEQUEATH DEFINER
AS 
SELECT
    MVP_SHORTID,
    TO_CHAR(HOUR,'DD.MM.YYYY HH24:MI') || '..' || TO_CHAR(HOUR+1/24,'HH24:MI'),
    INCOMING,
    OUTGOING,
    INCOMING-OUTGOING,
    DECODE(INCOMING,0,NULL,(INCOMING-OUTGOING)/INCOMING)
FROM SR108A_BASE_1
ORDER BY to_number(MVP_SHORTID), HOUR;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR109A_DETAILS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR109A_DETAILS
(TS, TIME_STAMP, ROAMINGINFO, CALLING_NUMBER, ORIG_SMSC, 
 CALLED_NUMBER, IMSI, TERMIN_MSC, PRICE)
BEQUEATH DEFINER
AS 
SELECT /*+ NO_INDEX (BDETAIL2) */
     BD_DATETIME,
     to_char(BD_DATETIME,'YYYYMMDDHH24MISS'),
     case
     when BD_OGTI IS NULL then NULL
     when BD_OGTI LIKE '4179%' then NULL
     else BD_OGTI
     end,
     DECODE(IS_NUMERIC(BD_MSISDN_A), 0, '41794999000', BD_MSISDN_A),
     NVL(BD_DELIVER_MAP_GTI,'41794999000'),
     BD_MSISDN_B,
     BD_IMSI,
     BD_DGTI,
     (SELECT CIOTE_PRICE
     FROM CONIOT, CONIOTE
     WHERE  CIOT_ID = CIOTE_CIOTID
        AND CIOT_CONID = CON_ID
        AND CIOT_TRCTID IN ('SMS')
        AND CIOT_IWDID IN ('ORIG')
     )
FROM
  CONTRACT,
  BDETAIL2
WHERE
  CONTRACT.CON_ESID = 'A'
  AND CON_DATESTART < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
  AND (CON_DATEEND > ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1) OR CON_DATEEND IS NULL)
  AND BD_DATETIME >= ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1)
  AND BD_DATETIME < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
  AND BD_TOCID = CON_ID
  AND BD_MAPSID = 'R'
  AND BD_NPI_B = '1'
  AND BD_PID_B = '0'
  AND BD_IW = '1'
  AND BD_STATUS = 0
  AND BD_MSISDN_B = '447786205094'
  AND CON_OPKEY = '703'
  AND BD_CDRTID NOT IN ('SMS-HR','SMS-EXT','PAGER-EXT')
UNION ALL
SELECT /*+ NO_INDEX (BDETAIL7) */
     BD_DATETIME,
     to_char(BD_DATETIME,'YYYYMMDDHH24MISS'),
     case
     when BD_OGTI IS NULL then NULL
     when BD_OGTI LIKE '4179%' then NULL
     else BD_OGTI
     end,
     DECODE(IS_NUMERIC(BD_MSISDN_A), 0, '41794992115' , BD_MSISDN_A),
     '41794992115',
     BD_MSISDN_B,
     BD_IMSI,
     BD_DGTI,
     (SELECT CIOTE_PRICE
     FROM CONIOT, CONIOTE
     WHERE  CIOT_ID = CIOTE_CIOTID
        AND CIOT_CONID = CON_ID
        AND CIOT_TRCTID IN ('SMS')
        AND CIOT_IWDID IN ('ORIG')
     )
FROM
  CONTRACT,
  BDETAIL7
WHERE
  CONTRACT.CON_ESID = 'A'
  AND CON_DATESTART < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
  AND (CON_DATEEND > ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1) OR CON_DATEEND IS NULL)
  AND BD_DATETIME >= ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),-1)
  AND BD_DATETIME < ADD_MONTHS(TRUNC(SYSDATE,'MONTH'),0)
  AND BD_TOCID = CON_ID
  AND BD_MAPSID = 'R'
  AND BD_MSGTYPE = 'M'  
  AND BD_SINKTYPE = '2'
  AND BD_IW = '1'
  AND BD_STATUS = 0
  AND BD_MSISDN_B = '447786205094'
  AND CON_OPKEY = '703';


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR110A_DETAILS_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR110A_DETAILS_1
(CAR_COUNTRY, CAR_OPNAME, IMR_MCC, IMR_MNC, SMS_CNT_TOTAL, 
 SMS_CNT_IW, SMS_CNT_ROAMING, SMS_CHF_IW)
BEQUEATH DEFINER
AS 
select /*+ NO_INDEX (BDETAIL2) */
      CAR_COUNTRY
    , CAR_OPNAME
    , IMR_MCC
    , IMR_MNC
    , COUNT(*) as SMS_CNT_TOTAL
    , SUM(BD_IW) as SMS_CNT_IW
    , COUNT(*)- SUM(BD_IW) as SMS_CNT_ROAMING
    , SUM(BD_IOT_INTERNAL) as SMS_CHF_IW
  from
    BDETAIL2, CONTRACT, CARRIER, IMSIRANGE
  where
      BD_MAPSID = 'R' 
  and not BD_IMSI like '228%'
  -- and BD_STATUS = 0
  and BD_DATETIME >= ADD_MONTHS(TRUNC ( SYSDATE , 'MONTH' ),-1)
  and BD_DATETIME < TRUNC ( SYSDATE , 'MONTH' )
  and BD_CONSOLIDATION = '30064'
  and CON_ID = BD_TOCID
  and IMR_CONOPKEY = CON_OPKEY
  and CAR_ID = CON_OPKEY
  and BD_IMSI LIKE IMR_MCC || IMR_MNC || '%'
GROUP BY
      CAR_COUNTRY
    , CAR_OPNAME
    , IMR_MCC
    , IMR_MNC

UNION ALL

select /*+ NO_INDEX (BDETAIL2) */
      CAR_COUNTRY
    , CAR_OPNAME
    , SUBSTR(BD_IMSI,1,3) as IMR_MCC
    , SUBSTR(BD_IMSI,4,2) as IMR_MNC
    , COUNT(*) as SMS_CNT_TOTAL
    , SUM(BD_IW) as SMS_CNT_IW
    , COUNT(*)- SUM(BD_IW) as SMS_CNT_ROAMING
    , SUM(BD_IOT_INTERNAL) as SMS_CHF_IW
  from
    BDETAIL2, CONTRACT, CARRIER
  where
      BD_MAPSID = 'R'
  and not BD_IMSI like '228%'
  -- and BD_STATUS = 0
  and BD_DATETIME >= ADD_MONTHS(TRUNC ( SYSDATE , 'MONTH' ),-1)
  and BD_DATETIME < TRUNC ( SYSDATE , 'MONTH' )
  and BD_CONSOLIDATION = '30064'
  and CON_ID = BD_TOCID
  and CAR_ID = CON_OPKEY
  and not exists( SELECT IMR_ID FROM IMSIRANGE WHERE IMR_CONOPKEY = CON_OPKEY
  and BD_IMSI LIKE IMR_MCC || IMR_MNC || '%')
GROUP BY
      CAR_COUNTRY
    , CAR_OPNAME
    , SUBSTR(BD_IMSI,1,3)
    , SUBSTR(BD_IMSI,4,2)
    
ORDER BY
      1
    , 2
    , 3
    , 4;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR111A_BASE_11  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR111A_BASE_11
(PAC_ID, PAC_PERIODID, PAC_MODLA, PAC_MODIS, PAC_MODSYS, 
 PAC_MODIW)
BEQUEATH DEFINER
AS 
select
    PAC_ID
    ,
    PAC_PERIODID
    ,
    PAC_MODLA
    ,
    PAC_MODIS
    ,
    PAC_MODSYS
    ,
    PAC_MODIW
from    PACKING
where   PAC_ETID in ('STAT','STATIND');


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR111A_BASE_5  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR111A_BASE_5
(TABLE_NAME, PARTITION_NAME, NUM_ROWS)
BEQUEATH DEFINER
AS 
select
      TABLE_NAME
    , SUBSTR(PARTITION_NAME,-6) PARTITION_NAME
    , NUM_ROWS
from ALL_TAB_PARTITIONS
where TABLE_OWNER = 'SBS1_ADMIN'
and TABLE_NAME IN
( 'BDETAIL'
 ,'BDETAIL1'
 ,'BDETAIL2'
 ,'BDETAIL4'
 ,'BDETAIL6'
 ,'BDETAIL7'
 ,'BDETAIL9'
)

UNION ALL

select
      TABLE_NAME
    , SUBSTR(PARTITION_NAME,-8,6)
    , NUM_ROWS
from ALL_TAB_PARTITIONS
where TABLE_OWNER = 'SBS2_ADMIN'
and TABLE_NAME IN
( 'BD1CUC'
 ,'BDETAIL_TRVID'
 ,'BDETAIL_TRIMG'
 ,'BDETAIL_TRAUD'
 ,'BDETAIL_TRCMN'
 ,'BDETAIL_TRLOG'
 ,'BD6CUC'
)

UNION ALL

select
      'UFIH'
    , to_char(BOH_DATETIME, 'YYYYMM')
    , SUM(BOH_RECCOUNT)
from BOHEADER, SR111A_PERIOD
where BOH_ESID = 'OK'
and BOH_DATETIME <= DATE_UNTIL
and BOH_DATETIME >= DATE_FROM
and BOH_PACKID like 'UN_%'
group by to_char(BOH_DATETIME, 'YYYYMM')

UNION ALL

select
      'UFIH'
    , to_char(HBH_DATETIME, 'YYYYMM')
    , SUM(HBH_RECCOUNT)
from HBHEADER, SR111A_PERIOD
where HBH_DATETIME <= DATE_UNTIL
and HBH_DATETIME >= DATE_FROM
and ( HBH_PACID like 'MO%' or HBH_PACID like 'mo%')
group by to_char(HBH_DATETIME, 'YYYYMM');


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR111A_DETAILS_11  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR111A_DETAILS_11
(ENUM_ID, DATE_PERIOD, DATE_DAYS, DAILY_LA, DAILY_IS, 
 DAILY_IW, DAILY_SYS, WEEKLY_LA, WEEKLY_IS, WEEKLY_IW, 
 WEEKLY_SYS, MONTHLY_LA, MONTHLY_IS, MONTHLY_IW, MONTHLY_SYS, 
 NONE_LA, NONE_IS, NONE_IW, NONE_SYS)
BEQUEATH DEFINER
AS 
select
    ENUM_ID
    ,
    DATE_PERIOD
    ,
    DATE_DAYS
    ,
    SUM(DECODE(PAC_PERIODID || PAC_MODLA, 'DAILY1', 1, 0))
    ,
    SUM(DECODE(PAC_PERIODID || PAC_MODIS, 'DAILY1', 1, 0))
    ,
    SUM(DECODE(PAC_PERIODID || PAC_MODIW, 'DAILY1', 1, 0))
    ,
    SUM(DECODE(PAC_PERIODID || PAC_MODSYS, 'DAILY1', 1, 0))
    ,
    SUM(DECODE(PAC_PERIODID || PAC_MODLA, 'WEEKLY1', 1, 0))
    ,
    SUM(DECODE(PAC_PERIODID || PAC_MODIS, 'WEEKLY1', 1, 0))
    ,
    SUM(DECODE(PAC_PERIODID || PAC_MODIW, 'WEEKLY1', 1, 0))
    ,
    SUM(DECODE(PAC_PERIODID || PAC_MODSYS, 'WEEKLY1', 1, 0))
    ,
    SUM(DECODE(PAC_PERIODID || PAC_MODLA, 'MONTHLY1', 1, 0))
    ,
    SUM(DECODE(PAC_PERIODID || PAC_MODIS, 'MONTHLY1', 1, 0))
    ,
    SUM(DECODE(PAC_PERIODID || PAC_MODIW, 'MONTHLY1', 1, 0))
    ,
    SUM(DECODE(PAC_PERIODID || PAC_MODSYS, 'MONTHLY1', 1, 0))
    ,
    SUM(DECODE(PAC_PERIODID || PAC_MODLA, 'NONE1', 1, 0))
    ,
    SUM(DECODE(PAC_PERIODID || PAC_MODIS, 'NONE1', 1, 0))
    ,
    SUM(DECODE(PAC_PERIODID || PAC_MODIW, 'NONE1', 1, 0))
    ,
    SUM(DECODE(PAC_PERIODID || PAC_MODSYS, 'NONE1', 1, 0))

from    BOHEADER, SR111A_BASE_11, SR111A_PERIOD
where   BOH_DATETIME >= DATE_FROM
and     BOH_DATETIME  < DATE_UNTIL
and     BOH_PACKID = PAC_ID
and     BOH_ESID = 'OK'
group by ENUM_ID, DATE_PERIOD, DATE_DAYS
order by 1;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR111A_DETAILS_5  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR111A_DETAILS_5
(ENUM_ID, DATE_PERIOD, DATE_DAYS, COUNT_CONTENT, COUNT_SMSC_CDR, 
 COUNT_SMSC_LOG, COUNT_MSC, COUNT_M2M, COUNT_MMSC, COUNT_MCA, 
 COUNT_UFIH)
BEQUEATH DEFINER
AS 
select
      ENUM_ID
    , DATE_PERIOD
    , DATE_DAYS
    , 30 * SUM(DECODE(TABLE_NAME,'BDETAIL',NUM_ROWS,0)) / DATE_DAYS
    , 30 * (SUM(DECODE(TABLE_NAME,'BDETAIL1',NUM_ROWS,0)) + SUM(DECODE(TABLE_NAME,'BDETAIL2',NUM_ROWS,0))) / DATE_DAYS
    , 30 * SUM(DECODE(TABLE_NAME,'BD1CUC',NUM_ROWS,'BD6CUC',NUM_ROWS,0)) / DATE_DAYS
    , 30 * SUM(DECODE(TABLE_NAME,'BDETAIL4',NUM_ROWS,0)) / DATE_DAYS
    , 30 * SUM(DECODE(TABLE_NAME,'BDETAIL7',NUM_ROWS,0)) / DATE_DAYS
    , 30 * SUM(DECODE(TABLE_NAME,'BDETAIL6',NUM_ROWS,0)) / DATE_DAYS
    , 30 * SUM(DECODE(TABLE_NAME,'BDETAIL_TRLOG',NUM_ROWS,'BDETAIL_TRCMN',NUM_ROWS,'BDETAIL_TRIMG',NUM_ROWS,'BDETAIL_TRAUD',NUM_ROWS,'BDETAIL_TRVID',NUM_ROWS,0)) / DATE_DAYS
    , 30 * (SUM(DECODE(TABLE_NAME,'BDETAIL9',NUM_ROWS,0)) + SUM(DECODE(TABLE_NAME,'UFIH',NUM_ROWS,0))) / DATE_DAYS

from SR111A_BASE_5, SR111A_PERIOD
where PARTITION_NAME = to_char(DATE_FROM,'YYYYMM')
group by ENUM_ID, DATE_PERIOD, DATE_DAYS
order by 1;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR114A_DETAILS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR114A_DETAILS
(BD_STATUS, BD_DGTI, BD_COUNT, BD_IW_COUNT)
BEQUEATH DEFINER
AS 
SELECT  /*+ NO_INDEX(BDETAIL2) */
    BD_STATUS,  
    BD_DGTI,
    count(*),
    CASE
        WHEN BD_STATUS <> 0 THEN 0
        -- WHEN BD_IW = '0' THEN 0
        -- WHEN BD_IW_SCENARIO is NULL THEN 0
        -- WHEN BD_IW_SCENARIO = '5' THEN 0
        WHEN (BD_DGTI LIKE '4179%' OR BD_DGTI LIKE '41778%') THEN count(*)
        ELSE 0
    END CASE 
FROM        
    BDETAIL2
WHERE       
        BD_DATETIME < trunc(sysdate,'MONTH')
    AND BD_DATETIME >= add_months( trunc(sysdate,'MONTH'),-1)
    AND BD_MAPSID = 'R'
    AND BD_IMSI LIKE '22858%'
    AND BD_GENERATED = 0
    AND BD_CDRTID NOT IN ('SMS-HR','SMS-EXT','PAGER-EXT')
GROUP BY BD_STATUS, BD_DGTI, BD_IW, BD_IW_SCENARIO
ORDER BY BD_STATUS, BD_DGTI, BD_IW desc, BD_IW_SCENARIO;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR115A_BASE  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR115A_BASE
(DAY, ON_NET, OFF_NET, APP_ORIG, TOTAL)
BEQUEATH DEFINER
AS 
select
  /*+ NO_INDEX(BDETAIL1) */
      trunc(BD_DATETIME ) Day 
    ,
      SUM
        (
            DECODE(BD_ORIG_ESME_ID,NULL,DECODE(SUBSTR(BD_OGTI,1,4),'4179',1,0),0) 
        ) ON_NET
    ,
      SUM
        (
            DECODE(BD_ORIG_ESME_ID,NULL,DECODE(SUBSTR(BD_OGTI,1,4),'4179',0,1),0) 
        ) OFF_NET
    ,
      SUM
        (
            DECODE(BD_ORIG_ESME_ID,NULL,0,1) 
        ) APP_ORIG
    ,
      COUNT(*) as TOTAL
  from
    BDETAIL1
  where
      (
          BD_ORIGINATORIMSI like '22801%' 
        or
        BD_ORIGINATORIMSI = BD_ORIG_ESME_ID 
        or
        BD_ORIGINATORIMSI is null 
      )
    and
    BD_SUBMIT_APP is null 
    and
    BD_SRCTYPE = 'SMSN' 
    and
    BD_MAPSID = 'R' 
    and
    BD_STATUS = 4 
    and
      BD_DATETIME
      >=
        add_months
          (
            trunc(sysdate,'MONTH') 
            ,
            -1 
          )
    and
    BD_DATETIME < trunc(sysdate,'MONTH') 
  group by
      trunc(BD_DATETIME);


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR115A_DETAILS_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR115A_DETAILS_1
(DAY, ON_NET, OFF_NET, APP_ORIG, TOTAL, 
 TYPE_OR_ERROR)
BEQUEATH DEFINER
AS 
select 
    DAY, 
    ON_NET, 
    OFF_NET, 
    APP_ORIG,
    TOTAL,
    DECODE(ON_NET+OFF_NET+APP_ORIG,TOTAL,'ACCEPTED','BAD_TOTAL') TYPE_OR_ERROR
from SR115a_BASE
order by 1;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR117A_DETAILS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR117A_DETAILS
(CON_CODE, CSV_TEXT)
BEQUEATH DEFINER
AS 
SELECT
    CON_CODE,
    'R,SENDER,RECIPIENT,START_DATETIME,END_DATETIME,UTC_OFFSET,DATE_CREATION' || CHR(10) ||
    'H,' ||
    'CHEC1,' ||
    'CHENS,' ||
    to_char(START_TIME,'YYYYMMDDhh24miss') || ',' ||
    to_char(END_TIME,'YYYYMMDDhh24miss') || ',' ||
    UTC_OFF || ',' ||
    to_char(SYSDATE,'YYYYMMDDhh24miss') || CHR(10) ||
    'R,TIMESTAMP,DIRECTION,SCENARIO,CALLING_NUMBER,ORIG_SMSC,CALLED_NUMBER,TERMIN_MSC,AMOUNT,CALLED_IMSI'
FROM
    SR117A_HEADER
UNION ALL
SELECT
    CON_CODE,
    'S,' ||
    to_char(TIME_STAMP,'YYYYMMDDhh24miss') || ',' ||
    'I,' ||
    '1,' ||
    CALLING_NUMBER || ',' ||
    ORIG_SMSC || ',' ||
    CALLED_NUMBER || ',' ||
    TERMIN_MSC || ',' ||
    LTRIM(TO_CHAR(PRICE * 10000,'00000')) || ',' ||
    IMSI
FROM SR117A_RECORDS
UNION ALL
SELECT
    CON_CODE,
    'T,' ||
    LTRIM(to_char(RECORD_COUNT+4))
FROM SR117A_FOOTER;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR117A_FOOTER  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR117A_FOOTER
(CON_CODE, RECORD_COUNT)
BEQUEATH DEFINER
AS 
SELECT
    CON_CODE,
    COUNT(*)
FROM
    SR117A_RECORDS
GROUP BY
    CON_CODE;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR117A_HEADER  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR117A_HEADER
(CON_CODE, START_TIME, END_TIME, UTC_OFF, FILE_TIME)
BEQUEATH DEFINER
AS 
SELECT
    CON_CODE,
    MIN(TIME_STAMP),
    MAX(TIME_STAMP),
    SUBSTR(REPLACE(to_char(tz_offset(DBTIMEZONE)),':',''),1,5),
    SYSDATE
FROM
    SR117A_RECORDS
GROUP BY
    CON_CODE;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR117A_RECORDS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR117A_RECORDS
(CON_CODE, TIME_STAMP, CALLING_NUMBER, ORIG_SMSC, CALLED_NUMBER, 
 TERMIN_MSC, PRICE, IMSI)
BEQUEATH DEFINER
AS 
SELECT /*+ NO_INDEX(BDETAIL4) */
    'CHENS',
    BD_DATETIME,
    DECODE(IS_NUMERIC(BD_MSISDN_B), 0, BD_SCA, BD_MSISDN_B),
    BD_SCA,
    BD_MSISDN_A,
    BD_MSCID,
    CIOTE_PRICE + 0.0,
    BD_IMSI
FROM
    BDETAIL4,
    CONTRACT,
    CONIOT,
    CONIOTE
WHERE
    BD_SCA_OPKEY = '28'
and BD_MAPSID = 'R'
and BD_CDRTID = 'MSC-MT'
and BD_IMSI NOT like '22801%'
and BD_DATETIME >= add_months(trunc(sysdate, 'MONTH'),-1)
and BD_DATETIME < trunc(sysdate, 'MONTH')
AND BD_DATETIME >= CON_DATESTART
AND ((BD_DATETIME < CON_DATEEND ) OR (CON_DATEEND IS NULL))
AND CONTRACT.CON_OPKEY = BD_SCA_OPKEY
AND CONTRACT.CON_ESID = 'A'
AND CIOT_ID = CIOTE_CIOTID
AND CIOT_CONID = CON_ID
AND CIOT_TRCTID IN ('SMS')
AND CIOT_IWDID IN ('TERM')
ORDER BY 2;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR118A_DETAILS_1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR118A_DETAILS_1
(DAY, TOTAL, LTE_NATIONAL, LTE_ROAMING, WIFI_NAT, 
 WIFI_ROAMING, P2A, P2P)
BEQUEATH DEFINER
AS 
select
  /*+ NO_INDEX(BDETAIL1) */
      trunc(BD_DATETIME ) Day 
    , COUNT(*) as TOTAL
    , SUM
        ( CASE
          WHEN BD_PANI_HEADER IS NULL THEN 0
          WHEN BD_PANI_HEADER LIKE 'IEEE%' THEN 0
          WHEN BD_PANI_HEADER NOT LIKE '%;mcc=%' THEN 1
          WHEN BD_PANI_HEADER LIKE '%;mcc=228%' THEN 1
          WHEN BD_PANI_HEADER LIKE '%;country=CH;%' THEN 1
          ELSE 0
          END
        ) LTE_NATIONAL
    , SUM
        ( CASE
          WHEN BD_PANI_HEADER IS NULL THEN 0
          WHEN BD_PANI_HEADER LIKE 'IEEE%' THEN 0
          WHEN BD_PANI_HEADER NOT LIKE '%;mcc=%' THEN 0
          WHEN BD_PANI_HEADER LIKE '%;mcc=228%' THEN 0
          WHEN BD_PANI_HEADER LIKE '%;country=CH;%' THEN 0
          ELSE 1
          END
        ) LTE_ROAMING
    , SUM
        ( CASE
          WHEN BD_PANI_HEADER IS NULL THEN 0
          WHEN BD_PANI_HEADER NOT LIKE 'IEEE%' THEN 0
          WHEN BD_PANI_HEADER NOT LIKE '%;mcc=%' THEN 1
          WHEN BD_PANI_HEADER LIKE '%;mcc=228%' THEN 1
          WHEN BD_PANI_HEADER LIKE '%;country=CH;%' THEN 1
          ELSE 0
          END
        ) WIFI_NAT
    , SUM
        ( CASE
          WHEN BD_PANI_HEADER IS NULL THEN 0
          WHEN BD_PANI_HEADER NOT LIKE 'IEEE%' THEN 0
          WHEN BD_PANI_HEADER NOT LIKE '%;mcc=%' THEN 0
          WHEN BD_PANI_HEADER LIKE '%;mcc=228%' THEN 0
          WHEN BD_PANI_HEADER LIKE '%;country=CH;%' THEN 0
          ELSE 1
          END
        ) WIFI_ROAMING
    , SUM
        ( CASE
          WHEN BD_DELIVER_ESME_ID IS NULL THEN 0
          ELSE 1
          END
        ) P2A
    , SUM
        ( CASE
          WHEN BD_DELIVER_ESME_ID IS NULL THEN 1
          ELSE 0
          END
        ) P2P
  from
    BDETAIL1
  where
    BD_ORIGINATORIMSI like '22801%'
    and
    BD_SUBMIT_APP is null 
    and
    BD_SRCTYPE = 'SMSN' 
    and
    BD_MAPSID = 'R' 
    and
    BD_STATUS = 4
    and
    BD_ORIG_IP LIKE 'mscs__.sharedtcs.net:%'
    and
      BD_DATETIME
      >=
        add_months
          (
            trunc(sysdate,'MONTH') 
            ,
            -0
          )
    -- and
    -- BD_DATETIME < trunc(sysdate,'MONTH')
  group by
      trunc(BD_DATETIME)
  order by 1;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR118A_DETAILS_2  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR118A_DETAILS_2
(DAY, TOTAL, LTE_NATIONAL, LTE_ROAMING, WIFI_NAT, 
 WIFI_ROAMING, A2P, P2P)
BEQUEATH DEFINER
AS 
select
  /*+ NO_INDEX(BDETAIL2) */
      trunc(BD_DATETIME ) Day 
    , COUNT(*) as TOTAL
    , SUM
        ( CASE
          WHEN BD_DELIVER_PANI_HEADER IS NULL THEN 0
          WHEN BD_DELIVER_PANI_HEADER LIKE 'IEEE%' THEN 0
          WHEN BD_DELIVER_PANI_HEADER NOT LIKE '%;mcc=%' THEN 1
          WHEN BD_DELIVER_PANI_HEADER LIKE '%;mcc=228%' THEN 1
          WHEN BD_DELIVER_PANI_HEADER LIKE '%;country=CH;%' THEN 1
          ELSE 0
          END
        ) LTE_NATIONAL
    , SUM
        ( CASE
          WHEN BD_DELIVER_PANI_HEADER IS NULL THEN 0
          WHEN BD_DELIVER_PANI_HEADER LIKE 'IEEE%' THEN 0
          WHEN BD_DELIVER_PANI_HEADER NOT LIKE '%;mcc=%' THEN 0
          WHEN BD_DELIVER_PANI_HEADER LIKE '%;mcc=228%' THEN 0
          WHEN BD_DELIVER_PANI_HEADER LIKE '%;country=CH;%' THEN 0
          ELSE 1
          END
        ) LTE_ROAMING
    , SUM
        ( CASE
          WHEN BD_DELIVER_PANI_HEADER IS NULL THEN 0
          WHEN BD_DELIVER_PANI_HEADER NOT LIKE 'IEEE%' THEN 0
          WHEN BD_DELIVER_PANI_HEADER NOT LIKE '%;mcc=%' THEN 1
          WHEN BD_DELIVER_PANI_HEADER LIKE '%;mcc=228%' THEN 1
          WHEN BD_DELIVER_PANI_HEADER LIKE '%;country=CH;%' THEN 1
          ELSE 0
          END
        ) WIFI_NAT
    , SUM
        ( CASE
          WHEN BD_DELIVER_PANI_HEADER IS NULL THEN 0
          WHEN BD_DELIVER_PANI_HEADER NOT LIKE 'IEEE%' THEN 0
          WHEN BD_DELIVER_PANI_HEADER NOT LIKE '%;mcc=%' THEN 0
          WHEN BD_DELIVER_PANI_HEADER LIKE '%;mcc=228%' THEN 0
          WHEN BD_DELIVER_PANI_HEADER LIKE '%;country=CH;%' THEN 0
          ELSE 1
          END
        ) WIFI_ROAMING
    , SUM
        ( CASE
          WHEN BD_ORIG_ESME_ID IS NULL THEN 0
          ELSE 1
          END
        ) A2P
    , SUM
        ( CASE
          WHEN BD_ORIG_ESME_ID IS NULL THEN 1
          ELSE 0
          END
        ) P2P
  from
    BDETAIL2
  where
    BD_SRCTYPE = 'SMSN' 
    and
    BD_MAPSID = 'R' 
    and
    BD_STATUS = 0
    and
    BD_DELIVER_IP LIKE 'mscs__.sharedtcs.net:%'
    and
      BD_DATETIME
      >=
        add_months
          (
            trunc(sysdate,'MONTH') 
            ,
            -1 
          )
    and
    BD_DATETIME < trunc(sysdate,'MONTH') 
  group by
      trunc(BD_DATETIME)
  order by 1;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SR120A_DETAILS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SR120A_DETAILS
(BD_STATUS, BD_DGTI, BD_COUNT, BD_IW_COUNT)
BEQUEATH DEFINER
AS 
SELECT
    CDR_STATUS,
    BD_DGTI,
    SUM(CDR_COUNT),
    SUM(IW_COUNT)
FROM (
SELECT  /*+ NO_INDEX(BDETAIL2) */
    to_char(BD_STATUS) CDR_STATUS,
    BD_DGTI,
    COUNT(*) CDR_COUNT,
    CASE
        WHEN to_char(BD_STATUS) <> '0' THEN 0
        WHEN (BD_DGTI LIKE '4179%' OR BD_DGTI LIKE '417840%' OR BD_DGTI LIKE '4198090%') THEN COUNT(*)
        ELSE 0
    END IW_COUNT
FROM
    BDETAIL2
WHERE
        BD_DATETIME < trunc(sysdate,'MONTH')
    AND BD_DATETIME >= add_months( trunc(sysdate,'MONTH'),-1)
    AND BD_MAPSID = 'R'
    AND BD_IMSI LIKE '22853%'
    AND BD_GENERATED = 0
    AND BD_CDRTID NOT IN ('SMS-HR','SMS-EXT','PAGER-EXT')
    AND (BD_IW_DIR = 'O' OR BD_IW_DIR IS NULL)
GROUP BY to_char(BD_STATUS), BD_DGTI
UNION ALL
SELECT  /*+ NO_INDEX(BDETAIL7) */
    BD_STATUS CDR_STATUS,
    BD_DGTI,
    COUNT(*) CDR_COUNT,
    CASE
        WHEN BD_STATUS <> '0' THEN 0
        WHEN (BD_DGTI LIKE '4179%' OR BD_DGTI LIKE '417840%' OR BD_DGTI LIKE '4198090%') THEN COUNT(*)
        ELSE 0
    END IW_COUNT
FROM
    BDETAIL7
WHERE
        BD_DATETIME < trunc(sysdate,'MONTH')
    AND BD_DATETIME >= add_months( trunc(sysdate,'MONTH'),-1)
    AND BD_MAPSID = 'R'
    AND BD_MSGTYPE = 'M'
    AND BD_IMSI LIKE '22853%'
    AND (BD_IW_DIR = 'O' OR BD_IW_DIR IS NULL)
GROUP BY BD_STATUS, BD_DGTI
)
GROUP BY CDR_STATUS, BD_DGTI
ORDER BY 1, 2, 3 desc;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- STA_CHECKBT_BDETAIL  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.STA_CHECKBT_BDETAIL
(MINDATE, MAXDATE)
BEQUEATH DEFINER
AS 
select min(minDate) minDate, max(maxDate) maxDate
from (
  select min(bd_datetime) minDate, to_date(null) maxDate
  from bdetail
  --where bd_mapsid='R'
  union
  select to_date(null) minDate, max(bd_datetime) maxDate
  from bdetail
  --where bd_mapsid='R'
);


/* This object may not be sorted properly in the script due to cirular references. */
--
-- STA_CHECKBT_BDETAIL1  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.STA_CHECKBT_BDETAIL1
(MINDATE, MAXDATE)
BEQUEATH DEFINER
AS 
select min(minDate) minDate, max(maxDate) maxDate
from (
  select min(bd_datetime) minDate, to_date(null) maxDate
  from bdetail1
  --where bd_mapsid='R'
  union
  select to_date(null) minDate, max(bd_datetime) maxDate
  from bdetail1
  --where bd_mapsid='R'
);


/* This object may not be sorted properly in the script due to cirular references. */
--
-- STA_CHECKBT_BDETAIL2  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.STA_CHECKBT_BDETAIL2
(MINDATE, MAXDATE)
BEQUEATH DEFINER
AS 
select min(minDate) minDate, max(maxDate) maxDate
from (
  select min(bd_datetime) minDate, to_date(null) maxDate
  from bdetail2
  --where bd_mapsid='R'
  union
  select to_date(null) minDate, max(bd_datetime) maxDate
  from bdetail2
  --where bd_mapsid='R'
);


/* This object may not be sorted properly in the script due to cirular references. */
--
-- STA_GETNEXTJOB  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.STA_GETNEXTJOB
(WICKI, STAJ_ID, STAJ_PACID, STAJ_DATEEXE, PAC_LTID, 
 STAJ_LTVALUE, PAC_DATETRY, PAC_DATEDONE, PAC_OUTPUTDIR, STAJ_DATESTA, 
 DATEEXE, STAJ_ESID, PAC_ESID, STAJ_ETID, PAC_ETID, 
 PAC_TEMPLATE, PAC_FILEMASK, PAC_NEXTSEQ, PAC_ID, PAC_NAME, 
 PERIOD, PAC_XPROCID, PAC_NOTIFICATION, PAC_NOTID, STAJP_VALUE, 
 STAJ_PARENTID, STAJ_SYSINFO, PAC_PDFMASK, PAC_ARCHIVESTATISTIC, PAC_ARCHIVEDIR, 
 STAJ_DIRECTORYID, STAJ_NOTIFICATION, STAJ_NOTID, STAJ_NOTEMAILSUCCESS, STAJ_NOTEMAILFAILURE, 
 STAJ_NOTSENDATT)
BEQUEATH DEFINER
AS 
select /*+ INDEX (STA_JOB IDX_STAJOB_ESID) */
    '1' wicki, staj_id, staj_pacid, staj_dateexe, pac_ltid, staj_ltvalue,
    pac_datetry, pac_datedone, pac_outputdir, staj_datesta, j.staj_dateexe dateexe,
    staj_esid, pac_esid, staj_etid, pac_etid, pac_template, pac_filemask, pac_nextseq,
    pac_id, pac_name, to_char(trunc(add_months(sysdate,-1),'MONTH'),'YYYYMM') period,
    pac_xprocid, pac_notification, pac_notid, stajp_value, staj_parentid, staj_sysinfo,
    pac_pdfmask, PAC_ARCHIVESTATISTIC, PAC_ARCHIVEDIR, STAJ_DIRECTORYID,
    STAJ_NOTIFICATION, STAJ_NOTID, STAJ_NOTEMAILSUCCESS, STAJ_NOTEMAILFAILURE, STAJ_NOTSENDATT
from sta_job j, packing p, sta_jobparam o
where staj_pacid=pac_id
and staj_id=stajp_jobid
and staj_esid in ('W','S')
and lower(stajp_name(+))= '[datetill]'
--FIRST get the ones without dependencies
and pac_id not in (select pacpac_pacid1 from pacpacdep)
and pac_id not in (select pacpac_pacid2 from pacpacdep)

union all

select /*+ INDEX (STA_JOB IDX_STAJOB_ESID) */
    '2' wicki, staj_id, staj_pacid, staj_dateexe, pac_ltid, staj_ltvalue,
    pac_datetry, pac_datedone, pac_outputdir, staj_datesta, j.staj_dateexe dateexe,
    staj_esid, pac_esid, staj_etid, pac_etid, pac_template, pac_filemask, pac_nextseq,
    pac_id, pac_name, to_char(trunc(add_months(sysdate,-1),'MONTH'),'YYYYMM') period,
    pac_xprocid, pac_notification, pac_notid, stajp_value, staj_parentid, staj_sysinfo,
    pac_pdfmask, PAC_ARCHIVESTATISTIC, PAC_ARCHIVEDIR, STAJ_DIRECTORYID,
    STAJ_NOTIFICATION, STAJ_NOTID, STAJ_NOTEMAILSUCCESS, STAJ_NOTEMAILFAILURE, STAJ_NOTSENDATT
from sta_job j, packing p, sta_jobparam o
where staj_pacid=pac_id
and staj_id=stajp_jobid
and staj_esid in ('W','S')
and lower(stajp_name(+))= '[datetill]'
--SECOND get the ones which are VORGNGER
and pac_id in  (select pacpac_pacid1 from pacpacdep)
and pac_id not in (select pacpac_pacid2 from pacpacdep)

union all

select /*+ INDEX (STA_JOB IDX_STAJOB_ESID) */
    '3' wicki, staj_id, staj_pacid, staj_dateexe, pac_ltid, staj_ltvalue,
    pac_datetry, pac_datedone, pac_outputdir, staj_datesta, j.staj_dateexe dateexe,
    staj_esid, pac_esid, staj_etid, pac_etid, pac_template, pac_filemask, pac_nextseq,
    pac_id, pac_name, to_char(trunc(add_months(sysdate,-1),'MONTH'),'YYYYMM') period,
    pac_xprocid, pac_notification, pac_notid, stajp_value, staj_parentid, staj_sysinfo,
    pac_pdfmask, PAC_ARCHIVESTATISTIC, PAC_ARCHIVEDIR, STAJ_DIRECTORYID,
    STAJ_NOTIFICATION, STAJ_NOTID, STAJ_NOTEMAILSUCCESS, STAJ_NOTEMAILFAILURE, STAJ_NOTSENDATT
from sta_job j, packing p, sta_jobparam o
where staj_pacid=pac_id
and staj_id=stajp_jobid
and staj_esid in ('W','S')
and lower(stajp_name(+))= '[datetill]'
--THIRD get the ones which are NACHFOLGER
and pac_id not in (select pacpac_pacid1 from pacpacdep)
and pac_id in (select pacpac_pacid2 from pacpacdep)

union all

select /*+ INDEX (STA_JOB IDX_STAJOB_ESID) */
    '4' wicki, staj_id, staj_pacid, staj_dateexe, pac_ltid, staj_ltvalue,
    pac_datetry, pac_datedone, pac_outputdir, staj_datesta, j.staj_dateexe dateexe,
    staj_esid, pac_esid, staj_etid, pac_etid, pac_template, pac_filemask, pac_nextseq,
    pac_id, pac_name, to_char(trunc(add_months(sysdate,-1),'MONTH'),'YYYYMM') period,
    pac_xprocid, pac_notification, pac_notid, stajp_value, staj_parentid, staj_sysinfo,
    pac_pdfmask, PAC_ARCHIVESTATISTIC, PAC_ARCHIVEDIR, STAJ_DIRECTORYID,
    STAJ_NOTIFICATION, STAJ_NOTID, STAJ_NOTEMAILSUCCESS, STAJ_NOTEMAILFAILURE, STAJ_NOTSENDATT
from sta_job j, packing p, sta_jobparam o
where staj_pacid=pac_id
and staj_id=stajp_jobid
and staj_esid in ('W','S')
and lower(stajp_name(+))= '[datetill]'
--FOURTH get the ones which are VORGAENGER AND NACHFOLGER
and pac_id in (select pacpac_pacid1 from pacpacdep)
and pac_id in (select pacpac_pacid2 from pacpacdep)

order by wicki, dateexe asc, pac_datetry desc, staj_esid desc;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- STA_WEB_JOB_BASE_CUC  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.STA_WEB_JOB_BASE_CUC
(STAJ_ID, STAJ_DATECRE, STAJ_ESID, STAJ_ETID, STAJ_PACID, 
 PAC_NAME, PAC_ETID, PAC_LTID, PAC_PERIODID, STAJ_LTVALUE, 
 STAJ_ACIDCRE)
BEQUEATH DEFINER
AS 
SELECT
  STAJ_ID,
  STAJ_DATECRE,
  STAJ_ESID,
  STAJ_ETID,
  STAJ_PACID,
  PAC_NAME,
  PAC_ETID,
  PAC_LTID, PAC_PERIODID,
  STAJ_LTVALUE,
  STAJ_ACIDCRE
FROM
  STA_JOB, PACKING
WHERE STA_JOB.STAJ_PACID = PACKING.PAC_ID
AND STAJ_ESID IN ('L', 'O', 'E', 'S', 'W')
AND STAJ_DATECRE >= SYSDATE - 2 * 366
-- AND PAC_MODIS = 1
-- AND PAC_MODLA = 1
-- AND PAC_MODIW = 1
-- AND PAC_MODSYS = 1
AND PAC_MODCUC = 1;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- STA_WEB_JOB_BASE_IS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.STA_WEB_JOB_BASE_IS
(STAJ_ID, STAJ_DATECRE, STAJ_ESID, STAJ_ETID, STAJ_PACID, 
 STAJ_INFO, PAC_NAME, PAC_ETID, PAC_LTID, PAC_PERIODID, 
 STAJ_LTVALUE, STAJ_ACIDCRE)
BEQUEATH DEFINER
AS 
SELECT staj_id,
           staj_datecre,
           staj_esid,
           staj_etid,
           staj_pacid,
           staj_info,
           pac_name,
           pac_etid,
           pac_ltid,
           pac_periodid,
           staj_ltvalue,
           staj_acidcre
    FROM   sta_job,
           packing
    WHERE      sta_job.staj_pacid = packing.pac_id
           AND pac_esid <> 'D'
           AND staj_esid IN ('L',
                             'O',
                             'E',
                             'S',
                             'W')
           AND staj_datecre >= SYSDATE - 2 * 366
           AND pac_modis = 1
-- AND PAC_MODLA = 1
-- AND PAC_MODIW = 1
-- AND PAC_MODSYS = 1
-- AND PAC_MODCUC = 1
;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- STA_WEB_JOB_BASE_IW  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.STA_WEB_JOB_BASE_IW
(STAJ_ID, STAJ_DATECRE, STAJ_ESID, STAJ_ETID, STAJ_PACID, 
 PAC_NAME, PAC_ETID, PAC_LTID, PAC_PERIODID, STAJ_LTVALUE, 
 STAJ_ACIDCRE)
BEQUEATH DEFINER
AS 
SELECT
  STAJ_ID,
  STAJ_DATECRE,
  STAJ_ESID,
  STAJ_ETID,
  STAJ_PACID,
  PAC_NAME,
  PAC_ETID,
  PAC_LTID, PAC_PERIODID,
  STAJ_LTVALUE, STAJ_ACIDCRE
FROM
  STA_JOB, PACKING
WHERE STA_JOB.STAJ_PACID = PACKING.PAC_ID
AND STAJ_ESID IN ('L', 'O', 'E', 'S', 'W')
AND STAJ_DATECRE >= SYSDATE - 2 * 366
-- AND PAC_MODIS = 1
-- AND PAC_MODLA = 1
AND PAC_MODIW = 1
-- AND PAC_MODSYS = 1
-- AND PAC_MODCUC = 1
;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- STA_WEB_JOB_BASE_LA  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.STA_WEB_JOB_BASE_LA
(STAJ_ID, STAJ_DATECRE, STAJ_ESID, STAJ_ETID, STAJ_PACID, 
 PAC_NAME, PAC_ETID, PAC_LTID, PAC_PERIODID, STAJ_LTVALUE, 
 STAJ_ACIDCRE)
BEQUEATH DEFINER
AS 
SELECT
  STAJ_ID,
  STAJ_DATECRE,
  STAJ_ESID,
  STAJ_ETID,
  STAJ_PACID,
  PAC_NAME,
  PAC_ETID,
  PAC_LTID, PAC_PERIODID,
  STAJ_LTVALUE, STAJ_ACIDCRE
FROM
  STA_JOB, PACKING
WHERE STA_JOB.STAJ_PACID = PACKING.PAC_ID
AND STAJ_ESID IN ('L', 'O', 'E', 'S', 'W')
AND STAJ_DATECRE >= SYSDATE - 2 * 366
-- AND PAC_MODIS = 1
AND PAC_MODLA = 1
-- AND PAC_MODIW = 1
-- AND PAC_MODSYS = 1
-- AND PAC_MODCUC = 1
;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- STA_WEB_JOB_BASE_SYS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.STA_WEB_JOB_BASE_SYS
(STAJ_ID, STAJ_DATECRE, STAJ_ESID, STAJ_ETID, STAJ_PACID, 
 PAC_NAME, PAC_ETID, PAC_LTID, PAC_PERIODID, STAJ_LTVALUE, 
 STAJ_ACIDCRE)
BEQUEATH DEFINER
AS 
SELECT
  STAJ_ID,
  STAJ_DATECRE,
  STAJ_ESID,
  STAJ_ETID,
  STAJ_PACID,
  PAC_NAME,
  PAC_ETID,
  PAC_LTID, PAC_PERIODID,
  STAJ_LTVALUE, STAJ_ACIDCRE
FROM
  STA_JOB, PACKING
WHERE STA_JOB.STAJ_PACID = PACKING.PAC_ID
AND STAJ_ESID IN ('L', 'O', 'E', 'S', 'W')
AND STAJ_DATECRE >= SYSDATE - 2 * 366
-- AND PAC_MODIS = 1
-- AND PAC_MODLA = 1
-- AND PAC_MODIW = 1
AND PAC_MODSYS = 1
-- AND PAC_MODCUC = 1
;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- STA_WEB_JOB_LIST  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.STA_WEB_JOB_LIST
(STAJ_ID, STAJ_DATECRE, STAJ_ESID, STAJS_LANG01, STAJ_ETID, 
 STAOT_LANG01, STAJ_PACID, PAC_NAME, AC_NAME_CRE, PAC_ETID, 
 PAC_MODIS, PAC_MODLA, PAC_MODIW, PAC_MODSYS, PAC_MODCUC, 
 PERIOD_LANG01, IS_REPEAT_JOB, DATE_FROM, DATE_TO, OP_KEY, 
 STAJO_ID, STAJO_OUTPUTDIR, STAJO_FILENAME, STAJO_ETID, PAC_LTID, 
 STAJ_LTVALUE, CON_NAME, CON_ACNAME, AC_NAME)
BEQUEATH DEFINER
AS 
SELECT
  STAJ_ID,
  STAJ_DATECRE,
  STAJ_ESID,
  STAJS_LANG01,
  NVL(STAJ_ETID,'-') STAJ_ETID,
  NVL(STAOT_LANG01,'-') STAOT_LANG01,
  STAJ_PACID,
  PAC_NAME,
  nvl(A1.AC_NAME,'System') AC_NAME_CRE,
  PAC_ETID,
  PAC_MODIS,
  PAC_MODLA,
  PAC_MODIW,
  PAC_MODSYS,
  PAC_MODCUC,
  PERIOD_LANG01,
  (SELECT COUNT(*) FROM STA_JOBPARAM WHERE STAJP_JOBID = STAJ_ID AND STAJP_NAME='[DATETILL]' AND STAJP_VALUE NOT LIKE '01.01.2100%') IS_REPEAT_JOB,
  (SELECT STAJP_VALUE FROM STA_JOBPARAM WHERE STAJP_JOBID = STAJ_ID AND STAJP_NAME='[DATEFROM]') DATE_FROM,
  (SELECT STAJP_VALUE FROM STA_JOBPARAM WHERE STAJP_JOBID = STAJ_ID AND STAJP_NAME='[DATETO]') DATE_TO,
  NVL((SELECT STAJP_VALUE FROM STA_JOBPARAM WHERE STAJP_JOBID = STAJ_ID AND STAJP_NAME='[OP_KEY]'), STAJ_LTVALUE) OP_KEY,
  STAJO_ID,
  STAJO_OUTPUTDIR,
  STAJO_FILENAME,
  STAJO_ETID,
  PAC_LTID,
  STAJ_LTVALUE,
  (SELECT NVL(CON_NAME,'-') FROM CONTRACT WHERE STAJ_LTVALUE = CON_ID(+)) CON_NAME,
  (SELECT NVL(AC_NAME,'-') FROM CONTRACT, ACCOUNT WHERE STAJ_LTVALUE = CON_ID(+) AND CON_ACID = AC_ID) CON_ACNAME,
  (SELECT NVL(AC_NAME,'-') FROM ACCOUNT WHERE STAJ_LTVALUE = AC_ID(+)) AC_NAME
FROM
  STA_JOB, STA_JOBSTATE, STA_JOBOTYPE, PACKING, PERIODICITY, STA_JOBOUTPUT, ACCOUNT A1
WHERE STA_JOB.STAJ_PACID = PACKING.PAC_ID
AND STA_JOB.STAJ_ESID = STA_JOBSTATE.STAJS_ID
AND PACKING.PAC_PERIODID = PERIODICITY.PERIOD_ID
AND STA_JOB.STAJ_ETID = STA_JOBOTYPE.STAOT_ID (+)
AND STA_JOB.STAJ_ID = STA_JOBOUTPUT.STAJO_JOBID (+)
AND STA_JOB.STAJ_ACIDCRE = A1.AC_ID (+);


/* This object may not be sorted properly in the script due to cirular references. */
--
-- STA_WEB_JOB_LIST_CUC  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.STA_WEB_JOB_LIST_CUC
(STAJ_ID, STAJ_DATECRE, STAJ_ESID, STAJS_LANG01, STAJ_ETID, 
 STAOT_LANG01, STAJ_PACID, PAC_NAME, AC_NAME_CRE, PAC_ETID, 
 PERIOD_LANG01, IS_REPEAT_JOB, DATE_FROM, DATE_TO, OP_KEY, 
 STAJO_ID, STAJO_OUTPUTDIR, STAJO_FILENAME, STAJO_ETID, PAC_LTID, 
 STAJ_LTVALUE, CON_NAME, CON_ACNAME, AC_NAME)
BEQUEATH DEFINER
AS 
SELECT
  STAJ_ID,
  STAJ_DATECRE,
  STAJ_ESID,
  STAJS_LANG01,
  STAJ_ETID,
  STAOT_LANG01,
  STAJ_PACID,
  PAC_NAME,
  STAJ_ACIDCRE,
  PAC_ETID,
  PERIOD_LANG01,
  0 IS_REPEAT_JOB,
  (SELECT STAJP_VALUE FROM STA_JOBPARAM WHERE STAJP_JOBID = STAJ_ID AND STAJP_NAME='[DATEFROM]') DATE_FROM,
  (SELECT STAJP_VALUE FROM STA_JOBPARAM WHERE STAJP_JOBID = STAJ_ID AND STAJP_NAME='[DATETO]') DATE_TO,
  NVL((SELECT STAJP_VALUE FROM STA_JOBPARAM WHERE STAJP_JOBID = STAJ_ID AND STAJP_NAME='[OP_KEY]'), STAJ_LTVALUE) OP_KEY,
  STAJO_ID,
  STAJO_OUTPUTDIR,
  STAJO_FILENAME,
  STAJO_ETID,
  PAC_LTID,
  STAJ_LTVALUE,
  (SELECT NVL(C4.CON_NAME,'-') FROM CONTRACT C4 WHERE STAJ_LTVALUE = C4.CON_ID(+)),
  (SELECT NVL(A3.AC_NAME,'-') FROM CONTRACT C3, ACCOUNT A3 WHERE STAJ_LTVALUE = C3.CON_ID(+) AND C3.CON_ACID = A3.AC_ID ),
  (SELECT NVL(A2.AC_NAME,'-') FROM ACCOUNT A2 WHERE STAJ_LTVALUE = A2.AC_ID(+))
FROM
  STA_WEB_JOB_BASE_CUC, STA_JOBSTATE, STA_JOBOTYPE, PERIODICITY, STA_JOBOUTPUT, ACCOUNT A1
WHERE STAJ_ESID = STA_JOBSTATE.STAJS_ID
AND PAC_PERIODID = PERIODICITY.PERIOD_ID
AND STAJ_ETID = STA_JOBOTYPE.STAOT_ID (+)
AND STAJ_ID = STA_JOBOUTPUT.STAJO_JOBID (+)
AND STAJ_ACIDCRE = A1.AC_ID (+);


/* This object may not be sorted properly in the script due to cirular references. */
--
-- STA_WEB_JOB_LIST_IS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.STA_WEB_JOB_LIST_IS
(STAJ_ID, STAJ_DATECRE, STAJ_ESID, STAJS_LANG01, STAJ_ETID, 
 STAOT_LANG01, STAJ_PACID, PAC_NAME, AC_NAME_CRE, PAC_ETID, 
 PERIOD_LANG01, IS_REPEAT_JOB, DATE_FROM, DATE_TO, OP_KEY, 
 STAJO_ID, STAJO_OUTPUTDIR, STAJO_FILENAME, STAJO_ETID, PAC_LTID, 
 STAJ_LTVALUE, CON_NAME, CON_ACNAME, AC_NAME)
BEQUEATH DEFINER
AS 
SELECT staj_id,
           staj_datecre,
           staj_esid,
           stajs_lang01,
           staj_etid,
           staot_lang01,
           staj_pacid,
           pac_name,
           staj_acidcre,
           pac_etid,
           period_lang01,
           0,
           (SELECT stajp_value
            FROM   sta_jobparam
            WHERE      stajp_jobid = staj_id
                   AND stajp_name = '[DATEFROM]')
               date_from,
           (SELECT stajp_value
            FROM   sta_jobparam
            WHERE      stajp_jobid = staj_id
                   AND stajp_name = '[DATETO]')
               date_to,
           NVL (
               (SELECT stajp_value
                FROM   sta_jobparam
                WHERE      stajp_jobid = staj_id
                       AND stajp_name = '[OP_KEY]'),
               staj_ltvalue)
               op_key,
           stajo_id,
           stajo_outputdir,
           stajo_filename,
           stajo_etid,
           pac_ltid,
           staj_ltvalue
           ,
           CASE pac_ltid        -- ac_name
           WHEN 'AC_ID'
           THEN 
           (SELECT min(a2.ac_name) 
           FROM account a2
           WHERE staj_ltvalue = a2.ac_id)
           ELSE '-'
           END 
           ,
           CASE pac_ltid        -- con_acname
           WHEN 'CON_ID'
           THEN 
           (SELECT min(c4.con_name) 
           FROM contract c4
           WHERE staj_ltvalue = c4.con_id)
           ELSE '-'
           END  
           ,
           CASE pac_ltid        -- ac_name
           WHEN 'AC_ID'
           THEN 
           (SELECT min(a2.ac_name) || CHR(10) || staj_info 
           FROM account a2
           WHERE staj_ltvalue = a2.ac_id)
           WHEN 'CON_ID'
           THEN 
           (SELECT min(c4.con_name) || CHR(10) || staj_info 
           FROM contract c4
           WHERE staj_ltvalue = c4.con_id)
           ELSE staj_info
           END 

    FROM   sta_web_job_base_is,
           sta_jobstate,
           sta_jobotype,
           sta_joboutput,
           periodicity
    WHERE      staj_esid = sta_jobstate.stajs_id
           AND staj_etid = sta_jobotype.staot_id(+)
           AND staj_id = sta_joboutput.stajo_jobid(+)
           AND pac_periodid = periodicity.period_id;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- STA_WEB_JOB_LIST_IW  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.STA_WEB_JOB_LIST_IW
(STAJ_ID, STAJ_DATECRE, STAJ_ESID, STAJS_LANG01, STAJ_ETID, 
 STAOT_LANG01, STAJ_PACID, PAC_NAME, AC_NAME_CRE, PAC_ETID, 
 PERIOD_LANG01, IS_REPEAT_JOB, DATE_FROM, DATE_TO, OP_KEY, 
 STAJO_ID, STAJO_OUTPUTDIR, STAJO_FILENAME, STAJO_ETID, PAC_LTID, 
 STAJ_LTVALUE, CON_NAME, CON_ACNAME, AC_NAME)
BEQUEATH DEFINER
AS 
SELECT
  STAJ_ID,
  STAJ_DATECRE,
  STAJ_ESID,
  STAJS_LANG01,
  STAJ_ETID,
  STAOT_LANG01,
  STAJ_PACID,
  PAC_NAME,
  STAJ_ACIDCRE,
  PAC_ETID,
  PERIOD_LANG01,
  0 IS_REPEAT_JOB,
  (SELECT STAJP_VALUE FROM STA_JOBPARAM WHERE STAJP_JOBID = STAJ_ID AND STAJP_NAME='[DATEFROM]') DATE_FROM,
  (SELECT STAJP_VALUE FROM STA_JOBPARAM WHERE STAJP_JOBID = STAJ_ID AND STAJP_NAME='[DATETO]') DATE_TO,
  NVL((SELECT STAJP_VALUE FROM STA_JOBPARAM WHERE STAJP_JOBID = STAJ_ID AND STAJP_NAME='[OP_KEY]'), STAJ_LTVALUE) OP_KEY,
  STAJO_ID,
  STAJO_OUTPUTDIR,
  STAJO_FILENAME,
  STAJO_ETID,
  PAC_LTID,
  STAJ_LTVALUE,
  (SELECT NVL(C4.CON_NAME,'-') FROM CONTRACT C4 WHERE STAJ_LTVALUE = C4.CON_ID(+)),
  (SELECT NVL(A3.AC_NAME,'-') FROM CONTRACT C3, ACCOUNT A3 WHERE STAJ_LTVALUE = C3.CON_ID(+) AND C3.CON_ACID = A3.AC_ID ),
  (SELECT NVL(A2.AC_NAME,'-') FROM ACCOUNT A2 WHERE STAJ_LTVALUE = A2.AC_ID(+))
FROM
  STA_WEB_JOB_BASE_IW, STA_JOBSTATE, STA_JOBOTYPE, PERIODICITY, STA_JOBOUTPUT, ACCOUNT A1
WHERE STAJ_ESID = STA_JOBSTATE.STAJS_ID
AND PAC_PERIODID = PERIODICITY.PERIOD_ID
AND STAJ_ETID = STA_JOBOTYPE.STAOT_ID (+)
AND STAJ_ID = STA_JOBOUTPUT.STAJO_JOBID (+)
AND STAJ_ACIDCRE = A1.AC_ID (+);


/* This object may not be sorted properly in the script due to cirular references. */
--
-- STA_WEB_JOB_LIST_LA  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.STA_WEB_JOB_LIST_LA
(STAJ_ID, STAJ_DATECRE, STAJ_ESID, STAJS_LANG01, STAJ_ETID, 
 STAOT_LANG01, STAJ_PACID, PAC_NAME, AC_NAME_CRE, PAC_ETID, 
 PERIOD_LANG01, IS_REPEAT_JOB, DATE_FROM, DATE_TO, OP_KEY, 
 STAJO_ID, STAJO_OUTPUTDIR, STAJO_FILENAME, STAJO_ETID, PAC_LTID, 
 STAJ_LTVALUE, CON_NAME, CON_ACNAME, AC_NAME)
BEQUEATH DEFINER
AS 
SELECT
  STAJ_ID,
  STAJ_DATECRE,
  STAJ_ESID,
  STAJS_LANG01,
  STAJ_ETID,
  STAOT_LANG01,
  STAJ_PACID,
  PAC_NAME,
  STAJ_ACIDCRE,
  PAC_ETID,
  PERIOD_LANG01,
  0 IS_REPEAT_JOB,
  (SELECT STAJP_VALUE FROM STA_JOBPARAM WHERE STAJP_JOBID = STAJ_ID AND STAJP_NAME='[DATEFROM]') DATE_FROM,
  (SELECT STAJP_VALUE FROM STA_JOBPARAM WHERE STAJP_JOBID = STAJ_ID AND STAJP_NAME='[DATETO]') DATE_TO,
  NVL((SELECT STAJP_VALUE FROM STA_JOBPARAM WHERE STAJP_JOBID = STAJ_ID AND STAJP_NAME='[OP_KEY]'), STAJ_LTVALUE) OP_KEY,
  STAJO_ID,
  STAJO_OUTPUTDIR,
  STAJO_FILENAME,
  STAJO_ETID,
  PAC_LTID,
  STAJ_LTVALUE,
  (SELECT NVL(C4.CON_NAME,'-') FROM CONTRACT C4 WHERE STAJ_LTVALUE = C4.CON_ID(+)),
  (SELECT NVL(A3.AC_NAME,'-') FROM CONTRACT C3, ACCOUNT A3 WHERE STAJ_LTVALUE = C3.CON_ID(+) AND C3.CON_ACID = A3.AC_ID ),
  (SELECT NVL(A2.AC_NAME,'-') FROM ACCOUNT A2 WHERE STAJ_LTVALUE = A2.AC_ID(+))
FROM
  STA_WEB_JOB_BASE_LA, STA_JOBSTATE, STA_JOBOTYPE, PERIODICITY, STA_JOBOUTPUT, ACCOUNT A1
WHERE STAJ_ESID = STA_JOBSTATE.STAJS_ID
AND PAC_PERIODID = PERIODICITY.PERIOD_ID
AND STAJ_ETID = STA_JOBOTYPE.STAOT_ID (+)
AND STAJ_ID = STA_JOBOUTPUT.STAJO_JOBID (+)
AND STAJ_ACIDCRE = A1.AC_ID (+);


/* This object may not be sorted properly in the script due to cirular references. */
--
-- STA_WEB_JOB_LIST_SYS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.STA_WEB_JOB_LIST_SYS
(STAJ_ID, STAJ_DATECRE, STAJ_ESID, STAJS_LANG01, STAJ_ETID, 
 STAOT_LANG01, STAJ_PACID, PAC_NAME, AC_NAME_CRE, PAC_ETID, 
 PERIOD_LANG01, IS_REPEAT_JOB, DATE_FROM, DATE_TO, OP_KEY, 
 STAJO_ID, STAJO_OUTPUTDIR, STAJO_FILENAME, STAJO_ETID, PAC_LTID, 
 STAJ_LTVALUE, CON_NAME, CON_ACNAME, AC_NAME)
BEQUEATH DEFINER
AS 
SELECT
  STAJ_ID,
  STAJ_DATECRE,
  STAJ_ESID,
  STAJS_LANG01,
  STAJ_ETID,
  STAOT_LANG01,
  STAJ_PACID,
  PAC_NAME,
  STAJ_ACIDCRE,
  PAC_ETID,
  PERIOD_LANG01,
  0 IS_REPEAT_JOB,
  (SELECT STAJP_VALUE FROM STA_JOBPARAM WHERE STAJP_JOBID = STAJ_ID AND STAJP_NAME='[DATEFROM]') DATE_FROM,
  (SELECT STAJP_VALUE FROM STA_JOBPARAM WHERE STAJP_JOBID = STAJ_ID AND STAJP_NAME='[DATETO]') DATE_TO,
  NVL((SELECT STAJP_VALUE FROM STA_JOBPARAM WHERE STAJP_JOBID = STAJ_ID AND STAJP_NAME='[OP_KEY]'), STAJ_LTVALUE) OP_KEY,
  STAJO_ID,
  STAJO_OUTPUTDIR,
  STAJO_FILENAME,
  STAJO_ETID,
  PAC_LTID,
  STAJ_LTVALUE,
  (SELECT NVL(C4.CON_NAME,'-') FROM CONTRACT C4 WHERE STAJ_LTVALUE = C4.CON_ID(+)),
  (SELECT NVL(A3.AC_NAME,'-') FROM CONTRACT C3, ACCOUNT A3 WHERE STAJ_LTVALUE = C3.CON_ID(+) AND C3.CON_ACID = A3.AC_ID ),
  (SELECT NVL(A2.AC_NAME,'-') FROM ACCOUNT A2 WHERE STAJ_LTVALUE = A2.AC_ID(+))
FROM
  STA_WEB_JOB_BASE_SYS, STA_JOBSTATE, STA_JOBOTYPE, PERIODICITY, STA_JOBOUTPUT, ACCOUNT A1
WHERE STAJ_ESID = STA_JOBSTATE.STAJS_ID
AND PAC_PERIODID = PERIODICITY.PERIOD_ID
AND STAJ_ETID = STA_JOBOTYPE.STAOT_ID (+)
AND STAJ_ID = STA_JOBOUTPUT.STAJO_JOBID (+)
AND STAJ_ACIDCRE = A1.AC_ID (+);


/* This object may not be sorted properly in the script due to cirular references. */
--
-- STA_WEB_STAT_ANALYSIS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.STA_WEB_STAT_ANALYSIS
(PAC_ID, PAC_NAME, PACT_LANG01, PACKS_LANG01, PAC_DATESTA, 
 CNT_JOB, SUM_R, SUM_A, SUM_L, SUM_O, 
 SUM_E, SUM_D, SUM_S, SUM_W)
BEQUEATH DEFINER
AS 
SELECT PAC_ID, PAC_NAME, PACT_LANG01, PACKS_LANG01, PAC_DATESTA, SUM(CNT_JOB) CNT_JOB, sum(cnt_r) SUM_R, sum(cnt_a) SUM_A, sum(cnt_l) SUM_L, sum(cnt_o) SUM_O, sum(cnt_e) SUM_E, sum(cnt_d) SUM_D, sum(cnt_s) SUM_S, sum(cnt_w) SUM_W
FROM 
(
SELECT PAC_ID, PAC_NAME, PAC_ETID, PAC_ESID, PAC_DATESTA, COUNT(STAJ_ESID) CNT_JOB, COUNT(STAJ_ID) CNT_R, 0 CNT_A, 0 CNT_L, 0 CNT_O, 0 CNT_E, 0 CNT_D, 0 CNT_S, 0 CNT_W FROM PACKING, STA_JOB WHERE PAC_ID = STAJ_PACID (+) AND PAC_ETID IN ('STAT','CONSOL','STATIND') AND (STAJ_ESID = 'R' OR STAJ_ESID IS NULL) GROUP BY PAC_ID, PAC_NAME, PAC_ETID, PAC_ESID, PAC_DATESTA, STAJ_ESID 
UNION 
SELECT PAC_ID, PAC_NAME, PAC_ETID, PAC_ESID, PAC_DATESTA, COUNT(STAJ_ESID) CNT_JOB, 0 CNT_R, COUNT(STAJ_ID) CNT_A, 0 CNT_L, 0 CNT_O, 0 CNT_E, 0 CNT_D, 0 CNT_S, 0 CNT_W FROM PACKING, STA_JOB WHERE PAC_ID = STAJ_PACID (+) AND PAC_ETID IN ('STAT','CONSOL','STATIND') AND (STAJ_ESID = 'A' OR STAJ_ESID IS NULL) GROUP BY PAC_ID, PAC_NAME, PAC_ETID, PAC_ESID, PAC_DATESTA, STAJ_ESID 
UNION 
SELECT PAC_ID, PAC_NAME, PAC_ETID, PAC_ESID, PAC_DATESTA, COUNT(STAJ_ESID) CNT_JOB, 0 CNT_R, 0 CNT_A, COUNT(STAJ_ID) CNT_L, 0 CNT_O, 0 CNT_E, 0 CNT_D, 0 CNT_S, 0 CNT_W FROM PACKING, STA_JOB WHERE PAC_ID = STAJ_PACID (+) AND PAC_ETID IN ('STAT','CONSOL','STATIND') AND (STAJ_ESID = 'L' OR STAJ_ESID IS NULL) GROUP BY PAC_ID, PAC_NAME, PAC_ETID, PAC_ESID, PAC_DATESTA, STAJ_ESID 
UNION 
SELECT PAC_ID, PAC_NAME, PAC_ETID, PAC_ESID, PAC_DATESTA, COUNT(STAJ_ESID) CNT_JOB, 0 CNT_R, 0 CNT_A, 0 CNT_L, COUNT(STAJ_ID) CNT_O, 0 CNT_E, 0 CNT_D, 0 CNT_S, 0 CNT_W FROM PACKING, STA_JOB WHERE PAC_ID = STAJ_PACID (+) AND PAC_ETID IN ('STAT','CONSOL','STATIND') AND (STAJ_ESID = 'O' OR STAJ_ESID IS NULL) GROUP BY PAC_ID, PAC_NAME, PAC_ETID, PAC_ESID, PAC_DATESTA, STAJ_ESID 
UNION 
SELECT PAC_ID, PAC_NAME, PAC_ETID, PAC_ESID, PAC_DATESTA, COUNT(STAJ_ESID) CNT_JOB, 0 CNT_R, 0 CNT_A, 0 CNT_L, 0 CNT_O, COUNT(STAJ_ID) CNT_E, 0 CNT_D, 0 CNT_S, 0 CNT_W FROM PACKING, STA_JOB WHERE PAC_ID = STAJ_PACID (+) AND PAC_ETID IN ('STAT','CONSOL','STATIND') AND (STAJ_ESID = 'E' OR STAJ_ESID IS NULL) GROUP BY PAC_ID, PAC_NAME, PAC_ETID, PAC_ESID, PAC_DATESTA, STAJ_ESID 
UNION 
SELECT PAC_ID, PAC_NAME, PAC_ETID, PAC_ESID, PAC_DATESTA, COUNT(STAJ_ESID) CNT_JOB, 0 CNT_R, 0 CNT_A, 0 CNT_L, 0 CNT_O, 0 CNT_E, COUNT(STAJ_ID) CNT_D, 0 CNT_S, 0 CNT_W FROM PACKING, STA_JOB WHERE PAC_ID = STAJ_PACID (+) AND PAC_ETID IN ('STAT','CONSOL','STATIND') AND (STAJ_ESID = 'D' OR STAJ_ESID IS NULL) GROUP BY PAC_ID, PAC_NAME, PAC_ETID, PAC_ESID, PAC_DATESTA, STAJ_ESID 
UNION 
SELECT PAC_ID, PAC_NAME, PAC_ETID, PAC_ESID, PAC_DATESTA, COUNT(STAJ_ESID) CNT_JOB, 0 CNT_R, 0 CNT_A, 0 CNT_L, 0 CNT_O, 0 CNT_E, 0 CNT_D, COUNT(STAJ_ID) CNT_S, 0 CNT_W FROM PACKING, STA_JOB WHERE PAC_ID = STAJ_PACID (+) AND PAC_ETID IN ('STAT','CONSOL','STATIND') AND (STAJ_ESID = 'S' OR STAJ_ESID IS NULL) GROUP BY PAC_ID, PAC_NAME, PAC_ETID, PAC_ESID, PAC_DATESTA, STAJ_ESID 
UNION 
SELECT PAC_ID, PAC_NAME, PAC_ETID, PAC_ESID, PAC_DATESTA, COUNT(STAJ_ESID) CNT_JOB, 0 CNT_R, 0 CNT_A, 0 CNT_L, 0 CNT_O, 0 CNT_E, 0 CNT_D, 0 CNT_S, COUNT(STAJ_ID) CNT_W FROM PACKING, STA_JOB WHERE PAC_ID = STAJ_PACID (+) AND PAC_ETID IN ('STAT','CONSOL','STATIND') AND (STAJ_ESID = 'W' OR STAJ_ESID IS NULL) GROUP BY PAC_ID, PAC_NAME, PAC_ETID, PAC_ESID, PAC_DATESTA, STAJ_ESID
), PACTYPE, PACKINGSTATE
WHERE PAC_ETID = PACT_ID
AND PAC_ESID = PACKS_ID
GROUP BY PAC_ID, PAC_NAME, PAC_ETID, PACT_LANG01, PACKS_LANG01, PAC_DATESTA
ORDER BY PACT_LANG01, PAC_NAME;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- STA_WEB_TEMP_LIST  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.STA_WEB_TEMP_LIST
(PAC_ID, PAC_NAME, PAC_LTID, LT_LANG01, PAC_ETID, 
 PACT_LANG01, PAC_ESID, PACKS_LANG01, PAC_PERIODID, PERIOD_LANG01, 
 PAC_STARTDAY, PAC_STARTHOUR, PAC_STARTMINUTE, PAC_DATEDONE, PAC_OUTPUTDIR, 
 PAC_TEMPLATE, PAC_MODIS, PAC_MODLA, PAC_MODIW, PAC_MODSYS)
BEQUEATH DEFINER
AS 
SELECT
PAC_ID,
PAC_NAME,
PAC_LTID,
Nvl(LT_LANG01, '-') LT_LANG01,
PAC_ETID,
Nvl(PACT_LANG01, '-') PACT_LANG01,
PAC_ESID,
Nvl(PACKS_LANG01, '-') PACKS_LANG01,
PAC_PERIODID,
Nvl(PERIOD_LANG01, '-') PERIOD_LANG01,
PAC_STARTDAY,
PAC_STARTHOUR,
PAC_STARTMINUTE,
PAC_DATEDONE,
PAC_OUTPUTDIR,
PAC_TEMPLATE,
PAC_MODIS,
PAC_MODLA,
PAC_MODIW,
PAC_MODSYS
FROM
  PACKING, PERIODICITY, PACTYPE, PACKINGSTATE, LOOPTYPE
WHERE PACKING.PAC_ETID = PACTYPE.PACT_ID
AND PACKING.PAC_LTID = LOOPTYPE.LT_ID
AND PACKING.PAC_ESID = PACKINGSTATE.PACKS_ID
AND PACKING.PAC_PERIODID = PERIODICITY.PERIOD_ID
AND PACKING.PAC_ETID IN ('STAT','STATIND','CONSOL');


/* This object may not be sorted properly in the script due to cirular references. */
--
-- SUSPEND_MEC_ICS  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.SUSPEND_MEC_ICS
(PAC_ID)
BEQUEATH DEFINER
AS 
SELECT
	MAX(PAC_ID)
FROM
	PACKING
WHERE
		PAC_ID Like 'ADD%P'
	AND	PAC_ESID = 'S'
	AND	PAC_PERIODID = 'MONTHLY'
	AND	PAC_LTID = 'NONE'
	AND	PAC_ETID = 'CONSOL'
	AND	SYSDATE >TRUNC(SYSDATE,'MONTH') + (PAC_STARTDAY-1) + ((PAC_STARTHOUR-0.5)+PAC_STARTMINUTE/60)/24;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- TORA_D_BDETAIL6_IOR_IN_OUT  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.TORA_D_BDETAIL6_IOR_IN_OUT
(AC_ID, AC_DATE, AC_VALUE)
BEQUEATH DEFINER
AS 
SELECT  /*+ NO_INDEX (BDETAIL6) */
        DECODE(SUBSTR(BDETAIL6.BD_CDRRECTYPE,4,1),'O','MMS_IN','MMS_OUT')       AC_ID,
        TRUNC(BD_DATESUBMIT)                                                    AC_DATE,
        COUNT(*)                                                                AC_VALUE
FROM            
        BDETAIL6 BDETAIL6
WHERE           
                BD_MAPSID = 'R'
        AND     BD_SRCTYPE = 'MMSC'
        AND     BD_DATETIME >= trunc(sysdate) - 10
        AND     BD_DATETIME < trunc(sysdate)
        AND     BD_DATESUBMIT>= trunc(sysdate) - 10
        AND     BD_MSGTYPE = 0
        AND NOT (BD_CDRRECTYPE LIKE '___Orecord'
        AND     BD_EVENTDISP <> 2)
        AND     BD_MSISDN_A <> 'mms-daemon@mms.natel.ch'

GROUP BY    TRUNC(BDETAIL6.BD_DATESUBMIT), DECODE(SUBSTR(BDETAIL6.BD_CDRRECTYPE,4,1),'O','MMS_IN','MMS_OUT');


/* This object may not be sorted properly in the script due to cirular references. */
--
-- TORA_D_SR054A_DETAILS_3_LEGAL  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.TORA_D_SR054A_DETAILS_3_LEGAL
(AC_ID, AC_DATE, AC_VALUE)
BEQUEATH DEFINER
AS 
select
    REVAH_SRCTYPE || '_' || REVAH_PACID || '_LEGAL'   AC_ID,
    revac_date AC_DATE,
    SUM(DECODE(REVASM_ETID,'LEGAL',REVAC_OUT,0)) AC_VALUE
from reva_header, reva_sigmask, reva_counter, packing
where revah_id = revasm_revahid
and revasm_id = revac_revasmid
and pac_id = REVAH_PACID
and revac_date >= trunc(sysdate) - 30
and revac_date < trunc(sysdate)
group by
    revah_pacid,
    REVAH_SRCTYPE,
    revac_date;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- TORA_D_SR054A_DETAILS_3_OUT  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.TORA_D_SR054A_DETAILS_3_OUT
(AC_ID, AC_DATE, AC_VALUE)
BEQUEATH DEFINER
AS 
select
    REVAH_SRCTYPE || '_' || REVAH_PACID || '_OUT'   AC_ID,
    revac_date AC_DATE,
    SUM(revac_out) AC_VALUE
from reva_header, reva_sigmask, reva_counter, packing
where revah_id = revasm_revahid
and revasm_id = revac_revasmid
and pac_id = REVAH_PACID
and revac_date >= trunc(sysdate) - 30
and revac_date < trunc(sysdate)
group by
    revah_pacid,
    REVAH_SRCTYPE,
    revac_date;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- TORA_D_SR054A_DETAILS_3_ZERO  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.TORA_D_SR054A_DETAILS_3_ZERO
(AC_ID, AC_DATE, AC_VALUE)
BEQUEATH DEFINER
AS 
select
    REVAH_SRCTYPE || '_' || REVAH_PACID || '_ZERO'   AC_ID,
    revac_date AC_DATE,
    SUM(DECODE(REVASM_ETID,'ZEROBILLED',REVAC_OUT,0)) AC_VALUE
from reva_header, reva_sigmask, reva_counter, packing
where revah_id = revasm_revahid
and revasm_id = revac_revasmid
and pac_id = REVAH_PACID
and revac_date >= trunc(sysdate) - 30
and revac_date < trunc(sysdate)
group by
    revah_pacid,
    REVAH_SRCTYPE,
    revac_date;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- TORA_D_0056_LATEST  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.TORA_D_0056_LATEST
(A_ID, HDR, AC_ID, PROC_DATE, PERIOD_TYPE, 
 PERIOD, RESULT, TXT)
BEQUEATH DEFINER
AS 
SELECT  'RA_0056', 'BOD', AC_ID, sysdate, 'D', AC_DATE, AC_VALUE, NULL
  FROM tora_d_sr054a_details_3_out
UNION ALL
SELECT  'RA_0056', 'BOD', AC_ID, sysdate, 'D', AC_DATE, AC_VALUE, NULL
  FROM tora_d_sr054a_details_3_zero
  WHERE AC_ID LIKE 'ISRV%' OR AC_VALUE <> 0
UNION ALL
SELECT 'RA_0056', 'BOD', AC_ID, sysdate, 'D', AC_DATE, AC_VALUE, NULL
  FROM tora_d_sr054a_details_3_legal
  WHERE AC_ID LIKE 'SMSN_MOSMS_CH_LEGAL' OR AC_VALUE <> 0;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- TORA_D_0065_LATEST  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.TORA_D_0065_LATEST
(A_ID, HDR, AC_ID, PROC_DATE, PERIOD_TYPE, 
 PERIOD, RESULT, TXT)
BEQUEATH DEFINER
AS 
SELECT 'RA_0065', 'BOD', "AC_ID", sysdate, 'D', "AC_DATE", "AC_VALUE", NULL
FROM TORA_D_BDETAIL6_IOR_IN_OUT
-- WHERE NOT EXISTS (
-- SELECT
--     E.ROWID
-- FROM
--     RACACHE E
-- WHERE E.RAC_AUDIT_ID = N.A_ID
-- AND E.RAC_ACID = N.AC_ID
-- AND E.RAC_PERIOD_TYPE = N.PERIOD_TYPE
-- AND E.RAC_PERIOD = N.PERIOD
-- AND E.RAC_ETID = N.HDR
-- )
-- ORDER BY 6 desc, 3
;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- TORA_D_0065_LATEST_SORTED  (View) 
--
CREATE OR REPLACE FORCE VIEW SBS1_ADMIN.TORA_D_0065_LATEST_SORTED
(A_ID, HDR, AC_ID, PROC_DATE, PERIOD_TYPE, 
 PERIOD, RESULT, TXT)
BEQUEATH DEFINER
AS 
SELECT 'RA_0065', 'BOD', "AC_ID", sysdate, 'D', "AC_DATE", "AC_VALUE", NULL
FROM TORA_D_BDETAIL6_IOR_IN_OUT
ORDER BY 6 desc, 3;


/* This object may not be sorted properly in the script due to cirular references. */
--
-- STA_WATCHPACKINGSTATECHANGES  (Trigger) 
--
CREATE OR REPLACE TRIGGER SBS1_ADMIN.STA_WATCHPACKINGSTATECHANGES 
 AFTER
   DELETE OR UPDATE OF PAC_ESID
 ON SBS1_ADMIN.PACKING
REFERENCING NEW AS NEW OLD AS OLD
 FOR EACH ROW
WHEN (
new.pac_esid in ('R','A','I','D','L')
and new.pac_etid in ('CONSOL', 'STAT', 'STATIND', 'ZIPTREE')
      )
DECLARE
    vNewPacLtid packing.pac_ltid%type;
    vOldPacLtid packing.pac_ltid%type;

    vNewPacEsid packing.pac_esid%type;
    vOldPacEsid packing.pac_esid%type;
    vPacId packing.pac_id%type;

    -- PRAGMA AUTONOMOUS_TRANSACTION;
    
BEGIN
    vNewPacLtid := :NEW.pac_ltid;
    vOldPacLtid := :OLD.pac_ltid;
    vNewPacEsid := :NEW.pac_esid;
    vOldPacEsid := :OLD.pac_esid;
    vPacId := :NEW.pac_id;

    pkg_common_stats.watchPackageStateChanges(vPacId, vOldPacEsid, vNewPacEsid, vOldPacLtid, vNewPacLtid);
   --  L('STA_WatchPackingStateChanges', vPacId || ' / ' || vOldPacEsid || ' -> ' || vNewPacEsid || ' / ' || vOldPacLtid || ' -> ' || vNewPacLtid);
END;
/


/* This object may not be sorted properly in the script due to cirular references. */
--
-- PPB_CDRMMS  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.PPB_CDRMMS FOR CDRMMS@"PPB_RO_DBL.EXASTAG.PIOSCS";


/* This object may not be sorted properly in the script due to cirular references. */
--
-- PPB_CDRSMS  (Synonym) 
--
CREATE SYNONYM SBS1_ADMIN.PPB_CDRSMS FOR CDRSMS@"PPB_RO_DBL.EXASTAG.PIOSCS";


-- 
-- Non Foreign Key Constraints for Table ACSTATE 
-- 
ALTER TABLE SBS1_ADMIN.ACSTATE ADD (
  CONSTRAINT PK_ACSTATE
  PRIMARY KEY
  (ACS_ID)
  USING INDEX SBS1_ADMIN.PK_ACSTATE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table ACTYPE 
-- 
ALTER TABLE SBS1_ADMIN.ACTYPE ADD (
  CONSTRAINT PK_ACTYPE
  PRIMARY KEY
  (ACT_ID)
  USING INDEX SBS1_ADMIN.PK_ACTYPE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table ADRSTATE 
-- 
ALTER TABLE SBS1_ADMIN.ADRSTATE ADD (
  CONSTRAINT PK_ADRSTATE
  PRIMARY KEY
  (ADRS_ID)
  USING INDEX SBS1_ADMIN.PK_ADRSTATE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table ADRTYPE 
-- 
ALTER TABLE SBS1_ADMIN.ADRTYPE ADD (
  CONSTRAINT PK_ADRTYPE
  PRIMARY KEY
  (ADRT_ID)
  USING INDEX SBS1_ADMIN.PK_ADRTYPE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table APP_PERMISSION 
-- 
ALTER TABLE SBS1_ADMIN.APP_PERMISSION ADD (
  CONSTRAINT PK_APP_PERMISSION
  PRIMARY KEY
  (APP_PERM_ID)
  USING INDEX SBS1_ADMIN.PK_APP_PERMISSION
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table BDBSTATE 
-- 
ALTER TABLE SBS1_ADMIN.BDBSTATE ADD (
  CONSTRAINT PK_BDBSTATE
  PRIMARY KEY
  (BDBS_ID)
  USING INDEX SBS1_ADMIN.PK_BDBSTATE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table BDCSTATE 
-- 
ALTER TABLE SBS1_ADMIN.BDCSTATE ADD (
  CONSTRAINT PK_BDCSTATE
  PRIMARY KEY
  (BDCS_ID)
  USING INDEX SBS1_ADMIN.PK_BDCSTATE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table BDCTYPE 
-- 
ALTER TABLE SBS1_ADMIN.BDCTYPE ADD (
  CONSTRAINT PK_BDCTYPE
  PRIMARY KEY
  (BDCT_ID)
  USING INDEX SBS1_ADMIN.PK_BDCTYPE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table BD1STATUS 
-- 
ALTER TABLE SBS1_ADMIN.BD1STATUS ADD (
  CONSTRAINT PK_BD1STATUS
  PRIMARY KEY
  (BD1S_ID)
  USING INDEX SBS1_ADMIN.PK_BD1STATUS
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table BD2STATUS 
-- 
ALTER TABLE SBS1_ADMIN.BD2STATUS ADD (
  CONSTRAINT PK_BD2STATUS
  PRIMARY KEY
  (BD2S_ID)
  USING INDEX SBS1_ADMIN.PK_BD2STATUS
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table BIHSTATE 
-- 
ALTER TABLE SBS1_ADMIN.BIHSTATE ADD (
  CONSTRAINT PK_BIHSTATE
  PRIMARY KEY
  (BIHS_ID)
  USING INDEX SBS1_ADMIN.PK_BIHSTATE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table BOHSTATE 
-- 
ALTER TABLE SBS1_ADMIN.BOHSTATE ADD (
  CONSTRAINT PK_BOHSTATE
  PRIMARY KEY
  (BOHS_ID)
  USING INDEX SBS1_ADMIN.PK_BOHSTATE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table BOSTATE 
-- 
ALTER TABLE SBS1_ADMIN.BOSTATE ADD (
  CONSTRAINT PK_BOSTATE
  PRIMARY KEY
  (BOS_ID)
  USING INDEX SBS1_ADMIN.PK_BOSTATE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table CARRIER 
-- 
ALTER TABLE SBS1_ADMIN.CARRIER ADD (
  CONSTRAINT PK_CARRIER
  PRIMARY KEY
  (CAR_ID)
  USING INDEX SBS1_ADMIN.PK_CARRIER
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table CDRTYPE 
-- 
ALTER TABLE SBS1_ADMIN.CDRTYPE ADD (
  CONSTRAINT PK_CDRTYPE
  PRIMARY KEY
  (CDRT_ID)
  USING INDEX SBS1_ADMIN.PK_CDRTYPE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table CODE 
-- 
ALTER TABLE SBS1_ADMIN.CODE ADD (
  CONSTRAINT PK_CODE
  PRIMARY KEY
  (CD_ID)
  USING INDEX SBS1_ADMIN.PK_CODE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table CONSTATE 
-- 
ALTER TABLE SBS1_ADMIN.CONSTATE ADD (
  CONSTRAINT PK_CONSTATE
  PRIMARY KEY
  (CONS_ID)
  USING INDEX SBS1_ADMIN.PK_CONSTATE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table CONTYPE 
-- 
ALTER TABLE SBS1_ADMIN.CONTYPE ADD (
  CONSTRAINT PK_CONTYPE
  PRIMARY KEY
  (CONT_ID)
  USING INDEX SBS1_ADMIN.PK_CONTYPE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table CSSTATE 
-- 
ALTER TABLE SBS1_ADMIN.CSSTATE ADD (
  CONSTRAINT PK_CSSTATE
  PRIMARY KEY
  (CSS_ID)
  USING INDEX SBS1_ADMIN.PK_CSSTATE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table CTRSTATE 
-- 
ALTER TABLE SBS1_ADMIN.CTRSTATE ADD (
  CONSTRAINT PK_CTRSTATE
  PRIMARY KEY
  (CTRS_ID)
  USING INDEX SBS1_ADMIN.PK_CTRSTATE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table CTRTYPE 
-- 
ALTER TABLE SBS1_ADMIN.CTRTYPE ADD (
  CONSTRAINT PK_CTRTYPE
  PRIMARY KEY
  (CTRT_ID)
  USING INDEX SBS1_ADMIN.PK_CTRTYPE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table CURRENCY 
-- 
ALTER TABLE SBS1_ADMIN.CURRENCY ADD (
  CONSTRAINT PK_CURRENCY
  PRIMARY KEY
  (CUR_ID)
  USING INDEX SBS1_ADMIN.PK_CURRENCY
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table DBASE 
-- 
ALTER TABLE SBS1_ADMIN.DBASE ADD (
  CONSTRAINT PK_DBASE
  PRIMARY KEY
  (DB_ID)
  USING INDEX SBS1_ADMIN.PK_DBASE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table DBSS_LOG 
-- 
ALTER TABLE SBS1_ADMIN.DBSS_LOG ADD (
  CONSTRAINT DBSS_LOG_PK
  PRIMARY KEY
  (CKEY)
  USING INDEX SBS1_ADMIN.DBSS_LOG_PK
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table DGTICSTATE 
-- 
ALTER TABLE SBS1_ADMIN.DGTICSTATE ADD (
  CONSTRAINT PK_DGTICSTATE
  PRIMARY KEY
  (DGTICS_ID)
  USING INDEX SBS1_ADMIN.PK_DGTICSTATE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table DGTICTYPE 
-- 
ALTER TABLE SBS1_ADMIN.DGTICTYPE ADD (
  CONSTRAINT PK_DGTICTYPE
  PRIMARY KEY
  (DGTICT_ID)
  USING INDEX SBS1_ADMIN.PK_DGTICTYPE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table ENPLAACTIONTYPE 
-- 
ALTER TABLE SBS1_ADMIN.ENPLAACTIONTYPE ADD (
  CONSTRAINT PK_ENPLAACTIONTYPE
  PRIMARY KEY
  (ENPLARAT_ID)
  USING INDEX SBS1_ADMIN.PK_ENPLAACTIONTYPE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table ENPLARANGE 
-- 
ALTER TABLE SBS1_ADMIN.ENPLARANGE ADD (
  CONSTRAINT PK_ENPLARANGE
  PRIMARY KEY
  (ENPLAR_ID)
  USING INDEX SBS1_ADMIN.PK_ENPLARANGE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table ENPLARANGEENTRY 
-- 
ALTER TABLE SBS1_ADMIN.ENPLARANGEENTRY ADD (
  CONSTRAINT PK_ENPLARANGEENTRY
  PRIMARY KEY
  (ENPLARE_ENPLARID, ENPLARE_PREFIX, ENPLARE_START)
  USING INDEX SBS1_ADMIN.PK_ENPLARANGEENTRY
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table ENPLARANGESTATE 
-- 
ALTER TABLE SBS1_ADMIN.ENPLARANGESTATE ADD (
  CONSTRAINT PK_ENPLARANGESTATE
  PRIMARY KEY
  (ENPLARS_ID)
  USING INDEX SBS1_ADMIN.PK_ENPLARANGESTATE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table ENUMERATOR 
-- 
ALTER TABLE SBS1_ADMIN.ENUMERATOR ADD (
  CONSTRAINT PK_ENUMERATOR
  PRIMARY KEY
  (ENUM_ID)
  USING INDEX SBS1_ADMIN.PK_ENUMERATOR
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table ENUM256 
-- 
ALTER TABLE SBS1_ADMIN.ENUM256 ADD (
  CONSTRAINT PK_ENUM256
  PRIMARY KEY
  (ENUM_ID)
  USING INDEX SBS1_ADMIN.PK_ENUM256
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table ERRDEF 
-- 
ALTER TABLE SBS1_ADMIN.ERRDEF ADD (
  CONSTRAINT PK_ERRDEF
  PRIMARY KEY
  (ERRD_ID)
  USING INDEX SBS1_ADMIN.PK_ERRDEF
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table ERRORVIEW 
-- 
ALTER TABLE SBS1_ADMIN.ERRORVIEW ADD (
  CONSTRAINT PK_ERRORVIEW
  PRIMARY KEY
  (ERV_ID)
  USING INDEX SBS1_ADMIN.PK_ERRORVIEW
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table ERRTYPE 
-- 
ALTER TABLE SBS1_ADMIN.ERRTYPE ADD (
  CONSTRAINT PK_ERRTYPE
  PRIMARY KEY
  (ERRT_ID)
  USING INDEX SBS1_ADMIN.PK_ERRTYPE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table ERVPERMISSIONS 
-- 
ALTER TABLE SBS1_ADMIN.ERVPERMISSIONS ADD (
  CONSTRAINT PK_ERVPERMISSIONS
  PRIMARY KEY
  (ERVP_ACTID, ERVP_ERVID)
  USING INDEX SBS1_ADMIN.PK_ERVPERMISSIONS
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table ERVTIMESPAN 
-- 
ALTER TABLE SBS1_ADMIN.ERVTIMESPAN ADD (
  CONSTRAINT PK_ERVTIMESPAN
  PRIMARY KEY
  (ERVTSP_ID)
  USING INDEX SBS1_ADMIN.PK_ERVTIMESPAN
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table EXCHANGERATE 
-- 
ALTER TABLE SBS1_ADMIN.EXCHANGERATE ADD (
  CONSTRAINT PK_EXCHANGERATE
  PRIMARY KEY
  (EXR_ID)
  USING INDEX SBS1_ADMIN.PK_EXCHANGERATE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table GART 
-- 
ALTER TABLE SBS1_ADMIN.GART ADD (
  CONSTRAINT PK_GART
  PRIMARY KEY
  (GRT_ID)
  USING INDEX SBS1_ADMIN.PK_GART
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table IMSIRANGE 
-- 
ALTER TABLE SBS1_ADMIN.IMSIRANGE ADD (
  CONSTRAINT PK_IMSIRANGE
  PRIMARY KEY
  (IMR_ID)
  USING INDEX SBS1_ADMIN.PK_IMSIRANGE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table INDEXSTATE 
-- 
ALTER TABLE SBS1_ADMIN.INDEXSTATE ADD (
  CONSTRAINT PK_INDEXSTATE
  PRIMARY KEY
  (INDEXS_MAPID, INDEXS_ID)
  USING INDEX SBS1_ADMIN.PK_INDEXSTATE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table ISC_AGGREGATION 
-- 
ALTER TABLE SBS1_ADMIN.ISC_AGGREGATION ADD (
  CONSTRAINT PK_ISC_AGGREGATION
  PRIMARY KEY
  (ISCA_ID)
  USING INDEX SBS1_ADMIN.PK_ISC_AGGREGATION
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table ISCCDRTYPE 
-- 
ALTER TABLE SBS1_ADMIN.ISCCDRTYPE ADD (
  CONSTRAINT PK_ISCCDRTYPE
  PRIMARY KEY
  (ISCCDRT_ID)
  USING INDEX SBS1_ADMIN.PK_ISCCDRTYPE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table ISCSTATE 
-- 
ALTER TABLE SBS1_ADMIN.ISCSTATE ADD (
  CONSTRAINT PK_ISCSTATE
  PRIMARY KEY
  (ISCS_ID)
  USING INDEX SBS1_ADMIN.PK_ISCSTATE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table ISSTATE 
-- 
ALTER TABLE SBS1_ADMIN.ISSTATE ADD (
  CONSTRAINT PK_ISSTATE
  PRIMARY KEY
  (ISS_ID)
  USING INDEX SBS1_ADMIN.PK_ISSTATE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table ISTYPE 
-- 
ALTER TABLE SBS1_ADMIN.ISTYPE ADD (
  CONSTRAINT PK_ISTYPE
  PRIMARY KEY
  (IST_ID)
  USING INDEX SBS1_ADMIN.PK_ISTYPE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table IWDIRECTION 
-- 
ALTER TABLE SBS1_ADMIN.IWDIRECTION ADD (
  CONSTRAINT PK_IWDIRECTION
  PRIMARY KEY
  (IWD_ID)
  USING INDEX SBS1_ADMIN.PK_IWDIRECTION
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table IWTSSTATE 
-- 
ALTER TABLE SBS1_ADMIN.IWTSSTATE ADD (
  CONSTRAINT PK_IWTSSTATE
  PRIMARY KEY
  (IWTSS_ID)
  USING INDEX SBS1_ADMIN.PK_IWTSSTATE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table KPI_HISTORY 
-- 
ALTER TABLE SBS1_ADMIN.KPI_HISTORY ADD (
  CONSTRAINT PK_KPI_HISTORY
  PRIMARY KEY
  (KPIH_VIEW, KPIH_PERIOD)
  USING INDEX SBS1_ADMIN.PK_KPI_HISTORY
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table LANGUAGE 
-- 
ALTER TABLE SBS1_ADMIN.LANGUAGE ADD (
  CONSTRAINT PK_LANGUAGE
  PRIMARY KEY
  (LANG_ID)
  USING INDEX SBS1_ADMIN.PK_LANGUAGE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table LOGGER_LOGS 
-- 
ALTER TABLE SBS1_ADMIN.LOGGER_LOGS ADD (
  CONSTRAINT LOGGER_LOGS_LVL_CK
  CHECK (logger_level in (1,2,4,8,16,32,64,128))
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.LOGGER_LOGS ADD (
  CONSTRAINT LOGGER_LOGS_PK
  PRIMARY KEY
  (ID)
  USING INDEX SBS1_ADMIN.LOGGER_LOGS_PK
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table LONGIDMSTATE 
-- 
ALTER TABLE SBS1_ADMIN.LONGIDMSTATE ADD (
  CONSTRAINT PK_LONGIDMSTATE
  PRIMARY KEY
  (LONGIDMS_ID)
  USING INDEX SBS1_ADMIN.PK_LONGIDMSTATE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table LOOPTYPE 
-- 
ALTER TABLE SBS1_ADMIN.LOOPTYPE ADD (
  CONSTRAINT PK_LOOPTYPE
  PRIMARY KEY
  (LT_ID)
  USING INDEX SBS1_ADMIN.PK_LOOPTYPE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table MAPSTATE 
-- 
ALTER TABLE SBS1_ADMIN.MAPSTATE ADD (
  CONSTRAINT PK_MAPSTATE
  PRIMARY KEY
  (MAPS_ID)
  USING INDEX SBS1_ADMIN.PK_MAPSTATE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table MAPTYPE 
-- 
ALTER TABLE SBS1_ADMIN.MAPTYPE ADD (
  CONSTRAINT PK_MAPTYPE
  PRIMARY KEY
  (MAPT_ID)
  USING INDEX SBS1_ADMIN.PK_MAPTYPE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table MBUNIT 
-- 
ALTER TABLE SBS1_ADMIN.MBUNIT ADD (
  CONSTRAINT PK_MBUNIT
  PRIMARY KEY
  (MBU_ID)
  USING INDEX SBS1_ADMIN.PK_MBUNIT
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table MMSATYPE 
-- 
ALTER TABLE SBS1_ADMIN.MMSATYPE ADD (
  CONSTRAINT PK_MMSATYPE
  PRIMARY KEY
  (MMSAT_ID)
  USING INDEX SBS1_ADMIN.PK_MMSATYPE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table MMSCC 
-- 
ALTER TABLE SBS1_ADMIN.MMSCC ADD (
  CONSTRAINT PK_MMSCC
  PRIMARY KEY
  (MMSCC_ID)
  USING INDEX SBS1_ADMIN.PK_MMSCC
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table MMSC_CDRRECTYPE 
-- 
ALTER TABLE SBS1_ADMIN.MMSC_CDRRECTYPE ADD (
  CONSTRAINT PK_MMSC_CDRRECTYPE
  PRIMARY KEY
  (MMSCCRT_ID)
  USING INDEX SBS1_ADMIN.PK_MMSC_CDRRECTYPE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table MMSC_EVENTDISPTYPE 
-- 
ALTER TABLE SBS1_ADMIN.MMSC_EVENTDISPTYPE ADD (
  CONSTRAINT PK_MMSC_EVENTDISPTYPE
  PRIMARY KEY
  (MMSCET_ID)
  USING INDEX SBS1_ADMIN.PK_MMSC_EVENTDISPTYPE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table MMSC_MSGCLASS 
-- 
ALTER TABLE SBS1_ADMIN.MMSC_MSGCLASS ADD (
  CONSTRAINT PK_MMSC_MSGCLASS
  PRIMARY KEY
  (MMSCMC_ID)
  USING INDEX SBS1_ADMIN.PK_MMSC_MSGCLASS
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table MMSC_MSGTYPE 
-- 
ALTER TABLE SBS1_ADMIN.MMSC_MSGTYPE ADD (
  CONSTRAINT PK_MMSC_MSGTYPE
  PRIMARY KEY
  (MMSCMT_ID)
  USING INDEX SBS1_ADMIN.PK_MMSC_MSGTYPE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table MMSDZ 
-- 
ALTER TABLE SBS1_ADMIN.MMSDZ ADD (
  CONSTRAINT PK_MMSDZ
  PRIMARY KEY
  (MMSDZ_ID)
  USING INDEX SBS1_ADMIN.PK_MMSDZ
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table MMSRZ 
-- 
ALTER TABLE SBS1_ADMIN.MMSRZ ADD (
  CONSTRAINT PK_MMSRZ
  PRIMARY KEY
  (MMSRZ_ID)
  USING INDEX SBS1_ADMIN.PK_MMSRZ
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table MMSSZ 
-- 
ALTER TABLE SBS1_ADMIN.MMSSZ ADD (
  CONSTRAINT PK_MMSSZ
  PRIMARY KEY
  (MMSSZ_ID)
  USING INDEX SBS1_ADMIN.PK_MMSSZ
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table MOTYPE 
-- 
ALTER TABLE SBS1_ADMIN.MOTYPE ADD (
  CONSTRAINT PK_MOTYPE
  PRIMARY KEY
  (MOT_ID)
  USING INDEX SBS1_ADMIN.PK_MOTYPE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table NOTIFICATIONSTATE 
-- 
ALTER TABLE SBS1_ADMIN.NOTIFICATIONSTATE ADD (
  CONSTRAINT PK_NOTIFICATIONSTATE
  PRIMARY KEY
  (NOTS_ID)
  USING INDEX SBS1_ADMIN.PK_NOTIFICATIONSTATE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table NOTIFICATIONTYPE 
-- 
ALTER TABLE SBS1_ADMIN.NOTIFICATIONTYPE ADD (
  CONSTRAINT PK_NOTIFICATIONTYPE
  PRIMARY KEY
  (NOTT_ID)
  USING INDEX SBS1_ADMIN.PK_NOTIFICATIONTYPE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table OGTICSTATE 
-- 
ALTER TABLE SBS1_ADMIN.OGTICSTATE ADD (
  CONSTRAINT PK_OGTICSTATE
  PRIMARY KEY
  (OGTICS_ID)
  USING INDEX SBS1_ADMIN.PK_OGTICSTATE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table OGTICTYPE 
-- 
ALTER TABLE SBS1_ADMIN.OGTICTYPE ADD (
  CONSTRAINT PK_OGTICTYPE
  PRIMARY KEY
  (OGTICT_ID)
  USING INDEX SBS1_ADMIN.PK_OGTICTYPE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table PACITERATOR 
-- 
ALTER TABLE SBS1_ADMIN.PACITERATOR ADD (
  CONSTRAINT PK_ITERATOR
  PRIMARY KEY
  (PACI_ID)
  USING INDEX SBS1_ADMIN.PK_ITERATOR
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table PACKINGSTATE 
-- 
ALTER TABLE SBS1_ADMIN.PACKINGSTATE ADD (
  CONSTRAINT PK_PACKINGSTATE
  PRIMARY KEY
  (PACKS_ID)
  USING INDEX SBS1_ADMIN.PK_PACKINGSTATE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table PACSTATE 
-- 
ALTER TABLE SBS1_ADMIN.PACSTATE ADD (
  CONSTRAINT PK_PACSTATE
  PRIMARY KEY
  (PACS_ID)
  USING INDEX SBS1_ADMIN.PK_PACSTATE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table PACTYPE 
-- 
ALTER TABLE SBS1_ADMIN.PACTYPE ADD (
  CONSTRAINT PK_PACTYPE
  PRIMARY KEY
  (PACT_ID)
  USING INDEX SBS1_ADMIN.PK_PACTYPE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table PARTAG_CONFIG 
-- 
ALTER TABLE SBS1_ADMIN.PARTAG_CONFIG ADD (
  CONSTRAINT PK_PARTAG_CONFIG
  PRIMARY KEY
  (PARTAGC_ID)
  USING INDEX SBS1_ADMIN.PK_PARTAG_CONFIG
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table PERIODICITY 
-- 
ALTER TABLE SBS1_ADMIN.PERIODICITY ADD (
  CONSTRAINT PK_PERIODICITY
  PRIMARY KEY
  (PERIOD_ID)
  USING INDEX SBS1_ADMIN.PK_PERIODICITY
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table PMSTATE 
-- 
ALTER TABLE SBS1_ADMIN.PMSTATE ADD (
  CONSTRAINT PK_PMSTATE
  PRIMARY KEY
  (PMS_ID)
  USING INDEX SBS1_ADMIN.PK_PMSTATE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table PMVSTATE 
-- 
ALTER TABLE SBS1_ADMIN.PMVSTATE ADD (
  CONSTRAINT PK_PMVSTATE
  PRIMARY KEY
  (PMVS_ID)
  USING INDEX SBS1_ADMIN.PK_PMVSTATE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table PROTTYPE 
-- 
ALTER TABLE SBS1_ADMIN.PROTTYPE ADD (
  CONSTRAINT PK_PROTTYPE
  PRIMARY KEY
  (PROTT_ID)
  USING INDEX SBS1_ADMIN.PK_PROTTYPE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table PROXYTYPE 
-- 
ALTER TABLE SBS1_ADMIN.PROXYTYPE ADD (
  CONSTRAINT PK_PROXYTYPE
  PRIMARY KEY
  (PROXYT_ID)
  USING INDEX SBS1_ADMIN.PK_PROXYTYPE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table RACACHE 
-- 
ALTER TABLE SBS1_ADMIN.RACACHE ADD (
  CONSTRAINT PK_RACACHE
  PRIMARY KEY
  (RAC_AUDIT_ID, RAC_ACID, RAC_PERIOD_TYPE, RAC_PERIOD, RAC_ETID)
  USING INDEX SBS1_ADMIN.PK_RACACHE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table REQTYPE 
-- 
ALTER TABLE SBS1_ADMIN.REQTYPE ADD (
  CONSTRAINT PK_REQTYPE
  PRIMARY KEY
  (REQT_ID)
  USING INDEX SBS1_ADMIN.PK_REQTYPE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table RETSCHEMA 
-- 
ALTER TABLE SBS1_ADMIN.RETSCHEMA ADD (
  CONSTRAINT PK_RETSCHEMA
  PRIMARY KEY
  (RS_ID)
  USING INDEX SBS1_ADMIN.PK_RETSCHEMA
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table REVA_ANASTATE 
-- 
ALTER TABLE SBS1_ADMIN.REVA_ANASTATE ADD (
  CONSTRAINT PK_REVA_ANASTATE
  PRIMARY KEY
  (REVAST_SRCTYPE, REVAST_ID)
  USING INDEX SBS1_ADMIN.PK_REVA_ANASTATE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table REVA_BILLEDITEM 
-- 
ALTER TABLE SBS1_ADMIN.REVA_BILLEDITEM ADD (
  CONSTRAINT PK_REVA_BILLEDITEM
  PRIMARY KEY
  (REVABI_ID)
  USING INDEX SBS1_ADMIN.PK_REVA_BILLEDITEM
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table REVA_BILLTYPE 
-- 
ALTER TABLE SBS1_ADMIN.REVA_BILLTYPE ADD (
  CONSTRAINT PK_REVA_BILLTYPE
  PRIMARY KEY
  (REVABT_ID)
  USING INDEX SBS1_ADMIN.PK_REVA_BILLTYPE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table REVA_CONFIG 
-- 
ALTER TABLE SBS1_ADMIN.REVA_CONFIG ADD (
  CONSTRAINT PK_REVA_CONFIG
  PRIMARY KEY
  (REVAC_ID)
  USING INDEX SBS1_ADMIN.PK_REVA_CONFIG
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table REVA_SIGTYPE 
-- 
ALTER TABLE SBS1_ADMIN.REVA_SIGTYPE ADD (
  CONSTRAINT PK_REVA_SIGTYPE
  PRIMARY KEY
  (REVAT_ID)
  USING INDEX SBS1_ADMIN.PK_REVA_SIGTYPE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table REVA_STATE 
-- 
ALTER TABLE SBS1_ADMIN.REVA_STATE ADD (
  CONSTRAINT PK_REVA_STATE
  PRIMARY KEY
  (REVAS_ID)
  USING INDEX SBS1_ADMIN.PK_REVA_STATE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table REVI_CONFIG 
-- 
ALTER TABLE SBS1_ADMIN.REVI_CONFIG ADD (
  CONSTRAINT PK_REVI_CONFIG
  PRIMARY KEY
  (REVIC_ID)
  USING INDEX SBS1_ADMIN.PK_REVI_CONFIG
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table ROCSTATE 
-- 
ALTER TABLE SBS1_ADMIN.ROCSTATE ADD (
  CONSTRAINT PK_ROCSTATE
  PRIMARY KEY
  (ROCS_ID)
  USING INDEX SBS1_ADMIN.PK_ROCSTATE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table ROCTYPE 
-- 
ALTER TABLE SBS1_ADMIN.ROCTYPE ADD (
  CONSTRAINT PK_ROCTYPE
  PRIMARY KEY
  (ROCT_ID)
  USING INDEX SBS1_ADMIN.PK_ROCTYPE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table SCRIPTSTATE 
-- 
ALTER TABLE SBS1_ADMIN.SCRIPTSTATE ADD (
  CONSTRAINT PK_SCRIPTSTATE
  PRIMARY KEY
  (SCRS_ID)
  USING INDEX SBS1_ADMIN.PK_SCRIPTSTATE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table SEDSTATE 
-- 
ALTER TABLE SBS1_ADMIN.SEDSTATE ADD (
  CONSTRAINT PK_SEDSTATE
  PRIMARY KEY
  (SEDS_ID)
  USING INDEX SBS1_ADMIN.PK_SEDSTATE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table SEDTYPE 
-- 
ALTER TABLE SBS1_ADMIN.SEDTYPE ADD (
  CONSTRAINT PK_SEDTYPE
  PRIMARY KEY
  (SEDT_ID)
  USING INDEX SBS1_ADMIN.PK_SEDTYPE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table SETPERIOD 
-- 
ALTER TABLE SBS1_ADMIN.SETPERIOD ADD (
  CONSTRAINT PK_SETPERIOD
  PRIMARY KEY
  (SEP_ID)
  USING INDEX SBS1_ADMIN.PK_SETPERIOD
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table SETSTATE 
-- 
ALTER TABLE SBS1_ADMIN.SETSTATE ADD (
  CONSTRAINT PK_SETSTATE
  PRIMARY KEY
  (SETS_ID)
  USING INDEX SBS1_ADMIN.PK_SETSTATE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table SETTYPE 
-- 
ALTER TABLE SBS1_ADMIN.SETTYPE ADD (
  CONSTRAINT PK_SETTYPE
  PRIMARY KEY
  (SETT_ID)
  USING INDEX SBS1_ADMIN.PK_SETTYPE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table SMSCSTATE 
-- 
ALTER TABLE SBS1_ADMIN.SMSCSTATE ADD (
  CONSTRAINT PK_SMSCSTATE
  PRIMARY KEY
  (SMSCS_ID)
  USING INDEX SBS1_ADMIN.PK_SMSCSTATE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table SRASTYPE 
-- 
ALTER TABLE SBS1_ADMIN.SRASTYPE ADD (
  CONSTRAINT PK_SRASTYPE
  PRIMARY KEY
  (SRAST_ID)
  USING INDEX SBS1_ADMIN.PK_SRASTYPE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table SRCTYPE 
-- 
ALTER TABLE SBS1_ADMIN.SRCTYPE ADD (
  CONSTRAINT PK_SRCTYPE
  PRIMARY KEY
  (SRCT_ID)
  USING INDEX SBS1_ADMIN.PK_SRCTYPE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table STA_CONFIG 
-- 
ALTER TABLE SBS1_ADMIN.STA_CONFIG ADD (
  CONSTRAINT PK_STACONFIG
  PRIMARY KEY
  (STAC_ID)
  USING INDEX SBS1_ADMIN.PK_STACONFIG
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table STA_JOBOTYPE 
-- 
ALTER TABLE SBS1_ADMIN.STA_JOBOTYPE ADD (
  CONSTRAINT PK_STAJOBOTYPE
  PRIMARY KEY
  (STAOT_ID)
  USING INDEX SBS1_ADMIN.PK_STAJOBOTYPE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table STA_JOBSTATE 
-- 
ALTER TABLE SBS1_ADMIN.STA_JOBSTATE ADD (
  CONSTRAINT PK_STAJOBSTATE
  PRIMARY KEY
  (STAJS_ID)
  USING INDEX SBS1_ADMIN.PK_STAJOBSTATE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table STYPE 
-- 
ALTER TABLE SBS1_ADMIN.STYPE ADD (
  CONSTRAINT PK_STYPE
  PRIMARY KEY
  (ST_ID)
  USING INDEX SBS1_ADMIN.PK_STYPE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table TABSPACE 
-- 
ALTER TABLE SBS1_ADMIN.TABSPACE ADD (
  CONSTRAINT PK_TABSPACE
  PRIMARY KEY
  (TBS_ID)
  USING INDEX SBS1_ADMIN.PK_TABSPACE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table TDBSTATE 
-- 
ALTER TABLE SBS1_ADMIN.TDBSTATE ADD (
  CONSTRAINT PK_TDBSTATE
  PRIMARY KEY
  (TDBS_ID)
  USING INDEX SBS1_ADMIN.PK_TDBSTATE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table THISDB 
-- 
ALTER TABLE SBS1_ADMIN.THISDB ADD (
  CONSTRAINT PK_THISDB
  PRIMARY KEY
  (TDB_ID)
  USING INDEX SBS1_ADMIN.PK_THISDB
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table TRCSTATE 
-- 
ALTER TABLE SBS1_ADMIN.TRCSTATE ADD (
  CONSTRAINT PK_TRCSTATE
  PRIMARY KEY
  (TRCS_ID)
  USING INDEX SBS1_ADMIN.PK_TRCSTATE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table TRCTYPE 
-- 
ALTER TABLE SBS1_ADMIN.TRCTYPE ADD (
  CONSTRAINT PK_TRCTYPE
  PRIMARY KEY
  (TRCT_ID)
  USING INDEX SBS1_ADMIN.PK_TRCTYPE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table TRDIRECTION 
-- 
ALTER TABLE SBS1_ADMIN.TRDIRECTION ADD (
  CONSTRAINT PK_TRDIRECTION
  PRIMARY KEY
  (TRD_ID)
  USING INDEX SBS1_ADMIN.PK_TRDIRECTION
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table VATCODE 
-- 
ALTER TABLE SBS1_ADMIN.VATCODE ADD (
  CONSTRAINT PK_VATCODE
  PRIMARY KEY
  (VAT_ID)
  USING INDEX SBS1_ADMIN.PK_VATCODE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table VATRATE 
-- 
ALTER TABLE SBS1_ADMIN.VATRATE ADD (
  CONSTRAINT PK_VATRATE
  PRIMARY KEY
  (VAR_ID)
  USING INDEX SBS1_ADMIN.PK_VATRATE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table WARNING 
-- 
ALTER TABLE SBS1_ADMIN.WARNING ADD (
  CONSTRAINT PK_WARNING
  PRIMARY KEY
  (W_ID)
  USING INDEX SBS1_ADMIN.PK_WARNING
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table XPROCSTATE 
-- 
ALTER TABLE SBS1_ADMIN.XPROCSTATE ADD (
  CONSTRAINT PK_XPROCSTATE
  PRIMARY KEY
  (XPRS_ID)
  USING INDEX SBS1_ADMIN.PK_XPROCSTATE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table ZNSTATE 
-- 
ALTER TABLE SBS1_ADMIN.ZNSTATE ADD (
  CONSTRAINT PK_ZNSTATE
  PRIMARY KEY
  (ZNS_ID)
  USING INDEX SBS1_ADMIN.PK_ZNSTATE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table ZONE 
-- 
ALTER TABLE SBS1_ADMIN.ZONE ADD (
  CONSTRAINT PK_ZONE
  PRIMARY KEY
  (ZN_ID)
  USING INDEX SBS1_ADMIN.PK_ZONE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table ZONEUSAGE 
-- 
ALTER TABLE SBS1_ADMIN.ZONEUSAGE ADD (
  CONSTRAINT PK_ZONEUSAGE
  PRIMARY KEY
  (ZNU_ID)
  USING INDEX SBS1_ADMIN.PK_ZONEUSAGE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table ADDRESS 
-- 
ALTER TABLE SBS1_ADMIN.ADDRESS ADD (
  CONSTRAINT PK_ADDRESS
  PRIMARY KEY
  (ADR_ID)
  USING INDEX SBS1_ADMIN.PK_ADDRESS
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table APP_OBJECT_GRANT 
-- 
ALTER TABLE SBS1_ADMIN.APP_OBJECT_GRANT ADD (
  CONSTRAINT PK_APP_OBJECT_GRANT
  PRIMARY KEY
  (OBJECT_NAME, GRANTEE, PERMISSION)
  USING INDEX SBS1_ADMIN.PK_APP_OBJECT_GRANT
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table CONSUBTYPE 
-- 
ALTER TABLE SBS1_ADMIN.CONSUBTYPE ADD (
  CONSTRAINT PK_CONSUBTYPE
  PRIMARY KEY
  (CONST_ID)
  USING INDEX SBS1_ADMIN.PK_CONSUBTYPE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table CSTYPE 
-- 
ALTER TABLE SBS1_ADMIN.CSTYPE ADD (
  CONSTRAINT PK_CSTYPE
  PRIMARY KEY
  (CST_ID)
  USING INDEX SBS1_ADMIN.PK_CSTYPE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table DGTICONSOL 
-- 
ALTER TABLE SBS1_ADMIN.DGTICONSOL ADD (
  CONSTRAINT PK_DGTICONSOL
  PRIMARY KEY
  (DGTIC_ID)
  USING INDEX SBS1_ADMIN.PK_DGTICONSOL
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table ENPLAACTION 
-- 
ALTER TABLE SBS1_ADMIN.ENPLAACTION ADD (
  CONSTRAINT PK_ENPLAACTION
  PRIMARY KEY
  (ENPLAA_ID)
  USING INDEX SBS1_ADMIN.PK_ENPLAACTION
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table ISCONSOL 
-- 
ALTER TABLE SBS1_ADMIN.ISCONSOL ADD (
  CONSTRAINT PK_ISCONSOL
  PRIMARY KEY
  (ISC_ID)
  USING INDEX SBS1_ADMIN.PK_ISCONSOL
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table LONGID 
-- 
ALTER TABLE SBS1_ADMIN.LONGID ADD (
  CONSTRAINT PK_LONGID
  PRIMARY KEY
  (LONG_ID)
  USING INDEX SBS1_ADMIN.PK_LONGID
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table LONGIDMAP 
-- 
ALTER TABLE SBS1_ADMIN.LONGIDMAP ADD (
  CONSTRAINT PK_LONGIDMAP
  PRIMARY KEY
  (LONGM_LONGID1)
  USING INDEX SBS1_ADMIN.PK_LONGIDMAP
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table MAPPING 
-- 
ALTER TABLE SBS1_ADMIN.MAPPING ADD (
  CONSTRAINT PK_MAPPING
  PRIMARY KEY
  (MAP_ID)
  USING INDEX SBS1_ADMIN.PK_MAPPING
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table NOTIFICATIONTEMPL 
-- 
ALTER TABLE SBS1_ADMIN.NOTIFICATIONTEMPL ADD (
  CONSTRAINT PK_NOTIFICATIONTEMPL
  PRIMARY KEY
  (NOT_ID)
  USING INDEX SBS1_ADMIN.PK_NOTIFICATIONTEMPL
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table NOT_PARAM 
-- 
ALTER TABLE SBS1_ADMIN.NOT_PARAM ADD (
  CONSTRAINT PK_NOTPARAM
  PRIMARY KEY
  (NOTP_ID)
  USING INDEX SBS1_ADMIN.PK_NOTPARAM
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table NUMBERRANGE 
-- 
ALTER TABLE SBS1_ADMIN.NUMBERRANGE ADD (
  CONSTRAINT PK_NUMBERRANGE
  PRIMARY KEY
  (NBR_ID)
  USING INDEX SBS1_ADMIN.PK_NUMBERRANGE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table OGTICONSOL 
-- 
ALTER TABLE SBS1_ADMIN.OGTICONSOL ADD (
  CONSTRAINT PK_OGTICONSOL
  PRIMARY KEY
  (OGTIC_ID)
  USING INDEX SBS1_ADMIN.PK_OGTICONSOL
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table PRMODEL 
-- 
ALTER TABLE SBS1_ADMIN.PRMODEL ADD (
  CONSTRAINT PK_PRMODEL
  PRIMARY KEY
  (PM_ID)
  USING INDEX SBS1_ADMIN.PK_PRMODEL
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table PRMODELVER 
-- 
ALTER TABLE SBS1_ADMIN.PRMODELVER ADD (
  CONSTRAINT PK_PRMODELVER
  PRIMARY KEY
  (PMV_ID)
  USING INDEX SBS1_ADMIN.PK_PRMODELVER
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table PRMODELVERTRANS 
-- 
ALTER TABLE SBS1_ADMIN.PRMODELVERTRANS ADD (
  CONSTRAINT PK_PRMODELVERTRANS
  PRIMARY KEY
  (PMVT_ID)
  USING INDEX SBS1_ADMIN.PK_PRMODELVERTRANS
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table PROXY 
-- 
ALTER TABLE SBS1_ADMIN.PROXY ADD (
  CONSTRAINT PK_PROXY
  PRIMARY KEY
  (PROXY_ID)
  USING INDEX SBS1_ADMIN.PK_PROXY
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table REVA_HEADER 
-- 
ALTER TABLE SBS1_ADMIN.REVA_HEADER ADD (
  CONSTRAINT PK_REVA_HEADER
  PRIMARY KEY
  (REVAH_ID)
  USING INDEX SBS1_ADMIN.PK_REVA_HEADER
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table REVA_SIGMASK 
-- 
ALTER TABLE SBS1_ADMIN.REVA_SIGMASK ADD (
  CONSTRAINT PK_REVA_SIGMASK
  PRIMARY KEY
  (REVASM_ID)
  USING INDEX SBS1_ADMIN.PK_REVA_SIGMASK
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table ROCONSOLIDATION 
-- 
ALTER TABLE SBS1_ADMIN.ROCONSOLIDATION ADD (
  CONSTRAINT PK_ROCONSOLIDATION
  PRIMARY KEY
  (ROC_ID)
  USING INDEX SBS1_ADMIN.PK_ROCONSOLIDATION
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table SCRIPT 
-- 
ALTER TABLE SBS1_ADMIN.SCRIPT ADD (
  CONSTRAINT PK_SCRIPT
  PRIMARY KEY
  (SCR_ID)
  USING INDEX SBS1_ADMIN.PK_SCRIPT
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table SMSC 
-- 
ALTER TABLE SBS1_ADMIN.SMSC ADD (
  CONSTRAINT PK_SMSC
  PRIMARY KEY
  (SMSC_ID)
  USING INDEX SBS1_ADMIN.PK_SMSC
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table SRAS 
-- 
ALTER TABLE SBS1_ADMIN.SRAS ADD (
  CONSTRAINT PK_SRAS
  PRIMARY KEY
  (SRAS_ID)
  USING INDEX SBS1_ADMIN.PK_SRAS
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table TARIFF 
-- 
ALTER TABLE SBS1_ADMIN.TARIFF ADD (
  CONSTRAINT PK_TARIFF
  PRIMARY KEY
  (TAR_ID)
  USING INDEX SBS1_ADMIN.PK_TARIFF
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table TARIFFUSAGE 
-- 
ALTER TABLE SBS1_ADMIN.TARIFFUSAGE ADD (
  CONSTRAINT PK_TARIFFUSAGE
  PRIMARY KEY
  (TARUS_TARID, TARUS_CONTID)
  USING INDEX SBS1_ADMIN.PK_TARIFFUSAGE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table TRCONSOL 
-- 
ALTER TABLE SBS1_ADMIN.TRCONSOL ADD (
  CONSTRAINT PK_TRCONSOL
  PRIMARY KEY
  (TRC_ID)
  USING INDEX SBS1_ADMIN.PK_TRCONSOL
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table XPROC 
-- 
ALTER TABLE SBS1_ADMIN.XPROC ADD (
  CONSTRAINT PK_XPROC
  PRIMARY KEY
  (XPR_ID)
  USING INDEX SBS1_ADMIN.PK_XPROC
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table ZNZNU 
-- 
ALTER TABLE SBS1_ADMIN.ZNZNU ADD (
  CONSTRAINT PK_ZNZNU
  PRIMARY KEY
  (ZNZNU_ZNID, ZNZNU_ZNUID)
  USING INDEX SBS1_ADMIN.PK_ZNZNU
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table ACCOUNT 
-- 
ALTER TABLE SBS1_ADMIN.ACCOUNT ADD (
  CONSTRAINT PK_ACCOUNT
  PRIMARY KEY
  (AC_ID)
  USING INDEX SBS1_ADMIN.PK_ACCOUNT
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table BDCONSOLIDATION 
-- 
ALTER TABLE SBS1_ADMIN.BDCONSOLIDATION ADD (
  CONSTRAINT PK_BDCONSOLIDATION
  PRIMARY KEY
  (BDC_ID)
  USING INDEX SBS1_ADMIN.PK_BDCONSOLIDATION
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table BIHEADER 
-- 
ALTER TABLE SBS1_ADMIN.BIHEADER ADD (
  CONSTRAINT PK_BIHEADER
  PRIMARY KEY
  (BIH_ID)
  USING INDEX SBS1_ADMIN.PK_BIHEADER
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table CONTRACT 
-- 
ALTER TABLE SBS1_ADMIN.CONTRACT ADD (
  CONSTRAINT PK_CONTRACT
  PRIMARY KEY
  (CON_ID)
  USING INDEX SBS1_ADMIN.PK_CONTRACT
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table ISSUE 
-- 
ALTER TABLE SBS1_ADMIN.ISSUE ADD (
  CONSTRAINT PK_ISSUE
  PRIMARY KEY
  (IS_ID)
  USING INDEX SBS1_ADMIN.PK_ISSUE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table KEYWORD 
-- 
ALTER TABLE SBS1_ADMIN.KEYWORD ADD (
  CONSTRAINT PK_KEYWORD
  PRIMARY KEY
  (KEY_ID)
  USING INDEX SBS1_ADMIN.PK_KEYWORD
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table LONGIDHIST 
-- 
ALTER TABLE SBS1_ADMIN.LONGIDHIST ADD (
  CONSTRAINT PK_LONGIDHIST
  PRIMARY KEY
  (LONGH_ID)
  USING INDEX SBS1_ADMIN.PK_LONGIDHIST
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table MMSCADD 
-- 
ALTER TABLE SBS1_ADMIN.MMSCADD ADD (
  CONSTRAINT PK_MMSCADD
  PRIMARY KEY
  (MMSA_ADRID)
  USING INDEX SBS1_ADMIN.PK_MMSCADD
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table MMSCONSOLIDATION 
-- 
ALTER TABLE SBS1_ADMIN.MMSCONSOLIDATION ADD (
  CONSTRAINT PK_MMSCONSOLIDATION
  PRIMARY KEY
  (MMSC_ID)
  USING INDEX SBS1_ADMIN.PK_MMSCONSOLIDATION
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table PRMODELENTRY 
-- 
ALTER TABLE SBS1_ADMIN.PRMODELENTRY ADD (
  CONSTRAINT PK_PRMODELENTRY
  PRIMARY KEY
  (PME_ID)
  USING INDEX SBS1_ADMIN.PK_PRMODELENTRY
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table SETTLING 
-- 
ALTER TABLE SBS1_ADMIN.SETTLING ADD (
  CONSTRAINT PK_SETTLING
  PRIMARY KEY
  (SET_ID)
  USING INDEX SBS1_ADMIN.PK_SETTLING
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table SYSPARAMETERS 
-- 
ALTER TABLE SBS1_ADMIN.SYSPARAMETERS ADD (
  CONSTRAINT PK_SYSPARAMETERS
  PRIMARY KEY
  (SYS_ID)
  USING INDEX SBS1_ADMIN.PK_SYSPARAMETERS
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table CONIOT 
-- 
ALTER TABLE SBS1_ADMIN.CONIOT ADD (
  CONSTRAINT PK_CONIOT
  PRIMARY KEY
  (CIOT_ID)
  USING INDEX SBS1_ADMIN.PK_CONIOT
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table CONIOTE 
-- 
ALTER TABLE SBS1_ADMIN.CONIOTE ADD (
  CONSTRAINT PK_CONIOTE
  PRIMARY KEY
  (CIOTE_ID)
  USING INDEX SBS1_ADMIN.PK_CONIOTE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table CONTENTSERVICE 
-- 
ALTER TABLE SBS1_ADMIN.CONTENTSERVICE ADD (
  CONSTRAINT PK_CONTENTSERVICE
  PRIMARY KEY
  (CS_ID)
  USING INDEX SBS1_ADMIN.PK_CONTENTSERVICE
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table SETDETAIL 
-- 
ALTER TABLE SBS1_ADMIN.SETDETAIL ADD (
  CONSTRAINT PK_SETDETAIL
  PRIMARY KEY
  (SED_ID)
  USING INDEX SBS1_ADMIN.PK_SETDETAIL
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table BOHEADER 
-- 
ALTER TABLE SBS1_ADMIN.BOHEADER ADD (
  CONSTRAINT PK_BOHEADER
  PRIMARY KEY
  (BOH_ID)
  USING INDEX SBS1_ADMIN.PK_BOHEADER
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table PACKING 
-- 
ALTER TABLE SBS1_ADMIN.PACKING ADD (
  CONSTRAINT XPROC_NULL_CK
  CHECK (PAC_ESID IN ('D','L','R','I') OR PAC_ETID NOT IN ('CONSOL','STAT') OR PAC_XPROCID IS NOT NULL)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.PACKING ADD (
  CONSTRAINT PK_PACKING
  PRIMARY KEY
  (PAC_ID)
  USING INDEX SBS1_ADMIN.PK_PACKING
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table STA_DIRECTORY 
-- 
ALTER TABLE SBS1_ADMIN.STA_DIRECTORY ADD (
  CONSTRAINT PK_STA_DIRECTORY
  PRIMARY KEY
  (STAD_ID)
  USING INDEX SBS1_ADMIN.PK_STA_DIRECTORY
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table STA_JOB 
-- 
ALTER TABLE SBS1_ADMIN.STA_JOB ADD (
  CONSTRAINT PK_STAJOB
  PRIMARY KEY
  (STAJ_ID)
  USING INDEX SBS1_ADMIN.PK_STAJOB
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table STA_JOBOUTPUT 
-- 
ALTER TABLE SBS1_ADMIN.STA_JOBOUTPUT ADD (
  CONSTRAINT PK_STAJOBOUTPUT
  PRIMARY KEY
  (STAJO_ID)
  USING INDEX SBS1_ADMIN.PK_STAJOBOUTPUT
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table STA_JOBPARAM 
-- 
ALTER TABLE SBS1_ADMIN.STA_JOBPARAM ADD (
  CONSTRAINT PK_STAJOBPARAM
  PRIMARY KEY
  (STAJP_ID)
  USING INDEX SBS1_ADMIN.PK_STAJOBPARAM
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table STA_PACPARAM 
-- 
ALTER TABLE SBS1_ADMIN.STA_PACPARAM ADD (
  CONSTRAINT PK_STAPACPARAM
  PRIMARY KEY
  (STAP_ID, STAP_PACID, STAP_NAME)
  USING INDEX SBS1_ADMIN.PK_STAPACPARAM
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table STA_SQLDEF 
-- 
ALTER TABLE SBS1_ADMIN.STA_SQLDEF ADD (
  CONSTRAINT PK_STA_SQLDEF
  PRIMARY KEY
  (STAQ_ID)
  USING INDEX SBS1_ADMIN.PK_STA_SQLDEF
  ENABLE VALIDATE);


-- 
-- Non Foreign Key Constraints for Table STA_SUBSCRIPTION 
-- 
ALTER TABLE SBS1_ADMIN.STA_SUBSCRIPTION ADD (
  CONSTRAINT PK_STASUBSCRIPTION
  PRIMARY KEY
  (STAU_ID)
  USING INDEX SBS1_ADMIN.PK_STASUBSCRIPTION
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table ENPLARANGEENTRY 
-- 
ALTER TABLE SBS1_ADMIN.ENPLARANGEENTRY ADD (
  CONSTRAINT FK_ENPLARAN_REFERE_42_ENPLARAN 
  FOREIGN KEY (ENPLARE_ENPLARID) 
  REFERENCES SBS1_ADMIN.ENPLARANGE (ENPLAR_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table ERVPERMISSIONS 
-- 
ALTER TABLE SBS1_ADMIN.ERVPERMISSIONS ADD (
  CONSTRAINT FK_ERVPERMI_REFERE_43_ACTYPE 
  FOREIGN KEY (ERVP_ACTID) 
  REFERENCES SBS1_ADMIN.ACTYPE (ACT_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.ERVPERMISSIONS ADD (
  CONSTRAINT FK_ERVPERMI_REFERE_43_ERRORVIE 
  FOREIGN KEY (ERVP_ERVID) 
  REFERENCES SBS1_ADMIN.ERRORVIEW (ERV_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table EXCHANGERATE 
-- 
ALTER TABLE SBS1_ADMIN.EXCHANGERATE ADD (
  CONSTRAINT FK_EXCHANGERATE_REF_CURRENCY 
  FOREIGN KEY (EXR_CURID) 
  REFERENCES SBS1_ADMIN.CURRENCY (CUR_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table IRANGE 
-- 
ALTER TABLE SBS1_ADMIN.IRANGE ADD (
  CONSTRAINT FK_IRANGE_REF_35220_CARRIER 
  FOREIGN KEY (IMR_CARID) 
  REFERENCES SBS1_ADMIN.CARRIER (CAR_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table NBRRANGE 
-- 
ALTER TABLE SBS1_ADMIN.NBRRANGE ADD (
  CONSTRAINT FK_NBRRANGE_REF_49037_CARRIER 
  FOREIGN KEY (NBR_CARID) 
  REFERENCES SBS1_ADMIN.CARRIER (CAR_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table PACITERATOR 
-- 
ALTER TABLE SBS1_ADMIN.PACITERATOR ADD (
  CONSTRAINT FK_PACITERA_REF_28982_LOOPTYPE 
  FOREIGN KEY (PACI_LTID) 
  REFERENCES SBS1_ADMIN.LOOPTYPE (LT_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table SETPERIOD 
-- 
ALTER TABLE SBS1_ADMIN.SETPERIOD ADD (
  CONSTRAINT FK_SETPERIO_REF_90022_IWTSSTAT 
  FOREIGN KEY (SEP_IWTSSID) 
  REFERENCES SBS1_ADMIN.IWTSSTATE (IWTSS_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table TABSPACE 
-- 
ALTER TABLE SBS1_ADMIN.TABSPACE ADD (
  CONSTRAINT FK_TABSPACE_REF_31800_DBASE 
  FOREIGN KEY (TBS_DBID) 
  REFERENCES SBS1_ADMIN.DBASE (DB_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table THISDB 
-- 
ALTER TABLE SBS1_ADMIN.THISDB ADD (
  CONSTRAINT FK_THISDB_REF_2570_DBASE 
  FOREIGN KEY (TDB_ID) 
  REFERENCES SBS1_ADMIN.DBASE (DB_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.THISDB ADD (
  CONSTRAINT FK_THISDB_REF_33253_TDBSTATE 
  FOREIGN KEY (TDB_ESID) 
  REFERENCES SBS1_ADMIN.TDBSTATE (TDBS_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table VATRATE 
-- 
ALTER TABLE SBS1_ADMIN.VATRATE ADD (
  CONSTRAINT FK_VATRATE_REF_1881_VATCODE 
  FOREIGN KEY (VAR_VATID) 
  REFERENCES SBS1_ADMIN.VATCODE (VAT_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table ZONE 
-- 
ALTER TABLE SBS1_ADMIN.ZONE ADD (
  CONSTRAINT FK_ZONE_REF_13892_ZNSTATE 
  FOREIGN KEY (ZN_ESID) 
  REFERENCES SBS1_ADMIN.ZNSTATE (ZNS_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table ADDRESS 
-- 
ALTER TABLE SBS1_ADMIN.ADDRESS ADD (
  CONSTRAINT FK_ADDRESS_REF_13533_ADRTYPE 
  FOREIGN KEY (ADR_ETID) 
  REFERENCES SBS1_ADMIN.ADRTYPE (ADRT_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.ADDRESS ADD (
  CONSTRAINT FK_ADDRESS_REF_13534_ADRSTATE 
  FOREIGN KEY (ADR_ESID) 
  REFERENCES SBS1_ADMIN.ADRSTATE (ADRS_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table APP_OBJECT_GRANT 
-- 
ALTER TABLE SBS1_ADMIN.APP_OBJECT_GRANT ADD (
  CONSTRAINT FK_APP_OBJE_REFERE_46_APP_PERM 
  FOREIGN KEY (PERMISSION) 
  REFERENCES SBS1_ADMIN.APP_PERMISSION (APP_PERM_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table CONSUBTYPE 
-- 
ALTER TABLE SBS1_ADMIN.CONSUBTYPE ADD (
  CONSTRAINT FK_CONSUBTY_REF_14980_CONTYPE 
  FOREIGN KEY (CONST_CONTID) 
  REFERENCES SBS1_ADMIN.CONTYPE (CONT_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table CSTYPE 
-- 
ALTER TABLE SBS1_ADMIN.CSTYPE ADD (
  CONSTRAINT FK_CSTYPE_REF_354_SRCTYPE 
  FOREIGN KEY (CST_SRCTYPE) 
  REFERENCES SBS1_ADMIN.SRCTYPE (SRCT_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.CSTYPE ADD (
  CONSTRAINT FK_CSTYPE_REF_361_TRCTYPE 
  FOREIGN KEY (CST_TRCTID) 
  REFERENCES SBS1_ADMIN.TRCTYPE (TRCT_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table DGTICONSOL 
-- 
ALTER TABLE SBS1_ADMIN.DGTICONSOL ADD (
  CONSTRAINT FK_DGTICONS_R_364025_DGTICTYP 
  FOREIGN KEY (DGTIC_ETID) 
  REFERENCES SBS1_ADMIN.DGTICTYPE (DGTICT_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.DGTICONSOL ADD (
  CONSTRAINT FK_DGTICONS_R_364026_DGTICSTA 
  FOREIGN KEY (DGTIC_ESID) 
  REFERENCES SBS1_ADMIN.DGTICSTATE (DGTICS_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.DGTICONSOL ADD (
  CONSTRAINT FK_DGTICONS_R_364032_SETPERIO 
  FOREIGN KEY (DGTIC_SEPID) 
  REFERENCES SBS1_ADMIN.SETPERIOD (SEP_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table ENPLAACTION 
-- 
ALTER TABLE SBS1_ADMIN.ENPLAACTION ADD (
  CONSTRAINT FK_ENPLAACT_REFERER_4_SRCTYPE 
  FOREIGN KEY (ENPLAA_SRCTYPE) 
  REFERENCES SBS1_ADMIN.SRCTYPE (SRCT_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.ENPLAACTION ADD (
  CONSTRAINT FK_ENPLAACT_REFERE_43_ENPLAACT 
  FOREIGN KEY (ENPLAA_ETID) 
  REFERENCES SBS1_ADMIN.ENPLAACTIONTYPE (ENPLARAT_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.ENPLAACTION ADD (
  CONSTRAINT FK_ENPLAACT_REFERE_43_ENPLARAN 
  FOREIGN KEY (ENPLAA_ENPLARID) 
  REFERENCES SBS1_ADMIN.ENPLARANGE (ENPLAR_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table ISCONSOL 
-- 
ALTER TABLE SBS1_ADMIN.ISCONSOL ADD (
  CONSTRAINT FK_ISCONSOL_REFE_408_ISCCDRTY 
  FOREIGN KEY (ISC_CDRTID) 
  REFERENCES SBS1_ADMIN.ISCCDRTYPE (ISCCDRT_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.ISCONSOL ADD (
  CONSTRAINT FK_ISCONSOL_REF_12868_SETPO 
  FOREIGN KEY (ISC_SEPID) 
  REFERENCES SBS1_ADMIN.SETPERIOD (SEP_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.ISCONSOL ADD (
  CONSTRAINT FK_ISCONSOL_REF_12961_ISCE 
  FOREIGN KEY (ISC_ESID) 
  REFERENCES SBS1_ADMIN.ISCSTATE (ISCS_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table LONGID 
-- 
ALTER TABLE SBS1_ADMIN.LONGID ADD (
  CONSTRAINT FK_LONGID_R_435_LONGIDMS 
  FOREIGN KEY (LONG_ESID) 
  REFERENCES SBS1_ADMIN.LONGIDMSTATE (LONGIDMS_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table LONGIDMAP 
-- 
ALTER TABLE SBS1_ADMIN.LONGIDMAP ADD (
  CONSTRAINT FK_LONGIDMA_R_433_LONGID 
  FOREIGN KEY (LONGM_LONGID1) 
  REFERENCES SBS1_ADMIN.LONGID (LONG_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.LONGIDMAP ADD (
  CONSTRAINT FK_LONGIDMA_R_434_LONGID 
  FOREIGN KEY (LONGM_LONGID2) 
  REFERENCES SBS1_ADMIN.LONGID (LONG_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table MAPPING 
-- 
ALTER TABLE SBS1_ADMIN.MAPPING ADD (
  CONSTRAINT FK_MAPPING_REFERENCE_PERIODIC 
  FOREIGN KEY (MAP_PERIODID) 
  REFERENCES SBS1_ADMIN.PERIODICITY (PERIOD_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.MAPPING ADD (
  CONSTRAINT FK_MAPPING_REFE_455_SRCTYPE 
  FOREIGN KEY (MAP_SRCTID) 
  REFERENCES SBS1_ADMIN.SRCTYPE (SRCT_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.MAPPING ADD (
  CONSTRAINT FK_MAPPING_REF_13493_MAPTYPE 
  FOREIGN KEY (MAP_ETID) 
  REFERENCES SBS1_ADMIN.MAPTYPE (MAPT_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table MMSPRICE 
-- 
ALTER TABLE SBS1_ADMIN.MMSPRICE ADD (
  CONSTRAINT FK_MMSPRICE_R_293_MMSDZ 
  FOREIGN KEY (MMSP_MMSDZID) 
  REFERENCES SBS1_ADMIN.MMSDZ (MMSDZ_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.MMSPRICE ADD (
  CONSTRAINT FK_MMSPRICE_R_294_MMSRZ 
  FOREIGN KEY (MMSP_MMSRZID) 
  REFERENCES SBS1_ADMIN.MMSRZ (MMSRZ_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.MMSPRICE ADD (
  CONSTRAINT FK_MMSPRICE_R_295_MMSSZ 
  FOREIGN KEY (MMSP_MMSSZID) 
  REFERENCES SBS1_ADMIN.MMSSZ (MMSSZ_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table MMSRPRICE 
-- 
ALTER TABLE SBS1_ADMIN.MMSRPRICE ADD (
  CONSTRAINT FK_MMSRPRIC_REF_303_MMSRZ 
  FOREIGN KEY (MMSRP_MMSRZID2) 
  REFERENCES SBS1_ADMIN.MMSRZ (MMSRZ_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.MMSRPRICE ADD (
  CONSTRAINT FK_MMSRPRIC_R_302_MMSRZ 
  FOREIGN KEY (MMSRP_MMSRZID1) 
  REFERENCES SBS1_ADMIN.MMSRZ (MMSRZ_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.MMSRPRICE ADD (
  CONSTRAINT FK_MMSRPRIC_R_303_MMSSZ 
  FOREIGN KEY (MMSRP_MMSSZID) 
  REFERENCES SBS1_ADMIN.MMSSZ (MMSSZ_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table NOTIFICATIONTEMPL 
-- 
ALTER TABLE SBS1_ADMIN.NOTIFICATIONTEMPL ADD (
  CONSTRAINT FK_NOTIFICA_REF_NOTIF_NOTIFICA 
  FOREIGN KEY (NOT_ETID) 
  REFERENCES SBS1_ADMIN.NOTIFICATIONTYPE (NOTT_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.NOTIFICATIONTEMPL ADD (
  CONSTRAINT FK_NOTIFICA_REF_NOTSN_NOTIFICA 
  FOREIGN KEY (NOT_ESID) 
  REFERENCES SBS1_ADMIN.NOTIFICATIONSTATE (NOTS_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table NOT_PARAM 
-- 
ALTER TABLE SBS1_ADMIN.NOT_PARAM ADD (
  CONSTRAINT FK_NOT_PARA_REF_NOTIF_NOTIFICA 
  FOREIGN KEY (NOTP_NOTID) 
  REFERENCES SBS1_ADMIN.NOTIFICATIONTEMPL (NOT_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table NUMBERRANGE 
-- 
ALTER TABLE SBS1_ADMIN.NUMBERRANGE ADD (
  CONSTRAINT FK_NUMBERRA_RF_454_ZONE 
  FOREIGN KEY (NBR_PPRZNID) 
  REFERENCES SBS1_ADMIN.ZONE (ZN_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table OGTICONSOL 
-- 
ALTER TABLE SBS1_ADMIN.OGTICONSOL ADD (
  CONSTRAINT FK_OGTICONS_R_363963_OGTICTYP 
  FOREIGN KEY (OGTIC_ETID) 
  REFERENCES SBS1_ADMIN.OGTICTYPE (OGTICT_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.OGTICONSOL ADD (
  CONSTRAINT FK_OGTICONS_R_363964_OGTICSTA 
  FOREIGN KEY (OGTIC_ESID) 
  REFERENCES SBS1_ADMIN.OGTICSTATE (OGTICS_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.OGTICONSOL ADD (
  CONSTRAINT FK_OGTICONS_R_363969_SETPERIO 
  FOREIGN KEY (OGTIC_SEPID) 
  REFERENCES SBS1_ADMIN.SETPERIOD (SEP_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table PRMODEL 
-- 
ALTER TABLE SBS1_ADMIN.PRMODEL ADD (
  CONSTRAINT FK_PRMODEL_REF_13389_SRCTYPE 
  FOREIGN KEY (PM_SRCTYPE) 
  REFERENCES SBS1_ADMIN.SRCTYPE (SRCT_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.PRMODEL ADD (
  CONSTRAINT FK_PRMODEL_REF_41571_PMSTATE 
  FOREIGN KEY (PM_PMSID) 
  REFERENCES SBS1_ADMIN.PMSTATE (PMS_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table PRMODELVER 
-- 
ALTER TABLE SBS1_ADMIN.PRMODELVER ADD (
  CONSTRAINT FK_PRMODELV_REF_122_PRMODEL 
  FOREIGN KEY (PMV_PMID) 
  REFERENCES SBS1_ADMIN.PRMODEL (PM_ID)
  ON DELETE CASCADE
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.PRMODELVER ADD (
  CONSTRAINT FK_PRMODELV_R_331201_PMVSTATE 
  FOREIGN KEY (PMV_ESID) 
  REFERENCES SBS1_ADMIN.PMVSTATE (PMVS_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table PRMODELVERTRANS 
-- 
ALTER TABLE SBS1_ADMIN.PRMODELVERTRANS ADD (
  CONSTRAINT FK_PRMODELV_REF_20126_PRMODELV 
  FOREIGN KEY (PMVT_PMVID) 
  REFERENCES SBS1_ADMIN.PRMODELVER (PMV_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table PROXY 
-- 
ALTER TABLE SBS1_ADMIN.PROXY ADD (
  CONSTRAINT FK_PROXY_RE_452_PROXYTYP 
  FOREIGN KEY (PROXY_ETID) 
  REFERENCES SBS1_ADMIN.PROXYTYPE (PROXYT_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table REVA_HEADER 
-- 
ALTER TABLE SBS1_ADMIN.REVA_HEADER ADD (
  CONSTRAINT FK_REVA_HEA_REFERENCE_REVA_STA 
  FOREIGN KEY (REVAH_ESID) 
  REFERENCES SBS1_ADMIN.REVA_STATE (REVAS_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.REVA_HEADER ADD (
  CONSTRAINT FK_REVA_HEA_REFERENCE_SRCTYPE 
  FOREIGN KEY (REVAH_SRCTYPE) 
  REFERENCES SBS1_ADMIN.SRCTYPE (SRCT_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.REVA_HEADER ADD (
  CONSTRAINT FK_REVA_HEA_REF_REVA__REVA_I 
  FOREIGN KEY (REVAH_BILLEDITEM) 
  REFERENCES SBS1_ADMIN.REVA_BILLEDITEM (REVABI_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.REVA_HEADER ADD (
  CONSTRAINT FK_REVA_HEA_REF_REVA__REVA_T 
  FOREIGN KEY (REVAH_BILLINGTYPE) 
  REFERENCES SBS1_ADMIN.REVA_BILLTYPE (REVABT_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table REVA_SIGMASK 
-- 
ALTER TABLE SBS1_ADMIN.REVA_SIGMASK ADD (
  CONSTRAINT FK_REVA_SIG_REFERENCE_REVA_STA 
  FOREIGN KEY (REVASM_ESID) 
  REFERENCES SBS1_ADMIN.REVA_STATE (REVAS_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.REVA_SIGMASK ADD (
  CONSTRAINT FK_REVA_SIG_REF_REVA__REVA_SIG 
  FOREIGN KEY (REVASM_ETID) 
  REFERENCES SBS1_ADMIN.REVA_SIGTYPE (REVAT_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table ROCONSOLIDATION 
-- 
ALTER TABLE SBS1_ADMIN.ROCONSOLIDATION ADD (
  CONSTRAINT FK_ROCONSOL_REF_49064_SETPERIO 
  FOREIGN KEY (ROC_SEPID) 
  REFERENCES SBS1_ADMIN.SETPERIOD (SEP_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.ROCONSOLIDATION ADD (
  CONSTRAINT FK_ROCONSOL_REF_50658_ROCTYPE 
  FOREIGN KEY (ROC_ETID) 
  REFERENCES SBS1_ADMIN.ROCTYPE (ROCT_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.ROCONSOLIDATION ADD (
  CONSTRAINT FK_ROCONSOL_REF_50659_ROCSTATE 
  FOREIGN KEY (ROC_ESID) 
  REFERENCES SBS1_ADMIN.ROCSTATE (ROCS_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table SCRIPT 
-- 
ALTER TABLE SBS1_ADMIN.SCRIPT ADD (
  CONSTRAINT FK_SCRIPT_REFERENCE_SCRIPTST 
  FOREIGN KEY (SCR_ESID) 
  REFERENCES SBS1_ADMIN.SCRIPTSTATE (SCRS_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table SMSC 
-- 
ALTER TABLE SBS1_ADMIN.SMSC ADD (
  CONSTRAINT FK_SMSC_REF_23004_SMSCSTAT 
  FOREIGN KEY (SMSC_ESID) 
  REFERENCES SBS1_ADMIN.SMSCSTATE (SMSCS_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table SRAS 
-- 
ALTER TABLE SBS1_ADMIN.SRAS ADD (
  CONSTRAINT FK_SRAS_REF_450_SRASTYPE 
  FOREIGN KEY (SRAS_ETID) 
  REFERENCES SBS1_ADMIN.SRASTYPE (SRAST_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table TARIFF 
-- 
ALTER TABLE SBS1_ADMIN.TARIFF ADD (
  CONSTRAINT FK_TARIFF_R_266_ZONE 
  FOREIGN KEY (TAR_HGZNID) 
  REFERENCES SBS1_ADMIN.ZONE (ZN_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table TARIFFUSAGE 
-- 
ALTER TABLE SBS1_ADMIN.TARIFFUSAGE ADD (
  CONSTRAINT FK_TARIFFUS_REFE_412_TARIFF 
  FOREIGN KEY (TARUS_TARID) 
  REFERENCES SBS1_ADMIN.TARIFF (TAR_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.TARIFFUSAGE ADD (
  CONSTRAINT FK_TARIFFUS_REFE_413_CONTYPE 
  FOREIGN KEY (TARUS_CONTID) 
  REFERENCES SBS1_ADMIN.CONTYPE (CONT_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table TRCONSOL 
-- 
ALTER TABLE SBS1_ADMIN.TRCONSOL ADD (
  CONSTRAINT FK_TRCONSOL_REF_21984_TRCSTATE 
  FOREIGN KEY (TRC_ESID) 
  REFERENCES SBS1_ADMIN.TRCSTATE (TRCS_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.TRCONSOL ADD (
  CONSTRAINT FK_TRCONSOL_REF_21986_TRCTYPE 
  FOREIGN KEY (TRC_ETID) 
  REFERENCES SBS1_ADMIN.TRCTYPE (TRCT_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.TRCONSOL ADD (
  CONSTRAINT FK_TRCONSOL_REF_21987_TRDIRECT 
  FOREIGN KEY (TRC_TRDID) 
  REFERENCES SBS1_ADMIN.TRDIRECTION (TRD_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table XPROC 
-- 
ALTER TABLE SBS1_ADMIN.XPROC ADD (
  CONSTRAINT FK_XPROC_REF_PACTY_PACTYPE 
  FOREIGN KEY (XPR_ETID) 
  REFERENCES SBS1_ADMIN.PACTYPE (PACT_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.XPROC ADD (
  CONSTRAINT FK_XPROC_REF_XPROC_XPROCSTA 
  FOREIGN KEY (XPR_ESID) 
  REFERENCES SBS1_ADMIN.XPROCSTATE (XPRS_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table ZNZNU 
-- 
ALTER TABLE SBS1_ADMIN.ZNZNU ADD (
  CONSTRAINT FK_ZNZNU_REF_13897_ZONE 
  FOREIGN KEY (ZNZNU_ZNID) 
  REFERENCES SBS1_ADMIN.ZONE (ZN_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.ZNZNU ADD (
  CONSTRAINT FK_ZNZNU_REF_13897_ZONEUSAG 
  FOREIGN KEY (ZNZNU_ZNUID) 
  REFERENCES SBS1_ADMIN.ZONEUSAGE (ZNU_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table ACCOUNT 
-- 
ALTER TABLE SBS1_ADMIN.ACCOUNT ADD (
  CONSTRAINT FK_ACCOUNT_REF_13507_ACTYPE 
  FOREIGN KEY (AC_ETID) 
  REFERENCES SBS1_ADMIN.ACTYPE (ACT_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.ACCOUNT ADD (
  CONSTRAINT FK_ACCOUNT_REF_13523_ACSTATE 
  FOREIGN KEY (AC_ESID) 
  REFERENCES SBS1_ADMIN.ACSTATE (ACS_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.ACCOUNT ADD (
  CONSTRAINT FK_ACCOUNT_REF_13530_DBASE 
  FOREIGN KEY (AC_DBIDARCH) 
  REFERENCES SBS1_ADMIN.DBASE (DB_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.ACCOUNT ADD (
  CONSTRAINT FK_ACCOUNT_REF_1991_LANGUAGE 
  FOREIGN KEY (AC_LANGID) 
  REFERENCES SBS1_ADMIN.LANGUAGE (LANG_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.ACCOUNT ADD (
  CONSTRAINT FK_ACCOUNT_REF_2054_ADDRESS 
  FOREIGN KEY (AC_ADRID_MAIN) 
  REFERENCES SBS1_ADMIN.ADDRESS (ADR_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.ACCOUNT ADD (
  CONSTRAINT FK_ACCOUNT_REF_2055_ADDRESS 
  FOREIGN KEY (AC_ADRID_INVOICE) 
  REFERENCES SBS1_ADMIN.ADDRESS (ADR_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.ACCOUNT ADD (
  CONSTRAINT FK_ACCOUNT_REF_2574_DBASE 
  FOREIGN KEY (AC_DBIDSTORE) 
  REFERENCES SBS1_ADMIN.DBASE (DB_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.ACCOUNT ADD (
  CONSTRAINT FK_ACCOUNT_REF_3305_ADDRESS 
  FOREIGN KEY (AC_ADRID_MAINCONTACT) 
  REFERENCES SBS1_ADMIN.ADDRESS (ADR_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.ACCOUNT ADD (
  CONSTRAINT FK_ACCOUNT_REF_3308_ADDRESS 
  FOREIGN KEY (AC_ADRID_MARKETING) 
  REFERENCES SBS1_ADMIN.ADDRESS (ADR_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.ACCOUNT ADD (
  CONSTRAINT FK_ACCOUNT_REF_3311_ADDRESS 
  FOREIGN KEY (AC_ADRID_OTHERS) 
  REFERENCES SBS1_ADMIN.ADDRESS (ADR_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.ACCOUNT ADD (
  CONSTRAINT FK_ACCOUNT_REF_3314_ADDRESS 
  FOREIGN KEY (AC_ADRID_TECHNICAL) 
  REFERENCES SBS1_ADMIN.ADDRESS (ADR_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.ACCOUNT ADD (
  CONSTRAINT FK_ACCOUNT_REF_3320_ADDRESS 
  FOREIGN KEY (AC_ADRID_HELPDESK) 
  REFERENCES SBS1_ADMIN.ADDRESS (ADR_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.ACCOUNT ADD (
  CONSTRAINT FK_ACCOUNT_REF_3323_ADDRESS 
  FOREIGN KEY (AC_ADRID_FINANCE) 
  REFERENCES SBS1_ADMIN.ADDRESS (ADR_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.ACCOUNT ADD (
  CONSTRAINT FK_ACCOUNT_REF_41600_ACCOUNT 
  FOREIGN KEY (AC_DEPTID) 
  REFERENCES SBS1_ADMIN.ACCOUNT (AC_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table BDCONSOLIDATION 
-- 
ALTER TABLE SBS1_ADMIN.BDCONSOLIDATION ADD (
  CONSTRAINT FK_BDCONSOL_REF_22966_SETPERIO 
  FOREIGN KEY (BDC_SEPID) 
  REFERENCES SBS1_ADMIN.SETPERIOD (SEP_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDCONSOLIDATION ADD (
  CONSTRAINT FK_BDCONSOL_REF_22997_BDCTYPE 
  FOREIGN KEY (BDC_ETID) 
  REFERENCES SBS1_ADMIN.BDCTYPE (BDCT_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDCONSOLIDATION ADD (
  CONSTRAINT FK_BDCONSOL_REF_22998_BDCSTATE 
  FOREIGN KEY (BDC_ESID) 
  REFERENCES SBS1_ADMIN.BDCSTATE (BDCS_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDCONSOLIDATION ADD (
  CONSTRAINT FK_BDCONSOL_REF_24260_TARIFF 
  FOREIGN KEY (BDC_TARID) 
  REFERENCES SBS1_ADMIN.TARIFF (TAR_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDCONSOLIDATION ADD (
  CONSTRAINT FK_BDCONSOL_REF_24261_PRMODELV 
  FOREIGN KEY (BDC_PMVID) 
  REFERENCES SBS1_ADMIN.PRMODELVER (PMV_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table BIHEADER 
-- 
ALTER TABLE SBS1_ADMIN.BIHEADER ADD (
  CONSTRAINT FK_BIHEADER_REFER_459_REVA_ANA 
  FOREIGN KEY (BIH_SRCTYPE, BIH_REVASID) 
  REFERENCES SBS1_ADMIN.REVA_ANASTATE (REVAST_SRCTYPE,REVAST_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BIHEADER ADD (
  CONSTRAINT FK_BIHEADER_REFE_459_INDEXSTA 
  FOREIGN KEY (BIH_MAPID, BIH_INDEXSID) 
  REFERENCES SBS1_ADMIN.INDEXSTATE (INDEXS_MAPID,INDEXS_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BIHEADER ADD (
  CONSTRAINT FK_BIHEADER_REF_13380_SRCTYPE 
  FOREIGN KEY (BIH_SRCTYPE) 
  REFERENCES SBS1_ADMIN.SRCTYPE (SRCT_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BIHEADER ADD (
  CONSTRAINT FK_BIHEADER_REF_15667_BIHSTATE 
  FOREIGN KEY (BIH_ESID) 
  REFERENCES SBS1_ADMIN.BIHSTATE (BIHS_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BIHEADER ADD (
  CONSTRAINT FK_BIHEADER_REF_170_MAPPING 
  FOREIGN KEY (BIH_MAPID) 
  REFERENCES SBS1_ADMIN.MAPPING (MAP_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table CONTRACT 
-- 
ALTER TABLE SBS1_ADMIN.CONTRACT ADD (
  CONSTRAINT FK_CONTRACT_REF_13364_CONTYPE 
  FOREIGN KEY (CON_ETID) 
  REFERENCES SBS1_ADMIN.CONTYPE (CONT_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.CONTRACT ADD (
  CONSTRAINT FK_CONTRACT_REF_13381_SRCTYPE 
  FOREIGN KEY (CON_SRCTYPE) 
  REFERENCES SBS1_ADMIN.SRCTYPE (SRCT_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.CONTRACT ADD (
  CONSTRAINT FK_CONTRACT_REF_13405_CONSTATE 
  FOREIGN KEY (CON_ESID) 
  REFERENCES SBS1_ADMIN.CONSTATE (CONS_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.CONTRACT ADD (
  CONSTRAINT FK_CONTRACT_REF_17788_MBUNIT 
  FOREIGN KEY (CON_MBUID) 
  REFERENCES SBS1_ADMIN.MBUNIT (MBU_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.CONTRACT ADD (
  CONSTRAINT FK_CONTRACT_REF_17851_TARIFF 
  FOREIGN KEY (CON_TARID) 
  REFERENCES SBS1_ADMIN.TARIFF (TAR_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.CONTRACT ADD (
  CONSTRAINT FK_CONTRACT_REF_24266_PRMODEL 
  FOREIGN KEY (CON_PMID) 
  REFERENCES SBS1_ADMIN.PRMODEL (PM_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.CONTRACT ADD (
  CONSTRAINT FK_CONTRACT_REF_586_ACCOUNT 
  FOREIGN KEY (CON_ACID) 
  REFERENCES SBS1_ADMIN.ACCOUNT (AC_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.CONTRACT ADD (
  CONSTRAINT FK_CONTRACT_REF_63328_RETSCHEM 
  FOREIGN KEY (CON_RSID) 
  REFERENCES SBS1_ADMIN.RETSCHEMA (RS_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.CONTRACT ADD (
  CONSTRAINT FK_CONTRACT_R_353_CONSUBTY 
  FOREIGN KEY (CON_ESTID) 
  REFERENCES SBS1_ADMIN.CONSUBTYPE (CONST_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table ISSUE 
-- 
ALTER TABLE SBS1_ADMIN.ISSUE ADD (
  CONSTRAINT FK_ISSUE_REFERENCE_ACCOUNT 
  FOREIGN KEY (IS_ACID) 
  REFERENCES SBS1_ADMIN.ACCOUNT (AC_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.ISSUE ADD (
  CONSTRAINT FK_ISSUE_REF_43112_ISTYPE 
  FOREIGN KEY (IS_ETID) 
  REFERENCES SBS1_ADMIN.ISTYPE (IST_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.ISSUE ADD (
  CONSTRAINT FK_ISSUE_REF_43113_ISSTATE 
  FOREIGN KEY (IS_ESID) 
  REFERENCES SBS1_ADMIN.ISSTATE (ISS_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.ISSUE ADD (
  CONSTRAINT FK_ISSUE_REF_43118_ACCOUNT 
  FOREIGN KEY (IS_ACIDRESP) 
  REFERENCES SBS1_ADMIN.ACCOUNT (AC_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.ISSUE ADD (
  CONSTRAINT FK_ISSUE_REF_44635_CONTRACT 
  FOREIGN KEY (IS_CONID) 
  REFERENCES SBS1_ADMIN.CONTRACT (CON_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table KEYWORD 
-- 
ALTER TABLE SBS1_ADMIN.KEYWORD ADD (
  CONSTRAINT FK_KEYWORD_REF_57110_CONTRACT 
  FOREIGN KEY (KEY_CONID) 
  REFERENCES SBS1_ADMIN.CONTRACT (CON_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table LONGIDHIST 
-- 
ALTER TABLE SBS1_ADMIN.LONGIDHIST ADD (
  CONSTRAINT FK_LONGIDHI_R_437_ACCOUNT 
  FOREIGN KEY (LONGH_ACID) 
  REFERENCES SBS1_ADMIN.ACCOUNT (AC_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table LONGIDHISTDET 
-- 
ALTER TABLE SBS1_ADMIN.LONGIDHISTDET ADD (
  CONSTRAINT FK_LONGIDHI_R_438_LONGIDHI 
  FOREIGN KEY (LONGHD_LONGHID) 
  REFERENCES SBS1_ADMIN.LONGIDHIST (LONGH_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.LONGIDHISTDET ADD (
  CONSTRAINT FK_LONGIDHI_R_439_LONGID 
  FOREIGN KEY (LONGHD_LONGID) 
  REFERENCES SBS1_ADMIN.LONGID (LONG_ID)
  DISABLE NOVALIDATE);


-- 
-- Foreign Key Constraints for Table MMSCADD 
-- 
ALTER TABLE SBS1_ADMIN.MMSCADD ADD (
  CONSTRAINT FK_MMSCADD_REF_30530_MMSATYPE 
  FOREIGN KEY (MMSA_ETID) 
  REFERENCES SBS1_ADMIN.MMSATYPE (MMSAT_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.MMSCADD ADD (
  CONSTRAINT FK_MMSCADD_REF_30882_CONTRACT 
  FOREIGN KEY (MMSA_CONID) 
  REFERENCES SBS1_ADMIN.CONTRACT (CON_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table MMSCONSOLIDATION 
-- 
ALTER TABLE SBS1_ADMIN.MMSCONSOLIDATION ADD (
  CONSTRAINT FK_MMSCONSO_REFER_421_TARIFF 
  FOREIGN KEY (MMSC_TARID) 
  REFERENCES SBS1_ADMIN.TARIFF (TAR_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.MMSCONSOLIDATION ADD (
  CONSTRAINT FK_MMSCONSO_R_258_BDCSTATE 
  FOREIGN KEY (MMSC_ESID) 
  REFERENCES SBS1_ADMIN.BDCSTATE (BDCS_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.MMSCONSOLIDATION ADD (
  CONSTRAINT FK_MMSCONSO_R_259_BDCTYPE 
  FOREIGN KEY (MMSC_ETID) 
  REFERENCES SBS1_ADMIN.BDCTYPE (BDCT_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table PRMODELENTRY 
-- 
ALTER TABLE SBS1_ADMIN.PRMODELENTRY ADD (
  CONSTRAINT FK_PRMODELE_REF_131_PRMODELV 
  FOREIGN KEY (PME_PMVID) 
  REFERENCES SBS1_ADMIN.PRMODELVER (PMV_ID)
  ON DELETE CASCADE
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table REVA_COUNTER 
-- 
ALTER TABLE SBS1_ADMIN.REVA_COUNTER ADD (
  CONSTRAINT FK_REVA_COU_REV_COUNT_REVA_SIG 
  FOREIGN KEY (REVAC_REVASMID) 
  REFERENCES SBS1_ADMIN.REVA_SIGMASK (REVASM_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table SETTLING 
-- 
ALTER TABLE SBS1_ADMIN.SETTLING ADD (
  CONSTRAINT FK_SETTLING_REF_1142_CONTRACT 
  FOREIGN KEY (SET_CONID) 
  REFERENCES SBS1_ADMIN.CONTRACT (CON_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.SETTLING ADD (
  CONSTRAINT FK_SETTLING_REF_1145_SETTLING 
  FOREIGN KEY (SET_SETIDOLD) 
  REFERENCES SBS1_ADMIN.SETTLING (SET_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.SETTLING ADD (
  CONSTRAINT FK_SETTLING_REF_13421_SETTYPE 
  FOREIGN KEY (SET_ETID) 
  REFERENCES SBS1_ADMIN.SETTYPE (SETT_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.SETTLING ADD (
  CONSTRAINT FK_SETTLING_REF_13554_SETSTATE 
  FOREIGN KEY (SET_ESID) 
  REFERENCES SBS1_ADMIN.SETSTATE (SETS_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.SETTLING ADD (
  CONSTRAINT FK_SETTLING_REF_1842_SETPERIO 
  FOREIGN KEY (SET_SEPID) 
  REFERENCES SBS1_ADMIN.SETPERIOD (SEP_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table SYSPARAMETERS 
-- 
ALTER TABLE SBS1_ADMIN.SYSPARAMETERS ADD (
  CONSTRAINT FK_SYSPARAM_REF_43126_ACCOUNT 
  FOREIGN KEY (SYS_OPERSMSCRESP) 
  REFERENCES SBS1_ADMIN.ACCOUNT (AC_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.SYSPARAMETERS ADD (
  CONSTRAINT FK_SYSPARAM_REF_43127_ACCOUNT 
  FOREIGN KEY (SYS_OPERSDCRESP) 
  REFERENCES SBS1_ADMIN.ACCOUNT (AC_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.SYSPARAMETERS ADD (
  CONSTRAINT FK_SYSPARAM_REF_43128_ACCOUNT 
  FOREIGN KEY (SYS_OPEROTARESP) 
  REFERENCES SBS1_ADMIN.ACCOUNT (AC_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.SYSPARAMETERS ADD (
  CONSTRAINT FK_SYSPARAM_REF_43129_ACCOUNT 
  FOREIGN KEY (SYS_OPERVASPRESP) 
  REFERENCES SBS1_ADMIN.ACCOUNT (AC_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.SYSPARAMETERS ADD (
  CONSTRAINT FK_SYSPARAM_REF_43130_ACCOUNT 
  FOREIGN KEY (SYS_OPERESRVRESP) 
  REFERENCES SBS1_ADMIN.ACCOUNT (AC_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.SYSPARAMETERS ADD (
  CONSTRAINT FK_SYSPARAM_REF_5135_LANGUAGE 
  FOREIGN KEY (SYS_LANGID) 
  REFERENCES SBS1_ADMIN.LANGUAGE (LANG_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table BDETAIL7 
-- 
ALTER TABLE SBS1_ADMIN.BDETAIL7 ADD (
  CONSTRAINT FK_BDETAIL7_REFER_420_TARIFF 
  FOREIGN KEY (BD_TARID) 
  REFERENCES SBS1_ADMIN.TARIFF (TAR_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL7 ADD (
  CONSTRAINT FK_BDETAIL7_REF_362_MAPSTATE 
  FOREIGN KEY (BD_MAPSID) 
  REFERENCES SBS1_ADMIN.MAPSTATE (MAPS_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL7 ADD (
  CONSTRAINT FK_BDETAIL7_REF_363_SRCTYPE 
  FOREIGN KEY (BD_SRCTYPE) 
  REFERENCES SBS1_ADMIN.SRCTYPE (SRCT_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL7 ADD (
  CONSTRAINT FK_BDETAIL7_REF_369_BIHEADER 
  FOREIGN KEY (BD_BIHID) 
  REFERENCES SBS1_ADMIN.BIHEADER (BIH_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table CONIOT 
-- 
ALTER TABLE SBS1_ADMIN.CONIOT ADD (
  CONSTRAINT FK_CONIOT_REFER_419_CURRENCY 
  FOREIGN KEY (CIOT_CURID) 
  REFERENCES SBS1_ADMIN.CURRENCY (CUR_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.CONIOT ADD (
  CONSTRAINT FK_CONIOT_REFE_415_TRCTYPE 
  FOREIGN KEY (CIOT_TRCTID) 
  REFERENCES SBS1_ADMIN.TRCTYPE (TRCT_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.CONIOT ADD (
  CONSTRAINT FK_CONIOT_REFE_417_IWDIRECT 
  FOREIGN KEY (CIOT_IWDID) 
  REFERENCES SBS1_ADMIN.IWDIRECTION (IWD_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.CONIOT ADD (
  CONSTRAINT FK_CONIOT_REFE_419_CONTRACT 
  FOREIGN KEY (CIOT_CONID) 
  REFERENCES SBS1_ADMIN.CONTRACT (CON_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table CONIOTE 
-- 
ALTER TABLE SBS1_ADMIN.CONIOTE ADD (
  CONSTRAINT FK_CONIOTE_REFER_418_CONIOT 
  FOREIGN KEY (CIOTE_CIOTID) 
  REFERENCES SBS1_ADMIN.CONIOT (CIOT_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table CONTENTSERVICE 
-- 
ALTER TABLE SBS1_ADMIN.CONTENTSERVICE ADD (
  CONSTRAINT FK_CONTENTS_REFE_377_CONTRACT 
  FOREIGN KEY (CS_CONID) 
  REFERENCES SBS1_ADMIN.CONTRACT (CON_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.CONTENTSERVICE ADD (
  CONSTRAINT FK_CONTENTS_REF_355_CSTYPE 
  FOREIGN KEY (CS_ETID) 
  REFERENCES SBS1_ADMIN.CSTYPE (CST_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.CONTENTSERVICE ADD (
  CONSTRAINT FK_CONTENTS_REF_356_ACCOUNT 
  FOREIGN KEY (CS_ACIDCRE) 
  REFERENCES SBS1_ADMIN.ACCOUNT (AC_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.CONTENTSERVICE ADD (
  CONSTRAINT FK_CONTENTS_REF_357_ACCOUNT 
  FOREIGN KEY (CS_ACIDMOD) 
  REFERENCES SBS1_ADMIN.ACCOUNT (AC_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.CONTENTSERVICE ADD (
  CONSTRAINT FK_CONTENTS_REF_358_GART 
  FOREIGN KEY (CS_GART) 
  REFERENCES SBS1_ADMIN.GART (GRT_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.CONTENTSERVICE ADD (
  CONSTRAINT FK_CONTENTS_REF_359_SRCTYPE 
  FOREIGN KEY (CS_SRCTYPE) 
  REFERENCES SBS1_ADMIN.SRCTYPE (SRCT_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.CONTENTSERVICE ADD (
  CONSTRAINT FK_CONTENTS_REF_360_CSSTATE 
  FOREIGN KEY (CS_ESID) 
  REFERENCES SBS1_ADMIN.CSSTATE (CSS_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table SETDETAIL 
-- 
ALTER TABLE SBS1_ADMIN.SETDETAIL ADD (
  CONSTRAINT FK_SETDETAI_REFER_461_BOSTATE 
  FOREIGN KEY (SED_UFIH_BOSID) 
  REFERENCES SBS1_ADMIN.BOSTATE (BOS_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.SETDETAIL ADD (
  CONSTRAINT FK_SETDETAI_REF_13438_SEDTYPE 
  FOREIGN KEY (SED_ETID) 
  REFERENCES SBS1_ADMIN.SEDTYPE (SEDT_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.SETDETAIL ADD (
  CONSTRAINT FK_SETDETAI_REF_1884_VATCODE 
  FOREIGN KEY (SED_VATID) 
  REFERENCES SBS1_ADMIN.VATCODE (VAT_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.SETDETAIL ADD (
  CONSTRAINT FK_SETDETAI_REF_1892_SETTLING 
  FOREIGN KEY (SED_SETID) 
  REFERENCES SBS1_ADMIN.SETTLING (SET_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.SETDETAIL ADD (
  CONSTRAINT FK_SETDETAI_REF_24271_TARIFF 
  FOREIGN KEY (SED_TARID) 
  REFERENCES SBS1_ADMIN.TARIFF (TAR_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.SETDETAIL ADD (
  CONSTRAINT FK_SETDETAI_REF_24272_PRMODELV 
  FOREIGN KEY (SED_PMVID) 
  REFERENCES SBS1_ADMIN.PRMODELVER (PMV_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.SETDETAIL ADD (
  CONSTRAINT FK_SETDETAI_REF_35685_SEDSTATE 
  FOREIGN KEY (SED_ESID) 
  REFERENCES SBS1_ADMIN.SEDSTATE (SEDS_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.SETDETAIL ADD (
  CONSTRAINT FK_SETDETAI_RE_453_LONGID 
  FOREIGN KEY (SED_LONGID) 
  REFERENCES SBS1_ADMIN.LONGID (LONG_ID)
  DISABLE NOVALIDATE);


-- 
-- Foreign Key Constraints for Table BDETAIL 
-- 
ALTER TABLE SBS1_ADMIN.BDETAIL ADD (
  CONSTRAINT FK_BDETAIL_REFERER_4_BDBSTATE 
  FOREIGN KEY (BD_BILLED) 
  REFERENCES SBS1_ADMIN.BDBSTATE (BDBS_ID)
  ENABLE NOVALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL ADD (
  CONSTRAINT FK_BDETAIL_REFE_409_ISCCDRTY 
  FOREIGN KEY (BD_CDRTID) 
  REFERENCES SBS1_ADMIN.ISCCDRTYPE (ISCCDRT_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL ADD (
  CONSTRAINT FK_BDETAIL_REF_104_BOHEADER 
  FOREIGN KEY (BD_BOHID1) 
  REFERENCES SBS1_ADMIN.BOHEADER (BOH_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL ADD (
  CONSTRAINT FK_BDETAIL_REF_11647_BOHEADER 
  FOREIGN KEY (BD_BOHID2) 
  REFERENCES SBS1_ADMIN.BOHEADER (BOH_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL ADD (
  CONSTRAINT FK_BDETAIL_REF_11648_BOHEADER 
  FOREIGN KEY (BD_BOHID3) 
  REFERENCES SBS1_ADMIN.BOHEADER (BOH_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL ADD (
  CONSTRAINT FK_BDETAIL_REF_119_PRMODELV 
  FOREIGN KEY (BD_PMVID) 
  REFERENCES SBS1_ADMIN.PRMODELVER (PMV_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL ADD (
  CONSTRAINT FK_BDETAIL_REF_13382_SRCTYPE 
  FOREIGN KEY (BD_SRCTYPE) 
  REFERENCES SBS1_ADMIN.SRCTYPE (SRCT_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL ADD (
  CONSTRAINT FK_BDETAIL_REF_14535_MAPSTATE 
  FOREIGN KEY (BD_MAPSID) 
  REFERENCES SBS1_ADMIN.MAPSTATE (MAPS_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL ADD (
  CONSTRAINT FK_BDETAIL_REF_14536_PACSTATE 
  FOREIGN KEY (BD_PACSID1) 
  REFERENCES SBS1_ADMIN.PACSTATE (PACS_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL ADD (
  CONSTRAINT FK_BDETAIL_REF_14537_PACSTATE 
  FOREIGN KEY (BD_PACSID2) 
  REFERENCES SBS1_ADMIN.PACSTATE (PACS_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL ADD (
  CONSTRAINT FK_BDETAIL_REF_14538_PACSTATE 
  FOREIGN KEY (BD_PACSID3) 
  REFERENCES SBS1_ADMIN.PACSTATE (PACS_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL ADD (
  CONSTRAINT FK_BDETAIL_REF_24252_TARIFF 
  FOREIGN KEY (BD_TARID) 
  REFERENCES SBS1_ADMIN.TARIFF (TAR_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL ADD (
  CONSTRAINT FK_BDETAIL_REF_2598_DBASE 
  FOREIGN KEY (BD_DBIDARCH) 
  REFERENCES SBS1_ADMIN.DBASE (DB_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL ADD (
  CONSTRAINT FK_BDETAIL_REF_2599_DBASE 
  FOREIGN KEY (BD_DBIDSTORE) 
  REFERENCES SBS1_ADMIN.DBASE (DB_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL ADD (
  CONSTRAINT FK_BDETAIL_REF_3243_LANGUAGE 
  FOREIGN KEY (BD_LANGID) 
  REFERENCES SBS1_ADMIN.LANGUAGE (LANG_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL ADD (
  CONSTRAINT FK_BDETAIL_REF_98_BIHEADER 
  FOREIGN KEY (BD_BIHID) 
  REFERENCES SBS1_ADMIN.BIHEADER (BIH_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table BDETAIL1 
-- 
ALTER TABLE SBS1_ADMIN.BDETAIL1 ADD (
  CONSTRAINT FK_BDETAIL1_REFERE_43_BDBSTATE 
  FOREIGN KEY (BD_BILLED) 
  REFERENCES SBS1_ADMIN.BDBSTATE (BDBS_ID)
  ENABLE NOVALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL1 ADD (
  CONSTRAINT FK_BDETAIL1_REF_14641_MAPSTATE 
  FOREIGN KEY (BD_MAPSID) 
  REFERENCES SBS1_ADMIN.MAPSTATE (MAPS_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL1 ADD (
  CONSTRAINT FK_BDETAIL1_REF_14642_PACSTATE 
  FOREIGN KEY (BD_PACSID2) 
  REFERENCES SBS1_ADMIN.PACSTATE (PACS_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL1 ADD (
  CONSTRAINT FK_BDETAIL1_REF_14643_PACSTATE 
  FOREIGN KEY (BD_PACSID1) 
  REFERENCES SBS1_ADMIN.PACSTATE (PACS_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL1 ADD (
  CONSTRAINT FK_BDETAIL1_REF_14644_PACSTATE 
  FOREIGN KEY (BD_PACSID3) 
  REFERENCES SBS1_ADMIN.PACSTATE (PACS_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL1 ADD (
  CONSTRAINT FK_BDETAIL1_REF_14645_BIHEADER 
  FOREIGN KEY (BD_BIHID) 
  REFERENCES SBS1_ADMIN.BIHEADER (BIH_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL1 ADD (
  CONSTRAINT FK_BDETAIL1_REF_14646_BOHEADER 
  FOREIGN KEY (BD_BOHID1) 
  REFERENCES SBS1_ADMIN.BOHEADER (BOH_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL1 ADD (
  CONSTRAINT FK_BDETAIL1_REF_14647_BOHEADER 
  FOREIGN KEY (BD_BOHID2) 
  REFERENCES SBS1_ADMIN.BOHEADER (BOH_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL1 ADD (
  CONSTRAINT FK_BDETAIL1_REF_14648_BOHEADER 
  FOREIGN KEY (BD_BOHID3) 
  REFERENCES SBS1_ADMIN.BOHEADER (BOH_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL1 ADD (
  CONSTRAINT FK_BDETAIL1_REF_14652_SRCTYPE 
  FOREIGN KEY (BD_SRCTYPE) 
  REFERENCES SBS1_ADMIN.SRCTYPE (SRCT_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL1 ADD (
  CONSTRAINT FK_BDETAIL1_REF_14654_LANGUAGE 
  FOREIGN KEY (BD_LANGID) 
  REFERENCES SBS1_ADMIN.LANGUAGE (LANG_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL1 ADD (
  CONSTRAINT FK_BDETAIL1_REF_24253_TARIFF 
  FOREIGN KEY (BD_TARID) 
  REFERENCES SBS1_ADMIN.TARIFF (TAR_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table BDETAIL2 
-- 
ALTER TABLE SBS1_ADMIN.BDETAIL2 ADD (
  CONSTRAINT FK_BDETAIL2_REFER_429_BDBSTATE 
  FOREIGN KEY (BD_BILLED) 
  REFERENCES SBS1_ADMIN.BDBSTATE (BDBS_ID)
  ENABLE NOVALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL2 ADD (
  CONSTRAINT FK_BDETAIL2_REF104869_BOHEADER 
  FOREIGN KEY (BD_BOHID1) 
  REFERENCES SBS1_ADMIN.BOHEADER (BOH_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL2 ADD (
  CONSTRAINT FK_BDETAIL2_REF104870_BOHEADER 
  FOREIGN KEY (BD_BOHID2) 
  REFERENCES SBS1_ADMIN.BOHEADER (BOH_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL2 ADD (
  CONSTRAINT FK_BDETAIL2_REF104871_BOHEADER 
  FOREIGN KEY (BD_BOHID3) 
  REFERENCES SBS1_ADMIN.BOHEADER (BOH_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL2 ADD (
  CONSTRAINT FK_BDETAIL2_REF_94844_MAPSTATE 
  FOREIGN KEY (BD_MAPSID) 
  REFERENCES SBS1_ADMIN.MAPSTATE (MAPS_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL2 ADD (
  CONSTRAINT FK_BDETAIL2_REF_94847_PACSTATE 
  FOREIGN KEY (BD_PACSID1) 
  REFERENCES SBS1_ADMIN.PACSTATE (PACS_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL2 ADD (
  CONSTRAINT FK_BDETAIL2_REF_94848_PACSTATE 
  FOREIGN KEY (BD_PACSID2) 
  REFERENCES SBS1_ADMIN.PACSTATE (PACS_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL2 ADD (
  CONSTRAINT FK_BDETAIL2_REF_94849_PACSTATE 
  FOREIGN KEY (BD_PACSID3) 
  REFERENCES SBS1_ADMIN.PACSTATE (PACS_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL2 ADD (
  CONSTRAINT FK_BDETAIL2_REF_94856_BIHEADER 
  FOREIGN KEY (BD_BIHID) 
  REFERENCES SBS1_ADMIN.BIHEADER (BIH_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL2 ADD (
  CONSTRAINT FK_BDETAIL2_REF_94869_SRCTYPE 
  FOREIGN KEY (BD_SRCTYPE) 
  REFERENCES SBS1_ADMIN.SRCTYPE (SRCT_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL2 ADD (
  CONSTRAINT FK_BDETAIL2_REF_94875_TARIFF 
  FOREIGN KEY (BD_TARID) 
  REFERENCES SBS1_ADMIN.TARIFF (TAR_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table BDETAIL4 
-- 
ALTER TABLE SBS1_ADMIN.BDETAIL4 ADD (
  CONSTRAINT FK_BDETAIL4_REF_92631_SRCTYPE 
  FOREIGN KEY (BD_SRCTYPE) 
  REFERENCES SBS1_ADMIN.SRCTYPE (SRCT_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL4 ADD (
  CONSTRAINT FK_BDETAIL4_REF_92635_BIHEADER 
  FOREIGN KEY (BD_BIHID) 
  REFERENCES SBS1_ADMIN.BIHEADER (BIH_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL4 ADD (
  CONSTRAINT FK_BDETAIL4_REF_92638_BOHEADER 
  FOREIGN KEY (BD_BOHID2) 
  REFERENCES SBS1_ADMIN.BOHEADER (BOH_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL4 ADD (
  CONSTRAINT FK_BDETAIL4_REF_92639_BOHEADER 
  FOREIGN KEY (BD_BOHID3) 
  REFERENCES SBS1_ADMIN.BOHEADER (BOH_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL4 ADD (
  CONSTRAINT FK_BDETAIL4_REF_92640_BOHEADER 
  FOREIGN KEY (BD_BOHID1) 
  REFERENCES SBS1_ADMIN.BOHEADER (BOH_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL4 ADD (
  CONSTRAINT FK_BDETAIL4_REF_92647_MAPSTATE 
  FOREIGN KEY (BD_MAPSID) 
  REFERENCES SBS1_ADMIN.MAPSTATE (MAPS_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL4 ADD (
  CONSTRAINT FK_BDETAIL4_REF_92650_PACSTATE 
  FOREIGN KEY (BD_PACSID1) 
  REFERENCES SBS1_ADMIN.PACSTATE (PACS_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL4 ADD (
  CONSTRAINT FK_BDETAIL4_REF_92651_PACSTATE 
  FOREIGN KEY (BD_PACSID2) 
  REFERENCES SBS1_ADMIN.PACSTATE (PACS_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL4 ADD (
  CONSTRAINT FK_BDETAIL4_REF_92652_PACSTATE 
  FOREIGN KEY (BD_PACSID3) 
  REFERENCES SBS1_ADMIN.PACSTATE (PACS_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL4 ADD (
  CONSTRAINT FK_BDETAIL4_REF_92672_CDRTYPE 
  FOREIGN KEY (BD_CDRTID) 
  REFERENCES SBS1_ADMIN.CDRTYPE (CDRT_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table BDETAIL6 
-- 
ALTER TABLE SBS1_ADMIN.BDETAIL6 ADD (
  CONSTRAINT FK_BDETAIL6_REFERER_4_BDBSTATE 
  FOREIGN KEY (BD_BILLED) 
  REFERENCES SBS1_ADMIN.BDBSTATE (BDBS_ID)
  ENABLE NOVALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL6 ADD (
  CONSTRAINT FK_BDETAIL6_REFE_414_TARIFF 
  FOREIGN KEY (BD_TARID) 
  REFERENCES SBS1_ADMIN.TARIFF (TAR_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL6 ADD (
  CONSTRAINT FK_BDETAIL6_REF_17348_SRCTYPE 
  FOREIGN KEY (BD_SRCTYPE) 
  REFERENCES SBS1_ADMIN.SRCTYPE (SRCT_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL6 ADD (
  CONSTRAINT FK_BDETAIL6_REF_17349_BIHEADER 
  FOREIGN KEY (BD_BIHID) 
  REFERENCES SBS1_ADMIN.BIHEADER (BIH_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL6 ADD (
  CONSTRAINT FK_BDETAIL6_REF_17349_MAPSTATE 
  FOREIGN KEY (BD_MAPSID) 
  REFERENCES SBS1_ADMIN.MAPSTATE (MAPS_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL6 ADD (
  CONSTRAINT FK_BDETAIL6_RF_173499_BOHEADER 
  FOREIGN KEY (BD_BOHID1) 
  REFERENCES SBS1_ADMIN.BOHEADER (BOH_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL6 ADD (
  CONSTRAINT FK_BDETAIL6_RF_173503_BOHEADER 
  FOREIGN KEY (BD_BOHID3) 
  REFERENCES SBS1_ADMIN.BOHEADER (BOH_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL6 ADD (
  CONSTRAINT FK_BDETAIL6_RF_173507_BOHEADER 
  FOREIGN KEY (BD_BOHID2) 
  REFERENCES SBS1_ADMIN.BOHEADER (BOH_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL6 ADD (
  CONSTRAINT FK_BDETAIL6_RF_173511_PACSTATE 
  FOREIGN KEY (BD_PACSID1) 
  REFERENCES SBS1_ADMIN.PACSTATE (PACS_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL6 ADD (
  CONSTRAINT FK_BDETAIL6_RF_173515_PACSTATE 
  FOREIGN KEY (BD_PACSID2) 
  REFERENCES SBS1_ADMIN.PACSTATE (PACS_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL6 ADD (
  CONSTRAINT FK_BDETAIL6_RF_173519_PACSTATE 
  FOREIGN KEY (BD_PACSID3) 
  REFERENCES SBS1_ADMIN.PACSTATE (PACS_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table BDETAIL9 
-- 
ALTER TABLE SBS1_ADMIN.BDETAIL9 ADD (
  CONSTRAINT FK_BDETAIL9_REF_26631_BIHEADER 
  FOREIGN KEY (BD_BIHID) 
  REFERENCES SBS1_ADMIN.BIHEADER (BIH_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL9 ADD (
  CONSTRAINT FK_BDETAIL9_REF_26631_BOHEADER 
  FOREIGN KEY (BD_BOHID1) 
  REFERENCES SBS1_ADMIN.BOHEADER (BOH_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL9 ADD (
  CONSTRAINT FK_BDETAIL9_REF_26632_BOHEADE1 
  FOREIGN KEY (BD_BOHID2) 
  REFERENCES SBS1_ADMIN.BOHEADER (BOH_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL9 ADD (
  CONSTRAINT FK_BDETAIL9_REF_26632_BOHEADE2 
  FOREIGN KEY (BD_BOHID3) 
  REFERENCES SBS1_ADMIN.BOHEADER (BOH_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL9 ADD (
  CONSTRAINT FK_BDETAIL9_REF_26632_MAPSTATE 
  FOREIGN KEY (BD_MAPSID) 
  REFERENCES SBS1_ADMIN.MAPSTATE (MAPS_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL9 ADD (
  CONSTRAINT FK_BDETAIL9_REF_26632_PACSTAT1 
  FOREIGN KEY (BD_PACSID2) 
  REFERENCES SBS1_ADMIN.PACSTATE (PACS_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL9 ADD (
  CONSTRAINT FK_BDETAIL9_REF_26632_PACSTAT2 
  FOREIGN KEY (BD_PACSID3) 
  REFERENCES SBS1_ADMIN.PACSTATE (PACS_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL9 ADD (
  CONSTRAINT FK_BDETAIL9_REF_26632_PACSTAT3 
  FOREIGN KEY (BD_PACSID1) 
  REFERENCES SBS1_ADMIN.PACSTATE (PACS_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BDETAIL9 ADD (
  CONSTRAINT FK_BDETAIL9_REF_26634_SRCTYPE 
  FOREIGN KEY (BD_SRCTYPE) 
  REFERENCES SBS1_ADMIN.SRCTYPE (SRCT_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table BOHEADER 
-- 
ALTER TABLE SBS1_ADMIN.BOHEADER ADD (
  CONSTRAINT FK_BOHEADER_REF_15683_BOHSTATE 
  FOREIGN KEY (BOH_ESID) 
  REFERENCES SBS1_ADMIN.BOHSTATE (BOHS_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.BOHEADER ADD (
  CONSTRAINT FK_BOHEADER_REF_307_PACKING 
  FOREIGN KEY (BOH_PACKID) 
  REFERENCES SBS1_ADMIN.PACKING (PAC_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table IWTCOUNTER 
-- 
ALTER TABLE SBS1_ADMIN.IWTCOUNTER ADD (
  CONSTRAINT FK_IWTCOUNT_REF_13685_BOHEADER 
  FOREIGN KEY (IWTC_BOHID1) 
  REFERENCES SBS1_ADMIN.BOHEADER (BOH_ID)
  ON DELETE CASCADE
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.IWTCOUNTER ADD (
  CONSTRAINT FK_IWTCOUNT_REF_90014_CTRSTATE 
  FOREIGN KEY (IWTC_ESID) 
  REFERENCES SBS1_ADMIN.CTRSTATE (CTRS_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.IWTCOUNTER ADD (
  CONSTRAINT FK_IWTCOUNT_REF_91995_SMSC 
  FOREIGN KEY (IWTC_SMSCID) 
  REFERENCES SBS1_ADMIN.SMSC (SMSC_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table MAPPACDEP 
-- 
ALTER TABLE SBS1_ADMIN.MAPPACDEP ADD (
  CONSTRAINT FK_MAPPACDE_REFE_457_PACKING 
  FOREIGN KEY (MAPPAC_PACID2) 
  REFERENCES SBS1_ADMIN.PACKING (PAC_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.MAPPACDEP ADD (
  CONSTRAINT FK_MAPPACDE_REFE_458_MAPPING 
  FOREIGN KEY (MAPPAC_MAPID1) 
  REFERENCES SBS1_ADMIN.MAPPING (MAP_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table PACKING 
-- 
ALTER TABLE SBS1_ADMIN.PACKING ADD (
  CONSTRAINT FK_PACKING_REFERENCE_STA_DIRE 
  FOREIGN KEY (PAC_DIRECTORYID) 
  REFERENCES SBS1_ADMIN.STA_DIRECTORY (STAD_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.PACKING ADD (
  CONSTRAINT FK_PACKING_REF_LOOPT_LOOPTYPE 
  FOREIGN KEY (PAC_LTID) 
  REFERENCES SBS1_ADMIN.LOOPTYPE (LT_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.PACKING ADD (
  CONSTRAINT FK_PACKING_REF_NOTPA_NOTIFICA 
  FOREIGN KEY (PAC_NOTID) 
  REFERENCES SBS1_ADMIN.NOTIFICATIONTEMPL (NOT_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.PACKING ADD (
  CONSTRAINT FK_PACKING_REF_PERIO_PERIODIC 
  FOREIGN KEY (PAC_PERIODID) 
  REFERENCES SBS1_ADMIN.PERIODICITY (PERIOD_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.PACKING ADD (
  CONSTRAINT FK_PACKING_REF_XPROC_XPROC 
  FOREIGN KEY (PAC_XPROCID) 
  REFERENCES SBS1_ADMIN.XPROC (XPR_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.PACKING ADD (
  CONSTRAINT FK_PACKING_REF_13477_PACTYPE 
  FOREIGN KEY (PAC_ETID) 
  REFERENCES SBS1_ADMIN.PACTYPE (PACT_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.PACKING ADD (
  CONSTRAINT FK_PACKING_REF_28505_PACITERA 
  FOREIGN KEY (PAC_ITID) 
  REFERENCES SBS1_ADMIN.PACITERATOR (PACI_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.PACKING ADD (
  CONSTRAINT FK_PACKING_REF_73485_PACKINGS 
  FOREIGN KEY (PAC_ESID) 
  REFERENCES SBS1_ADMIN.PACKINGSTATE (PACKS_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table PACPACDEP 
-- 
ALTER TABLE SBS1_ADMIN.PACPACDEP ADD (
  CONSTRAINT FK_PACPACDE_REF_PACDE_PACKING 
  FOREIGN KEY (PACPAC_PACID1) 
  REFERENCES SBS1_ADMIN.PACKING (PAC_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.PACPACDEP ADD (
  CONSTRAINT FK_PACPACDE_REF_29954_PACKING 
  FOREIGN KEY (PACPAC_PACID2) 
  REFERENCES SBS1_ADMIN.PACKING (PAC_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table STA_DIRECTORY 
-- 
ALTER TABLE SBS1_ADMIN.STA_DIRECTORY ADD (
  CONSTRAINT FK_STA_DIRE_REFERENCE_PACKING 
  FOREIGN KEY (STAD_PACID) 
  REFERENCES SBS1_ADMIN.PACKING (PAC_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table STA_JOB 
-- 
ALTER TABLE SBS1_ADMIN.STA_JOB ADD (
  CONSTRAINT FK_STAJ_NOTID_NOT 
  FOREIGN KEY (STAJ_NOTID) 
  REFERENCES SBS1_ADMIN.NOTIFICATIONTEMPL (NOT_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.STA_JOB ADD (
  CONSTRAINT FK_STA_JOB_REFERENCE_STA_DIRE 
  FOREIGN KEY (STAJ_DIRECTORYID) 
  REFERENCES SBS1_ADMIN.STA_DIRECTORY (STAD_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.STA_JOB ADD (
  CONSTRAINT FK_STA_JOB_REF_PACST_PACKING 
  FOREIGN KEY (STAJ_PACID) 
  REFERENCES SBS1_ADMIN.PACKING (PAC_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.STA_JOB ADD (
  CONSTRAINT FK_STA_JOB_REF_STAJO_STA_JOBS 
  FOREIGN KEY (STAJ_ESID) 
  REFERENCES SBS1_ADMIN.STA_JOBSTATE (STAJS_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table STA_JOBOUTPUT 
-- 
ALTER TABLE SBS1_ADMIN.STA_JOBOUTPUT ADD (
  CONSTRAINT FK_STA_JOBO_REF_STAJO_STA_JOB 
  FOREIGN KEY (STAJO_JOBID) 
  REFERENCES SBS1_ADMIN.STA_JOB (STAJ_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.STA_JOBOUTPUT ADD (
  CONSTRAINT FK_STA_JOBO_REF_26632_STA_JOBO 
  FOREIGN KEY (STAJO_ETID) 
  REFERENCES SBS1_ADMIN.STA_JOBOTYPE (STAOT_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table STA_JOBPARAM 
-- 
ALTER TABLE SBS1_ADMIN.STA_JOBPARAM ADD (
  CONSTRAINT FK_STA_JOBP_REF_JOBJO_STA_JOB 
  FOREIGN KEY (STAJP_JOBID) 
  REFERENCES SBS1_ADMIN.STA_JOB (STAJ_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table STA_JOBSQL 
-- 
ALTER TABLE SBS1_ADMIN.STA_JOBSQL ADD (
  CONSTRAINT FK_STA_JOBS_REF_JOBSQ_STA_JOB 
  FOREIGN KEY (STAJQ_JOBID) 
  REFERENCES SBS1_ADMIN.STA_JOB (STAJ_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table STA_PACPARAM 
-- 
ALTER TABLE SBS1_ADMIN.STA_PACPARAM ADD (
  CONSTRAINT FK_STA_PACP_REF_29476_PACKING 
  FOREIGN KEY (STAP_PACID) 
  REFERENCES SBS1_ADMIN.PACKING (PAC_ID)
  ENABLE VALIDATE);

ALTER TABLE SBS1_ADMIN.STA_PACPARAM ADD (
  CONSTRAINT FK_STA_PACP_REF_29477_PERIODIC 
  FOREIGN KEY (STAP_DROPPERIODID) 
  REFERENCES SBS1_ADMIN.PERIODICITY (PERIOD_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table STA_SQLDEF 
-- 
ALTER TABLE SBS1_ADMIN.STA_SQLDEF ADD (
  CONSTRAINT FK_STA_SQLD_REF_PACSQ_PACKING 
  FOREIGN KEY (STAQ_PACID) 
  REFERENCES SBS1_ADMIN.PACKING (PAC_ID)
  ENABLE VALIDATE);


-- 
-- Foreign Key Constraints for Table STA_SUBSCRIPTION 
-- 
ALTER TABLE SBS1_ADMIN.STA_SUBSCRIPTION ADD (
  CONSTRAINT FK_STA_SUBS_REF_28984_PACKING 
  FOREIGN KEY (STAU_PACID) 
  REFERENCES SBS1_ADMIN.PACKING (PAC_ID)
  ENABLE VALIDATE);


--
-- ENPLARANGE  (Materialized View Log) 
--
CREATE MATERIALIZED VIEW LOG ON SBS1_ADMIN.ENPLARANGE
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
WITH PRIMARY KEY
EXCLUDING NEW VALUES;

--
-- ENPLARANGEENTRY  (Materialized View Log) 
--
CREATE MATERIALIZED VIEW LOG ON SBS1_ADMIN.ENPLARANGEENTRY
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
WITH PRIMARY KEY
EXCLUDING NEW VALUES;

--
-- ERRDEF  (Materialized View Log) 
--
CREATE MATERIALIZED VIEW LOG ON SBS1_ADMIN.ERRDEF
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
WITH PRIMARY KEY
EXCLUDING NEW VALUES;

--
-- GART  (Materialized View Log) 
--
CREATE MATERIALIZED VIEW LOG ON SBS1_ADMIN.GART
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
WITH PRIMARY KEY
EXCLUDING NEW VALUES;

--
-- IMSIRANGE  (Materialized View Log) 
--
CREATE MATERIALIZED VIEW LOG ON SBS1_ADMIN.IMSIRANGE
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
WITH PRIMARY KEY
EXCLUDING NEW VALUES;

--
-- MMSSZ  (Materialized View Log) 
--
CREATE MATERIALIZED VIEW LOG ON SBS1_ADMIN.MMSSZ
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
WITH PRIMARY KEY
EXCLUDING NEW VALUES;

--
-- RETSCHEMA  (Materialized View Log) 
--
CREATE MATERIALIZED VIEW LOG ON SBS1_ADMIN.RETSCHEMA
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
WITH PRIMARY KEY
EXCLUDING NEW VALUES;

--
-- ZONE  (Materialized View Log) 
--
CREATE MATERIALIZED VIEW LOG ON SBS1_ADMIN.ZONE
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
WITH PRIMARY KEY
EXCLUDING NEW VALUES;

--
-- ENPLAACTION  (Materialized View Log) 
--
CREATE MATERIALIZED VIEW LOG ON SBS1_ADMIN.ENPLAACTION
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
WITH PRIMARY KEY
EXCLUDING NEW VALUES;

--
-- LONGID  (Materialized View Log) 
--
CREATE MATERIALIZED VIEW LOG ON SBS1_ADMIN.LONGID
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
WITH PRIMARY KEY
EXCLUDING NEW VALUES;

--
-- NUMBERRANGE  (Materialized View Log) 
--
CREATE MATERIALIZED VIEW LOG ON SBS1_ADMIN.NUMBERRANGE
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
WITH PRIMARY KEY
EXCLUDING NEW VALUES;

--
-- PRMODELVER  (Materialized View Log) 
--
CREATE MATERIALIZED VIEW LOG ON SBS1_ADMIN.PRMODELVER
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
WITH PRIMARY KEY
EXCLUDING NEW VALUES;

--
-- PRMODELVERTRANS  (Materialized View Log) 
--
CREATE MATERIALIZED VIEW LOG ON SBS1_ADMIN.PRMODELVERTRANS
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
WITH PRIMARY KEY
EXCLUDING NEW VALUES;

--
-- TARIFF  (Materialized View Log) 
--
CREATE MATERIALIZED VIEW LOG ON SBS1_ADMIN.TARIFF
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
WITH PRIMARY KEY
EXCLUDING NEW VALUES;

--
-- ACCOUNT  (Materialized View Log) 
--
CREATE MATERIALIZED VIEW LOG ON SBS1_ADMIN.ACCOUNT
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
WITH PRIMARY KEY
EXCLUDING NEW VALUES;

--
-- CONTRACT  (Materialized View Log) 
--
CREATE MATERIALIZED VIEW LOG ON SBS1_ADMIN.CONTRACT
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
WITH PRIMARY KEY
EXCLUDING NEW VALUES;

--
-- KEYWORD  (Materialized View Log) 
--
CREATE MATERIALIZED VIEW LOG ON SBS1_ADMIN.KEYWORD
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
WITH PRIMARY KEY
EXCLUDING NEW VALUES;

--
-- PRMODELENTRY  (Materialized View Log) 
--
CREATE MATERIALIZED VIEW LOG ON SBS1_ADMIN.PRMODELENTRY
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
WITH PRIMARY KEY
EXCLUDING NEW VALUES;

--
-- SYSPARAMETERS  (Materialized View Log) 
--
CREATE MATERIALIZED VIEW LOG ON SBS1_ADMIN.SYSPARAMETERS
TABLESPACE SBS1_BASE_DATA
PCTUSED    0
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
WITH PRIMARY KEY
EXCLUDING NEW VALUES;

--
-- CONTENTSERVICE  (Materialized View Log) 
--
CREATE MATERIALIZED VIEW LOG ON SBS1_ADMIN.CONTENTSERVICE
TABLESPACE SBS1_APPLICATION_DATA
PCTUSED    0
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
WITH PRIMARY KEY
EXCLUDING NEW VALUES;

GRANT READ, WRITE ON DIRECTORY DATA_PUMP_DIR TO EXP_FULL_DATABASE;

GRANT READ, WRITE ON DIRECTORY DATA_PUMP_DIR TO IMP_FULL_DATABASE;

GRANT READ, WRITE ON DIRECTORY ORACLE_OCM_CONFIG_DIR TO ORACLE_OCM;

GRANT READ, WRITE ON DIRECTORY ORACLE_OCM_CONFIG_DIR2 TO ORACLE_OCM;

GRANT SELECT ON SBS1_ADMIN.CONTYPE TO SBS0_ADMIN WITH GRANT OPTION;

GRANT SELECT ON SBS1_ADMIN.ENPLARANGE TO SBS0_ADMIN;

GRANT SELECT ON SBS1_ADMIN.ENPLARANGEENTRY TO SBS0_ADMIN WITH GRANT OPTION;

GRANT SELECT ON SBS1_ADMIN.ERRDEF TO SBS0_ADMIN WITH GRANT OPTION;

GRANT SELECT ON SBS1_ADMIN.GART TO SBS0_ADMIN WITH GRANT OPTION;

GRANT SELECT ON SBS1_ADMIN.IMSIRANGE TO SBS0_ADMIN WITH GRANT OPTION;

GRANT SELECT ON SBS1_ADMIN.LANGUAGE TO SBS0_ADMIN WITH GRANT OPTION;

GRANT SELECT ON SBS1_ADMIN.MLOG$_ACCOUNT TO SBS0_ADMIN;

GRANT SELECT ON SBS1_ADMIN.MLOG$_CONTENTSERVICE TO SBS0_ADMIN;

GRANT SELECT ON SBS1_ADMIN.MLOG$_CONTRACT TO SBS0_ADMIN;

GRANT SELECT ON SBS1_ADMIN.MLOG$_ENPLAACTION TO SBS0_ADMIN;

GRANT SELECT ON SBS1_ADMIN.MLOG$_ENPLARANGE TO SBS0_ADMIN;

GRANT SELECT ON SBS1_ADMIN.MLOG$_ENPLARANGEENTRY TO SBS0_ADMIN;

GRANT SELECT ON SBS1_ADMIN.MLOG$_ERRDEF TO SBS0_ADMIN;

GRANT SELECT ON SBS1_ADMIN.MLOG$_GART TO SBS0_ADMIN;

GRANT SELECT ON SBS1_ADMIN.MLOG$_IMSIRANGE TO SBS0_ADMIN;

GRANT SELECT ON SBS1_ADMIN.MLOG$_KEYWORD TO SBS0_ADMIN;

GRANT SELECT ON SBS1_ADMIN.MLOG$_LONGID TO SBS0_ADMIN;

GRANT SELECT ON SBS1_ADMIN.MLOG$_MMSSZ TO SBS0_ADMIN;

GRANT SELECT ON SBS1_ADMIN.MLOG$_NUMBERRANGE TO SBS0_ADMIN;

GRANT SELECT ON SBS1_ADMIN.MLOG$_PRMODELENTRY TO SBS0_ADMIN;

GRANT SELECT ON SBS1_ADMIN.MLOG$_PRMODELVER TO SBS0_ADMIN;

GRANT SELECT ON SBS1_ADMIN.MLOG$_PRMODELVERTRANS TO SBS0_ADMIN;

GRANT SELECT ON SBS1_ADMIN.MLOG$_RETSCHEMA TO SBS0_ADMIN;

GRANT SELECT ON SBS1_ADMIN.MLOG$_SYSPARAMETERS TO SBS0_ADMIN;

GRANT SELECT ON SBS1_ADMIN.MLOG$_TARIFF TO SBS0_ADMIN;

GRANT SELECT ON SBS1_ADMIN.MLOG$_ZONE TO SBS0_ADMIN;

GRANT SELECT ON SBS1_ADMIN.MMSCC TO SBS0_ADMIN WITH GRANT OPTION;

GRANT SELECT ON SBS1_ADMIN.MMSDZ TO SBS0_ADMIN WITH GRANT OPTION;

GRANT SELECT ON SBS1_ADMIN.MMSRZ TO SBS0_ADMIN WITH GRANT OPTION;

GRANT SELECT ON SBS1_ADMIN.MMSSZ TO SBS0_ADMIN WITH GRANT OPTION;

GRANT SELECT ON SBS1_ADMIN.RETSCHEMA TO SBS0_ADMIN WITH GRANT OPTION;

GRANT SELECT ON SBS1_ADMIN.STYPE TO SBS0_ADMIN WITH GRANT OPTION;

GRANT SELECT ON SBS1_ADMIN.ZONE TO SBS0_ADMIN WITH GRANT OPTION;

GRANT SELECT ON SBS1_ADMIN.ZONEUSAGE TO SBS0_ADMIN WITH GRANT OPTION;

GRANT SELECT ON SBS1_ADMIN.CONTYPE TO SBS0_APP;

GRANT SELECT ON SBS1_ADMIN.ERRDEF TO SBS0_APP;

GRANT SELECT ON SBS1_ADMIN.LANGUAGE TO SBS0_APP;

GRANT SELECT ON SBS1_ADMIN.MMSCC TO SBS0_APP;

GRANT SELECT ON SBS1_ADMIN.MMSDZ TO SBS0_APP;

GRANT SELECT ON SBS1_ADMIN.MMSRZ TO SBS0_APP;

GRANT SELECT ON SBS1_ADMIN.STYPE TO SBS0_APP;

GRANT SELECT ON SBS1_ADMIN.ZONEUSAGE TO SBS0_APP;

GRANT SELECT ON SBS1_ADMIN.ACSTATE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.ACTYPE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.ADRSTATE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.ADRTYPE TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.ALL_CC_NDC TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.ALL_MCC_MNC TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.AS_DATE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.BDBSTATE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.BDCSTATE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.BDCTYPE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.BDETAIL_MONITOR TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.BDETAIL_SEQ TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.BDKPI TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.BDKPI_SEQ TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.BD1STATUS TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.BD2STATUS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.BD6CUC_TEMP_SEQ TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.BIHSTATE TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.BILLTEXT_IN_UFIH TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.BOHSTATE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.BOSTATE TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.CARRIER TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.CDRTYPE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.CENTRUM_USERGROUP_LIST TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.CODE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.CONSTATE TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.CONTRACTPERIODEND TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.CONTRACTPERIODSTART TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.CONTYPE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.CSSTATE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.CTRSTATE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.CTRTYPE TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.CURRENCY TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.DBASE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.DGTICSTATE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.DGTICTYPE TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.DURATION TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.ENPLAACTIONTYPE TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.ENPLARANGE TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.ENPLARANGEENTRY TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.ENPLARANGESTATE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.ENUMERATOR TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.ERRDEF TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.ERRORVIEW TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.ERRTYPE TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.ERVPERMISSIONS TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.ERVTIMESPAN TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.EXCHANGERATE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.FK_DEPENDENCIES TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.GART TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.GENERAL_SEQ TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.GENERATEUNIQUEKEY TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.GETUFIHFIELD TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.HASH_MD5 TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.IMSIRANGE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.INDEXSTATE TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.IRANGE TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.IS_ALPHANUMERIC TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.ISC_AGGREGATION TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.ISCCDRTYPE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.ISCSTATE TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.IS_INTEGER TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.ISMSTAT TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.IS_NUMERIC TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.ISSTATE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.ISTYPE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.IWDIRECTION TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.IW_DO_SETTLEMENT TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.IW_GENERATE_BULK_FILES TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.IW_SETTLE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.IW_TERMINATED_DONE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.IWTSSTATE TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.JSON_KEY_SN TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.JSON_STRING TO SBS1_APP;

GRANT DELETE, INSERT, SELECT ON SBS1_ADMIN.KPI_HISTORY TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.KPI_HISTORY_VIEW TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.L TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.LANGUAGE TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.LB TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.LOCAL_TIME TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.LOG_DEBUG TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.LONGIDHIST_SEQ TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.LONGIDMSTATE TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.LONGID_RANGE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.LOOPTYPE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.MAPSTATE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.MAPTYPE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.MAY_START_SMSIW_SETTLEMENT TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.MBUNIT TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.MMSATYPE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.MMSCC TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.MMSC_CDRRECTYPE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.MMSC_EVENTDISPTYPE TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.MMSC_MSGCLASS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.MMSC_MSGTYPE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.MMSDZ TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.MMSRZ TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.MMSSZ TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.MOTYPE TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.NBRRANGE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.NOTIFICATIONSTATE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.NOTIFICATIONTYPE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.OGTICSTATE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.OGTICTYPE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.ORDER_OBJECT_BY_DEPENDENCY TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.PACITERATOR TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.PACKINGSTATE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.PACSTATE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.PACTYPE TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.PARTAG_CONFIG TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.PARTREORG TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.PERIODICITY TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.PKG_DEBUG TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.PKG_STATS_DEBUG TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.PKG_ZONING TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.PMSTATE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.PMVSTATE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.PROTTYPE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.PROXYTYPE TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.QUEST_SL_TEMP_EXPLAIN1 TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.RACACHE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.RAM_D_RTRA_OVERBILLING TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.RAM_D_RTRA_UNDERBILLING TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.RAM_D_SR075A_BASE_1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.RAM_D_SR075A_BASE_1A TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.RAM_D_SR075A_BASE_2 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.RAM_D_SR075A_BASE_2A TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.RAM_D_SR075A_BASE_3 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.RAM_D_SR075A_BASE_3A TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.RAM_D_SR075A_BASE_5 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.RAM_D_SR075A_BASE_5A TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.RAM_D_SR075A_BASE_7A TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.RAM_D_SR075A_BASE_7B TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.RAM_D_SR075A_BASE_7C TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.RAM_D_SR075A_DETAILS_1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.RAM_D_SR075A_DETAILS_2 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.RAM_D_SR075A_DETAILS_3 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.RAM_D_SR075A_DETAILS_4 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.RAM_D_SR075A_DETAILS_5 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.REQTYPE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.RETSCHEMA TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.REVA_ANASTATE TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.REVA_BILLEDITEM TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.REVA_BILLTYPE TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.REVA_CONFIG TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.REVA_DEBUG TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.REVA_SIGTYPE TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.REVA_SPECIAL_DAYS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.REVA_STATE TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.REVI_CONFIG TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.REVI_CONTENT_DEL TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.REVI_CONTENT_SUB TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.REVI_MMS TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.REVI_PRE TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.REVIPRE_MMS TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.REVIPRE_SMS TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.REVI_SMS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.ROCSTATE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.ROCTYPE TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.SBS0_STATS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SBS1_ALL_TAB_PARTITIONS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SBS2_ALL_TAB_PARTITIONS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SCRIPTSTATE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SEDSTATE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SEDTYPE TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.SETPERIOD TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SETSTATE TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.SETTLEDDURATION TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SETTYPE TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.SIMPLEHASH TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SMSCSTATE TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.SMS_IW_MT_ARCH TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SORTCHECK TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.SPEED TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.SP_INSERT_PERIOD TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.SQLN_EXPLAIN_PLAN TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SRASTYPE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SRCTYPE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR019A_DETAILS_4 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR020A_DETAILS_3 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR041A_DETAILS_1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR041A_DETAILS_2 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR041A_DETAILS_3 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR046A_DETAILS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR075A_BASE_1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR075A_BASE_1A TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR075A_BASE_2 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR075A_BASE_2A TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR075A_BASE_3 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR075A_BASE_3A TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR075A_BASE_5 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR075A_BASE_5A TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR075A_BASE_7A TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR075A_BASE_7B TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR075A_BASE_7C TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR075A_DETAILS_2 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR075A_DETAILS_3 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR075A_DETAILS_4 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR075A_DETAILS_5 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR111A_DETAILS_HIST TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.STA_CHECKBT_TPMCONSOL TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.STA_CONFIG TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.STA_DEBUG TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.STA_JOBANALYZE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.STA_JOBOTYPE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.STA_JOBSTATE TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.STA_SYSLOG TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.STRING_MATCH TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.STYPE TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.TABSPACE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.TDBSTATE TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.TEST TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.TEST_SEQ TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.THISDB TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.TOAD_PLAN_TABLE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.TORA_D_0056_DETAILS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.TORA_D_0065_DETAILS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.TORA_D_0067_DETAILS TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.TPMCONSOL TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.TPMCONSOL_BAD TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.TRCSTATE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.TRCTYPE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.TRDIRECTION TO SBS1_APP;

GRANT INSERT, SELECT ON SBS1_ADMIN.UAMLOG TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.UTL_RECOMP TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.UTL_RECOMP_BACKUP_JOBS TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.UTL_RECOMP_COMPILED TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.UTL_RECOMP_INVALID TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.UTL_RECOMP_LOG TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.UTL_RECOMP_SORTED TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.VATCODE TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.VATRATE TO SBS1_APP;

GRANT INSERT, SELECT ON SBS1_ADMIN.WARNING TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.XPROCSTATE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.ZNSTATE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.ZONE TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.ZONEUSAGE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.BDKPI TO SBS1_CPRO;

GRANT SELECT ON SBS1_ADMIN.DBSS_LOG TO SBS1_CPRO;

GRANT SELECT ON SBS1_ADMIN.GPSH_CURRENCY_KEYLIST TO SBS1_CPRO;

GRANT EXECUTE ON SBS1_ADMIN.GPSH_CURRENCY_PUT TO SBS1_CPRO;

GRANT SELECT ON SBS1_ADMIN.GPULL_KPI_JSON TO SBS1_CPRO;

GRANT SELECT ON SBS1_ADMIN.IMSIRANGE TO SBS1_CPRO;

GRANT EXECUTE ON SBS1_ADMIN.IS_NUMERIC TO SBS1_CPRO;

GRANT EXECUTE ON SBS1_ADMIN.JSON_DATE TO SBS1_CPRO;

GRANT EXECUTE ON SBS1_ADMIN.JSON_FOREIGN_KEY_2 TO SBS1_CPRO;

GRANT EXECUTE ON SBS1_ADMIN.JSON_KEY_SN TO SBS1_CPRO;

GRANT EXECUTE ON SBS1_ADMIN.JSON_STRING TO SBS1_CPRO;

GRANT EXECUTE ON SBS1_ADMIN.JSON_STRING_KEY TO SBS1_CPRO;

GRANT SELECT ON SBS1_ADMIN.LOGGER_LOGS TO SBS1_CPRO;

GRANT SELECT ON SBS1_ADMIN.UAMLOG TO SBS1_CPRO;

GRANT SELECT ON SBS1_ADMIN.CENTRUM_USERGROUP_LIST TO SBS1_DBL_CENTRUM;

GRANT SELECT ON SBS1_ADMIN.RAM_D_RTRA_OVERBILLING TO SBS1_DBL_RA;

GRANT SELECT ON SBS1_ADMIN.RAM_D_RTRA_UNDERBILLING TO SBS1_DBL_RA;

GRANT SELECT ON SBS1_ADMIN.RAM_D_SR075A_DETAILS_1 TO SBS1_DBL_RA;

GRANT SELECT ON SBS1_ADMIN.RAM_D_SR075A_DETAILS_2 TO SBS1_DBL_RA;

GRANT SELECT ON SBS1_ADMIN.RAM_D_SR075A_DETAILS_3 TO SBS1_DBL_RA;

GRANT SELECT ON SBS1_ADMIN.RAM_D_SR075A_DETAILS_4 TO SBS1_DBL_RA;

GRANT SELECT ON SBS1_ADMIN.RAM_D_SR075A_DETAILS_5 TO SBS1_DBL_RA;

GRANT SELECT ON SBS1_ADMIN.SR075A_DETAILS_2 TO SBS1_DBL_RA;

GRANT SELECT ON SBS1_ADMIN.SR075A_DETAILS_3 TO SBS1_DBL_RA;

GRANT SELECT ON SBS1_ADMIN.SR075A_DETAILS_4 TO SBS1_DBL_RA;

GRANT SELECT ON SBS1_ADMIN.SR075A_DETAILS_5 TO SBS1_DBL_RA;

GRANT SELECT ON SBS1_ADMIN.ACSTATE TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.ACTYPE TO SBS1_SBSWEB;

GRANT EXECUTE ON SBS1_ADMIN.AS_DATE TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.BDBSTATE TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.CDRTYPE TO SBS1_SBSWEB;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.CODE TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.CONSTATE TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.CONTYPE TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.CSSTATE TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.CTRSTATE TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.CTRTYPE TO SBS1_SBSWEB;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.CURRENCY TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.DBASE TO SBS1_SBSWEB;

GRANT EXECUTE ON SBS1_ADMIN.DURATION TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.ERRDEF TO SBS1_SBSWEB;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.ERRORVIEW TO SBS1_SBSWEB;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.ERVPERMISSIONS TO SBS1_SBSWEB;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.ERVTIMESPAN TO SBS1_SBSWEB;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.EXCHANGERATE TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.GART TO SBS1_SBSWEB;

GRANT EXECUTE ON SBS1_ADMIN.GENERATEUNIQUEKEY TO SBS1_SBSWEB;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.IMSIRANGE TO SBS1_SBSWEB;

GRANT EXECUTE ON SBS1_ADMIN.IS_INTEGER TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.ISSTATE TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.ISTYPE TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.IWDIRECTION TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.IWTSSTATE TO SBS1_SBSWEB;

GRANT EXECUTE ON SBS1_ADMIN.L TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.LANGUAGE TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.LONGIDMSTATE TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.LOOPTYPE TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.MBUNIT TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.MMSCC TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.MMSC_CDRRECTYPE TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.MMSC_EVENTDISPTYPE TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.MMSC_MSGTYPE TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.MMSDZ TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.MMSRZ TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.MOTYPE TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.PACITERATOR TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.PACKINGSTATE TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.PACTYPE TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.PERIODICITY TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.RETSCHEMA TO SBS1_SBSWEB;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.SETPERIOD TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.SMSCSTATE TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.SRCTYPE TO SBS1_SBSWEB;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.STA_CONFIG TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.STA_JOBSTATE TO SBS1_SBSWEB;

GRANT EXECUTE ON SBS1_ADMIN.STRING_MATCH TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.UAMLOG TO SBS1_SBSWEB;

GRANT INSERT, SELECT ON SBS1_ADMIN.WARNING TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.XPROCSTATE TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.ZONE TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.BDBSTATE TO SBS2_ADMIN WITH GRANT OPTION;

GRANT SELECT ON SBS1_ADMIN.ERRDEF TO SBS2_ADMIN WITH GRANT OPTION;

GRANT SELECT ON SBS1_ADMIN.MMSC_CDRRECTYPE TO SBS2_ADMIN WITH GRANT OPTION;

GRANT SELECT ON SBS1_ADMIN.MMSC_EVENTDISPTYPE TO SBS2_ADMIN WITH GRANT OPTION;

GRANT SELECT ON SBS1_ADMIN.MMSC_MSGTYPE TO SBS2_ADMIN WITH GRANT OPTION;

GRANT SELECT ON SBS1_ADMIN.BDBSTATE TO SBS2_APP;

GRANT SELECT ON SBS1_ADMIN.ERRDEF TO SBS2_APP;

GRANT SELECT ON SBS1_ADMIN.ADDRESS TO SBS0_ADMIN WITH GRANT OPTION;

GRANT SELECT ON SBS1_ADMIN.CONSUBTYPE TO SBS0_ADMIN WITH GRANT OPTION;

GRANT SELECT ON SBS1_ADMIN.ENPLAACTION TO SBS0_ADMIN WITH GRANT OPTION;

GRANT SELECT ON SBS1_ADMIN.LONGID TO SBS0_ADMIN WITH GRANT OPTION;

GRANT SELECT ON SBS1_ADMIN.MMSPRICE TO SBS0_ADMIN WITH GRANT OPTION;

GRANT SELECT ON SBS1_ADMIN.MMSRPRICE TO SBS0_ADMIN WITH GRANT OPTION;

GRANT SELECT ON SBS1_ADMIN.NUMBERRANGE TO SBS0_ADMIN WITH GRANT OPTION;

GRANT SELECT ON SBS1_ADMIN.PRMODEL TO SBS0_ADMIN WITH GRANT OPTION;

GRANT SELECT ON SBS1_ADMIN.PRMODELVER TO SBS0_ADMIN WITH GRANT OPTION;

GRANT SELECT ON SBS1_ADMIN.PRMODELVERTRANS TO SBS0_ADMIN WITH GRANT OPTION;

GRANT SELECT ON SBS1_ADMIN.SMSC TO SBS0_ADMIN;

GRANT SELECT ON SBS1_ADMIN.TARIFF TO SBS0_ADMIN WITH GRANT OPTION;

GRANT SELECT ON SBS1_ADMIN.ZNZNU TO SBS0_ADMIN WITH GRANT OPTION;

GRANT SELECT ON SBS1_ADMIN.ADDRESS TO SBS0_APP;

GRANT SELECT ON SBS1_ADMIN.CONSUBTYPE TO SBS0_APP;

GRANT SELECT ON SBS1_ADMIN.MMSPRICE TO SBS0_APP;

GRANT SELECT ON SBS1_ADMIN.MMSRPRICE TO SBS0_APP;

GRANT SELECT ON SBS1_ADMIN.PRMODEL TO SBS0_APP;

GRANT SELECT ON SBS1_ADMIN.SMSC TO SBS0_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.ADDRESS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.ALL_STATES TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.CONSUBTYPE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.CSTYPE TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.DGTICONSOL TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.ENPLAACTION TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.GETHIERARCHICALHASH TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.ISCONSOL TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.JSON_FOREIGN_KEY TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.JSON_FOREIGN_KEYS TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.JSON_KEY_SNS TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.JSON_NOT_NULL TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.LONGID TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.LONGIDMAP TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.MAPPING TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.MMSPRICE TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.MMSRPRICE TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.NORMALIZEDMSISDN TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.NOTIFICATIONTEMPL TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.NOT_PARAM TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.NUMBERRANGE TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.OGTICONSOL TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.OPKEY_FROM_GT TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.PKG_COMMON TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.PKG_SCRIPT TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.PRMODEL TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.PRMODELVER TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.PRMODELVERTRANS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.PROXY TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.RAM_D_FILE_PROCESSING TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.RAM_D_FSEQ_MISSING TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.RAM_D_SR062A_DETAILS_1 TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.REVA_HEADER TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.REVA_SIGMASK TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.REVA_SIGNATURE_CHECK TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.ROCONSOLIDATION TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.SCRIPT TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SI055A_DETAILS TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.SMSC TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.SP_INSERT_NEXT_PERIOD TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.SRAS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR035A_DETAILS_2 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR035A_DETAILS_3 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR055A_DETAILS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR086A_DETAILS_1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR086A_DETAILS_2 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR086A_DETAILS_3 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR111A_DETAILS_13 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR111A_DETAILS_6 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR111A_DETAILS_8 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR111A_DETAILS_9 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.STA_CHECKBT_ISCONSOL TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.STA_CHECKBT_ROCONSOLIDATION TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.STA_CHECKBT_TRCONSOL TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.TARIFF TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.TARIFFUSAGE TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.TRCONSOL TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.XPROC TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.ZNZNU TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.ADDRESS TO SBS1_CPRO;

GRANT SELECT ON SBS1_ADMIN.GPSH_CURRENCY_JSON TO SBS1_CPRO;

GRANT SELECT ON SBS1_ADMIN.GPSH_PRICE_KEYLIST TO SBS1_CPRO;

GRANT EXECUTE ON SBS1_ADMIN.GPSH_PRICE_MODEL_PUT TO SBS1_CPRO;

GRANT EXECUTE ON SBS1_ADMIN.GPSH_PRICE_TRANSPORT_PUT TO SBS1_CPRO;

GRANT EXECUTE ON SBS1_ADMIN.GPSH_PRICE_VERSION_DEL TO SBS1_CPRO;

GRANT EXECUTE ON SBS1_ADMIN.GPSH_PRICE_VERSION_PUT TO SBS1_CPRO;

GRANT EXECUTE ON SBS1_ADMIN.GPSH_TOAC_SMSC_DEL TO SBS1_CPRO;

GRANT SELECT ON SBS1_ADMIN.GPSH_TOAC_SMSC_KEYLIST TO SBS1_CPRO;

GRANT EXECUTE ON SBS1_ADMIN.GPSH_TOAC_SMSC_PUT TO SBS1_CPRO;

GRANT EXECUTE ON SBS1_ADMIN.GPSH_TPAC_LONGID_MAP_DEL TO SBS1_CPRO;

GRANT SELECT ON SBS1_ADMIN.GPSH_TPAC_LONGID_MAP_JSON TO SBS1_CPRO;

GRANT EXECUTE ON SBS1_ADMIN.GPSH_TPAC_LONGID_MAP_PUT TO SBS1_CPRO;

GRANT EXECUTE ON SBS1_ADMIN.JSON_FOREIGN_KEY TO SBS1_CPRO;

GRANT EXECUTE ON SBS1_ADMIN.JSON_FOREIGN_KEYS TO SBS1_CPRO;

GRANT EXECUTE ON SBS1_ADMIN.JSON_KEY_SNS TO SBS1_CPRO;

GRANT EXECUTE ON SBS1_ADMIN.JSON_NOT_NULL TO SBS1_CPRO;

GRANT SELECT ON SBS1_ADMIN.LONGID TO SBS1_CPRO;

GRANT SELECT ON SBS1_ADMIN.LONGIDMAP TO SBS1_CPRO;

GRANT SELECT ON SBS1_ADMIN.NUMBERRANGE TO SBS1_CPRO;

GRANT SELECT ON SBS1_ADMIN.SMSC TO SBS1_CPRO;

GRANT SELECT ON SBS1_ADMIN.RAM_D_FILE_PROCESSING TO SBS1_DBL_RA;

GRANT SELECT ON SBS1_ADMIN.RAM_D_FSEQ_MISSING TO SBS1_DBL_RA;

GRANT SELECT ON SBS1_ADMIN.RAM_D_SR062A_DETAILS_1 TO SBS1_DBL_RA;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.ADDRESS TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.CONSUBTYPE TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.CSTYPE TO SBS1_SBSWEB;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.LONGID TO SBS1_SBSWEB;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.LONGIDMAP TO SBS1_SBSWEB;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.MAPPING TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.NOTIFICATIONTEMPL TO SBS1_SBSWEB;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.NUMBERRANGE TO SBS1_SBSWEB;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.PRMODEL TO SBS1_SBSWEB;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.PRMODELVER TO SBS1_SBSWEB;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.PRMODELVERTRANS TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.PROXY TO SBS1_SBSWEB;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.SCRIPT TO SBS1_SBSWEB;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.SMSC TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.TARIFF TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.TARIFFUSAGE TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.XPROC TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.ADDRESS TO SBS2_ADMIN WITH GRANT OPTION;

GRANT SELECT ON SBS1_ADMIN.CONSUBTYPE TO SBS2_ADMIN WITH GRANT OPTION;

GRANT SELECT ON SBS1_ADMIN.ADDRESS TO SBS2_APP;

GRANT SELECT ON SBS1_ADMIN.CONSUBTYPE TO SBS2_APP;

GRANT SELECT ON SBS1_ADMIN.ACCOUNT TO ADMIN;

GRANT SELECT ON SBS1_ADMIN.SYSPARAMETERS TO ADMIN;

GRANT SELECT ON SBS1_ADMIN.ACCOUNT TO SBS0_ADMIN WITH GRANT OPTION;

GRANT SELECT ON SBS1_ADMIN.CONTRACT TO SBS0_ADMIN WITH GRANT OPTION;

GRANT SELECT ON SBS1_ADMIN.KEYWORD TO SBS0_ADMIN WITH GRANT OPTION;

GRANT SELECT ON SBS1_ADMIN.PRMODELENTRY TO SBS0_ADMIN WITH GRANT OPTION;

GRANT SELECT ON SBS1_ADMIN.SYSPARAMETERS TO SBS0_ADMIN WITH GRANT OPTION;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.ACCOUNT TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.ALL_LA_EMAILS TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.BDCONSOLIDATION TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.BIHEADER TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.BIHEADER_SBS1 TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.BN_STATS_EMAILS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.CENTRUM_USER_LIST TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.CLEANUP TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.CONTRACT TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.CONTRACT_AMOUNT_RANGE TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.CONTRACT_BILLRATES TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.CONTRACTCOUNTFORACCOUNT TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.CONTRACT_IS_ACTIVE TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.CONTRACT_IS_ACTIVE_OR_TEST TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.CONTRACTS_BY_SHORTID TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.CONTRACTS_BY_SHORTID_A TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.CONTRACT_STATE TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.CONTRACT_ZERO_BILLRATES TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.DUPLICATE_CHECK_LAC TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.DUPLICATE_CHECK_MLC TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.DUPLICATE_CHECK_TOC TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.GETPRICERANGE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.INFO_CONTENT_TRANSPORT_JOIN_BN TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.ISSUE TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.KEYWORD TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.LA_ACNAME TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.LA_INVOICE_EMAILS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.LA_LIST TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.LA_MINCHARGE_PER_SHORTID TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.LA_SETTLING_SUMMARY_1BN TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.LONGIDHIST TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.LONGIDHISTDET TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.MAY_START_ISRV_SETTLEMENT TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.MAY_START_MMSC_SETTLEMENT TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.MAY_START_MSC_SETTLEMENT TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.MAY_START_SMSC_SETTLEMENT TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.MMSCADD TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.MMS_CC_MAPPING TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.MMS_CDR_HEADER TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.MMSCONSOLIDATION TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.MMS_OPER_MAPPING TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.PKG_COMMON_MAPPING TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.PKG_MEC_IC_CSV TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.PKG_PARTAG TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.PKG_WHSYNC TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.PMV_BILLRATES TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.PRICE_MODEL_OVERVIEW TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.PRMODELENTRY TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.RAM_D_CDR_STATISTICS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.RAM_D_REVAC_CQ_BASE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.RAM_D_REVAC_CQ_BASE_W TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.RAM_D_REVAC_CQ_DETAILS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.RAM_D_SR054A_DETAILS_1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.RAM_D_SR054A_DETAILS_2_BASE TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.REVA_COUNTER TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.SETTLING TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SI021A_DETAILS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SL021A_DETAILS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SL058A_BASE_1A_CORR TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SL058A_BASE_1B TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SL058A_BASE_1B_CORR TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SL058A_BASE_1_CORR TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SL058A_DETAILS_1_CORR TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SL094A_FOOTER TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SL094A_HEADER TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SMSC_RAW_DETAILED_1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SMSC_RAW_DRILLDOWN_1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SMSC_RAW_PER_CLASS_1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SMSC_RAW_SUMMARY_1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR001A_BASE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR001A_DETAILS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR019A_DETAILS_1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR019A_DETAILS_2 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR019A_DETAILS_3 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR020A_DETAILS_1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR020A_DETAILS_2 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR021A_DETAILS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR039A_DETAILS_1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR039A_DETAILS_2 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR039A_DETAILS_3 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR045A_DETAILS_1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR045A_DETAILS_2 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR045A_DETAILS_3 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR045A_DETAILS_4 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR045A_DETAILS_5_BASE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR048A_DETAILS_1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR048A_DETAILS_2 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR054A_DETAILS_1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR054A_DETAILS_1_ROLL TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR054A_DETAILS_2_BASE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR054A_DETAILS_2_BASE_ROLL TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR054A_DETAILS_2_ROLL TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR059A_BASE_B TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR059A_BASE_B_MVP TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR059A_BASE_C TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR059A_BASE_C_MVP TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR059A_BASE_D TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR059A_BASE_D_MVP TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR059A_BASE_E TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR059A_BASE_E_MVP TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR060A_DETAILS_1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR061A_DETAILS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR071A_DETAILS_1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR071A_DETAILS_2 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR073A_BASE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR073A_DETAILS_1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR073A_DETAILS_2 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR074A_DETAILS_1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR074A_DETAILS_2 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR074A_DETAILS_3 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR089A_BASE_SCO TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR097A_USERS_ALL TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR111A_DETAILS_1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR111A_DETAILS_12 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR111A_DETAILS_2 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR111A_DETAILS_3 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR111A_DETAILS_4 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR111A_DETAILS_7 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR112A_DETAILS_1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR112A_DETAILS_2 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR119A_DETAILS_1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.STA_CHECKBT_BDCONSOLIDATION TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.STA_CHECKBT_SETTLING TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.SYSPARAMETERS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.TORA_D_REVAC_CQ_IN TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.TORA_D_REVAC_CQ_OUT TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.TORA_D_0067_LATEST TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.WARNINGS_FOR_AAA_INPUT TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.ACCOUNT TO SBS1_CPRO;

GRANT SELECT ON SBS1_ADMIN.CONTRACT TO SBS1_CPRO;

GRANT SELECT ON SBS1_ADMIN.GPSH_KEYWORD_JSON TO SBS1_CPRO;

GRANT EXECUTE ON SBS1_ADMIN.GPSH_PRICE_CONTENT_PUT TO SBS1_CPRO;

GRANT SELECT ON SBS1_ADMIN.GPSH_PRICE_JSON TO SBS1_CPRO;

GRANT EXECUTE ON SBS1_ADMIN.GPSH_TOAC_CON_DEL TO SBS1_CPRO;

GRANT SELECT ON SBS1_ADMIN.GPSH_TOAC_SMSC_JSON TO SBS1_CPRO;

GRANT EXECUTE ON SBS1_ADMIN.GPSH_TPAC_CON_DEL TO SBS1_CPRO;

GRANT SELECT ON SBS1_ADMIN.GPSH_TPAC_CON_JSON TO SBS1_CPRO;

GRANT SELECT ON SBS1_ADMIN.GPSH_TPAC_CON_KEYLIST TO SBS1_CPRO;

GRANT EXECUTE ON SBS1_ADMIN.GPSH_TPAC_CON_PUT TO SBS1_CPRO;

GRANT EXECUTE ON SBS1_ADMIN.GPSH_TPAC_DEL TO SBS1_CPRO;

GRANT SELECT ON SBS1_ADMIN.GPSH_TPAC_JSON TO SBS1_CPRO;

GRANT EXECUTE ON SBS1_ADMIN.GPSH_TPAC_KEYWORD_DEL TO SBS1_CPRO;

GRANT EXECUTE ON SBS1_ADMIN.GPSH_TPAC_KEYWORD_PUT TO SBS1_CPRO;

GRANT EXECUTE ON SBS1_ADMIN.GPSH_TPAC_PUT TO SBS1_CPRO;

GRANT SELECT ON SBS1_ADMIN.GPULL_TOAC_JSON TO SBS1_CPRO;

GRANT EXECUTE ON SBS1_ADMIN.GPULL_TPAC_JSON TO SBS1_CPRO;

GRANT SELECT ON SBS1_ADMIN.KEYWORD TO SBS1_CPRO;

GRANT SELECT ON SBS1_ADMIN.CENTRUM_USER_LIST TO SBS1_DBL_CENTRUM;

GRANT SELECT ON SBS1_ADMIN.RAM_D_CDR_STATISTICS TO SBS1_DBL_RA;

GRANT SELECT ON SBS1_ADMIN.RAM_D_REVAC_CQ_DETAILS TO SBS1_DBL_RA;

GRANT SELECT ON SBS1_ADMIN.RAM_D_SR054A_DETAILS_1 TO SBS1_DBL_RA;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.ACCOUNT TO SBS1_SBSWEB;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.CONTRACT TO SBS1_SBSWEB;

GRANT EXECUTE ON SBS1_ADMIN.CONTRACTCOUNTFORACCOUNT TO SBS1_SBSWEB;

GRANT EXECUTE ON SBS1_ADMIN.CONTRACT_IS_ACTIVE TO SBS1_SBSWEB;

GRANT EXECUTE ON SBS1_ADMIN.CONTRACT_IS_ACTIVE_OR_TEST TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.DUPLICATE_CHECK_LAC TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.DUPLICATE_CHECK_MLC TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.DUPLICATE_CHECK_TOC TO SBS1_SBSWEB;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.ISSUE TO SBS1_SBSWEB;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.KEYWORD TO SBS1_SBSWEB;

GRANT EXECUTE ON SBS1_ADMIN.LA_ACNAME TO SBS1_SBSWEB;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.MMSCADD TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.PRICE_MODEL_OVERVIEW TO SBS1_SBSWEB;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.PRMODELENTRY TO SBS1_SBSWEB;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.SYSPARAMETERS TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.ACCOUNT TO SBS2_ADMIN WITH GRANT OPTION;

GRANT SELECT, UPDATE ON SBS1_ADMIN.BIHEADER_SBS1 TO SBS2_ADMIN WITH GRANT OPTION;

GRANT SELECT ON SBS1_ADMIN.CONTRACT TO SBS2_ADMIN WITH GRANT OPTION;

GRANT SELECT ON SBS1_ADMIN.ACCOUNT TO SBS2_APP;

GRANT SELECT, UPDATE ON SBS1_ADMIN.BIHEADER_SBS1 TO SBS2_APP;

GRANT SELECT ON SBS1_ADMIN.CONTRACT TO SBS2_APP;

GRANT SELECT ON SBS1_ADMIN.CONIOT TO SBS0_ADMIN;

GRANT SELECT ON SBS1_ADMIN.CONIOTE TO SBS0_ADMIN;

GRANT SELECT ON SBS1_ADMIN.CONTENTSERVICE TO SBS0_ADMIN WITH GRANT OPTION;

GRANT SELECT ON SBS1_ADMIN.CONIOT TO SBS0_APP;

GRANT SELECT ON SBS1_ADMIN.CONIOTE TO SBS0_APP;

GRANT DELETE, SELECT ON SBS1_ADMIN.BDETAIL7 TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.CONIOT TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.CONIOTE TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.CONTENTSERVICE TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.CONTRACT_IOT TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.CONTRACT_IOT_CHF TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.CS_IS_ACTIVE TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.CS_IS_ACTIVE_OR_TEST TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.CS_STATE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.DUPLICATE_CHECK_IPC TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.IP_SETTLING_DOCUMENTS_1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.LA_SETTLING_ACCUMULATED TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.LA_SETTLING_POSITIONS_1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.LA_SETTLING_SUMMARY_1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.LA_SETTLING_SUMMARY_1B TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.RAM_D_SR054A_DETAILS_2 TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.SETDETAIL TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SI003A_DETAILS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SI011A_DETAILS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SL058A_BASE_1A TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SL087A_DETAILS_1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SL091A_DETAILS_1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SMSC_LA_SETTLING_1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR002A_DETAILS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR003A_DETAILS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR011A_DETAILS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR022A_DETAILS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR022A_DETAILS_OLD TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR036A_DETAILS_1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR045A_DETAILS_5 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR054A_DETAILS_2 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR059A_BASE_A TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR059A_BASE_A_MVP TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR059A_BASE_MVP TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR059A_DETAILS_5 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR059A_DETAILS_6 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR077A_DETAILS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR089A_CONTRACT TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR111A_DETAILS_10 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR116A_DETAILS_4 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.GPSH_CONTENT_SERVICE_KEYLIST TO SBS1_CPRO;

GRANT SELECT ON SBS1_ADMIN.GPSH_TOAC_CON_JSON TO SBS1_CPRO;

GRANT EXECUTE ON SBS1_ADMIN.GPSH_TOAC_CON_PUT TO SBS1_CPRO;

GRANT EXECUTE ON SBS1_ADMIN.GPSH_TPAC_CS_DEL TO SBS1_CPRO;

GRANT EXECUTE ON SBS1_ADMIN.GPSH_TPAC_CS_PUT TO SBS1_CPRO;

GRANT EXECUTE ON SBS1_ADMIN.GPULL_TOCON_JSON TO SBS1_CPRO;

GRANT SELECT ON SBS1_ADMIN.RAM_D_SR054A_DETAILS_2 TO SBS1_DBL_RA;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.CONIOT TO SBS1_SBSWEB;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.CONIOTE TO SBS1_SBSWEB;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.CONTENTSERVICE TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.DUPLICATE_CHECK_IPC TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.SL058A_BASE_1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SL058A_DETAILS_1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR059A_BASE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR059A_DETAILS_1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR059A_DETAILS_2 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR059A_DETAILS_3 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR059A_DETAILS_4 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.GPSH_CONTENT_SERVICE_JSON TO SBS1_CPRO;

GRANT SELECT ON SBS1_ADMIN.A2P_SMSC_CDRS TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.BDETAIL TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.BDETAIL1 TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.BDETAIL2 TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.BDETAIL4 TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.BDETAIL6 TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.BDETAIL9 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.BD_RECENT_BDETAIL TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.BD_RECENT_BDETAIL1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.BD_RECENT_BDETAIL2 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.BD_RECENT_BDETAIL4 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.BD_RECENT_BDETAIL6 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.BD_RECENT_BDETAIL9 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.BD_RECENT_VAS TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.BOHEADER TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.CDRMMS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.CDRSMS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.CDR_SUMMARY_BILLRATE_N TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.CDR_SUMMARY_BILLRATE_NA TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.CDR_SUMMARY_BILLRATE_0 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.CDR_SUMMARY_BILLRATE_1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.CDR_SUMMARY_BILLRATE_1A TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.CDR_SUMMARY_BILLRATE_1_BN TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.CDR_SUMMARY_BILLRATE_1_BNA TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.CDR_SUMMARY_BILLRATE_1_IS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.CDR_SUMMARY_BILLRATE_1_ISA TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.CDR_SUMMARY_BILLRATE_1_WEEK TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.CDR_SUMMARY_BILLTEXT_BN TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.CDR_SUMMARY_BILLTEXT_WCB TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.CDR_SUMMARY_LOCATION_1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.CDR_SUMMARY_STYPE_BN TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.CONFIGURE_FOR_TEST TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.IWTCOUNTER TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.JOB_ADRID_MAIN_EMAIL TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.JOB_BN_STATS_EMAILS TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.JOB_BOHIDEXEC TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.JOB_DATEFROM TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.JOB_DATETILL TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.JOB_DATETO TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.JOB_EXPANDED_SQL TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.JOB_LA_INVOICE_EMAILS TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.JOB_LOOPVAR TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.JOB_PARAMETER TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.JOB_SEARCH_PARAMETER TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.JOB_SEARCH_PARAMETER_TEST TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.KEYWORDS_PER_DAY TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.KEYWORDS_PER_DAY_1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.MAPPACDEP TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.MAY_USE_ALL_PARTITIONS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.MAY_USE_BDETAIL_PARTITIONS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.MAY_USE_BDETAIL1_PARTITIONS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.MAY_USE_BDETAIL4_PARTITIONS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.MAY_USE_BDETAIL6_PARTITIONS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.MAY_USE_MONTH_PARTITIONS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.MAY_USE_REVAOTHERS_PARTITIONS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.MAY_USE_REVI_PARTITIONS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.MMS_CDR_DETAIL TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.MMS_SUBMIT_DUPLICATES TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.PACKING TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.PACPACDEP TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.PKG_ADMIN_COMMON TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.PKG_BDETAIL_COMMON TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.PKG_BDETAIL_INFO TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.PKG_BDETAIL_MMSC TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.PKG_BDETAIL_MSC TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.PKG_BDETAIL_SETTLEMENT TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.PKG_BDETAIL_SMSC TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.PKG_COMMON_PACKING TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.PKG_COMMON_STATS TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.PKG_INTERWORKING TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.PKG_KPI_BD TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.PKG_KPI_BD1 TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.PKG_KPI_BD2 TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.PKG_MEC_HB TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.PKG_MEC_IC_ASCII0 TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.PKG_MEC_OC TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.PKG_REVA TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.PKG_REVI TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.PKG_STATS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.RAM_D_BDETAIL6_DETAILS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.RAM_D_BDETAIL6_IOR_BASE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.RAM_D_BDETAIL6_IOR_B10 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.RAM_D_BDETAIL6_IOR_DETAILS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.RAM_D_BDETAIL6_IOR_I10 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.RAM_D_SR054A_DETAILS_3 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.RAM_D_SR054A_DETAILS_3_BASE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.RAM_D_SR054A_DETAILS_3_FG TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.RAM_D_SR054A_DETAILS_3_90 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.RAM_D_SR054A_DETAILS_3_90B TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.RAM_D_SR075A_BASE_6 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.RAM_D_SR075A_BASE_7 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.RAM_D_SR075A_DETAILS_6 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.RAM_D_SR075A_DETAILS_7 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SERVICES_PER_DAY TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SERVICETYPES_PER_DAY TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SI008A_DETAILS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SI012A_DETAILS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SI029A_DETAILS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SI056A_DETAILS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SI057A_DETAILS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SI121A_DETAILS_1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SI121A_DETAILS_2 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SI121A_DETAILS_3 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SL087A_DETAILS_2 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SL091A_DETAILS_2 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SL093A_BASE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SL093A_DETAILS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SL093A_FOOTER TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SL093A_HEADER TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SL093A_RECORDS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SL094A_DETAILS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SL094A_RECORDS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SMS_SHIFTED_TIMESTAMPS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR000A_REPORT TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR005A_DETAILS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR006A_DETAILS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR007A_DETAILS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR008A_DETAILS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR012A_DETAILS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR013A_DETAILS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR014A_DETAILS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR015A_DETAILS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR016A_DETAILS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR017A_DETAILS_1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR017A_DETAILS_2 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR018A_DETAILS_1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR018A_DETAILS_2 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR023A_DETAILS_1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR023A_DETAILS_2 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR024A_DETAILS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR025A_DETAILS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR026A_DETAILS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR030A_DETAILS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR031A_DETAILS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR034A_DETAILS_1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR034A_DETAILS_2 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR034A_DETAILS_2_BASE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR034A_DETAILS_3 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR034A_DETAILS_4 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR034A_DETAILS_4_BASE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR035A_DETAILS_1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR035A_DETAILS_4 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR038A_BASE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR038A_DETAILS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR039A_DETAILS_4 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR040A_DETAILS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR042A_DETAILS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR043A_DETAILS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR043A_DETAILS_MVP TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR043A_DETAILS_SPENDEN TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR044A_DETAILS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR054A_DETAILS_3 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR054A_DETAILS_3_BASE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR054A_DETAILS_3_BASE_ROLL TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR054A_DETAILS_3_ROLL TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR074_BASE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR075A_BASE_6 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR075A_BASE_7 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR075A_DETAILS_1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR075A_DETAILS_6 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR075A_DETAILS_7 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR076A_BASE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR076A_BASE_1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR076A_DETAILS_1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR076A_DETAILS_2 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR076A_DETAILS_3 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR076A_DETAILS_4 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR076A_DETAILS_5 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR076A_DETAILS_6 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR076A_DETAILS_7 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR078A_DETAILS_N TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR078A_DETAILS_1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR078A_DETAILS_2 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR078A_DETAILS_3 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR078A_DETAILS_4 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR088A_DEL_BASE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR088A_DETAILS1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR088A_DETAILS2 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR088A_SUB_BASE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR089A_BASE TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR089A_BASE_SCT TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR089A_DETAILS_1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR089A_DETAILS_2 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR089A_DETAILS_3 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR098A_DETAILS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR107A_DETAILS_1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR107A_DETAILS_2 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR107A_DETAILS_3 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR107A_DETAILS_4 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR108A_DETAILS_1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR109A_DETAILS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR110A_DETAILS_1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR111A_DETAILS_11 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR111A_DETAILS_5 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR118A_DETAILS_1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SR118A_DETAILS_2 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.STA_CHECKBT_BDETAIL TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.STA_CHECKBT_BDETAIL1 TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.STA_CHECKBT_BDETAIL2 TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.STA_DIRECTORY TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.STA_GETNEXTJOB TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.STA_JOB TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.STA_JOBOUTPUT TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.STA_JOBPARAM TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.STA_JOBSQL TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.STA_PACPARAM TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.STA_SQLDEF TO SBS1_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.STA_SUBSCRIPTION TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.STATS_ANALYZEJOB TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.STA_WEB_JOB_LIST TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.STA_WEB_STAT_ANALYSIS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.STA_WEB_TEMP_LIST TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.SUSPEND_MEC_ICS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.TORA_D_BDETAIL6_IOR_IN_OUT TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.TORA_D_SR054A_DETAILS_3_OUT TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.TORA_D_SR054A_DETAILS_3_ZERO TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.TORA_D_0056_LATEST TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.TORA_D_0065_LATEST TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.TORA_D_0065_LATEST_SORTED TO SBS1_APP;

GRANT EXECUTE ON SBS1_ADMIN.USERMNG_SBS TO SBS1_APP;

GRANT SELECT ON SBS1_ADMIN.BDETAIL6 TO SBS1_APP_USER_R;

GRANT EXECUTE ON SBS1_ADMIN.GPSH_CURRENCY_EXR_DEL TO SBS1_CPRO;

GRANT EXECUTE ON SBS1_ADMIN.GPSH_CURRENCY_EXR_PUT TO SBS1_CPRO;

GRANT EXECUTE ON SBS1_ADMIN.USERMNG_SBS TO SBS1_DBL_CENTRUM;

GRANT SELECT ON SBS1_ADMIN.RAM_D_BDETAIL6_DETAILS TO SBS1_DBL_RA;

GRANT SELECT ON SBS1_ADMIN.RAM_D_BDETAIL6_IOR_DETAILS TO SBS1_DBL_RA;

GRANT SELECT ON SBS1_ADMIN.RAM_D_SR054A_DETAILS_3 TO SBS1_DBL_RA;

GRANT SELECT ON SBS1_ADMIN.RAM_D_SR054A_DETAILS_3_90 TO SBS1_DBL_RA;

GRANT SELECT ON SBS1_ADMIN.RAM_D_SR075A_DETAILS_6 TO SBS1_DBL_RA;

GRANT SELECT ON SBS1_ADMIN.RAM_D_SR075A_DETAILS_7 TO SBS1_DBL_RA;

GRANT SELECT ON SBS1_ADMIN.SR075A_DETAILS_1 TO SBS1_DBL_RA;

GRANT SELECT ON SBS1_ADMIN.SR075A_DETAILS_6 TO SBS1_DBL_RA;

GRANT SELECT ON SBS1_ADMIN.SR075A_DETAILS_7 TO SBS1_DBL_RA;

GRANT SELECT ON SBS1_ADMIN.BDETAIL TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.BDETAIL1 TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.BDETAIL6 TO SBS1_SBSWEB;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.IWTCOUNTER TO SBS1_SBSWEB;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.PACKING TO SBS1_SBSWEB;

GRANT EXECUTE ON SBS1_ADMIN.PKG_ADMIN_COMMON TO SBS1_SBSWEB;

GRANT EXECUTE ON SBS1_ADMIN.PKG_BDETAIL_COMMON TO SBS1_SBSWEB;

GRANT EXECUTE ON SBS1_ADMIN.PKG_INTERWORKING TO SBS1_SBSWEB;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.STA_DIRECTORY TO SBS1_SBSWEB;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.STA_JOB TO SBS1_SBSWEB;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.STA_JOBOUTPUT TO SBS1_SBSWEB;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.STA_JOBPARAM TO SBS1_SBSWEB;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.STA_JOBSQL TO SBS1_SBSWEB;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.STA_PACPARAM TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.STA_WEB_JOB_LIST TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.STA_WEB_JOB_LIST_CUC TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.STA_WEB_JOB_LIST_IS TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.STA_WEB_JOB_LIST_IW TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.STA_WEB_JOB_LIST_LA TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.STA_WEB_JOB_LIST_SYS TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.STA_WEB_STAT_ANALYSIS TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.STA_WEB_TEMP_LIST TO SBS1_SBSWEB;

GRANT SELECT ON SBS1_ADMIN.BDETAIL TO SBS2_ADMIN WITH GRANT OPTION;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.BDETAIL6 TO SBS2_ADMIN WITH GRANT OPTION;

GRANT SELECT ON SBS1_ADMIN.MAY_USE_MONTH_PARTITIONS TO SBS2_ADMIN WITH GRANT OPTION;

GRANT SELECT ON SBS1_ADMIN.BDETAIL TO SBS2_APP;

GRANT DELETE, INSERT, SELECT, UPDATE ON SBS1_ADMIN.BDETAIL6 TO SBS2_APP;

GRANT SELECT ON SBS1_ADMIN.MAY_USE_MONTH_PARTITIONS TO SBS2_APP;

--
-- Note: 
-- The following objects may not be sorted properly in the script due to circular references
--
--  BDETAIL  (Table) 
--  BDETAIL1  (Table) 
--  BDETAIL2  (Table) 
--  BDETAIL4  (Table) 
--  BDETAIL6  (Table) 
--  BDETAIL9  (Table) 
--  BOHEADER  (Table) 
--  IWTCOUNTER  (Table) 
--  MAPPACDEP  (Table) 
--  PACKING  (Table) 
--  PACPACDEP  (Table) 
--  STA_DIRECTORY  (Table) 
--  STA_JOB  (Table) 
--  STA_JOBOUTPUT  (Table) 
--  STA_JOBPARAM  (Table) 
--  STA_JOBSQL  (Table) 
--  STA_PACPARAM  (Table) 
--  STA_SQLDEF  (Table) 
--  STA_SUBSCRIPTION  (Table) 
--  IDX_BD_BIHID  (Index) 
--  IDX_BD_BIHID1  (Index) 
--  IDX_BD_BIHID2  (Index) 
--  IDX_BD_BIHID4  (Index) 
--  IDX_BD_BIHID6  (Index) 
--  IDX_BD_BIHID9  (Index) 
--  IDX_BD_BILLID1  (Index) 
--  IDX_BD_BILLID2  (Index) 
--  IDX_BD_BOHID1  (Index) 
--  IDX_BD_BOHID11  (Index) 
--  IDX_BD_BOHID12  (Index) 
--  IDX_BD_BOHID14  (Index) 
--  IDX_BD_BOHID16  (Index) 
--  IDX_BD_BOHID19  (Index) 
--  IDX_BD_BOHID2  (Index) 
--  IDX_BD_BOHID21  (Index) 
--  IDX_BD_BOHID22  (Index) 
--  IDX_BD_BOHID24  (Index) 
--  IDX_BD_BOHID26  (Index) 
--  IDX_BD_BOHID29  (Index) 
--  IDX_BD_BOHID3  (Index) 
--  IDX_BD_BOHID31  (Index) 
--  IDX_BD_BOHID32  (Index) 
--  IDX_BD_BOHID34  (Index) 
--  IDX_BD_BOHID36  (Index) 
--  IDX_BD_BOHID39  (Index) 
--  IDX_BD_DATETIME  (Index) 
--  IDX_BD_DATETIME1  (Index) 
--  IDX_BD_DATETIME2  (Index) 
--  IDX_BD_DATETIME6  (Index) 
--  IDX_BD_ID  (Index) 
--  IDX_BD_ID1  (Index) 
--  IDX_BD_ID2  (Index) 
--  IDX_BD_ID4  (Index) 
--  IDX_BD_ID6  (Index) 
--  IDX_BD_ID9  (Index) 
--  IDX_BD_MSGID  (Index) 
--  IDX_BD_PACSID1  (Index) 
--  IDX_BD_PACSID11  (Index) 
--  IDX_BD_PACSID12  (Index) 
--  IDX_BD_PACSID14  (Index) 
--  IDX_BD_PACSID16  (Index) 
--  IDX_BD_PACSID19  (Index) 
--  IDX_BD_PACSID2  (Index) 
--  IDX_BD_PACSID21  (Index) 
--  IDX_BD_PACSID22  (Index) 
--  IDX_BD_PACSID24  (Index) 
--  IDX_BD_PACSID26  (Index) 
--  IDX_BD_PACSID29  (Index) 
--  IDX_BD_PACSID3  (Index) 
--  IDX_BD_PACSID31  (Index) 
--  IDX_BD_PACSID32  (Index) 
--  IDX_BD_PACSID34  (Index) 
--  IDX_BD_PACSID36  (Index) 
--  IDX_BD_PACSID39  (Index) 
--  IDX_BD_REQUESTID  (Index) 
--  IDX_BD_UMSGGRPID  (Index) 
--  IDX_BOH_DATETIME  (Index) 
--  IDX_IWTC_BOHID1  (Index) 
--  IDX_IWTC_DATE_SMSCID  (Index) 
--  IDX_OBJECT_VALUE  (Index) 
--  IDX_PAC_ID  (Index) 
--  IDX_STAJOB_ESID  (Index) 
--  IDX_STAJOB_PARENTID  (Index) 
--  IDX_U_JOBIDNAME  (Index) 
--  IDX_U_JOBIDQUERYNAME  (Index) 
--  IDX_U_PACIDPARAMNAME  (Index) 
--  IDX_U_PACIDQUERYNAME  (Index) 
--  PK_BOHEADER  (Index) 
--  PK_PACKING  (Index) 
--  PK_STA_DIRECTORY  (Index) 
--  PK_STAJOB  (Index) 
--  PK_STAJOBOUTPUT  (Index) 
--  PK_STAJOBPARAM  (Index) 
--  PK_STAPACPARAM  (Index) 
--  PK_STA_SQLDEF  (Index) 
--  PK_STASUBSCRIPTION  (Index) 
--  PKG_ADMIN_COMMON  (Package) 
--  PKG_BDETAIL_COMMON  (Package) 
--  PKG_BDETAIL_INFO  (Package) 
--  PKG_BDETAIL_MMSC  (Package) 
--  PKG_BDETAIL_MSC  (Package) 
--  PKG_BDETAIL_SETTLEMENT  (Package) 
--  PKG_BDETAIL_SMSC  (Package) 
--  PKG_COMMON_PACKING  (Package) 
--  PKG_COMMON_STATS  (Package) 
--  PKG_INTERWORKING  (Package) 
--  PKG_KPI_BD  (Package) 
--  PKG_KPI_BD1  (Package) 
--  PKG_KPI_BD2  (Package) 
--  PKG_MEC_HB  (Package) 
--  PKG_MEC_IC_ASCII0  (Package) 
--  PKG_MEC_OC  (Package) 
--  PKG_REVA  (Package) 
--  PKG_REVI  (Package) 
--  PKG_STATS  (Package) 
--  USERMNG_SBS  (Package) 
--  PKG_ADMIN_COMMON  (Package Body) 
--  PKG_BDETAIL_COMMON  (Package Body) 
--  PKG_BDETAIL_INFO  (Package Body) 
--  PKG_BDETAIL_MMSC  (Package Body) 
--  PKG_BDETAIL_MSC  (Package Body) 
--  PKG_BDETAIL_SETTLEMENT  (Package Body) 
--  PKG_BDETAIL_SMSC  (Package Body) 
--  PKG_COMMON_PACKING  (Package Body) 
--  PKG_COMMON_STATS  (Package Body) 
--  PKG_INTERWORKING  (Package Body) 
--  PKG_KPI_BD  (Package Body) 
--  PKG_KPI_BD1  (Package Body) 
--  PKG_KPI_BD2  (Package Body) 
--  PKG_MEC_HB  (Package Body) 
--  PKG_MEC_IC_ASCII0  (Package Body) 
--  PKG_MEC_OC  (Package Body) 
--  PKG_REVA  (Package Body) 
--  PKG_REVI  (Package Body) 
--  PKG_STATS  (Package Body) 
--  USERMNG_SBS  (Package Body) 
--  CONFIGURE_FOR_TEST  (Procedure) 
--  GPSH_CURRENCY_EXR_DEL  (Procedure) 
--  GPSH_CURRENCY_EXR_PUT  (Procedure) 
--  SP_CONS_ISMSISDN  (Procedure) 
--  STATS_ANALYZEJOB  (Procedure) 
--  JOB_ADRID_MAIN_EMAIL  (Function) 
--  JOB_BN_STATS_EMAILS  (Function) 
--  JOB_BOHIDEXEC  (Function) 
--  JOB_DATEFROM  (Function) 
--  JOB_DATETILL  (Function) 
--  JOB_DATETO  (Function) 
--  JOB_EXPANDED_SQL  (Function) 
--  JOB_LA_INVOICE_EMAILS  (Function) 
--  JOB_LOOPVAR  (Function) 
--  JOB_PARAMETER  (Function) 
--  JOB_SEARCH_PARAMETER  (Function) 
--  JOB_SEARCH_PARAMETER_TEST  (Function) 
--  KPI_SMS_LA_REVENUE  (Function) 
--  A2P_SMSC_CDRS  (View) 
--  BDETAIL_RA_CHECK  (View) 
--  BD_RECENT_BDETAIL  (View) 
--  BD_RECENT_BDETAIL1  (View) 
--  BD_RECENT_BDETAIL2  (View) 
--  BD_RECENT_BDETAIL4  (View) 
--  BD_RECENT_BDETAIL6  (View) 
--  BD_RECENT_BDETAIL9  (View) 
--  BD_RECENT_VAS  (View) 
--  CDRMMS  (View) 
--  CDRSMS  (View) 
--  CDR_SUMMARY_BILLRATE_N  (View) 
--  CDR_SUMMARY_BILLRATE_NA  (View) 
--  CDR_SUMMARY_BILLRATE_0  (View) 
--  CDR_SUMMARY_BILLRATE_1  (View) 
--  CDR_SUMMARY_BILLRATE_1A  (View) 
--  CDR_SUMMARY_BILLRATE_1_BN  (View) 
--  CDR_SUMMARY_BILLRATE_1_BNA  (View) 
--  CDR_SUMMARY_BILLRATE_1_IS  (View) 
--  CDR_SUMMARY_BILLRATE_1_ISA  (View) 
--  CDR_SUMMARY_BILLRATE_1_WEEK  (View) 
--  CDR_SUMMARY_BILLTEXT_BN  (View) 
--  CDR_SUMMARY_BILLTEXT_WCB  (View) 
--  CDR_SUMMARY_LOCATION_1  (View) 
--  CDR_SUMMARY_STYPE_BN  (View) 
--  DT_BOH  (View) 
--  DT_BOH_RECENT  (View) 
--  DT_BOH_RECENT_CONSOL_DAILY  (View) 
--  DT_BOH_RECENT_CONSOL_MONTHLY  (View) 
--  DT_BOH_RECENT_MOLA  (View) 
--  DT_BOH_RECENT_MOLAA  (View) 
--  DT_BOH_RECENT_MOLAMCC  (View) 
--  DT_BOH_RECENT_MSC  (View) 
--  DT_BOH_RECENT_MSCCU  (View) 
--  DT_BOH_RECENT_OPER  (View) 
--  DT_BOH_RECENT_REVA  (View) 
--  DT_BOH_RECENT_SMSCCU  (View) 
--  DT_BOH_RECENT_TORA  (View) 
--  DT_BOH_RECENT_ZIPPER  (View) 
--  KEYWORDS_PER_DAY  (View) 
--  KEYWORDS_PER_DAY_1  (View) 
--  MAY_USE_ALL_PARTITIONS  (View) 
--  MAY_USE_BDETAIL_PARTITIONS  (View) 
--  MAY_USE_BDETAIL1_PARTITIONS  (View) 
--  MAY_USE_BDETAIL4_PARTITIONS  (View) 
--  MAY_USE_BDETAIL6_PARTITIONS  (View) 
--  MAY_USE_MONTH_PARTITIONS  (View) 
--  MAY_USE_REVAOTHERS_PARTITIONS  (View) 
--  MAY_USE_REVI_PARTITIONS  (View) 
--  MMS_CDR_DETAIL  (View) 
--  MMS_SUBMIT_DUPLICATES  (View) 
--  RAM_D_BDETAIL6_DETAILS  (View) 
--  RAM_D_BDETAIL6_IOR_BASE  (View) 
--  RAM_D_BDETAIL6_IOR_B10  (View) 
--  RAM_D_BDETAIL6_IOR_DETAILS  (View) 
--  RAM_D_BDETAIL6_IOR_I10  (View) 
--  RAM_D_SR054A_DETAILS_3  (View) 
--  RAM_D_SR054A_DETAILS_3_BASE  (View) 
--  RAM_D_SR054A_DETAILS_3_FG  (View) 
--  RAM_D_SR054A_DETAILS_3_90  (View) 
--  RAM_D_SR054A_DETAILS_3_90B  (View) 
--  RAM_D_SR075A_BASE_6  (View) 
--  RAM_D_SR075A_BASE_7  (View) 
--  RAM_D_SR075A_DETAILS_6  (View) 
--  RAM_D_SR075A_DETAILS_7  (View) 
--  SAMPLES_ICB_BEIUK_PO  (View) 
--  SAMPLES_ICB_BEIUK_P0_ERR_T  (View) 
--  SAMPLES_ICB_BEIUK_P0_INACT_T  (View) 
--  SAMPLES_ICB_BEIUK_P0_IW_T  (View) 
--  SAMPLES_ICB_SMCH80  (View) 
--  SAMPLES_ICB_SMCH80_ERR_O  (View) 
--  SAMPLES_ICB_SMCH80_ERR_T  (View) 
--  SAMPLES_ICB_SMCH80_INACT_O  (View) 
--  SAMPLES_ICB_SMCH80_INACT_T  (View) 
--  SAMPLES_ICB_SMCH80_IW_O  (View) 
--  SAMPLES_ICB_SMCH80_IW_T  (View) 
--  SAMPLES_ICB_SMCH80_ROAM_O  (View) 
--  SAMPLES_ICB_SMCH80_ROAM_T  (View) 
--  SAMPLES_ICB_SMCH90  (View) 
--  SAMPLES_ICB_SMCH90_ERR_O  (View) 
--  SAMPLES_ICB_SMCH90_ERR_T  (View) 
--  SAMPLES_ICB_SMCH90_INACT_O  (View) 
--  SAMPLES_ICB_SMCH90_INACT_T  (View) 
--  SAMPLES_ICB_SMCH90_IW_O  (View) 
--  SAMPLES_ICB_SMCH90_IW_T  (View) 
--  SAMPLES_ICB_SMCH90_ROAM_O  (View) 
--  SAMPLES_ICB_SMCH90_ROAM_T  (View) 
--  SERVICES_PER_DAY  (View) 
--  SERVICETYPES_PER_DAY  (View) 
--  SI008A_DETAILS  (View) 
--  SI012A_DETAILS  (View) 
--  SI029A_DETAILS  (View) 
--  SI056A_DETAILS  (View) 
--  SI057A_DETAILS  (View) 
--  SI096A_TEMPLATE  (View) 
--  SI121A_DETAILS_1  (View) 
--  SI121A_DETAILS_2  (View) 
--  SI121A_DETAILS_3  (View) 
--  SL087A_DETAILS_2  (View) 
--  SL091A_DETAILS_2  (View) 
--  SL093A_BASE  (View) 
--  SL093A_DETAILS  (View) 
--  SL093A_FOOTER  (View) 
--  SL093A_HEADER  (View) 
--  SL093A_RECORDS  (View) 
--  SL094A_DETAILS  (View) 
--  SL094A_RECORDS  (View) 
--  SMS_SHIFTED_TIMESTAMPS  (View) 
--  SR000A_REPORT  (View) 
--  SR005A_DETAILS  (View) 
--  SR006A_DETAILS  (View) 
--  SR007A_DETAILS  (View) 
--  SR008A_DETAILS  (View) 
--  SR012A_DETAILS  (View) 
--  SR013A_DETAILS  (View) 
--  SR014A_DETAILS  (View) 
--  SR015A_DETAILS  (View) 
--  SR016A_DETAILS  (View) 
--  SR017A_DETAILS_1  (View) 
--  SR017A_DETAILS_2  (View) 
--  SR018A_DETAILS_1  (View) 
--  SR018A_DETAILS_2  (View) 
--  SR023A_DETAILS_1  (View) 
--  SR023A_DETAILS_2  (View) 
--  SR024A_DETAILS  (View) 
--  SR025A_DETAILS  (View) 
--  SR026A_DETAILS  (View) 
--  SR030A_DETAILS  (View) 
--  SR031A_DETAILS  (View) 
--  SR034A_DETAILS_1  (View) 
--  SR034A_DETAILS_2  (View) 
--  SR034A_DETAILS_2_BASE  (View) 
--  SR034A_DETAILS_3  (View) 
--  SR034A_DETAILS_4  (View) 
--  SR034A_DETAILS_4_BASE  (View) 
--  SR035A_DETAILS_1  (View) 
--  SR035A_DETAILS_4  (View) 
--  SR038A_BASE  (View) 
--  SR038A_BASE1  (View) 
--  SR038A_DETAILS  (View) 
--  SR039A_DETAILS_4  (View) 
--  SR040A_DETAILS  (View) 
--  SR042A_DETAILS  (View) 
--  SR043A_DETAILS  (View) 
--  SR043A_DETAILS_MVP  (View) 
--  SR043A_DETAILS_SPENDEN  (View) 
--  SR044A_DETAILS  (View) 
--  SR054A_DETAILS_3  (View) 
--  SR054A_DETAILS_3_BASE  (View) 
--  SR054A_DETAILS_3_BASE_ROLL  (View) 
--  SR054A_DETAILS_3_ROLL  (View) 
--  SR074_BASE  (View) 
--  SR075A_BASE_6  (View) 
--  SR075A_BASE_7  (View) 
--  SR075A_DETAILS_1  (View) 
--  SR075A_DETAILS_6  (View) 
--  SR075A_DETAILS_7  (View) 
--  SR076A_BASE  (View) 
--  SR076A_BASE_1  (View) 
--  SR076A_DETAILS_1  (View) 
--  SR076A_DETAILS_2  (View) 
--  SR076A_DETAILS_3  (View) 
--  SR076A_DETAILS_4  (View) 
--  SR076A_DETAILS_5  (View) 
--  SR076A_DETAILS_6  (View) 
--  SR076A_DETAILS_7  (View) 
--  SR078A_DETAILS_N  (View) 
--  SR078A_DETAILS_1  (View) 
--  SR078A_DETAILS_2  (View) 
--  SR078A_DETAILS_3  (View) 
--  SR078A_DETAILS_4  (View) 
--  SR088A_DEL_BASE  (View) 
--  SR088A_DETAILS1  (View) 
--  SR088A_DETAILS2  (View) 
--  SR088A_SUB_BASE  (View) 
--  SR089A_BASE  (View) 
--  SR089A_BASE_SCT  (View) 
--  SR089A_BASE_SCT_INACT  (View) 
--  SR089A_BASE_SCT_NEW  (View) 
--  SR089A_BASE_SCT_NOC  (View) 
--  SR089A_DETAILS_1  (View) 
--  SR089A_DETAILS_2  (View) 
--  SR089A_DETAILS_3  (View) 
--  SR098A_DETAILS  (View) 
--  SR107A_BASE_1  (View) 
--  SR107A_BASE_2  (View) 
--  SR107A_DETAILS_1  (View) 
--  SR107A_DETAILS_2  (View) 
--  SR107A_DETAILS_3  (View) 
--  SR107A_DETAILS_4  (View) 
--  SR108A_BASE  (View) 
--  SR108A_BASE_1  (View) 
--  SR108A_DETAILS_1  (View) 
--  SR109A_DETAILS  (View) 
--  SR110A_DETAILS_1  (View) 
--  SR111A_BASE_11  (View) 
--  SR111A_BASE_5  (View) 
--  SR111A_DETAILS_11  (View) 
--  SR111A_DETAILS_5  (View) 
--  SR114A_DETAILS  (View) 
--  SR115A_BASE  (View) 
--  SR115A_DETAILS_1  (View) 
--  SR117A_DETAILS  (View) 
--  SR117A_FOOTER  (View) 
--  SR117A_HEADER  (View) 
--  SR117A_RECORDS  (View) 
--  SR118A_DETAILS_1  (View) 
--  SR118A_DETAILS_2  (View) 
--  SR120A_DETAILS  (View) 
--  STA_CHECKBT_BDETAIL  (View) 
--  STA_CHECKBT_BDETAIL1  (View) 
--  STA_CHECKBT_BDETAIL2  (View) 
--  STA_GETNEXTJOB  (View) 
--  STA_WEB_JOB_BASE_CUC  (View) 
--  STA_WEB_JOB_BASE_IS  (View) 
--  STA_WEB_JOB_BASE_IW  (View) 
--  STA_WEB_JOB_BASE_LA  (View) 
--  STA_WEB_JOB_BASE_SYS  (View) 
--  STA_WEB_JOB_LIST  (View) 
--  STA_WEB_JOB_LIST_CUC  (View) 
--  STA_WEB_JOB_LIST_IS  (View) 
--  STA_WEB_JOB_LIST_IW  (View) 
--  STA_WEB_JOB_LIST_LA  (View) 
--  STA_WEB_JOB_LIST_SYS  (View) 
--  STA_WEB_STAT_ANALYSIS  (View) 
--  STA_WEB_TEMP_LIST  (View) 
--  SUSPEND_MEC_ICS  (View) 
--  TORA_D_BDETAIL6_IOR_IN_OUT  (View) 
--  TORA_D_SR054A_DETAILS_3_LEGAL  (View) 
--  TORA_D_SR054A_DETAILS_3_OUT  (View) 
--  TORA_D_SR054A_DETAILS_3_ZERO  (View) 
--  TORA_D_0056_LATEST  (View) 
--  TORA_D_0065_LATEST  (View) 
--  TORA_D_0065_LATEST_SORTED  (View) 
--  STA_WATCHPACKINGSTATECHANGES  (Trigger) 
--  PPB_CDRMMS  (Synonym) 
--  PPB_CDRSMS  (Synonym) 
--  A2P_SMSC_CDRS TO SBS1_APP  (Grant) 
--  BDETAIL TO SBS1_APP  (Grant) 
--  BDETAIL1 TO SBS1_APP  (Grant) 
--  BDETAIL2 TO SBS1_APP  (Grant) 
--  BDETAIL4 TO SBS1_APP  (Grant) 
--  BDETAIL6 TO SBS1_APP  (Grant) 
--  BDETAIL9 TO SBS1_APP  (Grant) 
--  BD_RECENT_BDETAIL TO SBS1_APP  (Grant) 
--  BD_RECENT_BDETAIL1 TO SBS1_APP  (Grant) 
--  BD_RECENT_BDETAIL2 TO SBS1_APP  (Grant) 
--  BD_RECENT_BDETAIL4 TO SBS1_APP  (Grant) 
--  BD_RECENT_BDETAIL6 TO SBS1_APP  (Grant) 
--  BD_RECENT_BDETAIL9 TO SBS1_APP  (Grant) 
--  BD_RECENT_VAS TO SBS1_APP  (Grant) 
--  BOHEADER TO SBS1_APP  (Grant) 
--  CDRMMS TO SBS1_APP  (Grant) 
--  CDRSMS TO SBS1_APP  (Grant) 
--  CDR_SUMMARY_BILLRATE_N TO SBS1_APP  (Grant) 
--  CDR_SUMMARY_BILLRATE_NA TO SBS1_APP  (Grant) 
--  CDR_SUMMARY_BILLRATE_0 TO SBS1_APP  (Grant) 
--  CDR_SUMMARY_BILLRATE_1 TO SBS1_APP  (Grant) 
--  CDR_SUMMARY_BILLRATE_1A TO SBS1_APP  (Grant) 
--  CDR_SUMMARY_BILLRATE_1_BN TO SBS1_APP  (Grant) 
--  CDR_SUMMARY_BILLRATE_1_BNA TO SBS1_APP  (Grant) 
--  CDR_SUMMARY_BILLRATE_1_IS TO SBS1_APP  (Grant) 
--  CDR_SUMMARY_BILLRATE_1_ISA TO SBS1_APP  (Grant) 
--  CDR_SUMMARY_BILLRATE_1_WEEK TO SBS1_APP  (Grant) 
--  CDR_SUMMARY_BILLTEXT_BN TO SBS1_APP  (Grant) 
--  CDR_SUMMARY_BILLTEXT_WCB TO SBS1_APP  (Grant) 
--  CDR_SUMMARY_LOCATION_1 TO SBS1_APP  (Grant) 
--  CDR_SUMMARY_STYPE_BN TO SBS1_APP  (Grant) 
--  CONFIGURE_FOR_TEST TO SBS1_APP  (Grant) 
--  IWTCOUNTER TO SBS1_APP  (Grant) 
--  JOB_ADRID_MAIN_EMAIL TO SBS1_APP  (Grant) 
--  JOB_BN_STATS_EMAILS TO SBS1_APP  (Grant) 
--  JOB_BOHIDEXEC TO SBS1_APP  (Grant) 
--  JOB_DATEFROM TO SBS1_APP  (Grant) 
--  JOB_DATETILL TO SBS1_APP  (Grant) 
--  JOB_DATETO TO SBS1_APP  (Grant) 
--  JOB_EXPANDED_SQL TO SBS1_APP  (Grant) 
--  JOB_LA_INVOICE_EMAILS TO SBS1_APP  (Grant) 
--  JOB_LOOPVAR TO SBS1_APP  (Grant) 
--  JOB_PARAMETER TO SBS1_APP  (Grant) 
--  JOB_SEARCH_PARAMETER TO SBS1_APP  (Grant) 
--  JOB_SEARCH_PARAMETER_TEST TO SBS1_APP  (Grant) 
--  KEYWORDS_PER_DAY TO SBS1_APP  (Grant) 
--  KEYWORDS_PER_DAY_1 TO SBS1_APP  (Grant) 
--  MAPPACDEP TO SBS1_APP  (Grant) 
--  MAY_USE_ALL_PARTITIONS TO SBS1_APP  (Grant) 
--  MAY_USE_BDETAIL_PARTITIONS TO SBS1_APP  (Grant) 
--  MAY_USE_BDETAIL1_PARTITIONS TO SBS1_APP  (Grant) 
--  MAY_USE_BDETAIL4_PARTITIONS TO SBS1_APP  (Grant) 
--  MAY_USE_BDETAIL6_PARTITIONS TO SBS1_APP  (Grant) 
--  MAY_USE_MONTH_PARTITIONS TO SBS1_APP  (Grant) 
--  MAY_USE_REVAOTHERS_PARTITIONS TO SBS1_APP  (Grant) 
--  MAY_USE_REVI_PARTITIONS TO SBS1_APP  (Grant) 
--  MMS_CDR_DETAIL TO SBS1_APP  (Grant) 
--  MMS_SUBMIT_DUPLICATES TO SBS1_APP  (Grant) 
--  PACKING TO SBS1_APP  (Grant) 
--  PACPACDEP TO SBS1_APP  (Grant) 
--  PKG_ADMIN_COMMON TO SBS1_APP  (Grant) 
--  PKG_BDETAIL_COMMON TO SBS1_APP  (Grant) 
--  PKG_BDETAIL_INFO TO SBS1_APP  (Grant) 
--  PKG_BDETAIL_MMSC TO SBS1_APP  (Grant) 
--  PKG_BDETAIL_MSC TO SBS1_APP  (Grant) 
--  PKG_BDETAIL_SETTLEMENT TO SBS1_APP  (Grant) 
--  PKG_BDETAIL_SMSC TO SBS1_APP  (Grant) 
--  PKG_COMMON_PACKING TO SBS1_APP  (Grant) 
--  PKG_COMMON_STATS TO SBS1_APP  (Grant) 
--  PKG_INTERWORKING TO SBS1_APP  (Grant) 
--  PKG_KPI_BD TO SBS1_APP  (Grant) 
--  PKG_KPI_BD1 TO SBS1_APP  (Grant) 
--  PKG_KPI_BD2 TO SBS1_APP  (Grant) 
--  PKG_MEC_HB TO SBS1_APP  (Grant) 
--  PKG_MEC_IC_ASCII0 TO SBS1_APP  (Grant) 
--  PKG_MEC_OC TO SBS1_APP  (Grant) 
--  PKG_REVA TO SBS1_APP  (Grant) 
--  PKG_REVI TO SBS1_APP  (Grant) 
--  PKG_STATS TO SBS1_APP  (Grant) 
--  RAM_D_BDETAIL6_DETAILS TO SBS1_APP  (Grant) 
--  RAM_D_BDETAIL6_IOR_BASE TO SBS1_APP  (Grant) 
--  RAM_D_BDETAIL6_IOR_B10 TO SBS1_APP  (Grant) 
--  RAM_D_BDETAIL6_IOR_DETAILS TO SBS1_APP  (Grant) 
--  RAM_D_BDETAIL6_IOR_I10 TO SBS1_APP  (Grant) 
--  RAM_D_SR054A_DETAILS_3 TO SBS1_APP  (Grant) 
--  RAM_D_SR054A_DETAILS_3_BASE TO SBS1_APP  (Grant) 
--  RAM_D_SR054A_DETAILS_3_FG TO SBS1_APP  (Grant) 
--  RAM_D_SR054A_DETAILS_3_90 TO SBS1_APP  (Grant) 
--  RAM_D_SR054A_DETAILS_3_90B TO SBS1_APP  (Grant) 
--  RAM_D_SR075A_BASE_6 TO SBS1_APP  (Grant) 
--  RAM_D_SR075A_BASE_7 TO SBS1_APP  (Grant) 
--  RAM_D_SR075A_DETAILS_6 TO SBS1_APP  (Grant) 
--  RAM_D_SR075A_DETAILS_7 TO SBS1_APP  (Grant) 
--  SERVICES_PER_DAY TO SBS1_APP  (Grant) 
--  SERVICETYPES_PER_DAY TO SBS1_APP  (Grant) 
--  SI008A_DETAILS TO SBS1_APP  (Grant) 
--  SI012A_DETAILS TO SBS1_APP  (Grant) 
--  SI029A_DETAILS TO SBS1_APP  (Grant) 
--  SI056A_DETAILS TO SBS1_APP  (Grant) 
--  SI057A_DETAILS TO SBS1_APP  (Grant) 
--  SI121A_DETAILS_1 TO SBS1_APP  (Grant) 
--  SI121A_DETAILS_2 TO SBS1_APP  (Grant) 
--  SI121A_DETAILS_3 TO SBS1_APP  (Grant) 
--  SL087A_DETAILS_2 TO SBS1_APP  (Grant) 
--  SL091A_DETAILS_2 TO SBS1_APP  (Grant) 
--  SL093A_BASE TO SBS1_APP  (Grant) 
--  SL093A_DETAILS TO SBS1_APP  (Grant) 
--  SL093A_FOOTER TO SBS1_APP  (Grant) 
--  SL093A_HEADER TO SBS1_APP  (Grant) 
--  SL093A_RECORDS TO SBS1_APP  (Grant) 
--  SL094A_DETAILS TO SBS1_APP  (Grant) 
--  SL094A_RECORDS TO SBS1_APP  (Grant) 
--  SMS_SHIFTED_TIMESTAMPS TO SBS1_APP  (Grant) 
--  SR000A_REPORT TO SBS1_APP  (Grant) 
--  SR005A_DETAILS TO SBS1_APP  (Grant) 
--  SR006A_DETAILS TO SBS1_APP  (Grant) 
--  SR007A_DETAILS TO SBS1_APP  (Grant) 
--  SR008A_DETAILS TO SBS1_APP  (Grant) 
--  SR012A_DETAILS TO SBS1_APP  (Grant) 
--  SR013A_DETAILS TO SBS1_APP  (Grant) 
--  SR014A_DETAILS TO SBS1_APP  (Grant) 
--  SR015A_DETAILS TO SBS1_APP  (Grant) 
--  SR016A_DETAILS TO SBS1_APP  (Grant) 
--  SR017A_DETAILS_1 TO SBS1_APP  (Grant) 
--  SR017A_DETAILS_2 TO SBS1_APP  (Grant) 
--  SR018A_DETAILS_1 TO SBS1_APP  (Grant) 
--  SR018A_DETAILS_2 TO SBS1_APP  (Grant) 
--  SR023A_DETAILS_1 TO SBS1_APP  (Grant) 
--  SR023A_DETAILS_2 TO SBS1_APP  (Grant) 
--  SR024A_DETAILS TO SBS1_APP  (Grant) 
--  SR025A_DETAILS TO SBS1_APP  (Grant) 
--  SR026A_DETAILS TO SBS1_APP  (Grant) 
--  SR030A_DETAILS TO SBS1_APP  (Grant) 
--  SR031A_DETAILS TO SBS1_APP  (Grant) 
--  SR034A_DETAILS_1 TO SBS1_APP  (Grant) 
--  SR034A_DETAILS_2 TO SBS1_APP  (Grant) 
--  SR034A_DETAILS_2_BASE TO SBS1_APP  (Grant) 
--  SR034A_DETAILS_3 TO SBS1_APP  (Grant) 
--  SR034A_DETAILS_4 TO SBS1_APP  (Grant) 
--  SR034A_DETAILS_4_BASE TO SBS1_APP  (Grant) 
--  SR035A_DETAILS_1 TO SBS1_APP  (Grant) 
--  SR035A_DETAILS_4 TO SBS1_APP  (Grant) 
--  SR038A_BASE TO SBS1_APP  (Grant) 
--  SR038A_DETAILS TO SBS1_APP  (Grant) 
--  SR039A_DETAILS_4 TO SBS1_APP  (Grant) 
--  SR040A_DETAILS TO SBS1_APP  (Grant) 
--  SR042A_DETAILS TO SBS1_APP  (Grant) 
--  SR043A_DETAILS TO SBS1_APP  (Grant) 
--  SR043A_DETAILS_MVP TO SBS1_APP  (Grant) 
--  SR043A_DETAILS_SPENDEN TO SBS1_APP  (Grant) 
--  SR044A_DETAILS TO SBS1_APP  (Grant) 
--  SR054A_DETAILS_3 TO SBS1_APP  (Grant) 
--  SR054A_DETAILS_3_BASE TO SBS1_APP  (Grant) 
--  SR054A_DETAILS_3_BASE_ROLL TO SBS1_APP  (Grant) 
--  SR054A_DETAILS_3_ROLL TO SBS1_APP  (Grant) 
--  SR074_BASE TO SBS1_APP  (Grant) 
--  SR075A_BASE_6 TO SBS1_APP  (Grant) 
--  SR075A_BASE_7 TO SBS1_APP  (Grant) 
--  SR075A_DETAILS_1 TO SBS1_APP  (Grant) 
--  SR075A_DETAILS_6 TO SBS1_APP  (Grant) 
--  SR075A_DETAILS_7 TO SBS1_APP  (Grant) 
--  SR076A_BASE TO SBS1_APP  (Grant) 
--  SR076A_BASE_1 TO SBS1_APP  (Grant) 
--  SR076A_DETAILS_1 TO SBS1_APP  (Grant) 
--  SR076A_DETAILS_2 TO SBS1_APP  (Grant) 
--  SR076A_DETAILS_3 TO SBS1_APP  (Grant) 
--  SR076A_DETAILS_4 TO SBS1_APP  (Grant) 
--  SR076A_DETAILS_5 TO SBS1_APP  (Grant) 
--  SR076A_DETAILS_6 TO SBS1_APP  (Grant) 
--  SR076A_DETAILS_7 TO SBS1_APP  (Grant) 
--  SR078A_DETAILS_N TO SBS1_APP  (Grant) 
--  SR078A_DETAILS_1 TO SBS1_APP  (Grant) 
--  SR078A_DETAILS_2 TO SBS1_APP  (Grant) 
--  SR078A_DETAILS_3 TO SBS1_APP  (Grant) 
--  SR078A_DETAILS_4 TO SBS1_APP  (Grant) 
--  SR088A_DEL_BASE TO SBS1_APP  (Grant) 
--  SR088A_DETAILS1 TO SBS1_APP  (Grant) 
--  SR088A_DETAILS2 TO SBS1_APP  (Grant) 
--  SR088A_SUB_BASE TO SBS1_APP  (Grant) 
--  SR089A_BASE TO SBS1_APP  (Grant) 
--  SR089A_BASE_SCT TO SBS1_APP  (Grant) 
--  SR089A_DETAILS_1 TO SBS1_APP  (Grant) 
--  SR089A_DETAILS_2 TO SBS1_APP  (Grant) 
--  SR089A_DETAILS_3 TO SBS1_APP  (Grant) 
--  SR098A_DETAILS TO SBS1_APP  (Grant) 
--  SR107A_DETAILS_1 TO SBS1_APP  (Grant) 
--  SR107A_DETAILS_2 TO SBS1_APP  (Grant) 
--  SR107A_DETAILS_3 TO SBS1_APP  (Grant) 
--  SR107A_DETAILS_4 TO SBS1_APP  (Grant) 
--  SR108A_DETAILS_1 TO SBS1_APP  (Grant) 
--  SR109A_DETAILS TO SBS1_APP  (Grant) 
--  SR110A_DETAILS_1 TO SBS1_APP  (Grant) 
--  SR111A_DETAILS_11 TO SBS1_APP  (Grant) 
--  SR111A_DETAILS_5 TO SBS1_APP  (Grant) 
--  SR118A_DETAILS_1 TO SBS1_APP  (Grant) 
--  SR118A_DETAILS_2 TO SBS1_APP  (Grant) 
--  STA_CHECKBT_BDETAIL TO SBS1_APP  (Grant) 
--  STA_CHECKBT_BDETAIL1 TO SBS1_APP  (Grant) 
--  STA_CHECKBT_BDETAIL2 TO SBS1_APP  (Grant) 
--  STA_DIRECTORY TO SBS1_APP  (Grant) 
--  STA_GETNEXTJOB TO SBS1_APP  (Grant) 
--  STA_JOB TO SBS1_APP  (Grant) 
--  STA_JOBOUTPUT TO SBS1_APP  (Grant) 
--  STA_JOBPARAM TO SBS1_APP  (Grant) 
--  STA_JOBSQL TO SBS1_APP  (Grant) 
--  STA_PACPARAM TO SBS1_APP  (Grant) 
--  STA_SQLDEF TO SBS1_APP  (Grant) 
--  STA_SUBSCRIPTION TO SBS1_APP  (Grant) 
--  STATS_ANALYZEJOB TO SBS1_APP  (Grant) 
--  STA_WEB_JOB_LIST TO SBS1_APP  (Grant) 
--  STA_WEB_STAT_ANALYSIS TO SBS1_APP  (Grant) 
--  STA_WEB_TEMP_LIST TO SBS1_APP  (Grant) 
--  SUSPEND_MEC_ICS TO SBS1_APP  (Grant) 
--  TORA_D_BDETAIL6_IOR_IN_OUT TO SBS1_APP  (Grant) 
--  TORA_D_SR054A_DETAILS_3_OUT TO SBS1_APP  (Grant) 
--  TORA_D_SR054A_DETAILS_3_ZERO TO SBS1_APP  (Grant) 
--  TORA_D_0056_LATEST TO SBS1_APP  (Grant) 
--  TORA_D_0065_LATEST TO SBS1_APP  (Grant) 
--  TORA_D_0065_LATEST_SORTED TO SBS1_APP  (Grant) 
--  USERMNG_SBS TO SBS1_APP  (Grant) 
--  BDETAIL6 TO SBS1_APP_USER_R  (Grant) 
--  GPSH_CURRENCY_EXR_DEL TO SBS1_CPRO  (Grant) 
--  GPSH_CURRENCY_EXR_PUT TO SBS1_CPRO  (Grant) 
--  USERMNG_SBS TO SBS1_DBL_CENTRUM  (Grant) 
--  RAM_D_BDETAIL6_DETAILS TO SBS1_DBL_RA  (Grant) 
--  RAM_D_BDETAIL6_IOR_DETAILS TO SBS1_DBL_RA  (Grant) 
--  RAM_D_SR054A_DETAILS_3 TO SBS1_DBL_RA  (Grant) 
--  RAM_D_SR054A_DETAILS_3_90 TO SBS1_DBL_RA  (Grant) 
--  RAM_D_SR075A_DETAILS_6 TO SBS1_DBL_RA  (Grant) 
--  RAM_D_SR075A_DETAILS_7 TO SBS1_DBL_RA  (Grant) 
--  SR075A_DETAILS_1 TO SBS1_DBL_RA  (Grant) 
--  SR075A_DETAILS_6 TO SBS1_DBL_RA  (Grant) 
--  SR075A_DETAILS_7 TO SBS1_DBL_RA  (Grant) 
--  BDETAIL TO SBS1_SBSWEB  (Grant) 
--  BDETAIL1 TO SBS1_SBSWEB  (Grant) 
--  BDETAIL6 TO SBS1_SBSWEB  (Grant) 
--  IWTCOUNTER TO SBS1_SBSWEB  (Grant) 
--  PACKING TO SBS1_SBSWEB  (Grant) 
--  PKG_ADMIN_COMMON TO SBS1_SBSWEB  (Grant) 
--  PKG_BDETAIL_COMMON TO SBS1_SBSWEB  (Grant) 
--  PKG_INTERWORKING TO SBS1_SBSWEB  (Grant) 
--  STA_DIRECTORY TO SBS1_SBSWEB  (Grant) 
--  STA_JOB TO SBS1_SBSWEB  (Grant) 
--  STA_JOBOUTPUT TO SBS1_SBSWEB  (Grant) 
--  STA_JOBPARAM TO SBS1_SBSWEB  (Grant) 
--  STA_JOBSQL TO SBS1_SBSWEB  (Grant) 
--  STA_PACPARAM TO SBS1_SBSWEB  (Grant) 
--  STA_WEB_JOB_LIST TO SBS1_SBSWEB  (Grant) 
--  STA_WEB_JOB_LIST_CUC TO SBS1_SBSWEB  (Grant) 
--  STA_WEB_JOB_LIST_IS TO SBS1_SBSWEB  (Grant) 
--  STA_WEB_JOB_LIST_IW TO SBS1_SBSWEB  (Grant) 
--  STA_WEB_JOB_LIST_LA TO SBS1_SBSWEB  (Grant) 
--  STA_WEB_JOB_LIST_SYS TO SBS1_SBSWEB  (Grant) 
--  STA_WEB_STAT_ANALYSIS TO SBS1_SBSWEB  (Grant) 
--  STA_WEB_TEMP_LIST TO SBS1_SBSWEB  (Grant) 
--  BDETAIL TO SBS2_ADMIN  (Grant) 
--  BDETAIL6 TO SBS2_ADMIN  (Grant) 
--  MAY_USE_MONTH_PARTITIONS TO SBS2_ADMIN  (Grant) 
--  BDETAIL TO SBS2_APP  (Grant) 
--  BDETAIL6 TO SBS2_APP  (Grant) 
--  MAY_USE_MONTH_PARTITIONS TO SBS2_APP  (Grant)